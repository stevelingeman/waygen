const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SearchBar-BJmMKYcZ.js","assets/vendor-DRMOV0oM.js","assets/mapbox-C3udIXGP.js","assets/turf-D8sFHwPo.js","assets/utils-P9aiU5u9.js","assets/mapbox-gl-geocoder-BCYwfNyN.css","assets/MapContainer-Bzw1DrOP.js","assets/MapContainer-jpWXR4Z0.css"])))=>i.map(i=>d[i]);
import{r as C,a as Xe,c as Qe,X as Ee,b as et,A as tt,S as Ae,d as nt,T as De,U as st,R as ot,e as it,M as at,C as rt,P as lt,D as ct,f as dt,g as ut,h as ce}from"./vendor-DRMOV0oM.js";import{p as O,d as Q,a as mt,b as te,c as ie,e as Le,t as ye,f as pt,l as we,g as gt,h as ve,i as je,j as ht,m as Ne}from"./turf-D8sFHwPo.js";import{J as Ce,F as ft}from"./utils-P9aiU5u9.js";import"./mapbox-C3udIXGP.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function s(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(o){if(o.ep)return;o.ep=!0;const a=s(o);fetch(o.href,a)}})();var Fe={exports:{}},de={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xt=C,bt=Symbol.for("react.element"),yt=Symbol.for("react.fragment"),wt=Object.prototype.hasOwnProperty,vt=xt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,jt={key:!0,ref:!0,__self:!0,__source:!0};function Ie(e,t,s){var i,o={},a=null,r=null;s!==void 0&&(a=""+s),t.key!==void 0&&(a=""+t.key),t.ref!==void 0&&(r=t.ref);for(i in t)wt.call(t,i)&&!jt.hasOwnProperty(i)&&(o[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps,t)o[i]===void 0&&(o[i]=t[i]);return{$$typeof:bt,type:e,key:a,ref:r,props:o,_owner:vt.current}}de.Fragment=yt;de.jsx=Ie;de.jsxs=Ie;Fe.exports=de;var n=Fe.exports,me={},Se=Xe;me.createRoot=Se.createRoot,me.hydrateRoot=Se.hydrateRoot;const Nt="modulepreload",St=function(e){return"/"+e},Pe={},_e=function(t,s,i){let o=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),l=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));o=Promise.allSettled(s.map(d=>{if(d=St(d),d in Pe)return;Pe[d]=!0;const m=d.endsWith(".css"),p=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${p}`))return;const f=document.createElement("link");if(f.rel=m?"stylesheet":Nt,m||(f.as="script"),f.crossOrigin="",f.href=d,l&&f.setAttribute("nonce",l),document.head.appendChild(f),m)return new Promise((u,g)=>{f.addEventListener("load",u),f.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${d}`)))})}))}function a(r){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=r,window.dispatchEvent(l),!l.defaultPrevented)throw r}return o.then(r=>{for(const l of r||[])l.status==="rejected"&&a(l.reason);return t().catch(a)})},Pt=.85,Me=120,Mt={"mini-4-pro":{name:"DJI Mini 4 Pro",hfov:82.1,photoInterval:5.5,maxFlightTime:31},"mini-5-pro":{name:"DJI Mini 5 Pro",hfov:82.1,photoInterval:5.5,maxFlightTime:40},"mavic-4-pro":{name:"DJI Mavic 4 Pro",hfov:84,photoInterval:5.5,maxFlightTime:40},custom:{name:"Custom",hfov:null,photoInterval:5.5,maxFlightTime:null}},Y=e=>{const t=Tt(e);return Mt[t]||null},Tt=e=>({dji_mini_4_pro:"mini-4-pro",dji_mini_5_pro:"mini-5-pro",dji_mavic_4_pro:"mavic-4-pro",custom:"custom"})[e]||e,un=(e,t,s,i)=>{if(!e||!t||!i)return null;const o=2*t*Math.tan(i*Math.PI/360),a=o*(3/4),r=o/2,l=a/2,d=Math.sqrt(r*r+l*l),m=Math.atan2(r,l)*180/Math.PI,p=180-m,f=180+m,u=360-m,g=O([e.lng,e.lat]),y=Q(g,d/1e3,s+m,{units:"kilometers"}),h=Q(g,d/1e3,s+p,{units:"kilometers"}),b=Q(g,d/1e3,s+f,{units:"kilometers"}),w=Q(g,d/1e3,s+u,{units:"kilometers"}),A=[[y.geometry.coordinates,h.geometry.coordinates,b.geometry.coordinates,w.geometry.coordinates,y.geometry.coordinates]];return mt(A,{altitude:t,heading:s,hfov:i})},Re=(e,t)=>{const s=O([e.lng,e.lat]),i=O([t.lng,t.lat]);return te(s,i,{units:"meters"})},Oe=(e,t)=>{if(!e||e.length<2||!t||t<=0)return{maxSpeed:0,minDistance:0};const s=[];for(let a=0;a<e.length-1;a++){const r=Re(e[a],e[a+1]);s.push(r)}const i=Math.min(...s),o=i/t;return{maxSpeed:Math.max(0,o),minDistance:i}},kt=(e,t)=>{if(!t||t<=0)return Me;const i=e/t+Me;return Math.round(i)},Et=(e,t)=>{if(!t||t<=0)return"safe";const s=t*60,i=s*Pt;return e>=s?"critical":e>=i?"warning":"safe"};function ne(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}const B=Qe((e,t)=>({waypoints:[],selectedIds:[],mapRef:null,currentMissionFilename:null,calculatedMaxSpeed:0,minSegmentDistance:0,past:[],future:[],settings:{altitude:60,speed:10,gimbalPitch:-90,customFOV:82.1,showFootprints:!1,footprintColor:"#22c55e",sideOverlap:80,frontOverlap:80,pathType:"grid",angle:0,autoDirection:!1,generateEveryPoint:!1,reversePath:!1,waypointAction:"none",photoInterval:2,selectedDrone:"dji_mini_5_pro",straightenLegs:!1,units:"metric",orbitRadius:50,missionEndAction:"goHome"},setWaypoints:s=>e(i=>({waypoints:s,past:[...i.past,i.waypoints],future:[]})),addWaypoint:s=>e(i=>{let o=i.settings.speed,a=0;if(i.waypoints.length>0){const d=i.waypoints[i.waypoints.length-1];o=Math.round((d.speed||i.settings.speed)*10)/10,a=d.heading||0}const r={id:ne(),...s,altitude:i.settings.altitude,speed:o,gimbalPitch:i.settings.gimbalPitch,heading:a},l=[...i.waypoints];if(l.length>0){const d=l.length-1,m=l[d],p=Math.round(ie([m.lng,m.lat],[r.lng,r.lat]));l[d]={...m,heading:p},r.heading=p}return{waypoints:[...l,r],past:[...i.past,i.waypoints],future:[]}}),updateSettings:s=>e(i=>({settings:{...i.settings,...s}})),selectWaypoint:(s,i)=>e(o=>({selectedIds:i?o.selectedIds.includes(s)?o.selectedIds.filter(a=>a!==s):[...o.selectedIds,s]:[s]})),setSelectedIds:s=>e({selectedIds:s}),clearSelection:()=>e({selectedIds:[]}),updateSelectedWaypoints:s=>{const{waypoints:i,selectedIds:o,past:a}=t(),r=i.map(l=>o.includes(l.id)?{...l,...s}:l);e({waypoints:r,past:[...a,i],future:[]})},updateWaypoint:(s,i)=>{const{waypoints:o,past:a}=t(),r=o.map(l=>l.id===s?{...l,...i}:l);e({waypoints:r,past:[...a,o],future:[]})},deleteSelectedWaypoints:()=>{const{waypoints:s,selectedIds:i,past:o}=t(),a=s.filter(r=>!i.includes(r.id));e({waypoints:a,selectedIds:[],past:[...o,s],future:[]})},moveWaypoints:(s,i,o)=>{const{waypoints:a,past:r}=t(),l=a.map(d=>s.includes(d.id)?{...d,lng:d.lng+i,lat:d.lat+o}:d);e({waypoints:l,past:[...r,a],future:[]})},undo:()=>{const{past:s,future:i,waypoints:o}=t();if(s.length===0)return;const a=s[s.length-1],r=s.slice(0,s.length-1);e({waypoints:a,past:r,future:[o,...i]})},redo:()=>{const{past:s,future:i,waypoints:o}=t();if(i.length===0)return;const a=i[0],r=i.slice(1);e({waypoints:a,past:[...s,o],future:r})},setMapRef:s=>e({mapRef:s}),fitMapToWaypoints:()=>{const{mapRef:s,waypoints:i}=t();if(!s||!i||i.length===0)return;let o=i[0].lng,a=i[0].lng,r=i[0].lat,l=i[0].lat;i.forEach(m=>{m.lng<o&&(o=m.lng),m.lng>a&&(a=m.lng),m.lat<r&&(r=m.lat),m.lat>l&&(l=m.lat)});const d=[[o,r],[a,l]];s.fitBounds(d,{padding:{top:100,bottom:100,left:200,right:350},maxZoom:16,duration:3e3})},setMissionFilename:s=>e({currentMissionFilename:s}),clearMissionFilename:()=>e({currentMissionFilename:null}),calculateMissionMetrics:()=>{const{waypoints:s,settings:i}=t(),o=Y(i.selectedDrone),a=(o==null?void 0:o.photoInterval)||5.5,{maxSpeed:r,minDistance:l}=Oe(s,a);e({calculatedMaxSpeed:r,minSegmentDistance:l})},getTotalDistance:()=>{const{waypoints:s}=t();if(s.length<2)return 0;let i=0;for(let o=0;o<s.length-1;o++)i+=Re(s[o],s[o+1]);return i},getMissionTime:()=>{const{calculatedMaxSpeed:s}=t(),i=t().getTotalDistance();return kt(i,s)},getFlightWarningLevel:()=>{const{settings:s}=t(),i=t().getMissionTime(),o=Y(s.selectedDrone),a=(o==null?void 0:o.maxFlightTime)||null;return Et(i,a)},resetTrigger:0,resetMission:()=>e(s=>({waypoints:[],selectedIds:[],past:[],future:[],currentMissionFilename:null,calculatedMaxSpeed:0,minSegmentDistance:0,resetTrigger:s.resetTrigger+1}))}));function At(e,t){const{altitude:s,speed:i,gimbalPitch:o,spacing:a,straightenLegs:r,waypointAction:l}=t,d=Le(e);d.geometry.coordinates;const m=e.geometry.coordinates[0];let p=0;m.forEach(h=>{p+=te(d,O(h),{units:"meters"})});const f=p/m.length,u=2*Math.PI*f,g=Math.max(3,Math.round(u/a)),y=[];for(let h=0;h<g;h++){const b=h/g*360,w=Q(d,f/1e3,b,{units:"kilometers"}),A=Math.round(ie(w,d));y.push({id:ne(),lng:w.geometry.coordinates[0],lat:w.geometry.coordinates[1],altitude:Number(s),speed:Math.round(Number(i)*10)/10,gimbalPitch:Number(o),heading:A,straightenLegs:r,action:l})}if(y.length>0){const h=y[0];y.push({...h,id:ne()})}return y}function Te(e,t){if(t.pathType==="orbit")return At(e,t);const{altitude:s,sideOverlap:i,frontOverlap:o,angle:a,gimbalPitch:r,autoDirection:l,generateEveryPoint:d,reversePath:m,speed:p,straightenLegs:f,waypointAction:u}=t,g=t.customFOV||82.1,y=Math.tan(g/2*(Math.PI/180)),h=s*y*2,w=h*(1-i/100)/111111,A=Le(e);let _=a;if(l){let x=0,L=0;const T=e.geometry.coordinates[0];for(let k=0;k<T.length-1;k++){const M=O(T[k]),G=O(T[k+1]),J=te(M,G);J>x&&(x=J,L=ie(M,G))}_=L}const P=-_,I=ye(e,P,{pivot:A}),D=pt(I),V=[];let U=D[1]+w/2;for(;U<=D[3]+w/10;){const x=we([[D[0]-.1,U],[D[2]+.1,U]]),L=gt(x,I),T=k=>{const M=k.geometry.coordinates;return Array.isArray(M[0][0])?Ne(M[0][0],M[0][M[0].length-1]):Ne(M[0],M[M.length-1])};if(L.features.length===0){const k=T(x);ve(k,I)&&V.push(x.geometry.coordinates)}else L.features.forEach(k=>{const M=T(k);ve(M,I)&&V.push(k.geometry.coordinates)});U+=w}let N=[];if(V.forEach((x,L)=>{let T=L%2===1?x.reverse():x;if(d){const k=O(T[0]),M=O(T[1]),G=te(k,M,{units:"meters"}),c=h*(3/4)*(1-o/100),v=Math.max(1,c),j=Math.floor(G/v);if(j>=1){const E=we(T),F=[];for(let S=0;S<=j;S++){je(E,S*v/1e3,{units:"kilometers"});const se=je(E,S*v,{units:"meters"});F.push(se.geometry.coordinates)}T=F}}T.forEach((k,M)=>{const G=M===T.length-1;N.push({id:ne(),lng:k[0],lat:k[1],altitude:Number(s),speed:Math.round(Number(p)*10)/10,gimbalPitch:Number(r),heading:0,straightenLegs:f,action:u,_isRowEnd:G})})}),N.length===0)return[];const $=ht(N.map(x=>[x.lng,x.lat]));ye($,_,{pivot:A}).features.forEach((x,L)=>{N[L].lng=x.geometry.coordinates[0],N[L].lat=x.geometry.coordinates[1]}),m&&N.reverse();for(let x=0;x<N.length;x++){if(N[x]._isRowEnd&&x>0)N[x].heading=N[x-1].heading;else if(x<N.length-1){const L=O([N[x].lng,N[x].lat]),T=O([N[x+1].lng,N[x+1].lat]);N[x].heading=Math.round(ie(L,T))}else x>0&&(N[x].heading=N[x-1].heading);delete N[x]._isRowEnd}return N}const Dt=async(e,t,s="MiniMission",i=null)=>{const o=new Ce,a=Date.now(),{speed:r,straightenLegs:l,waypointAction:d,gimbalPitch:m,missionEndAction:p}=t,f=`<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://www.opengis.net/kml/2.2" xmlns:wpml="http://www.dji.com/wpmz/1.0.2">
  <Document>
    <wpml:createTime>${a}</wpml:createTime>
    <wpml:updateTime>${a}</wpml:updateTime>
    <wpml:missionConfig>
      <wpml:flyToWaylineMode>safely</wpml:flyToWaylineMode>
      <wpml:finishAction>${p}</wpml:finishAction>
      <wpml:exitOnRCLost>executeLostAction</wpml:exitOnRCLost>
      <wpml:executeRCLostAction>hover</wpml:executeRCLostAction>
      <wpml:globalTransitionalSpeed>${r}</wpml:globalTransitionalSpeed>
      <wpml:droneInfo>
        <wpml:droneEnumValue>68</wpml:droneEnumValue>
        <wpml:droneSubEnumValue>0</wpml:droneSubEnumValue>
      </wpml:droneInfo>
    </wpml:missionConfig>
    <wpml:templateId>0</wpml:templateId>
  </Document>
</kml>`;let u="";e.forEach((b,w)=>{const A=w===0,_=w===e.length-1,P=w+1,I=b.straightenLegs!==void 0?b.straightenLegs:l,D=b.action!==void 0?b.action:d,V=b.gimbalPitch!==void 0?b.gimbalPitch:m,U=b.speed!==void 0?b.speed:r;let N="",$=0;const K=w>0?e[w-1]:null,x=K?K.gimbalPitch!==void 0?K.gimbalPitch:m:null;(A||x!==null&&V!==x)&&(N+=`
        <wpml:action>
          <wpml:actionId>${$++}</wpml:actionId>
          <wpml:actionActuatorFunc>gimbalRotate</wpml:actionActuatorFunc>
          <wpml:actionActuatorFuncParam>
            <wpml:gimbalHeadingYawBase>aircraft</wpml:gimbalHeadingYawBase>
            <wpml:gimbalRotateMode>absoluteAngle</wpml:gimbalRotateMode>
            <wpml:gimbalPitchRotateEnable>1</wpml:gimbalPitchRotateEnable>
            <wpml:gimbalPitchRotateAngle>${V}</wpml:gimbalPitchRotateAngle>
            <wpml:gimbalRollRotateEnable>0</wpml:gimbalRollRotateEnable>
            <wpml:gimbalYawRotateEnable>0</wpml:gimbalYawRotateEnable>
            <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
          </wpml:actionActuatorFuncParam>
        </wpml:action>`),D==="photo"?N+=`
        <wpml:action>
          <wpml:actionId>${$++}</wpml:actionId>
          <wpml:actionActuatorFunc>takePhoto</wpml:actionActuatorFunc>
          <wpml:actionActuatorFuncParam>
            <wpml:fileSuffix>point${w}</wpml:fileSuffix>
            <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
          </wpml:actionActuatorFuncParam>
        </wpml:action>`:D==="record_start"?N+=`
          <wpml:action>
            <wpml:actionId>${$++}</wpml:actionId>
            <wpml:actionActuatorFunc>startRecord</wpml:actionActuatorFunc>
            <wpml:actionActuatorFuncParam>
              <wpml:fileSuffix>mission</wpml:fileSuffix>
              <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
            </wpml:actionActuatorFuncParam>
          </wpml:action>`:D==="record_stop"?N+=`
          <wpml:action>
            <wpml:actionId>${$++}</wpml:actionId>
            <wpml:actionActuatorFunc>stopRecord</wpml:actionActuatorFunc>
            <wpml:actionActuatorFuncParam>
              <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
            </wpml:actionActuatorFuncParam>
          </wpml:action>`:D==="record"&&(A?N+=`
            <wpml:action>
              <wpml:actionId>${$++}</wpml:actionId>
              <wpml:actionActuatorFunc>startRecord</wpml:actionActuatorFunc>
              <wpml:actionActuatorFuncParam>
                <wpml:fileSuffix>mission</wpml:fileSuffix>
                <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
              </wpml:actionActuatorFuncParam>
            </wpml:action>`:_&&(N+=`
            <wpml:action>
              <wpml:actionId>${$++}</wpml:actionId>
              <wpml:actionActuatorFunc>stopRecord</wpml:actionActuatorFunc>
              <wpml:actionActuatorFuncParam>
                <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
              </wpml:actionActuatorFuncParam>
            </wpml:action>`));const L=$>0?`
      <wpml:actionGroup>
        <wpml:actionGroupId>${P}</wpml:actionGroupId>
        <wpml:actionGroupStartIndex>${w}</wpml:actionGroupStartIndex>
        <wpml:actionGroupEndIndex>${w}</wpml:actionGroupEndIndex>
        <wpml:actionGroupMode>sequence</wpml:actionGroupMode>
        <wpml:actionTrigger>
          <wpml:actionTriggerType>reachPoint</wpml:actionTriggerType>
        </wpml:actionTrigger>
        ${N}
      </wpml:actionGroup>`:"";u+=`
    <Placemark>
      <Point><coordinates>${b.lng},${b.lat},0</coordinates></Point>
      <wpml:index>${w}</wpml:index>
      <wpml:executeHeight>${b.altitude}</wpml:executeHeight>
      <wpml:waypointSpeed>${U}</wpml:waypointSpeed>
      <wpml:waypointHeadingParam>
        <wpml:waypointHeadingMode>smoothTransition</wpml:waypointHeadingMode>
        <wpml:waypointHeadingAngle>${b.heading}</wpml:waypointHeadingAngle>
        <wpml:waypointHeadingAngleEnable>0</wpml:waypointHeadingAngleEnable>
        <wpml:waypointHeadingPathMode>followBadArc</wpml:waypointHeadingPathMode>
      </wpml:waypointHeadingParam>
      <wpml:useStraightLine>${I?1:0}</wpml:useStraightLine>
      ${L}
    </Placemark>`});const g=`<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://www.opengis.net/kml/2.2" xmlns:wpml="http://www.dji.com/wpmz/1.0.2">
  <Document>
    <wpml:missionConfig>
      <wpml:flyToWaylineMode>safely</wpml:flyToWaylineMode>
      <wpml:finishAction>${p}</wpml:finishAction>
      <wpml:exitOnRCLost>executeLostAction</wpml:exitOnRCLost>
      <wpml:executeRCLostAction>hover</wpml:executeRCLostAction>
      <wpml:globalTransitionalSpeed>${r}</wpml:globalTransitionalSpeed>
      <wpml:droneInfo>
        <wpml:droneEnumValue>68</wpml:droneEnumValue>
        <wpml:droneSubEnumValue>0</wpml:droneSubEnumValue>
      </wpml:droneInfo>
    </wpml:missionConfig>
    <Folder>
      <wpml:templateId>0</wpml:templateId>
      <wpml:executeHeightMode>relativeToStartPoint</wpml:executeHeightMode>
      <wpml:waylineId>0</wpml:waylineId>
      <wpml:autoFlightSpeed>${r}</wpml:autoFlightSpeed>
      ${u}
    </Folder>
  </Document>
</kml>`,y=o.folder("wpmz");y.file("template.kml",f),y.file("waylines.wpml",g),i&&o.file("waygen_session.json",JSON.stringify(i,null,2));const h=await o.generateAsync({type:"blob"});ft.saveAs(h,`${s}.kmz`)};function z(e,t){return Array.from(e.getElementsByTagName(t))}function ae(e){return e[0]==="#"?e:`#${e}`}function Lt(e,t,s){return Array.from(e.getElementsByTagNameNS(s,t))}function R(e){return e==null||e.normalize(),e&&e.textContent||""}function H(e,t,s){const i=e.getElementsByTagName(t);return i.length?i[0]:null}function W(e,t,s){const i={};if(!e)return i;const o=e.getElementsByTagName(t),a=o.length?o[0]:null;return a&&s?s(a,i):i}function X(e,t,s){const i=R(H(e,t));return i&&s?s(i)||{}:{}}function q(e,t,s){const i=parseFloat(R(H(e,t)));if(!isNaN(i))return s&&s(i),i}function $e(e,t){const s={};for(const i of t)X(e,i,o=>{s[i]=o});return s}function We(e){return(e==null?void 0:e.nodeType)===1}function ze(e,t){const s={},i=t=="stroke"||t==="fill"?t:t+"-color";return e[0]==="#"&&(e=e.substring(1)),e.length===6||e.length===3?s[i]="#"+e:e.length===8&&(s[t+"-opacity"]=parseInt(e.substring(0,2),16)/255,s[i]="#"+e.substring(6,8)+e.substring(4,6)+e.substring(2,4)),s}function re(e,t,s){const i={};return q(e,t,o=>{i[s]=o}),i}function he(e,t){return W(e,"color",s=>ze(R(s),t))}function He(e){return W(e,"Icon",(t,s)=>(X(t,"href",i=>{s.icon=i}),s))}function Ct(e){return W(e,"IconStyle",t=>Object.assign(he(t,"icon"),re(t,"scale","icon-scale"),re(t,"heading","icon-heading"),W(t,"hotSpot",s=>{const i=parseFloat(s.getAttribute("x")||""),o=parseFloat(s.getAttribute("y")||""),a=s.getAttribute("xunits")||"",r=s.getAttribute("yunits")||"";return!isNaN(i)&&!isNaN(o)?{"icon-offset":[i,o],"icon-offset-units":[a,r]}:{}}),He(t)))}function Ft(e){return W(e,"LabelStyle",t=>Object.assign(he(t,"label"),re(t,"scale","label-scale")))}function It(e){return W(e,"LineStyle",t=>Object.assign(he(t,"stroke"),re(t,"width","stroke-width")))}function _t(e){return W(e,"PolyStyle",(t,s)=>Object.assign(s,W(t,"color",i=>ze(R(i),"fill")),X(t,"fill",i=>{if(i==="0")return{"fill-opacity":0}}),X(t,"outline",i=>{if(i==="0")return{"stroke-opacity":0}})))}function fe(e){return Object.assign({},_t(e),It(e),Ft(e),Ct(e))}const Z=e=>Number(e),pe={string:e=>e,int:Z,uint:Z,short:Z,ushort:Z,float:Z,double:Z,bool:e=>!!e};function Ge(e,t){return W(e,"ExtendedData",(s,i)=>{for(const o of z(s,"Data"))i[o.getAttribute("name")||""]=R(H(o,"value"));for(const o of z(s,"SimpleData")){const a=o.getAttribute("name")||"",r=t[a]||pe.string;i[a]=r(R(o))}return i})}function Be(e){const t=H(e,"description");for(const s of Array.from((t==null?void 0:t.childNodes)||[]))if(s.nodeType===4)return{description:{"@type":"html",value:R(s)}};return{}}function Ve(e){return W(e,"TimeSpan",t=>({timespan:{begin:R(H(t,"begin")),end:R(H(t,"end"))}}))}function Ue(e){return W(e,"TimeStamp",t=>({timestamp:R(H(t,"when"))}))}function Ke(e,t){return X(e,"styleUrl",s=>(s=ae(s),t[s]?Object.assign({styleUrl:s},t[s]):{styleUrl:s}))}const Rt=/\s*/g,Ot=/^\s*|\s*$/g,$t=/\s+/;function Je(e){return e.replace(Rt,"").split(",").map(parseFloat).filter(t=>!isNaN(t)).slice(0,3)}function ge(e){return e.replace(Ot,"").split($t).map(Je).filter(t=>t.length>=2)}function Wt(e){let t=z(e,"coord");t.length===0&&(t=Lt(e,"coord","*"));const s=t.map(i=>R(i).split(" ").map(parseFloat));return s.length===0?null:{geometry:s.length>2?{type:"LineString",coordinates:s}:{type:"Point",coordinates:s[0]},times:z(e,"when").map(i=>R(i))}}function Ze(e){if(e.length===0)return e;const t=e[0],s=e[e.length-1];let i=!0;for(let o=0;o<Math.max(t.length,s.length);o++)if(t[o]!==s[o]){i=!1;break}return i?e:e.concat([e[0]])}function oe(e){return R(H(e,"coordinates"))}function qe(e){let t=[],s=[];for(let i=0;i<e.childNodes.length;i++){const o=e.childNodes.item(i);if(We(o))switch(o.tagName){case"MultiGeometry":case"MultiTrack":case"gx:MultiTrack":{const a=qe(o);t=t.concat(a.geometries),s=s.concat(a.coordTimes);break}case"Point":{const a=Je(oe(o));a.length>=2&&t.push({type:"Point",coordinates:a});break}case"LinearRing":case"LineString":{const a=ge(oe(o));a.length>=2&&t.push({type:"LineString",coordinates:a});break}case"Polygon":{const a=[];for(const r of z(o,"LinearRing")){const l=Ze(ge(oe(r)));l.length>=4&&a.push(l)}a.length&&t.push({type:"Polygon",coordinates:a});break}case"Track":case"gx:Track":{const a=Wt(o);if(!a)break;const{times:r,geometry:l}=a;t.push(l),r.length&&s.push(r);break}}}return{geometries:t,coordTimes:s}}function zt(e){return e.length===0?null:e.length===1?e[0]:{type:"GeometryCollection",geometries:e}}function Ht(e,t,s,i){var m;const{coordTimes:o,geometries:a}=qe(e),r=zt(a);if(!r&&i.skipNullGeometry)return null;const l={type:"Feature",geometry:r,properties:Object.assign($e(e,["name","address","visibility","open","phoneNumber","description"]),Be(e),Ke(e,t),fe(e),Ge(e,s),Ve(e),Ue(e),o.length?{coordinateProperties:{times:o.length===1?o[0]:o}}:{})};((m=l.properties)==null?void 0:m.visibility)!==void 0&&(l.properties.visibility=l.properties.visibility!=="0");const d=e.getAttribute("id");return d!==null&&d!==""&&(l.id=d),l}function Gt(e){return H(e,"gx:LatLonQuad")?{geometry:{type:"Polygon",coordinates:[Ze(ge(oe(e)))]}}:Ut(e)}const Bt=Math.PI/180;function Vt(e,t,s){const i=[(e[0]+e[2])/2,(e[1]+e[3])/2];return[t[0].map(o=>{const a=o[1]-i[1],r=o[0]-i[0],l=Math.sqrt(Math.pow(a,2)+Math.pow(r,2)),d=Math.atan2(a,r)+s*Bt;return[i[0]+Math.cos(d)*l,i[1]+Math.sin(d)*l]})]}function Ut(e){const t=H(e,"LatLonBox");if(t){const s=q(t,"north"),i=q(t,"west"),o=q(t,"east"),a=q(t,"south"),r=q(t,"rotation");if(typeof s=="number"&&typeof a=="number"&&typeof i=="number"&&typeof o=="number"){const l=[i,a,o,s];let d=[[[i,s],[o,s],[o,a],[i,a],[i,s]]];return typeof r=="number"&&(d=Vt(l,d,r)),{bbox:l,geometry:{type:"Polygon",coordinates:d}}}}return null}function Kt(e,t,s,i){var d;const o=Gt(e),a=(o==null?void 0:o.geometry)||null;if(!a&&i.skipNullGeometry)return null;const r={type:"Feature",geometry:a,properties:Object.assign({"@geometry-type":"groundoverlay"},$e(e,["name","address","visibility","open","phoneNumber","description"]),Be(e),Ke(e,t),fe(e),He(e),Ge(e,s),Ve(e),Ue(e))};o!=null&&o.bbox&&(r.bbox=o.bbox),((d=r.properties)==null?void 0:d.visibility)!==void 0&&(r.properties.visibility=r.properties.visibility!=="0");const l=e.getAttribute("id");return l!==null&&l!==""&&(r.id=l),r}function Jt(e){let t=e.getAttribute("id");const s=e.parentNode;return!t&&We(s)&&s.localName==="CascadingStyle"&&(t=s.getAttribute("kml:id")||s.getAttribute("id")),ae(t||"")}function Zt(e){const t={};for(const s of z(e,"Style"))t[Jt(s)]=fe(s);for(const s of z(e,"StyleMap")){const i=ae(s.getAttribute("id")||"");X(s,"styleUrl",o=>{o=ae(o),t[o]&&(t[i]=t[o])})}return t}function qt(e){const t={};for(const s of z(e,"SimpleField"))t[s.getAttribute("name")||""]=pe[s.getAttribute("type")||""]||pe.string;return t}function*Yt(e,t={skipNullGeometry:!1}){const s=Zt(e),i=qt(e);for(const o of z(e,"Placemark")){const a=Ht(o,s,i,t);a&&(yield a)}for(const o of z(e,"GroundOverlay")){const a=Kt(o,s,i,t);a&&(yield a)}}function ke(e,t={skipNullGeometry:!1}){return{type:"FeatureCollection",features:Array.from(Yt(e,t))}}const Xt=async e=>{if(e.name.toLowerCase().endsWith(".kml")){const t=await e.text(),s=new DOMParser().parseFromString(t,"text/xml");return{geojson:ke(s),sessionData:null}}if(e.name.toLowerCase().endsWith(".kmz"))try{const t=await Ce.loadAsync(e);let s=Object.keys(t.files).find(i=>i.toLowerCase().endsWith("waylines.wpml"));if(s||(s=Object.keys(t.files).find(i=>i.toLowerCase().endsWith(".kml"))),s){const i=await t.file(s).async("text"),o=new DOMParser().parseFromString(i,"text/xml"),a=ke(o),r=Array.from(o.getElementsByTagName("Placemark")),l=(f,u)=>{let g=f.getElementsByTagName("wpml:"+u);if(g.length>0||(g=f.getElementsByTagName(u),g.length>0))return g[0].textContent;const y=f.getElementsByTagName("*");for(let h=0;h<y.length;h++)if(y[h].localName===u)return y[h].textContent;return null},d=a.features.length===r.length;if(a.features.forEach((f,u)=>{if(f.geometry.type==="Point"){let g=null;if(d)g=r[u];else{const[y,h]=f.geometry.coordinates;g=r.find(b=>{var D;const w=b.getElementsByTagName("Point")[0];if(!w)return!1;const _=(((D=w.getElementsByTagName("coordinates")[0])==null?void 0:D.textContent)||"").trim().split(",");if(_.length<2)return!1;const P=Number(_[0]),I=Number(_[1]);return Math.abs(P-y)<1e-4&&Math.abs(I-h)<1e-4})}if(g){let y=l(g,"waypointHeading");y===null&&(y=l(g,"waypointHeadingAngle"));const h=l(g,"waypointSpeed");let b=l(g,"ellipsoidHeight");b===null&&(b=l(g,"height")),b===null&&(b=l(g,"executeHeight"));const w=l(g,"gimbalPitchAngle");y!==null&&(f.properties.heading=Number(y)),h!==null&&(f.properties.speed=Number(h)),b!==null&&(f.properties.altitude=Number(b)),w!==null&&(f.properties.gimbalPitch=Number(w))}}}),!a||!a.features||a.features.length===0)throw new Error("No features found in KML/WPML file.");let m=null;const p=t.file("waygen_session.json");if(p)try{const f=await p.async("text");m=JSON.parse(f)}catch(f){console.warn("Failed to parse session data:",f)}return{geojson:a,sessionData:m}}else throw new Error("No valid KML or WPML file found inside KMZ.")}catch(t){throw console.error("KMZ Parse Error:",t),new Error("Failed to unzip or parse KMZ.")}throw new Error("Unsupported file format. Please use .kml or .kmz")};function Qt({isOpen:e,onClose:t,onDownload:s,defaultFilename:i,defaultMissionEndAction:o}){const[a,r]=C.useState(""),[l,d]=C.useState("goHome"),[m,p]=C.useState("");C.useEffect(()=>{e&&(r(i),d(o),p(""))},[e,i,o]);const f=h=>h.replace(/[^a-zA-Z0-9_-]/g,"_").substring(0,100).trim(),u=h=>{const b=f(h.target.value);r(b),p(b.length===0?"Filename cannot be empty":"")},g=()=>{if(!a||a.length===0){p("Filename cannot be empty");return}s({filename:a,missionEndAction:l}),t()},y=h=>{h.key==="Escape"?t():h.key==="Enter"&&!m&&a&&g()};return e?n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t,children:n.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-96 max-w-full mx-4",onClick:h=>h.stopPropagation(),onKeyDown:y,children:[n.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[n.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"Export Mission"}),n.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:n.jsx(Ee,{size:20})})]}),n.jsxs("div",{className:"p-4 space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-bold text-gray-700 mb-2 block",children:"Mission End Action"}),n.jsxs("select",{value:l,onChange:h=>d(h.target.value),className:"w-full border rounded p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none",children:[n.jsx("option",{value:"goHome",children:"Return to Home"}),n.jsx("option",{value:"autoLand",children:"Hover"})]}),n.jsx("p",{className:"text-xs text-gray-500 mt-1",children:l==="goHome"?"Drone will return to launch point after mission":"Drone will hover at final waypoint"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-bold text-gray-700 mb-2 block",children:"File Name"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"text",value:a,onChange:u,className:`flex-1 border rounded p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none ${m?"border-red-500":""}`,placeholder:"Enter filename",autoFocus:!0}),n.jsx("span",{className:"text-sm text-gray-500 font-medium",children:".kmz"})]}),m&&n.jsx("p",{className:"text-xs text-red-500 mt-1",children:m}),n.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Allowed: letters, numbers, hyphens, underscores"})]})]}),n.jsxs("div",{className:"flex items-center justify-end gap-2 p-4 border-t bg-gray-50",children:[n.jsx("button",{onClick:t,className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 font-medium transition-colors",children:"Cancel"}),n.jsx("button",{onClick:g,disabled:!!m||!a,className:"px-4 py-2 bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-medium rounded text-sm transition-colors",children:"Download"})]})]})}):null}function en({isOpen:e,onClose:t,warningLevel:s,missionTime:i,droneName:o,maxFlightTime:a}){if(!e)return null;const r=s==="critical",d=r?et:tt,m=r?"text-red-500":"text-yellow-500",p=r?"bg-red-50":"bg-yellow-50",f=r?"border-red-200":"border-yellow-200",u=r?`Mission time (${i}) exceeds the ${o} maximum flight duration (~${a} minutes).`:`Mission time (${i}) is approaching the ${o} maximum flight duration (~${a} minutes).`;return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t,children:n.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-96 max-w-full mx-4",onClick:g=>g.stopPropagation(),children:[n.jsxs("div",{className:`flex items-center justify-between p-4 border-b ${f} ${p}`,children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(d,{size:24,className:m}),n.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"Flight Duration Warning"})]}),n.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:n.jsx(Ee,{size:20})})]}),n.jsxs("div",{className:"p-4 space-y-4",children:[n.jsx("p",{className:"text-sm text-gray-700",children:u}),n.jsxs("div",{className:`p-3 rounded border ${f} ${p}`,children:[n.jsx("p",{className:"text-sm font-bold text-gray-700 mb-2",children:"Consider:"}),n.jsxs("ul",{className:"text-sm text-gray-600 space-y-1.5 list-disc list-inside",children:[n.jsx("li",{children:"Reducing waypoint coverage area"}),n.jsx("li",{children:"Increasing spacing/overlap settings"}),n.jsx("li",{children:"Splitting into multiple missions"})]})]}),n.jsx("p",{className:"text-xs text-gray-500 italic",children:"You can proceed, but ensure sufficient battery for the mission."})]}),n.jsx("div",{className:"flex items-center justify-end gap-2 p-4 border-t bg-gray-50",children:n.jsx("button",{onClick:t,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded text-sm transition-colors",children:"OK, Got It"})})]})})}const Ye=3.28084,ee=(e,t)=>t==="metric"?e:Number((e*Ye).toFixed(2)),le=(e,t)=>t==="metric"?e:e/Ye;function tn({selectedWaypoints:e,selectedIds:t,settings:s,onUpdate:i,onDelete:o}){const[a,r]=C.useState({}),[l,d]=C.useState(!1);C.useEffect(()=>{if(e.length===0)return;const u=e[0],g=P=>P.straightenLegs!==void 0?P.straightenLegs.toString():s.straightenLegs?"true":"false",y=P=>P.action?P.action:s.waypointAction==="photo"?"photo":"none",h=g(u),b=y(u),w=P=>e.every(I=>I[P]===u[P]),A=(P,I)=>e.every(D=>P(D)===I),_={lat:t.length===1?u.lat:"",lng:t.length===1?u.lng:"",altitude:w("altitude")?ee(u.altitude,s.units):"",speed:w("speed")?ee(u.speed,s.units):"",gimbalPitch:w("gimbalPitch")?u.gimbalPitch:"",heading:w("heading")?u.heading:"",straightenLegs:A(g,h)?h:"mixed",action:A(y,b)?b:"mixed"};r(_),d(!1)},[t,e,s]);const m=(u,g)=>{r(y=>({...y,[u]:g})),d(!0)},p=()=>{const u={};t.length===1&&(u.lat=Number(a.lat),u.lng=Number(a.lng)),a.altitude!==""&&(u.altitude=le(Number(a.altitude),s.units)),a.speed!==""&&(u.speed=le(Number(a.speed),s.units)),a.gimbalPitch!==""&&(u.gimbalPitch=Number(a.gimbalPitch)),a.heading!==""&&(u.heading=Number(a.heading)),a.straightenLegs!=="mixed"&&(u.straightenLegs=a.straightenLegs==="true"),a.action!=="mixed"&&(u.action=a.action),i(u),d(!1)},f=t.length===1;return n.jsxs("div",{className:"p-4 bg-gray-50 h-full border-l w-80 flex flex-col shadow-xl z-10 overflow-y-auto",children:[n.jsxs("h2",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[n.jsx(Ae,{size:20})," Edit Selected (",t.length,")"]}),f&&n.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Lat"}),n.jsx("input",{type:"number",className:"border p-2 rounded w-full text-xs",value:a.lat,onChange:u=>m("lat",u.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Lng"}),n.jsx("input",{type:"number",className:"border p-2 rounded w-full text-xs",value:a.lng,onChange:u=>m("lng",u.target.value)})]})]}),n.jsxs("label",{className:"text-xs font-bold text-gray-500",children:["Altitude (",s.units==="metric"?"m":"ft",")"]}),n.jsx("input",{type:"number",className:"border p-2 rounded w-full mb-4",placeholder:a.altitude===""?"Mixed":"",value:a.altitude,onChange:u=>m("altitude",u.target.value)}),n.jsxs("label",{className:"text-xs font-bold text-gray-500",children:["Speed (",s.units==="metric"?"m/s":"ft/s",")"]}),n.jsx("input",{type:"number",className:"border p-2 rounded w-full mb-4",placeholder:a.speed===""?"Mixed":"",value:a.speed,onChange:u=>m("speed",u.target.value)}),n.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Gimbal Pitch (°)"}),n.jsx("input",{type:"number",className:"border p-2 rounded w-full mb-4",placeholder:a.gimbalPitch===""?"Mixed":"",value:a.gimbalPitch,onChange:u=>m("gimbalPitch",u.target.value)}),n.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Heading (°)"}),n.jsx("input",{type:"number",className:"border p-2 rounded w-full mb-4",placeholder:a.heading===""?"Mixed":"",value:a.heading,onChange:u=>m("heading",u.target.value)}),n.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Turn Mode"}),n.jsxs("select",{className:"border p-2 rounded w-full mb-4 text-sm bg-white",value:a.straightenLegs,onChange:u=>m("straightenLegs",u.target.value),children:[n.jsx("option",{value:"mixed",disabled:!0,hidden:!0,children:"Mixed"}),n.jsx("option",{value:"false",children:"Curved (Continuous)"}),n.jsx("option",{value:"true",children:"Straight (Stop & Turn)"})]}),n.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Action"}),n.jsxs("select",{className:"border p-2 rounded w-full mb-4 text-sm bg-white",value:a.action,onChange:u=>m("action",u.target.value),children:[n.jsx("option",{value:"mixed",disabled:!0,hidden:!0,children:"Mixed"}),n.jsx("option",{value:"none",children:"None"}),n.jsx("option",{value:"photo",children:"Take Photo"}),n.jsx("option",{value:"record_start",children:"Start Recording"}),n.jsx("option",{value:"record_stop",children:"Stop Recording"})]}),n.jsxs("div",{className:"mt-auto flex flex-col gap-2 pt-4",children:[n.jsxs("button",{onClick:p,disabled:!l,className:`w-full p-3 rounded-lg shadow-md flex items-center justify-center gap-2 transition-all font-bold text-white ${l?"bg-blue-600 hover:bg-blue-700":"bg-gray-400 cursor-not-allowed"}`,children:[n.jsx(nt,{size:18})," Update Point(s)"]}),n.jsxs("button",{onClick:o,className:"w-full bg-red-100 hover:bg-red-200 text-red-600 p-2 rounded flex items-center justify-center gap-2 transition-colors font-medium",children:[n.jsx(De,{size:16})," Delete Selected"]})]})]})}const ue=({title:e,icon:t,children:s,defaultOpen:i=!1})=>{const[o,a]=C.useState(i);return n.jsxs("div",{className:"border-b border-gray-100 last:border-0",children:[n.jsxs("button",{onClick:()=>a(!o),className:"w-full flex items-center justify-between p-3 hover:bg-gray-50 transition-colors",children:[n.jsxs("div",{className:"flex items-center gap-2 font-semibold text-gray-700",children:[n.jsx(t,{size:18,className:"text-blue-600"}),e]}),o?n.jsx(dt,{size:16,className:"text-gray-400"}):n.jsx(ut,{size:16,className:"text-gray-400"})]}),o&&n.jsx("div",{className:"p-3 pt-0 space-y-4 animate-in slide-in-from-top-2 duration-200",children:s})]})};function nn({currentPolygon:e,setCurrentPolygon:t}){var M,G,J;const{waypoints:s,selectedIds:i,settings:o,setWaypoints:a,updateSelectedWaypoints:r,deleteSelectedWaypoints:l,undo:d,redo:m,updateSettings:p,resetMission:f,fitMapToWaypoints:u,currentMissionFilename:g,setMissionFilename:y,calculatedMaxSpeed:h,minSegmentDistance:b}=B(),[w,A]=C.useState(!1),[_,P]=C.useState(!1),[I,D]=C.useState({warning:!1,critical:!1}),V=()=>{confirm("Are you sure you want to reset the mission? This will clear all waypoints and shapes.")&&(f(),t(null))},U=()=>{window.mapboxDraw&&window.mapboxDraw.changeMode("simple_select");let c=e;if(window.mapboxDraw){const xe=window.mapboxDraw.getSelected();if(xe.features.length>0)c=xe.features[0],t&&t(c);else if(e&&e.id){const be=window.mapboxDraw.get(e.id);be&&(c=be)}}if(!c)return alert("Draw a shape first!");const v=Te(c,o),j=Y(o.selectedDrone),E=(j==null?void 0:j.photoInterval)||5.5,{maxSpeed:F}=Oe(v,E),S={...o,speed:F>0?F:o.speed},se=Te(c,S);a(se),setTimeout(()=>{B.getState().calculateMissionMetrics()},50)},N=async c=>{const v=c.target.files[0];if(v)try{const{geojson:j,sessionData:E}=await Xt(v),F=[];if(j.features.forEach(S=>{S.geometry.type==="Point"&&F.push({id:ne(),lng:S.geometry.coordinates[0],lat:S.geometry.coordinates[1],altitude:S.properties.altitude!==void 0?S.properties.altitude:o.altitude,speed:S.properties.speed!==void 0?S.properties.speed:o.speed,gimbalPitch:S.properties.gimbalPitch!==void 0?S.properties.gimbalPitch:o.gimbalPitch,heading:S.properties.heading!==void 0?S.properties.heading:0})}),F.length>0){a(F),E?(console.log("Restoring session data:",E),E.settings&&p(E.settings),E.polygon&&t?(console.log("Dispatching restore-polygon event",E.polygon),t(E.polygon),window.dispatchEvent(new CustomEvent("waygen:restore-polygon",{detail:E.polygon}))):console.warn("No polygon in session data or setCurrentPolygon missing",{polygon:E.polygon,fn:!!t}),alert(`Imported ${F.length} waypoints and restored session!`)):alert(`Imported ${F.length} waypoints!`);const S=v.name.replace(/\.(kmz|kml)$/i,"");y(S),setTimeout(()=>{u(),B.getState().calculateMissionMetrics()},100)}else alert("No waypoints found in file.")}catch(j){console.error(j),alert("Failed to parse file. Ensure it is a valid KML/KMZ.")}},$=()=>g||`waygen_${new Date().toISOString().replace(/[-:]/g,"").replace(/\..+/,"").replace("T","_").substring(0,15)}`,K=()=>{A(!0)},x=({filename:c,missionEndAction:v})=>{p({missionEndAction:v}),Dt(s,o,c,{settings:o,polygon:e})},L=c=>{if(c.length<2)return 0;let v=0;for(let j=0;j<c.length-1;j++){const E=O([c[j].lng,c[j].lat]),F=O([c[j+1].lng,c[j+1].lat]);v+=te(E,F,{units:"meters"})}return v},T=c=>{const v=Math.floor(c/60),j=c%60;return`${v}:${j.toString().padStart(2,"0")}`},k=(c,v)=>{if(v==="metric")return c>=1e3?`${(c/1e3).toFixed(2)} km`:`${Math.round(c)} m`;{const j=c*3.28084;return j>=5280?`${(j/5280).toFixed(2)} mi`:`${Math.round(j)} ft`}};if(i.length>0){const c=s.filter(v=>i.includes(v.id));return n.jsx(tn,{selectedWaypoints:c,selectedIds:i,settings:o,onUpdate:r,onDelete:l})}return n.jsxs("div",{className:"bg-white h-full border-l w-80 flex flex-col shadow-xl z-10 flex-shrink-0",children:[n.jsxs("div",{className:"p-4 border-b flex justify-between items-center bg-gray-50",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"font-bold text-xl text-gray-800",children:"Waygen"}),g&&n.jsx("div",{className:"text-sm text-gray-500 truncate max-w-[200px]",title:g,children:g})]}),n.jsxs("div",{className:"flex gap-1",children:[n.jsx("button",{onClick:V,className:"p-2 hover:bg-red-100 hover:text-red-600 rounded-full shadow-sm border transition-all",title:"Reset Mission",children:n.jsx(De,{size:16})}),n.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1 self-center"}),n.jsx("button",{onClick:d,className:"p-2 hover:bg-white rounded-full shadow-sm border transition-all",children:n.jsx(st,{size:16})}),n.jsx("button",{onClick:m,className:"p-2 hover:bg-white rounded-full shadow-sm border transition-all",children:n.jsx(ot,{size:16})})]})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[n.jsx("div",{className:"p-3",children:n.jsxs("label",{className:"flex items-center justify-center gap-2 w-full p-2 bg-blue-50 text-blue-700 rounded-lg border border-blue-100 hover:bg-blue-100 transition-colors cursor-pointer font-medium text-sm",children:[n.jsx(it,{size:16})," Import KML/KMZ",n.jsx("input",{type:"file",onChange:N,className:"hidden",accept:".kml,.kmz"})]})}),n.jsxs(ue,{title:"Basics",icon:Ae,defaultOpen:!0,children:[n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Units"}),n.jsxs("select",{value:o.units,onChange:c=>p({units:c.target.value}),className:"w-full border rounded p-1.5 text-sm bg-gray-50 focus:ring-2 focus:ring-blue-500 outline-none",children:[n.jsx("option",{value:"metric",children:"Metric (m)"}),n.jsx("option",{value:"imperial",children:"Imperial (ft)"})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Altitude (",o.units==="metric"?"m":"ft",")"]}),n.jsx("input",{type:"number",value:ee(o.altitude,o.units),onChange:c=>p({altitude:le(Number(c.target.value),o.units)}),className:"w-full border rounded p-1.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none"})]})]}),n.jsxs("div",{className:"mt-4 border-t pt-3",children:[n.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Drone Model (FOV)"}),n.jsxs("select",{value:o.selectedDrone,onChange:c=>{const v=c.target.value;let j=82.1;v==="dji_mini_5_pro"&&(j=84),v==="dji_mavic_4_pro"&&(j=72),v==="custom"&&(j=o.customFOV),p({selectedDrone:v,customFOV:j})},className:"w-full border rounded p-1.5 text-sm bg-gray-50 focus:ring-2 focus:ring-blue-500 outline-none",children:[n.jsx("option",{value:"dji_mini_4_pro",children:"DJI Mini 4 Pro (82.1°)"}),n.jsx("option",{value:"dji_mini_5_pro",children:"DJI Mini 5 Pro (84°)"}),n.jsx("option",{value:"dji_mavic_4_pro",children:"DJI Mavic 4 Pro (72°)"}),n.jsx("option",{value:"custom",children:"Custom"})]})]}),n.jsxs("div",{className:"mt-2",children:[n.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Photo Interval"}),n.jsxs("div",{className:"text-sm text-gray-700 bg-gray-50 border rounded p-1.5",children:[((M=Y(o.selectedDrone))==null?void 0:M.photoInterval)||5.5," seconds"]})]}),o.selectedDrone==="custom"&&n.jsxs("div",{className:"mt-2",children:[n.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Custom HFOV (°)"}),n.jsx("input",{type:"number",value:o.customFOV,onChange:c=>p({customFOV:Number(c.target.value)}),className:"w-full border rounded p-1.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none"})]})]}),n.jsxs(ue,{title:"Coverage",icon:at,defaultOpen:!0,children:[n.jsxs("div",{className:"mb-3",children:[n.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Path Type"}),n.jsxs("div",{className:"flex bg-gray-100 p-1 rounded-lg",children:[n.jsx("button",{onClick:()=>p({pathType:"grid"}),className:`flex-1 py-1 text-xs font-bold rounded-md transition-all ${o.pathType==="grid"?"bg-white shadow text-blue-600":"text-gray-500 hover:text-gray-700"}`,children:"Grid"}),n.jsx("button",{onClick:()=>p({pathType:"orbit",spacing:10}),className:`flex-1 py-1 text-xs font-bold rounded-md transition-all ${o.pathType==="orbit"?"bg-white shadow text-blue-600":"text-gray-500 hover:text-gray-700"}`,children:"Orbit"})]})]}),o.pathType==="grid"?n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Side Overlap ",o.sideOverlap,"%"]}),n.jsx("input",{type:"range",min:"0",max:"90",value:o.sideOverlap,onChange:c=>p({sideOverlap:Number(c.target.value)}),className:"w-full accent-blue-600"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Front Overlap ",o.frontOverlap,"%"]}),n.jsx("input",{type:"range",min:"0",max:"90",value:o.frontOverlap,onChange:c=>p({frontOverlap:Number(c.target.value)}),className:"w-full accent-blue-600"})]}),n.jsxs("div",{className:"flex items-center justify-between mt-2",children:[n.jsx("label",{className:"text-sm text-gray-700",children:"Auto Path Angle"}),n.jsx("input",{type:"checkbox",checked:o.autoDirection,onChange:c=>p({autoDirection:c.target.checked}),className:"accent-blue-600 w-4 h-4"})]}),n.jsxs("div",{className:`mt-2 transition-opacity ${o.autoDirection?"opacity-50":"opacity-100"}`,children:[n.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Path Angle ",o.angle,"°"]}),n.jsx("input",{type:"range",min:"0",max:"360",value:o.angle,onChange:c=>p({angle:Number(c.target.value)}),disabled:o.autoDirection,className:`w-full ${o.autoDirection?"accent-gray-400 cursor-not-allowed":"accent-blue-600"}`})]})]}):n.jsx("div",{className:"space-y-3",children:n.jsxs("div",{children:[n.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Spacing (",o.units==="metric"?"m":"ft",")"]}),n.jsx("input",{type:"number",min:"1",value:ee(o.spacing,o.units),onChange:c=>p({spacing:le(Number(c.target.value),o.units)}),className:"w-full border rounded p-1.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none"}),n.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Distance between waypoints along the perimeter."})]})}),n.jsxs("div",{className:"flex items-center justify-between mt-2",children:[n.jsx("label",{className:"text-sm text-gray-700",children:"Reverse Path"}),n.jsx("input",{type:"checkbox",checked:o.reversePath,onChange:c=>p({reversePath:c.target.checked}),className:"accent-blue-600 w-4 h-4"})]}),n.jsxs("div",{className:"flex items-center justify-between mt-3",children:[n.jsx("label",{className:"text-sm text-gray-700",children:"Straighten Legs"}),n.jsx("input",{type:"checkbox",checked:o.straightenLegs,onChange:c=>p({straightenLegs:c.target.checked}),className:"accent-blue-600 w-4 h-4"})]}),n.jsxs("div",{className:"flex items-center justify-between mt-3",children:[n.jsx("label",{className:"text-sm text-gray-700",children:"Generate Every Point"}),n.jsx("input",{type:"checkbox",checked:o.generateEveryPoint,onChange:c=>p({generateEveryPoint:c.target.checked}),className:"accent-blue-600 w-4 h-4"})]}),n.jsxs("div",{className:"flex items-center justify-between mt-3",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("label",{className:"text-sm text-gray-700",children:"Show Image Footprints"}),o.showFootprints&&n.jsx("input",{type:"color",value:o.footprintColor,onChange:c=>p({footprintColor:c.target.value}),className:"w-4 h-4 rounded border border-gray-300 cursor-pointer",title:"Choose footprint color"})]}),n.jsx("input",{type:"checkbox",checked:o.showFootprints,onChange:c=>p({showFootprints:c.target.checked}),className:"accent-blue-600 w-4 h-4"})]})]}),n.jsxs(ue,{title:"Camera",icon:rt,defaultOpen:!0,children:[n.jsxs("div",{children:[n.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Gimbal Pitch ",o.gimbalPitch,"°"]}),n.jsx("input",{type:"range",min:"-90",max:"0",value:o.gimbalPitch,onChange:c=>p({gimbalPitch:Number(c.target.value)}),className:"w-full accent-blue-600"})]}),n.jsxs("div",{className:"mt-2",children:[n.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Action per Waypoint"}),n.jsxs("select",{value:o.waypointAction,onChange:c=>p({waypointAction:c.target.value}),className:"w-full border rounded p-1.5 text-sm bg-gray-50 focus:ring-2 focus:ring-blue-500 outline-none",children:[n.jsx("option",{value:"none",children:"No Action"}),n.jsx("option",{value:"photo",children:"Take Photo"}),n.jsx("option",{value:"record",children:"Start/Stop Recording"})]})]})]})]}),n.jsxs("div",{className:"p-4 border-t bg-gray-50",children:[n.jsxs("button",{onClick:U,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold p-3 rounded-lg shadow-md mb-3 flex items-center justify-center gap-2 transition-all transform active:scale-95",children:[n.jsx(lt,{size:18})," Generate Path"]}),n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsxs("div",{className:"bg-white border rounded p-2 text-center",children:[n.jsx("div",{className:"text-xs text-gray-400 font-bold uppercase",children:"Waypoints"}),n.jsx("div",{className:"font-bold text-gray-700",children:s.length})]}),n.jsxs("div",{className:"bg-white border rounded p-2 text-center",children:[n.jsx("div",{className:"text-xs text-gray-400 font-bold uppercase",children:"Distance"}),n.jsx("div",{className:"font-bold text-gray-700",children:s.length>=2?k(L(s),o.units):o.units==="metric"?"0 m":"0 ft"})]}),n.jsxs("div",{className:"bg-white border rounded p-2 text-center",children:[n.jsx("div",{className:"text-xs text-gray-400 font-bold uppercase",children:"Max Speed"}),n.jsx("div",{className:"font-bold text-gray-700",title:`Based on ${Math.round(b)}m minimum segment`,children:s.length>=2&&h>0?`${ee(h,o.units).toFixed(1)} ${o.units==="metric"?"m/s":"ft/s"}`:o.units==="metric"?"0 m/s":"0 ft/s"})]}),n.jsxs("div",{className:`bg-white border rounded p-2 text-center ${(()=>{const c=B.getState().getFlightWarningLevel();return c==="critical"?"border-red-500 bg-red-50":c==="warning"?"border-yellow-500 bg-yellow-50":""})()}`,children:[n.jsx("div",{className:"text-xs text-gray-400 font-bold uppercase",children:"Est. Time"}),n.jsx("div",{className:`font-bold ${(()=>{const c=B.getState().getFlightWarningLevel();return c==="critical"?"text-red-600":c==="warning"?"text-yellow-700":"text-gray-700"})()}`,children:s.length>=2&&h>0?(()=>{const c=B.getState().getMissionTime(),v=B.getState().getFlightWarningLevel(),j=T(c),E=v==="critical"?" 🔴":v==="warning"?" ⚠️":"";return v!=="safe"&&!I[v]&&setTimeout(()=>{P(!0),D(F=>({...F,[v]:!0}))},500),n.jsxs("span",{title:`${c}s total`,children:[j,E]})})():"0:00"})]})]}),n.jsxs("button",{onClick:K,disabled:s.length===0,className:"w-full mt-3 bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold p-3 rounded-lg shadow-md flex items-center justify-center gap-2 transition-all",children:[n.jsx(ct,{size:18})," Download KMZ"]})]}),n.jsx(Qt,{isOpen:w,onClose:()=>A(!1),onDownload:x,defaultFilename:$(),defaultMissionEndAction:o.missionEndAction}),n.jsx(en,{isOpen:_,onClose:()=>P(!1),warningLevel:B.getState().getFlightWarningLevel(),missionTime:s.length>=2?T(B.getState().getMissionTime()):"0:00",droneName:((G=Y(o.selectedDrone))==null?void 0:G.name)||"Unknown Drone",maxFlightTime:((J=Y(o.selectedDrone))==null?void 0:J.maxFlightTime)||0})]})}const sn=ce.lazy(()=>_e(()=>import("./SearchBar-BJmMKYcZ.js"),__vite__mapDeps([0,1,2,3,4,5]))),on=ce.lazy(()=>_e(()=>import("./MapContainer-Bzw1DrOP.js"),__vite__mapDeps([6,1,2,3,4,7,5])));function an(){const[e,t]=C.useState(null),[s,i]=C.useState(!0);return ce.useEffect(()=>{const o=setTimeout(()=>i(!1),1e3);return()=>clearTimeout(o)},[]),s?n.jsx("div",{className:"flex h-screen w-screen items-center justify-center bg-gray-50",children:n.jsx("div",{className:"text-2xl font-bold text-blue-600 animate-pulse",children:"Waygen Loading..."})}):n.jsxs("div",{className:"flex h-screen w-screen overflow-hidden",children:[n.jsxs("div",{className:"relative flex-grow",children:[n.jsx(C.Suspense,{fallback:null,children:n.jsx(sn,{})}),n.jsx(C.Suspense,{fallback:n.jsx("div",{className:"flex h-full w-full items-center justify-center bg-gray-100",children:n.jsx("div",{className:"text-lg font-semibold text-gray-500",children:"Loading Map..."})}),children:n.jsx(on,{onPolygonDrawn:t,polygon:e})})]}),n.jsx(nn,{currentPolygon:e,setCurrentPolygon:t})]})}me.createRoot(document.getElementById("root")).render(n.jsx(ce.StrictMode,{children:n.jsx(an,{})}));export{un as c,n as j,B as u};
