import{r as K,a as np,c as ip,M as op,P as ap,S as sp,H as lp,C as cp,T as Ro,X as _c,b as up,A as fp,d as Ec,e as dp,U as pp,R as hp,f as gp,g as yp,h as mp,i as vp,D as bp,j as wp,k as Tp,l as Ac}from"./vendor-DxhCFG8H.js";import{b as Sp,i as Do,d as Ic,g as Bo,m as or,M as Cc,e as La}from"./mapbox-DsDS3Pos.js";import{c as Y,s as yt,g as cn,a as Lt,b as rt,t as z,_ as Rt,f as Dt,d as jo,e as ne,h as mt,p as Bt,r as $c,i as Ke,j as xp,k as Nc,l as _p,m as Oc,n as Ep,o as Pc,q as fr,u as Mc,v as Fc,w as Ap,x as Lc,y as Ip,z as Cp,A as $p,B as ve,C as rr,D as Np,E as tt,F as Vr,G as ar,H as Ra,I as Rc,J as Da,K as Ba,L as Op,M as ja,N as ka,O as Pp,P as Ua}from"./turf-Cms7wwZS.js";import{c as Mp,J as Dc,F as Fp}from"./utils-DhIfZSrG.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=r(i);fetch(i.href,o)}})();var Bc={exports:{}},un={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lp=K,Rp=Symbol.for("react.element"),Dp=Symbol.for("react.fragment"),Bp=Object.prototype.hasOwnProperty,jp=Lp.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,kp={key:!0,ref:!0,__self:!0,__source:!0};function jc(e,t,r){var n,i={},o=null,a=null;r!==void 0&&(o=""+r),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(a=t.ref);for(n in t)Bp.call(t,n)&&!kp.hasOwnProperty(n)&&(i[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)i[n]===void 0&&(i[n]=t[n]);return{$$typeof:Rp,type:e,key:o,ref:a,props:i,_owner:jp.current}}un.Fragment=Dp;un.jsx=jc;un.jsxs=jc;Bc.exports=un;var p=Bc.exports,fo={},Ga=np;fo.createRoot=Ga.createRoot,fo.hydrateRoot=Ga.hydrateRoot;var ko={exports:{}};const Up=function(e,t){const r={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},n={on:function(o,a,s){if(r[o]===void 0)throw new Error(`Invalid event type: ${o}`);r[o].push({selector:a,fn:s})},render:function(o){t.store.featureChanged(o)}},i=function(o,a){const s=r[o];let l=s.length;for(;l--;){const h=s[l];if(h.selector(a)){h.fn.call(n,a),t.store.render(),t.ui.updateMapClasses();break}}};return e.start.call(n),{render:e.render,stop:function(){e.stop&&e.stop()},trash:function(){e.trash&&(e.trash(),t.store.render())},combineFeatures:function(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures:function(){e.uncombineFeatures&&e.uncombineFeatures()},drag:function(o){i("drag",o)},click:function(o){i("click",o)},mousemove:function(o){i("mousemove",o)},mousedown:function(o){i("mousedown",o)},mouseup:function(o){i("mouseup",o)},mouseout:function(o){i("mouseout",o)},keydown:function(o){i("keydown",o)},keyup:function(o){i("keyup",o)},touchstart:function(o){i("touchstart",o)},touchmove:function(o){i("touchmove",o)},touchend:function(o){i("touchend",o)},tap:function(o){i("tap",o)}}};var Gp=Up,J={classes:{CONTROL_BASE:"mapboxgl-ctrl",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},sources:{HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},cursors:{ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},types:{POLYGON:"polygon",LINE:"line_string",POINT:"point"},geojsonTypes:{FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},modes:{DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},events:{CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},updateActions:{MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},meta:{FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},activeStates:{ACTIVE:"true",INACTIVE:"false"},interactions:["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],LAT_MIN:-90,LAT_RENDERED_MIN:-85,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270};const qp=Sp,po=J,qa={Point:0,LineString:1,Polygon:2};function Vp(e,t){const r=qa[e.geometry.type]-qa[t.geometry.type];return r===0&&e.geometry.type===po.geojsonTypes.POLYGON?e.area-t.area:r}function Wp(e){return e.map(t=>(t.geometry.type===po.geojsonTypes.POLYGON&&(t.area=qp.geometry({type:po.geojsonTypes.FEATURE,property:{},geometry:t.geometry})),t)).sort(Vp).map(t=>(delete t.area,t))}var zp=Wp;function Hp(e,t=0){return[[e.point.x-t,e.point.y-t],[e.point.x+t,e.point.y+t]]}var Kp=Hp;function jt(e){if(this._items={},this._nums={},this._length=e?e.length:0,!!e)for(let t=0,r=e.length;t<r;t++)this.add(e[t]),e[t]!==void 0&&(typeof e[t]=="string"?this._items[e[t]]=t:this._nums[e[t]]=t)}jt.prototype.add=function(e){return this.has(e)?this:(this._length++,typeof e=="string"?this._items[e]=this._length:this._nums[e]=this._length,this)};jt.prototype.delete=function(e){return this.has(e)===!1?this:(this._length--,delete this._items[e],delete this._nums[e],this)};jt.prototype.has=function(e){return typeof e!="string"&&typeof e!="number"?!1:this._items[e]!==void 0||this._nums[e]!==void 0};jt.prototype.values=function(){const e=[];return Object.keys(this._items).forEach(t=>{e.push({k:t,v:this._items[t]})}),Object.keys(this._nums).forEach(t=>{e.push({k:JSON.parse(t),v:this._nums[t]})}),e.sort((t,r)=>t.v-r.v).map(t=>t.k)};jt.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var fn=jt;const Jp=zp,Yp=Kp,jn=J,Zp=fn,Xp=[jn.meta.FEATURE,jn.meta.MIDPOINT,jn.meta.VERTEX];var dn={click:Qp,touch:eh};function Qp(e,t,r){return kc(e,t,r,r.options.clickBuffer)}function eh(e,t,r){return kc(e,t,r,r.options.touchBuffer)}function kc(e,t,r,n){if(r.map===null)return[];const i=e?Yp(e,n):t,o={};r.options.styles&&(o.layers=r.options.styles.map(h=>h.id));const a=r.map.queryRenderedFeatures(i,o).filter(h=>Xp.indexOf(h.properties.meta)!==-1),s=new Zp,l=[];return a.forEach(h=>{const g=h.properties.id;s.has(g)||(s.add(g),l.push(h))}),Jp(l)}const th=dn,Qt=J;var rh=function(t,r){const n=th.click(t,null,r),i={mouse:Qt.cursors.NONE};return n[0]&&(i.mouse=n[0].properties.active===Qt.activeStates.ACTIVE?Qt.cursors.MOVE:Qt.cursors.POINTER,i.feature=n[0].properties.meta),r.events.currentModeName().indexOf("draw")!==-1&&(i.mouse=Qt.cursors.ADD),r.ui.queueMapClasses(i),r.ui.updateMapClasses(),n[0]},Uc=function(e,t){const r=e.x-t.x,n=e.y-t.y;return Math.sqrt(r*r+n*n)};const nh=Uc,ih=4,oh=12,ah=500;var sh=function(t,r,n={}){const i=n.fineTolerance!=null?n.fineTolerance:ih,o=n.grossTolerance!=null?n.grossTolerance:oh,a=n.interval!=null?n.interval:ah;t.point=t.point||r.point,t.time=t.time||r.time;const s=nh(t.point,r.point);return s<i||s<o&&r.time-t.time<a};const lh=Uc,ch=25,uh=250;var fh=function(t,r,n={}){const i=n.tolerance!=null?n.tolerance:ch,o=n.interval!=null?n.interval:uh;return t.point=t.point||r.point,t.time=t.time||r.time,lh(t.point,r.point)<i&&r.time-t.time<o},Gc={exports:{}},qc={exports:{}},Vc={exports:{}},ho=Vc.exports=function(e,t){if(t||(t=16),e===void 0&&(e=128),e<=0)return"0";for(var r=Math.log(Math.pow(2,e))/Math.log(t),n=2;r===1/0;n*=2)r=Math.log(Math.pow(2,e/n))/Math.log(t)*n;for(var i=r-Math.floor(r),o="",n=0;n<Math.floor(r);n++){var a=Math.floor(Math.random()*t).toString(t);o=a+o}if(i){var s=Math.pow(t,i),a=Math.floor(Math.random()*s).toString(t);o=a+o}var l=parseInt(o,t);return l!==1/0&&l>=Math.pow(2,e)?ho(e,t):o};ho.rack=function(e,t,r){var n=function(o){var a=0;do{if(a++>10)if(r)e+=r;else throw new Error("too many ID collisions, use more bits");var s=ho(e,t)}while(Object.hasOwnProperty.call(i,s));return i[s]=o,s},i=n.hats={};return n.get=function(o){return n.hats[o]},n.set=function(o,a){return n.hats[o]=a,n},n.bits=e||128,n.base=t||16,n};var Uo=Vc.exports;const dh=Uo,Dr=J,nt=function(e,t){this.ctx=e,this.properties=t.properties||{},this.coordinates=t.geometry.coordinates,this.id=t.id||dh(),this.type=t.geometry.type};nt.prototype.changed=function(){this.ctx.store.featureChanged(this.id)};nt.prototype.incomingCoords=function(e){this.setCoordinates(e)};nt.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};nt.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))};nt.prototype.setProperty=function(e,t){this.properties[e]=t};nt.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:Dr.geojsonTypes.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))};nt.prototype.internal=function(e){const t={id:this.id,meta:Dr.meta.FEATURE,"meta:type":this.type,active:Dr.activeStates.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(const r in this.properties)t[`user_${r}`]=this.properties[r];return{type:Dr.geojsonTypes.FEATURE,properties:t,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var pn=nt;const Wc=pn,dr=function(e,t){Wc.call(this,e,t)};dr.prototype=Object.create(Wc.prototype);dr.prototype.isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"};dr.prototype.updateCoordinate=function(e,t,r){arguments.length===3?this.coordinates=[t,r]:this.coordinates=[e,t],this.changed()};dr.prototype.getCoordinate=function(){return this.getCoordinates()};var Go=dr;const zc=pn,vt=function(e,t){zc.call(this,e,t)};vt.prototype=Object.create(zc.prototype);vt.prototype.isValid=function(){return this.coordinates.length>1};vt.prototype.addCoordinate=function(e,t,r){this.changed();const n=parseInt(e,10);this.coordinates.splice(n,0,[t,r])};vt.prototype.getCoordinate=function(e){const t=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[t]))};vt.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)};vt.prototype.updateCoordinate=function(e,t,r){const n=parseInt(e,10);this.coordinates[n]=[t,r],this.changed()};var qo=vt;const Hc=pn,Ue=function(e,t){Hc.call(this,e,t),this.coordinates=this.coordinates.map(r=>r.slice(0,-1))};Ue.prototype=Object.create(Hc.prototype);Ue.prototype.isValid=function(){return this.coordinates.length===0?!1:this.coordinates.every(e=>e.length>2)};Ue.prototype.incomingCoords=function(e){this.coordinates=e.map(t=>t.slice(0,-1)),this.changed()};Ue.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};Ue.prototype.addCoordinate=function(e,t,r){this.changed();const n=e.split(".").map(o=>parseInt(o,10));this.coordinates[n[0]].splice(n[1],0,[t,r])};Ue.prototype.removeCoordinate=function(e){this.changed();const t=e.split(".").map(n=>parseInt(n,10)),r=this.coordinates[t[0]];r&&(r.splice(t[1],1),r.length<3&&this.coordinates.splice(t[0],1))};Ue.prototype.getCoordinate=function(e){const t=e.split(".").map(n=>parseInt(n,10)),r=this.coordinates[t[0]];return JSON.parse(JSON.stringify(r[t[1]]))};Ue.prototype.getCoordinates=function(){return this.coordinates.map(e=>e.concat([e[0]]))};Ue.prototype.updateCoordinate=function(e,t,r){this.changed();const n=e.split("."),i=parseInt(n[0],10),o=parseInt(n[1],10);this.coordinates[i]===void 0&&(this.coordinates[i]=[]),this.coordinates[i][o]=[t,r]};var Vo=Ue;const Kc=pn,Jc=J,ph=Uo,hh={MultiPoint:Go,MultiLineString:qo,MultiPolygon:Vo},hn=(e,t,r,n,i)=>{const o=r.split("."),a=parseInt(o[0],10),s=o[1]?o.slice(1).join("."):null;return e[a][t](s,n,i)},Me=function(e,t){if(Kc.call(this,e,t),delete this.coordinates,this.model=hh[t.geometry.type],this.model===void 0)throw new TypeError(`${t.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(t.geometry.coordinates)};Me.prototype=Object.create(Kc.prototype);Me.prototype._coordinatesToFeatures=function(e){const t=this.model.bind(this);return e.map(r=>new t(this.ctx,{id:ph(),type:Jc.geojsonTypes.FEATURE,properties:{},geometry:{coordinates:r,type:this.type.replace("Multi","")}}))};Me.prototype.isValid=function(){return this.features.every(e=>e.isValid())};Me.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()};Me.prototype.getCoordinate=function(e){return hn(this.features,"getCoordinate",e)};Me.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(e=>e.type===Jc.geojsonTypes.POLYGON?e.getCoordinates():e.coordinates)))};Me.prototype.updateCoordinate=function(e,t,r){hn(this.features,"updateCoordinate",e,t,r),this.changed()};Me.prototype.addCoordinate=function(e,t,r){hn(this.features,"addCoordinate",e,t,r),this.changed()};Me.prototype.removeCoordinate=function(e){hn(this.features,"removeCoordinate",e),this.changed()};Me.prototype.getFeatures=function(){return this.features};var Br=Me;const Ot=J,gh=dn,Yc=Go,Zc=qo,Xc=Vo,Qc=Br,se=qc.exports=function(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e};se.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)};se.prototype.setSelectedCoordinates=function(e){this._ctx.store.setSelectedCoordinates(e),e.reduce((t,r)=>(t[r.feature_id]===void 0&&(t[r.feature_id]=!0,this._ctx.store.get(r.feature_id).changed()),t),{})};se.prototype.getSelected=function(){return this._ctx.store.getSelected()};se.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()};se.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)};se.prototype.getFeature=function(e){return this._ctx.store.get(e)};se.prototype.select=function(e){return this._ctx.store.select(e)};se.prototype.deselect=function(e){return this._ctx.store.deselect(e)};se.prototype.deleteFeature=function(e,t={}){return this._ctx.store.delete(e,t)};se.prototype.addFeature=function(e){return this._ctx.store.add(e)};se.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()};se.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()};se.prototype.setActionableState=function(e={}){const t={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(t)};se.prototype.changeMode=function(e,t={},r={}){return this._ctx.events.changeMode(e,t,r)};se.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)};se.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)};se.prototype.featuresAt=function(e,t,r="click"){if(r!=="click"&&r!=="touch")throw new Error("invalid buffer type");return gh[r](e,t,this._ctx)};se.prototype.newFeature=function(e){const t=e.geometry.type;return t===Ot.geojsonTypes.POINT?new Yc(this._ctx,e):t===Ot.geojsonTypes.LINE_STRING?new Zc(this._ctx,e):t===Ot.geojsonTypes.POLYGON?new Xc(this._ctx,e):new Qc(this._ctx,e)};se.prototype.isInstanceOf=function(e,t){if(e===Ot.geojsonTypes.POINT)return t instanceof Yc;if(e===Ot.geojsonTypes.LINE_STRING)return t instanceof Zc;if(e===Ot.geojsonTypes.POLYGON)return t instanceof Xc;if(e==="MultiFeature")return t instanceof Qc;throw new Error(`Unknown feature class: ${e}`)};se.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)};var yh=qc.exports;const fe=Gc.exports=yh;fe.prototype.onSetup=function(){};fe.prototype.onDrag=function(){};fe.prototype.onClick=function(){};fe.prototype.onMouseMove=function(){};fe.prototype.onMouseDown=function(){};fe.prototype.onMouseUp=function(){};fe.prototype.onMouseOut=function(){};fe.prototype.onKeyUp=function(){};fe.prototype.onKeyDown=function(){};fe.prototype.onTouchStart=function(){};fe.prototype.onTouchMove=function(){};fe.prototype.onTouchEnd=function(){};fe.prototype.onTap=function(){};fe.prototype.onStop=function(){};fe.prototype.onTrash=function(){};fe.prototype.onCombineFeature=function(){};fe.prototype.onUncombineFeature=function(){};fe.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var mh=Gc.exports;const vh=mh,eu={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},bh=Object.keys(eu);var wh=function(e){const t=Object.keys(e);return function(r,n={}){let i={};const o=t.reduce((s,l)=>(s[l]=e[l],s),new vh(r));function a(s){return function(l){o[s](i,l)}}return{start:function(){i=o.onSetup(n),bh.forEach(s=>{const l=eu[s];let h=()=>!1;e[l]&&(h=()=>!0),this.on(s,h,a(l))})},stop:function(){o.onStop(i)},trash:function(){o.onTrash(i)},combineFeatures:function(){o.onCombineFeatures(i)},uncombineFeatures:function(){o.onUncombineFeatures(i)},render:function(s,l){o.toDisplayFeatures(i,s,l)}}}};const Va=Gp,kn=rh,Wa=dn,za=sh,Ha=fh,xt=J,Th=wh;var Sh=function(e){const t=Object.keys(e.options.modes).reduce((u,f)=>(u[f]=Th(e.options.modes[f]),u),{});let r={},n={};const i={};let o=null,a=null;i.drag=function(u,f){f({point:u.point,time:new Date().getTime()})?(e.ui.queueMapClasses({mouse:xt.cursors.DRAG}),a.drag(u)):u.originalEvent.stopPropagation()},i.mousedrag=function(u){i.drag(u,f=>!za(r,f))},i.touchdrag=function(u){i.drag(u,f=>!Ha(n,f))},i.mousemove=function(u){if((u.originalEvent.buttons!==void 0?u.originalEvent.buttons:u.originalEvent.which)===1)return i.mousedrag(u);const b=kn(u,e);u.featureTarget=b,a.mousemove(u)},i.mousedown=function(u){r={time:new Date().getTime(),point:u.point};const f=kn(u,e);u.featureTarget=f,a.mousedown(u)},i.mouseup=function(u){const f=kn(u,e);u.featureTarget=f,za(r,{point:u.point,time:new Date().getTime()})?a.click(u):a.mouseup(u)},i.mouseout=function(u){a.mouseout(u)},i.touchstart=function(u){if(u.originalEvent.preventDefault(),!e.options.touchEnabled)return;n={time:new Date().getTime(),point:u.point};const f=Wa.touch(u,null,e)[0];u.featureTarget=f,a.touchstart(u)},i.touchmove=function(u){if(u.originalEvent.preventDefault(),!!e.options.touchEnabled)return a.touchmove(u),i.touchdrag(u)},i.touchend=function(u){if(u.originalEvent.preventDefault(),!e.options.touchEnabled)return;const f=Wa.touch(u,null,e)[0];u.featureTarget=f,Ha(n,{time:new Date().getTime(),point:u.point})?a.tap(u):a.touchend(u)};const s=u=>!(u===8||u===46||u>=48&&u<=57);i.keydown=function(u){(u.srcElement||u.target).classList[0]==="mapboxgl-canvas"&&((u.keyCode===8||u.keyCode===46)&&e.options.controls.trash?(u.preventDefault(),a.trash()):s(u.keyCode)?a.keydown(u):u.keyCode===49&&e.options.controls.point?l(xt.modes.DRAW_POINT):u.keyCode===50&&e.options.controls.line_string?l(xt.modes.DRAW_LINE_STRING):u.keyCode===51&&e.options.controls.polygon&&l(xt.modes.DRAW_POLYGON))},i.keyup=function(u){s(u.keyCode)&&a.keyup(u)},i.zoomend=function(){e.store.changeZoom()},i.data=function(u){if(u.dataType==="style"){const{setup:f,map:b,options:S,store:_}=e;S.styles.some(O=>b.getLayer(O.id))||(f.addLayers(),_.setDirty(),_.render())}};function l(u,f,b={}){a.stop();const S=t[u];if(S===void 0)throw new Error(`${u} is not valid`);o=u;const _=S(e,f);a=Va(_,e),b.silent||e.map.fire(xt.events.MODE_CHANGE,{mode:u}),e.store.setDirty(),e.store.render()}const h={trash:!1,combineFeatures:!1,uncombineFeatures:!1};function g(u){let f=!1;Object.keys(u).forEach(b=>{if(h[b]===void 0)throw new Error("Invalid action type");h[b]!==u[b]&&(f=!0),h[b]=u[b]}),f&&e.map.fire(xt.events.ACTIONABLE,{actions:h})}return{start:function(){o=e.options.defaultMode,a=Va(t[o](e),e)},changeMode:l,actionable:g,currentModeName:function(){return o},currentModeRender:function(u,f){return a.render(u,f)},fire:function(u,f){i[u]&&i[u](f)},addEventListeners:function(){e.map.on("mousemove",i.mousemove),e.map.on("mousedown",i.mousedown),e.map.on("mouseup",i.mouseup),e.map.on("data",i.data),e.map.on("touchmove",i.touchmove),e.map.on("touchstart",i.touchstart),e.map.on("touchend",i.touchend),e.container.addEventListener("mouseout",i.mouseout),e.options.keybindings&&(e.container.addEventListener("keydown",i.keydown),e.container.addEventListener("keyup",i.keyup))},removeEventListeners:function(){e.map.off("mousemove",i.mousemove),e.map.off("mousedown",i.mousedown),e.map.off("mouseup",i.mouseup),e.map.off("data",i.data),e.map.off("touchmove",i.touchmove),e.map.off("touchstart",i.touchstart),e.map.off("touchend",i.touchend),e.container.removeEventListener("mouseout",i.mouseout),e.options.keybindings&&(e.container.removeEventListener("keydown",i.keydown),e.container.removeEventListener("keyup",i.keyup))},trash:function(u){a.trash(u)},combineFeatures:function(){a.combineFeatures()},uncombineFeatures:function(){a.uncombineFeatures()},getMode:function(){return o}}},tu={exports:{}};function xh(e,t,r){let n,i;function o(){n=!1,i&&(a.apply(r,i),i=!1)}function a(){n?i=arguments:(n=!0,e.apply(r,arguments),setTimeout(o,t))}return a}var _h=xh;function Eh(e){return[].concat(e).filter(t=>t!==void 0)}var Ah=Eh;const Le=J;var Ih=function(){const t=this;if(!(t.ctx.map&&t.ctx.map.getSource(Le.sources.HOT)!==void 0))return h();const n=t.ctx.events.currentModeName();t.ctx.ui.queueMapClasses({mode:n});let i=[],o=[];t.isDirty?o=t.getAllIds():(i=t.getChangedIds().filter(g=>t.get(g)!==void 0),o=t.sources.hot.filter(g=>g.properties.id&&i.indexOf(g.properties.id)===-1&&t.get(g.properties.id)!==void 0).map(g=>g.properties.id)),t.sources.hot=[];const a=t.sources.cold.length;t.sources.cold=t.isDirty?[]:t.sources.cold.filter(g=>{const m=g.properties.id||g.properties.parent;return i.indexOf(m)===-1});const s=a!==t.sources.cold.length||o.length>0;i.forEach(g=>l(g,"hot")),o.forEach(g=>l(g,"cold"));function l(g,m){const f=t.get(g).internal(n);t.ctx.events.currentModeRender(f,b=>{t.sources[m].push(b)})}if(s&&t.ctx.map.getSource(Le.sources.COLD).setData({type:Le.geojsonTypes.FEATURE_COLLECTION,features:t.sources.cold}),t.ctx.map.getSource(Le.sources.HOT).setData({type:Le.geojsonTypes.FEATURE_COLLECTION,features:t.sources.hot}),t._emitSelectionChange&&(t.ctx.map.fire(Le.events.SELECTION_CHANGE,{features:t.getSelected().map(g=>g.toGeoJSON()),points:t.getSelectedCoordinates().map(g=>({type:Le.geojsonTypes.FEATURE,properties:{},geometry:{type:Le.geojsonTypes.POINT,coordinates:g.coordinates}}))}),t._emitSelectionChange=!1),t._deletedFeaturesToEmit.length){const g=t._deletedFeaturesToEmit.map(m=>m.toGeoJSON());t._deletedFeaturesToEmit=[],t.ctx.map.fire(Le.events.DELETE,{features:g})}h(),t.ctx.map.fire(Le.events.RENDER,{});function h(){t.isDirty=!1,t.clearChangedIds()}};const Ch=_h,gn=Ah,Un=fn,$h=Ih,Nh=J.interactions,ee=tu.exports=function(e){this._features={},this._featureIds=new Un,this._selectedFeatureIds=new Un,this._selectedCoordinates=[],this._changedFeatureIds=new Un,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]},this.render=Ch($h,16,this),this.isDirty=!1};ee.prototype.createRenderBatch=function(){const e=this.render;let t=0;return this.render=function(){t++},()=>{this.render=e,t>0&&this.render()}};ee.prototype.setDirty=function(){return this.isDirty=!0,this};ee.prototype.featureChanged=function(e){return this._changedFeatureIds.add(e),this};ee.prototype.getChangedIds=function(){return this._changedFeatureIds.values()};ee.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this};ee.prototype.getAllIds=function(){return this._featureIds.values()};ee.prototype.add=function(e){return this.featureChanged(e.id),this._features[e.id]=e,this._featureIds.add(e.id),this};ee.prototype.delete=function(e,t={}){return gn(e).forEach(r=>{this._featureIds.has(r)&&(this._featureIds.delete(r),this._selectedFeatureIds.delete(r),t.silent||this._deletedFeaturesToEmit.indexOf(this._features[r])===-1&&this._deletedFeaturesToEmit.push(this._features[r]),delete this._features[r],this.isDirty=!0)}),ru.call(this,t),this};ee.prototype.get=function(e){return this._features[e]};ee.prototype.getAll=function(){return Object.keys(this._features).map(e=>this._features[e])};ee.prototype.select=function(e,t={}){return gn(e).forEach(r=>{this._selectedFeatureIds.has(r)||(this._selectedFeatureIds.add(r),this._changedFeatureIds.add(r),t.silent||(this._emitSelectionChange=!0))}),this};ee.prototype.deselect=function(e,t={}){return gn(e).forEach(r=>{this._selectedFeatureIds.has(r)&&(this._selectedFeatureIds.delete(r),this._changedFeatureIds.add(r),t.silent||(this._emitSelectionChange=!0))}),ru.call(this,t),this};ee.prototype.clearSelected=function(e={}){return this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this};ee.prototype.setSelected=function(e,t={}){return e=gn(e),this.deselect(this._selectedFeatureIds.values().filter(r=>e.indexOf(r)===-1),{silent:t.silent}),this.select(e.filter(r=>!this._selectedFeatureIds.has(r)),{silent:t.silent}),this};ee.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this};ee.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this};ee.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()};ee.prototype.getSelected=function(){return this._selectedFeatureIds.values().map(e=>this.get(e))};ee.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(t=>({coordinates:this.get(t.feature_id).getCoordinate(t.coord_path)}))};ee.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)};ee.prototype.setFeatureProperty=function(e,t,r){this.get(e).setProperty(t,r),this.featureChanged(e)};function ru(e){const t=this._selectedCoordinates.filter(r=>this._selectedFeatureIds.has(r.feature_id));this._selectedCoordinates.length!==t.length&&!e.silent&&(this._emitSelectionChange=!0),this._selectedCoordinates=t}ee.prototype.storeMapConfig=function(){Nh.forEach(e=>{this.ctx.map[e]&&(this._mapInitialConfig[e]=this.ctx.map[e].isEnabled())})};ee.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(e=>{this._mapInitialConfig[e]?this.ctx.map[e].enable():this.ctx.map[e].disable()})};ee.prototype.getInitialConfigValue=function(e){return this._mapInitialConfig[e]!==void 0?this._mapInitialConfig[e]:!0};var Oh=tu.exports;const Ka=Do,re=J,Ph=["mode","feature","mouse"];var Mh=function(e){const t={};let r=null,n={mode:null,feature:null,mouse:null},i={mode:null,feature:null,mouse:null};function o(){a({mode:null,feature:null,mouse:null}),s()}function a(f){i=Ka(i,f)}function s(){if(!e.container)return;const f=[],b=[];Ph.forEach(S=>{i[S]!==n[S]&&(f.push(`${S}-${n[S]}`),i[S]!==null&&b.push(`${S}-${i[S]}`))}),f.length>0&&e.container.classList.remove.apply(e.container.classList,f),b.length>0&&e.container.classList.add.apply(e.container.classList,b),n=Ka(n,i)}function l(f,b={}){const S=document.createElement("button");return S.className=`${re.classes.CONTROL_BUTTON} ${b.className}`,S.setAttribute("title",b.title),b.container.appendChild(S),S.addEventListener("click",_=>{if(_.preventDefault(),_.stopPropagation(),_.target===r){h();return}g(f),b.onActivate()},!0),S}function h(){r&&(r.classList.remove(re.classes.ACTIVE_BUTTON),r=null)}function g(f){h();const b=t[f];b&&b&&f!=="trash"&&(b.classList.add(re.classes.ACTIVE_BUTTON),r=b)}function m(){const f=e.options.controls,b=document.createElement("div");return b.className=`${re.classes.CONTROL_GROUP} ${re.classes.CONTROL_BASE}`,f&&(f[re.types.LINE]&&(t[re.types.LINE]=l(re.types.LINE,{container:b,className:re.classes.CONTROL_BUTTON_LINE,title:`LineString tool ${e.options.keybindings?"(l)":""}`,onActivate:()=>e.events.changeMode(re.modes.DRAW_LINE_STRING)})),f[re.types.POLYGON]&&(t[re.types.POLYGON]=l(re.types.POLYGON,{container:b,className:re.classes.CONTROL_BUTTON_POLYGON,title:`Polygon tool ${e.options.keybindings?"(p)":""}`,onActivate:()=>e.events.changeMode(re.modes.DRAW_POLYGON)})),f[re.types.POINT]&&(t[re.types.POINT]=l(re.types.POINT,{container:b,className:re.classes.CONTROL_BUTTON_POINT,title:`Marker tool ${e.options.keybindings?"(m)":""}`,onActivate:()=>e.events.changeMode(re.modes.DRAW_POINT)})),f.trash&&(t.trash=l("trash",{container:b,className:re.classes.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{e.events.trash()}})),f.combine_features&&(t.combine_features=l("combineFeatures",{container:b,className:re.classes.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{e.events.combineFeatures()}})),f.uncombine_features&&(t.uncombine_features=l("uncombineFeatures",{container:b,className:re.classes.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{e.events.uncombineFeatures()}}))),b}function u(){Object.keys(t).forEach(f=>{const b=t[f];b.parentNode&&b.parentNode.removeChild(b),delete t[f]})}return{setActiveButton:g,queueMapClasses:a,updateMapClasses:s,clearMapClasses:o,addButtons:m,removeButtons:u}};const Fh=Sh,Lh=Oh,Rh=Mh,Qe=J,Dh=Do;var Bh=function(e){let t=null,r=null;const n={onRemove:function(){return e.map.off("load",n.connect),clearInterval(r),n.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.map=null,e.container=null,e.store=null,t&&t.parentNode&&t.parentNode.removeChild(t),t=null,this},connect:function(){e.map.off("load",n.connect),clearInterval(r),n.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd:function(i){{const o=i.fire;i.fire=function(a,s){let l=arguments;return o.length===1&&arguments.length!==1&&(l=[Dh({},{type:a},s)]),o.apply(i,l)}}return e.map=i,e.events=Fh(e),e.ui=Rh(e),e.container=i.getContainer(),e.store=new Lh(e),t=e.ui.addButtons(),e.options.boxSelect&&(i.boxZoom.disable(),i.dragPan.disable(),i.dragPan.enable()),i.loaded()?n.connect():(i.on("load",n.connect),r=setInterval(()=>{i.loaded()&&n.connect()},16)),e.events.start(),t},addLayers:function(){e.map.addSource(Qe.sources.COLD,{data:{type:Qe.geojsonTypes.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(Qe.sources.HOT,{data:{type:Qe.geojsonTypes.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach(i=>{e.map.addLayer(i)}),e.store.setDirty(!0),e.store.render()},removeLayers:function(){e.options.styles.forEach(i=>{e.map.getLayer(i.id)&&e.map.removeLayer(i.id)}),e.map.getSource(Qe.sources.COLD)&&e.map.removeSource(Qe.sources.COLD),e.map.getSource(Qe.sources.HOT)&&e.map.removeSource(Qe.sources.HOT)}};return e.setup=n,n},jh=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];const _t=J;var kt={isOfMetaType:function(e){return function(t){const r=t.featureTarget;return!r||!r.properties?!1:r.properties.meta===e}},isShiftMousedown:function(e){return!e.originalEvent||!e.originalEvent.shiftKey?!1:e.originalEvent.button===0},isActiveFeature:function(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===_t.activeStates.ACTIVE&&e.featureTarget.properties.meta===_t.meta.FEATURE},isInactiveFeature:function(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===_t.activeStates.INACTIVE&&e.featureTarget.properties.meta===_t.meta.FEATURE},noTarget:function(e){return e.featureTarget===void 0},isFeature:function(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.meta===_t.meta.FEATURE},isVertex:function(e){const t=e.featureTarget;return!t||!t.properties?!1:t.properties.meta===_t.meta.VERTEX},isShiftDown:function(e){return e.originalEvent?e.originalEvent.shiftKey===!0:!1},isEscapeKey:function(e){return e.keyCode===27},isEnterKey:function(e){return e.keyCode===13},true:function(){return!0}},kh=Pt;function Pt(e,t){this.x=e,this.y=t}Pt.prototype={clone:function(){return new Pt(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,r=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),n=t*this.x-r*this.y,i=r*this.x+t*this.y;return this.x=n,this.y=i,this},_rotateAround:function(e,t){var r=Math.cos(e),n=Math.sin(e),i=t.x+r*(this.x-t.x)-n*(this.y-t.y),o=t.y+n*(this.x-t.x)+r*(this.y-t.y);return this.x=i,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}};Pt.convert=function(e){return e instanceof Pt?e:Array.isArray(e)?new Pt(e[0],e[1]):e};const Uh=kh;function Gh(e,t){const r=t.getBoundingClientRect();return new Uh(e.clientX-r.left-(t.clientLeft||0),e.clientY-r.top-(t.clientTop||0))}var qh=Gh;const er=J;var yn=function(e,t,r,n){return{type:er.geojsonTypes.FEATURE,properties:{meta:er.meta.VERTEX,parent:e,coord_path:r,active:n?er.activeStates.ACTIVE:er.activeStates.INACTIVE},geometry:{type:er.geojsonTypes.POINT,coordinates:t}}};const pt=J;var Vh=function(e,t,r,n){const i=t.geometry.coordinates,o=r.geometry.coordinates;if(i[1]>pt.LAT_RENDERED_MAX||i[1]<pt.LAT_RENDERED_MIN||o[1]>pt.LAT_RENDERED_MAX||o[1]<pt.LAT_RENDERED_MIN)return null;const a=n.project([i[0],i[1]]),s=n.project([o[0],o[1]]),l=n.unproject([(a.x+s.x)/2,(a.y+s.y)/2]);return{type:pt.geojsonTypes.FEATURE,properties:{meta:pt.meta.MIDPOINT,parent:e,lng:l.lng,lat:l.lat,coord_path:r.properties.coord_path},geometry:{type:pt.geojsonTypes.POINT,coordinates:[l.lng,l.lat]}}};const Ja=yn,Wh=Vh,Et=J;function nu(e,t={},r=null){const{type:n,coordinates:i}=e.geometry,o=e.properties&&e.properties.id;let a=[];n===Et.geojsonTypes.POINT?a.push(Ja(o,i,r,l(r))):n===Et.geojsonTypes.POLYGON?i.forEach((g,m)=>{s(g,r!==null?`${r}.${m}`:String(m))}):n===Et.geojsonTypes.LINE_STRING?s(i,r):n.indexOf(Et.geojsonTypes.MULTI_PREFIX)===0&&h();function s(g,m){let u="",f=null;g.forEach((b,S)=>{const _=m!=null?`${m}.${S}`:String(S),N=Ja(o,b,_,l(_));if(t.midpoints&&f){const w=Wh(o,f,N,t.map);w&&a.push(w)}f=N;const O=JSON.stringify(b);u!==O&&a.push(N),S===0&&(u=O)})}function l(g){return t.selectedPaths?t.selectedPaths.indexOf(g)!==-1:!1}function h(){const g=n.replace(Et.geojsonTypes.MULTI_PREFIX,"");i.forEach((m,u)=>{const f={type:Et.geojsonTypes.FEATURE,properties:e.properties,geometry:{type:g,coordinates:m}};a=a.concat(nu(f,t,u))})}return a}var mn=nu,Ut={enable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||!e._ctx||!e._ctx.store||!e._ctx.store.getInitialConfigValue||e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||e.map.doubleClickZoom.disable()},0)}},vn={exports:{}},zh=function e(t){switch(t&&t.type||null){case"FeatureCollection":return t.features=t.features.reduce(function(r,n){return r.concat(e(n))},[]),t;case"Feature":return t.geometry?e(t.geometry).map(function(r){var n={type:"Feature",properties:JSON.parse(JSON.stringify(t.properties)),geometry:r};return t.id!==void 0&&(n.id=t.id),n}):t;case"MultiPoint":return t.coordinates.map(function(r){return{type:"Point",coordinates:r}});case"MultiPolygon":return t.coordinates.map(function(r){return{type:"Polygon",coordinates:r}});case"MultiLineString":return t.coordinates.map(function(r){return{type:"LineString",coordinates:r}});case"GeometryCollection":return t.geometries.map(e).reduce(function(r,n){return r.concat(n)},[]);case"Point":case"Polygon":case"LineString":return[t]}},Hh=function(t){return r(t);function r(n){return Array.isArray(n)&&n.length&&typeof n[0]=="number"?[n]:n.reduce(function(i,o){return Array.isArray(o)&&Array.isArray(o[0])?i.concat(r(o)):(i.push(o),i)},[])}},Kh=Ic,Jh=zh,Yh=Hh,Zh=function(e){if(!e)return[];var t=Jh(Kh(e)),r=[];return t.features.forEach(function(n){n.geometry&&(r=r.concat(Yh(n.geometry.coordinates)))}),r},iu=Function.prototype.toString,$t=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,go,jr;if(typeof $t=="function"&&typeof Object.defineProperty=="function")try{go=Object.defineProperty({},"length",{get:function(){throw jr}}),jr={},$t(function(){throw 42},null,go)}catch(e){e!==jr&&($t=null)}else $t=null;var Xh=/^\s*class\b/,yo=function(t){try{var r=iu.call(t);return Xh.test(r)}catch{return!1}},Gn=function(t){try{return yo(t)?!1:(iu.call(t),!0)}catch{return!1}},kr=Object.prototype.toString,Qh="[object Object]",eg="[object Function]",tg="[object GeneratorFunction]",rg="[object HTMLAllCollection]",ng="[object HTML document.all class]",ig="[object HTMLCollection]",og=typeof Symbol=="function"&&!!Symbol.toStringTag,ag=!(0 in[,]),mo=function(){return!1};if(typeof document=="object"){var sg=document.all;kr.call(sg)===kr.call(document.all)&&(mo=function(t){if((ag||!t)&&(typeof t>"u"||typeof t=="object"))try{var r=kr.call(t);return(r===rg||r===ng||r===ig||r===Qh)&&t("")==null}catch{}return!1})}var bn=$t?function(t){if(mo(t))return!0;if(!t||typeof t!="function"&&typeof t!="object")return!1;try{$t(t,null,go)}catch(r){if(r!==jr)return!1}return!yo(t)&&Gn(t)}:function(t){if(mo(t))return!0;if(!t||typeof t!="function"&&typeof t!="object")return!1;if(og)return Gn(t);if(yo(t))return!1;var r=kr.call(t);return r!==eg&&r!==tg&&!/^\[object HTML/.test(r)?!1:Gn(t)},lg=bn,cg=Object.prototype.toString,ou=Object.prototype.hasOwnProperty,ug=function(t,r,n){for(var i=0,o=t.length;i<o;i++)ou.call(t,i)&&(n==null?r(t[i],i,t):r.call(n,t[i],i,t))},fg=function(t,r,n){for(var i=0,o=t.length;i<o;i++)n==null?r(t.charAt(i),i,t):r.call(n,t.charAt(i),i,t)},dg=function(t,r,n){for(var i in t)ou.call(t,i)&&(n==null?r(t[i],i,t):r.call(n,t[i],i,t))};function pg(e){return cg.call(e)==="[object Array]"}var Wo=function(t,r,n){if(!lg(r))throw new TypeError("iterator must be a function");var i;arguments.length>=3&&(i=n),pg(t)?ug(t,r,i):typeof t=="string"?fg(t,r,i):dg(t,r,i)},au=["Float16Array","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],qn=au,hg=typeof globalThis>"u"?window:globalThis,pr=function(){for(var t=[],r=0;r<qn.length;r++)typeof hg[qn[r]]=="function"&&(t[t.length]=qn[r]);return t},Wr=Wo,gg=pr,Ya=rt,zo=Y,Ur=cn,_r=Lt,yg=zo("Object.prototype.toString"),su=yt(),Za=typeof globalThis>"u"?window:globalThis,vo=gg(),Ho=zo("String.prototype.slice"),mg=zo("Array.prototype.indexOf",!0)||function(t,r){for(var n=0;n<t.length;n+=1)if(t[n]===r)return n;return-1},zr={__proto__:null};su&&Ur&&_r?Wr(vo,function(e){var t=new Za[e];if(Symbol.toStringTag in t&&_r){var r=_r(t),n=Ur(r,Symbol.toStringTag);if(!n&&r){var i=_r(r);n=Ur(i,Symbol.toStringTag)}zr["$"+e]=Ya(n.get)}}):Wr(vo,function(e){var t=new Za[e],r=t.slice||t.set;r&&(zr["$"+e]=Ya(r))});var vg=function(t){var r=!1;return Wr(zr,function(n,i){if(!r)try{"$"+n(t)===i&&(r=Ho(i,1))}catch{}}),r},bg=function(t){var r=!1;return Wr(zr,function(n,i){if(!r)try{n(t),r=Ho(i,1)}catch{}}),r},Gt=function(t){if(!t||typeof t!="object")return!1;if(!su){var r=Ho(yg(t),8,-1);return mg(vo,r)>-1?r:r!=="Object"?!1:bg(t)}return Ur?vg(t):null};const wg={},Tg=Object.freeze(Object.defineProperty({__proto__:null,default:wg},Symbol.toStringTag,{value:"Module"})),bo=Bo(Tg);var Ko=typeof Map=="function"&&Map.prototype,Vn=Object.getOwnPropertyDescriptor&&Ko?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Hr=Ko&&Vn&&typeof Vn.get=="function"?Vn.get:null,Xa=Ko&&Map.prototype.forEach,Jo=typeof Set=="function"&&Set.prototype,Wn=Object.getOwnPropertyDescriptor&&Jo?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Kr=Jo&&Wn&&typeof Wn.get=="function"?Wn.get:null,Qa=Jo&&Set.prototype.forEach,Sg=typeof WeakMap=="function"&&WeakMap.prototype,sr=Sg?WeakMap.prototype.has:null,xg=typeof WeakSet=="function"&&WeakSet.prototype,lr=xg?WeakSet.prototype.has:null,_g=typeof WeakRef=="function"&&WeakRef.prototype,es=_g?WeakRef.prototype.deref:null,Eg=Boolean.prototype.valueOf,Ag=Object.prototype.toString,Ig=Function.prototype.toString,Cg=String.prototype.match,Yo=String.prototype.slice,et=String.prototype.replace,$g=String.prototype.toUpperCase,ts=String.prototype.toLowerCase,lu=RegExp.prototype.test,rs=Array.prototype.concat,Re=Array.prototype.join,Ng=Array.prototype.slice,ns=Math.floor,wo=typeof BigInt=="function"?BigInt.prototype.valueOf:null,zn=Object.getOwnPropertySymbols,To=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Mt=typeof Symbol=="function"&&typeof Symbol.iterator=="object",cr=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Mt||!0)?Symbol.toStringTag:null,cu=Object.prototype.propertyIsEnumerable,is=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function os(e,t){if(e===1/0||e===-1/0||e!==e||e&&e>-1e3&&e<1e3||lu.call(/e/,t))return t;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof e=="number"){var n=e<0?-ns(-e):ns(e);if(n!==e){var i=String(n),o=Yo.call(t,i.length+1);return et.call(i,r,"$&_")+"."+et.call(et.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return et.call(t,r,"$&_")}var So=bo,as=So.custom,ss=du(as)?as:null,uu={__proto__:null,double:'"',single:"'"},Og={__proto__:null,double:/(["\\])/g,single:/(['\\])/g},Pg=function e(t,r,n,i){var o=r||{};if(He(o,"quoteStyle")&&!He(uu,o.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(He(o,"maxStringLength")&&(typeof o.maxStringLength=="number"?o.maxStringLength<0&&o.maxStringLength!==1/0:o.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var a=He(o,"customInspect")?o.customInspect:!0;if(typeof a!="boolean"&&a!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(He(o,"indent")&&o.indent!==null&&o.indent!=="	"&&!(parseInt(o.indent,10)===o.indent&&o.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(He(o,"numericSeparator")&&typeof o.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var s=o.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return hu(t,o);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var l=String(t);return s?os(t,l):l}if(typeof t=="bigint"){var h=String(t)+"n";return s?os(t,h):h}var g=typeof o.depth>"u"?5:o.depth;if(typeof n>"u"&&(n=0),n>=g&&g>0&&typeof t=="object")return xo(t)?"[Array]":"[Object]";var m=Yg(o,n);if(typeof i>"u")i=[];else if(pu(i,t)>=0)return"[Circular]";function u(E,L,k){if(L&&(i=Ng.call(i),i.push(L)),k){var V={depth:o.depth};return He(o,"quoteStyle")&&(V.quoteStyle=o.quoteStyle),e(E,V,n+1,i)}return e(E,o,n+1,i)}if(typeof t=="function"&&!ls(t)){var f=Ug(t),b=Er(t,u);return"[Function"+(f?": "+f:" (anonymous)")+"]"+(b.length>0?" { "+Re.call(b,", ")+" }":"")}if(du(t)){var S=Mt?et.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):To.call(t);return typeof t=="object"&&!Mt?tr(S):S}if(Hg(t)){for(var _="<"+ts.call(String(t.nodeName)),N=t.attributes||[],O=0;O<N.length;O++)_+=" "+N[O].name+"="+fu(Mg(N[O].value),"double",o);return _+=">",t.childNodes&&t.childNodes.length&&(_+="..."),_+="</"+ts.call(String(t.nodeName))+">",_}if(xo(t)){if(t.length===0)return"[]";var w=Er(t,u);return m&&!Jg(w)?"["+_o(w,m)+"]":"[ "+Re.call(w,", ")+" ]"}if(Lg(t)){var C=Er(t,u);return!("cause"in Error.prototype)&&"cause"in t&&!cu.call(t,"cause")?"{ ["+String(t)+"] "+Re.call(rs.call("[cause]: "+u(t.cause),C),", ")+" }":C.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+Re.call(C,", ")+" }"}if(typeof t=="object"&&a){if(ss&&typeof t[ss]=="function"&&So)return So(t,{depth:g-n});if(a!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(Gg(t)){var $=[];return Xa&&Xa.call(t,function(E,L){$.push(u(L,t,!0)+" => "+u(E,t))}),cs("Map",Hr.call(t),$,m)}if(Wg(t)){var P=[];return Qa&&Qa.call(t,function(E){P.push(u(E,t))}),cs("Set",Kr.call(t),P,m)}if(qg(t))return Hn("WeakMap");if(zg(t))return Hn("WeakSet");if(Vg(t))return Hn("WeakRef");if(Dg(t))return tr(u(Number(t)));if(jg(t))return tr(u(wo.call(t)));if(Bg(t))return tr(Eg.call(t));if(Rg(t))return tr(u(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(typeof globalThis<"u"&&t===globalThis||typeof window<"u"&&t===window)return"{ [object globalThis] }";if(!Fg(t)&&!ls(t)){var M=Er(t,u),F=is?is(t)===Object.prototype:t instanceof Object||t.constructor===Object,d=t instanceof Object?"":"null prototype",I=!F&&cr&&Object(t)===t&&cr in t?Yo.call(it(t),8,-1):d?"Object":"",T=F||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",v=T+(I||d?"["+Re.call(rs.call([],I||[],d||[]),": ")+"] ":"");return M.length===0?v+"{}":m?v+"{"+_o(M,m)+"}":v+"{ "+Re.call(M,", ")+" }"}return String(t)};function fu(e,t,r){var n=r.quoteStyle||t,i=uu[n];return i+e+i}function Mg(e){return et.call(String(e),/"/g,"&quot;")}function bt(e){return!cr||!(typeof e=="object"&&(cr in e||typeof e[cr]<"u"))}function xo(e){return it(e)==="[object Array]"&&bt(e)}function Fg(e){return it(e)==="[object Date]"&&bt(e)}function ls(e){return it(e)==="[object RegExp]"&&bt(e)}function Lg(e){return it(e)==="[object Error]"&&bt(e)}function Rg(e){return it(e)==="[object String]"&&bt(e)}function Dg(e){return it(e)==="[object Number]"&&bt(e)}function Bg(e){return it(e)==="[object Boolean]"&&bt(e)}function du(e){if(Mt)return e&&typeof e=="object"&&e instanceof Symbol;if(typeof e=="symbol")return!0;if(!e||typeof e!="object"||!To)return!1;try{return To.call(e),!0}catch{}return!1}function jg(e){if(!e||typeof e!="object"||!wo)return!1;try{return wo.call(e),!0}catch{}return!1}var kg=Object.prototype.hasOwnProperty||function(e){return e in this};function He(e,t){return kg.call(e,t)}function it(e){return Ag.call(e)}function Ug(e){if(e.name)return e.name;var t=Cg.call(Ig.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}function pu(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}function Gg(e){if(!Hr||!e||typeof e!="object")return!1;try{Hr.call(e);try{Kr.call(e)}catch{return!0}return e instanceof Map}catch{}return!1}function qg(e){if(!sr||!e||typeof e!="object")return!1;try{sr.call(e,sr);try{lr.call(e,lr)}catch{return!0}return e instanceof WeakMap}catch{}return!1}function Vg(e){if(!es||!e||typeof e!="object")return!1;try{return es.call(e),!0}catch{}return!1}function Wg(e){if(!Kr||!e||typeof e!="object")return!1;try{Kr.call(e);try{Hr.call(e)}catch{return!0}return e instanceof Set}catch{}return!1}function zg(e){if(!lr||!e||typeof e!="object")return!1;try{lr.call(e,lr);try{sr.call(e,sr)}catch{return!0}return e instanceof WeakSet}catch{}return!1}function Hg(e){return!e||typeof e!="object"?!1:typeof HTMLElement<"u"&&e instanceof HTMLElement?!0:typeof e.nodeName=="string"&&typeof e.getAttribute=="function"}function hu(e,t){if(e.length>t.maxStringLength){var r=e.length-t.maxStringLength,n="... "+r+" more character"+(r>1?"s":"");return hu(Yo.call(e,0,t.maxStringLength),t)+n}var i=Og[t.quoteStyle||"single"];i.lastIndex=0;var o=et.call(et.call(e,i,"\\$1"),/[\x00-\x1f]/g,Kg);return fu(o,"single",t)}function Kg(e){var t=e.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return r?"\\"+r:"\\x"+(t<16?"0":"")+$g.call(t.toString(16))}function tr(e){return"Object("+e+")"}function Hn(e){return e+" { ? }"}function cs(e,t,r,n){var i=n?_o(r,n):Re.call(r,", ");return e+" ("+t+") {"+i+"}"}function Jg(e){for(var t=0;t<e.length;t++)if(pu(e[t],`
`)>=0)return!1;return!0}function Yg(e,t){var r;if(e.indent==="	")r="	";else if(typeof e.indent=="number"&&e.indent>0)r=Re.call(Array(e.indent+1)," ");else return null;return{base:r,prev:Re.call(Array(t+1),r)}}function _o(e,t){if(e.length===0)return"";var r=`
`+t.prev+t.base;return r+Re.call(e,","+r)+`
`+t.prev}function Er(e,t){var r=xo(e),n=[];if(r){n.length=e.length;for(var i=0;i<e.length;i++)n[i]=He(e,i)?t(e[i],e):""}var o=typeof zn=="function"?zn(e):[],a;if(Mt){a={};for(var s=0;s<o.length;s++)a["$"+o[s]]=o[s]}for(var l in e)He(e,l)&&(r&&String(Number(l))===l&&l<e.length||Mt&&a["$"+l]instanceof Symbol||(lu.call(/[^\w$]/,l)?n.push(t(l,e)+": "+t(e[l],e)):n.push(l+": "+t(e[l],e))));if(typeof zn=="function")for(var h=0;h<o.length;h++)cu.call(e,o[h])&&n.push("["+t(o[h])+"]: "+t(e[o[h]],e));return n}var wn=function(t){return typeof t=="string"||typeof t=="symbol"},ot=function(t){return!!t&&(typeof t=="function"||typeof t=="object")},us=z,Zg=Pg,Xg=wn,Qg=ot,ey=function(t,r){if(!Qg(t))throw new us("Assertion failed: Type(O) is not Object");if(!Xg(r))throw new us("Assertion failed: P is not a Property Key, got "+Zg(r));return t[r]},ty=Rt,Je=function(t){return(typeof t=="number"||typeof t=="bigint")&&!ty(t)&&t!==1/0&&t!==-1/0},ry=jo,ny=Dt,iy=Rt,oy=Je,Tn=function(t){if(typeof t!="number"||iy(t)||!oy(t))return!1;var r=ry(t);return ny(r)===r},ay=rt,gu=Y,sy=ne,Eo=sy("%ArrayBuffer%",!0),Gr=gu("ArrayBuffer.prototype.byteLength",!0),ly=gu("Object.prototype.toString"),fs=!!Eo&&!Gr&&new Eo(0).slice,ds=!!fs&&ay(fs),qt=Gr||ds?function(t){if(!t||typeof t!="object")return!1;try{return Gr?Gr(t):ds(t,0),!0}catch{return!1}}:Eo?function(t){return ly(t)==="[object ArrayBuffer]"}:function(t){return!1},cy=Y,ps=cy("ArrayBuffer.prototype.byteLength",!0),uy=qt,yu=function(t){return uy(t)?ps?ps(t):t.byteLength:NaN},fy=Y,hs=fy("SharedArrayBuffer.prototype.byteLength",!0),hr=hs?function(t){if(!t||typeof t!="object")return!1;try{return hs(t),!0}catch{return!1}}:function(t){return!1},dy=z,py=yu,hy=pr(),gy=Y,yy=qt,my=hr,vy=gy("SharedArrayBuffer.prototype.byteLength",!0),Vt=function(t){var r=my(t);if(!yy(t)&&!r)throw new dy("Assertion failed: `arrayBuffer` must be an Object with an [[ArrayBufferData]] internal slot");if((r?vy:py)(t)===0)try{new window[hy[0]](t)}catch(n){return!!n&&n.name==="TypeError"}return!1},Kn,gs;function mu(){if(gs)return Kn;gs=1;var e=z,t=mt,r=ot,n=wn;return Kn=function(o,a){if(!r(o))throw new e("Assertion failed: `O` must be an Object");if(!n(a))throw new e("Assertion failed: `P` must be a Property Key");return t(o,a)},Kn}var by=ne,vu=by("%Array%"),wy=!vu.isArray&&Y("Object.prototype.toString"),bu=vu.isArray||function(t){return wy(t)==="[object Array]"},Zo=bu,Jn,ys;function wu(){return ys||(ys=1,Jn=function(t){return t==="BIGUINT64"||t==="BIGINT64"}),Jn}var Yn,ms;function Ty(){return ms||(ms=1,Yn=function(t){return t==="UINT8"||t==="UINT8C"||t==="UINT16"||t==="UINT32"||t==="BIGUINT64"}),Yn}var Zn,vs;function Sy(){if(vs)return Zn;vs=1;var e=Bt;return Zn=function(r){var n=r[3]&128?-1:1,i=(r[3]&127)<<1|r[2]>>7,o=(r[2]&127)<<16|r[1]<<8|r[0];return i===0&&o===0?n===1?0:-0:i===255&&o===0?n===1?1/0:-1/0:i===255&&o!==0?NaN:(i-=127,i===-127?n*o*e(2,-149):n*(1+o*e(2,-23))*e(2,i))},Zn}var Xn,bs;function xy(){if(bs)return Xn;bs=1;var e=Bt;return Xn=function(r){var n=r[7]&128?-1:1,i=(r[7]&127)<<4|(r[6]&240)>>4,o=(r[6]&15)*281474976710656+r[5]*1099511627776+r[4]*4294967296+r[3]*16777216+r[2]*65536+r[1]*256+r[0];return i===0&&o===0?n*0:i===2047&&o!==0?NaN:i===2047&&o===0?n*(1/0):(i-=1023,i===-1023?n*o*5e-324:n*(1+o/4503599627370496)*e(2,i))},Xn}var Qn,ws;function _y(){if(ws)return Qn;ws=1;var e=ne,t=Bt,r=e("%Number%"),n=e("%BigInt%",!0);return Qn=function(o,a,s,l){for(var h=l?n:r,g=h(0),m=0;m<o.length;m++)g+=h(o[m]*t(2,8*m));if(!s){var u=a*8;o[a-1]&128&&(g-=h(t(2,u)))}return g},Qn}var ei,Ts;function Ey(){return Ts||(Ts=1,ei=function(t,r){for(var n=0;n<t.length;n+=1)if(!r(t[n],n,t))return!1;return!0}),ei}var ti,Ss;function Ay(){return Ss||(Ss=1,ti=function(t){return typeof t=="number"&&t>=0&&t<=255&&(t|0)===t}),ti}var Wt={__proto__:null,name:{__proto__:null,$Int8Array:"INT8",$Uint8Array:"UINT8",$Uint8ClampedArray:"UINT8C",$Int16Array:"INT16",$Uint16Array:"UINT16",$Int32Array:"INT32",$Uint32Array:"UINT32",$BigInt64Array:"BIGINT64",$BigUint64Array:"BIGUINT64",$Float32Array:"FLOAT32",$Float64Array:"FLOAT64"},size:{__proto__:null,$INT8:1,$UINT8:1,$UINT8C:1,$INT16:2,$UINT16:2,$INT32:4,$UINT32:4,$BIGINT64:8,$BIGUINT64:8,$FLOAT32:4,$FLOAT64:8},choices:'"INT8", "UINT8", "UINT8C", "INT16", "UINT16", "INT32", "UINT32", "BIGINT64", "BIGUINT64", "FLOAT32", or "FLOAT64"'},ri,xs;function Iy(){if(xs)return ri;xs=1;var e=ne,t=Y,r=$c,n=Ke,i=z,o=e("%BigInt%",!0),a=mu(),s=Zo,l=wu(),h=Ty(),g=Sy(),m=xy(),u=_y(),f=Ey(),b=Ay(),S=t("Array.prototype.reverse"),_=t("Array.prototype.slice"),N=Wt;return ri=function(w,C,$){if(!a(N.size,"$"+w))throw new i("Assertion failed: `type` must be a TypedArray element type");if(!s(C)||!f(C,b))throw new i("Assertion failed: `rawBytes` must be an Array of bytes");if(typeof $!="boolean")throw new i("Assertion failed: `isLittleEndian` must be a Boolean");var P=N.size["$"+w];if(C.length!==P)throw new r("Assertion failed: `rawBytes` must have a length of "+P+" for type "+w);var M=l(w);if(M&&!o)throw new n("this environment does not support BigInts");return C=_(C,0,P),$||S(C),w==="FLOAT32"?g(C):w==="FLOAT64"?m(C):u(C,P,h(w),M)},ri}var ni,_s;function Cy(){if(_s)return ni;_s=1;var e={}.toString;return ni=Array.isArray||function(t){return e.call(t)=="[object Array]"},ni}var ii,Es;function $y(){if(Es)return ii;Es=1;var e=ne,t=e("%Array.prototype.concat%"),r=rt,n=Y,i=n("Array.prototype.slice"),o=xp(),a=o&&Symbol.isConcatSpreadable,s=[],l=a?r.apply(t,s):null,h=a?Cy():null;return ii=a?function(m){for(var u=0;u<arguments.length;u+=1){var f=arguments[u];if(f&&typeof f=="object"&&typeof f[a]=="boolean"){s[a]||(s[a]=!0);var b=h(f)?i(f):[f];b[a]=!0,arguments[u]=b}}return l(arguments)}:r(t,s),ii}var Ny=Gt,zt=function(t){return!!Ny(t)},Oy=z,Py=Y,My=Py("TypedArray.prototype.buffer",!0),Fy=zt,gr=My||function(t){if(!Fy(t))throw new Oy("Not a Typed Array");return t.buffer},oi,As;function Tu(){if(As)return oi;As=1;var e=ne,t=e("%Uint8Array%",!0),r=e("%Uint32Array%",!0),n=gr,i=r&&new r([305419896]),o=i&&new t(n(i));return oi=o?o[0]===120?"little":o[0]===18?"big":o[0]===52?"mixed":"unknown":"indeterminate",oi}var Ly=ne,Ry=Ke,We=z,Dy=Y,By=Tn,jy=Ly("%Uint8Array%",!0),ai=Dy("Array.prototype.slice"),ky=Vt,Uy=Iy(),Gy=qt,qy=hr,Is=$y(),Ar=Wt,Vy=Tu(),Wy=function(t,r,n,i,o){var a=qy(t);if(!Gy(t)&&!a)throw new We("Assertion failed: `arrayBuffer` must be an ArrayBuffer or a SharedArrayBuffer");if(!By(r))throw new We("Assertion failed: `byteIndex` must be an integer");if(typeof n!="string"||typeof Ar.size["$"+n]!="number")throw new We("Assertion failed: `type` must be one of "+Ar.choices);if(typeof i!="boolean")throw new We("Assertion failed: `isTypedArray` must be a boolean");if(o!=="SEQ-CST"&&o!=="UNORDERED")throw new We("Assertion failed: `order` must be either `SEQ-CST` or `UNORDERED`");if(arguments.length>5&&typeof arguments[5]!="boolean")throw new We("Assertion failed: `isLittleEndian` must be a boolean, if present");if(ky(t))throw new We("Assertion failed: `arrayBuffer` is detached");if(r<0)throw new We("Assertion failed: `byteIndex` must be non-negative");var s=Ar.size["$"+n];if(!s)throw new We("Assertion failed: `type` must be one of "+Ar.choices);var l;if(a)throw new Ry("SharedArrayBuffer is not supported by this implementation");l=ai(new jy(t,r),0,s);var h=arguments.length>5?arguments[5]:Vy==="little",g=h?ai(Is([0,0,0,0,0,0,0,0],l),-s):ai(Is(l,[0,0,0,0,0,0,0,0]),0,s);return Uy(n,g,h)},Cs=Rt,Su=function(t,r){return t===r?t===0?1/t===1/r:!0:Cs(t)&&Cs(r)},Ir=z,zy=ot,Hy=wn,$s=Su,Ns=function(){try{return delete[].length,!0}catch{return!1}}(),Ky=function(t,r,n,i){if(!zy(t))throw new Ir("Assertion failed: `O` must be an Object");if(!Hy(r))throw new Ir("Assertion failed: `P` must be a Property Key");if(typeof i!="boolean")throw new Ir("Assertion failed: `Throw` must be a Boolean");if(i){if(t[r]=n,Ns&&!$s(t[r],n))throw new Ir("Attempted to assign to readonly property.");return!0}try{return t[r]=n,Ns?$s(t[r],n):!0}catch{return!1}},si,Os;function Jy(){if(Os)return si;Os=1;var e=ne,t=e("%BigInt%",!0),r=z,n=Ke;return si=function(o){if(typeof o!="string")throw new r("`argument` must be a string");if(!t)throw new n("BigInts are not supported in this environment");try{return t(o)}catch{return}},si}var li,Ps;function Yy(){return Ps||(Ps=1,li=function(t){return t===null||typeof t!="function"&&typeof t!="object"}),li}var Cr={exports:{}},ci,Ms;function Sn(){if(Ms)return ci;Ms=1;var e=Y,t=Nc,r=e("RegExp.prototype.exec"),n=z;return ci=function(o){if(!t(o))throw new n("`regex` must be a RegExp");return function(s){return r(o,s)!==null}},ci}var Fs;function xu(){if(Fs)return Cr.exports;Fs=1;var e=Y,t=e("Object.prototype.toString"),r=_p()(),n=Sn();if(r){var i=e("Symbol.prototype.toString"),o=n(/^Symbol\(.*\)$/),a=function(l){return typeof l.valueOf()!="symbol"?!1:o(i(l))};Cr.exports=function(l){if(typeof l=="symbol")return!0;if(!l||typeof l!="object"||t(l)!=="[object Symbol]")return!1;try{return a(l)}catch{return!1}}}else Cr.exports=function(l){return!1};return Cr.exports}var ui,Ls;function Zy(){if(Ls)return ui;Ls=1;var e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol",t=Yy(),r=bn,n=Oc,i=xu(),o=function(l,h){if(typeof l>"u"||l===null)throw new TypeError("Cannot call method on "+l);if(typeof h!="string"||h!=="number"&&h!=="string")throw new TypeError('hint must be "string" or "number"');var g=h==="string"?["toString","valueOf"]:["valueOf","toString"],m,u,f;for(f=0;f<g.length;++f)if(m=l[g[f]],r(m)&&(u=m.call(l),t(u)))return u;throw new TypeError("No default value")},a=function(l,h){var g=l[h];if(g!==null&&typeof g<"u"){if(!r(g))throw new TypeError(g+" returned for property "+String(h)+" of object "+l+" is not a function");return g}};return ui=function(l){if(t(l))return l;var h="default";arguments.length>1&&(arguments[1]===String?h="string":arguments[1]===Number&&(h="number"));var g;if(e&&(Symbol.toPrimitive?g=a(l,Symbol.toPrimitive):i(l)&&(g=Symbol.prototype.valueOf)),typeof g<"u"){var m=g.call(l,h);if(t(m))return m;throw new TypeError("unable to convert exotic object to primitive")}return h==="default"&&(n(l)||i(l))&&(h="string"),o(l,h==="default"?"number":h)},ui}var fi,Rs;function _u(){if(Rs)return fi;Rs=1;var e=Zy();return fi=function(r){return arguments.length>1?e(r,arguments[1]):e(r)},fi}var di,Ds;function Eu(){if(Ds)return di;Ds=1;var e=ne,t=e("%BigInt%",!0),r=e("%Number%"),n=z,i=Ke,o=Jy(),a=_u();return di=function(l){if(!t)throw new i("BigInts are not supported in this environment");var h=a(l,r);if(h==null)throw new n("Cannot convert null or undefined to a BigInt");if(typeof h=="boolean")return t(h?1:0);if(typeof h=="number")throw new n("Cannot convert a Number value to a BigInt");if(typeof h=="string"){var g=o(h);if(typeof g>"u")throw new n("Failed to parse String to BigInt");return g}if(typeof h=="symbol")throw new n("Cannot convert a Symbol value to a BigInt");if(typeof h!="bigint")throw new i("Assertion failed: unknown primitive type");return h},di}var pi,Bs;function Au(){if(Bs)return pi;Bs=1;var e=ne,t=e("%BigInt%",!0),r=$c,n=z,i=t&&t(0);return pi=function(a,s){if(typeof a!="bigint"||typeof s!="bigint")throw new n("Assertion failed: `n` and `d` arguments must be BigInts");if(s===i)throw new r("Division by zero");return a===i?i:a%s},pi}var hi,js;function Iu(){return js||(js=1,hi=function(t,r,n){var i=t(r,n);return i>=0?i:i+n}),hi}var gi,ks;function Xy(){if(ks)return gi;ks=1;var e=ne,t=e("%BigInt%",!0),r=Bt,n=Eu(),i=Au(),o=Iu(),a=t&&BigInt(r(2,32))*BigInt(r(2,31)),s=t&&BigInt(r(2,32))*BigInt(r(2,32));return gi=function(h){var g=n(h),m=o(i,g,s);return m>=a?m-s:m},gi}var yi,Us;function Qy(){if(Us)return yi;Us=1;var e=ne,t=e("%BigInt%",!0),r=Bt,n=Eu(),i=Au(),o=Iu(),a=t&&BigInt(r(2,32))*BigInt(r(2,32));return yi=function(l){var h=n(l),g=o(i,h,a);return g},yi}var mi,Gs;function em(){if(Gs)return mi;Gs=1;var e=Dt;return mi=function(r,n){var i=r%n;return e(i>=0?i:i+n)},mi}var vi,qs;function tm(){return qs||(qs=1,vi=em()),vi}var bi,Vs;function Ht(){if(Vs)return bi;Vs=1;var e=tm();return bi=function(r,n){return e(r,n)},bi}var wi,Ws;function rm(){return Ws||(Ws=1,wi=function(t){return t===null||typeof t!="function"&&typeof t!="object"}),wi}var Ti,zs;function Cu(){if(zs)return Ti;zs=1;var e=z;return Ti=function(r){if(r==null)throw new e(arguments.length>0&&arguments[1]||"Cannot call method on "+r);return r},Ti}var nm=ne,im=nm("%String%"),om=z,$u=function(t){if(typeof t=="symbol")throw new om("Cannot convert a Symbol value to a string");return im(t)},Si,Hs;function Nu(){if(Hs)return Si;Hs=1;var e=Cu(),t=$u,r=Y,n=r("String.prototype.replace"),i=/^\s$/.test(""),o=i?/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+/:/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+/,a=i?/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+$/:/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+$/;return Si=function(){var l=t(e(this));return n(n(l,o,""),a,"")},Si}var xi,Ks;function Ou(){if(Ks)return xi;Ks=1;var e=Nu(),t="",r="";return xi=function(){return String.prototype.trim&&t.trim()===t&&r.trim()===r&&("_"+r).trim()==="_"+r&&(r+"_").trim()===r+"_"?String.prototype.trim:e},xi}var _i,Js;function am(){if(Js)return _i;Js=1;var e=Pc(),t=Ep,r=Ou();return _i=function(){var i=r();return String.prototype.trim!==i&&(e?t(String.prototype,"trim",i,!0):t(String.prototype,"trim",i)),i},_i}var Ei,Ys;function sm(){if(Ys)return Ei;Ys=1;var e=rt,t=fr,r=Cu(),n=Nu(),i=Ou(),o=am(),a=e(i()),s=function(h){return r(h),a(h)};return t(s,{getPolyfill:i,implementation:n,shim:o}),Ei=s,Ei}var Ai,Zs;function lm(){if(Zs)return Ai;Zs=1;var e=ne,t=e("%RegExp%"),r=z,n=e("%parseInt%"),i=Y,o=Sn(),a=i("String.prototype.slice"),s=o(/^0b[01]+$/i),l=o(/^0o[0-7]+$/i),h=o(/^[-+]0x[0-9a-f]+$/i),g=["","",""].join(""),m=new t("["+g+"]","g"),u=o(m),f=sm();return Ai=function b(S){if(typeof S!="string")throw new r("Assertion failed: `argument` is not a String");if(s(S))return+n(a(S,2),2);if(l(S))return+n(a(S,2),8);if(u(S)||h(S))return NaN;var _=f(S);return _!==S?b(_):+S},Ai}var cm=ne,Xs=z,um=cm("%Number%"),fm=rm(),dm=_u(),pm=lm(),at=function(t){var r=fm(t)?t:dm(t,um);if(typeof r=="symbol")throw new Xs("Cannot convert a Symbol value to a number");if(typeof r=="bigint")throw new Xs("Conversion from 'BigInt' to 'number' is not allowed.");return typeof r=="string"?pm(r):+r},hm=Dt,Xo=function(t){return typeof t=="bigint"?t:hm(t)},Qs=Xo,gm=z,wt=function(t){if(typeof t!="number"&&typeof t!="bigint")throw new gm("argument must be a Number or a BigInt");var r=t<0?-Qs(-t):Qs(t);return r===0?0:r},Ii,el;function ym(){if(el)return Ii;el=1;var e=Ht(),t=at,r=wt,n=Je,i=65536;return Ii=function(a){var s=t(a);if(!n(s)||s===0)return 0;var l=r(s),h=e(l,i);return h>=32768?h-i:h},Ii}var Ci,tl;function mm(){if(tl)return Ci;tl=1;var e=Ht(),t=at,r=wt,n=Je,i=2147483648,o=4294967296;return Ci=function(s){var l=t(s);if(!n(l)||l===0)return 0;var h=r(l),g=e(h,o),m=g>=i?g-o:g;return m===0?0:m},Ci}var $i,rl;function vm(){if(rl)return $i;rl=1;var e=Ht(),t=at,r=wt,n=Je;return $i=function(o){var a=t(o);if(!n(a)||a===0)return 0;var s=r(a),l=e(s,256);return l>=128?l-256:l},$i}var Ni,nl;function bm(){if(nl)return Ni;nl=1;var e=Ht(),t=at,r=wt,n=Je,i=65536;return Ni=function(a){var s=t(a);if(!n(s)||s===0)return 0;var l=r(s),h=e(l,i);return h===0?0:h},Ni}var Oi,il;function wm(){if(il)return Oi;il=1;var e=Ht(),t=at,r=wt,n=Je,i=4294967296;return Oi=function(a){var s=t(a);if(!n(s)||s===0)return 0;var l=r(s),h=e(l,i);return h===0?0:h},Oi}var Pi,ol;function Tm(){if(ol)return Pi;ol=1;var e=Je,t=Ht(),r=at,n=wt;return Pi=function(o){var a=r(o);if(!e(a)||a===0)return 0;var s=n(a),l=t(s,256);return l},Pi}var Mi,al;function Sm(){if(al)return Mi;al=1;var e=z,t=Fc,r=Mc;return Mi=function(i,o,a){if(typeof i!="number"||typeof o!="number"||typeof a!="number"||!(o<=a))throw new e("Assertion failed: all three arguments must be MVs, and `lower` must be `<= upper`");return r(t(o,i),a)},Mi}var Fi,sl;function xm(){if(sl)return Fi;sl=1;var e=Sm(),t=at,r=Xo,n=Rt;return Fi=function(o){var a=t(o);if(n(a))return 0;var s=e(a,0,255),l=r(s);return s<l+.5?l:s>l+.5?l+1:l%2===0?l:l+1},Fi}var Li,ll;function Pu(){return ll||(ll=1,Li=function(t){return t===0&&1/t===-1/0}),Li}var Ri,cl;function _m(){if(cl)return Ri;cl=1;var e=jo,t=Dt,r=Bt,n=Je,i=Rt,o=Pu(),a=34028234663852886e22;return Ri=function(l,h){if(i(l))return h?[0,0,192,127]:[127,192,0,0];var g;if(l===0)return g=o(l)?128:0,h?[0,0,0,g]:[g,0,0,0];if(e(l)>a||!n(l))return g=l<0?255:127,h?[0,0,128,g]:[g,128,0,0];var m=l<0?1:0;l=e(l);for(var u=0;l>=2;)u+=1,l/=2;for(;l<1;)u-=1,l*=2;var f=l-1;f*=r(2,23)+.5,f=t(f),u+=127,u<<=23;var b=m<<31|u|f,S=b&255;b>>=8;var _=b&255;b>>=8;var N=b&255;b>>=8;var O=b&255;return h?[S,_,N,O]:[O,N,_,S]},Ri}var Di,ul;function Em(){if(ul)return Di;ul=1;var e=1075,t=54;return Di=function(n){var i="";if(n===0)return i;for(var o=e,a,s=0;s<e;s+=1)if(a=n*2,a>=1?(n=a-1,i+="1",o===e&&(o=s)):(n=a,i+="0"),a===1||s-o>t)return i;return i},Di}var Bi,fl;function Am(){if(fl)return Bi;fl=1;var e=Dt;return Bi=function(r){for(var n="",i;r>0;)i=r/2,r=e(i),i===r?n="0"+n:n="1"+n;return n},Bi}var ji,dl;function Im(){if(dl)return ji;dl=1;var e=ne,t=e("%parseInt%"),r=jo,n=Dt,i=Pu(),o=Y,a=o("String.prototype.indexOf"),s=o("String.prototype.slice"),l=Em(),h=Am(),g=1023,m="11111111111",u="00000000000",f=u+u+u+u+"0000000";return ji=function(S,_){var N=S<0||i(S)?"1":"0",O,w;if(isNaN(S))O=m,w="1"+f;else if(!isFinite(S))O=m,w="0"+f;else if(S===0)O=u,w="0"+f;else{S=r(S);var C=n(S),$=h(C),P=l(S-C),M;if($)O=$.length-1;else{var F=a(P,"1");F>-1&&(M=F+1),O=-M}w=$+P,O<0?(O<=-g&&(M=g-1),w=s(w,M)):w=s(w,1),O=s(u+h(O+g),-11),w=s(w+f+"0",0,52)}for(var d=N+O+w,I=[],T=0;T<8;T++){var v=_?8-T-1:T;I[v]=t(s(d,T*8,(T+1)*8),2)}return I},ji}var ki,pl;function Cm(){if(pl)return ki;pl=1;var e=ne,t=e("%Number%"),r=e("%BigInt%",!0);return ki=function(i,o,a){var s=typeof i=="bigint"?r:t;i<0&&(i>>>=0);for(var l=[],h=0;h<o;h++)l[a?h:o-1-h]=t(i&s(255)),i>>=s(8);return l},ki}var Ui,hl;function $m(){if(hl)return Ui;hl=1;var e=z,t=mu(),r=Xy(),n=Qy(),i=ym(),o=mm(),a=vm(),s=bm(),l=wm(),h=Tm(),g=xm(),m=_m(),u=Im(),f=Cm(),b=Wt,S={__proto__:null,$INT8:a,$UINT8:h,$UINT8C:g,$INT16:i,$UINT16:s,$INT32:o,$UINT32:l,$BIGINT64:r,$BIGUINT64:n};return Ui=function(N,O,w){if(typeof N!="string"||!t(b.size,"$"+N))throw new e("Assertion failed: `type` must be a TypedArray element type");if(typeof O!="number"&&typeof O!="bigint")throw new e("Assertion failed: `value` must be a Number or a BigInt");if(typeof w!="boolean")throw new e("Assertion failed: `isLittleEndian` must be a Boolean");if(N==="FLOAT32")return m(O,w);if(N==="FLOAT64")return u(O,w);var C=b.size["$"+N],$=S["$"+N],P=$(O);return f(P,C,w)},Ui}var Gi,gl;function Nm(){return gl||(gl=1,Gi=function(t,r){for(var n=0;n<t.length;n+=1)r(t[n],n,t)}),Gi}var Om=ne,Pm=Ke,ze=z,Mm=Tn,Fm=Om("%Uint8Array%",!0),Lm=wu(),Rm=Vt,Dm=$m(),Bm=qt,jm=hr,km=mt,qi=Wt,Um=Tu(),Gm=Nm(),qm=function(t,r,n,i,o,a){var s=jm(t);if(!Bm(t)&&!s)throw new ze("Assertion failed: `arrayBuffer` must be an ArrayBuffer or a SharedArrayBuffer");if(!Mm(r)||r<0)throw new ze("Assertion failed: `byteIndex` must be a non-negative integer");if(typeof n!="string"||!km(qi.size,"$"+n))throw new ze("Assertion failed: `type` must be one of "+qi.choices);if(typeof i!="number"&&typeof i!="bigint")throw new ze("Assertion failed: `value` must be a Number or a BigInt");if(typeof o!="boolean")throw new ze("Assertion failed: `isTypedArray` must be a boolean");if(a!=="SEQ-CST"&&a!=="UNORDERED"&&a!=="INIT")throw new ze('Assertion failed: `order` must be `"SEQ-CST"`, `"UNORDERED"`, or `"INIT"`');if(arguments.length>6&&typeof arguments[6]!="boolean")throw new ze("Assertion failed: `isLittleEndian` must be a boolean, if present");if(Rm(t))throw new ze("Assertion failed: ArrayBuffer is detached");if(Lm(n)?typeof i!="bigint":typeof i!="number")throw new ze("Assertion failed: `value` must be a BigInt if type is ~BIGINT64~ or ~BIGUINT64~, otherwise a Number");var l=qi.size["$"+n],h=arguments.length>6?arguments[6]:Um==="little",g=Dm(n,i,h);if(s)throw new Pm("SharedArrayBuffer is not supported by this implementation");var m=new Fm(t,r,l);Gm(g,function(u,f){m[f]=u})},Vm=at,Wm=wt,zm=Rt,Hm=Je,Km=function(t){var r=Vm(t);return zm(r)||r===0?0:Hm(r)?Wm(r):r},Jm=Ke,Ym=z,Zm=Tn,Xm=Gt,yl=Wt,Qo=function(t){var r=Xm(t);if(!r)throw new Ym("Assertion failed: `O` must be a TypedArray");var n=yl.size["$"+yl.name["$"+r]];if(!Zm(n)||n<0)throw new Jm("Assertion failed: Unknown TypedArray type `"+r+"`");return n},Qm=Ke,ev=z,tv=Gt,rv=Wt,nv=function(t){var r=tv(t);if(!r)throw new ev("Assertion failed: `O` must be a TypedArray");var n=rv.name["$"+r];if(typeof n!="string")throw new Qm("Assertion failed: Unknown TypedArray type `"+r+"`");return n},Ao={exports:{}},iv=ne,Vi,ml;function ea(){if(ml)return Vi;ml=1;var e=z,t=mt,r={__proto__:null,"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Get]]":!0,"[[Set]]":!0,"[[Value]]":!0,"[[Writable]]":!0};return Vi=function(i){if(!i||typeof i!="object")return!1;for(var o in i)if(t(i,o)&&!r[o])return!1;var a=t(i,"[[Value]]")||t(i,"[[Writable]]"),s=t(i,"[[Get]]")||t(i,"[[Set]]");if(a&&s)throw new e("Property Descriptors may not be both accessor and data descriptors");return!0},Vi}var Wi,vl;function ov(){if(vl)return Wi;vl=1;var e=Pc,t=Ap,r=e.hasArrayLengthDefineBug(),n=r&&bu,i=Y,o=i("Object.prototype.propertyIsEnumerable");return Wi=function(s,l,h,g,m,u){if(!t){if(!s(u)||!u["[[Configurable]]"]||!u["[[Writable]]"]||m in g&&o(g,m)!==!!u["[[Enumerable]]"])return!1;var f=u["[[Value]]"];return g[m]=f,l(g[m],f)}return r&&m==="length"&&"[[Value]]"in u&&n(g)&&g.length!==u["[[Value]]"]?(g.length=u["[[Value]]"],g.length===u["[[Value]]"]):(t(g,m,h(u)),!0)},Wi}var zi,bl;function av(){return bl||(bl=1,zi=function(t){if(typeof t>"u")return t;var r={};return"[[Value]]"in t&&(r.value=t["[[Value]]"]),"[[Writable]]"in t&&(r.writable=!!t["[[Writable]]"]),"[[Get]]"in t&&(r.get=t["[[Get]]"]),"[[Set]]"in t&&(r.set=t["[[Set]]"]),"[[Enumerable]]"in t&&(r.enumerable=!!t["[[Enumerable]]"]),"[[Configurable]]"in t&&(r.configurable=!!t["[[Configurable]]"]),r}),zi}var Hi,wl;function sv(){if(wl)return Hi;wl=1;var e=z,t=ea(),r=av();return Hi=function(i){if(typeof i<"u"&&!t(i))throw new e("Assertion failed: `Desc` must be a Property Descriptor");return r(i)},Hi}var Ki,Tl;function lv(){if(Tl)return Ki;Tl=1;var e=z,t=mt,r=ea();return Ki=function(i){if(typeof i>"u")return!1;if(!r(i))throw new e("Assertion failed: `Desc` must be a Property Descriptor");return!(!t(i,"[[Value]]")&&!t(i,"[[Writable]]"))},Ki}var Mu=bn,Ji,Sl;function cv(){return Sl||(Sl=1,Ji=function(t){return!!t}),Ji}var Yi,xl;function uv(){if(xl)return Yi;xl=1;var e=mt,t=z,r=ot,n=Mu,i=cv();return Yi=function(a){if(!r(a))throw new t("ToPropertyDescriptor requires an object");var s={};if(e(a,"enumerable")&&(s["[[Enumerable]]"]=i(a.enumerable)),e(a,"configurable")&&(s["[[Configurable]]"]=i(a.configurable)),e(a,"value")&&(s["[[Value]]"]=a.value),e(a,"writable")&&(s["[[Writable]]"]=i(a.writable)),e(a,"get")){var l=a.get;if(typeof l<"u"&&!n(l))throw new t("getter must be a function");s["[[Get]]"]=l}if(e(a,"set")){var h=a.set;if(typeof h<"u"&&!n(h))throw new t("setter must be a function");s["[[Set]]"]=h}if((e(s,"[[Get]]")||e(s,"[[Set]]"))&&(e(s,"[[Value]]")||e(s,"[[Writable]]")))throw new t("Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");return s},Yi}var Zi,_l;function fv(){if(_l)return Zi;_l=1;var e=z,t=ot,r=ea(),n=ov(),i=sv(),o=lv(),a=wn,s=Su,l=uv();return Zi=function(g,m,u){if(!t(g))throw new e("Assertion failed: Type(O) is not Object");if(!a(m))throw new e("Assertion failed: P is not a Property Key");var f=r(u)?u:l(u);if(!r(f))throw new e("Assertion failed: Desc is not a valid Property Descriptor");return n(o,s,i,g,m,f)},Zi}var dv=iv,El=dv("%Reflect.construct%",!0),Jr=fv();try{Jr({},"",{"[[Get]]":function(){}})}catch{Jr=null}if(Jr&&El){var Al={},Il={};Jr(Il,"length",{"[[Get]]":function(){throw Al},"[[Enumerable]]":!0}),Ao.exports=function(t){try{El(t,Il)}catch(r){return r===Al}}}else Ao.exports=function(t){return typeof t=="function"&&!!t.prototype};var Fu=Ao.exports,pv=ne,Cl=pv("%Symbol.species%",!0),Xi=z,$l=ot,hv=Fu,gv=function(t,r){if(!$l(t))throw new Xi("Assertion failed: Type(O) is not Object");var n=t.constructor;if(typeof n>"u")return r;if(!$l(n))throw new Xi("O.constructor is not an Object");var i=Cl?n[Cl]:void 0;if(i==null)return r;if(hv(i))return i;throw new Xi("no constructor found")},yv=z,Lu=Y,Nl=Lu("%ArrayBuffer.prototype.resizable%",!0),Ol=Lu("%SharedArrayBuffer.prototype.growable%",!0),mv=qt,vv=hr,Ru=function(t){var r=mv(t),n=vv(t);if(!r&&!n)throw new yv("Assertion failed: `arrayBuffer` must be an ArrayBuffer or SharedArrayBuffer");return r&&Nl?!Nl(t):n&&Ol?!Ol(t):!0},bv=Tn,Pl=mt,wv=zt,Tv=bv,Du=function(t){return!!t&&typeof t=="object"&&Pl(t,"[[Object]]")&&Pl(t,"[[CachedBufferByteLength]]")&&(Tv(t["[[CachedBufferByteLength]]"])&&t["[[CachedBufferByteLength]]"]>=0||t["[[CachedBufferByteLength]]"]==="DETACHED")&&wv(t["[[Object]]"])},Sv=ot,Bu=Y,xv=Bu("String.prototype.valueOf"),_v=function(t){try{return xv(t),!0}catch{return!1}},Ev=Bu("Object.prototype.toString"),Av="[object String]",Iv=yt(),Cv=function(t){return typeof t=="string"?!0:!t||typeof t!="object"?!1:Iv?_v(t):Ev(t)===Av},ju=Y,$v=ju("Number.prototype.toString"),Nv=function(t){try{return $v(t),!0}catch{return!1}},Ov=ju("Object.prototype.toString"),Pv="[object Number]",Mv=yt(),Fv=function(t){return typeof t=="number"?!0:!t||typeof t!="object"?!1:Mv?Nv(t):Ov(t)===Pv},ku=Y,Lv=ku("Boolean.prototype.toString"),Rv=ku("Object.prototype.toString"),Dv=function(t){try{return Lv(t),!0}catch{return!1}},Bv="[object Boolean]",jv=yt(),kv=function(t){return typeof t=="boolean"?!0:t===null||typeof t!="object"?!1:jv?Dv(t):Rv(t)===Bv},Io={exports:{}},Ml=typeof BigInt<"u"&&BigInt,Uv=function(){return typeof Ml=="function"&&typeof BigInt=="function"&&typeof Ml(42)=="bigint"&&typeof BigInt(42)=="bigint"},Gv=Uv();if(Gv){var qv=BigInt.prototype.valueOf,Vv=function(t){try{return qv.call(t),!0}catch{}return!1};Io.exports=function(t){return t===null||typeof t>"u"||typeof t=="boolean"||typeof t=="string"||typeof t=="number"||typeof t=="symbol"||typeof t=="function"?!1:typeof t=="bigint"?!0:Vv(t)}}else Io.exports=function(t){return!1};var Wv=Io.exports,zv=Cv,Hv=Fv,Kv=kv,Jv=xu(),Yv=Wv,Zv=function(t){if(t==null||typeof t!="object"&&typeof t!="function")return null;if(zv(t))return"String";if(Hv(t))return"Number";if(Kv(t))return"Boolean";if(Jv(t))return"Symbol";if(Yv(t))return"BigInt"},ta=typeof Map=="function"&&Map.prototype?Map:null,Xv=typeof Set=="function"&&Set.prototype?Set:null,Yr;ta||(Yr=function(t){return!1});var Uu=ta?Map.prototype.has:null,Fl=Xv?Set.prototype.has:null;!Yr&&!Uu&&(Yr=function(t){return!1});var Qv=Yr||function(t){if(!t||typeof t!="object")return!1;try{if(Uu.call(t),Fl)try{Fl.call(t)}catch{return!0}return t instanceof ta}catch{}return!1},e0=typeof Map=="function"&&Map.prototype?Map:null,ra=typeof Set=="function"&&Set.prototype?Set:null,Zr;ra||(Zr=function(t){return!1});var Ll=e0?Map.prototype.has:null,Gu=ra?Set.prototype.has:null;!Zr&&!Gu&&(Zr=function(t){return!1});var t0=Zr||function(t){if(!t||typeof t!="object")return!1;try{if(Gu.call(t),Ll)try{Ll.call(t)}catch{return!0}return t instanceof ra}catch{}return!1},Xr=typeof WeakMap=="function"&&WeakMap.prototype?WeakMap:null,Rl=typeof WeakSet=="function"&&WeakSet.prototype?WeakSet:null,Qr;Xr||(Qr=function(t){return!1});var Co=Xr?Xr.prototype.has:null,Qi=Rl?Rl.prototype.has:null;!Qr&&!Co&&(Qr=function(t){return!1});var r0=Qr||function(t){if(!t||typeof t!="object")return!1;try{if(Co.call(t,Co),Qi)try{Qi.call(t,Qi)}catch{return!0}return t instanceof Xr}catch{}return!1},$o={exports:{}},n0=ne,qu=Y,i0=n0("%WeakSet%",!0),eo=qu("WeakSet.prototype.has",!0);if(eo){var to=qu("WeakMap.prototype.has",!0);$o.exports=function(t){if(!t||typeof t!="object")return!1;try{if(eo(t,eo),to)try{to(t,to)}catch{return!0}return t instanceof i0}catch{}return!1}}else $o.exports=function(t){return!1};var o0=$o.exports,a0=Qv,s0=t0,l0=r0,c0=o0,u0=function(t){if(t&&typeof t=="object"){if(a0(t))return"Map";if(s0(t))return"Set";if(l0(t))return"WeakMap";if(c0(t))return"WeakSet"}return!1},f0={}.toString,d0=Array.isArray||function(e){return f0.call(e)=="[object Array]"},p0=Y,h0=p0("WeakRef.prototype.deref",!0),g0=typeof WeakRef>"u"?function(t){return!1}:function(t){if(!t||typeof t!="object")return!1;try{return h0(t),!0}catch{return!1}},y0=Y,Dl=y0("FinalizationRegistry.prototype.register",!0),m0=Dl?function(t){if(!t||typeof t!="object")return!1;try{return Dl(t,{},null),!0}catch{return!1}}:function(t){return!1},Vu=bn,v0=mt,b0=Lc(),na=Y,Wu=na("Function.prototype.toString"),zu=na("String.prototype.match"),ro=na("Object.prototype.toString"),w0=/^class /,T0=function(t){if(Vu(t)||typeof t!="function")return!1;try{var r=zu(Wu(t),w0);return!!r}catch{}return!1},S0=/\s*function\s+([^(\s]*)\s*/,x0=!(0 in[,]),_0="[object Object]",E0="[object HTMLAllCollection]",A0=Function.prototype,Hu=function(){return!1};if(typeof document=="object"){var I0=document.all;ro(I0)===ro(document.all)&&(Hu=function(t){if((x0||!t)&&(typeof t>"u"||typeof t=="object"))try{var r=ro(t);return(r===E0||r===_0)&&t("")==null}catch{}return!1})}var Ku=function(){if(Hu(this)||!T0(this)&&!Vu(this))throw new TypeError("Function.prototype.name sham getter called on non-function");if(b0&&v0(this,"name"))return this.name;if(this===A0)return"";var t=Wu(this),r=zu(t,S0),n=r&&r[1];return n},C0=Ku,Ju=function(){return C0},$0=fr.supportsDescriptors,N0=Lc(),O0=Ju,Bl=Object.defineProperty,P0=TypeError,M0=function(){var t=O0();if(N0)return t;if(!$0)throw new P0("Shimming Function.prototype.name support requires ES5 property descriptor support.");var r=Function.prototype;return Bl(r,"name",{configurable:!0,enumerable:!1,get:function(){var n=t.call(this);return this!==r&&Bl(this,"name",{configurable:!0,enumerable:!1,value:n,writable:!1}),n}}),t},F0=fr,L0=rt,Yu=Ku,R0=Ju,D0=M0,Zu=L0(Yu);F0(Zu,{getPolyfill:R0,implementation:Yu,shim:D0});var B0=Zu,no,jl;function j0(){if(jl)return no;jl=1;const e=(function*(){}).constructor;return no=()=>e,no}var Xu=Y,k0=Sn(),U0=k0(/^\s*(?:function)?\*/),G0=yt(),kl=Lt,q0=Xu("Object.prototype.toString"),V0=Xu("Function.prototype.toString"),W0=j0(),z0=function(t){if(typeof t!="function")return!1;if(U0(V0(t)))return!0;if(!G0){var r=q0(t);return r==="[object GeneratorFunction]"}if(!kl)return!1;var n=W0();return n&&kl(t)===n.prototype},io,Ul;function H0(){if(Ul)return io;Ul=1;const e=(async function(){}).constructor;return io=()=>e,io}var Qu=Y,K0=Sn(),J0=Qu("Object.prototype.toString"),Y0=Qu("Function.prototype.toString"),Z0=K0(/^\s*async(?:\s+function(?:\s+|\()|\s*\()/),X0=yt(),Gl=Lt,Q0=H0(),eb=function(t){if(typeof t!="function")return!1;if(Z0(Y0(t)))return!0;if(!X0){var r=J0(t);return r==="[object AsyncFunction]"}if(!Gl)return!1;var n=Q0();return n&&n.prototype===Gl(t)},tb=Zv,rb=u0,nb=Gt,ib=d0,ob=Oc,ab=Nc,sb=g0,lb=m0,cb=B0,ub=z0,fb=eb,db=Y,pb=yt(),oo=pb&&Symbol.toStringTag,hb=Object,ql=db("Promise.prototype.then",!0),gb=function(t){if(!t||typeof t!="object"||!ql)return!1;try{return ql(t,null,function(){}),!0}catch{}return!1},Vl=function(t){return!!t&&t!=="BigInt"&&t!=="Boolean"&&t!=="Null"&&t!=="Number"&&t!=="String"&&t!=="Symbol"&&t!=="Undefined"&&t!=="Math"&&t!=="JSON"&&t!=="Reflect"&&t!=="Atomics"&&t!=="Map"&&t!=="Set"&&t!=="WeakMap"&&t!=="WeakSet"&&t!=="BigInt64Array"&&t!=="BigUint64Array"&&t!=="Float32Array"&&t!=="Float64Array"&&t!=="Int16Array"&&t!=="Int32Array"&&t!=="Int8Array"&&t!=="Uint16Array"&&t!=="Uint32Array"&&t!=="Uint8Array"&&t!=="Uint8ClampedArray"&&t!=="Array"&&t!=="Date"&&t!=="FinalizationRegistry"&&t!=="Promise"&&t!=="RegExp"&&t!=="WeakRef"&&t!=="Function"&&t!=="GeneratorFunction"&&t!=="AsyncFunction"},yb=function(t){if(t==null)return t;var r=tb(hb(t))||rb(t)||nb(t);if(r)return r;if(ib(t))return"Array";if(ob(t))return"Date";if(ab(t))return"RegExp";if(sb(t))return"WeakRef";if(lb(t))return"FinalizationRegistry";if(typeof t=="function")return ub(t)?"GeneratorFunction":fb(t)?"AsyncFunction":"Function";if(gb(t))return"Promise";if(oo&&oo in t){var n=t[oo];if(Vl(n))return n}if(typeof t.constructor=="function"){var i=cb(t.constructor);if(Vl(i))return i}return"Object"},mb=ne,vb=Mu,bb=Sv,wb=yb,Tb=z,Wl=Lt,Sb=Ip,xb=function(t){if(!bb(t))throw new Tb("Reflect.getPrototypeOf called on non-object");if(Wl)return Wl(t);var r=wb(t);if(r){var n=mb("%"+r+".prototype%",!0);if(n)return n}return vb(t.constructor)?t.constructor.prototype:t instanceof Object?Sb.prototype:null},_b=xb,zl=Lt,ef=function(){return typeof Reflect=="object"&&Reflect&&Reflect.getPrototypeOf?Reflect.getPrototypeOf:zl?function(r){return zl(r)}:_b},tf=Wo,Eb=rt,Ab=ef(),Ib=pr(),No={__proto__:null},$r=cn,Hl=Object.defineProperty;if($r){var Cb=function(e){return e.byteOffset};tf(Ib,function(e){if(typeof window[e]=="function"||typeof window[e]=="object"){var t=window[e].prototype,r=$r(t,"byteOffset");if(!r){var n=Ab(t);r=$r(n,"byteOffset")}if(r&&r.get)No[e]=Eb(r.get);else if(Hl){var i=new window[e](2);r=$r(i,"byteOffset"),r&&r.configurable&&Hl(i,"length",{value:3}),i.length===2&&(No[e]=Cb)}}})}var $b=function(t){var r;return tf(No,function(n){if(typeof r!="number")try{var i=n(t);typeof i=="number"&&(r=i)}catch{}}),r},Nb=zt,ia=function(t){return Nb(t)?$b(t):!1},Ob=rt,rf=Wo,Nr=cn,Pb=zt,Mb=au,Fb=ef(),Oo={__proto__:null},Kl=Object.defineProperty;if(Nr){var Lb=function(e){return e.length};rf(Mb,function(e){var t=window[e];if(typeof t=="function"||typeof t=="object"){var r=t.prototype,n=Nr(r,"length");if(!n){var i=Fb(r);n=Nr(i,"length")}if(n&&n.get)Oo["$"+e]=Ob(n.get);else if(Kl){var o=new window[e](2);n=Nr(o,"length"),n&&n.configurable&&Kl(o,"length",{value:3}),o.length===2&&(Oo["$"+e]=Lb)}}})}var Rb=function(t){var r;return rf(Oo,function(n){if(typeof r!="number")try{var i=n(t);typeof i=="number"&&(r=i)}catch{}}),r},nf=function(t){return Pb(t)?Rb(t):!1},Jl=z,Db=Vt,Bb=Ru,jb=Qo,kb=Du,Yl=gr,Ub=ia,Gb=nf,oa=function(t){if(!kb(t))throw new Jl("Assertion failed: `taRecord` must be a TypedArray With Buffer Witness Record");var r=t["[[Object]]"],n=t["[[CachedBufferByteLength]]"];if(Db(Yl(r))&&n!=="DETACHED")throw new Jl("Assertion failed: typed array is detached only if the byte length is ~DETACHED~");if(n==="DETACHED")return!0;var i=Ub(r),o=Bb(Yl(r)),a,s=o?Gb(r):"AUTO";if(s==="AUTO")a=n;else{var l=jb(r);a=i+s*l}return i>n||a>n},Or=z,qb=Xo,Vb=Ru,Wb=oa,zb=Qo,Hb=Du,Kb=gr,Jb=ia,Yb=nf,Zb=function(t){if(!Hb(t))throw new Or("Assertion failed: `taRecord` must be a TypedArray With Buffer Witness Record");if(Wb(t))throw new Or("Assertion failed: `taRecord` is out of bounds");var r=t["[[Object]]"],n=Vb(Kb(r)),i=n?Yb(r):"AUTO";if(i!=="AUTO")return i;if(n)throw new Or("Assertion failed: array buffer is not fixed length");var o=Jb(r),a=zb(r),s=t["[[CachedBufferByteLength]]"];if(s==="DETACHED")throw new Or("Assertion failed: typed array is detached");return qb((s-o)/a)},ao=z,Xb=Vt,Qb=qt,ew=hr,tw=yu,rw=Y,nw=rw("SharedArrayBuffer.prototype.byteLength",!0),iw=function(t,r){var n=ew(t);if(!Qb(t)&&!n)throw new ao("Assertion failed: `arrayBuffer` must be an ArrayBuffer or a SharedArrayBuffer");if(r!=="SEQ-CST"&&r!=="UNORDERED")throw new ao("Assertion failed: `order` must be ~SEQ-CST~ or ~UNORDERED~");if(Xb(t))throw new ao("Assertion failed: `arrayBuffer` must not be detached");return n?nw(t):tw(t)},Zl=z,ow=iw,aw=Vt,sw=zt,lw=gr,cw=function(t,r){if(!sw(t))throw new Zl("Assertion failed: `obj` must be a Typed Array");if(r!=="SEQ-CST"&&r!=="UNORDERED")throw new Zl("Assertion failed: `order` must be ~SEQ-CST~ or ~UNORDERED~");var n=lw(t),i=aw(n)?"DETACHED":ow(n,r);return{"[[Object]]":t,"[[CachedBufferByteLength]]":i}},Pr=z,uw=ot,fw=oa,dw=cw,pw=zt,of=function(t,r){if(r!=="SEQ-CST"&&r!=="UNORDERED")throw new Pr("Assertion failed: `order` must be ~SEQ-CST~ or ~UNORDERED~");if(!uw(t))throw new Pr("Assertion failed: `O` must be an Object");if(!pw(t))throw new Pr("Assertion failed: `O` must be a Typed Array");var n=dw(t,r);if(fw(n))throw new Pr("`O` must be in-bounds and backed by a non-detached buffer");return n},hw=Ke,Mr=z,gw=Zo,yw=Fu,mw=oa,vw=Zb,bw=of,ww=pr(),Tw=function(t,r){if(!yw(t))throw new Mr("Assertion failed: `constructor` must be a constructor");if(!gw(r))throw new Mr("Assertion failed: `argumentList` must be a List");if(ww.length===0)throw new hw("Assertion failed: Typed Arrays are not supported in this environment");var n;r.length===0?n=new t:r.length===1?n=new t(r[0]):r.length===2?n=new t(r[0],r[1]):n=new t(r[0],r[1],r[2]);var i=bw(n,"SEQ-CST");if(r.length===1&&typeof r[0]=="number"){if(mw(i))throw new Mr("new Typed Array is out of bounds");var o=vw(i);if(o<r[0])throw new Mr("`argumentList[0]` must be <= `newTypedArray.length`")}return n},Ae=ne,Sw={__proto__:null,$Int8Array:Ae("%Int8Array%",!0),$Uint8Array:Ae("%Uint8Array%",!0),$Uint8ClampedArray:Ae("%Uint8ClampedArray%",!0),$Int16Array:Ae("%Int16Array%",!0),$Uint16Array:Ae("%Uint16Array%",!0),$Int32Array:Ae("%Int32Array%",!0),$Uint32Array:Ae("%Uint32Array%",!0),$BigInt64Array:Ae("%BigInt64Array%",!0),$BigUint64Array:Ae("%BigUint64Array%",!0),$Float16Array:Ae("%Float16Array%",!0),$Float32Array:Ae("%Float32Array%",!0),$Float64Array:Ae("%Float64Array%",!0)},xw=function(t){return Sw["$"+t]},Xl=Ke,Ql=z,_w=Gt,Ew=pr(),Aw=Zo,Iw=gv,Cw=Tw,$w=xw,Nw=function(t,r){if(Ew.length===0)throw new Xl("Assertion failed: Typed Arrays are not supported in this environment");var n=_w(t);if(!n)throw new Ql("Assertion failed: exemplar must be a TypedArray");if(!Aw(r))throw new Ql("Assertion failed: `argumentList` must be a List");var i=$w(n);if(typeof i!="function")throw new Xl("Assertion failed: `constructor` of `exemplar` ("+n+") must exist. Please report this!");var o=Iw(t,i);return Cw(o,r)},Ow=z,Pw=ey,Mw=Wy,Fw=Vt,so=Fc,ec=Mc,Lw=Ky,Rw=qm,tc=Km,rc=$u,Dw=Qo,nc=nv,Bw=Nw,jw=of,lo=gr,ic=ia,af=function(t,r){var n=this;jw(n,"SEQ-CST");var i=n.length,o=tc(t),a;o===-1/0?a=0:o<0?a=so(i+o,0):a=ec(o,i);var s=typeof r>"u"?i:tc(r),l;s===-1/0?l=0:s<0?l=so(i+s,0):l=ec(s,i);var h=so(l-a,0),g=Bw(n,[h]);if(h>0){if(Fw(lo(n)))throw new Ow("Cannot use a Typed Array with an underlying ArrayBuffer that is detached");var m=nc(n),u=nc(g);if(m===u)for(var f=lo(n),b=lo(g),S=Dw(n),_=ic(n),N=a*S+_,O=ic(g),w=O+h*S;O<w;){var C=Mw(f,N,"UINT8",!0,"UNORDERED");Rw(b,O,"UINT8",C,!0,"UNORDERED"),N+=1,O+=1}else for(var $=0;a<l;){var P=rc(a),M=Pw(n,P);Lw(g,rc($),M,!0),a+=1,$+=1}}return g},kw=af,sf=function(){return typeof Uint8Array=="function"&&Uint8Array.prototype.slice||kw},Uw=fr,Gw=Lt,qw=sf,Vw=function(){if(typeof Uint8Array=="function"){var t=qw(),r=Gw(Uint8Array.prototype);Uw(r,{slice:t},{slice:function(){return r.slice!==t}})}return t},Ww=fr,zw=rt,Hw=af,lf=sf,Kw=Vw,cf=zw(lf());Ww(cf,{getPolyfill:lf,implementation:Hw,shim:Kw});var Jw=cf,uf=Gt,ff=Jw,oc=cn;function Kt(e){return Object.prototype.toString.call(e)}function Yw(e){return Kt(e)==="[object Date]"}function Zw(e){return Kt(e)==="[object RegExp]"}function Xw(e){return Kt(e)==="[object Error]"}function Qw(e){return Kt(e)==="[object Boolean]"}function eT(e){return Kt(e)==="[object Number]"}function tT(e){return Kt(e)==="[object String]"}var df=Array.isArray||function(t){return Object.prototype.toString.call(t)==="[object Array]"};function xn(e,t){if(e.forEach)return e.forEach(t);for(var r=0;r<e.length;r++)t(e[r],r,e)}var _n=Object.keys||function(t){var r=[];for(var n in t)r[r.length]=n;return r},rT=Object.prototype.propertyIsEnumerable,ac=Object.getOwnPropertySymbols;function En(e){var t=_n(e);if(ac)for(var r=ac(e),n=0;n<r.length;n++)rT.call(e,r[n])&&(t[t.length]=r[n]);return t}var An=Object.prototype.hasOwnProperty||function(e,t){return t in e};function nT(e,t){if(typeof oc!="function")return!0;var r=oc(e,t);return!r||!r.writable}function pf(e,t){if(typeof e=="object"&&e!==null){var r;if(df(e))r=[];else if(Yw(e))r=new Date(e.getTime?e.getTime():e);else if(Zw(e))r=new RegExp(e);else if(Xw(e))r={message:e.message};else if(Qw(e)||eT(e)||tT(e))r=Object(e);else{var n=uf(e);if(n)return ff(e);if(Object.create&&Object.getPrototypeOf)r=Object.create(Object.getPrototypeOf(e));else if(e.constructor===Object)r={};else{var i=e.constructor&&e.constructor.prototype||e.__proto__||{},o=function(){};o.prototype=i,r=new o}}var a=t.includeSymbols?En:_n;return xn(a(e),function(s){r[s]=e[s]}),r}return e}var aa={__proto__:null};function hf(e,t){var r=[],n=[],i=!0,o=arguments.length>2?arguments[2]:aa,a=o.includeSymbols?En:_n,s=!!o.immutable;return function l(h){var g=s?pf(h,o):h,m={__proto__:null},u=!0,f={node:g,node_:h,path:[].concat(r),parent:n[n.length-1],parents:n,key:r[r.length-1],removedKeys:{__proto__:null},isRoot:r.length===0,level:r.length,circular:null,update:function(_,N){f.isRoot||(f.parent.node[f.key]=_),f.node=_,N&&(u=!1)},delete:function(_){delete f.parent.node[f.key],f.parent.removedKeys[f.key]=!0,_&&(u=!1)},remove:function(_){df(f.parent.node)?(f.parent.node.splice(f.key,1),f.parent.removedKeys[f.key]=!0,_&&(u=!1)):f.delete(_)},keys:null,before:function(_){m.before=_},after:function(_){m.after=_},pre:function(_){m.pre=_},post:function(_){m.post=_},stop:function(){i=!1},block:function(){u=!1}};if(!i)return f;function b(){if(typeof f.node=="object"&&f.node!==null){(!f.keys||f.node_!==f.node)&&(f.keys=a(f.node)),f.isLeaf=f.keys.length===0;for(var _=0;_<n.length;_++)if(n[_].node_===h){f.circular=n[_];break}}else f.isLeaf=!0,f.keys=null;f.notLeaf=!f.isLeaf,f.notRoot=!f.isRoot}b();var S=t.call(f,f.node);return S!==void 0&&f.update&&f.update(S),m.before&&m.before.call(f,f.node),u&&(typeof f.node=="object"&&f.node!==null&&!f.circular&&(n[n.length]=f,b(),xn(f.keys,function(_,N){var O=N-1 in f.removedKeys;O&&(_=f.keys[N-1]),r[r.length]=_,m.pre&&m.pre.call(f,f.node[_],_);var w=l(f.node[_]);s&&An.call(f.node,_)&&!nT(f.node,_)&&!O&&(f.node[_]=w.node),w.isLast=N===f.keys.length-1,w.isFirst=N===0,m.post&&m.post.call(f,w),r.pop()}),n.pop()),m.after&&m.after.call(f,f.node)),f}(e).node}function Ie(e){this.options=arguments.length>1?arguments[1]:aa,this.value=e}Ie.prototype.get=function(e){for(var t=this.value,r=0;t&&r<e.length;r++){var n=e[r];if(!An.call(t,n)||!this.options.includeSymbols&&typeof n=="symbol")return;t=t[n]}return t};Ie.prototype.has=function(e){var t=this.value;if(!t&&e.length>0)return!1;for(var r=0;t&&r<e.length;r++){var n=e[r];if(!An.call(t,n)||!this.options.includeSymbols&&typeof n=="symbol")return!1;t=t[n]}return!0};Ie.prototype.set=function(e,t){for(var r=this.value,n=0;n<e.length-1;n++){var i=e[n];An.call(r,i)||(r[i]={}),r=r[i]}return r[e[n]]=t,t};Ie.prototype.map=function(e){return hf(this.value,e,{__proto__:null,immutable:!0,includeSymbols:!!this.options.includeSymbols})};Ie.prototype.forEach=function(e){return this.value=hf(this.value,e,this.options),this.value};Ie.prototype.reduce=function(e,t){var r=arguments.length===1,n=r?this.value:t;return this.forEach(function(i){(!this.isRoot||!r)&&(n=e.call(this,n,i))}),n};Ie.prototype.paths=function(){var e=[];return this.forEach(function(){e[e.length]=this.path}),e};Ie.prototype.nodes=function(){var e=[];return this.forEach(function(){e[e.length]=this.node}),e};Ie.prototype.clone=function(){var e=[],t=[],r=this.options;return uf(this.value)?ff(this.value):function n(i){for(var o=0;o<e.length;o++)if(e[o]===i)return t[o];if(typeof i=="object"&&i!==null){var a=pf(i,r);e[e.length]=i,t[t.length]=a;var s=r.includeSymbols?En:_n;return xn(s(i),function(l){a[l]=n(i[l])}),e.pop(),t.pop(),a}return i}(this.value)};function gf(e){var t=arguments.length>1?arguments[1]:aa;return new Ie(e,t)}xn(En(Ie.prototype),function(e){gf[e]=function(t){var r=[].slice.call(arguments,1),n=new Ie(t);return n[e].apply(n,r)}});var iT=gf,oT=we;function we(e){if(!(this instanceof we))return new we(e);this._bbox=e||[1/0,1/0,-1/0,-1/0],this._valid=!!e}we.prototype.include=function(e){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],e[0]),this._bbox[1]=Math.min(this._bbox[1],e[1]),this._bbox[2]=Math.max(this._bbox[2],e[0]),this._bbox[3]=Math.max(this._bbox[3],e[1]),this};we.prototype.equals=function(e){var t;return e instanceof we?t=e.bbox():t=e,this._bbox[0]==t[0]&&this._bbox[1]==t[1]&&this._bbox[2]==t[2]&&this._bbox[3]==t[3]};we.prototype.center=function(e){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null};we.prototype.union=function(e){this._valid=!0;var t;return e instanceof we?t=e.bbox():t=e,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[2]),this._bbox[3]=Math.max(this._bbox[3],t[3]),this};we.prototype.bbox=function(){return this._valid?this._bbox:null};we.prototype.contains=function(e){if(!e)return this._fastContains();if(!this._valid)return null;var t=e[0],r=e[1];return this._bbox[0]<=t&&this._bbox[1]<=r&&this._bbox[2]>=t&&this._bbox[3]>=r};we.prototype.intersect=function(e){if(!this._valid)return null;var t;return e instanceof we?t=e.bbox():t=e,!(this._bbox[0]>t[2]||this._bbox[2]<t[0]||this._bbox[3]<t[1]||this._bbox[1]>t[3])};we.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var e="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",e)};we.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var aT=Zh,sT=iT,lT=oT,yf={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},cT=Object.keys(yf);vn.exports=function(e){return sa(e).bbox()};vn.exports.polygon=function(e){return sa(e).polygon()};vn.exports.bboxify=function(e){return sT(e).map(function(t){if(t){var r=cT.some(function(n){return t[n]?yf[n].indexOf(t.type)!==-1:!1});r&&(t.bbox=sa(t).bbox(),this.update(t))}})};function sa(e){for(var t=lT(),r=aT(e),n=0;n<r.length;n++)t.include(r[n]);return t}var uT=vn.exports;const fT=uT,dT=J,{LAT_MIN:Fr,LAT_MAX:Lr,LAT_RENDERED_MIN:sc,LAT_RENDERED_MAX:lc,LNG_MIN:cc,LNG_MAX:uc}=dT;var la=function(e,t){let r=Fr,n=Lr,i=Fr,o=Lr,a=uc,s=cc;e.forEach(h=>{const g=fT(h),m=g[1],u=g[3],f=g[0],b=g[2];m>r&&(r=m),u<n&&(n=u),u>i&&(i=u),m<o&&(o=m),f<a&&(a=f),b>s&&(s=b)});const l=t;return r+l.lat>lc&&(l.lat=lc-r),i+l.lat>Lr&&(l.lat=Lr-i),n+l.lat<sc&&(l.lat=sc-n),o+l.lat<Fr&&(l.lat=Fr-o),a+l.lng<=cc&&(l.lng+=Math.ceil(Math.abs(l.lng)/360)*360),s+l.lng>=uc&&(l.lng-=Math.ceil(Math.abs(l.lng)/360)*360),l};const pT=la,At=J;var In=function(e,t){const r=pT(e.map(n=>n.toGeoJSON()),t);e.forEach(n=>{const i=n.getCoordinates(),o=h=>{const g={lng:h[0]+r.lng,lat:h[1]+r.lat};return[g.lng,g.lat]},a=h=>h.map(g=>o(g)),s=h=>h.map(g=>a(g));let l;n.type===At.geojsonTypes.POINT?l=o(i):n.type===At.geojsonTypes.LINE_STRING||n.type===At.geojsonTypes.MULTI_POINT?l=i.map(o):n.type===At.geojsonTypes.POLYGON||n.type===At.geojsonTypes.MULTI_LINE_STRING?l=i.map(a):n.type===At.geojsonTypes.MULTI_POLYGON&&(l=i.map(s)),n.incomingCoords(l)})};const gt=kt,ca=qh,hT=mn,gT=fn,en=Ut,yT=In,ae=J,X={};X.onSetup=function(e){const t={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoveing:!1,canDragMove:!1,initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(t.initiallySelectedFeatureIds.filter(r=>this.getFeature(r)!==void 0)),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),t};X.fireUpdate=function(){this.map.fire(ae.events.UPDATE,{action:ae.updateActions.MOVE,features:this.getSelected().map(e=>e.toGeoJSON())})};X.fireActionable=function(){const e=this.getSelected(),t=e.filter(o=>this.isInstanceOf("MultiFeature",o));let r=!1;if(e.length>1){r=!0;const o=e[0].type.replace("Multi","");e.forEach(a=>{a.type.replace("Multi","")!==o&&(r=!1)})}const n=t.length>0,i=e.length>0;this.setActionableState({combineFeatures:r,uncombineFeatures:n,trash:i})};X.getUniqueIds=function(e){return e.length?e.map(r=>r.properties.id).filter(r=>r!==void 0).reduce((r,n)=>(r.add(n),r),new gT).values():[]};X.stopExtendedInteractions=function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1};X.onStop=function(){en.enable(this)};X.onMouseMove=function(e){return this.stopExtendedInteractions(e)};X.onMouseOut=function(e){if(e.dragMoving)return this.fireUpdate()};X.onTap=X.onClick=function(e,t){if(gt.noTarget(t))return this.clickAnywhere(e,t);if(gt.isOfMetaType(ae.meta.VERTEX)(t))return this.clickOnVertex(e,t);if(gt.isFeature(t))return this.clickOnFeature(e,t)};X.clickAnywhere=function(e){const t=this.getSelectedIds();t.length&&(this.clearSelectedFeatures(),t.forEach(r=>this.doRender(r))),en.enable(this),this.stopExtendedInteractions(e)};X.clickOnVertex=function(e,t){this.changeMode(ae.modes.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat}),this.updateUIClasses({mouse:ae.cursors.MOVE})};X.startOnActiveFeature=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(t.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=t.lngLat};X.clickOnFeature=function(e,t){en.disable(this),this.stopExtendedInteractions(e);const r=gt.isShiftDown(t),n=this.getSelectedIds(),i=t.featureTarget.properties.id,o=this.isSelected(i);if(!r&&o&&this.getFeature(i).type!==ae.geojsonTypes.POINT)return this.changeMode(ae.modes.DIRECT_SELECT,{featureId:i});o&&r?(this.deselect(i),this.updateUIClasses({mouse:ae.cursors.POINTER}),n.length===1&&en.enable(this)):!o&&r?(this.select(i),this.updateUIClasses({mouse:ae.cursors.MOVE})):!o&&!r&&(n.forEach(a=>this.doRender(a)),this.setSelected(i),this.updateUIClasses({mouse:ae.cursors.MOVE})),this.doRender(i)};X.onMouseDown=function(e,t){if(gt.isActiveFeature(t))return this.startOnActiveFeature(e,t);if(this.drawConfig.boxSelect&&gt.isShiftMousedown(t))return this.startBoxSelect(e,t)};X.startBoxSelect=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=ca(t.originalEvent,this.map.getContainer()),e.canBoxSelect=!0};X.onTouchStart=function(e,t){if(gt.isActiveFeature(t))return this.startOnActiveFeature(e,t)};X.onDrag=function(e,t){if(e.canDragMove)return this.dragMove(e,t);if(this.drawConfig.boxSelect&&e.canBoxSelect)return this.whileBoxSelect(e,t)};X.whileBoxSelect=function(e,t){e.boxSelecting=!0,this.updateUIClasses({mouse:ae.cursors.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(ae.classes.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));const r=ca(t.originalEvent,this.map.getContainer()),n=Math.min(e.boxSelectStartLocation.x,r.x),i=Math.max(e.boxSelectStartLocation.x,r.x),o=Math.min(e.boxSelectStartLocation.y,r.y),a=Math.max(e.boxSelectStartLocation.y,r.y),s=`translate(${n}px, ${o}px)`;e.boxSelectElement.style.transform=s,e.boxSelectElement.style.WebkitTransform=s,e.boxSelectElement.style.width=`${i-n}px`,e.boxSelectElement.style.height=`${a-o}px`};X.dragMove=function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();const r={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};yT(this.getSelected(),r),e.dragMoveLocation=t.lngLat};X.onMouseUp=function(e,t){if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){const r=[e.boxSelectStartLocation,ca(t.originalEvent,this.map.getContainer())],n=this.featuresAt(null,r,"click"),i=this.getUniqueIds(n).filter(o=>!this.isSelected(o));i.length&&(this.select(i),i.forEach(o=>this.doRender(o)),this.updateUIClasses({mouse:ae.cursors.MOVE}))}this.stopExtendedInteractions(e)};X.toDisplayFeatures=function(e,t,r){t.properties.active=this.isSelected(t.properties.id)?ae.activeStates.ACTIVE:ae.activeStates.INACTIVE,r(t),this.fireActionable(),!(t.properties.active!==ae.activeStates.ACTIVE||t.geometry.type===ae.geojsonTypes.POINT)&&hT(t).forEach(r)};X.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()};X.onCombineFeatures=function(){const e=this.getSelected();if(e.length===0||e.length<2)return;const t=[],r=[],n=e[0].type.replace("Multi","");for(let i=0;i<e.length;i++){const o=e[i];if(o.type.replace("Multi","")!==n)return;o.type.includes("Multi")?o.getCoordinates().forEach(a=>{t.push(a)}):t.push(o.getCoordinates()),r.push(o.toGeoJSON())}if(r.length>1){const i=this.newFeature({type:ae.geojsonTypes.FEATURE,properties:r[0].properties,geometry:{type:`Multi${n}`,coordinates:t}});this.addFeature(i),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([i.id]),this.map.fire(ae.events.COMBINE_FEATURES,{createdFeatures:[i.toGeoJSON()],deletedFeatures:r})}this.fireActionable()};X.onUncombineFeatures=function(){const e=this.getSelected();if(e.length===0)return;const t=[],r=[];for(let n=0;n<e.length;n++){const i=e[n];this.isInstanceOf("MultiFeature",i)&&(i.getFeatures().forEach(o=>{this.addFeature(o),o.properties=i.properties,t.push(o.toGeoJSON()),this.select([o.id])}),this.deleteFeature(i.id,{silent:!0}),r.push(i.toGeoJSON()))}t.length>1&&this.map.fire(ae.events.UNCOMBINE_FEATURES,{createdFeatures:t,deletedFeatures:r}),this.fireActionable()};var mT=X;const{noTarget:mf,isOfMetaType:vf,isInactiveFeature:bf,isShiftDown:fc}=kt,vT=mn,bT=la,wf=Ut,be=J,Cn=kt,wT=In,Tf=vf(be.meta.VERTEX),TT=vf(be.meta.MIDPOINT),Z={};Z.fireUpdate=function(){this.map.fire(be.events.UPDATE,{action:be.updateActions.CHANGE_COORDINATES,features:this.getSelected().map(e=>e.toGeoJSON())})};Z.fireActionable=function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})};Z.startDragging=function(e,t){this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=t.lngLat};Z.stopDragging=function(e){this.map.dragPan.enable(),e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null};Z.onVertex=function(e,t){this.startDragging(e,t);const r=t.featureTarget.properties,n=e.selectedCoordPaths.indexOf(r.coord_path);!fc(t)&&n===-1?e.selectedCoordPaths=[r.coord_path]:fc(t)&&n===-1&&e.selectedCoordPaths.push(r.coord_path);const i=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(i)};Z.onMidpoint=function(e,t){this.startDragging(e,t);const r=t.featureTarget.properties;e.feature.addCoordinate(r.coord_path,r.lng,r.lat),this.fireUpdate(),e.selectedCoordPaths=[r.coord_path]};Z.pathsToCoordinates=function(e,t){return t.map(r=>({feature_id:e,coord_path:r}))};Z.onFeature=function(e,t){e.selectedCoordPaths.length===0?this.startDragging(e,t):this.stopDragging(e)};Z.dragFeature=function(e,t,r){wT(this.getSelected(),r),e.dragMoveLocation=t.lngLat};Z.dragVertex=function(e,t,r){const n=e.selectedCoordPaths.map(a=>e.feature.getCoordinate(a)),i=n.map(a=>({type:be.geojsonTypes.FEATURE,properties:{},geometry:{type:be.geojsonTypes.POINT,coordinates:a}})),o=bT(i,r);for(let a=0;a<n.length;a++){const s=n[a];e.feature.updateCoordinate(e.selectedCoordPaths[a],s[0]+o.lng,s[1]+o.lat)}};Z.clickNoTarget=function(){this.changeMode(be.modes.SIMPLE_SELECT)};Z.clickInactive=function(){this.changeMode(be.modes.SIMPLE_SELECT)};Z.clickActiveFeature=function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()};Z.onSetup=function(e){const t=e.featureId,r=this.getFeature(t);if(!r)throw new Error("You must provide a featureId to enter direct_select mode");if(r.type===be.geojsonTypes.POINT)throw new TypeError("direct_select mode doesn't handle point features");const n={featureId:t,feature:r,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(t,n.selectedCoordPaths)),this.setSelected(t),wf.disable(this),this.setActionableState({trash:!0}),n};Z.onStop=function(){wf.enable(this),this.clearSelectedCoordinates()};Z.toDisplayFeatures=function(e,t,r){e.featureId===t.properties.id?(t.properties.active=be.activeStates.ACTIVE,r(t),vT(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(r)):(t.properties.active=be.activeStates.INACTIVE,r(t)),this.fireActionable(e)};Z.onTrash=function(e){e.selectedCoordPaths.sort().reverse().forEach(t=>e.feature.removeCoordinate(t)),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),e.feature.isValid()===!1&&(this.deleteFeature([e.featureId]),this.changeMode(be.modes.SIMPLE_SELECT,{}))};Z.onMouseMove=function(e,t){const r=Cn.isActiveFeature(t),n=Tf(t),i=e.selectedCoordPaths.length===0;r&&i?this.updateUIClasses({mouse:be.cursors.MOVE}):n&&!i?this.updateUIClasses({mouse:be.cursors.MOVE}):this.updateUIClasses({mouse:be.cursors.NONE}),this.stopDragging(e)};Z.onMouseOut=function(e){e.dragMoving&&this.fireUpdate()};Z.onTouchStart=Z.onMouseDown=function(e,t){if(Tf(t))return this.onVertex(e,t);if(Cn.isActiveFeature(t))return this.onFeature(e,t);if(TT(t))return this.onMidpoint(e,t)};Z.onDrag=function(e,t){if(e.canDragMove!==!0)return;e.dragMoving=!0,t.originalEvent.stopPropagation();const r={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,t,r):this.dragFeature(e,t,r),e.dragMoveLocation=t.lngLat};Z.onClick=function(e,t){if(mf(t))return this.clickNoTarget(e,t);if(Cn.isActiveFeature(t))return this.clickActiveFeature(e,t);if(bf(t))return this.clickInactive(e,t);this.stopDragging(e)};Z.onTap=function(e,t){if(mf(t))return this.clickNoTarget(e,t);if(Cn.isActiveFeature(t))return this.clickActiveFeature(e,t);if(bf(t))return this.clickInactive(e,t)};Z.onTouchEnd=Z.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};var ST=Z;const dc=kt,De=J,Be={};Be.onSetup=function(){const e=this.newFeature({type:De.geojsonTypes.FEATURE,properties:{},geometry:{type:De.geojsonTypes.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:De.cursors.ADD}),this.activateUIButton(De.types.POINT),this.setActionableState({trash:!0}),{point:e}};Be.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(De.modes.SIMPLE_SELECT)};Be.onTap=Be.onClick=function(e,t){this.updateUIClasses({mouse:De.cursors.MOVE}),e.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat),this.map.fire(De.events.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(De.modes.SIMPLE_SELECT,{featureIds:[e.point.id]})};Be.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})};Be.toDisplayFeatures=function(e,t,r){const n=t.properties.id===e.point.id;if(t.properties.active=n?De.activeStates.ACTIVE:De.activeStates.INACTIVE,!n)return r(t)};Be.onTrash=Be.stopDrawingAndRemove;Be.onKeyUp=function(e,t){if(dc.isEscapeKey(t)||dc.isEnterKey(t))return this.stopDrawingAndRemove(e,t)};var xT=Be;function _T(e,t){return e.lngLat?e.lngLat.lng===t[0]&&e.lngLat.lat===t[1]:!1}var Sf=_T;const tn=kt,xf=Ut,ce=J,ET=Sf,pc=yn,$e={};$e.onSetup=function(){const e=this.newFeature({type:ce.geojsonTypes.FEATURE,properties:{},geometry:{type:ce.geojsonTypes.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),xf.disable(this),this.updateUIClasses({mouse:ce.cursors.ADD}),this.activateUIButton(ce.types.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}};$e.clickAnywhere=function(e,t){if(e.currentVertexPosition>0&&ET(t,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(ce.modes.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:ce.cursors.ADD}),e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat)};$e.clickOnVertex=function(e){return this.changeMode(ce.modes.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};$e.onMouseMove=function(e,t){e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),tn.isVertex(t)&&this.updateUIClasses({mouse:ce.cursors.POINTER})};$e.onTap=$e.onClick=function(e,t){return tn.isVertex(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)};$e.onKeyUp=function(e,t){tn.isEscapeKey(t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(ce.modes.SIMPLE_SELECT)):tn.isEnterKey(t)&&this.changeMode(ce.modes.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};$e.onStop=function(e){this.updateUIClasses({mouse:ce.cursors.NONE}),xf.enable(this),this.activateUIButton(),this.getFeature(e.polygon.id)!==void 0&&(e.polygon.removeCoordinate(`0.${e.currentVertexPosition}`),e.polygon.isValid()?this.map.fire(ce.events.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(ce.modes.SIMPLE_SELECT,{},{silent:!0})))};$e.toDisplayFeatures=function(e,t,r){const n=t.properties.id===e.polygon.id;if(t.properties.active=n?ce.activeStates.ACTIVE:ce.activeStates.INACTIVE,!n)return r(t);if(t.geometry.coordinates.length===0)return;const i=t.geometry.coordinates[0].length;if(!(i<3)){if(t.properties.meta=ce.meta.FEATURE,r(pc(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),i>3){const o=t.geometry.coordinates[0].length-3;r(pc(e.polygon.id,t.geometry.coordinates[0][o],`0.${o}`,!1))}if(i<=4){const o=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(r({type:ce.geojsonTypes.FEATURE,properties:t.properties,geometry:{coordinates:o,type:ce.geojsonTypes.LINE_STRING}}),i===3)return}return r(t)}};$e.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(ce.modes.SIMPLE_SELECT)};var AT=$e;const rn=kt,hc=Sf,_f=Ut,ge=J,IT=yn,Ne={};Ne.onSetup=function(e){e=e||{};const t=e.featureId;let r,n,i="forward";if(t){if(r=this.getFeature(t),!r)throw new Error("Could not find a feature with the provided featureId");let o=e.from;if(o&&o.type==="Feature"&&o.geometry&&o.geometry.type==="Point"&&(o=o.geometry),o&&o.type==="Point"&&o.coordinates&&o.coordinates.length===2&&(o=o.coordinates),!o||!Array.isArray(o))throw new Error("Please use the `from` property to indicate which point to continue the line from");const a=r.coordinates.length-1;if(r.coordinates[a][0]===o[0]&&r.coordinates[a][1]===o[1])n=a+1,r.addCoordinate(n,...r.coordinates[a]);else if(r.coordinates[0][0]===o[0]&&r.coordinates[0][1]===o[1])i="backwards",n=0,r.addCoordinate(n,...r.coordinates[0]);else throw new Error("`from` should match the point at either the start or the end of the provided LineString")}else r=this.newFeature({type:ge.geojsonTypes.FEATURE,properties:{},geometry:{type:ge.geojsonTypes.LINE_STRING,coordinates:[]}}),n=0,this.addFeature(r);return this.clearSelectedFeatures(),_f.disable(this),this.updateUIClasses({mouse:ge.cursors.ADD}),this.activateUIButton(ge.types.LINE),this.setActionableState({trash:!0}),{line:r,currentVertexPosition:n,direction:i}};Ne.clickAnywhere=function(e,t){if(e.currentVertexPosition>0&&hc(t,e.line.coordinates[e.currentVertexPosition-1])||e.direction==="backwards"&&hc(t,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(ge.modes.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:ge.cursors.ADD}),e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.direction==="forward"?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)};Ne.clickOnVertex=function(e){return this.changeMode(ge.modes.SIMPLE_SELECT,{featureIds:[e.line.id]})};Ne.onMouseMove=function(e,t){e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),rn.isVertex(t)&&this.updateUIClasses({mouse:ge.cursors.POINTER})};Ne.onTap=Ne.onClick=function(e,t){if(rn.isVertex(t))return this.clickOnVertex(e,t);this.clickAnywhere(e,t)};Ne.onKeyUp=function(e,t){rn.isEnterKey(t)?this.changeMode(ge.modes.SIMPLE_SELECT,{featureIds:[e.line.id]}):rn.isEscapeKey(t)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(ge.modes.SIMPLE_SELECT))};Ne.onStop=function(e){_f.enable(this),this.activateUIButton(),this.getFeature(e.line.id)!==void 0&&(e.line.removeCoordinate(`${e.currentVertexPosition}`),e.line.isValid()?this.map.fire(ge.events.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(ge.modes.SIMPLE_SELECT,{},{silent:!0})))};Ne.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(ge.modes.SIMPLE_SELECT)};Ne.toDisplayFeatures=function(e,t,r){const n=t.properties.id===e.line.id;if(t.properties.active=n?ge.activeStates.ACTIVE:ge.activeStates.INACTIVE,!n)return r(t);t.geometry.coordinates.length<2||(t.properties.meta=ge.meta.FEATURE,r(IT(e.line.id,t.geometry.coordinates[e.direction==="forward"?t.geometry.coordinates.length-2:1],`${e.direction==="forward"?t.geometry.coordinates.length-2:1}`,!1)),r(t))};var CT=Ne,Ef={simple_select:mT,direct_select:ST,draw_point:xT,draw_polygon:AT,draw_line_string:CT};const nr=Do,Po=J,$T={defaultMode:Po.modes.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:jh,modes:Ef,controls:{},userProperties:!1},NT={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},OT={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function gc(e,t){return e.map(r=>r.source?r:nr(r,{id:`${r.id}.${t}`,source:t==="hot"?Po.sources.HOT:Po.sources.COLD}))}var PT=function(e={}){let t=nr(e);return e.controls||(t.controls={}),e.displayControlsDefault===!1?t.controls=nr(OT,e.controls):t.controls=nr(NT,e.controls),t=nr($T,t),t.styles=gc(t.styles,"cold").concat(gc(t.styles,"hot")),t},nn={exports:{}};nn.exports;(function(e,t){var r=200,n="__lodash_hash_undefined__",i=1,o=2,a=9007199254740991,s="[object Arguments]",l="[object Array]",h="[object AsyncFunction]",g="[object Boolean]",m="[object Date]",u="[object Error]",f="[object Function]",b="[object GeneratorFunction]",S="[object Map]",_="[object Number]",N="[object Null]",O="[object Object]",w="[object Promise]",C="[object Proxy]",$="[object RegExp]",P="[object Set]",M="[object String]",F="[object Symbol]",d="[object Undefined]",I="[object WeakMap]",T="[object ArrayBuffer]",v="[object DataView]",E="[object Float32Array]",L="[object Float64Array]",k="[object Int8Array]",V="[object Int16Array]",oe="[object Int32Array]",j="[object Uint8Array]",x="[object Uint8ClampedArray]",B="[object Uint16Array]",D="[object Uint32Array]",G=/[\\^$.*+?()[\]{}|]/g,U=/^\[object .+?Constructor\]$/,H=/^(?:0|[1-9]\d*)$/,W={};W[E]=W[L]=W[k]=W[V]=W[oe]=W[j]=W[x]=W[B]=W[D]=!0,W[s]=W[l]=W[T]=W[g]=W[v]=W[m]=W[u]=W[f]=W[S]=W[_]=W[O]=W[$]=W[P]=W[M]=W[I]=!1;var pe=typeof window=="object"&&window&&window.Object===Object&&window,ye=typeof self=="object"&&self&&self.Object===Object&&self,Te=pe||ye||Function("return this")(),st=t&&!t.nodeType&&t,Tt=st&&!0&&e&&!e.nodeType&&e,Ge=Tt&&Tt.exports===st,On=Ge&&pe.process,ga=function(){try{return On&&On.binding&&On.binding("util")}catch{}}(),ya=ga&&ga.isTypedArray;function Hf(c,y){for(var A=-1,R=c==null?0:c.length,Q=0,q=[];++A<R;){var ie=c[A];y(ie,A,c)&&(q[Q++]=ie)}return q}function Kf(c,y){for(var A=-1,R=y.length,Q=c.length;++A<R;)c[Q+A]=y[A];return c}function Jf(c,y){for(var A=-1,R=c==null?0:c.length;++A<R;)if(y(c[A],A,c))return!0;return!1}function Yf(c,y){for(var A=-1,R=Array(c);++A<c;)R[A]=y(A);return R}function Zf(c){return function(y){return c(y)}}function Xf(c,y){return c.has(y)}function Qf(c,y){return c==null?void 0:c[y]}function ed(c){var y=-1,A=Array(c.size);return c.forEach(function(R,Q){A[++y]=[Q,R]}),A}function td(c,y){return function(A){return c(y(A))}}function rd(c){var y=-1,A=Array(c.size);return c.forEach(function(R){A[++y]=R}),A}var nd=Array.prototype,id=Function.prototype,yr=Object.prototype,Pn=Te["__core-js_shared__"],ma=id.toString,Fe=yr.hasOwnProperty,va=function(){var c=/[^.]+$/.exec(Pn&&Pn.keys&&Pn.keys.IE_PROTO||"");return c?"Symbol(src)_1."+c:""}(),ba=yr.toString,od=RegExp("^"+ma.call(Fe).replace(G,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),wa=Ge?Te.Buffer:void 0,mr=Te.Symbol,Ta=Te.Uint8Array,Sa=yr.propertyIsEnumerable,ad=nd.splice,lt=mr?mr.toStringTag:void 0,xa=Object.getOwnPropertySymbols,sd=wa?wa.isBuffer:void 0,ld=td(Object.keys,Object),Mn=St(Te,"DataView"),Jt=St(Te,"Map"),Fn=St(Te,"Promise"),Ln=St(Te,"Set"),Rn=St(Te,"WeakMap"),Yt=St(Object,"create"),cd=ft(Mn),ud=ft(Jt),fd=ft(Fn),dd=ft(Ln),pd=ft(Rn),_a=mr?mr.prototype:void 0,Dn=_a?_a.valueOf:void 0;function ct(c){var y=-1,A=c==null?0:c.length;for(this.clear();++y<A;){var R=c[y];this.set(R[0],R[1])}}function hd(){this.__data__=Yt?Yt(null):{},this.size=0}function gd(c){var y=this.has(c)&&delete this.__data__[c];return this.size-=y?1:0,y}function yd(c){var y=this.__data__;if(Yt){var A=y[c];return A===n?void 0:A}return Fe.call(y,c)?y[c]:void 0}function md(c){var y=this.__data__;return Yt?y[c]!==void 0:Fe.call(y,c)}function vd(c,y){var A=this.__data__;return this.size+=this.has(c)?0:1,A[c]=Yt&&y===void 0?n:y,this}ct.prototype.clear=hd,ct.prototype.delete=gd,ct.prototype.get=yd,ct.prototype.has=md,ct.prototype.set=vd;function qe(c){var y=-1,A=c==null?0:c.length;for(this.clear();++y<A;){var R=c[y];this.set(R[0],R[1])}}function bd(){this.__data__=[],this.size=0}function wd(c){var y=this.__data__,A=br(y,c);if(A<0)return!1;var R=y.length-1;return A==R?y.pop():ad.call(y,A,1),--this.size,!0}function Td(c){var y=this.__data__,A=br(y,c);return A<0?void 0:y[A][1]}function Sd(c){return br(this.__data__,c)>-1}function xd(c,y){var A=this.__data__,R=br(A,c);return R<0?(++this.size,A.push([c,y])):A[R][1]=y,this}qe.prototype.clear=bd,qe.prototype.delete=wd,qe.prototype.get=Td,qe.prototype.has=Sd,qe.prototype.set=xd;function ut(c){var y=-1,A=c==null?0:c.length;for(this.clear();++y<A;){var R=c[y];this.set(R[0],R[1])}}function _d(){this.size=0,this.__data__={hash:new ct,map:new(Jt||qe),string:new ct}}function Ed(c){var y=wr(this,c).delete(c);return this.size-=y?1:0,y}function Ad(c){return wr(this,c).get(c)}function Id(c){return wr(this,c).has(c)}function Cd(c,y){var A=wr(this,c),R=A.size;return A.set(c,y),this.size+=A.size==R?0:1,this}ut.prototype.clear=_d,ut.prototype.delete=Ed,ut.prototype.get=Ad,ut.prototype.has=Id,ut.prototype.set=Cd;function vr(c){var y=-1,A=c==null?0:c.length;for(this.__data__=new ut;++y<A;)this.add(c[y])}function $d(c){return this.__data__.set(c,n),this}function Nd(c){return this.__data__.has(c)}vr.prototype.add=vr.prototype.push=$d,vr.prototype.has=Nd;function Ye(c){var y=this.__data__=new qe(c);this.size=y.size}function Od(){this.__data__=new qe,this.size=0}function Pd(c){var y=this.__data__,A=y.delete(c);return this.size=y.size,A}function Md(c){return this.__data__.get(c)}function Fd(c){return this.__data__.has(c)}function Ld(c,y){var A=this.__data__;if(A instanceof qe){var R=A.__data__;if(!Jt||R.length<r-1)return R.push([c,y]),this.size=++A.size,this;A=this.__data__=new ut(R)}return A.set(c,y),this.size=A.size,this}Ye.prototype.clear=Od,Ye.prototype.delete=Pd,Ye.prototype.get=Md,Ye.prototype.has=Fd,Ye.prototype.set=Ld;function Rd(c,y){var A=Tr(c),R=!A&&Zd(c),Q=!A&&!R&&Bn(c),q=!A&&!R&&!Q&&Ma(c),ie=A||R||Q||q,ue=ie?Yf(c.length,String):[],de=ue.length;for(var te in c)Fe.call(c,te)&&!(ie&&(te=="length"||Q&&(te=="offset"||te=="parent")||q&&(te=="buffer"||te=="byteLength"||te=="byteOffset")||zd(te,de)))&&ue.push(te);return ue}function br(c,y){for(var A=c.length;A--;)if($a(c[A][0],y))return A;return-1}function Dd(c,y,A){var R=y(c);return Tr(c)?R:Kf(R,A(c))}function Zt(c){return c==null?c===void 0?d:N:lt&&lt in Object(c)?Vd(c):Yd(c)}function Ea(c){return Xt(c)&&Zt(c)==s}function Aa(c,y,A,R,Q){return c===y?!0:c==null||y==null||!Xt(c)&&!Xt(y)?c!==c&&y!==y:Bd(c,y,A,R,Aa,Q)}function Bd(c,y,A,R,Q,q){var ie=Tr(c),ue=Tr(y),de=ie?l:Ze(c),te=ue?l:Ze(y);de=de==s?O:de,te=te==s?O:te;var Se=de==O,Ce=te==O,he=de==te;if(he&&Bn(c)){if(!Bn(y))return!1;ie=!0,Se=!1}if(he&&!Se)return q||(q=new Ye),ie||Ma(c)?Ia(c,y,A,R,Q,q):Gd(c,y,de,A,R,Q,q);if(!(A&i)){var _e=Se&&Fe.call(c,"__wrapped__"),Ee=Ce&&Fe.call(y,"__wrapped__");if(_e||Ee){var Xe=_e?c.value():c,Ve=Ee?y.value():y;return q||(q=new Ye),Q(Xe,Ve,A,R,q)}}return he?(q||(q=new Ye),qd(c,y,A,R,Q,q)):!1}function jd(c){if(!Pa(c)||Kd(c))return!1;var y=Na(c)?od:U;return y.test(ft(c))}function kd(c){return Xt(c)&&Oa(c.length)&&!!W[Zt(c)]}function Ud(c){if(!Jd(c))return ld(c);var y=[];for(var A in Object(c))Fe.call(c,A)&&A!="constructor"&&y.push(A);return y}function Ia(c,y,A,R,Q,q){var ie=A&i,ue=c.length,de=y.length;if(ue!=de&&!(ie&&de>ue))return!1;var te=q.get(c);if(te&&q.get(y))return te==y;var Se=-1,Ce=!0,he=A&o?new vr:void 0;for(q.set(c,y),q.set(y,c);++Se<ue;){var _e=c[Se],Ee=y[Se];if(R)var Xe=ie?R(Ee,_e,Se,y,c,q):R(_e,Ee,Se,c,y,q);if(Xe!==void 0){if(Xe)continue;Ce=!1;break}if(he){if(!Jf(y,function(Ve,dt){if(!Xf(he,dt)&&(_e===Ve||Q(_e,Ve,A,R,q)))return he.push(dt)})){Ce=!1;break}}else if(!(_e===Ee||Q(_e,Ee,A,R,q))){Ce=!1;break}}return q.delete(c),q.delete(y),Ce}function Gd(c,y,A,R,Q,q,ie){switch(A){case v:if(c.byteLength!=y.byteLength||c.byteOffset!=y.byteOffset)return!1;c=c.buffer,y=y.buffer;case T:return!(c.byteLength!=y.byteLength||!q(new Ta(c),new Ta(y)));case g:case m:case _:return $a(+c,+y);case u:return c.name==y.name&&c.message==y.message;case $:case M:return c==y+"";case S:var ue=ed;case P:var de=R&i;if(ue||(ue=rd),c.size!=y.size&&!de)return!1;var te=ie.get(c);if(te)return te==y;R|=o,ie.set(c,y);var Se=Ia(ue(c),ue(y),R,Q,q,ie);return ie.delete(c),Se;case F:if(Dn)return Dn.call(c)==Dn.call(y)}return!1}function qd(c,y,A,R,Q,q){var ie=A&i,ue=Ca(c),de=ue.length,te=Ca(y),Se=te.length;if(de!=Se&&!ie)return!1;for(var Ce=de;Ce--;){var he=ue[Ce];if(!(ie?he in y:Fe.call(y,he)))return!1}var _e=q.get(c);if(_e&&q.get(y))return _e==y;var Ee=!0;q.set(c,y),q.set(y,c);for(var Xe=ie;++Ce<de;){he=ue[Ce];var Ve=c[he],dt=y[he];if(R)var Fa=ie?R(dt,Ve,he,y,c,q):R(Ve,dt,he,c,y,q);if(!(Fa===void 0?Ve===dt||Q(Ve,dt,A,R,q):Fa)){Ee=!1;break}Xe||(Xe=he=="constructor")}if(Ee&&!Xe){var Sr=c.constructor,xr=y.constructor;Sr!=xr&&"constructor"in c&&"constructor"in y&&!(typeof Sr=="function"&&Sr instanceof Sr&&typeof xr=="function"&&xr instanceof xr)&&(Ee=!1)}return q.delete(c),q.delete(y),Ee}function Ca(c){return Dd(c,ep,Wd)}function wr(c,y){var A=c.__data__;return Hd(y)?A[typeof y=="string"?"string":"hash"]:A.map}function St(c,y){var A=Qf(c,y);return jd(A)?A:void 0}function Vd(c){var y=Fe.call(c,lt),A=c[lt];try{c[lt]=void 0;var R=!0}catch{}var Q=ba.call(c);return R&&(y?c[lt]=A:delete c[lt]),Q}var Wd=xa?function(c){return c==null?[]:(c=Object(c),Hf(xa(c),function(y){return Sa.call(c,y)}))}:tp,Ze=Zt;(Mn&&Ze(new Mn(new ArrayBuffer(1)))!=v||Jt&&Ze(new Jt)!=S||Fn&&Ze(Fn.resolve())!=w||Ln&&Ze(new Ln)!=P||Rn&&Ze(new Rn)!=I)&&(Ze=function(c){var y=Zt(c),A=y==O?c.constructor:void 0,R=A?ft(A):"";if(R)switch(R){case cd:return v;case ud:return S;case fd:return w;case dd:return P;case pd:return I}return y});function zd(c,y){return y=y??a,!!y&&(typeof c=="number"||H.test(c))&&c>-1&&c%1==0&&c<y}function Hd(c){var y=typeof c;return y=="string"||y=="number"||y=="symbol"||y=="boolean"?c!=="__proto__":c===null}function Kd(c){return!!va&&va in c}function Jd(c){var y=c&&c.constructor,A=typeof y=="function"&&y.prototype||yr;return c===A}function Yd(c){return ba.call(c)}function ft(c){if(c!=null){try{return ma.call(c)}catch{}try{return c+""}catch{}}return""}function $a(c,y){return c===y||c!==c&&y!==y}var Zd=Ea(function(){return arguments}())?Ea:function(c){return Xt(c)&&Fe.call(c,"callee")&&!Sa.call(c,"callee")},Tr=Array.isArray;function Xd(c){return c!=null&&Oa(c.length)&&!Na(c)}var Bn=sd||rp;function Qd(c,y){return Aa(c,y)}function Na(c){if(!Pa(c))return!1;var y=Zt(c);return y==f||y==b||y==h||y==C}function Oa(c){return typeof c=="number"&&c>-1&&c%1==0&&c<=a}function Pa(c){var y=typeof c;return c!=null&&(y=="object"||y=="function")}function Xt(c){return c!=null&&typeof c=="object"}var Ma=ya?Zf(ya):kd;function ep(c){return Xd(c)?Rd(c):Ud(c)}function tp(){return[]}function rp(){return!1}e.exports=Qd})(nn,nn.exports);var MT=nn.exports,FT=function(e,t){return e.length!==t.length?!1:JSON.stringify(e.map(r=>r).sort())===JSON.stringify(t.map(r=>r).sort())},Af={},Mo={exports:{}};(function(e,t){var r={env:{},argv:[]},n=function(){var i=function(O,w,C,$){for(C=C||{},$=O.length;$--;C[O[$]]=w);return C},o=[1,12],a=[1,13],s=[1,9],l=[1,10],h=[1,11],g=[1,14],m=[1,15],u=[14,18,22,24],f=[18,22],b=[22,24],S={trace:function(){},yy:{},symbols_:{error:2,JSONString:3,STRING:4,JSONNumber:5,NUMBER:6,JSONNullLiteral:7,NULL:8,JSONBooleanLiteral:9,TRUE:10,FALSE:11,JSONText:12,JSONValue:13,EOF:14,JSONObject:15,JSONArray:16,"{":17,"}":18,JSONMemberList:19,JSONMember:20,":":21,",":22,"[":23,"]":24,JSONElementList:25,$accept:0,$end:1},terminals_:{2:"error",4:"STRING",6:"NUMBER",8:"NULL",10:"TRUE",11:"FALSE",14:"EOF",17:"{",18:"}",21:":",22:",",23:"[",24:"]"},productions_:[0,[3,1],[5,1],[7,1],[9,1],[9,1],[12,2],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[15,2],[15,3],[20,3],[19,1],[19,3],[16,2],[16,3],[25,1],[25,3]],performAction:function(w,C,$,P,M,F,d){var I=F.length-1;switch(M){case 1:this.$=w.replace(/\\(\\|")/g,"$1").replace(/\\n/g,`
`).replace(/\\r/g,"\r").replace(/\\t/g,"	").replace(/\\v/g,"\v").replace(/\\f/g,"\f").replace(/\\b/g,"\b");break;case 2:this.$=Number(w);break;case 3:this.$=null;break;case 4:this.$=!0;break;case 5:this.$=!1;break;case 6:return this.$=F[I-1];case 13:this.$={},Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 14:case 19:this.$=F[I-1],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 15:this.$=[F[I-2],F[I]];break;case 16:this.$={},this.$[F[I][0]]=F[I][1];break;case 17:this.$=F[I-2],F[I-2][F[I][0]]!==void 0&&(this.$.__duplicateProperties__||Object.defineProperty(this.$,"__duplicateProperties__",{value:[],enumerable:!1}),this.$.__duplicateProperties__.push(F[I][0])),F[I-2][F[I][0]]=F[I][1];break;case 18:this.$=[],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 20:this.$=[F[I]];break;case 21:this.$=F[I-2],F[I-2].push(F[I]);break}},table:[{3:5,4:o,5:6,6:a,7:3,8:s,9:4,10:l,11:h,12:1,13:2,15:7,16:8,17:g,23:m},{1:[3]},{14:[1,16]},i(u,[2,7]),i(u,[2,8]),i(u,[2,9]),i(u,[2,10]),i(u,[2,11]),i(u,[2,12]),i(u,[2,3]),i(u,[2,4]),i(u,[2,5]),i([14,18,21,22,24],[2,1]),i(u,[2,2]),{3:20,4:o,18:[1,17],19:18,20:19},{3:5,4:o,5:6,6:a,7:3,8:s,9:4,10:l,11:h,13:23,15:7,16:8,17:g,23:m,24:[1,21],25:22},{1:[2,6]},i(u,[2,13]),{18:[1,24],22:[1,25]},i(f,[2,16]),{21:[1,26]},i(u,[2,18]),{22:[1,28],24:[1,27]},i(b,[2,20]),i(u,[2,14]),{3:20,4:o,20:29},{3:5,4:o,5:6,6:a,7:3,8:s,9:4,10:l,11:h,13:30,15:7,16:8,17:g,23:m},i(u,[2,19]),{3:5,4:o,5:6,6:a,7:3,8:s,9:4,10:l,11:h,13:31,15:7,16:8,17:g,23:m},i(f,[2,17]),i(f,[2,15]),i(b,[2,21])],defaultActions:{16:[2,6]},parseError:function(w,C){if(C.recoverable)this.trace(w);else{let $=function(P,M){this.message=P,this.hash=M};throw $.prototype=Error,new $(w,C)}},parse:function(w){var C=this,$=[0],P=[null],M=[],F=this.table,d="",I=0,T=0,v=2,E=1,L=M.slice.call(arguments,1),k=Object.create(this.lexer),V={yy:{}};for(var oe in this.yy)Object.prototype.hasOwnProperty.call(this.yy,oe)&&(V.yy[oe]=this.yy[oe]);k.setInput(w,V.yy),V.yy.lexer=k,V.yy.parser=this,typeof k.yylloc>"u"&&(k.yylloc={});var j=k.yylloc;M.push(j);var x=k.options&&k.options.ranges;typeof V.yy.parseError=="function"?this.parseError=V.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var B=function(){var Ge;return Ge=k.lex()||E,typeof Ge!="number"&&(Ge=C.symbols_[Ge]||Ge),Ge},D,G,U,H,W={},pe,ye,Te,st;;){if(G=$[$.length-1],this.defaultActions[G]?U=this.defaultActions[G]:((D===null||typeof D>"u")&&(D=B()),U=F[G]&&F[G][D]),typeof U>"u"||!U.length||!U[0]){var Tt="";st=[];for(pe in F[G])this.terminals_[pe]&&pe>v&&st.push("'"+this.terminals_[pe]+"'");k.showPosition?Tt="Parse error on line "+(I+1)+`:
`+k.showPosition()+`
Expecting `+st.join(", ")+", got '"+(this.terminals_[D]||D)+"'":Tt="Parse error on line "+(I+1)+": Unexpected "+(D==E?"end of input":"'"+(this.terminals_[D]||D)+"'"),this.parseError(Tt,{text:k.match,token:this.terminals_[D]||D,line:k.yylineno,loc:j,expected:st})}if(U[0]instanceof Array&&U.length>1)throw new Error("Parse Error: multiple actions possible at state: "+G+", token: "+D);switch(U[0]){case 1:$.push(D),P.push(k.yytext),M.push(k.yylloc),$.push(U[1]),D=null,T=k.yyleng,d=k.yytext,I=k.yylineno,j=k.yylloc;break;case 2:if(ye=this.productions_[U[1]][1],W.$=P[P.length-ye],W._$={first_line:M[M.length-(ye||1)].first_line,last_line:M[M.length-1].last_line,first_column:M[M.length-(ye||1)].first_column,last_column:M[M.length-1].last_column},x&&(W._$.range=[M[M.length-(ye||1)].range[0],M[M.length-1].range[1]]),H=this.performAction.apply(W,[d,T,I,V.yy,U[1],P,M].concat(L)),typeof H<"u")return H;ye&&($=$.slice(0,-1*ye*2),P=P.slice(0,-1*ye),M=M.slice(0,-1*ye)),$.push(this.productions_[U[1]][0]),P.push(W.$),M.push(W._$),Te=F[$[$.length-2]][$[$.length-1]],$.push(Te);break;case 3:return!0}}return!0}},_=function(){var O={EOF:1,parseError:function(C,$){if(this.yy.parser)this.yy.parser.parseError(C,$);else throw new Error(C)},setInput:function(w,C){return this.yy=C||this.yy||{},this._input=w,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var w=this._input[0];this.yytext+=w,this.yyleng++,this.offset++,this.match+=w,this.matched+=w;var C=w.match(/(?:\r\n?|\n).*/g);return C?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),w},unput:function(w){var C=w.length,$=w.split(/(?:\r\n?|\n)/g);this._input=w+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-C),this.offset-=C;var P=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),$.length-1&&(this.yylineno-=$.length-1);var M=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:$?($.length===P.length?this.yylloc.first_column:0)+P[P.length-$.length].length-$[0].length:this.yylloc.first_column-C},this.options.ranges&&(this.yylloc.range=[M[0],M[0]+this.yyleng-C]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(w){this.unput(this.match.slice(w))},pastInput:function(){var w=this.matched.substr(0,this.matched.length-this.match.length);return(w.length>20?"...":"")+w.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var w=this.match;return w.length<20&&(w+=this._input.substr(0,20-w.length)),(w.substr(0,20)+(w.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var w=this.pastInput(),C=new Array(w.length+1).join("-");return w+this.upcomingInput()+`
`+C+"^"},test_match:function(w,C){var $,P,M;if(this.options.backtrack_lexer&&(M={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(M.yylloc.range=this.yylloc.range.slice(0))),P=w[0].match(/(?:\r\n?|\n).*/g),P&&(this.yylineno+=P.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:P?P[P.length-1].length-P[P.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+w[0].length},this.yytext+=w[0],this.match+=w[0],this.matches=w,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(w[0].length),this.matched+=w[0],$=this.performAction.call(this,this.yy,this,C,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),$)return $;if(this._backtrack){for(var F in M)this[F]=M[F];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var w,C,$,P;this._more||(this.yytext="",this.match="");for(var M=this._currentRules(),F=0;F<M.length;F++)if($=this._input.match(this.rules[M[F]]),$&&(!C||$[0].length>C[0].length)){if(C=$,P=F,this.options.backtrack_lexer){if(w=this.test_match($,M[F]),w!==!1)return w;if(this._backtrack){C=!1;continue}else return!1}else if(!this.options.flex)break}return C?(w=this.test_match(C,M[P]),w!==!1?w:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var C=this.next();return C||this.lex()},begin:function(C){this.conditionStack.push(C)},popState:function(){var C=this.conditionStack.length-1;return C>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(C){return C=this.conditionStack.length-1-Math.abs(C||0),C>=0?this.conditionStack[C]:"INITIAL"},pushState:function(C){this.begin(C)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(C,$,P,M){switch(P){case 0:break;case 1:return 6;case 2:return $.yytext=$.yytext.substr(1,$.yyleng-2),4;case 3:return 17;case 4:return 18;case 5:return 23;case 6:return 24;case 7:return 22;case 8:return 21;case 9:return 10;case 10:return 11;case 11:return 8;case 12:return 14;case 13:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\.[0-9]+)?([eE][-+]?[0-9]+)?\b)/,/^(?:"(?:\\[\\"bfnrt\/]|\\u[a-fA-F0-9]{4}|[^\\\0-\x09\x0a-\x1f"])*")/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?::)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}};return O}();S.lexer=_;function N(){this.yy={}}return N.prototype=S,S.Parser=N,new N}();typeof Mp<"u"&&(t.parser=n,t.Parser=n.Parser,t.parse=function(){return n.parse.apply(n,arguments)},t.main=function(o){o[1]||(console.log("Usage: "+o[0]+" FILE"),r.exit(1));var a=bo.readFileSync(bo.normalize(o[1]),"utf8");return t.parser.parse(a)},require.main===e&&t.main(r.argv.slice(1)))})(Mo,Mo.exports);var LT=Mo.exports,If={};function co(e){return e*Math.PI/180}function yc(e){var t=0;if(e.length>2)for(var r,n,i=0;i<e.length-1;i++)r=e[i],n=e[i+1],t+=co(n[0]-r[0])*(2+Math.sin(co(r[1]))+Math.sin(co(n[1])));return t>=0}function mc(e){if(e&&e.length>0){if(yc(e[0]))return!1;var t=e.slice(1,e.length);if(!t.every(yc))return!1}return!0}function RT(e){if(e.type==="Polygon")return mc(e.coordinates);if(e.type==="MultiPolygon")return e.coordinates.every(mc)}var DT=function(t,r){RT(t)||r.push({message:"Polygons and MultiPolygons should follow the right-hand rule",level:"message",line:t.__line__})},vc=DT;function BT(e,t){var r=[],n=0,i=10,o=6;function a(d){if((!t||t.noDuplicateMembers!==!1)&&d.__duplicateProperties__&&r.push({message:"An object contained duplicate members, making parsing ambigous: "+d.__duplicateProperties__.join(", "),line:d.__line__}),!l(d,"type","string"))if(M[d.type])d&&M[d.type](d);else{var I=F[d.type.toLowerCase()];I!==void 0?r.push({message:"Expected "+I+" but got "+d.type+" (case sensitive)",line:d.__line__}):r.push({message:"The type "+d.type+" is unknown",line:d.__line__})}}function s(d,I){return d.every(function(T){return T!==null&&typeof T===I})}function l(d,I,T){if(typeof d[I]>"u")return r.push({message:'"'+I+'" member required',line:d.__line__});if(T==="array"){if(!Array.isArray(d[I]))return r.push({message:'"'+I+'" member should be an array, but is an '+typeof d[I]+" instead",line:d.__line__})}else{if(T==="object"&&d[I]&&d[I].constructor!==Object)return r.push({message:'"'+I+'" member should be '+T+", but is an "+d[I].constructor.name+" instead",line:d.__line__});if(T&&typeof d[I]!==T)return r.push({message:'"'+I+'" member should be '+T+", but is an "+typeof d[I]+" instead",line:d.__line__})}}function h(d){if(u(d),f(d),d.properties!==void 0&&r.push({message:'FeatureCollection object cannot contain a "properties" member',line:d.__line__}),d.coordinates!==void 0&&r.push({message:'FeatureCollection object cannot contain a "coordinates" member',line:d.__line__}),!l(d,"features","array")){if(!s(d.features,"object"))return r.push({message:"Every feature must be an object",line:d.__line__});d.features.forEach(P)}}function g(d,I){if(!Array.isArray(d))return r.push({message:"position should be an array, is a "+typeof d+" instead",line:d.__line__||I});if(d.length<2)return r.push({message:"position must have 2 or more elements",line:d.__line__||I});if(d.length>3)return r.push({message:"position should not have more than 3 elements",level:"message",line:d.__line__||I});if(!s(d,"number"))return r.push({message:"each element in a position must be a number",line:d.__line__||I});if(t&&t.precisionWarning){if(n===i)return n+=1,r.push({message:"truncated warnings: we've encountered coordinate precision warning "+i+" times, no more warnings will be reported",level:"message",line:d.__line__||I});n<i&&d.forEach(function(T){var v=0,E=String(T).split(".")[1];if(E!==void 0&&(v=E.length),v>o)return n+=1,r.push({message:"precision of coordinates should be reduced",level:"message",line:d.__line__||I})})}}function m(d,I,T,v){if(v===void 0&&d.__line__!==void 0&&(v=d.__line__),T===0)return g(d,v);if(T===1&&I){if(I==="LinearRing"){if(!Array.isArray(d[d.length-1]))return r.push({message:"a number was found where a coordinate array should have been found: this needs to be nested more deeply",line:v}),!0;if(d.length<4&&r.push({message:"a LinearRing of coordinates needs to have four or more positions",line:v}),d.length&&(d[d.length-1].length!==d[0].length||!d[d.length-1].every(function(L,k){return d[0][k]===L})))return r.push({message:"the first and last positions in a LinearRing of coordinates must be the same",line:v}),!0}else if(I==="Line"&&d.length<2)return r.push({message:"a line needs to have two or more coordinates to be valid",line:v})}if(!Array.isArray(d))r.push({message:"a number was found where a coordinate array should have been found: this needs to be nested more deeply",line:v});else{var E=d.map(function(L){return m(L,I,T-1,L.__line__||v)});return E.some(function(L){return L})}}function u(d){if(d.crs){var I="urn:ogc:def:crs:OGC:1.3:CRS84";typeof d.crs=="object"&&d.crs.properties&&d.crs.properties.name===I?r.push({message:"old-style crs member is not recommended, this object is equivalent to the default and should be removed",line:d.__line__}):r.push({message:"old-style crs member is not recommended",line:d.__line__})}}function f(d){if(d.bbox){if(Array.isArray(d.bbox))return s(d.bbox,"number")||r.push({message:"each element in a bbox member must be a number",line:d.bbox.__line__}),d.bbox.length===4||d.bbox.length===6||r.push({message:"bbox must contain 4 elements (for 2D) or 6 elements (for 3D)",line:d.bbox.__line__}),r.length;r.push({message:"bbox member must be an array of numbers, but is a "+typeof d.bbox,line:d.__line__})}}function b(d){d.properties!==void 0&&r.push({message:'geometry object cannot contain a "properties" member',line:d.__line__}),d.geometry!==void 0&&r.push({message:'geometry object cannot contain a "geometry" member',line:d.__line__}),d.features!==void 0&&r.push({message:'geometry object cannot contain a "features" member',line:d.__line__})}function S(d){u(d),f(d),b(d),l(d,"coordinates","array")||g(d.coordinates)}function _(d){u(d),f(d),l(d,"coordinates","array")||m(d.coordinates,"LinearRing",2)||vc(d,r)}function N(d){u(d),f(d),l(d,"coordinates","array")||m(d.coordinates,"LinearRing",3)||vc(d,r)}function O(d){u(d),f(d),l(d,"coordinates","array")||m(d.coordinates,"Line",1)}function w(d){u(d),f(d),l(d,"coordinates","array")||m(d.coordinates,"Line",2)}function C(d){u(d),f(d),l(d,"coordinates","array")||m(d.coordinates,"",1)}function $(d){u(d),f(d),l(d,"geometries","array")||(s(d.geometries,"object")||r.push({message:"The geometries array in a GeometryCollection must contain only geometry objects",line:d.__line__}),d.geometries.length===1&&r.push({message:"GeometryCollection with a single geometry should be avoided in favor of single part or a single object of multi-part type",line:d.geometries.__line__}),d.geometries.forEach(function(I){I&&(I.type==="GeometryCollection"&&r.push({message:"GeometryCollection should avoid nested geometry collections",line:d.geometries.__line__}),a(I))}))}function P(d){u(d),f(d),d.id!==void 0&&typeof d.id!="string"&&typeof d.id!="number"&&r.push({message:'Feature "id" member must have a string or number value',line:d.__line__}),d.features!==void 0&&r.push({message:'Feature object cannot contain a "features" member',line:d.__line__}),d.coordinates!==void 0&&r.push({message:'Feature object cannot contain a "coordinates" member',line:d.__line__}),d.type!=="Feature"&&r.push({message:"GeoJSON features must have a type=feature member",line:d.__line__}),l(d,"properties","object"),l(d,"geometry","object")||d.geometry&&a(d.geometry)}var M={Point:S,Feature:P,MultiPoint:C,LineString:O,MultiLineString:w,FeatureCollection:h,GeometryCollection:$,Polygon:_,MultiPolygon:N},F=Object.keys(M).reduce(function(d,I){return d[I.toLowerCase()]=I,d},{});return typeof e!="object"||e===null||e===void 0?(r.push({message:"The root of a GeoJSON object must be an object.",line:0}),r):(a(e),r.forEach(function(d){({}).hasOwnProperty.call(d,"line")&&d.line===void 0&&delete d.line}),r)}If.hint=BT;var jT=LT,kT=If;function UT(e,t){var r,n=[];if(typeof e=="object")r=e;else if(typeof e=="string")try{r=jT.parse(e)}catch(a){var i=a.message.match(/line (\d+)/),o=parseInt(i[1],10);return[{line:o-1,message:a.message,error:a}]}else return[{message:"Expected string or object as input",line:0}];return n=n.concat(kT.hint(r,t)),n}Af.hint=UT;const GT=MT,qT=Ic,VT=Uo,WT=dn,zT=FT,HT=Af,me=J,KT=fn,JT={Polygon:Vo,LineString:qo,Point:Go,MultiPolygon:Br,MultiLineString:Br,MultiPoint:Br};var YT=function(e,t){return t.modes=me.modes,t.getFeatureIdsAt=function(r){return WT.click({point:r},null,e).map(i=>i.properties.id)},t.getSelectedIds=function(){return e.store.getSelectedIds()},t.getSelected=function(){return{type:me.geojsonTypes.FEATURE_COLLECTION,features:e.store.getSelectedIds().map(r=>e.store.get(r)).map(r=>r.toGeoJSON())}},t.getSelectedPoints=function(){return{type:me.geojsonTypes.FEATURE_COLLECTION,features:e.store.getSelectedCoordinates().map(r=>({type:me.geojsonTypes.FEATURE,properties:{},geometry:{type:me.geojsonTypes.POINT,coordinates:r.coordinates}}))}},t.set=function(r){if(r.type===void 0||r.type!==me.geojsonTypes.FEATURE_COLLECTION||!Array.isArray(r.features))throw new Error("Invalid FeatureCollection");const n=e.store.createRenderBatch();let i=e.store.getAllIds().slice();const o=t.add(r),a=new KT(o);return i=i.filter(s=>!a.has(s)),i.length&&t.delete(i),n(),o},t.add=function(r){const n=HT.hint(r,{precisionWarning:!1}).filter(a=>a.level!=="message");if(n.length)throw new Error(n[0].message);const o=JSON.parse(JSON.stringify(qT(r))).features.map(a=>{if(a.id=a.id||VT(),a.geometry===null)throw new Error("Invalid geometry: null");if(e.store.get(a.id)===void 0||e.store.get(a.id).type!==a.geometry.type){const s=JT[a.geometry.type];if(s===void 0)throw new Error(`Invalid geometry type: ${a.geometry.type}.`);const l=new s(e,a);e.store.add(l)}else{const s=e.store.get(a.id);s.properties=a.properties,GT(s.getCoordinates(),a.geometry.coordinates)||s.incomingCoords(a.geometry.coordinates)}return a.id});return e.store.render(),o},t.get=function(r){const n=e.store.get(r);if(n)return n.toGeoJSON()},t.getAll=function(){return{type:me.geojsonTypes.FEATURE_COLLECTION,features:e.store.getAll().map(r=>r.toGeoJSON())}},t.delete=function(r){return e.store.delete(r,{silent:!0}),t.getMode()===me.modes.DIRECT_SELECT&&!e.store.getSelectedIds().length?e.events.changeMode(me.modes.SIMPLE_SELECT,void 0,{silent:!0}):e.store.render(),t},t.deleteAll=function(){return e.store.delete(e.store.getAllIds(),{silent:!0}),t.getMode()===me.modes.DIRECT_SELECT?e.events.changeMode(me.modes.SIMPLE_SELECT,void 0,{silent:!0}):e.store.render(),t},t.changeMode=function(r,n={}){return r===me.modes.SIMPLE_SELECT&&t.getMode()===me.modes.SIMPLE_SELECT?(zT(n.featureIds||[],e.store.getSelectedIds())||(e.store.setSelected(n.featureIds,{silent:!0}),e.store.render()),t):(r===me.modes.DIRECT_SELECT&&t.getMode()===me.modes.DIRECT_SELECT&&n.featureId===e.store.getSelectedIds()[0]||e.events.changeMode(r,n,{silent:!0}),t)},t.getMode=function(){return e.events.getMode()},t.trash=function(){return e.events.trash({silent:!0}),t},t.combineFeatures=function(){return e.events.combineFeatures({silent:!0}),t},t.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:!0}),t},t.setFeatureProperty=function(r,n,i){return e.store.setFeatureProperty(r,n,i),t},t};const ZT=Bh,XT=PT,QT=YT,eS=J,tS=function(e,t){e=XT(e);const r={options:e};t=QT(r,t),r.api=t;const n=ZT(r);return t.onAdd=n.onAdd,t.onRemove=n.onRemove,t.types=eS.types,t.options=e,t};ko.exports=function(e){tS(e,this)};ko.exports.modes=Ef;var $n=ko.exports;const ua=Bo(Cp),rS=$n,ir=J,nS=Ut,iS=ua.default,Cf={...rS.modes.draw_polygon},oS=2;Cf.onSetup=function(e){const t=this.newFeature({type:ir.geojsonTypes.FEATURE,properties:{isCircle:!0,center:[]},geometry:{type:ir.geojsonTypes.POLYGON,coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),nS.disable(this),this.updateUIClasses({mouse:ir.cursors.ADD}),this.activateUIButton(ir.types.POLYGON),this.setActionableState({trash:!0}),{initialRadiusInKm:e.initialRadiusInKm||oS,polygon:t,currentVertexPosition:0}};Cf.clickAnywhere=function(e,t){if(e.currentVertexPosition===0){e.currentVertexPosition++;const r=[t.lngLat.lng,t.lngLat.lat],n=iS(r,e.initialRadiusInKm);e.polygon.incomingCoords(n.geometry.coordinates),e.polygon.properties.center=r,e.polygon.properties.radiusInKm=e.initialRadiusInKm}return this.changeMode(ir.modes.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};var aS={enable(e){setTimeout(()=>{!e.map||!e.map.dragPan||!e._ctx||!e._ctx.store||!e._ctx.store.getInitialConfigValue||e._ctx.store.getInitialConfigValue("dragPan")&&e.map.dragPan.enable()},0)},disable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||e.map.dragPan.disable()},0)}};const $f=Bo($p);var fa={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.earthRadius=63710088e-1,e.factors={centimeters:e.earthRadius*100,centimetres:e.earthRadius*100,degrees:e.earthRadius/111325,feet:e.earthRadius*3.28084,inches:e.earthRadius*39.37,kilometers:e.earthRadius/1e3,kilometres:e.earthRadius/1e3,meters:e.earthRadius,metres:e.earthRadius,miles:e.earthRadius/1609.344,millimeters:e.earthRadius*1e3,millimetres:e.earthRadius*1e3,nauticalmiles:e.earthRadius/1852,radians:1,yards:e.earthRadius*1.0936},e.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/e.earthRadius,yards:1.0936133},e.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function t(T,v,E){E===void 0&&(E={});var L={type:"Feature"};return(E.id===0||E.id)&&(L.id=E.id),E.bbox&&(L.bbox=E.bbox),L.properties=v||{},L.geometry=T,L}e.feature=t;function r(T,v,E){switch(T){case"Point":return n(v).geometry;case"LineString":return s(v).geometry;case"Polygon":return o(v).geometry;case"MultiPoint":return m(v).geometry;case"MultiLineString":return g(v).geometry;case"MultiPolygon":return u(v).geometry;default:throw new Error(T+" is invalid")}}e.geometry=r;function n(T,v,E){if(E===void 0&&(E={}),!T)throw new Error("coordinates is required");if(!Array.isArray(T))throw new Error("coordinates must be an Array");if(T.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!M(T[0])||!M(T[1]))throw new Error("coordinates must contain numbers");var L={type:"Point",coordinates:T};return t(L,v,E)}e.point=n;function i(T,v,E){return E===void 0&&(E={}),h(T.map(function(L){return n(L,v)}),E)}e.points=i;function o(T,v,E){E===void 0&&(E={});for(var L=0,k=T;L<k.length;L++){var V=k[L];if(V.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var oe=0;oe<V[V.length-1].length;oe++)if(V[V.length-1][oe]!==V[0][oe])throw new Error("First and last Position are not equivalent.")}var j={type:"Polygon",coordinates:T};return t(j,v,E)}e.polygon=o;function a(T,v,E){return E===void 0&&(E={}),h(T.map(function(L){return o(L,v)}),E)}e.polygons=a;function s(T,v,E){if(E===void 0&&(E={}),T.length<2)throw new Error("coordinates must be an array of two or more positions");var L={type:"LineString",coordinates:T};return t(L,v,E)}e.lineString=s;function l(T,v,E){return E===void 0&&(E={}),h(T.map(function(L){return s(L,v)}),E)}e.lineStrings=l;function h(T,v){v===void 0&&(v={});var E={type:"FeatureCollection"};return v.id&&(E.id=v.id),v.bbox&&(E.bbox=v.bbox),E.features=T,E}e.featureCollection=h;function g(T,v,E){E===void 0&&(E={});var L={type:"MultiLineString",coordinates:T};return t(L,v,E)}e.multiLineString=g;function m(T,v,E){E===void 0&&(E={});var L={type:"MultiPoint",coordinates:T};return t(L,v,E)}e.multiPoint=m;function u(T,v,E){E===void 0&&(E={});var L={type:"MultiPolygon",coordinates:T};return t(L,v,E)}e.multiPolygon=u;function f(T,v,E){E===void 0&&(E={});var L={type:"GeometryCollection",geometries:T};return t(L,v,E)}e.geometryCollection=f;function b(T,v){if(v===void 0&&(v=0),v&&!(v>=0))throw new Error("precision must be a positive number");var E=Math.pow(10,v||0);return Math.round(T*E)/E}e.round=b;function S(T,v){v===void 0&&(v="kilometers");var E=e.factors[v];if(!E)throw new Error(v+" units is invalid");return T*E}e.radiansToLength=S;function _(T,v){v===void 0&&(v="kilometers");var E=e.factors[v];if(!E)throw new Error(v+" units is invalid");return T/E}e.lengthToRadians=_;function N(T,v){return w(_(T,v))}e.lengthToDegrees=N;function O(T){var v=T%360;return v<0&&(v+=360),v}e.bearingToAzimuth=O;function w(T){var v=T%(2*Math.PI);return v*180/Math.PI}e.radiansToDegrees=w;function C(T){var v=T%360;return v*Math.PI/180}e.degreesToRadians=C;function $(T,v,E){if(v===void 0&&(v="kilometers"),E===void 0&&(E="kilometers"),!(T>=0))throw new Error("length must be a positive number");return S(_(T,v),E)}e.convertLength=$;function P(T,v,E){if(v===void 0&&(v="meters"),E===void 0&&(E="kilometers"),!(T>=0))throw new Error("area must be a positive number");var L=e.areaFactors[v];if(!L)throw new Error("invalid original units");var k=e.areaFactors[E];if(!k)throw new Error("invalid final units");return T/L*k}e.convertArea=P;function M(T){return!isNaN(T)&&T!==null&&!Array.isArray(T)}e.isNumber=M;function F(T){return!!T&&T.constructor===Object}e.isObject=F;function d(T){if(!T)throw new Error("bbox is required");if(!Array.isArray(T))throw new Error("bbox must be an Array");if(T.length!==4&&T.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");T.forEach(function(v){if(!M(v))throw new Error("bbox must only contain numbers")})}e.validateBBox=d;function I(T){if(!T)throw new Error("id is required");if(["string","number"].indexOf(typeof T)===-1)throw new Error("id must be a number or a string")}e.validateId=I})(fa);const sS=$n,ht=J,lS=Ut,Nf=aS,cS=ua.default,uS=$f.default,bc=fa,Oe={...sS.modes.draw_polygon};Oe.onSetup=function(e){const t=this.newFeature({type:ht.geojsonTypes.FEATURE,properties:{isCircle:!0,center:[]},geometry:{type:ht.geojsonTypes.POLYGON,coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),lS.disable(this),Nf.disable(this),this.updateUIClasses({mouse:ht.cursors.ADD}),this.activateUIButton(ht.types.POLYGON),this.setActionableState({trash:!0}),{polygon:t,currentVertexPosition:0}};Oe.onMouseDown=Oe.onTouchStart=function(e,t){e.polygon.properties.center.length===0&&(e.polygon.properties.center=[t.lngLat.lng,t.lngLat.lat])};Oe.onDrag=Oe.onMouseMove=function(e,t){const r=e.polygon.properties.center;if(r.length>0){const n=uS(bc.point(r),bc.point([t.lngLat.lng,t.lngLat.lat]),{units:"kilometers"}),i=cS(r,n);e.polygon.incomingCoords(i.geometry.coordinates),e.polygon.properties.radiusInKm=n}};Oe.onMouseUp=Oe.onTouchEnd=function(e,t){return Nf.enable(this),this.changeMode(ht.modes.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};Oe.onClick=Oe.onTap=function(e,t){e.polygon.properties.center=[]};Oe.toDisplayFeatures=function(e,t,r){const n=t.properties.id===e.polygon.id;return t.properties.active=n?ht.activeStates.ACTIVE:ht.activeStates.INACTIVE,r(t)};var fS=Oe;const dS=yn;function pS(e){const{properties:t,geometry:r}=e;if(!t.user_isCircle)return null;const n=[],i=r.coordinates[0].slice(0,-1);for(let o=0;o<i.length;o+=Math.round(i.length/4))n.push(dS(t.id,i[o],`0.${o}`,!1));return n}var Of=pS;const hS=$n,gS=mn,yS=In,on=J,mS=la,vS=$f.default,wc=fa,bS=ua.default,wS=Of,Nn=hS.modes.direct_select;Nn.dragFeature=function(e,t,r){yS(this.getSelected(),r),this.getSelected().filter(n=>n.properties.isCircle).map(n=>n.properties.center).forEach(n=>{n[0]+=r.lng,n[1]+=r.lat}),e.dragMoveLocation=t.lngLat};Nn.dragVertex=function(e,t,r){if(e.feature.properties.isCircle){const n=e.feature.properties.center,i=[t.lngLat.lng,t.lngLat.lat],o=vS(wc.point(n),wc.point(i),{units:"kilometers"}),a=bS(n,o);e.feature.incomingCoords(a.geometry.coordinates),e.feature.properties.radiusInKm=o}else{const n=e.selectedCoordPaths.map(a=>e.feature.getCoordinate(a)),i=n.map(a=>({type:on.geojsonTypes.FEATURE,properties:{},geometry:{type:on.geojsonTypes.POINT,coordinates:a}})),o=mS(i,r);for(let a=0;a<n.length;a++){const s=n[a];e.feature.updateCoordinate(e.selectedCoordPaths[a],s[0]+o.lng,s[1]+o.lat)}}};Nn.toDisplayFeatures=function(e,t,r){e.featureId===t.properties.id?(t.properties.active=on.activeStates.ACTIVE,r(t),(t.properties.user_isCircle?wS(t):gS(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths})).forEach(r)):(t.properties.active=on.activeStates.INACTIVE,r(t)),this.fireActionable(e)};var TS=Nn;const SS=$n,xS=mn,_S=In,Rr=J,ES=Of,da=SS.modes.simple_select;da.dragMove=function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();const r={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};_S(this.getSelected(),r),this.getSelected().filter(n=>n.properties.isCircle).map(n=>n.properties.center).forEach(n=>{n[0]+=r.lng,n[1]+=r.lat}),e.dragMoveLocation=t.lngLat};da.toDisplayFeatures=function(e,t,r){if(t.properties.active=this.isSelected(t.properties.id)?Rr.activeStates.ACTIVE:Rr.activeStates.INACTIVE,r(t),this.fireActionable(),t.properties.active!==Rr.activeStates.ACTIVE||t.geometry.type===Rr.geojsonTypes.POINT)return;(t.properties.user_isCircle?ES(t):xS(t)).forEach(r)};var AS=da;const IS=fS,CS=TS,$S=AS,NS=.85,Tc=120,OS={"mini-4-pro":{name:"DJI Mini 4 Pro",hfov:82.1,photoInterval:5.5,maxFlightTime:31},"mini-5-pro":{name:"DJI Mini 5 Pro",hfov:82.1,photoInterval:5.5,maxFlightTime:40},"mavic-4-pro":{name:"DJI Mavic 4 Pro",hfov:84,photoInterval:5.5,maxFlightTime:40},custom:{name:"Custom",hfov:null,photoInterval:5.5,maxFlightTime:null}},Nt=e=>{const t=PS(e);return OS[t]||null},PS=e=>({dji_mini_4_pro:"mini-4-pro",dji_mini_5_pro:"mini-5-pro",dji_mavic_4_pro:"mavic-4-pro",custom:"custom"})[e]||e,MS=(e,t,r,n)=>{if(!e||!t||!n)return null;const i=2*t*Math.tan(n*Math.PI/360),o=i*(3/4),a=i/2,s=o/2,l=Math.sqrt(a*a+s*s),h=Math.atan2(a,s)*180/Math.PI,g=180-h,m=180+h,u=360-h,f=ve([e.lng,e.lat]),b=rr(f,l/1e3,r+h,{units:"kilometers"}),S=rr(f,l/1e3,r+g,{units:"kilometers"}),_=rr(f,l/1e3,r+m,{units:"kilometers"}),N=rr(f,l/1e3,r+u,{units:"kilometers"}),O=[[b.geometry.coordinates,S.geometry.coordinates,_.geometry.coordinates,N.geometry.coordinates,b.geometry.coordinates]];return Np(O,{altitude:t,heading:r,hfov:n})},Pf=(e,t)=>{const r=ve([e.lng,e.lat]),n=ve([t.lng,t.lat]);return tt(r,n,{units:"meters"})},Mf=(e,t)=>{if(!e||e.length<2||!t||t<=0)return{maxSpeed:0,minDistance:0};const r=[];for(let o=0;o<e.length-1;o++){const a=Pf(e[o],e[o+1]);r.push(a)}const n=Math.min(...r),i=n/t;return{maxSpeed:Math.max(0,i),minDistance:n}},FS=(e,t)=>{if(!t||t<=0)return Tc;const n=e/t+Tc;return Math.round(n)},LS=(e,t)=>{if(!t||t<=0)return"safe";const r=t*60,n=r*NS;return e>=r?"critical":e>=n?"warning":"safe"},le=ip((e,t)=>({waypoints:[],selectedIds:[],mapRef:null,currentMissionFilename:null,calculatedMaxSpeed:0,minSegmentDistance:0,past:[],future:[],settings:{altitude:60,speed:10,gimbalPitch:-90,customFOV:82.1,showFootprints:!1,footprintColor:"#22c55e",sideOverlap:70,frontOverlap:80,pathType:"grid",angle:0,autoDirection:!1,generateEveryPoint:!1,reversePath:!1,waypointAction:"none",photoInterval:2,selectedDrone:"dji_mini_5_pro",straightenLegs:!1,units:"metric",orbitRadius:50,missionEndAction:"goHome"},setWaypoints:r=>e(n=>({waypoints:r,past:[...n.past,n.waypoints],future:[]})),addWaypoint:r=>e(n=>{let i=n.settings.speed,o=0;if(n.waypoints.length>0){const l=n.waypoints[n.waypoints.length-1];i=Math.round((l.speed||n.settings.speed)*10)/10,o=l.heading||0}const a={id:crypto.randomUUID(),...r,altitude:n.settings.altitude,speed:i,gimbalPitch:n.settings.gimbalPitch,heading:o},s=[...n.waypoints];if(s.length>0){const l=s.length-1,h=s[l],g=Math.round(Vr([h.lng,h.lat],[a.lng,a.lat]));s[l]={...h,heading:g},a.heading=g}return{waypoints:[...s,a],past:[...n.past,n.waypoints],future:[]}}),updateSettings:r=>e(n=>({settings:{...n.settings,...r}})),selectWaypoint:(r,n)=>e(i=>({selectedIds:n?i.selectedIds.includes(r)?i.selectedIds.filter(o=>o!==r):[...i.selectedIds,r]:[r]})),setSelectedIds:r=>e({selectedIds:r}),clearSelection:()=>e({selectedIds:[]}),updateSelectedWaypoints:r=>{const{waypoints:n,selectedIds:i,past:o}=t(),a=n.map(s=>i.includes(s.id)?{...s,...r}:s);e({waypoints:a,past:[...o,n],future:[]})},updateWaypoint:(r,n)=>{const{waypoints:i,past:o}=t(),a=i.map(s=>s.id===r?{...s,...n}:s);e({waypoints:a,past:[...o,i],future:[]})},deleteSelectedWaypoints:()=>{const{waypoints:r,selectedIds:n,past:i}=t(),o=r.filter(a=>!n.includes(a.id));e({waypoints:o,selectedIds:[],past:[...i,r],future:[]})},undo:()=>{const{past:r,future:n,waypoints:i}=t();if(r.length===0)return;const o=r[r.length-1],a=r.slice(0,r.length-1);e({waypoints:o,past:a,future:[i,...n]})},redo:()=>{const{past:r,future:n,waypoints:i}=t();if(n.length===0)return;const o=n[0],a=n.slice(1);e({waypoints:o,past:[...r,i],future:a})},setMapRef:r=>e({mapRef:r}),fitMapToWaypoints:()=>{const{mapRef:r,waypoints:n}=t();if(!r||!n||n.length===0)return;const i=new or.LngLatBounds;n.forEach(o=>{i.extend([o.lng,o.lat])}),r.fitBounds(i,{padding:{top:100,bottom:100,left:200,right:350},maxZoom:16,duration:3e3})},setMissionFilename:r=>e({currentMissionFilename:r}),clearMissionFilename:()=>e({currentMissionFilename:null}),calculateMissionMetrics:()=>{const{waypoints:r,settings:n}=t(),i=Nt(n.selectedDrone),o=(i==null?void 0:i.photoInterval)||5.5,{maxSpeed:a,minDistance:s}=Mf(r,o);e({calculatedMaxSpeed:a,minSegmentDistance:s})},getTotalDistance:()=>{const{waypoints:r}=t();if(r.length<2)return 0;let n=0;for(let i=0;i<r.length-1;i++)n+=Pf(r[i],r[i+1]);return n},getMissionTime:()=>{const{calculatedMaxSpeed:r}=t(),n=t().getTotalDistance();return FS(n,r)},getFlightWarningLevel:()=>{const{settings:r}=t(),n=t().getMissionTime(),i=Nt(r.selectedDrone),o=(i==null?void 0:i.maxFlightTime)||null;return LS(n,o)},resetTrigger:0,resetMission:()=>e(r=>({waypoints:[],selectedIds:[],past:[],future:[],currentMissionFilename:null,calculatedMaxSpeed:0,minSegmentDistance:0,resetTrigger:r.resetTrigger+1}))})),RS={onSetup:function(e){const t=this.newFeature({type:"Feature",properties:{isRectangle:!0},geometry:{type:"Polygon",coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),this.updateUIClasses({mouse:"add"}),this.activateUIButton("polygon"),this.setActionableState({trash:!0}),this.map&&this.map.dragPan&&this.map.dragPan.disable(),{polygon:t,startPoint:null}},onStop:function(e){this.updateUIClasses({mouse:"none"}),this.activateUIButton(),this.setActionableState({trash:!0}),this.map&&this.map.dragPan&&this.map.dragPan.enable()},onMouseDown:function(e,t){t.originalEvent&&(t.originalEvent.preventDefault(),t.originalEvent.stopPropagation()),e.startPoint=[t.lngLat.lng,t.lngLat.lat],this.updateFeature(e,t)},onDrag:function(e,t){e.startPoint&&this.updateFeature(e,t)},onMouseUp:function(e,t){e.startPoint&&(this.updateFeature(e,t),this.map.fire("draw.create",{features:[e.polygon.toGeoJSON()]}),this.changeMode("simple_select",{featureIds:[e.polygon.id]}))},updateFeature:function(e,t){const r=e.startPoint,n=[t.lngLat.lng,t.lngLat.lat],i=Math.min(r[0],n[0]),o=Math.max(r[0],n[0]),a=Math.min(r[1],n[1]),s=Math.max(r[1],n[1]),l=[[i,s],[o,s],[o,a],[i,a],[i,s]];e.polygon.incomingCoords([l])},toDisplayFeatures:function(e,t,r){const n=t.properties.id===e.polygon.id;if(t.properties.active=n?"true":"false",!n)return r(t);t.geometry.coordinates.length!==0&&r(t)},onTrash:function(e){this.deleteFeature(e.polygon.id,{silent:!0}),this.changeMode("simple_select")}};function DS({currentMode:e,onModeChange:t,onDelete:r,canDelete:n}){const i=[{id:"simple_select",icon:op,title:"Select (Pointer)"},{id:"add_waypoint",icon:ap,title:"Add Waypoint"},{id:"draw_rectangle",icon:sp,title:"Draw Square"},{id:"draw_polygon",icon:lp,title:"Draw Polygon"},{id:"drag_circle",icon:cp,title:"Draw Circle"}];return p.jsxs("div",{className:"absolute top-4 left-4 flex flex-col gap-2 bg-white rounded-md shadow-md p-1 z-10",children:[i.map(o=>{const a=o.icon,s=e===o.id||o.id==="simple_select"&&e==="direct_select";return p.jsx("button",{onClick:()=>{console.log("Switching to mode:",o.id),t(o.id)},className:`p-2 rounded hover:bg-gray-100 flex items-center justify-center ${s?"text-blue-600 bg-blue-50":"text-gray-700"}`,title:o.title,children:p.jsx(a,{size:20})},o.id)}),p.jsx("div",{className:"h-px bg-gray-200 my-1"}),p.jsx("button",{onClick:r,disabled:!n,className:`p-2 rounded flex items-center justify-center ${n?"text-red-600 hover:bg-red-50 cursor-pointer":"text-gray-300 cursor-not-allowed"}`,title:"Delete Selected",children:p.jsx(Ro,{size:20})})]})}or.accessToken="pk.eyJ1Ijoid2F5Z2VuIiwiYSI6ImNtaThyMXF2czBmZ3QybXBvbW1hazFpamcifQ.P0D5plS_fpnx3qheQytxfQ";const BS="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(`
<svg width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
  <path d="M20 0 L35 20 A 15 15 0 0 1 5 20 Z" fill="#3b82f6" stroke="white" stroke-width="2"/>
</svg>
`),jS="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(`
<svg width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
  <path d="M20 0 L35 20 A 15 15 0 0 1 5 20 Z" fill="#ef4444" stroke="white" stroke-width="2"/>
</svg>
`),kS=[{id:"gl-draw-line",type:"line",filter:["all",["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3b82f6","line-width":2}},{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3b82f6","fill-outline-color":"#3b82f6","fill-opacity":.2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3b82f6","line-width":2}},{id:"gl-draw-point-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":6,"circle-color":"#fff"}},{id:"gl-draw-point",type:"circle",filter:["all",["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":4,"circle-color":"#3b82f6"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","$type","Polygon"],["==","mode","static"]],paint:{"fill-color":"#000","fill-outline-color":"#000","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","$type","Polygon"],["==","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#000","line-width":2}}];function US({onPolygonDrawn:e}){const t=K.useRef(null),r=K.useRef(null),n=K.useRef(null),{waypoints:i,selectedIds:o,selectWaypoint:a,setSelectedIds:s,resetTrigger:l,settings:h,updateWaypoint:g,addWaypoint:m,setMapRef:u}=le(),f=K.useRef(null),[b,S]=K.useState("simple_select"),_=K.useRef(b);K.useEffect(()=>{_.current=b},[b]),K.useEffect(()=>{l>0&&n.current&&(n.current.deleteAll(),e(null))},[l,e]);const[N,O]=K.useState(null),[w,C]=K.useState(!1),$=K.useRef(null);K.useEffect(()=>{if(!n.current||!r.current)return;const F=n.current.getSelectedIds();if(F.length===0)return;const d=n.current.get(F[0]);if(!d||d.geometry.type!=="Polygon")return;const I=ar(d),T=tt(I,ve(d.geometry.coordinates[0][0]),{units:"meters"});if(Math.abs(T-h.orbitRadius)>1){const v=Ra(I.geometry.coordinates,h.orbitRadius,{steps:64,units:"meters"});v.id=d.id,v.properties={...d.properties,isCircle:!0},n.current.add(v),e(v)}},[h.orbitRadius]);const P=F=>{if(!F||F.geometry.type!=="Polygon")return;const d=ar(F),I=tt(d,ve(F.geometry.coordinates[0][0]),{units:"meters"});Math.abs(I-h.orbitRadius)>1&&le.getState().updateSettings({orbitRadius:Math.round(I)})};K.useEffect(()=>{if(r.current)return;r.current=new or.Map({container:t.current,style:"mapbox://styles/mapbox/satellite-streets-v12",center:[-98,39],zoom:4,boxZoom:!1});const F=new Cc({accessToken:or.accessToken,mapboxgl:or,marker:!1,collapsed:!0});r.current.addControl(F,"top-right"),u(r.current),n.current=new La({userProperties:!0,displayControlsDefault:!1,controls:{point:!1,line:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1},styles:kS,modes:{...La.modes,drag_circle:IS,draw_rectangle:RS,direct_select:CS,simple_select:$S}}),r.current.addControl(n.current),window.mapboxDraw=n.current,r.current.on("draw.create",j=>{const x=j.features[0];n.current.getMode()==="drag_circle"&&(n.current.setFeatureProperty(x.id,"isCircle",!0),x.properties.isCircle=!0,le.getState().updateSettings({pathType:"orbit",spacing:10})),n.current.getMode();const B=ar(x);if(tt(B,ve(x.geometry.coordinates[0][0]),{units:"meters"})>500){const G=Ra(B.geometry.coordinates,50,{steps:64,units:"meters"});G.id=x.id,G.properties={...x.properties,isCircle:!0},n.current.add(G),le.getState().updateSettings({orbitRadius:50}),e(G)}else P(x),e(x);setTimeout(()=>{n.current.changeMode("simple_select",{featureIds:[x.id]})},100)}),r.current.on("draw.update",j=>{const x=j.features[0];P(x),e(x)}),r.current.on("draw.selectionchange",j=>{j.features.length>0?(P(j.features[0]),e(j.features[0]),C(!0)):(e(null),C(!1))}),r.current.on("draw.delete",()=>e(null)),r.current.on("click",j=>{if(j.originalEvent._isDrag)return;if(_.current==="add_waypoint"){const{lng:B,lat:D}=j.lngLat;m({lng:B,lat:D});return}const x=r.current.queryRenderedFeatures(j.point,{layers:["waypoints-symbol"]});if(x.length){const B=x[0].properties.id;a(B,j.originalEvent.shiftKey)}else r.current.queryRenderedFeatures(j.point,{layers:["gl-draw-polygon-fill-static.cold","gl-draw-polygon-fill.hot"]}).length===0&&s([])});const d=j=>{if(!$.current)return;const x=$.current,B=j.point,D=Math.min(x.x,B.x),G=Math.max(x.x,B.x),U=Math.min(x.y,B.y),H=Math.max(x.y,B.y);O({left:D,top:U,width:G-D,height:H-U})},I=j=>{if(!$.current)return;const x=$.current,B=j.point;if(Math.abs(x.x-B.x)<5&&Math.abs(x.y-B.y)<5){$.current=null,O(null),r.current.dragPan.enable(),r.current.off("mousemove",d),r.current.off("mouseup",I);return}const D=[x,B],U=r.current.queryRenderedFeatures(D,{layers:["waypoints-symbol"]}).map(H=>H.properties.id);U.length>0&&s(U),$.current=null,O(null),r.current.dragPan.enable(),j.originalEvent._isDrag=!0,setTimeout(()=>{j.originalEvent&&delete j.originalEvent._isDrag},100),r.current.off("mousemove",d),r.current.off("mouseup",I)};r.current.on("mousedown",j=>{j.originalEvent.shiftKey&&(j.preventDefault(),r.current.dragPan.disable(),$.current=j.point,r.current.on("mousemove",d),r.current.on("mouseup",I))});const T=()=>{f.current||(r.current.getCanvas().style.cursor="pointer")},v=()=>{f.current||(r.current.getCanvas().style.cursor="")},E=j=>{if(n.current.getMode()!=="simple_select"&&n.current.getMode()!=="direct_select"||j.originalEvent.shiftKey||!j.originalEvent.altKey)return;j.preventDefault();const x=j.features[0];x&&(r.current.dragPan.disable(),r.current.getCanvas().style.cursor="grabbing",f.current={id:x.properties.id,initialLngLat:x.geometry.coordinates},r.current.on("mousemove",L),r.current.on("mouseup",k))},L=j=>{if(!f.current)return;const{lng:x,lat:B}=j.lngLat,D=r.current.getSource("waypoints"),G=r.current.getSource("mission-path"),U=le.getState().waypoints,H=le.getState().selectedIds,W=U.map((pe,ye)=>{const Te=pe.id===f.current.id;return{type:"Feature",properties:{id:pe.id,index:ye+1,selected:H.includes(pe.id),heading:pe.heading||0},geometry:{type:"Point",coordinates:Te?[x,B]:[pe.lng,pe.lat]}}});if(D&&D.setData({type:"FeatureCollection",features:W}),G){const pe=W.map(ye=>ye.geometry.coordinates);G.setData({type:"Feature",geometry:{type:"LineString",coordinates:pe}})}},k=j=>{if(!f.current)return;const{lng:x,lat:B}=j.lngLat,{id:D}=f.current;le.getState().updateWaypoint(D,{lng:x,lat:B}),f.current=null,r.current.dragPan.enable(),r.current.getCanvas().style.cursor="",j.originalEvent._isDrag=!0,r.current.off("mousemove",L),r.current.off("mouseup",k)};r.current.on("mouseenter","waypoints-symbol",T),r.current.on("mouseleave","waypoints-symbol",v),r.current.on("mousedown","waypoints-symbol",E);const V=j=>{const x=j.detail;if(!x||!n.current)return;n.current.deleteAll(),n.current.add(x),e(x);const B=Rc(x);r.current.fitBounds(B,{padding:50})};window.addEventListener("waygen:restore-polygon",V),r.current.on("load",()=>{r.current.addSource("mission-path",{type:"geojson",data:{type:"Feature",geometry:{type:"LineString",coordinates:[]}}}),r.current.addLayer({id:"mission-path-line",type:"line",source:"mission-path",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#3b82f6","line-width":3,"line-opacity":.8}}),r.current.addSource("footprints",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),r.current.addLayer({id:"footprints-fill",type:"fill",source:"footprints",paint:{"fill-color":["get","color"],"fill-opacity":.15,"fill-outline-color":"rgba(0,0,0,0)"}}),r.current.addLayer({id:"footprints-outline",type:"line",source:"footprints",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":["get","color"],"line-width":1,"line-opacity":.6}}),r.current.addSource("waypoints",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),r.current.addLayer({id:"waypoints-symbol",type:"symbol",source:"waypoints",layout:{"icon-image":["case",["get","selected"],"teardrop-selected","teardrop"],"icon-size":["interpolate",["linear"],["zoom"],10,.5,15,.75,20,1],"icon-anchor":"center","icon-allow-overlap":!0,"icon-rotate":["get","heading"],"icon-rotation-alignment":"map","text-field":["to-string",["get","index"]],"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":["interpolate",["linear"],["zoom"],10,9,15,11,20,13],"text-offset":[0,0],"text-anchor":"center","text-allow-overlap":!0,"text-rotation-alignment":"viewport"},paint:{"text-color":"#ffffff","text-halo-color":"#000000","text-halo-width":.5}});const j=(D,G)=>{const U=new Image;U.src=G,U.onload=()=>{r.current.hasImage(D)||r.current.addImage(D,U)}};j("teardrop",BS),j("teardrop-selected",jS);const x=le.getState().waypoints,B=le.getState().selectedIds;if(x.length>0){const D=x.map((U,H)=>({type:"Feature",properties:{id:U.id,index:H+1,selected:B.includes(U.id),heading:U.heading||0},geometry:{type:"Point",coordinates:[U.lng,U.lat]}}));r.current.getSource("waypoints").setData({type:"FeatureCollection",features:D});const G=x.map(U=>[U.lng,U.lat]);r.current.getSource("mission-path").setData({type:"Feature",geometry:{type:"LineString",coordinates:G}})}});const oe=j=>{S(j.mode),j.mode==="drag_circle"||j.mode==="draw_rectangle"?r.current.dragPan.disable():r.current.dragPan.enable()};return r.current.on("draw.modechange",oe),()=>{window.removeEventListener("waygen:restore-polygon",V)}},[]),K.useEffect(()=>{!r.current||!r.current.getLayer("waypoints-symbol")||(r.current.setLayoutProperty("waypoints-symbol","text-offset",[0,0]),r.current.setLayoutProperty("waypoints-symbol","text-anchor","center"),r.current.setLayoutProperty("waypoints-symbol","icon-anchor","center"),r.current.setLayoutProperty("waypoints-symbol","text-rotation-alignment","viewport"))},[]),K.useEffect(()=>{if(!r.current)return;const F=r.current.getSource("waypoints"),d=r.current.getSource("mission-path");if(F){const I=i.map((T,v)=>({type:"Feature",properties:{id:T.id,index:v+1,selected:o.includes(T.id),heading:T.heading||0},geometry:{type:"Point",coordinates:[T.lng,T.lat]}}));F.setData({type:"FeatureCollection",features:I})}if(d){const I=i.map(T=>[T.lng,T.lat]);d.setData({type:"Feature",geometry:{type:"LineString",coordinates:I}})}},[i,o]),K.useEffect(()=>{if(!r.current||!r.current.getSource("footprints"))return;if(!h.showFootprints){r.current.getSource("footprints").setData({type:"FeatureCollection",features:[]});return}const F=i.map((d,I)=>{const T=d.heading||0;return{...MS({lng:d.lng,lat:d.lat},h.altitude,T,h.customFOV),properties:{index:I+1,color:h.footprintColor}}}).filter(d=>d!==null);r.current.getSource("footprints").setData({type:"FeatureCollection",features:F})},[i,h.showFootprints,h.altitude,h.customFOV,h.footprintColor]),K.useEffect(()=>{h.orbitRadius>500&&le.getState().updateSettings({orbitRadius:50})},[]);const M=()=>{n.current&&(n.current.trash(),e(null),C(!1))};return p.jsxs("div",{className:`relative w-full h-full ${b==="drag_circle"||b==="draw_rectangle"||b==="add_waypoint"?"force-crosshair":""}`,children:[p.jsx("style",{children:`
        .force-crosshair .mapboxgl-canvas-container {
          cursor: crosshair !important;
        }
        .force-crosshair .mapboxgl-canvas {
          cursor: crosshair !important;
        }
      `}),p.jsx("div",{ref:t,className:"w-full h-full"}),N&&p.jsx("div",{style:{position:"absolute",left:N.left,top:N.top,width:N.width,height:N.height,border:"2px solid #3b82f6",backgroundColor:"rgba(59, 130, 246, 0.2)",pointerEvents:"none",zIndex:20}}),p.jsx(DS,{currentMode:b,onModeChange:F=>{var d,I;F!=="add_waypoint"?(d=n.current)==null||d.changeMode(F):(I=n.current)==null||I.changeMode("simple_select"),S(F),r.current&&(F==="drag_circle"||F==="draw_rectangle"?r.current.dragPan.disable():r.current.dragPan.enable())},onDelete:M,canDelete:w})]})}function GS(e,t){const{altitude:r,speed:n,gimbalPitch:i,spacing:o,straightenLegs:a,waypointAction:s}=t,l=ar(e);l.geometry.coordinates;const h=e.geometry.coordinates[0];let g=0;h.forEach(S=>{g+=tt(l,ve(S),{units:"meters"})});const m=g/h.length,u=2*Math.PI*m,f=Math.max(3,Math.round(u/o)),b=[];for(let S=0;S<f;S++){const _=S/f*360,N=rr(l,m/1e3,_,{units:"kilometers"}),O=Math.round(Vr(N,l));b.push({id:crypto.randomUUID(),lng:N.geometry.coordinates[0],lat:N.geometry.coordinates[1],altitude:Number(r),speed:Math.round(Number(n)*10)/10,gimbalPitch:Number(i),heading:O,straightenLegs:a,action:s})}if(b.length>0){const S=b[0];b.push({...S,id:crypto.randomUUID()})}return b}function Sc(e,t){if(t.pathType==="orbit")return GS(e,t);const{altitude:r,sideOverlap:n,frontOverlap:i,angle:o,gimbalPitch:a,autoDirection:s,generateEveryPoint:l,reversePath:h,speed:g,straightenLegs:m,waypointAction:u}=t,f=t.customFOV||82.1,b=Math.tan(f/2*(Math.PI/180)),S=r*b*2,N=S*(1-n/100)/111111,O=ar(e);let w=o;if(s){let v=0,E=0;const L=e.geometry.coordinates[0];for(let k=0;k<L.length-1;k++){const V=ve(L[k]),oe=ve(L[k+1]),j=tt(V,oe);j>v&&(v=j,E=Vr(V,oe))}w=E}const C=-w,$=Da(e,C,{pivot:O}),P=Rc($),M=[];let F=P[1]+N/2;for(;F<=P[3]+N/10;){const v=Ba([[P[0]-.1,F],[P[2]+.1,F]]),E=Op(v,$),L=k=>{const V=k.geometry.coordinates;return Array.isArray(V[0][0])?Ua(V[0][0],V[0][V[0].length-1]):Ua(V[0],V[V.length-1])};if(E.features.length===0){const k=L(v);ja(k,$)&&M.push(v.geometry.coordinates)}else E.features.forEach(k=>{const V=L(k);ja(V,$)&&M.push(k.geometry.coordinates)});F+=N}let d=[];if(M.forEach((v,E)=>{let L=E%2===1?v.reverse():v;if(l){const k=ve(L[0]),V=ve(L[1]),oe=tt(k,V,{units:"meters"}),x=S*(3/4)*(1-i/100),B=Math.max(1,x),D=Math.floor(oe/B);if(D>=1){const G=Ba(L),U=[];for(let H=0;H<=D;H++){ka(G,H*B/1e3,{units:"kilometers"});const W=ka(G,H*B,{units:"meters"});U.push(W.geometry.coordinates)}L=U}}L.forEach(k=>{d.push({id:crypto.randomUUID(),lng:k[0],lat:k[1],altitude:Number(r),speed:Math.round(Number(g)*10)/10,gimbalPitch:Number(a),heading:0,straightenLegs:m,action:u})})}),d.length===0)return[];const I=Pp(d.map(v=>[v.lng,v.lat]));Da(I,w,{pivot:O}).features.forEach((v,E)=>{d[E].lng=v.geometry.coordinates[0],d[E].lat=v.geometry.coordinates[1]}),h&&d.reverse();for(let v=0;v<d.length;v++)if(v<d.length-1){const E=ve([d[v].lng,d[v].lat]),L=ve([d[v+1].lng,d[v+1].lat]);d[v].heading=Math.round(Vr(E,L))}else v>0&&(d[v].heading=d[v-1].heading);return d}const qS=async(e,t,r="MiniMission",n=null)=>{const i=new Dc,o=Date.now(),{speed:a,straightenLegs:s,waypointAction:l,gimbalPitch:h,missionEndAction:g}=t,m=`<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://www.opengis.net/kml/2.2" xmlns:wpml="http://www.dji.com/wpmz/1.0.2">
  <Document>
    <wpml:createTime>${o}</wpml:createTime>
    <wpml:updateTime>${o}</wpml:updateTime>
    <wpml:missionConfig>
      <wpml:flyToWaylineMode>safely</wpml:flyToWaylineMode>
      <wpml:finishAction>${g}</wpml:finishAction>
      <wpml:exitOnRCLost>executeLostAction</wpml:exitOnRCLost>
      <wpml:executeRCLostAction>hover</wpml:executeRCLostAction>
      <wpml:globalTransitionalSpeed>${a}</wpml:globalTransitionalSpeed>
      <wpml:droneInfo>
        <wpml:droneEnumValue>68</wpml:droneEnumValue>
        <wpml:droneSubEnumValue>0</wpml:droneSubEnumValue>
      </wpml:droneInfo>
    </wpml:missionConfig>
    <wpml:templateId>0</wpml:templateId>
  </Document>
</kml>`;let u="";e.forEach((_,N)=>{const O=N===0,w=N===e.length-1,C=N+1,$=_.straightenLegs!==void 0?_.straightenLegs:s,P=_.action!==void 0?_.action:l,M=_.gimbalPitch!==void 0?_.gimbalPitch:h,F=_.speed!==void 0?_.speed:a;let d="",I=0;const T=N>0?e[N-1]:null,v=T?T.gimbalPitch!==void 0?T.gimbalPitch:h:null;(O||v!==null&&M!==v)&&(d+=`
        <wpml:action>
          <wpml:actionId>${I++}</wpml:actionId>
          <wpml:actionActuatorFunc>gimbalRotate</wpml:actionActuatorFunc>
          <wpml:actionActuatorFuncParam>
            <wpml:gimbalHeadingYawBase>aircraft</wpml:gimbalHeadingYawBase>
            <wpml:gimbalRotateMode>absoluteAngle</wpml:gimbalRotateMode>
            <wpml:gimbalPitchRotateEnable>1</wpml:gimbalPitchRotateEnable>
            <wpml:gimbalPitchRotateAngle>${M}</wpml:gimbalPitchRotateAngle>
            <wpml:gimbalRollRotateEnable>0</wpml:gimbalRollRotateEnable>
            <wpml:gimbalYawRotateEnable>0</wpml:gimbalYawRotateEnable>
            <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
          </wpml:actionActuatorFuncParam>
        </wpml:action>`),P==="photo"?d+=`
        <wpml:action>
          <wpml:actionId>${I++}</wpml:actionId>
          <wpml:actionActuatorFunc>takePhoto</wpml:actionActuatorFunc>
          <wpml:actionActuatorFuncParam>
            <wpml:fileSuffix>point${N}</wpml:fileSuffix>
            <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
          </wpml:actionActuatorFuncParam>
        </wpml:action>`:P==="record_start"?d+=`
          <wpml:action>
            <wpml:actionId>${I++}</wpml:actionId>
            <wpml:actionActuatorFunc>startRecord</wpml:actionActuatorFunc>
            <wpml:actionActuatorFuncParam>
              <wpml:fileSuffix>mission</wpml:fileSuffix>
              <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
            </wpml:actionActuatorFuncParam>
          </wpml:action>`:P==="record_stop"?d+=`
          <wpml:action>
            <wpml:actionId>${I++}</wpml:actionId>
            <wpml:actionActuatorFunc>stopRecord</wpml:actionActuatorFunc>
            <wpml:actionActuatorFuncParam>
              <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
            </wpml:actionActuatorFuncParam>
          </wpml:action>`:P==="record"&&(O?d+=`
            <wpml:action>
              <wpml:actionId>${I++}</wpml:actionId>
              <wpml:actionActuatorFunc>startRecord</wpml:actionActuatorFunc>
              <wpml:actionActuatorFuncParam>
                <wpml:fileSuffix>mission</wpml:fileSuffix>
                <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
              </wpml:actionActuatorFuncParam>
            </wpml:action>`:w&&(d+=`
            <wpml:action>
              <wpml:actionId>${I++}</wpml:actionId>
              <wpml:actionActuatorFunc>stopRecord</wpml:actionActuatorFunc>
              <wpml:actionActuatorFuncParam>
                <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
              </wpml:actionActuatorFuncParam>
            </wpml:action>`));const E=I>0?`
      <wpml:actionGroup>
        <wpml:actionGroupId>${C}</wpml:actionGroupId>
        <wpml:actionGroupStartIndex>${N}</wpml:actionGroupStartIndex>
        <wpml:actionGroupEndIndex>${N}</wpml:actionGroupEndIndex>
        <wpml:actionGroupMode>sequence</wpml:actionGroupMode>
        <wpml:actionTrigger>
          <wpml:actionTriggerType>reachPoint</wpml:actionTriggerType>
        </wpml:actionTrigger>
        ${d}
      </wpml:actionGroup>`:"";u+=`
    <Placemark>
      <Point><coordinates>${_.lng},${_.lat},0</coordinates></Point>
      <wpml:index>${N}</wpml:index>
      <wpml:executeHeight>${_.altitude}</wpml:executeHeight>
      <wpml:waypointSpeed>${F}</wpml:waypointSpeed>
      <wpml:waypointHeadingParam>
        <wpml:waypointHeadingMode>smoothTransition</wpml:waypointHeadingMode>
        <wpml:waypointHeadingAngle>${_.heading}</wpml:waypointHeadingAngle>
        <wpml:waypointHeadingAngleEnable>0</wpml:waypointHeadingAngleEnable>
        <wpml:waypointHeadingPathMode>followBadArc</wpml:waypointHeadingPathMode>
      </wpml:waypointHeadingParam>
      <wpml:useStraightLine>${$?1:0}</wpml:useStraightLine>
      ${E}
    </Placemark>`});const f=`<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://www.opengis.net/kml/2.2" xmlns:wpml="http://www.dji.com/wpmz/1.0.2">
  <Document>
    <wpml:missionConfig>
      <wpml:flyToWaylineMode>safely</wpml:flyToWaylineMode>
      <wpml:finishAction>${g}</wpml:finishAction>
      <wpml:exitOnRCLost>executeLostAction</wpml:exitOnRCLost>
      <wpml:executeRCLostAction>hover</wpml:executeRCLostAction>
      <wpml:globalTransitionalSpeed>${a}</wpml:globalTransitionalSpeed>
      <wpml:droneInfo>
        <wpml:droneEnumValue>68</wpml:droneEnumValue>
        <wpml:droneSubEnumValue>0</wpml:droneSubEnumValue>
      </wpml:droneInfo>
    </wpml:missionConfig>
    <Folder>
      <wpml:templateId>0</wpml:templateId>
      <wpml:executeHeightMode>relativeToStartPoint</wpml:executeHeightMode>
      <wpml:waylineId>0</wpml:waylineId>
      <wpml:autoFlightSpeed>${a}</wpml:autoFlightSpeed>
      ${u}
    </Folder>
  </Document>
</kml>`,b=i.folder("wpmz");b.file("template.kml",m),b.file("waylines.wpml",f),n&&b.file("waygen_session.json",JSON.stringify(n,null,2));const S=await i.generateAsync({type:"blob"});Fp.saveAs(S,`${r}.kmz`)};function je(e,t){return Array.from(e.getElementsByTagName(t))}function an(e){return e[0]==="#"?e:`#${e}`}function VS(e,t,r){return Array.from(e.getElementsByTagNameNS(r,t))}function xe(e){return e==null||e.normalize(),e&&e.textContent||""}function ke(e,t,r){const n=e.getElementsByTagName(t);return n.length?n[0]:null}function Pe(e,t,r){const n={};if(!e)return n;const i=e.getElementsByTagName(t),o=i.length?i[0]:null;return o&&r?r(o,n):n}function Ft(e,t,r){const n=xe(ke(e,t));return n&&r?r(n)||{}:{}}function Ct(e,t,r){const n=parseFloat(xe(ke(e,t)));if(!isNaN(n))return r&&r(n),n}function Ff(e,t){const r={};for(const n of t)Ft(e,n,i=>{r[n]=i});return r}function Lf(e){return(e==null?void 0:e.nodeType)===1}function Rf(e,t){const r={},n=t=="stroke"||t==="fill"?t:t+"-color";return e[0]==="#"&&(e=e.substring(1)),e.length===6||e.length===3?r[n]="#"+e:e.length===8&&(r[t+"-opacity"]=parseInt(e.substring(0,2),16)/255,r[n]="#"+e.substring(6,8)+e.substring(4,6)+e.substring(2,4)),r}function sn(e,t,r){const n={};return Ct(e,t,i=>{n[r]=i}),n}function pa(e,t){return Pe(e,"color",r=>Rf(xe(r),t))}function Df(e){return Pe(e,"Icon",(t,r)=>(Ft(t,"href",n=>{r.icon=n}),r))}function WS(e){return Pe(e,"IconStyle",t=>Object.assign(pa(t,"icon"),sn(t,"scale","icon-scale"),sn(t,"heading","icon-heading"),Pe(t,"hotSpot",r=>{const n=parseFloat(r.getAttribute("x")||""),i=parseFloat(r.getAttribute("y")||""),o=r.getAttribute("xunits")||"",a=r.getAttribute("yunits")||"";return!isNaN(n)&&!isNaN(i)?{"icon-offset":[n,i],"icon-offset-units":[o,a]}:{}}),Df(t)))}function zS(e){return Pe(e,"LabelStyle",t=>Object.assign(pa(t,"label"),sn(t,"scale","label-scale")))}function HS(e){return Pe(e,"LineStyle",t=>Object.assign(pa(t,"stroke"),sn(t,"width","stroke-width")))}function KS(e){return Pe(e,"PolyStyle",(t,r)=>Object.assign(r,Pe(t,"color",n=>Rf(xe(n),"fill")),Ft(t,"fill",n=>{if(n==="0")return{"fill-opacity":0}}),Ft(t,"outline",n=>{if(n==="0")return{"stroke-opacity":0}})))}function ha(e){return Object.assign({},KS(e),HS(e),zS(e),WS(e))}const It=e=>Number(e),Fo={string:e=>e,int:It,uint:It,short:It,ushort:It,float:It,double:It,bool:e=>!!e};function Bf(e,t){return Pe(e,"ExtendedData",(r,n)=>{for(const i of je(r,"Data"))n[i.getAttribute("name")||""]=xe(ke(i,"value"));for(const i of je(r,"SimpleData")){const o=i.getAttribute("name")||"",a=t[o]||Fo.string;n[o]=a(xe(i))}return n})}function jf(e){const t=ke(e,"description");for(const r of Array.from((t==null?void 0:t.childNodes)||[]))if(r.nodeType===4)return{description:{"@type":"html",value:xe(r)}};return{}}function kf(e){return Pe(e,"TimeSpan",t=>({timespan:{begin:xe(ke(t,"begin")),end:xe(ke(t,"end"))}}))}function Uf(e){return Pe(e,"TimeStamp",t=>({timestamp:xe(ke(t,"when"))}))}function Gf(e,t){return Ft(e,"styleUrl",r=>(r=an(r),t[r]?Object.assign({styleUrl:r},t[r]):{styleUrl:r}))}const JS=/\s*/g,YS=/^\s*|\s*$/g,ZS=/\s+/;function qf(e){return e.replace(JS,"").split(",").map(parseFloat).filter(t=>!isNaN(t)).slice(0,3)}function Lo(e){return e.replace(YS,"").split(ZS).map(qf).filter(t=>t.length>=2)}function XS(e){let t=je(e,"coord");t.length===0&&(t=VS(e,"coord","*"));const r=t.map(n=>xe(n).split(" ").map(parseFloat));return r.length===0?null:{geometry:r.length>2?{type:"LineString",coordinates:r}:{type:"Point",coordinates:r[0]},times:je(e,"when").map(n=>xe(n))}}function Vf(e){if(e.length===0)return e;const t=e[0],r=e[e.length-1];let n=!0;for(let i=0;i<Math.max(t.length,r.length);i++)if(t[i]!==r[i]){n=!1;break}return n?e:e.concat([e[0]])}function qr(e){return xe(ke(e,"coordinates"))}function Wf(e){let t=[],r=[];for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes.item(n);if(Lf(i))switch(i.tagName){case"MultiGeometry":case"MultiTrack":case"gx:MultiTrack":{const o=Wf(i);t=t.concat(o.geometries),r=r.concat(o.coordTimes);break}case"Point":{const o=qf(qr(i));o.length>=2&&t.push({type:"Point",coordinates:o});break}case"LinearRing":case"LineString":{const o=Lo(qr(i));o.length>=2&&t.push({type:"LineString",coordinates:o});break}case"Polygon":{const o=[];for(const a of je(i,"LinearRing")){const s=Vf(Lo(qr(a)));s.length>=4&&o.push(s)}o.length&&t.push({type:"Polygon",coordinates:o});break}case"Track":case"gx:Track":{const o=XS(i);if(!o)break;const{times:a,geometry:s}=o;t.push(s),a.length&&r.push(a);break}}}return{geometries:t,coordTimes:r}}function QS(e){return e.length===0?null:e.length===1?e[0]:{type:"GeometryCollection",geometries:e}}function e1(e,t,r,n){var h;const{coordTimes:i,geometries:o}=Wf(e),a=QS(o);if(!a&&n.skipNullGeometry)return null;const s={type:"Feature",geometry:a,properties:Object.assign(Ff(e,["name","address","visibility","open","phoneNumber","description"]),jf(e),Gf(e,t),ha(e),Bf(e,r),kf(e),Uf(e),i.length?{coordinateProperties:{times:i.length===1?i[0]:i}}:{})};((h=s.properties)==null?void 0:h.visibility)!==void 0&&(s.properties.visibility=s.properties.visibility!=="0");const l=e.getAttribute("id");return l!==null&&l!==""&&(s.id=l),s}function t1(e){return ke(e,"gx:LatLonQuad")?{geometry:{type:"Polygon",coordinates:[Vf(Lo(qr(e)))]}}:i1(e)}const r1=Math.PI/180;function n1(e,t,r){const n=[(e[0]+e[2])/2,(e[1]+e[3])/2];return[t[0].map(i=>{const o=i[1]-n[1],a=i[0]-n[0],s=Math.sqrt(Math.pow(o,2)+Math.pow(a,2)),l=Math.atan2(o,a)+r*r1;return[n[0]+Math.cos(l)*s,n[1]+Math.sin(l)*s]})]}function i1(e){const t=ke(e,"LatLonBox");if(t){const r=Ct(t,"north"),n=Ct(t,"west"),i=Ct(t,"east"),o=Ct(t,"south"),a=Ct(t,"rotation");if(typeof r=="number"&&typeof o=="number"&&typeof n=="number"&&typeof i=="number"){const s=[n,o,i,r];let l=[[[n,r],[i,r],[i,o],[n,o],[n,r]]];return typeof a=="number"&&(l=n1(s,l,a)),{bbox:s,geometry:{type:"Polygon",coordinates:l}}}}return null}function o1(e,t,r,n){var l;const i=t1(e),o=(i==null?void 0:i.geometry)||null;if(!o&&n.skipNullGeometry)return null;const a={type:"Feature",geometry:o,properties:Object.assign({"@geometry-type":"groundoverlay"},Ff(e,["name","address","visibility","open","phoneNumber","description"]),jf(e),Gf(e,t),ha(e),Df(e),Bf(e,r),kf(e),Uf(e))};i!=null&&i.bbox&&(a.bbox=i.bbox),((l=a.properties)==null?void 0:l.visibility)!==void 0&&(a.properties.visibility=a.properties.visibility!=="0");const s=e.getAttribute("id");return s!==null&&s!==""&&(a.id=s),a}function a1(e){let t=e.getAttribute("id");const r=e.parentNode;return!t&&Lf(r)&&r.localName==="CascadingStyle"&&(t=r.getAttribute("kml:id")||r.getAttribute("id")),an(t||"")}function s1(e){const t={};for(const r of je(e,"Style"))t[a1(r)]=ha(r);for(const r of je(e,"StyleMap")){const n=an(r.getAttribute("id")||"");Ft(r,"styleUrl",i=>{i=an(i),t[i]&&(t[n]=t[i])})}return t}function l1(e){const t={};for(const r of je(e,"SimpleField"))t[r.getAttribute("name")||""]=Fo[r.getAttribute("type")||""]||Fo.string;return t}function*c1(e,t={skipNullGeometry:!1}){const r=s1(e),n=l1(e);for(const i of je(e,"Placemark")){const o=e1(i,r,n,t);o&&(yield o)}for(const i of je(e,"GroundOverlay")){const o=o1(i,r,n,t);o&&(yield o)}}function xc(e,t={skipNullGeometry:!1}){return{type:"FeatureCollection",features:Array.from(c1(e,t))}}const u1=async e=>{if(e.name.toLowerCase().endsWith(".kml")){const t=await e.text(),r=new DOMParser().parseFromString(t,"text/xml");return{geojson:xc(r),sessionData:null}}if(e.name.toLowerCase().endsWith(".kmz"))try{const t=await Dc.loadAsync(e);let r=Object.keys(t.files).find(n=>n.toLowerCase().endsWith("waylines.wpml"));if(r||(r=Object.keys(t.files).find(n=>n.toLowerCase().endsWith(".kml"))),r){const n=await t.file(r).async("text"),i=new DOMParser().parseFromString(n,"text/xml"),o=xc(i),a=Array.from(i.getElementsByTagName("Placemark")),s=(m,u)=>{let f=m.getElementsByTagName("wpml:"+u);if(f.length>0||(f=m.getElementsByTagName(u),f.length>0))return f[0].textContent;const b=m.getElementsByTagName("*");for(let S=0;S<b.length;S++)if(b[S].localName===u)return b[S].textContent;return null},l=o.features.length===a.length;if(o.features.forEach((m,u)=>{if(m.geometry.type==="Point"){let f=null;if(l)f=a[u];else{const[b,S]=m.geometry.coordinates;f=a.find(_=>{var P;const N=_.getElementsByTagName("Point")[0];if(!N)return!1;const w=(((P=N.getElementsByTagName("coordinates")[0])==null?void 0:P.textContent)||"").trim().split(",");if(w.length<2)return!1;const C=Number(w[0]),$=Number(w[1]);return Math.abs(C-b)<1e-4&&Math.abs($-S)<1e-4})}if(f){let b=s(f,"waypointHeading");b===null&&(b=s(f,"waypointHeadingAngle"));const S=s(f,"waypointSpeed");let _=s(f,"ellipsoidHeight");_===null&&(_=s(f,"height")),_===null&&(_=s(f,"executeHeight"));const N=s(f,"gimbalPitchAngle");b!==null&&(m.properties.heading=Number(b)),S!==null&&(m.properties.speed=Number(S)),_!==null&&(m.properties.altitude=Number(_)),N!==null&&(m.properties.gimbalPitch=Number(N))}}}),!o||!o.features||o.features.length===0)throw new Error("No features found in KML/WPML file.");let h=null;const g=t.file("wpmz/waygen_session.json");if(g)try{const m=await g.async("text");h=JSON.parse(m)}catch(m){console.warn("Failed to parse session data:",m)}return{geojson:o,sessionData:h}}else throw new Error("No valid KML or WPML file found inside KMZ.")}catch(t){throw console.error("KMZ Parse Error:",t),new Error("Failed to unzip or parse KMZ.")}throw new Error("Unsupported file format. Please use .kml or .kmz")};function f1({isOpen:e,onClose:t,onDownload:r,defaultFilename:n,defaultMissionEndAction:i}){const[o,a]=K.useState(""),[s,l]=K.useState("goHome"),[h,g]=K.useState("");K.useEffect(()=>{e&&(a(n),l(i),g(""))},[e,n,i]);const m=S=>S.replace(/[^a-zA-Z0-9_-]/g,"_").substring(0,100).trim(),u=S=>{const _=m(S.target.value);a(_),g(_.length===0?"Filename cannot be empty":"")},f=()=>{if(!o||o.length===0){g("Filename cannot be empty");return}r({filename:o,missionEndAction:s}),t()},b=S=>{S.key==="Escape"?t():S.key==="Enter"&&!h&&o&&f()};return e?p.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t,children:p.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-96 max-w-full mx-4",onClick:S=>S.stopPropagation(),onKeyDown:b,children:[p.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[p.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"Export Mission"}),p.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:p.jsx(_c,{size:20})})]}),p.jsxs("div",{className:"p-4 space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"text-sm font-bold text-gray-700 mb-2 block",children:"Mission End Action"}),p.jsxs("select",{value:s,onChange:S=>l(S.target.value),className:"w-full border rounded p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none",children:[p.jsx("option",{value:"goHome",children:"Return to Home"}),p.jsx("option",{value:"autoLand",children:"Hover"})]}),p.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s==="goHome"?"Drone will return to launch point after mission":"Drone will hover at final waypoint"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"text-sm font-bold text-gray-700 mb-2 block",children:"File Name"}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("input",{type:"text",value:o,onChange:u,className:`flex-1 border rounded p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none ${h?"border-red-500":""}`,placeholder:"Enter filename",autoFocus:!0}),p.jsx("span",{className:"text-sm text-gray-500 font-medium",children:".kmz"})]}),h&&p.jsx("p",{className:"text-xs text-red-500 mt-1",children:h}),p.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Allowed: letters, numbers, hyphens, underscores"})]})]}),p.jsxs("div",{className:"flex items-center justify-end gap-2 p-4 border-t bg-gray-50",children:[p.jsx("button",{onClick:t,className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 font-medium transition-colors",children:"Cancel"}),p.jsx("button",{onClick:f,disabled:!!h||!o,className:"px-4 py-2 bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-medium rounded text-sm transition-colors",children:"Download"})]})]})}):null}function d1({isOpen:e,onClose:t,warningLevel:r,missionTime:n,droneName:i,maxFlightTime:o}){if(!e)return null;const a=r==="critical",l=a?up:fp,h=a?"text-red-500":"text-yellow-500",g=a?"bg-red-50":"bg-yellow-50",m=a?"border-red-200":"border-yellow-200",u=a?`Mission time (${n}) exceeds the ${i} maximum flight duration (~${o} minutes).`:`Mission time (${n}) is approaching the ${i} maximum flight duration (~${o} minutes).`;return p.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t,children:p.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-96 max-w-full mx-4",onClick:f=>f.stopPropagation(),children:[p.jsxs("div",{className:`flex items-center justify-between p-4 border-b ${m} ${g}`,children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(l,{size:24,className:h}),p.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"Flight Duration Warning"})]}),p.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:p.jsx(_c,{size:20})})]}),p.jsxs("div",{className:"p-4 space-y-4",children:[p.jsx("p",{className:"text-sm text-gray-700",children:u}),p.jsxs("div",{className:`p-3 rounded border ${m} ${g}`,children:[p.jsx("p",{className:"text-sm font-bold text-gray-700 mb-2",children:"Consider:"}),p.jsxs("ul",{className:"text-sm text-gray-600 space-y-1.5 list-disc list-inside",children:[p.jsx("li",{children:"Reducing waypoint coverage area"}),p.jsx("li",{children:"Increasing spacing/overlap settings"}),p.jsx("li",{children:"Splitting into multiple missions"})]})]}),p.jsx("p",{className:"text-xs text-gray-500 italic",children:"You can proceed, but ensure sufficient battery for the mission."})]}),p.jsx("div",{className:"flex items-center justify-end gap-2 p-4 border-t bg-gray-50",children:p.jsx("button",{onClick:t,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded text-sm transition-colors",children:"OK, Got It"})})]})})}const zf=3.28084,ur=(e,t)=>t==="metric"?e:Number((e*zf).toFixed(2)),ln=(e,t)=>t==="metric"?e:e/zf;function p1({selectedWaypoints:e,selectedIds:t,settings:r,onUpdate:n,onDelete:i}){const[o,a]=K.useState({}),[s,l]=K.useState(!1);K.useEffect(()=>{if(e.length===0)return;const u=e[0],f=C=>C.straightenLegs!==void 0?C.straightenLegs.toString():r.straightenLegs?"true":"false",b=C=>C.action?C.action:r.waypointAction==="photo"?"photo":"none",S=f(u),_=b(u),N=C=>e.every($=>$[C]===u[C]),O=(C,$)=>e.every(P=>C(P)===$),w={lat:t.length===1?u.lat:"",lng:t.length===1?u.lng:"",altitude:N("altitude")?ur(u.altitude,r.units):"",speed:N("speed")?ur(u.speed,r.units):"",gimbalPitch:N("gimbalPitch")?u.gimbalPitch:"",heading:N("heading")?u.heading:"",straightenLegs:O(f,S)?S:"mixed",action:O(b,_)?_:"mixed"};a(w),l(!1)},[t,e,r]);const h=(u,f)=>{a(b=>({...b,[u]:f})),l(!0)},g=()=>{const u={};t.length===1&&(u.lat=Number(o.lat),u.lng=Number(o.lng)),o.altitude!==""&&(u.altitude=ln(Number(o.altitude),r.units)),o.speed!==""&&(u.speed=ln(Number(o.speed),r.units)),o.gimbalPitch!==""&&(u.gimbalPitch=Number(o.gimbalPitch)),o.heading!==""&&(u.heading=Number(o.heading)),o.straightenLegs!=="mixed"&&(u.straightenLegs=o.straightenLegs==="true"),o.action!=="mixed"&&(u.action=o.action),n(u),l(!1)},m=t.length===1;return p.jsxs("div",{className:"p-4 bg-gray-50 h-full border-l w-80 flex flex-col shadow-xl z-10 overflow-y-auto",children:[p.jsxs("h2",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[p.jsx(Ec,{size:20})," Edit Selected (",t.length,")"]}),m&&p.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-4",children:[p.jsxs("div",{children:[p.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Lat"}),p.jsx("input",{type:"number",className:"border p-2 rounded w-full text-xs",value:o.lat,onChange:u=>h("lat",u.target.value)})]}),p.jsxs("div",{children:[p.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Lng"}),p.jsx("input",{type:"number",className:"border p-2 rounded w-full text-xs",value:o.lng,onChange:u=>h("lng",u.target.value)})]})]}),p.jsxs("label",{className:"text-xs font-bold text-gray-500",children:["Altitude (",r.units==="metric"?"m":"ft",")"]}),p.jsx("input",{type:"number",className:"border p-2 rounded w-full mb-4",placeholder:o.altitude===""?"Mixed":"",value:o.altitude,onChange:u=>h("altitude",u.target.value)}),p.jsxs("label",{className:"text-xs font-bold text-gray-500",children:["Speed (",r.units==="metric"?"m/s":"ft/s",")"]}),p.jsx("input",{type:"number",className:"border p-2 rounded w-full mb-4",placeholder:o.speed===""?"Mixed":"",value:o.speed,onChange:u=>h("speed",u.target.value)}),p.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Gimbal Pitch ()"}),p.jsx("input",{type:"number",className:"border p-2 rounded w-full mb-4",placeholder:o.gimbalPitch===""?"Mixed":"",value:o.gimbalPitch,onChange:u=>h("gimbalPitch",u.target.value)}),p.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Heading ()"}),p.jsx("input",{type:"number",className:"border p-2 rounded w-full mb-4",placeholder:o.heading===""?"Mixed":"",value:o.heading,onChange:u=>h("heading",u.target.value)}),p.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Turn Mode"}),p.jsxs("select",{className:"border p-2 rounded w-full mb-4 text-sm bg-white",value:o.straightenLegs,onChange:u=>h("straightenLegs",u.target.value),children:[p.jsx("option",{value:"mixed",disabled:!0,hidden:!0,children:"Mixed"}),p.jsx("option",{value:"false",children:"Curved (Continuous)"}),p.jsx("option",{value:"true",children:"Straight (Stop & Turn)"})]}),p.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Action"}),p.jsxs("select",{className:"border p-2 rounded w-full mb-4 text-sm bg-white",value:o.action,onChange:u=>h("action",u.target.value),children:[p.jsx("option",{value:"mixed",disabled:!0,hidden:!0,children:"Mixed"}),p.jsx("option",{value:"none",children:"None"}),p.jsx("option",{value:"photo",children:"Take Photo"}),p.jsx("option",{value:"record_start",children:"Start Recording"}),p.jsx("option",{value:"record_stop",children:"Stop Recording"})]}),p.jsxs("div",{className:"mt-auto flex flex-col gap-2 pt-4",children:[p.jsxs("button",{onClick:g,disabled:!s,className:`w-full p-3 rounded-lg shadow-md flex items-center justify-center gap-2 transition-all font-bold text-white ${s?"bg-blue-600 hover:bg-blue-700":"bg-gray-400 cursor-not-allowed"}`,children:[p.jsx(dp,{size:18})," Update Point(s)"]}),p.jsxs("button",{onClick:i,className:"w-full bg-red-100 hover:bg-red-200 text-red-600 p-2 rounded flex items-center justify-center gap-2 transition-colors font-medium",children:[p.jsx(Ro,{size:16})," Delete Selected"]})]})]})}const uo=({title:e,icon:t,children:r,defaultOpen:n=!1})=>{const[i,o]=K.useState(n);return p.jsxs("div",{className:"border-b border-gray-100 last:border-0",children:[p.jsxs("button",{onClick:()=>o(!i),className:"w-full flex items-center justify-between p-3 hover:bg-gray-50 transition-colors",children:[p.jsxs("div",{className:"flex items-center gap-2 font-semibold text-gray-700",children:[p.jsx(t,{size:18,className:"text-blue-600"}),e]}),i?p.jsx(wp,{size:16,className:"text-gray-400"}):p.jsx(Tp,{size:16,className:"text-gray-400"})]}),i&&p.jsx("div",{className:"p-3 pt-0 space-y-4 animate-in slide-in-from-top-2 duration-200",children:r})]})};function h1({currentPolygon:e,setCurrentPolygon:t}){var V,oe,j;const{waypoints:r,selectedIds:n,settings:i,setWaypoints:o,updateSelectedWaypoints:a,deleteSelectedWaypoints:s,undo:l,redo:h,updateSettings:g,resetMission:m,fitMapToWaypoints:u,currentMissionFilename:f,setMissionFilename:b,calculatedMaxSpeed:S,minSegmentDistance:_}=le(),[N,O]=K.useState(!1),[w,C]=K.useState(!1),[$,P]=K.useState({warning:!1,critical:!1}),M=()=>{confirm("Are you sure you want to reset the mission? This will clear all waypoints and shapes.")&&(m(),t(null))},F=()=>{if(!e)return alert("Draw a shape first!");const x=Sc(e,i),B=Nt(i.selectedDrone),D=(B==null?void 0:B.photoInterval)||5.5,{maxSpeed:G}=Mf(x,D),U={...i,speed:G>0?G:i.speed},H=Sc(e,U);o(H),setTimeout(()=>{le.getState().calculateMissionMetrics()},50)},d=async x=>{const B=x.target.files[0];if(B)try{const{geojson:D,sessionData:G}=await u1(B),U=[];if(D.features.forEach(H=>{H.geometry.type==="Point"&&U.push({id:crypto.randomUUID(),lng:H.geometry.coordinates[0],lat:H.geometry.coordinates[1],altitude:H.properties.altitude!==void 0?H.properties.altitude:i.altitude,speed:H.properties.speed!==void 0?H.properties.speed:i.speed,gimbalPitch:H.properties.gimbalPitch!==void 0?H.properties.gimbalPitch:i.gimbalPitch,heading:H.properties.heading!==void 0?H.properties.heading:0})}),U.length>0){o(U),G?(G.settings&&g(G.settings),G.polygon&&t&&(t(G.polygon),window.dispatchEvent(new CustomEvent("waygen:restore-polygon",{detail:G.polygon}))),alert(`Imported ${U.length} waypoints and restored session!`)):alert(`Imported ${U.length} waypoints!`);const H=B.name.replace(/\.(kmz|kml)$/i,"");b(H),setTimeout(()=>{u(),le.getState().calculateMissionMetrics()},100)}else alert("No waypoints found in file.")}catch(D){console.error(D),alert("Failed to parse file. Ensure it is a valid KML/KMZ.")}},I=()=>f||`waygen_${new Date().toISOString().replace(/[-:]/g,"").replace(/\..+/,"").replace("T","_").substring(0,15)}`,T=()=>{O(!0)},v=({filename:x,missionEndAction:B})=>{g({missionEndAction:B}),qS(r,i,x,{settings:i,polygon:e})},E=x=>{if(x.length<2)return 0;let B=0;for(let D=0;D<x.length-1;D++){const G=ve([x[D].lng,x[D].lat]),U=ve([x[D+1].lng,x[D+1].lat]);B+=tt(G,U,{units:"meters"})}return B},L=x=>{const B=Math.floor(x/60),D=x%60;return`${B}:${D.toString().padStart(2,"0")}`},k=(x,B)=>{if(B==="metric")return x>=1e3?`${(x/1e3).toFixed(2)} km`:`${Math.round(x)} m`;{const D=x*3.28084;return D>=5280?`${(D/5280).toFixed(2)} mi`:`${Math.round(D)} ft`}};if(n.length>0){const x=r.filter(B=>n.includes(B.id));return p.jsx(p1,{selectedWaypoints:x,selectedIds:n,settings:i,onUpdate:a,onDelete:s})}return p.jsxs("div",{className:"bg-white h-full border-l w-80 flex flex-col shadow-xl z-10 flex-shrink-0",children:[p.jsxs("div",{className:"p-4 border-b flex justify-between items-center bg-gray-50",children:[p.jsxs("div",{children:[p.jsx("h1",{className:"font-bold text-xl text-gray-800",children:"Waygen"}),f&&p.jsx("div",{className:"text-sm text-gray-500 truncate max-w-[200px]",title:f,children:f})]}),p.jsxs("div",{className:"flex gap-1",children:[p.jsx("button",{onClick:M,className:"p-2 hover:bg-red-100 hover:text-red-600 rounded-full shadow-sm border transition-all",title:"Reset Mission",children:p.jsx(Ro,{size:16})}),p.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1 self-center"}),p.jsx("button",{onClick:l,className:"p-2 hover:bg-white rounded-full shadow-sm border transition-all",children:p.jsx(pp,{size:16})}),p.jsx("button",{onClick:h,className:"p-2 hover:bg-white rounded-full shadow-sm border transition-all",children:p.jsx(hp,{size:16})})]})]}),p.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[p.jsx("div",{className:"p-3",children:p.jsxs("label",{className:"flex items-center justify-center gap-2 w-full p-2 bg-blue-50 text-blue-700 rounded-lg border border-blue-100 hover:bg-blue-100 transition-colors cursor-pointer font-medium text-sm",children:[p.jsx(gp,{size:16})," Import KML/KMZ",p.jsx("input",{type:"file",onChange:d,className:"hidden",accept:".kml,.kmz"})]})}),p.jsxs(uo,{title:"Basics",icon:Ec,defaultOpen:!0,children:[p.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[p.jsxs("div",{children:[p.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Units"}),p.jsxs("select",{value:i.units,onChange:x=>g({units:x.target.value}),className:"w-full border rounded p-1.5 text-sm bg-gray-50 focus:ring-2 focus:ring-blue-500 outline-none",children:[p.jsx("option",{value:"metric",children:"Metric (m)"}),p.jsx("option",{value:"imperial",children:"Imperial (ft)"})]})]}),p.jsxs("div",{children:[p.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Altitude (",i.units==="metric"?"m":"ft",")"]}),p.jsx("input",{type:"number",value:ur(i.altitude,i.units),onChange:x=>g({altitude:ln(Number(x.target.value),i.units)}),className:"w-full border rounded p-1.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none"})]})]}),p.jsxs("div",{className:"mt-4 border-t pt-3",children:[p.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Drone Model (FOV)"}),p.jsxs("select",{value:i.selectedDrone,onChange:x=>{const B=x.target.value;let D=82.1;B==="dji_mini_5_pro"&&(D=84),B==="dji_mavic_4_pro"&&(D=72),B==="custom"&&(D=i.customFOV),g({selectedDrone:B,customFOV:D})},className:"w-full border rounded p-1.5 text-sm bg-gray-50 focus:ring-2 focus:ring-blue-500 outline-none",children:[p.jsx("option",{value:"dji_mini_4_pro",children:"DJI Mini 4 Pro (82.1)"}),p.jsx("option",{value:"dji_mini_5_pro",children:"DJI Mini 5 Pro (84)"}),p.jsx("option",{value:"dji_mavic_4_pro",children:"DJI Mavic 4 Pro (72)"}),p.jsx("option",{value:"custom",children:"Custom"})]})]}),p.jsxs("div",{className:"mt-2",children:[p.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Photo Interval"}),p.jsxs("div",{className:"text-sm text-gray-700 bg-gray-50 border rounded p-1.5",children:[((V=Nt(i.selectedDrone))==null?void 0:V.photoInterval)||5.5," seconds"]})]}),i.selectedDrone==="custom"&&p.jsxs("div",{className:"mt-2",children:[p.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Custom HFOV ()"}),p.jsx("input",{type:"number",value:i.customFOV,onChange:x=>g({customFOV:Number(x.target.value)}),className:"w-full border rounded p-1.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none"})]})]}),p.jsxs(uo,{title:"Coverage",icon:yp,defaultOpen:!0,children:[p.jsxs("div",{className:"mb-3",children:[p.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Path Type"}),p.jsxs("div",{className:"flex bg-gray-100 p-1 rounded-lg",children:[p.jsx("button",{onClick:()=>g({pathType:"grid"}),className:`flex-1 py-1 text-xs font-bold rounded-md transition-all ${i.pathType==="grid"?"bg-white shadow text-blue-600":"text-gray-500 hover:text-gray-700"}`,children:"Grid"}),p.jsx("button",{onClick:()=>g({pathType:"orbit",spacing:10}),className:`flex-1 py-1 text-xs font-bold rounded-md transition-all ${i.pathType==="orbit"?"bg-white shadow text-blue-600":"text-gray-500 hover:text-gray-700"}`,children:"Orbit"})]})]}),i.pathType==="grid"?p.jsxs(p.Fragment,{children:[p.jsxs("div",{children:[p.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Side Overlap ",i.sideOverlap,"%"]}),p.jsx("input",{type:"range",min:"0",max:"90",value:i.sideOverlap,onChange:x=>g({sideOverlap:Number(x.target.value)}),className:"w-full accent-blue-600"})]}),p.jsxs("div",{children:[p.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Front Overlap ",i.frontOverlap,"%"]}),p.jsx("input",{type:"range",min:"0",max:"90",value:i.frontOverlap,onChange:x=>g({frontOverlap:Number(x.target.value)}),className:"w-full accent-blue-600"})]}),p.jsxs("div",{className:"flex items-center justify-between mt-2",children:[p.jsx("label",{className:"text-sm text-gray-700",children:"Auto Path Angle"}),p.jsx("input",{type:"checkbox",checked:i.autoDirection,onChange:x=>g({autoDirection:x.target.checked}),className:"accent-blue-600 w-4 h-4"})]}),p.jsxs("div",{className:`mt-2 transition-opacity ${i.autoDirection?"opacity-50":"opacity-100"}`,children:[p.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Path Angle ",i.angle,""]}),p.jsx("input",{type:"range",min:"0",max:"360",value:i.angle,onChange:x=>g({angle:Number(x.target.value)}),disabled:i.autoDirection,className:`w-full ${i.autoDirection?"accent-gray-400 cursor-not-allowed":"accent-blue-600"}`})]})]}):p.jsx("div",{className:"space-y-3",children:p.jsxs("div",{children:[p.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Spacing (",i.units==="metric"?"m":"ft",")"]}),p.jsx("input",{type:"number",min:"1",value:ur(i.spacing,i.units),onChange:x=>g({spacing:ln(Number(x.target.value),i.units)}),className:"w-full border rounded p-1.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none"}),p.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Distance between waypoints along the perimeter."})]})}),p.jsxs("div",{className:"flex items-center justify-between mt-2",children:[p.jsx("label",{className:"text-sm text-gray-700",children:"Reverse Path"}),p.jsx("input",{type:"checkbox",checked:i.reversePath,onChange:x=>g({reversePath:x.target.checked}),className:"accent-blue-600 w-4 h-4"})]}),p.jsxs("div",{className:"flex items-center justify-between mt-3",children:[p.jsx("label",{className:"text-sm text-gray-700",children:"Straighten Legs"}),p.jsx("input",{type:"checkbox",checked:i.straightenLegs,onChange:x=>g({straightenLegs:x.target.checked}),className:"accent-blue-600 w-4 h-4"})]}),p.jsxs("div",{className:"flex items-center justify-between mt-3",children:[p.jsx("label",{className:"text-sm text-gray-700",children:"Generate Every Point"}),p.jsx("input",{type:"checkbox",checked:i.generateEveryPoint,onChange:x=>g({generateEveryPoint:x.target.checked}),className:"accent-blue-600 w-4 h-4"})]})]}),p.jsxs(uo,{title:"Camera",icon:mp,defaultOpen:!0,children:[p.jsxs("div",{children:[p.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Gimbal Pitch ",i.gimbalPitch,""]}),p.jsx("input",{type:"range",min:"-90",max:"0",value:i.gimbalPitch,onChange:x=>g({gimbalPitch:Number(x.target.value)}),className:"w-full accent-blue-600"})]}),p.jsxs("div",{className:"mt-2",children:[p.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Action per Waypoint"}),p.jsxs("select",{value:i.waypointAction,onChange:x=>g({waypointAction:x.target.value}),className:"w-full border rounded p-1.5 text-sm bg-gray-50 focus:ring-2 focus:ring-blue-500 outline-none",children:[p.jsx("option",{value:"none",children:"No Action"}),p.jsx("option",{value:"photo",children:"Take Photo"}),p.jsx("option",{value:"record",children:"Start/Stop Recording"})]})]}),p.jsxs("div",{className:"flex items-center justify-between mt-3",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("label",{className:"text-sm text-gray-700",children:"Show Footprints"}),i.showFootprints&&p.jsx("input",{type:"color",value:i.footprintColor,onChange:x=>g({footprintColor:x.target.value}),className:"w-4 h-4 rounded border border-gray-300 cursor-pointer",title:"Choose footprint color"})]}),p.jsx("input",{type:"checkbox",checked:i.showFootprints,onChange:x=>g({showFootprints:x.target.checked}),className:"accent-blue-600 w-4 h-4"})]})]})]}),p.jsxs("div",{className:"p-4 border-t bg-gray-50",children:[p.jsxs("button",{onClick:F,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold p-3 rounded-lg shadow-md mb-3 flex items-center justify-center gap-2 transition-all transform active:scale-95",children:[p.jsx(vp,{size:18})," Generate Path"]}),p.jsxs("div",{className:"flex flex-col gap-2",children:[p.jsxs("div",{className:"bg-white border rounded p-2 text-center",children:[p.jsx("div",{className:"text-xs text-gray-400 font-bold uppercase",children:"Waypoints"}),p.jsx("div",{className:"font-bold text-gray-700",children:r.length})]}),p.jsxs("div",{className:"bg-white border rounded p-2 text-center",children:[p.jsx("div",{className:"text-xs text-gray-400 font-bold uppercase",children:"Distance"}),p.jsx("div",{className:"font-bold text-gray-700",children:r.length>=2?k(E(r),i.units):i.units==="metric"?"0 m":"0 ft"})]}),p.jsxs("div",{className:"bg-white border rounded p-2 text-center",children:[p.jsx("div",{className:"text-xs text-gray-400 font-bold uppercase",children:"Max Speed"}),p.jsx("div",{className:"font-bold text-gray-700",title:`Based on ${Math.round(_)}m minimum segment`,children:r.length>=2&&S>0?`${ur(S,i.units).toFixed(1)} ${i.units==="metric"?"m/s":"ft/s"}`:i.units==="metric"?"0 m/s":"0 ft/s"})]}),p.jsxs("div",{className:`bg-white border rounded p-2 text-center ${(()=>{const x=le.getState().getFlightWarningLevel();return x==="critical"?"border-red-500 bg-red-50":x==="warning"?"border-yellow-500 bg-yellow-50":""})()}`,children:[p.jsx("div",{className:"text-xs text-gray-400 font-bold uppercase",children:"Est. Time"}),p.jsx("div",{className:`font-bold ${(()=>{const x=le.getState().getFlightWarningLevel();return x==="critical"?"text-red-600":x==="warning"?"text-yellow-700":"text-gray-700"})()}`,children:r.length>=2&&S>0?(()=>{const x=le.getState().getMissionTime(),B=le.getState().getFlightWarningLevel(),D=L(x),G=B==="critical"?" ":B==="warning"?" ":"";return B!=="safe"&&!$[B]&&setTimeout(()=>{C(!0),P(U=>({...U,[B]:!0}))},500),p.jsxs("span",{title:`${x}s total`,children:[D,G]})})():"0:00"})]})]}),p.jsxs("button",{onClick:T,disabled:r.length===0,className:"w-full mt-3 bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold p-3 rounded-lg shadow-md flex items-center justify-center gap-2 transition-all",children:[p.jsx(bp,{size:18})," Download KMZ"]})]}),p.jsx(f1,{isOpen:N,onClose:()=>O(!1),onDownload:v,defaultFilename:I(),defaultMissionEndAction:i.missionEndAction}),p.jsx(d1,{isOpen:w,onClose:()=>C(!1),warningLevel:le.getState().getFlightWarningLevel(),missionTime:r.length>=2?L(le.getState().getMissionTime()):"0:00",droneName:((oe=Nt(i.selectedDrone))==null?void 0:oe.name)||"Unknown Drone",maxFlightTime:((j=Nt(i.selectedDrone))==null?void 0:j.maxFlightTime)||0})]})}function g1({map:e}){const t=K.useRef(null);return K.useEffect(()=>{if(!e||!t.current||document.querySelector(".mapboxgl-ctrl-geocoder"))return;const r=new Cc({accessToken:mapboxgl.accessToken,mapboxgl,marker:!1,collapsed:!0});t.current.appendChild(r.onAdd(e))},[e]),p.jsx("div",{ref:t,className:"absolute top-4 right-4 z-10"})}function y1(){const[e,t]=K.useState(null),[r,n]=K.useState(!0);return Ac.useEffect(()=>{const i=setTimeout(()=>n(!1),1e3);return()=>clearTimeout(i)},[]),r?p.jsx("div",{className:"flex h-screen w-screen items-center justify-center bg-gray-50",children:p.jsx("div",{className:"text-2xl font-bold text-blue-600 animate-pulse",children:"Waygen Loading..."})}):p.jsxs("div",{className:"flex h-screen w-screen overflow-hidden",children:[p.jsxs("div",{className:"relative flex-grow",children:[p.jsx(g1,{}),p.jsx(US,{onPolygonDrawn:t})]}),p.jsx(h1,{currentPolygon:e,setCurrentPolygon:t})]})}fo.createRoot(document.getElementById("root")).render(p.jsx(Ac.StrictMode,{children:p.jsx(y1,{})}));
