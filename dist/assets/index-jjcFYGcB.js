(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))l(c);new MutationObserver(c=>{for(const d of c)if(d.type==="childList")for(const _ of d.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&l(_)}).observe(document,{childList:!0,subtree:!0});function n(c){const d={};return c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function l(c){if(c.ep)return;c.ep=!0;const d=n(c);fetch(c.href,d)}})();var Am=typeof globalThis<"u"?globalThis:typeof window<"u"||typeof window<"u"?window:typeof self<"u"?self:{};function Pu(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Cm(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function l(){return this instanceof l?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(l){var c=Object.getOwnPropertyDescriptor(e,l);Object.defineProperty(n,l,c.get?c:{enumerable:!0,get:function(){return e[l]}})}),n}var v3={exports:{}},cv={},x3={exports:{}},zr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Im=Symbol.for("react.element"),fN=Symbol.for("react.portal"),dN=Symbol.for("react.fragment"),pN=Symbol.for("react.strict_mode"),mN=Symbol.for("react.profiler"),gN=Symbol.for("react.provider"),yN=Symbol.for("react.context"),_N=Symbol.for("react.forward_ref"),vN=Symbol.for("react.suspense"),xN=Symbol.for("react.memo"),bN=Symbol.for("react.lazy"),cI=Symbol.iterator;function wN(e){return e===null||typeof e!="object"?null:(e=cI&&e[cI]||e["@@iterator"],typeof e=="function"?e:null)}var b3={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w3=Object.assign,E3={};function Hf(e,t,n){this.props=e,this.context=t,this.refs=E3,this.updater=n||b3}Hf.prototype.isReactComponent={};Hf.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Hf.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function T3(){}T3.prototype=Hf.prototype;function OE(e,t,n){this.props=e,this.context=t,this.refs=E3,this.updater=n||b3}var DE=OE.prototype=new T3;DE.constructor=OE;w3(DE,Hf.prototype);DE.isPureReactComponent=!0;var hI=Array.isArray,S3=Object.prototype.hasOwnProperty,RE={current:null},A3={key:!0,ref:!0,__self:!0,__source:!0};function C3(e,t,n){var l,c={},d=null,_=null;if(t!=null)for(l in t.ref!==void 0&&(_=t.ref),t.key!==void 0&&(d=""+t.key),t)S3.call(t,l)&&!A3.hasOwnProperty(l)&&(c[l]=t[l]);var w=arguments.length-2;if(w===1)c.children=n;else if(1<w){for(var a=Array(w),S=0;S<w;S++)a[S]=arguments[S+2];c.children=a}if(e&&e.defaultProps)for(l in w=e.defaultProps,w)c[l]===void 0&&(c[l]=w[l]);return{$$typeof:Im,type:e,key:d,ref:_,props:c,_owner:RE.current}}function EN(e,t){return{$$typeof:Im,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function zE(e){return typeof e=="object"&&e!==null&&e.$$typeof===Im}function TN(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var fI=/\/+/g;function Fx(e,t){return typeof e=="object"&&e!==null&&e.key!=null?TN(""+e.key):t.toString(36)}function qy(e,t,n,l,c){var d=typeof e;(d==="undefined"||d==="boolean")&&(e=null);var _=!1;if(e===null)_=!0;else switch(d){case"string":case"number":_=!0;break;case"object":switch(e.$$typeof){case Im:case fN:_=!0}}if(_)return _=e,c=c(_),e=l===""?"."+Fx(_,0):l,hI(c)?(n="",e!=null&&(n=e.replace(fI,"$&/")+"/"),qy(c,t,n,"",function(S){return S})):c!=null&&(zE(c)&&(c=EN(c,n+(!c.key||_&&_.key===c.key?"":(""+c.key).replace(fI,"$&/")+"/")+e)),t.push(c)),1;if(_=0,l=l===""?".":l+":",hI(e))for(var w=0;w<e.length;w++){d=e[w];var a=l+Fx(d,w);_+=qy(d,t,n,a,c)}else if(a=wN(e),typeof a=="function")for(e=a.call(e),w=0;!(d=e.next()).done;)d=d.value,a=l+Fx(d,w++),_+=qy(d,t,n,a,c);else if(d==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return _}function cy(e,t,n){if(e==null)return e;var l=[],c=0;return qy(e,l,"","",function(d){return t.call(n,d,c++)}),l}function SN(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Do={current:null},Wy={transition:null},AN={ReactCurrentDispatcher:Do,ReactCurrentBatchConfig:Wy,ReactCurrentOwner:RE};function I3(){throw Error("act(...) is not supported in production builds of React.")}zr.Children={map:cy,forEach:function(e,t,n){cy(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return cy(e,function(){t++}),t},toArray:function(e){return cy(e,function(t){return t})||[]},only:function(e){if(!zE(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};zr.Component=Hf;zr.Fragment=dN;zr.Profiler=mN;zr.PureComponent=OE;zr.StrictMode=pN;zr.Suspense=vN;zr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=AN;zr.act=I3;zr.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var l=w3({},e.props),c=e.key,d=e.ref,_=e._owner;if(t!=null){if(t.ref!==void 0&&(d=t.ref,_=RE.current),t.key!==void 0&&(c=""+t.key),e.type&&e.type.defaultProps)var w=e.type.defaultProps;for(a in t)S3.call(t,a)&&!A3.hasOwnProperty(a)&&(l[a]=t[a]===void 0&&w!==void 0?w[a]:t[a])}var a=arguments.length-2;if(a===1)l.children=n;else if(1<a){w=Array(a);for(var S=0;S<a;S++)w[S]=arguments[S+2];l.children=w}return{$$typeof:Im,type:e.type,key:c,ref:d,props:l,_owner:_}};zr.createContext=function(e){return e={$$typeof:yN,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:gN,_context:e},e.Consumer=e};zr.createElement=C3;zr.createFactory=function(e){var t=C3.bind(null,e);return t.type=e,t};zr.createRef=function(){return{current:null}};zr.forwardRef=function(e){return{$$typeof:_N,render:e}};zr.isValidElement=zE;zr.lazy=function(e){return{$$typeof:bN,_payload:{_status:-1,_result:e},_init:SN}};zr.memo=function(e,t){return{$$typeof:xN,type:e,compare:t===void 0?null:t}};zr.startTransition=function(e){var t=Wy.transition;Wy.transition={};try{e()}finally{Wy.transition=t}};zr.unstable_act=I3;zr.useCallback=function(e,t){return Do.current.useCallback(e,t)};zr.useContext=function(e){return Do.current.useContext(e)};zr.useDebugValue=function(){};zr.useDeferredValue=function(e){return Do.current.useDeferredValue(e)};zr.useEffect=function(e,t){return Do.current.useEffect(e,t)};zr.useId=function(){return Do.current.useId()};zr.useImperativeHandle=function(e,t,n){return Do.current.useImperativeHandle(e,t,n)};zr.useInsertionEffect=function(e,t){return Do.current.useInsertionEffect(e,t)};zr.useLayoutEffect=function(e,t){return Do.current.useLayoutEffect(e,t)};zr.useMemo=function(e,t){return Do.current.useMemo(e,t)};zr.useReducer=function(e,t,n){return Do.current.useReducer(e,t,n)};zr.useRef=function(e){return Do.current.useRef(e)};zr.useState=function(e){return Do.current.useState(e)};zr.useSyncExternalStore=function(e,t,n){return Do.current.useSyncExternalStore(e,t,n)};zr.useTransition=function(){return Do.current.useTransition()};zr.version="18.3.1";x3.exports=zr;var Sr=x3.exports;const FE=Pu(Sr);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var CN=Sr,IN=Symbol.for("react.element"),MN=Symbol.for("react.fragment"),PN=Object.prototype.hasOwnProperty,kN=CN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,LN={key:!0,ref:!0,__self:!0,__source:!0};function M3(e,t,n){var l,c={},d=null,_=null;n!==void 0&&(d=""+n),t.key!==void 0&&(d=""+t.key),t.ref!==void 0&&(_=t.ref);for(l in t)PN.call(t,l)&&!LN.hasOwnProperty(l)&&(c[l]=t[l]);if(e&&e.defaultProps)for(l in t=e.defaultProps,t)c[l]===void 0&&(c[l]=t[l]);return{$$typeof:IN,type:e,key:d,ref:_,props:c,_owner:kN.current}}cv.Fragment=MN;cv.jsx=M3;cv.jsxs=M3;v3.exports=cv;var Be=v3.exports,ew={},P3={exports:{}},gs={},k3={exports:{}},L3={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(He,_e){var qe=He.length;He.push(_e);e:for(;0<qe;){var Pe=qe-1>>>1,Le=He[Pe];if(0<c(Le,_e))He[Pe]=_e,He[qe]=Le,qe=Pe;else break e}}function n(He){return He.length===0?null:He[0]}function l(He){if(He.length===0)return null;var _e=He[0],qe=He.pop();if(qe!==_e){He[0]=qe;e:for(var Pe=0,Le=He.length,Pt=Le>>>1;Pe<Pt;){var lt=2*(Pe+1)-1,at=He[lt],Jt=lt+1,Er=He[Jt];if(0>c(at,qe))Jt<Le&&0>c(Er,at)?(He[Pe]=Er,He[Jt]=qe,Pe=Jt):(He[Pe]=at,He[lt]=qe,Pe=lt);else if(Jt<Le&&0>c(Er,qe))He[Pe]=Er,He[Jt]=qe,Pe=Jt;else break e}}return _e}function c(He,_e){var qe=He.sortIndex-_e.sortIndex;return qe!==0?qe:He.id-_e.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;e.unstable_now=function(){return d.now()}}else{var _=Date,w=_.now();e.unstable_now=function(){return _.now()-w}}var a=[],S=[],D=1,R=null,I=3,M=!1,N=!1,j=!1,W=typeof setTimeout=="function"?setTimeout:null,B=typeof clearTimeout=="function"?clearTimeout:null,k=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function z(He){for(var _e=n(S);_e!==null;){if(_e.callback===null)l(S);else if(_e.startTime<=He)l(S),_e.sortIndex=_e.expirationTime,t(a,_e);else break;_e=n(S)}}function Z(He){if(j=!1,z(He),!N)if(n(a)!==null)N=!0,Mt(ee);else{var _e=n(S);_e!==null&&ct(Z,_e.startTime-He)}}function ee(He,_e){N=!1,j&&(j=!1,B(Te),Te=-1),M=!0;var qe=I;try{for(z(_e),R=n(a);R!==null&&(!(R.expirationTime>_e)||He&&!ye());){var Pe=R.callback;if(typeof Pe=="function"){R.callback=null,I=R.priorityLevel;var Le=Pe(R.expirationTime<=_e);_e=e.unstable_now(),typeof Le=="function"?R.callback=Le:R===n(a)&&l(a),z(_e)}else l(a);R=n(a)}if(R!==null)var Pt=!0;else{var lt=n(S);lt!==null&&ct(Z,lt.startTime-_e),Pt=!1}return Pt}finally{R=null,I=qe,M=!1}}var se=!1,ue=null,Te=-1,Q=5,he=-1;function ye(){return!(e.unstable_now()-he<Q)}function J(){if(ue!==null){var He=e.unstable_now();he=He;var _e=!0;try{_e=ue(!0,He)}finally{_e?ie():(se=!1,ue=null)}}else se=!1}var ie;if(typeof k=="function")ie=function(){k(J)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,Ke=q.port2;q.port1.onmessage=J,ie=function(){Ke.postMessage(null)}}else ie=function(){W(J,0)};function Mt(He){ue=He,se||(se=!0,ie())}function ct(He,_e){Te=W(function(){He(e.unstable_now())},_e)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(He){He.callback=null},e.unstable_continueExecution=function(){N||M||(N=!0,Mt(ee))},e.unstable_forceFrameRate=function(He){0>He||125<He?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<He?Math.floor(1e3/He):5},e.unstable_getCurrentPriorityLevel=function(){return I},e.unstable_getFirstCallbackNode=function(){return n(a)},e.unstable_next=function(He){switch(I){case 1:case 2:case 3:var _e=3;break;default:_e=I}var qe=I;I=_e;try{return He()}finally{I=qe}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(He,_e){switch(He){case 1:case 2:case 3:case 4:case 5:break;default:He=3}var qe=I;I=He;try{return _e()}finally{I=qe}},e.unstable_scheduleCallback=function(He,_e,qe){var Pe=e.unstable_now();switch(typeof qe=="object"&&qe!==null?(qe=qe.delay,qe=typeof qe=="number"&&0<qe?Pe+qe:Pe):qe=Pe,He){case 1:var Le=-1;break;case 2:Le=250;break;case 5:Le=1073741823;break;case 4:Le=1e4;break;default:Le=5e3}return Le=qe+Le,He={id:D++,callback:_e,priorityLevel:He,startTime:qe,expirationTime:Le,sortIndex:-1},qe>Pe?(He.sortIndex=qe,t(S,He),n(a)===null&&He===n(S)&&(j?(B(Te),Te=-1):j=!0,ct(Z,qe-Pe))):(He.sortIndex=Le,t(a,He),N||M||(N=!0,Mt(ee))),He},e.unstable_shouldYield=ye,e.unstable_wrapCallback=function(He){var _e=I;return function(){var qe=I;I=_e;try{return He.apply(this,arguments)}finally{I=qe}}}})(L3);k3.exports=L3;var ON=k3.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DN=Sr,ps=ON;function Dt(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var O3=new Set,sm={};function Gc(e,t){Of(e,t),Of(e+"Capture",t)}function Of(e,t){for(sm[e]=t,e=0;e<t.length;e++)O3.add(t[e])}var Tl=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),tw=Object.prototype.hasOwnProperty,RN=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,dI={},pI={};function zN(e){return tw.call(pI,e)?!0:tw.call(dI,e)?!1:RN.test(e)?pI[e]=!0:(dI[e]=!0,!1)}function FN(e,t,n,l){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return l?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function BN(e,t,n,l){if(t===null||typeof t>"u"||FN(e,t,n,l))return!0;if(l)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Ro(e,t,n,l,c,d,_){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=l,this.attributeNamespace=c,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=d,this.removeEmptyString=_}var Qi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Qi[e]=new Ro(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Qi[t]=new Ro(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Qi[e]=new Ro(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Qi[e]=new Ro(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Qi[e]=new Ro(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Qi[e]=new Ro(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Qi[e]=new Ro(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Qi[e]=new Ro(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Qi[e]=new Ro(e,5,!1,e.toLowerCase(),null,!1,!1)});var BE=/[\-:]([a-z])/g;function NE(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(BE,NE);Qi[t]=new Ro(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(BE,NE);Qi[t]=new Ro(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(BE,NE);Qi[t]=new Ro(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Qi[e]=new Ro(e,1,!1,e.toLowerCase(),null,!1,!1)});Qi.xlinkHref=new Ro("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Qi[e]=new Ro(e,1,!1,e.toLowerCase(),null,!0,!0)});function UE(e,t,n,l){var c=Qi.hasOwnProperty(t)?Qi[t]:null;(c!==null?c.type!==0:l||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(BN(t,n,c,l)&&(n=null),l||c===null?zN(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):c.mustUseProperty?e[c.propertyName]=n===null?c.type===3?!1:"":n:(t=c.attributeName,l=c.attributeNamespace,n===null?e.removeAttribute(t):(c=c.type,n=c===3||c===4&&n===!0?"":""+n,l?e.setAttributeNS(l,t,n):e.setAttribute(t,n))))}var Il=DN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,hy=Symbol.for("react.element"),af=Symbol.for("react.portal"),lf=Symbol.for("react.fragment"),$E=Symbol.for("react.strict_mode"),rw=Symbol.for("react.profiler"),D3=Symbol.for("react.provider"),R3=Symbol.for("react.context"),jE=Symbol.for("react.forward_ref"),nw=Symbol.for("react.suspense"),iw=Symbol.for("react.suspense_list"),VE=Symbol.for("react.memo"),uu=Symbol.for("react.lazy"),z3=Symbol.for("react.offscreen"),mI=Symbol.iterator;function Sp(e){return e===null||typeof e!="object"?null:(e=mI&&e[mI]||e["@@iterator"],typeof e=="function"?e:null)}var ei=Object.assign,Bx;function Fp(e){if(Bx===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Bx=t&&t[1]||""}return`
`+Bx+e}var Nx=!1;function Ux(e,t){if(!e||Nx)return"";Nx=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(S){var l=S}Reflect.construct(e,[],t)}else{try{t.call()}catch(S){l=S}e.call(t.prototype)}else{try{throw Error()}catch(S){l=S}e()}}catch(S){if(S&&l&&typeof S.stack=="string"){for(var c=S.stack.split(`
`),d=l.stack.split(`
`),_=c.length-1,w=d.length-1;1<=_&&0<=w&&c[_]!==d[w];)w--;for(;1<=_&&0<=w;_--,w--)if(c[_]!==d[w]){if(_!==1||w!==1)do if(_--,w--,0>w||c[_]!==d[w]){var a=`
`+c[_].replace(" at new "," at ");return e.displayName&&a.includes("<anonymous>")&&(a=a.replace("<anonymous>",e.displayName)),a}while(1<=_&&0<=w);break}}}finally{Nx=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Fp(e):""}function NN(e){switch(e.tag){case 5:return Fp(e.type);case 16:return Fp("Lazy");case 13:return Fp("Suspense");case 19:return Fp("SuspenseList");case 0:case 2:case 15:return e=Ux(e.type,!1),e;case 11:return e=Ux(e.type.render,!1),e;case 1:return e=Ux(e.type,!0),e;default:return""}}function ow(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case lf:return"Fragment";case af:return"Portal";case rw:return"Profiler";case $E:return"StrictMode";case nw:return"Suspense";case iw:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case R3:return(e.displayName||"Context")+".Consumer";case D3:return(e._context.displayName||"Context")+".Provider";case jE:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case VE:return t=e.displayName||null,t!==null?t:ow(e.type)||"Memo";case uu:t=e._payload,e=e._init;try{return ow(e(t))}catch{}}return null}function UN(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ow(t);case 8:return t===$E?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Su(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function F3(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function $N(e){var t=F3(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),l=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var c=n.get,d=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return c.call(this)},set:function(_){l=""+_,d.call(this,_)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return l},setValue:function(_){l=""+_},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function fy(e){e._valueTracker||(e._valueTracker=$N(e))}function B3(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),l="";return e&&(l=F3(e)?e.checked?"true":"false":e.value),e=l,e!==n?(t.setValue(e),!0):!1}function m_(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function sw(e,t){var n=t.checked;return ei({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function gI(e,t){var n=t.defaultValue==null?"":t.defaultValue,l=t.checked!=null?t.checked:t.defaultChecked;n=Su(t.value!=null?t.value:n),e._wrapperState={initialChecked:l,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function N3(e,t){t=t.checked,t!=null&&UE(e,"checked",t,!1)}function aw(e,t){N3(e,t);var n=Su(t.value),l=t.type;if(n!=null)l==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(l==="submit"||l==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?lw(e,t.type,n):t.hasOwnProperty("defaultValue")&&lw(e,t.type,Su(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function yI(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var l=t.type;if(!(l!=="submit"&&l!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function lw(e,t,n){(t!=="number"||m_(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var Bp=Array.isArray;function bf(e,t,n,l){if(e=e.options,t){t={};for(var c=0;c<n.length;c++)t["$"+n[c]]=!0;for(n=0;n<e.length;n++)c=t.hasOwnProperty("$"+e[n].value),e[n].selected!==c&&(e[n].selected=c),c&&l&&(e[n].defaultSelected=!0)}else{for(n=""+Su(n),t=null,c=0;c<e.length;c++){if(e[c].value===n){e[c].selected=!0,l&&(e[c].defaultSelected=!0);return}t!==null||e[c].disabled||(t=e[c])}t!==null&&(t.selected=!0)}}function uw(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Dt(91));return ei({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function _I(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(Dt(92));if(Bp(n)){if(1<n.length)throw Error(Dt(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:Su(n)}}function U3(e,t){var n=Su(t.value),l=Su(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),l!=null&&(e.defaultValue=""+l)}function vI(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function $3(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function cw(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?$3(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var dy,j3=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,l,c){MSApp.execUnsafeLocalFunction(function(){return e(t,n,l,c)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(dy=dy||document.createElement("div"),dy.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=dy.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function am(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Gp={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},jN=["Webkit","ms","Moz","O"];Object.keys(Gp).forEach(function(e){jN.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Gp[t]=Gp[e]})});function V3(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Gp.hasOwnProperty(e)&&Gp[e]?(""+t).trim():t+"px"}function G3(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var l=n.indexOf("--")===0,c=V3(n,t[n],l);n==="float"&&(n="cssFloat"),l?e.setProperty(n,c):e[n]=c}}var VN=ei({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function hw(e,t){if(t){if(VN[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Dt(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Dt(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Dt(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Dt(62))}}function fw(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var dw=null;function GE(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var pw=null,wf=null,Ef=null;function xI(e){if(e=km(e)){if(typeof pw!="function")throw Error(Dt(280));var t=e.stateNode;t&&(t=mv(t),pw(e.stateNode,e.type,t))}}function q3(e){wf?Ef?Ef.push(e):Ef=[e]:wf=e}function W3(){if(wf){var e=wf,t=Ef;if(Ef=wf=null,xI(e),t)for(e=0;e<t.length;e++)xI(t[e])}}function Z3(e,t){return e(t)}function H3(){}var $x=!1;function X3(e,t,n){if($x)return e(t,n);$x=!0;try{return Z3(e,t,n)}finally{$x=!1,(wf!==null||Ef!==null)&&(H3(),W3())}}function lm(e,t){var n=e.stateNode;if(n===null)return null;var l=mv(n);if(l===null)return null;n=l[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(e=e.type,l=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!l;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(Dt(231,t,typeof n));return n}var mw=!1;if(Tl)try{var Ap={};Object.defineProperty(Ap,"passive",{get:function(){mw=!0}}),window.addEventListener("test",Ap,Ap),window.removeEventListener("test",Ap,Ap)}catch{mw=!1}function GN(e,t,n,l,c,d,_,w,a){var S=Array.prototype.slice.call(arguments,3);try{t.apply(n,S)}catch(D){this.onError(D)}}var qp=!1,g_=null,y_=!1,gw=null,qN={onError:function(e){qp=!0,g_=e}};function WN(e,t,n,l,c,d,_,w,a){qp=!1,g_=null,GN.apply(qN,arguments)}function ZN(e,t,n,l,c,d,_,w,a){if(WN.apply(this,arguments),qp){if(qp){var S=g_;qp=!1,g_=null}else throw Error(Dt(198));y_||(y_=!0,gw=S)}}function qc(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function K3(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function bI(e){if(qc(e)!==e)throw Error(Dt(188))}function HN(e){var t=e.alternate;if(!t){if(t=qc(e),t===null)throw Error(Dt(188));return t!==e?null:e}for(var n=e,l=t;;){var c=n.return;if(c===null)break;var d=c.alternate;if(d===null){if(l=c.return,l!==null){n=l;continue}break}if(c.child===d.child){for(d=c.child;d;){if(d===n)return bI(c),e;if(d===l)return bI(c),t;d=d.sibling}throw Error(Dt(188))}if(n.return!==l.return)n=c,l=d;else{for(var _=!1,w=c.child;w;){if(w===n){_=!0,n=c,l=d;break}if(w===l){_=!0,l=c,n=d;break}w=w.sibling}if(!_){for(w=d.child;w;){if(w===n){_=!0,n=d,l=c;break}if(w===l){_=!0,l=d,n=c;break}w=w.sibling}if(!_)throw Error(Dt(189))}}if(n.alternate!==l)throw Error(Dt(190))}if(n.tag!==3)throw Error(Dt(188));return n.stateNode.current===n?e:t}function Y3(e){return e=HN(e),e!==null?J3(e):null}function J3(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=J3(e);if(t!==null)return t;e=e.sibling}return null}var Q3=ps.unstable_scheduleCallback,wI=ps.unstable_cancelCallback,XN=ps.unstable_shouldYield,KN=ps.unstable_requestPaint,ci=ps.unstable_now,YN=ps.unstable_getCurrentPriorityLevel,qE=ps.unstable_ImmediatePriority,eO=ps.unstable_UserBlockingPriority,__=ps.unstable_NormalPriority,JN=ps.unstable_LowPriority,tO=ps.unstable_IdlePriority,hv=null,Ba=null;function QN(e){if(Ba&&typeof Ba.onCommitFiberRoot=="function")try{Ba.onCommitFiberRoot(hv,e,void 0,(e.current.flags&128)===128)}catch{}}var ia=Math.clz32?Math.clz32:r6,e6=Math.log,t6=Math.LN2;function r6(e){return e>>>=0,e===0?32:31-(e6(e)/t6|0)|0}var py=64,my=4194304;function Np(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function v_(e,t){var n=e.pendingLanes;if(n===0)return 0;var l=0,c=e.suspendedLanes,d=e.pingedLanes,_=n&268435455;if(_!==0){var w=_&~c;w!==0?l=Np(w):(d&=_,d!==0&&(l=Np(d)))}else _=n&~c,_!==0?l=Np(_):d!==0&&(l=Np(d));if(l===0)return 0;if(t!==0&&t!==l&&!(t&c)&&(c=l&-l,d=t&-t,c>=d||c===16&&(d&4194240)!==0))return t;if(l&4&&(l|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=l;0<t;)n=31-ia(t),c=1<<n,l|=e[n],t&=~c;return l}function n6(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function i6(e,t){for(var n=e.suspendedLanes,l=e.pingedLanes,c=e.expirationTimes,d=e.pendingLanes;0<d;){var _=31-ia(d),w=1<<_,a=c[_];a===-1?(!(w&n)||w&l)&&(c[_]=n6(w,t)):a<=t&&(e.expiredLanes|=w),d&=~w}}function yw(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function rO(){var e=py;return py<<=1,!(py&4194240)&&(py=64),e}function jx(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Mm(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-ia(t),e[t]=n}function o6(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var l=e.eventTimes;for(e=e.expirationTimes;0<n;){var c=31-ia(n),d=1<<c;t[c]=0,l[c]=-1,e[c]=-1,n&=~d}}function WE(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var l=31-ia(n),c=1<<l;c&t|e[l]&t&&(e[l]|=t),n&=~c}}var un=0;function nO(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var iO,ZE,oO,sO,aO,_w=!1,gy=[],yu=null,_u=null,vu=null,um=new Map,cm=new Map,hu=[],s6="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function EI(e,t){switch(e){case"focusin":case"focusout":yu=null;break;case"dragenter":case"dragleave":_u=null;break;case"mouseover":case"mouseout":vu=null;break;case"pointerover":case"pointerout":um.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":cm.delete(t.pointerId)}}function Cp(e,t,n,l,c,d){return e===null||e.nativeEvent!==d?(e={blockedOn:t,domEventName:n,eventSystemFlags:l,nativeEvent:d,targetContainers:[c]},t!==null&&(t=km(t),t!==null&&ZE(t)),e):(e.eventSystemFlags|=l,t=e.targetContainers,c!==null&&t.indexOf(c)===-1&&t.push(c),e)}function a6(e,t,n,l,c){switch(t){case"focusin":return yu=Cp(yu,e,t,n,l,c),!0;case"dragenter":return _u=Cp(_u,e,t,n,l,c),!0;case"mouseover":return vu=Cp(vu,e,t,n,l,c),!0;case"pointerover":var d=c.pointerId;return um.set(d,Cp(um.get(d)||null,e,t,n,l,c)),!0;case"gotpointercapture":return d=c.pointerId,cm.set(d,Cp(cm.get(d)||null,e,t,n,l,c)),!0}return!1}function lO(e){var t=kc(e.target);if(t!==null){var n=qc(t);if(n!==null){if(t=n.tag,t===13){if(t=K3(n),t!==null){e.blockedOn=t,aO(e.priority,function(){oO(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Zy(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=vw(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var l=new n.constructor(n.type,n);dw=l,n.target.dispatchEvent(l),dw=null}else return t=km(n),t!==null&&ZE(t),e.blockedOn=n,!1;t.shift()}return!0}function TI(e,t,n){Zy(e)&&n.delete(t)}function l6(){_w=!1,yu!==null&&Zy(yu)&&(yu=null),_u!==null&&Zy(_u)&&(_u=null),vu!==null&&Zy(vu)&&(vu=null),um.forEach(TI),cm.forEach(TI)}function Ip(e,t){e.blockedOn===t&&(e.blockedOn=null,_w||(_w=!0,ps.unstable_scheduleCallback(ps.unstable_NormalPriority,l6)))}function hm(e){function t(c){return Ip(c,e)}if(0<gy.length){Ip(gy[0],e);for(var n=1;n<gy.length;n++){var l=gy[n];l.blockedOn===e&&(l.blockedOn=null)}}for(yu!==null&&Ip(yu,e),_u!==null&&Ip(_u,e),vu!==null&&Ip(vu,e),um.forEach(t),cm.forEach(t),n=0;n<hu.length;n++)l=hu[n],l.blockedOn===e&&(l.blockedOn=null);for(;0<hu.length&&(n=hu[0],n.blockedOn===null);)lO(n),n.blockedOn===null&&hu.shift()}var Tf=Il.ReactCurrentBatchConfig,x_=!0;function u6(e,t,n,l){var c=un,d=Tf.transition;Tf.transition=null;try{un=1,HE(e,t,n,l)}finally{un=c,Tf.transition=d}}function c6(e,t,n,l){var c=un,d=Tf.transition;Tf.transition=null;try{un=4,HE(e,t,n,l)}finally{un=c,Tf.transition=d}}function HE(e,t,n,l){if(x_){var c=vw(e,t,n,l);if(c===null)Jx(e,t,l,b_,n),EI(e,l);else if(a6(c,e,t,n,l))l.stopPropagation();else if(EI(e,l),t&4&&-1<s6.indexOf(e)){for(;c!==null;){var d=km(c);if(d!==null&&iO(d),d=vw(e,t,n,l),d===null&&Jx(e,t,l,b_,n),d===c)break;c=d}c!==null&&l.stopPropagation()}else Jx(e,t,l,null,n)}}var b_=null;function vw(e,t,n,l){if(b_=null,e=GE(l),e=kc(e),e!==null)if(t=qc(e),t===null)e=null;else if(n=t.tag,n===13){if(e=K3(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return b_=e,null}function uO(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(YN()){case qE:return 1;case eO:return 4;case __:case JN:return 16;case tO:return 536870912;default:return 16}default:return 16}}var du=null,XE=null,Hy=null;function cO(){if(Hy)return Hy;var e,t=XE,n=t.length,l,c="value"in du?du.value:du.textContent,d=c.length;for(e=0;e<n&&t[e]===c[e];e++);var _=n-e;for(l=1;l<=_&&t[n-l]===c[d-l];l++);return Hy=c.slice(e,1<l?1-l:void 0)}function Xy(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function yy(){return!0}function SI(){return!1}function ys(e){function t(n,l,c,d,_){this._reactName=n,this._targetInst=c,this.type=l,this.nativeEvent=d,this.target=_,this.currentTarget=null;for(var w in e)e.hasOwnProperty(w)&&(n=e[w],this[w]=n?n(d):d[w]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?yy:SI,this.isPropagationStopped=SI,this}return ei(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=yy)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=yy)},persist:function(){},isPersistent:yy}),t}var Xf={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},KE=ys(Xf),Pm=ei({},Xf,{view:0,detail:0}),h6=ys(Pm),Vx,Gx,Mp,fv=ei({},Pm,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:YE,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Mp&&(Mp&&e.type==="mousemove"?(Vx=e.screenX-Mp.screenX,Gx=e.screenY-Mp.screenY):Gx=Vx=0,Mp=e),Vx)},movementY:function(e){return"movementY"in e?e.movementY:Gx}}),AI=ys(fv),f6=ei({},fv,{dataTransfer:0}),d6=ys(f6),p6=ei({},Pm,{relatedTarget:0}),qx=ys(p6),m6=ei({},Xf,{animationName:0,elapsedTime:0,pseudoElement:0}),g6=ys(m6),y6=ei({},Xf,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),_6=ys(y6),v6=ei({},Xf,{data:0}),CI=ys(v6),x6={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},b6={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},w6={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function E6(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=w6[e])?!!t[e]:!1}function YE(){return E6}var T6=ei({},Pm,{key:function(e){if(e.key){var t=x6[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Xy(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?b6[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:YE,charCode:function(e){return e.type==="keypress"?Xy(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Xy(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),S6=ys(T6),A6=ei({},fv,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),II=ys(A6),C6=ei({},Pm,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:YE}),I6=ys(C6),M6=ei({},Xf,{propertyName:0,elapsedTime:0,pseudoElement:0}),P6=ys(M6),k6=ei({},fv,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),L6=ys(k6),O6=[9,13,27,32],JE=Tl&&"CompositionEvent"in window,Wp=null;Tl&&"documentMode"in document&&(Wp=document.documentMode);var D6=Tl&&"TextEvent"in window&&!Wp,hO=Tl&&(!JE||Wp&&8<Wp&&11>=Wp),MI=" ",PI=!1;function fO(e,t){switch(e){case"keyup":return O6.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function dO(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var uf=!1;function R6(e,t){switch(e){case"compositionend":return dO(t);case"keypress":return t.which!==32?null:(PI=!0,MI);case"textInput":return e=t.data,e===MI&&PI?null:e;default:return null}}function z6(e,t){if(uf)return e==="compositionend"||!JE&&fO(e,t)?(e=cO(),Hy=XE=du=null,uf=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return hO&&t.locale!=="ko"?null:t.data;default:return null}}var F6={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function kI(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!F6[e.type]:t==="textarea"}function pO(e,t,n,l){q3(l),t=w_(t,"onChange"),0<t.length&&(n=new KE("onChange","change",null,n,l),e.push({event:n,listeners:t}))}var Zp=null,fm=null;function B6(e){SO(e,0)}function dv(e){var t=ff(e);if(B3(t))return e}function N6(e,t){if(e==="change")return t}var mO=!1;if(Tl){var Wx;if(Tl){var Zx="oninput"in document;if(!Zx){var LI=document.createElement("div");LI.setAttribute("oninput","return;"),Zx=typeof LI.oninput=="function"}Wx=Zx}else Wx=!1;mO=Wx&&(!document.documentMode||9<document.documentMode)}function OI(){Zp&&(Zp.detachEvent("onpropertychange",gO),fm=Zp=null)}function gO(e){if(e.propertyName==="value"&&dv(fm)){var t=[];pO(t,fm,e,GE(e)),X3(B6,t)}}function U6(e,t,n){e==="focusin"?(OI(),Zp=t,fm=n,Zp.attachEvent("onpropertychange",gO)):e==="focusout"&&OI()}function $6(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return dv(fm)}function j6(e,t){if(e==="click")return dv(t)}function V6(e,t){if(e==="input"||e==="change")return dv(t)}function G6(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var sa=typeof Object.is=="function"?Object.is:G6;function dm(e,t){if(sa(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),l=Object.keys(t);if(n.length!==l.length)return!1;for(l=0;l<n.length;l++){var c=n[l];if(!tw.call(t,c)||!sa(e[c],t[c]))return!1}return!0}function DI(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function RI(e,t){var n=DI(e);e=0;for(var l;n;){if(n.nodeType===3){if(l=e+n.textContent.length,e<=t&&l>=t)return{node:n,offset:t-e};e=l}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=DI(n)}}function yO(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?yO(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function _O(){for(var e=window,t=m_();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=m_(e.document)}return t}function QE(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function q6(e){var t=_O(),n=e.focusedElem,l=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&yO(n.ownerDocument.documentElement,n)){if(l!==null&&QE(n)){if(t=l.start,e=l.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var c=n.textContent.length,d=Math.min(l.start,c);l=l.end===void 0?d:Math.min(l.end,c),!e.extend&&d>l&&(c=l,l=d,d=c),c=RI(n,d);var _=RI(n,l);c&&_&&(e.rangeCount!==1||e.anchorNode!==c.node||e.anchorOffset!==c.offset||e.focusNode!==_.node||e.focusOffset!==_.offset)&&(t=t.createRange(),t.setStart(c.node,c.offset),e.removeAllRanges(),d>l?(e.addRange(t),e.extend(_.node,_.offset)):(t.setEnd(_.node,_.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var W6=Tl&&"documentMode"in document&&11>=document.documentMode,cf=null,xw=null,Hp=null,bw=!1;function zI(e,t,n){var l=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;bw||cf==null||cf!==m_(l)||(l=cf,"selectionStart"in l&&QE(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),Hp&&dm(Hp,l)||(Hp=l,l=w_(xw,"onSelect"),0<l.length&&(t=new KE("onSelect","select",null,t,n),e.push({event:t,listeners:l}),t.target=cf)))}function _y(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var hf={animationend:_y("Animation","AnimationEnd"),animationiteration:_y("Animation","AnimationIteration"),animationstart:_y("Animation","AnimationStart"),transitionend:_y("Transition","TransitionEnd")},Hx={},vO={};Tl&&(vO=document.createElement("div").style,"AnimationEvent"in window||(delete hf.animationend.animation,delete hf.animationiteration.animation,delete hf.animationstart.animation),"TransitionEvent"in window||delete hf.transitionend.transition);function pv(e){if(Hx[e])return Hx[e];if(!hf[e])return e;var t=hf[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in vO)return Hx[e]=t[n];return e}var xO=pv("animationend"),bO=pv("animationiteration"),wO=pv("animationstart"),EO=pv("transitionend"),TO=new Map,FI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ku(e,t){TO.set(e,t),Gc(t,[e])}for(var Xx=0;Xx<FI.length;Xx++){var Kx=FI[Xx],Z6=Kx.toLowerCase(),H6=Kx[0].toUpperCase()+Kx.slice(1);ku(Z6,"on"+H6)}ku(xO,"onAnimationEnd");ku(bO,"onAnimationIteration");ku(wO,"onAnimationStart");ku("dblclick","onDoubleClick");ku("focusin","onFocus");ku("focusout","onBlur");ku(EO,"onTransitionEnd");Of("onMouseEnter",["mouseout","mouseover"]);Of("onMouseLeave",["mouseout","mouseover"]);Of("onPointerEnter",["pointerout","pointerover"]);Of("onPointerLeave",["pointerout","pointerover"]);Gc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Gc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Gc("onBeforeInput",["compositionend","keypress","textInput","paste"]);Gc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Gc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Gc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Up="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),X6=new Set("cancel close invalid load scroll toggle".split(" ").concat(Up));function BI(e,t,n){var l=e.type||"unknown-event";e.currentTarget=n,ZN(l,t,void 0,e),e.currentTarget=null}function SO(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var l=e[n],c=l.event;l=l.listeners;e:{var d=void 0;if(t)for(var _=l.length-1;0<=_;_--){var w=l[_],a=w.instance,S=w.currentTarget;if(w=w.listener,a!==d&&c.isPropagationStopped())break e;BI(c,w,S),d=a}else for(_=0;_<l.length;_++){if(w=l[_],a=w.instance,S=w.currentTarget,w=w.listener,a!==d&&c.isPropagationStopped())break e;BI(c,w,S),d=a}}}if(y_)throw e=gw,y_=!1,gw=null,e}function kn(e,t){var n=t[Aw];n===void 0&&(n=t[Aw]=new Set);var l=e+"__bubble";n.has(l)||(AO(t,e,2,!1),n.add(l))}function Yx(e,t,n){var l=0;t&&(l|=4),AO(n,e,l,t)}var vy="_reactListening"+Math.random().toString(36).slice(2);function pm(e){if(!e[vy]){e[vy]=!0,O3.forEach(function(n){n!=="selectionchange"&&(X6.has(n)||Yx(n,!1,e),Yx(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[vy]||(t[vy]=!0,Yx("selectionchange",!1,t))}}function AO(e,t,n,l){switch(uO(t)){case 1:var c=u6;break;case 4:c=c6;break;default:c=HE}n=c.bind(null,t,n,e),c=void 0,!mw||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(c=!0),l?c!==void 0?e.addEventListener(t,n,{capture:!0,passive:c}):e.addEventListener(t,n,!0):c!==void 0?e.addEventListener(t,n,{passive:c}):e.addEventListener(t,n,!1)}function Jx(e,t,n,l,c){var d=l;if(!(t&1)&&!(t&2)&&l!==null)e:for(;;){if(l===null)return;var _=l.tag;if(_===3||_===4){var w=l.stateNode.containerInfo;if(w===c||w.nodeType===8&&w.parentNode===c)break;if(_===4)for(_=l.return;_!==null;){var a=_.tag;if((a===3||a===4)&&(a=_.stateNode.containerInfo,a===c||a.nodeType===8&&a.parentNode===c))return;_=_.return}for(;w!==null;){if(_=kc(w),_===null)return;if(a=_.tag,a===5||a===6){l=d=_;continue e}w=w.parentNode}}l=l.return}X3(function(){var S=d,D=GE(n),R=[];e:{var I=TO.get(e);if(I!==void 0){var M=KE,N=e;switch(e){case"keypress":if(Xy(n)===0)break e;case"keydown":case"keyup":M=S6;break;case"focusin":N="focus",M=qx;break;case"focusout":N="blur",M=qx;break;case"beforeblur":case"afterblur":M=qx;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":M=AI;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":M=d6;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":M=I6;break;case xO:case bO:case wO:M=g6;break;case EO:M=P6;break;case"scroll":M=h6;break;case"wheel":M=L6;break;case"copy":case"cut":case"paste":M=_6;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":M=II}var j=(t&4)!==0,W=!j&&e==="scroll",B=j?I!==null?I+"Capture":null:I;j=[];for(var k=S,z;k!==null;){z=k;var Z=z.stateNode;if(z.tag===5&&Z!==null&&(z=Z,B!==null&&(Z=lm(k,B),Z!=null&&j.push(mm(k,Z,z)))),W)break;k=k.return}0<j.length&&(I=new M(I,N,null,n,D),R.push({event:I,listeners:j}))}}if(!(t&7)){e:{if(I=e==="mouseover"||e==="pointerover",M=e==="mouseout"||e==="pointerout",I&&n!==dw&&(N=n.relatedTarget||n.fromElement)&&(kc(N)||N[Sl]))break e;if((M||I)&&(I=D.window===D?D:(I=D.ownerDocument)?I.defaultView||I.parentWindow:window,M?(N=n.relatedTarget||n.toElement,M=S,N=N?kc(N):null,N!==null&&(W=qc(N),N!==W||N.tag!==5&&N.tag!==6)&&(N=null)):(M=null,N=S),M!==N)){if(j=AI,Z="onMouseLeave",B="onMouseEnter",k="mouse",(e==="pointerout"||e==="pointerover")&&(j=II,Z="onPointerLeave",B="onPointerEnter",k="pointer"),W=M==null?I:ff(M),z=N==null?I:ff(N),I=new j(Z,k+"leave",M,n,D),I.target=W,I.relatedTarget=z,Z=null,kc(D)===S&&(j=new j(B,k+"enter",N,n,D),j.target=z,j.relatedTarget=W,Z=j),W=Z,M&&N)t:{for(j=M,B=N,k=0,z=j;z;z=Xh(z))k++;for(z=0,Z=B;Z;Z=Xh(Z))z++;for(;0<k-z;)j=Xh(j),k--;for(;0<z-k;)B=Xh(B),z--;for(;k--;){if(j===B||B!==null&&j===B.alternate)break t;j=Xh(j),B=Xh(B)}j=null}else j=null;M!==null&&NI(R,I,M,j,!1),N!==null&&W!==null&&NI(R,W,N,j,!0)}}e:{if(I=S?ff(S):window,M=I.nodeName&&I.nodeName.toLowerCase(),M==="select"||M==="input"&&I.type==="file")var ee=N6;else if(kI(I))if(mO)ee=V6;else{ee=$6;var se=U6}else(M=I.nodeName)&&M.toLowerCase()==="input"&&(I.type==="checkbox"||I.type==="radio")&&(ee=j6);if(ee&&(ee=ee(e,S))){pO(R,ee,n,D);break e}se&&se(e,I,S),e==="focusout"&&(se=I._wrapperState)&&se.controlled&&I.type==="number"&&lw(I,"number",I.value)}switch(se=S?ff(S):window,e){case"focusin":(kI(se)||se.contentEditable==="true")&&(cf=se,xw=S,Hp=null);break;case"focusout":Hp=xw=cf=null;break;case"mousedown":bw=!0;break;case"contextmenu":case"mouseup":case"dragend":bw=!1,zI(R,n,D);break;case"selectionchange":if(W6)break;case"keydown":case"keyup":zI(R,n,D)}var ue;if(JE)e:{switch(e){case"compositionstart":var Te="onCompositionStart";break e;case"compositionend":Te="onCompositionEnd";break e;case"compositionupdate":Te="onCompositionUpdate";break e}Te=void 0}else uf?fO(e,n)&&(Te="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(Te="onCompositionStart");Te&&(hO&&n.locale!=="ko"&&(uf||Te!=="onCompositionStart"?Te==="onCompositionEnd"&&uf&&(ue=cO()):(du=D,XE="value"in du?du.value:du.textContent,uf=!0)),se=w_(S,Te),0<se.length&&(Te=new CI(Te,e,null,n,D),R.push({event:Te,listeners:se}),ue?Te.data=ue:(ue=dO(n),ue!==null&&(Te.data=ue)))),(ue=D6?R6(e,n):z6(e,n))&&(S=w_(S,"onBeforeInput"),0<S.length&&(D=new CI("onBeforeInput","beforeinput",null,n,D),R.push({event:D,listeners:S}),D.data=ue))}SO(R,t)})}function mm(e,t,n){return{instance:e,listener:t,currentTarget:n}}function w_(e,t){for(var n=t+"Capture",l=[];e!==null;){var c=e,d=c.stateNode;c.tag===5&&d!==null&&(c=d,d=lm(e,n),d!=null&&l.unshift(mm(e,d,c)),d=lm(e,t),d!=null&&l.push(mm(e,d,c))),e=e.return}return l}function Xh(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function NI(e,t,n,l,c){for(var d=t._reactName,_=[];n!==null&&n!==l;){var w=n,a=w.alternate,S=w.stateNode;if(a!==null&&a===l)break;w.tag===5&&S!==null&&(w=S,c?(a=lm(n,d),a!=null&&_.unshift(mm(n,a,w))):c||(a=lm(n,d),a!=null&&_.push(mm(n,a,w)))),n=n.return}_.length!==0&&e.push({event:t,listeners:_})}var K6=/\r\n?/g,Y6=/\u0000|\uFFFD/g;function UI(e){return(typeof e=="string"?e:""+e).replace(K6,`
`).replace(Y6,"")}function xy(e,t,n){if(t=UI(t),UI(e)!==t&&n)throw Error(Dt(425))}function E_(){}var ww=null,Ew=null;function Tw(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Sw=typeof setTimeout=="function"?setTimeout:void 0,J6=typeof clearTimeout=="function"?clearTimeout:void 0,$I=typeof Promise=="function"?Promise:void 0,Q6=typeof queueMicrotask=="function"?queueMicrotask:typeof $I<"u"?function(e){return $I.resolve(null).then(e).catch(eU)}:Sw;function eU(e){setTimeout(function(){throw e})}function Qx(e,t){var n=t,l=0;do{var c=n.nextSibling;if(e.removeChild(n),c&&c.nodeType===8)if(n=c.data,n==="/$"){if(l===0){e.removeChild(c),hm(t);return}l--}else n!=="$"&&n!=="$?"&&n!=="$!"||l++;n=c}while(n);hm(t)}function xu(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function jI(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var Kf=Math.random().toString(36).slice(2),Ra="__reactFiber$"+Kf,gm="__reactProps$"+Kf,Sl="__reactContainer$"+Kf,Aw="__reactEvents$"+Kf,tU="__reactListeners$"+Kf,rU="__reactHandles$"+Kf;function kc(e){var t=e[Ra];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Sl]||n[Ra]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=jI(e);e!==null;){if(n=e[Ra])return n;e=jI(e)}return t}e=n,n=e.parentNode}return null}function km(e){return e=e[Ra]||e[Sl],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function ff(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Dt(33))}function mv(e){return e[gm]||null}var Cw=[],df=-1;function Lu(e){return{current:e}}function Ln(e){0>df||(e.current=Cw[df],Cw[df]=null,df--)}function Tn(e,t){df++,Cw[df]=e.current,e.current=t}var Au={},_o=Lu(Au),Qo=Lu(!1),Nc=Au;function Df(e,t){var n=e.type.contextTypes;if(!n)return Au;var l=e.stateNode;if(l&&l.__reactInternalMemoizedUnmaskedChildContext===t)return l.__reactInternalMemoizedMaskedChildContext;var c={},d;for(d in n)c[d]=t[d];return l&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=c),c}function es(e){return e=e.childContextTypes,e!=null}function T_(){Ln(Qo),Ln(_o)}function VI(e,t,n){if(_o.current!==Au)throw Error(Dt(168));Tn(_o,t),Tn(Qo,n)}function CO(e,t,n){var l=e.stateNode;if(t=t.childContextTypes,typeof l.getChildContext!="function")return n;l=l.getChildContext();for(var c in l)if(!(c in t))throw Error(Dt(108,UN(e)||"Unknown",c));return ei({},n,l)}function S_(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Au,Nc=_o.current,Tn(_o,e),Tn(Qo,Qo.current),!0}function GI(e,t,n){var l=e.stateNode;if(!l)throw Error(Dt(169));n?(e=CO(e,t,Nc),l.__reactInternalMemoizedMergedChildContext=e,Ln(Qo),Ln(_o),Tn(_o,e)):Ln(Qo),Tn(Qo,n)}var xl=null,gv=!1,e1=!1;function IO(e){xl===null?xl=[e]:xl.push(e)}function nU(e){gv=!0,IO(e)}function Ou(){if(!e1&&xl!==null){e1=!0;var e=0,t=un;try{var n=xl;for(un=1;e<n.length;e++){var l=n[e];do l=l(!0);while(l!==null)}xl=null,gv=!1}catch(c){throw xl!==null&&(xl=xl.slice(e+1)),Q3(qE,Ou),c}finally{un=t,e1=!1}}return null}var pf=[],mf=0,A_=null,C_=0,Is=[],Ms=0,Uc=null,bl=1,wl="";function Ic(e,t){pf[mf++]=C_,pf[mf++]=A_,A_=e,C_=t}function MO(e,t,n){Is[Ms++]=bl,Is[Ms++]=wl,Is[Ms++]=Uc,Uc=e;var l=bl;e=wl;var c=32-ia(l)-1;l&=~(1<<c),n+=1;var d=32-ia(t)+c;if(30<d){var _=c-c%5;d=(l&(1<<_)-1).toString(32),l>>=_,c-=_,bl=1<<32-ia(t)+c|n<<c|l,wl=d+e}else bl=1<<d|n<<c|l,wl=e}function eT(e){e.return!==null&&(Ic(e,1),MO(e,1,0))}function tT(e){for(;e===A_;)A_=pf[--mf],pf[mf]=null,C_=pf[--mf],pf[mf]=null;for(;e===Uc;)Uc=Is[--Ms],Is[Ms]=null,wl=Is[--Ms],Is[Ms]=null,bl=Is[--Ms],Is[Ms]=null}var ds=null,fs=null,Nn=!1,na=null;function PO(e,t){var n=ks(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function qI(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,ds=e,fs=xu(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,ds=e,fs=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=Uc!==null?{id:bl,overflow:wl}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=ks(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,ds=e,fs=null,!0):!1;default:return!1}}function Iw(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Mw(e){if(Nn){var t=fs;if(t){var n=t;if(!qI(e,t)){if(Iw(e))throw Error(Dt(418));t=xu(n.nextSibling);var l=ds;t&&qI(e,t)?PO(l,n):(e.flags=e.flags&-4097|2,Nn=!1,ds=e)}}else{if(Iw(e))throw Error(Dt(418));e.flags=e.flags&-4097|2,Nn=!1,ds=e}}}function WI(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;ds=e}function by(e){if(e!==ds)return!1;if(!Nn)return WI(e),Nn=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Tw(e.type,e.memoizedProps)),t&&(t=fs)){if(Iw(e))throw kO(),Error(Dt(418));for(;t;)PO(e,t),t=xu(t.nextSibling)}if(WI(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Dt(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){fs=xu(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}fs=null}}else fs=ds?xu(e.stateNode.nextSibling):null;return!0}function kO(){for(var e=fs;e;)e=xu(e.nextSibling)}function Rf(){fs=ds=null,Nn=!1}function rT(e){na===null?na=[e]:na.push(e)}var iU=Il.ReactCurrentBatchConfig;function Pp(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Dt(309));var l=n.stateNode}if(!l)throw Error(Dt(147,e));var c=l,d=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===d?t.ref:(t=function(_){var w=c.refs;_===null?delete w[d]:w[d]=_},t._stringRef=d,t)}if(typeof e!="string")throw Error(Dt(284));if(!n._owner)throw Error(Dt(290,e))}return e}function wy(e,t){throw e=Object.prototype.toString.call(t),Error(Dt(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ZI(e){var t=e._init;return t(e._payload)}function LO(e){function t(B,k){if(e){var z=B.deletions;z===null?(B.deletions=[k],B.flags|=16):z.push(k)}}function n(B,k){if(!e)return null;for(;k!==null;)t(B,k),k=k.sibling;return null}function l(B,k){for(B=new Map;k!==null;)k.key!==null?B.set(k.key,k):B.set(k.index,k),k=k.sibling;return B}function c(B,k){return B=Tu(B,k),B.index=0,B.sibling=null,B}function d(B,k,z){return B.index=z,e?(z=B.alternate,z!==null?(z=z.index,z<k?(B.flags|=2,k):z):(B.flags|=2,k)):(B.flags|=1048576,k)}function _(B){return e&&B.alternate===null&&(B.flags|=2),B}function w(B,k,z,Z){return k===null||k.tag!==6?(k=a1(z,B.mode,Z),k.return=B,k):(k=c(k,z),k.return=B,k)}function a(B,k,z,Z){var ee=z.type;return ee===lf?D(B,k,z.props.children,Z,z.key):k!==null&&(k.elementType===ee||typeof ee=="object"&&ee!==null&&ee.$$typeof===uu&&ZI(ee)===k.type)?(Z=c(k,z.props),Z.ref=Pp(B,k,z),Z.return=B,Z):(Z=r_(z.type,z.key,z.props,null,B.mode,Z),Z.ref=Pp(B,k,z),Z.return=B,Z)}function S(B,k,z,Z){return k===null||k.tag!==4||k.stateNode.containerInfo!==z.containerInfo||k.stateNode.implementation!==z.implementation?(k=l1(z,B.mode,Z),k.return=B,k):(k=c(k,z.children||[]),k.return=B,k)}function D(B,k,z,Z,ee){return k===null||k.tag!==7?(k=zc(z,B.mode,Z,ee),k.return=B,k):(k=c(k,z),k.return=B,k)}function R(B,k,z){if(typeof k=="string"&&k!==""||typeof k=="number")return k=a1(""+k,B.mode,z),k.return=B,k;if(typeof k=="object"&&k!==null){switch(k.$$typeof){case hy:return z=r_(k.type,k.key,k.props,null,B.mode,z),z.ref=Pp(B,null,k),z.return=B,z;case af:return k=l1(k,B.mode,z),k.return=B,k;case uu:var Z=k._init;return R(B,Z(k._payload),z)}if(Bp(k)||Sp(k))return k=zc(k,B.mode,z,null),k.return=B,k;wy(B,k)}return null}function I(B,k,z,Z){var ee=k!==null?k.key:null;if(typeof z=="string"&&z!==""||typeof z=="number")return ee!==null?null:w(B,k,""+z,Z);if(typeof z=="object"&&z!==null){switch(z.$$typeof){case hy:return z.key===ee?a(B,k,z,Z):null;case af:return z.key===ee?S(B,k,z,Z):null;case uu:return ee=z._init,I(B,k,ee(z._payload),Z)}if(Bp(z)||Sp(z))return ee!==null?null:D(B,k,z,Z,null);wy(B,z)}return null}function M(B,k,z,Z,ee){if(typeof Z=="string"&&Z!==""||typeof Z=="number")return B=B.get(z)||null,w(k,B,""+Z,ee);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case hy:return B=B.get(Z.key===null?z:Z.key)||null,a(k,B,Z,ee);case af:return B=B.get(Z.key===null?z:Z.key)||null,S(k,B,Z,ee);case uu:var se=Z._init;return M(B,k,z,se(Z._payload),ee)}if(Bp(Z)||Sp(Z))return B=B.get(z)||null,D(k,B,Z,ee,null);wy(k,Z)}return null}function N(B,k,z,Z){for(var ee=null,se=null,ue=k,Te=k=0,Q=null;ue!==null&&Te<z.length;Te++){ue.index>Te?(Q=ue,ue=null):Q=ue.sibling;var he=I(B,ue,z[Te],Z);if(he===null){ue===null&&(ue=Q);break}e&&ue&&he.alternate===null&&t(B,ue),k=d(he,k,Te),se===null?ee=he:se.sibling=he,se=he,ue=Q}if(Te===z.length)return n(B,ue),Nn&&Ic(B,Te),ee;if(ue===null){for(;Te<z.length;Te++)ue=R(B,z[Te],Z),ue!==null&&(k=d(ue,k,Te),se===null?ee=ue:se.sibling=ue,se=ue);return Nn&&Ic(B,Te),ee}for(ue=l(B,ue);Te<z.length;Te++)Q=M(ue,B,Te,z[Te],Z),Q!==null&&(e&&Q.alternate!==null&&ue.delete(Q.key===null?Te:Q.key),k=d(Q,k,Te),se===null?ee=Q:se.sibling=Q,se=Q);return e&&ue.forEach(function(ye){return t(B,ye)}),Nn&&Ic(B,Te),ee}function j(B,k,z,Z){var ee=Sp(z);if(typeof ee!="function")throw Error(Dt(150));if(z=ee.call(z),z==null)throw Error(Dt(151));for(var se=ee=null,ue=k,Te=k=0,Q=null,he=z.next();ue!==null&&!he.done;Te++,he=z.next()){ue.index>Te?(Q=ue,ue=null):Q=ue.sibling;var ye=I(B,ue,he.value,Z);if(ye===null){ue===null&&(ue=Q);break}e&&ue&&ye.alternate===null&&t(B,ue),k=d(ye,k,Te),se===null?ee=ye:se.sibling=ye,se=ye,ue=Q}if(he.done)return n(B,ue),Nn&&Ic(B,Te),ee;if(ue===null){for(;!he.done;Te++,he=z.next())he=R(B,he.value,Z),he!==null&&(k=d(he,k,Te),se===null?ee=he:se.sibling=he,se=he);return Nn&&Ic(B,Te),ee}for(ue=l(B,ue);!he.done;Te++,he=z.next())he=M(ue,B,Te,he.value,Z),he!==null&&(e&&he.alternate!==null&&ue.delete(he.key===null?Te:he.key),k=d(he,k,Te),se===null?ee=he:se.sibling=he,se=he);return e&&ue.forEach(function(J){return t(B,J)}),Nn&&Ic(B,Te),ee}function W(B,k,z,Z){if(typeof z=="object"&&z!==null&&z.type===lf&&z.key===null&&(z=z.props.children),typeof z=="object"&&z!==null){switch(z.$$typeof){case hy:e:{for(var ee=z.key,se=k;se!==null;){if(se.key===ee){if(ee=z.type,ee===lf){if(se.tag===7){n(B,se.sibling),k=c(se,z.props.children),k.return=B,B=k;break e}}else if(se.elementType===ee||typeof ee=="object"&&ee!==null&&ee.$$typeof===uu&&ZI(ee)===se.type){n(B,se.sibling),k=c(se,z.props),k.ref=Pp(B,se,z),k.return=B,B=k;break e}n(B,se);break}else t(B,se);se=se.sibling}z.type===lf?(k=zc(z.props.children,B.mode,Z,z.key),k.return=B,B=k):(Z=r_(z.type,z.key,z.props,null,B.mode,Z),Z.ref=Pp(B,k,z),Z.return=B,B=Z)}return _(B);case af:e:{for(se=z.key;k!==null;){if(k.key===se)if(k.tag===4&&k.stateNode.containerInfo===z.containerInfo&&k.stateNode.implementation===z.implementation){n(B,k.sibling),k=c(k,z.children||[]),k.return=B,B=k;break e}else{n(B,k);break}else t(B,k);k=k.sibling}k=l1(z,B.mode,Z),k.return=B,B=k}return _(B);case uu:return se=z._init,W(B,k,se(z._payload),Z)}if(Bp(z))return N(B,k,z,Z);if(Sp(z))return j(B,k,z,Z);wy(B,z)}return typeof z=="string"&&z!==""||typeof z=="number"?(z=""+z,k!==null&&k.tag===6?(n(B,k.sibling),k=c(k,z),k.return=B,B=k):(n(B,k),k=a1(z,B.mode,Z),k.return=B,B=k),_(B)):n(B,k)}return W}var zf=LO(!0),OO=LO(!1),I_=Lu(null),M_=null,gf=null,nT=null;function iT(){nT=gf=M_=null}function oT(e){var t=I_.current;Ln(I_),e._currentValue=t}function Pw(e,t,n){for(;e!==null;){var l=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,l!==null&&(l.childLanes|=t)):l!==null&&(l.childLanes&t)!==t&&(l.childLanes|=t),e===n)break;e=e.return}}function Sf(e,t){M_=e,nT=gf=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Jo=!0),e.firstContext=null)}function Ds(e){var t=e._currentValue;if(nT!==e)if(e={context:e,memoizedValue:t,next:null},gf===null){if(M_===null)throw Error(Dt(308));gf=e,M_.dependencies={lanes:0,firstContext:e}}else gf=gf.next=e;return t}var Lc=null;function sT(e){Lc===null?Lc=[e]:Lc.push(e)}function DO(e,t,n,l){var c=t.interleaved;return c===null?(n.next=n,sT(t)):(n.next=c.next,c.next=n),t.interleaved=n,Al(e,l)}function Al(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var cu=!1;function aT(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function RO(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function El(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function bu(e,t,n){var l=e.updateQueue;if(l===null)return null;if(l=l.shared,Vr&2){var c=l.pending;return c===null?t.next=t:(t.next=c.next,c.next=t),l.pending=t,Al(e,n)}return c=l.interleaved,c===null?(t.next=t,sT(l)):(t.next=c.next,c.next=t),l.interleaved=t,Al(e,n)}function Ky(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var l=t.lanes;l&=e.pendingLanes,n|=l,t.lanes=n,WE(e,n)}}function HI(e,t){var n=e.updateQueue,l=e.alternate;if(l!==null&&(l=l.updateQueue,n===l)){var c=null,d=null;if(n=n.firstBaseUpdate,n!==null){do{var _={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};d===null?c=d=_:d=d.next=_,n=n.next}while(n!==null);d===null?c=d=t:d=d.next=t}else c=d=t;n={baseState:l.baseState,firstBaseUpdate:c,lastBaseUpdate:d,shared:l.shared,effects:l.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function P_(e,t,n,l){var c=e.updateQueue;cu=!1;var d=c.firstBaseUpdate,_=c.lastBaseUpdate,w=c.shared.pending;if(w!==null){c.shared.pending=null;var a=w,S=a.next;a.next=null,_===null?d=S:_.next=S,_=a;var D=e.alternate;D!==null&&(D=D.updateQueue,w=D.lastBaseUpdate,w!==_&&(w===null?D.firstBaseUpdate=S:w.next=S,D.lastBaseUpdate=a))}if(d!==null){var R=c.baseState;_=0,D=S=a=null,w=d;do{var I=w.lane,M=w.eventTime;if((l&I)===I){D!==null&&(D=D.next={eventTime:M,lane:0,tag:w.tag,payload:w.payload,callback:w.callback,next:null});e:{var N=e,j=w;switch(I=t,M=n,j.tag){case 1:if(N=j.payload,typeof N=="function"){R=N.call(M,R,I);break e}R=N;break e;case 3:N.flags=N.flags&-65537|128;case 0:if(N=j.payload,I=typeof N=="function"?N.call(M,R,I):N,I==null)break e;R=ei({},R,I);break e;case 2:cu=!0}}w.callback!==null&&w.lane!==0&&(e.flags|=64,I=c.effects,I===null?c.effects=[w]:I.push(w))}else M={eventTime:M,lane:I,tag:w.tag,payload:w.payload,callback:w.callback,next:null},D===null?(S=D=M,a=R):D=D.next=M,_|=I;if(w=w.next,w===null){if(w=c.shared.pending,w===null)break;I=w,w=I.next,I.next=null,c.lastBaseUpdate=I,c.shared.pending=null}}while(!0);if(D===null&&(a=R),c.baseState=a,c.firstBaseUpdate=S,c.lastBaseUpdate=D,t=c.shared.interleaved,t!==null){c=t;do _|=c.lane,c=c.next;while(c!==t)}else d===null&&(c.shared.lanes=0);jc|=_,e.lanes=_,e.memoizedState=R}}function XI(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var l=e[t],c=l.callback;if(c!==null){if(l.callback=null,l=n,typeof c!="function")throw Error(Dt(191,c));c.call(l)}}}var Lm={},Na=Lu(Lm),ym=Lu(Lm),_m=Lu(Lm);function Oc(e){if(e===Lm)throw Error(Dt(174));return e}function lT(e,t){switch(Tn(_m,t),Tn(ym,e),Tn(Na,Lm),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:cw(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=cw(t,e)}Ln(Na),Tn(Na,t)}function Ff(){Ln(Na),Ln(ym),Ln(_m)}function zO(e){Oc(_m.current);var t=Oc(Na.current),n=cw(t,e.type);t!==n&&(Tn(ym,e),Tn(Na,n))}function uT(e){ym.current===e&&(Ln(Na),Ln(ym))}var Jn=Lu(0);function k_(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var t1=[];function cT(){for(var e=0;e<t1.length;e++)t1[e]._workInProgressVersionPrimary=null;t1.length=0}var Yy=Il.ReactCurrentDispatcher,r1=Il.ReactCurrentBatchConfig,$c=0,Qn=null,Mi=null,Ui=null,L_=!1,Xp=!1,vm=0,oU=0;function uo(){throw Error(Dt(321))}function hT(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sa(e[n],t[n]))return!1;return!0}function fT(e,t,n,l,c,d){if($c=d,Qn=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Yy.current=e===null||e.memoizedState===null?uU:cU,e=n(l,c),Xp){d=0;do{if(Xp=!1,vm=0,25<=d)throw Error(Dt(301));d+=1,Ui=Mi=null,t.updateQueue=null,Yy.current=hU,e=n(l,c)}while(Xp)}if(Yy.current=O_,t=Mi!==null&&Mi.next!==null,$c=0,Ui=Mi=Qn=null,L_=!1,t)throw Error(Dt(300));return e}function dT(){var e=vm!==0;return vm=0,e}function Oa(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ui===null?Qn.memoizedState=Ui=e:Ui=Ui.next=e,Ui}function Rs(){if(Mi===null){var e=Qn.alternate;e=e!==null?e.memoizedState:null}else e=Mi.next;var t=Ui===null?Qn.memoizedState:Ui.next;if(t!==null)Ui=t,Mi=e;else{if(e===null)throw Error(Dt(310));Mi=e,e={memoizedState:Mi.memoizedState,baseState:Mi.baseState,baseQueue:Mi.baseQueue,queue:Mi.queue,next:null},Ui===null?Qn.memoizedState=Ui=e:Ui=Ui.next=e}return Ui}function xm(e,t){return typeof t=="function"?t(e):t}function n1(e){var t=Rs(),n=t.queue;if(n===null)throw Error(Dt(311));n.lastRenderedReducer=e;var l=Mi,c=l.baseQueue,d=n.pending;if(d!==null){if(c!==null){var _=c.next;c.next=d.next,d.next=_}l.baseQueue=c=d,n.pending=null}if(c!==null){d=c.next,l=l.baseState;var w=_=null,a=null,S=d;do{var D=S.lane;if(($c&D)===D)a!==null&&(a=a.next={lane:0,action:S.action,hasEagerState:S.hasEagerState,eagerState:S.eagerState,next:null}),l=S.hasEagerState?S.eagerState:e(l,S.action);else{var R={lane:D,action:S.action,hasEagerState:S.hasEagerState,eagerState:S.eagerState,next:null};a===null?(w=a=R,_=l):a=a.next=R,Qn.lanes|=D,jc|=D}S=S.next}while(S!==null&&S!==d);a===null?_=l:a.next=w,sa(l,t.memoizedState)||(Jo=!0),t.memoizedState=l,t.baseState=_,t.baseQueue=a,n.lastRenderedState=l}if(e=n.interleaved,e!==null){c=e;do d=c.lane,Qn.lanes|=d,jc|=d,c=c.next;while(c!==e)}else c===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function i1(e){var t=Rs(),n=t.queue;if(n===null)throw Error(Dt(311));n.lastRenderedReducer=e;var l=n.dispatch,c=n.pending,d=t.memoizedState;if(c!==null){n.pending=null;var _=c=c.next;do d=e(d,_.action),_=_.next;while(_!==c);sa(d,t.memoizedState)||(Jo=!0),t.memoizedState=d,t.baseQueue===null&&(t.baseState=d),n.lastRenderedState=d}return[d,l]}function FO(){}function BO(e,t){var n=Qn,l=Rs(),c=t(),d=!sa(l.memoizedState,c);if(d&&(l.memoizedState=c,Jo=!0),l=l.queue,pT($O.bind(null,n,l,e),[e]),l.getSnapshot!==t||d||Ui!==null&&Ui.memoizedState.tag&1){if(n.flags|=2048,bm(9,UO.bind(null,n,l,c,t),void 0,null),ji===null)throw Error(Dt(349));$c&30||NO(n,t,c)}return c}function NO(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=Qn.updateQueue,t===null?(t={lastEffect:null,stores:null},Qn.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function UO(e,t,n,l){t.value=n,t.getSnapshot=l,jO(t)&&VO(e)}function $O(e,t,n){return n(function(){jO(t)&&VO(e)})}function jO(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sa(e,n)}catch{return!0}}function VO(e){var t=Al(e,1);t!==null&&oa(t,e,1,-1)}function KI(e){var t=Oa();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xm,lastRenderedState:e},t.queue=e,e=e.dispatch=lU.bind(null,Qn,e),[t.memoizedState,e]}function bm(e,t,n,l){return e={tag:e,create:t,destroy:n,deps:l,next:null},t=Qn.updateQueue,t===null?(t={lastEffect:null,stores:null},Qn.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(l=n.next,n.next=e,e.next=l,t.lastEffect=e)),e}function GO(){return Rs().memoizedState}function Jy(e,t,n,l){var c=Oa();Qn.flags|=e,c.memoizedState=bm(1|t,n,void 0,l===void 0?null:l)}function yv(e,t,n,l){var c=Rs();l=l===void 0?null:l;var d=void 0;if(Mi!==null){var _=Mi.memoizedState;if(d=_.destroy,l!==null&&hT(l,_.deps)){c.memoizedState=bm(t,n,d,l);return}}Qn.flags|=e,c.memoizedState=bm(1|t,n,d,l)}function YI(e,t){return Jy(8390656,8,e,t)}function pT(e,t){return yv(2048,8,e,t)}function qO(e,t){return yv(4,2,e,t)}function WO(e,t){return yv(4,4,e,t)}function ZO(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function HO(e,t,n){return n=n!=null?n.concat([e]):null,yv(4,4,ZO.bind(null,t,e),n)}function mT(){}function XO(e,t){var n=Rs();t=t===void 0?null:t;var l=n.memoizedState;return l!==null&&t!==null&&hT(t,l[1])?l[0]:(n.memoizedState=[e,t],e)}function KO(e,t){var n=Rs();t=t===void 0?null:t;var l=n.memoizedState;return l!==null&&t!==null&&hT(t,l[1])?l[0]:(e=e(),n.memoizedState=[e,t],e)}function YO(e,t,n){return $c&21?(sa(n,t)||(n=rO(),Qn.lanes|=n,jc|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Jo=!0),e.memoizedState=n)}function sU(e,t){var n=un;un=n!==0&&4>n?n:4,e(!0);var l=r1.transition;r1.transition={};try{e(!1),t()}finally{un=n,r1.transition=l}}function JO(){return Rs().memoizedState}function aU(e,t,n){var l=Eu(e);if(n={lane:l,action:n,hasEagerState:!1,eagerState:null,next:null},QO(e))eD(t,n);else if(n=DO(e,t,n,l),n!==null){var c=Mo();oa(n,e,l,c),tD(n,t,l)}}function lU(e,t,n){var l=Eu(e),c={lane:l,action:n,hasEagerState:!1,eagerState:null,next:null};if(QO(e))eD(t,c);else{var d=e.alternate;if(e.lanes===0&&(d===null||d.lanes===0)&&(d=t.lastRenderedReducer,d!==null))try{var _=t.lastRenderedState,w=d(_,n);if(c.hasEagerState=!0,c.eagerState=w,sa(w,_)){var a=t.interleaved;a===null?(c.next=c,sT(t)):(c.next=a.next,a.next=c),t.interleaved=c;return}}catch{}finally{}n=DO(e,t,c,l),n!==null&&(c=Mo(),oa(n,e,l,c),tD(n,t,l))}}function QO(e){var t=e.alternate;return e===Qn||t!==null&&t===Qn}function eD(e,t){Xp=L_=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function tD(e,t,n){if(n&4194240){var l=t.lanes;l&=e.pendingLanes,n|=l,t.lanes=n,WE(e,n)}}var O_={readContext:Ds,useCallback:uo,useContext:uo,useEffect:uo,useImperativeHandle:uo,useInsertionEffect:uo,useLayoutEffect:uo,useMemo:uo,useReducer:uo,useRef:uo,useState:uo,useDebugValue:uo,useDeferredValue:uo,useTransition:uo,useMutableSource:uo,useSyncExternalStore:uo,useId:uo,unstable_isNewReconciler:!1},uU={readContext:Ds,useCallback:function(e,t){return Oa().memoizedState=[e,t===void 0?null:t],e},useContext:Ds,useEffect:YI,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,Jy(4194308,4,ZO.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Jy(4194308,4,e,t)},useInsertionEffect:function(e,t){return Jy(4,2,e,t)},useMemo:function(e,t){var n=Oa();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var l=Oa();return t=n!==void 0?n(t):t,l.memoizedState=l.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},l.queue=e,e=e.dispatch=aU.bind(null,Qn,e),[l.memoizedState,e]},useRef:function(e){var t=Oa();return e={current:e},t.memoizedState=e},useState:KI,useDebugValue:mT,useDeferredValue:function(e){return Oa().memoizedState=e},useTransition:function(){var e=KI(!1),t=e[0];return e=sU.bind(null,e[1]),Oa().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var l=Qn,c=Oa();if(Nn){if(n===void 0)throw Error(Dt(407));n=n()}else{if(n=t(),ji===null)throw Error(Dt(349));$c&30||NO(l,t,n)}c.memoizedState=n;var d={value:n,getSnapshot:t};return c.queue=d,YI($O.bind(null,l,d,e),[e]),l.flags|=2048,bm(9,UO.bind(null,l,d,n,t),void 0,null),n},useId:function(){var e=Oa(),t=ji.identifierPrefix;if(Nn){var n=wl,l=bl;n=(l&~(1<<32-ia(l)-1)).toString(32)+n,t=":"+t+"R"+n,n=vm++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=oU++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},cU={readContext:Ds,useCallback:XO,useContext:Ds,useEffect:pT,useImperativeHandle:HO,useInsertionEffect:qO,useLayoutEffect:WO,useMemo:KO,useReducer:n1,useRef:GO,useState:function(){return n1(xm)},useDebugValue:mT,useDeferredValue:function(e){var t=Rs();return YO(t,Mi.memoizedState,e)},useTransition:function(){var e=n1(xm)[0],t=Rs().memoizedState;return[e,t]},useMutableSource:FO,useSyncExternalStore:BO,useId:JO,unstable_isNewReconciler:!1},hU={readContext:Ds,useCallback:XO,useContext:Ds,useEffect:pT,useImperativeHandle:HO,useInsertionEffect:qO,useLayoutEffect:WO,useMemo:KO,useReducer:i1,useRef:GO,useState:function(){return i1(xm)},useDebugValue:mT,useDeferredValue:function(e){var t=Rs();return Mi===null?t.memoizedState=e:YO(t,Mi.memoizedState,e)},useTransition:function(){var e=i1(xm)[0],t=Rs().memoizedState;return[e,t]},useMutableSource:FO,useSyncExternalStore:BO,useId:JO,unstable_isNewReconciler:!1};function ta(e,t){if(e&&e.defaultProps){t=ei({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function kw(e,t,n,l){t=e.memoizedState,n=n(l,t),n=n==null?t:ei({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var _v={isMounted:function(e){return(e=e._reactInternals)?qc(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var l=Mo(),c=Eu(e),d=El(l,c);d.payload=t,n!=null&&(d.callback=n),t=bu(e,d,c),t!==null&&(oa(t,e,c,l),Ky(t,e,c))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var l=Mo(),c=Eu(e),d=El(l,c);d.tag=1,d.payload=t,n!=null&&(d.callback=n),t=bu(e,d,c),t!==null&&(oa(t,e,c,l),Ky(t,e,c))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Mo(),l=Eu(e),c=El(n,l);c.tag=2,t!=null&&(c.callback=t),t=bu(e,c,l),t!==null&&(oa(t,e,l,n),Ky(t,e,l))}};function JI(e,t,n,l,c,d,_){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(l,d,_):t.prototype&&t.prototype.isPureReactComponent?!dm(n,l)||!dm(c,d):!0}function rD(e,t,n){var l=!1,c=Au,d=t.contextType;return typeof d=="object"&&d!==null?d=Ds(d):(c=es(t)?Nc:_o.current,l=t.contextTypes,d=(l=l!=null)?Df(e,c):Au),t=new t(n,d),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=_v,e.stateNode=t,t._reactInternals=e,l&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=c,e.__reactInternalMemoizedMaskedChildContext=d),t}function QI(e,t,n,l){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,l),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,l),t.state!==e&&_v.enqueueReplaceState(t,t.state,null)}function Lw(e,t,n,l){var c=e.stateNode;c.props=n,c.state=e.memoizedState,c.refs={},aT(e);var d=t.contextType;typeof d=="object"&&d!==null?c.context=Ds(d):(d=es(t)?Nc:_o.current,c.context=Df(e,d)),c.state=e.memoizedState,d=t.getDerivedStateFromProps,typeof d=="function"&&(kw(e,t,d,n),c.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof c.getSnapshotBeforeUpdate=="function"||typeof c.UNSAFE_componentWillMount!="function"&&typeof c.componentWillMount!="function"||(t=c.state,typeof c.componentWillMount=="function"&&c.componentWillMount(),typeof c.UNSAFE_componentWillMount=="function"&&c.UNSAFE_componentWillMount(),t!==c.state&&_v.enqueueReplaceState(c,c.state,null),P_(e,n,c,l),c.state=e.memoizedState),typeof c.componentDidMount=="function"&&(e.flags|=4194308)}function Bf(e,t){try{var n="",l=t;do n+=NN(l),l=l.return;while(l);var c=n}catch(d){c=`
Error generating stack: `+d.message+`
`+d.stack}return{value:e,source:t,stack:c,digest:null}}function o1(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Ow(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var fU=typeof WeakMap=="function"?WeakMap:Map;function nD(e,t,n){n=El(-1,n),n.tag=3,n.payload={element:null};var l=t.value;return n.callback=function(){R_||(R_=!0,Vw=l),Ow(e,t)},n}function iD(e,t,n){n=El(-1,n),n.tag=3;var l=e.type.getDerivedStateFromError;if(typeof l=="function"){var c=t.value;n.payload=function(){return l(c)},n.callback=function(){Ow(e,t)}}var d=e.stateNode;return d!==null&&typeof d.componentDidCatch=="function"&&(n.callback=function(){Ow(e,t),typeof l!="function"&&(wu===null?wu=new Set([this]):wu.add(this));var _=t.stack;this.componentDidCatch(t.value,{componentStack:_!==null?_:""})}),n}function eM(e,t,n){var l=e.pingCache;if(l===null){l=e.pingCache=new fU;var c=new Set;l.set(t,c)}else c=l.get(t),c===void 0&&(c=new Set,l.set(t,c));c.has(n)||(c.add(n),e=AU.bind(null,e,t,n),t.then(e,e))}function tM(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function rM(e,t,n,l,c){return e.mode&1?(e.flags|=65536,e.lanes=c,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=El(-1,1),t.tag=2,bu(n,t,1))),n.lanes|=1),e)}var dU=Il.ReactCurrentOwner,Jo=!1;function Io(e,t,n,l){t.child=e===null?OO(t,null,n,l):zf(t,e.child,n,l)}function nM(e,t,n,l,c){n=n.render;var d=t.ref;return Sf(t,c),l=fT(e,t,n,l,d,c),n=dT(),e!==null&&!Jo?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~c,Cl(e,t,c)):(Nn&&n&&eT(t),t.flags|=1,Io(e,t,l,c),t.child)}function iM(e,t,n,l,c){if(e===null){var d=n.type;return typeof d=="function"&&!ET(d)&&d.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=d,oD(e,t,d,l,c)):(e=r_(n.type,null,l,t,t.mode,c),e.ref=t.ref,e.return=t,t.child=e)}if(d=e.child,!(e.lanes&c)){var _=d.memoizedProps;if(n=n.compare,n=n!==null?n:dm,n(_,l)&&e.ref===t.ref)return Cl(e,t,c)}return t.flags|=1,e=Tu(d,l),e.ref=t.ref,e.return=t,t.child=e}function oD(e,t,n,l,c){if(e!==null){var d=e.memoizedProps;if(dm(d,l)&&e.ref===t.ref)if(Jo=!1,t.pendingProps=l=d,(e.lanes&c)!==0)e.flags&131072&&(Jo=!0);else return t.lanes=e.lanes,Cl(e,t,c)}return Dw(e,t,n,l,c)}function sD(e,t,n){var l=t.pendingProps,c=l.children,d=e!==null?e.memoizedState:null;if(l.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Tn(_f,hs),hs|=n;else{if(!(n&1073741824))return e=d!==null?d.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Tn(_f,hs),hs|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},l=d!==null?d.baseLanes:n,Tn(_f,hs),hs|=l}else d!==null?(l=d.baseLanes|n,t.memoizedState=null):l=n,Tn(_f,hs),hs|=l;return Io(e,t,c,n),t.child}function aD(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Dw(e,t,n,l,c){var d=es(n)?Nc:_o.current;return d=Df(t,d),Sf(t,c),n=fT(e,t,n,l,d,c),l=dT(),e!==null&&!Jo?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~c,Cl(e,t,c)):(Nn&&l&&eT(t),t.flags|=1,Io(e,t,n,c),t.child)}function oM(e,t,n,l,c){if(es(n)){var d=!0;S_(t)}else d=!1;if(Sf(t,c),t.stateNode===null)Qy(e,t),rD(t,n,l),Lw(t,n,l,c),l=!0;else if(e===null){var _=t.stateNode,w=t.memoizedProps;_.props=w;var a=_.context,S=n.contextType;typeof S=="object"&&S!==null?S=Ds(S):(S=es(n)?Nc:_o.current,S=Df(t,S));var D=n.getDerivedStateFromProps,R=typeof D=="function"||typeof _.getSnapshotBeforeUpdate=="function";R||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(w!==l||a!==S)&&QI(t,_,l,S),cu=!1;var I=t.memoizedState;_.state=I,P_(t,l,_,c),a=t.memoizedState,w!==l||I!==a||Qo.current||cu?(typeof D=="function"&&(kw(t,n,D,l),a=t.memoizedState),(w=cu||JI(t,n,w,l,I,a,S))?(R||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount()),typeof _.componentDidMount=="function"&&(t.flags|=4194308)):(typeof _.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=l,t.memoizedState=a),_.props=l,_.state=a,_.context=S,l=w):(typeof _.componentDidMount=="function"&&(t.flags|=4194308),l=!1)}else{_=t.stateNode,RO(e,t),w=t.memoizedProps,S=t.type===t.elementType?w:ta(t.type,w),_.props=S,R=t.pendingProps,I=_.context,a=n.contextType,typeof a=="object"&&a!==null?a=Ds(a):(a=es(n)?Nc:_o.current,a=Df(t,a));var M=n.getDerivedStateFromProps;(D=typeof M=="function"||typeof _.getSnapshotBeforeUpdate=="function")||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(w!==R||I!==a)&&QI(t,_,l,a),cu=!1,I=t.memoizedState,_.state=I,P_(t,l,_,c);var N=t.memoizedState;w!==R||I!==N||Qo.current||cu?(typeof M=="function"&&(kw(t,n,M,l),N=t.memoizedState),(S=cu||JI(t,n,S,l,I,N,a)||!1)?(D||typeof _.UNSAFE_componentWillUpdate!="function"&&typeof _.componentWillUpdate!="function"||(typeof _.componentWillUpdate=="function"&&_.componentWillUpdate(l,N,a),typeof _.UNSAFE_componentWillUpdate=="function"&&_.UNSAFE_componentWillUpdate(l,N,a)),typeof _.componentDidUpdate=="function"&&(t.flags|=4),typeof _.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof _.componentDidUpdate!="function"||w===e.memoizedProps&&I===e.memoizedState||(t.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||w===e.memoizedProps&&I===e.memoizedState||(t.flags|=1024),t.memoizedProps=l,t.memoizedState=N),_.props=l,_.state=N,_.context=a,l=S):(typeof _.componentDidUpdate!="function"||w===e.memoizedProps&&I===e.memoizedState||(t.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||w===e.memoizedProps&&I===e.memoizedState||(t.flags|=1024),l=!1)}return Rw(e,t,n,l,d,c)}function Rw(e,t,n,l,c,d){aD(e,t);var _=(t.flags&128)!==0;if(!l&&!_)return c&&GI(t,n,!1),Cl(e,t,d);l=t.stateNode,dU.current=t;var w=_&&typeof n.getDerivedStateFromError!="function"?null:l.render();return t.flags|=1,e!==null&&_?(t.child=zf(t,e.child,null,d),t.child=zf(t,null,w,d)):Io(e,t,w,d),t.memoizedState=l.state,c&&GI(t,n,!0),t.child}function lD(e){var t=e.stateNode;t.pendingContext?VI(e,t.pendingContext,t.pendingContext!==t.context):t.context&&VI(e,t.context,!1),lT(e,t.containerInfo)}function sM(e,t,n,l,c){return Rf(),rT(c),t.flags|=256,Io(e,t,n,l),t.child}var zw={dehydrated:null,treeContext:null,retryLane:0};function Fw(e){return{baseLanes:e,cachePool:null,transitions:null}}function uD(e,t,n){var l=t.pendingProps,c=Jn.current,d=!1,_=(t.flags&128)!==0,w;if((w=_)||(w=e!==null&&e.memoizedState===null?!1:(c&2)!==0),w?(d=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(c|=1),Tn(Jn,c&1),e===null)return Mw(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(_=l.children,e=l.fallback,d?(l=t.mode,d=t.child,_={mode:"hidden",children:_},!(l&1)&&d!==null?(d.childLanes=0,d.pendingProps=_):d=bv(_,l,0,null),e=zc(e,l,n,null),d.return=t,e.return=t,d.sibling=e,t.child=d,t.child.memoizedState=Fw(n),t.memoizedState=zw,e):gT(t,_));if(c=e.memoizedState,c!==null&&(w=c.dehydrated,w!==null))return pU(e,t,_,l,w,c,n);if(d){d=l.fallback,_=t.mode,c=e.child,w=c.sibling;var a={mode:"hidden",children:l.children};return!(_&1)&&t.child!==c?(l=t.child,l.childLanes=0,l.pendingProps=a,t.deletions=null):(l=Tu(c,a),l.subtreeFlags=c.subtreeFlags&14680064),w!==null?d=Tu(w,d):(d=zc(d,_,n,null),d.flags|=2),d.return=t,l.return=t,l.sibling=d,t.child=l,l=d,d=t.child,_=e.child.memoizedState,_=_===null?Fw(n):{baseLanes:_.baseLanes|n,cachePool:null,transitions:_.transitions},d.memoizedState=_,d.childLanes=e.childLanes&~n,t.memoizedState=zw,l}return d=e.child,e=d.sibling,l=Tu(d,{mode:"visible",children:l.children}),!(t.mode&1)&&(l.lanes=n),l.return=t,l.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=l,t.memoizedState=null,l}function gT(e,t){return t=bv({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Ey(e,t,n,l){return l!==null&&rT(l),zf(t,e.child,null,n),e=gT(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function pU(e,t,n,l,c,d,_){if(n)return t.flags&256?(t.flags&=-257,l=o1(Error(Dt(422))),Ey(e,t,_,l)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(d=l.fallback,c=t.mode,l=bv({mode:"visible",children:l.children},c,0,null),d=zc(d,c,_,null),d.flags|=2,l.return=t,d.return=t,l.sibling=d,t.child=l,t.mode&1&&zf(t,e.child,null,_),t.child.memoizedState=Fw(_),t.memoizedState=zw,d);if(!(t.mode&1))return Ey(e,t,_,null);if(c.data==="$!"){if(l=c.nextSibling&&c.nextSibling.dataset,l)var w=l.dgst;return l=w,d=Error(Dt(419)),l=o1(d,l,void 0),Ey(e,t,_,l)}if(w=(_&e.childLanes)!==0,Jo||w){if(l=ji,l!==null){switch(_&-_){case 4:c=2;break;case 16:c=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:c=32;break;case 536870912:c=268435456;break;default:c=0}c=c&(l.suspendedLanes|_)?0:c,c!==0&&c!==d.retryLane&&(d.retryLane=c,Al(e,c),oa(l,e,c,-1))}return wT(),l=o1(Error(Dt(421))),Ey(e,t,_,l)}return c.data==="$?"?(t.flags|=128,t.child=e.child,t=CU.bind(null,e),c._reactRetry=t,null):(e=d.treeContext,fs=xu(c.nextSibling),ds=t,Nn=!0,na=null,e!==null&&(Is[Ms++]=bl,Is[Ms++]=wl,Is[Ms++]=Uc,bl=e.id,wl=e.overflow,Uc=t),t=gT(t,l.children),t.flags|=4096,t)}function aM(e,t,n){e.lanes|=t;var l=e.alternate;l!==null&&(l.lanes|=t),Pw(e.return,t,n)}function s1(e,t,n,l,c){var d=e.memoizedState;d===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:l,tail:n,tailMode:c}:(d.isBackwards=t,d.rendering=null,d.renderingStartTime=0,d.last=l,d.tail=n,d.tailMode=c)}function cD(e,t,n){var l=t.pendingProps,c=l.revealOrder,d=l.tail;if(Io(e,t,l.children,n),l=Jn.current,l&2)l=l&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&aM(e,n,t);else if(e.tag===19)aM(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}l&=1}if(Tn(Jn,l),!(t.mode&1))t.memoizedState=null;else switch(c){case"forwards":for(n=t.child,c=null;n!==null;)e=n.alternate,e!==null&&k_(e)===null&&(c=n),n=n.sibling;n=c,n===null?(c=t.child,t.child=null):(c=n.sibling,n.sibling=null),s1(t,!1,c,n,d);break;case"backwards":for(n=null,c=t.child,t.child=null;c!==null;){if(e=c.alternate,e!==null&&k_(e)===null){t.child=c;break}e=c.sibling,c.sibling=n,n=c,c=e}s1(t,!0,n,null,d);break;case"together":s1(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Qy(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Cl(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),jc|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Dt(153));if(t.child!==null){for(e=t.child,n=Tu(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=Tu(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function mU(e,t,n){switch(t.tag){case 3:lD(t),Rf();break;case 5:zO(t);break;case 1:es(t.type)&&S_(t);break;case 4:lT(t,t.stateNode.containerInfo);break;case 10:var l=t.type._context,c=t.memoizedProps.value;Tn(I_,l._currentValue),l._currentValue=c;break;case 13:if(l=t.memoizedState,l!==null)return l.dehydrated!==null?(Tn(Jn,Jn.current&1),t.flags|=128,null):n&t.child.childLanes?uD(e,t,n):(Tn(Jn,Jn.current&1),e=Cl(e,t,n),e!==null?e.sibling:null);Tn(Jn,Jn.current&1);break;case 19:if(l=(n&t.childLanes)!==0,e.flags&128){if(l)return cD(e,t,n);t.flags|=128}if(c=t.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),Tn(Jn,Jn.current),l)break;return null;case 22:case 23:return t.lanes=0,sD(e,t,n)}return Cl(e,t,n)}var hD,Bw,fD,dD;hD=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Bw=function(){};fD=function(e,t,n,l){var c=e.memoizedProps;if(c!==l){e=t.stateNode,Oc(Na.current);var d=null;switch(n){case"input":c=sw(e,c),l=sw(e,l),d=[];break;case"select":c=ei({},c,{value:void 0}),l=ei({},l,{value:void 0}),d=[];break;case"textarea":c=uw(e,c),l=uw(e,l),d=[];break;default:typeof c.onClick!="function"&&typeof l.onClick=="function"&&(e.onclick=E_)}hw(n,l);var _;n=null;for(S in c)if(!l.hasOwnProperty(S)&&c.hasOwnProperty(S)&&c[S]!=null)if(S==="style"){var w=c[S];for(_ in w)w.hasOwnProperty(_)&&(n||(n={}),n[_]="")}else S!=="dangerouslySetInnerHTML"&&S!=="children"&&S!=="suppressContentEditableWarning"&&S!=="suppressHydrationWarning"&&S!=="autoFocus"&&(sm.hasOwnProperty(S)?d||(d=[]):(d=d||[]).push(S,null));for(S in l){var a=l[S];if(w=c!=null?c[S]:void 0,l.hasOwnProperty(S)&&a!==w&&(a!=null||w!=null))if(S==="style")if(w){for(_ in w)!w.hasOwnProperty(_)||a&&a.hasOwnProperty(_)||(n||(n={}),n[_]="");for(_ in a)a.hasOwnProperty(_)&&w[_]!==a[_]&&(n||(n={}),n[_]=a[_])}else n||(d||(d=[]),d.push(S,n)),n=a;else S==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,w=w?w.__html:void 0,a!=null&&w!==a&&(d=d||[]).push(S,a)):S==="children"?typeof a!="string"&&typeof a!="number"||(d=d||[]).push(S,""+a):S!=="suppressContentEditableWarning"&&S!=="suppressHydrationWarning"&&(sm.hasOwnProperty(S)?(a!=null&&S==="onScroll"&&kn("scroll",e),d||w===a||(d=[])):(d=d||[]).push(S,a))}n&&(d=d||[]).push("style",n);var S=d;(t.updateQueue=S)&&(t.flags|=4)}};dD=function(e,t,n,l){n!==l&&(t.flags|=4)};function kp(e,t){if(!Nn)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var l=null;n!==null;)n.alternate!==null&&(l=n),n=n.sibling;l===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:l.sibling=null}}function co(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,l=0;if(t)for(var c=e.child;c!==null;)n|=c.lanes|c.childLanes,l|=c.subtreeFlags&14680064,l|=c.flags&14680064,c.return=e,c=c.sibling;else for(c=e.child;c!==null;)n|=c.lanes|c.childLanes,l|=c.subtreeFlags,l|=c.flags,c.return=e,c=c.sibling;return e.subtreeFlags|=l,e.childLanes=n,t}function gU(e,t,n){var l=t.pendingProps;switch(tT(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return co(t),null;case 1:return es(t.type)&&T_(),co(t),null;case 3:return l=t.stateNode,Ff(),Ln(Qo),Ln(_o),cT(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(e===null||e.child===null)&&(by(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,na!==null&&(Ww(na),na=null))),Bw(e,t),co(t),null;case 5:uT(t);var c=Oc(_m.current);if(n=t.type,e!==null&&t.stateNode!=null)fD(e,t,n,l,c),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!l){if(t.stateNode===null)throw Error(Dt(166));return co(t),null}if(e=Oc(Na.current),by(t)){l=t.stateNode,n=t.type;var d=t.memoizedProps;switch(l[Ra]=t,l[gm]=d,e=(t.mode&1)!==0,n){case"dialog":kn("cancel",l),kn("close",l);break;case"iframe":case"object":case"embed":kn("load",l);break;case"video":case"audio":for(c=0;c<Up.length;c++)kn(Up[c],l);break;case"source":kn("error",l);break;case"img":case"image":case"link":kn("error",l),kn("load",l);break;case"details":kn("toggle",l);break;case"input":gI(l,d),kn("invalid",l);break;case"select":l._wrapperState={wasMultiple:!!d.multiple},kn("invalid",l);break;case"textarea":_I(l,d),kn("invalid",l)}hw(n,d),c=null;for(var _ in d)if(d.hasOwnProperty(_)){var w=d[_];_==="children"?typeof w=="string"?l.textContent!==w&&(d.suppressHydrationWarning!==!0&&xy(l.textContent,w,e),c=["children",w]):typeof w=="number"&&l.textContent!==""+w&&(d.suppressHydrationWarning!==!0&&xy(l.textContent,w,e),c=["children",""+w]):sm.hasOwnProperty(_)&&w!=null&&_==="onScroll"&&kn("scroll",l)}switch(n){case"input":fy(l),yI(l,d,!0);break;case"textarea":fy(l),vI(l);break;case"select":case"option":break;default:typeof d.onClick=="function"&&(l.onclick=E_)}l=c,t.updateQueue=l,l!==null&&(t.flags|=4)}else{_=c.nodeType===9?c:c.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=$3(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=_.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof l.is=="string"?e=_.createElement(n,{is:l.is}):(e=_.createElement(n),n==="select"&&(_=e,l.multiple?_.multiple=!0:l.size&&(_.size=l.size))):e=_.createElementNS(e,n),e[Ra]=t,e[gm]=l,hD(e,t,!1,!1),t.stateNode=e;e:{switch(_=fw(n,l),n){case"dialog":kn("cancel",e),kn("close",e),c=l;break;case"iframe":case"object":case"embed":kn("load",e),c=l;break;case"video":case"audio":for(c=0;c<Up.length;c++)kn(Up[c],e);c=l;break;case"source":kn("error",e),c=l;break;case"img":case"image":case"link":kn("error",e),kn("load",e),c=l;break;case"details":kn("toggle",e),c=l;break;case"input":gI(e,l),c=sw(e,l),kn("invalid",e);break;case"option":c=l;break;case"select":e._wrapperState={wasMultiple:!!l.multiple},c=ei({},l,{value:void 0}),kn("invalid",e);break;case"textarea":_I(e,l),c=uw(e,l),kn("invalid",e);break;default:c=l}hw(n,c),w=c;for(d in w)if(w.hasOwnProperty(d)){var a=w[d];d==="style"?G3(e,a):d==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,a!=null&&j3(e,a)):d==="children"?typeof a=="string"?(n!=="textarea"||a!=="")&&am(e,a):typeof a=="number"&&am(e,""+a):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(sm.hasOwnProperty(d)?a!=null&&d==="onScroll"&&kn("scroll",e):a!=null&&UE(e,d,a,_))}switch(n){case"input":fy(e),yI(e,l,!1);break;case"textarea":fy(e),vI(e);break;case"option":l.value!=null&&e.setAttribute("value",""+Su(l.value));break;case"select":e.multiple=!!l.multiple,d=l.value,d!=null?bf(e,!!l.multiple,d,!1):l.defaultValue!=null&&bf(e,!!l.multiple,l.defaultValue,!0);break;default:typeof c.onClick=="function"&&(e.onclick=E_)}switch(n){case"button":case"input":case"select":case"textarea":l=!!l.autoFocus;break e;case"img":l=!0;break e;default:l=!1}}l&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return co(t),null;case 6:if(e&&t.stateNode!=null)dD(e,t,e.memoizedProps,l);else{if(typeof l!="string"&&t.stateNode===null)throw Error(Dt(166));if(n=Oc(_m.current),Oc(Na.current),by(t)){if(l=t.stateNode,n=t.memoizedProps,l[Ra]=t,(d=l.nodeValue!==n)&&(e=ds,e!==null))switch(e.tag){case 3:xy(l.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&xy(l.nodeValue,n,(e.mode&1)!==0)}d&&(t.flags|=4)}else l=(n.nodeType===9?n:n.ownerDocument).createTextNode(l),l[Ra]=t,t.stateNode=l}return co(t),null;case 13:if(Ln(Jn),l=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Nn&&fs!==null&&t.mode&1&&!(t.flags&128))kO(),Rf(),t.flags|=98560,d=!1;else if(d=by(t),l!==null&&l.dehydrated!==null){if(e===null){if(!d)throw Error(Dt(318));if(d=t.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(Dt(317));d[Ra]=t}else Rf(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;co(t),d=!1}else na!==null&&(Ww(na),na=null),d=!0;if(!d)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(l=l!==null,l!==(e!==null&&e.memoizedState!==null)&&l&&(t.child.flags|=8192,t.mode&1&&(e===null||Jn.current&1?ki===0&&(ki=3):wT())),t.updateQueue!==null&&(t.flags|=4),co(t),null);case 4:return Ff(),Bw(e,t),e===null&&pm(t.stateNode.containerInfo),co(t),null;case 10:return oT(t.type._context),co(t),null;case 17:return es(t.type)&&T_(),co(t),null;case 19:if(Ln(Jn),d=t.memoizedState,d===null)return co(t),null;if(l=(t.flags&128)!==0,_=d.rendering,_===null)if(l)kp(d,!1);else{if(ki!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(_=k_(e),_!==null){for(t.flags|=128,kp(d,!1),l=_.updateQueue,l!==null&&(t.updateQueue=l,t.flags|=4),t.subtreeFlags=0,l=n,n=t.child;n!==null;)d=n,e=l,d.flags&=14680066,_=d.alternate,_===null?(d.childLanes=0,d.lanes=e,d.child=null,d.subtreeFlags=0,d.memoizedProps=null,d.memoizedState=null,d.updateQueue=null,d.dependencies=null,d.stateNode=null):(d.childLanes=_.childLanes,d.lanes=_.lanes,d.child=_.child,d.subtreeFlags=0,d.deletions=null,d.memoizedProps=_.memoizedProps,d.memoizedState=_.memoizedState,d.updateQueue=_.updateQueue,d.type=_.type,e=_.dependencies,d.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Tn(Jn,Jn.current&1|2),t.child}e=e.sibling}d.tail!==null&&ci()>Nf&&(t.flags|=128,l=!0,kp(d,!1),t.lanes=4194304)}else{if(!l)if(e=k_(_),e!==null){if(t.flags|=128,l=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),kp(d,!0),d.tail===null&&d.tailMode==="hidden"&&!_.alternate&&!Nn)return co(t),null}else 2*ci()-d.renderingStartTime>Nf&&n!==1073741824&&(t.flags|=128,l=!0,kp(d,!1),t.lanes=4194304);d.isBackwards?(_.sibling=t.child,t.child=_):(n=d.last,n!==null?n.sibling=_:t.child=_,d.last=_)}return d.tail!==null?(t=d.tail,d.rendering=t,d.tail=t.sibling,d.renderingStartTime=ci(),t.sibling=null,n=Jn.current,Tn(Jn,l?n&1|2:n&1),t):(co(t),null);case 22:case 23:return bT(),l=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==l&&(t.flags|=8192),l&&t.mode&1?hs&1073741824&&(co(t),t.subtreeFlags&6&&(t.flags|=8192)):co(t),null;case 24:return null;case 25:return null}throw Error(Dt(156,t.tag))}function yU(e,t){switch(tT(t),t.tag){case 1:return es(t.type)&&T_(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Ff(),Ln(Qo),Ln(_o),cT(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return uT(t),null;case 13:if(Ln(Jn),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Dt(340));Rf()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Ln(Jn),null;case 4:return Ff(),null;case 10:return oT(t.type._context),null;case 22:case 23:return bT(),null;case 24:return null;default:return null}}var Ty=!1,fo=!1,_U=typeof WeakSet=="function"?WeakSet:Set,Ht=null;function yf(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(l){si(e,t,l)}else n.current=null}function Nw(e,t,n){try{n()}catch(l){si(e,t,l)}}var lM=!1;function vU(e,t){if(ww=x_,e=_O(),QE(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var l=n.getSelection&&n.getSelection();if(l&&l.rangeCount!==0){n=l.anchorNode;var c=l.anchorOffset,d=l.focusNode;l=l.focusOffset;try{n.nodeType,d.nodeType}catch{n=null;break e}var _=0,w=-1,a=-1,S=0,D=0,R=e,I=null;t:for(;;){for(var M;R!==n||c!==0&&R.nodeType!==3||(w=_+c),R!==d||l!==0&&R.nodeType!==3||(a=_+l),R.nodeType===3&&(_+=R.nodeValue.length),(M=R.firstChild)!==null;)I=R,R=M;for(;;){if(R===e)break t;if(I===n&&++S===c&&(w=_),I===d&&++D===l&&(a=_),(M=R.nextSibling)!==null)break;R=I,I=R.parentNode}R=M}n=w===-1||a===-1?null:{start:w,end:a}}else n=null}n=n||{start:0,end:0}}else n=null;for(Ew={focusedElem:e,selectionRange:n},x_=!1,Ht=t;Ht!==null;)if(t=Ht,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Ht=e;else for(;Ht!==null;){t=Ht;try{var N=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(N!==null){var j=N.memoizedProps,W=N.memoizedState,B=t.stateNode,k=B.getSnapshotBeforeUpdate(t.elementType===t.type?j:ta(t.type,j),W);B.__reactInternalSnapshotBeforeUpdate=k}break;case 3:var z=t.stateNode.containerInfo;z.nodeType===1?z.textContent="":z.nodeType===9&&z.documentElement&&z.removeChild(z.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Dt(163))}}catch(Z){si(t,t.return,Z)}if(e=t.sibling,e!==null){e.return=t.return,Ht=e;break}Ht=t.return}return N=lM,lM=!1,N}function Kp(e,t,n){var l=t.updateQueue;if(l=l!==null?l.lastEffect:null,l!==null){var c=l=l.next;do{if((c.tag&e)===e){var d=c.destroy;c.destroy=void 0,d!==void 0&&Nw(t,n,d)}c=c.next}while(c!==l)}}function vv(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var l=n.create;n.destroy=l()}n=n.next}while(n!==t)}}function Uw(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function pD(e){var t=e.alternate;t!==null&&(e.alternate=null,pD(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Ra],delete t[gm],delete t[Aw],delete t[tU],delete t[rU])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function mD(e){return e.tag===5||e.tag===3||e.tag===4}function uM(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||mD(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function $w(e,t,n){var l=e.tag;if(l===5||l===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=E_));else if(l!==4&&(e=e.child,e!==null))for($w(e,t,n),e=e.sibling;e!==null;)$w(e,t,n),e=e.sibling}function jw(e,t,n){var l=e.tag;if(l===5||l===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(l!==4&&(e=e.child,e!==null))for(jw(e,t,n),e=e.sibling;e!==null;)jw(e,t,n),e=e.sibling}var Yi=null,ra=!1;function su(e,t,n){for(n=n.child;n!==null;)gD(e,t,n),n=n.sibling}function gD(e,t,n){if(Ba&&typeof Ba.onCommitFiberUnmount=="function")try{Ba.onCommitFiberUnmount(hv,n)}catch{}switch(n.tag){case 5:fo||yf(n,t);case 6:var l=Yi,c=ra;Yi=null,su(e,t,n),Yi=l,ra=c,Yi!==null&&(ra?(e=Yi,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Yi.removeChild(n.stateNode));break;case 18:Yi!==null&&(ra?(e=Yi,n=n.stateNode,e.nodeType===8?Qx(e.parentNode,n):e.nodeType===1&&Qx(e,n),hm(e)):Qx(Yi,n.stateNode));break;case 4:l=Yi,c=ra,Yi=n.stateNode.containerInfo,ra=!0,su(e,t,n),Yi=l,ra=c;break;case 0:case 11:case 14:case 15:if(!fo&&(l=n.updateQueue,l!==null&&(l=l.lastEffect,l!==null))){c=l=l.next;do{var d=c,_=d.destroy;d=d.tag,_!==void 0&&(d&2||d&4)&&Nw(n,t,_),c=c.next}while(c!==l)}su(e,t,n);break;case 1:if(!fo&&(yf(n,t),l=n.stateNode,typeof l.componentWillUnmount=="function"))try{l.props=n.memoizedProps,l.state=n.memoizedState,l.componentWillUnmount()}catch(w){si(n,t,w)}su(e,t,n);break;case 21:su(e,t,n);break;case 22:n.mode&1?(fo=(l=fo)||n.memoizedState!==null,su(e,t,n),fo=l):su(e,t,n);break;default:su(e,t,n)}}function cM(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new _U),t.forEach(function(l){var c=IU.bind(null,e,l);n.has(l)||(n.add(l),l.then(c,c))})}}function ea(e,t){var n=t.deletions;if(n!==null)for(var l=0;l<n.length;l++){var c=n[l];try{var d=e,_=t,w=_;e:for(;w!==null;){switch(w.tag){case 5:Yi=w.stateNode,ra=!1;break e;case 3:Yi=w.stateNode.containerInfo,ra=!0;break e;case 4:Yi=w.stateNode.containerInfo,ra=!0;break e}w=w.return}if(Yi===null)throw Error(Dt(160));gD(d,_,c),Yi=null,ra=!1;var a=c.alternate;a!==null&&(a.return=null),c.return=null}catch(S){si(c,t,S)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)yD(t,e),t=t.sibling}function yD(e,t){var n=e.alternate,l=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ea(t,e),Pa(e),l&4){try{Kp(3,e,e.return),vv(3,e)}catch(j){si(e,e.return,j)}try{Kp(5,e,e.return)}catch(j){si(e,e.return,j)}}break;case 1:ea(t,e),Pa(e),l&512&&n!==null&&yf(n,n.return);break;case 5:if(ea(t,e),Pa(e),l&512&&n!==null&&yf(n,n.return),e.flags&32){var c=e.stateNode;try{am(c,"")}catch(j){si(e,e.return,j)}}if(l&4&&(c=e.stateNode,c!=null)){var d=e.memoizedProps,_=n!==null?n.memoizedProps:d,w=e.type,a=e.updateQueue;if(e.updateQueue=null,a!==null)try{w==="input"&&d.type==="radio"&&d.name!=null&&N3(c,d),fw(w,_);var S=fw(w,d);for(_=0;_<a.length;_+=2){var D=a[_],R=a[_+1];D==="style"?G3(c,R):D==="dangerouslySetInnerHTML"?j3(c,R):D==="children"?am(c,R):UE(c,D,R,S)}switch(w){case"input":aw(c,d);break;case"textarea":U3(c,d);break;case"select":var I=c._wrapperState.wasMultiple;c._wrapperState.wasMultiple=!!d.multiple;var M=d.value;M!=null?bf(c,!!d.multiple,M,!1):I!==!!d.multiple&&(d.defaultValue!=null?bf(c,!!d.multiple,d.defaultValue,!0):bf(c,!!d.multiple,d.multiple?[]:"",!1))}c[gm]=d}catch(j){si(e,e.return,j)}}break;case 6:if(ea(t,e),Pa(e),l&4){if(e.stateNode===null)throw Error(Dt(162));c=e.stateNode,d=e.memoizedProps;try{c.nodeValue=d}catch(j){si(e,e.return,j)}}break;case 3:if(ea(t,e),Pa(e),l&4&&n!==null&&n.memoizedState.isDehydrated)try{hm(t.containerInfo)}catch(j){si(e,e.return,j)}break;case 4:ea(t,e),Pa(e);break;case 13:ea(t,e),Pa(e),c=e.child,c.flags&8192&&(d=c.memoizedState!==null,c.stateNode.isHidden=d,!d||c.alternate!==null&&c.alternate.memoizedState!==null||(vT=ci())),l&4&&cM(e);break;case 22:if(D=n!==null&&n.memoizedState!==null,e.mode&1?(fo=(S=fo)||D,ea(t,e),fo=S):ea(t,e),Pa(e),l&8192){if(S=e.memoizedState!==null,(e.stateNode.isHidden=S)&&!D&&e.mode&1)for(Ht=e,D=e.child;D!==null;){for(R=Ht=D;Ht!==null;){switch(I=Ht,M=I.child,I.tag){case 0:case 11:case 14:case 15:Kp(4,I,I.return);break;case 1:yf(I,I.return);var N=I.stateNode;if(typeof N.componentWillUnmount=="function"){l=I,n=I.return;try{t=l,N.props=t.memoizedProps,N.state=t.memoizedState,N.componentWillUnmount()}catch(j){si(l,n,j)}}break;case 5:yf(I,I.return);break;case 22:if(I.memoizedState!==null){fM(R);continue}}M!==null?(M.return=I,Ht=M):fM(R)}D=D.sibling}e:for(D=null,R=e;;){if(R.tag===5){if(D===null){D=R;try{c=R.stateNode,S?(d=c.style,typeof d.setProperty=="function"?d.setProperty("display","none","important"):d.display="none"):(w=R.stateNode,a=R.memoizedProps.style,_=a!=null&&a.hasOwnProperty("display")?a.display:null,w.style.display=V3("display",_))}catch(j){si(e,e.return,j)}}}else if(R.tag===6){if(D===null)try{R.stateNode.nodeValue=S?"":R.memoizedProps}catch(j){si(e,e.return,j)}}else if((R.tag!==22&&R.tag!==23||R.memoizedState===null||R===e)&&R.child!==null){R.child.return=R,R=R.child;continue}if(R===e)break e;for(;R.sibling===null;){if(R.return===null||R.return===e)break e;D===R&&(D=null),R=R.return}D===R&&(D=null),R.sibling.return=R.return,R=R.sibling}}break;case 19:ea(t,e),Pa(e),l&4&&cM(e);break;case 21:break;default:ea(t,e),Pa(e)}}function Pa(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(mD(n)){var l=n;break e}n=n.return}throw Error(Dt(160))}switch(l.tag){case 5:var c=l.stateNode;l.flags&32&&(am(c,""),l.flags&=-33);var d=uM(e);jw(e,d,c);break;case 3:case 4:var _=l.stateNode.containerInfo,w=uM(e);$w(e,w,_);break;default:throw Error(Dt(161))}}catch(a){si(e,e.return,a)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function xU(e,t,n){Ht=e,_D(e)}function _D(e,t,n){for(var l=(e.mode&1)!==0;Ht!==null;){var c=Ht,d=c.child;if(c.tag===22&&l){var _=c.memoizedState!==null||Ty;if(!_){var w=c.alternate,a=w!==null&&w.memoizedState!==null||fo;w=Ty;var S=fo;if(Ty=_,(fo=a)&&!S)for(Ht=c;Ht!==null;)_=Ht,a=_.child,_.tag===22&&_.memoizedState!==null?dM(c):a!==null?(a.return=_,Ht=a):dM(c);for(;d!==null;)Ht=d,_D(d),d=d.sibling;Ht=c,Ty=w,fo=S}hM(e)}else c.subtreeFlags&8772&&d!==null?(d.return=c,Ht=d):hM(e)}}function hM(e){for(;Ht!==null;){var t=Ht;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:fo||vv(5,t);break;case 1:var l=t.stateNode;if(t.flags&4&&!fo)if(n===null)l.componentDidMount();else{var c=t.elementType===t.type?n.memoizedProps:ta(t.type,n.memoizedProps);l.componentDidUpdate(c,n.memoizedState,l.__reactInternalSnapshotBeforeUpdate)}var d=t.updateQueue;d!==null&&XI(t,d,l);break;case 3:var _=t.updateQueue;if(_!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}XI(t,_,n)}break;case 5:var w=t.stateNode;if(n===null&&t.flags&4){n=w;var a=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":a.autoFocus&&n.focus();break;case"img":a.src&&(n.src=a.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var S=t.alternate;if(S!==null){var D=S.memoizedState;if(D!==null){var R=D.dehydrated;R!==null&&hm(R)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Dt(163))}fo||t.flags&512&&Uw(t)}catch(I){si(t,t.return,I)}}if(t===e){Ht=null;break}if(n=t.sibling,n!==null){n.return=t.return,Ht=n;break}Ht=t.return}}function fM(e){for(;Ht!==null;){var t=Ht;if(t===e){Ht=null;break}var n=t.sibling;if(n!==null){n.return=t.return,Ht=n;break}Ht=t.return}}function dM(e){for(;Ht!==null;){var t=Ht;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{vv(4,t)}catch(a){si(t,n,a)}break;case 1:var l=t.stateNode;if(typeof l.componentDidMount=="function"){var c=t.return;try{l.componentDidMount()}catch(a){si(t,c,a)}}var d=t.return;try{Uw(t)}catch(a){si(t,d,a)}break;case 5:var _=t.return;try{Uw(t)}catch(a){si(t,_,a)}}}catch(a){si(t,t.return,a)}if(t===e){Ht=null;break}var w=t.sibling;if(w!==null){w.return=t.return,Ht=w;break}Ht=t.return}}var bU=Math.ceil,D_=Il.ReactCurrentDispatcher,yT=Il.ReactCurrentOwner,Ls=Il.ReactCurrentBatchConfig,Vr=0,ji=null,_i=null,Ji=0,hs=0,_f=Lu(0),ki=0,wm=null,jc=0,xv=0,_T=0,Yp=null,Yo=null,vT=0,Nf=1/0,_l=null,R_=!1,Vw=null,wu=null,Sy=!1,pu=null,z_=0,Jp=0,Gw=null,e_=-1,t_=0;function Mo(){return Vr&6?ci():e_!==-1?e_:e_=ci()}function Eu(e){return e.mode&1?Vr&2&&Ji!==0?Ji&-Ji:iU.transition!==null?(t_===0&&(t_=rO()),t_):(e=un,e!==0||(e=window.event,e=e===void 0?16:uO(e.type)),e):1}function oa(e,t,n,l){if(50<Jp)throw Jp=0,Gw=null,Error(Dt(185));Mm(e,n,l),(!(Vr&2)||e!==ji)&&(e===ji&&(!(Vr&2)&&(xv|=n),ki===4&&fu(e,Ji)),ts(e,l),n===1&&Vr===0&&!(t.mode&1)&&(Nf=ci()+500,gv&&Ou()))}function ts(e,t){var n=e.callbackNode;i6(e,t);var l=v_(e,e===ji?Ji:0);if(l===0)n!==null&&wI(n),e.callbackNode=null,e.callbackPriority=0;else if(t=l&-l,e.callbackPriority!==t){if(n!=null&&wI(n),t===1)e.tag===0?nU(pM.bind(null,e)):IO(pM.bind(null,e)),Q6(function(){!(Vr&6)&&Ou()}),n=null;else{switch(nO(l)){case 1:n=qE;break;case 4:n=eO;break;case 16:n=__;break;case 536870912:n=tO;break;default:n=__}n=AD(n,vD.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function vD(e,t){if(e_=-1,t_=0,Vr&6)throw Error(Dt(327));var n=e.callbackNode;if(Af()&&e.callbackNode!==n)return null;var l=v_(e,e===ji?Ji:0);if(l===0)return null;if(l&30||l&e.expiredLanes||t)t=F_(e,l);else{t=l;var c=Vr;Vr|=2;var d=bD();(ji!==e||Ji!==t)&&(_l=null,Nf=ci()+500,Rc(e,t));do try{TU();break}catch(w){xD(e,w)}while(!0);iT(),D_.current=d,Vr=c,_i!==null?t=0:(ji=null,Ji=0,t=ki)}if(t!==0){if(t===2&&(c=yw(e),c!==0&&(l=c,t=qw(e,c))),t===1)throw n=wm,Rc(e,0),fu(e,l),ts(e,ci()),n;if(t===6)fu(e,l);else{if(c=e.current.alternate,!(l&30)&&!wU(c)&&(t=F_(e,l),t===2&&(d=yw(e),d!==0&&(l=d,t=qw(e,d))),t===1))throw n=wm,Rc(e,0),fu(e,l),ts(e,ci()),n;switch(e.finishedWork=c,e.finishedLanes=l,t){case 0:case 1:throw Error(Dt(345));case 2:Mc(e,Yo,_l);break;case 3:if(fu(e,l),(l&130023424)===l&&(t=vT+500-ci(),10<t)){if(v_(e,0)!==0)break;if(c=e.suspendedLanes,(c&l)!==l){Mo(),e.pingedLanes|=e.suspendedLanes&c;break}e.timeoutHandle=Sw(Mc.bind(null,e,Yo,_l),t);break}Mc(e,Yo,_l);break;case 4:if(fu(e,l),(l&4194240)===l)break;for(t=e.eventTimes,c=-1;0<l;){var _=31-ia(l);d=1<<_,_=t[_],_>c&&(c=_),l&=~d}if(l=c,l=ci()-l,l=(120>l?120:480>l?480:1080>l?1080:1920>l?1920:3e3>l?3e3:4320>l?4320:1960*bU(l/1960))-l,10<l){e.timeoutHandle=Sw(Mc.bind(null,e,Yo,_l),l);break}Mc(e,Yo,_l);break;case 5:Mc(e,Yo,_l);break;default:throw Error(Dt(329))}}}return ts(e,ci()),e.callbackNode===n?vD.bind(null,e):null}function qw(e,t){var n=Yp;return e.current.memoizedState.isDehydrated&&(Rc(e,t).flags|=256),e=F_(e,t),e!==2&&(t=Yo,Yo=n,t!==null&&Ww(t)),e}function Ww(e){Yo===null?Yo=e:Yo.push.apply(Yo,e)}function wU(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var l=0;l<n.length;l++){var c=n[l],d=c.getSnapshot;c=c.value;try{if(!sa(d(),c))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function fu(e,t){for(t&=~_T,t&=~xv,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ia(t),l=1<<n;e[n]=-1,t&=~l}}function pM(e){if(Vr&6)throw Error(Dt(327));Af();var t=v_(e,0);if(!(t&1))return ts(e,ci()),null;var n=F_(e,t);if(e.tag!==0&&n===2){var l=yw(e);l!==0&&(t=l,n=qw(e,l))}if(n===1)throw n=wm,Rc(e,0),fu(e,t),ts(e,ci()),n;if(n===6)throw Error(Dt(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Mc(e,Yo,_l),ts(e,ci()),null}function xT(e,t){var n=Vr;Vr|=1;try{return e(t)}finally{Vr=n,Vr===0&&(Nf=ci()+500,gv&&Ou())}}function Vc(e){pu!==null&&pu.tag===0&&!(Vr&6)&&Af();var t=Vr;Vr|=1;var n=Ls.transition,l=un;try{if(Ls.transition=null,un=1,e)return e()}finally{un=l,Ls.transition=n,Vr=t,!(Vr&6)&&Ou()}}function bT(){hs=_f.current,Ln(_f)}function Rc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,J6(n)),_i!==null)for(n=_i.return;n!==null;){var l=n;switch(tT(l),l.tag){case 1:l=l.type.childContextTypes,l!=null&&T_();break;case 3:Ff(),Ln(Qo),Ln(_o),cT();break;case 5:uT(l);break;case 4:Ff();break;case 13:Ln(Jn);break;case 19:Ln(Jn);break;case 10:oT(l.type._context);break;case 22:case 23:bT()}n=n.return}if(ji=e,_i=e=Tu(e.current,null),Ji=hs=t,ki=0,wm=null,_T=xv=jc=0,Yo=Yp=null,Lc!==null){for(t=0;t<Lc.length;t++)if(n=Lc[t],l=n.interleaved,l!==null){n.interleaved=null;var c=l.next,d=n.pending;if(d!==null){var _=d.next;d.next=c,l.next=_}n.pending=l}Lc=null}return e}function xD(e,t){do{var n=_i;try{if(iT(),Yy.current=O_,L_){for(var l=Qn.memoizedState;l!==null;){var c=l.queue;c!==null&&(c.pending=null),l=l.next}L_=!1}if($c=0,Ui=Mi=Qn=null,Xp=!1,vm=0,yT.current=null,n===null||n.return===null){ki=1,wm=t,_i=null;break}e:{var d=e,_=n.return,w=n,a=t;if(t=Ji,w.flags|=32768,a!==null&&typeof a=="object"&&typeof a.then=="function"){var S=a,D=w,R=D.tag;if(!(D.mode&1)&&(R===0||R===11||R===15)){var I=D.alternate;I?(D.updateQueue=I.updateQueue,D.memoizedState=I.memoizedState,D.lanes=I.lanes):(D.updateQueue=null,D.memoizedState=null)}var M=tM(_);if(M!==null){M.flags&=-257,rM(M,_,w,d,t),M.mode&1&&eM(d,S,t),t=M,a=S;var N=t.updateQueue;if(N===null){var j=new Set;j.add(a),t.updateQueue=j}else N.add(a);break e}else{if(!(t&1)){eM(d,S,t),wT();break e}a=Error(Dt(426))}}else if(Nn&&w.mode&1){var W=tM(_);if(W!==null){!(W.flags&65536)&&(W.flags|=256),rM(W,_,w,d,t),rT(Bf(a,w));break e}}d=a=Bf(a,w),ki!==4&&(ki=2),Yp===null?Yp=[d]:Yp.push(d),d=_;do{switch(d.tag){case 3:d.flags|=65536,t&=-t,d.lanes|=t;var B=nD(d,a,t);HI(d,B);break e;case 1:w=a;var k=d.type,z=d.stateNode;if(!(d.flags&128)&&(typeof k.getDerivedStateFromError=="function"||z!==null&&typeof z.componentDidCatch=="function"&&(wu===null||!wu.has(z)))){d.flags|=65536,t&=-t,d.lanes|=t;var Z=iD(d,w,t);HI(d,Z);break e}}d=d.return}while(d!==null)}ED(n)}catch(ee){t=ee,_i===n&&n!==null&&(_i=n=n.return);continue}break}while(!0)}function bD(){var e=D_.current;return D_.current=O_,e===null?O_:e}function wT(){(ki===0||ki===3||ki===2)&&(ki=4),ji===null||!(jc&268435455)&&!(xv&268435455)||fu(ji,Ji)}function F_(e,t){var n=Vr;Vr|=2;var l=bD();(ji!==e||Ji!==t)&&(_l=null,Rc(e,t));do try{EU();break}catch(c){xD(e,c)}while(!0);if(iT(),Vr=n,D_.current=l,_i!==null)throw Error(Dt(261));return ji=null,Ji=0,ki}function EU(){for(;_i!==null;)wD(_i)}function TU(){for(;_i!==null&&!XN();)wD(_i)}function wD(e){var t=SD(e.alternate,e,hs);e.memoizedProps=e.pendingProps,t===null?ED(e):_i=t,yT.current=null}function ED(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=yU(n,t),n!==null){n.flags&=32767,_i=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{ki=6,_i=null;return}}else if(n=gU(n,t,hs),n!==null){_i=n;return}if(t=t.sibling,t!==null){_i=t;return}_i=t=e}while(t!==null);ki===0&&(ki=5)}function Mc(e,t,n){var l=un,c=Ls.transition;try{Ls.transition=null,un=1,SU(e,t,n,l)}finally{Ls.transition=c,un=l}return null}function SU(e,t,n,l){do Af();while(pu!==null);if(Vr&6)throw Error(Dt(327));n=e.finishedWork;var c=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(Dt(177));e.callbackNode=null,e.callbackPriority=0;var d=n.lanes|n.childLanes;if(o6(e,d),e===ji&&(_i=ji=null,Ji=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Sy||(Sy=!0,AD(__,function(){return Af(),null})),d=(n.flags&15990)!==0,n.subtreeFlags&15990||d){d=Ls.transition,Ls.transition=null;var _=un;un=1;var w=Vr;Vr|=4,yT.current=null,vU(e,n),yD(n,e),q6(Ew),x_=!!ww,Ew=ww=null,e.current=n,xU(n),KN(),Vr=w,un=_,Ls.transition=d}else e.current=n;if(Sy&&(Sy=!1,pu=e,z_=c),d=e.pendingLanes,d===0&&(wu=null),QN(n.stateNode),ts(e,ci()),t!==null)for(l=e.onRecoverableError,n=0;n<t.length;n++)c=t[n],l(c.value,{componentStack:c.stack,digest:c.digest});if(R_)throw R_=!1,e=Vw,Vw=null,e;return z_&1&&e.tag!==0&&Af(),d=e.pendingLanes,d&1?e===Gw?Jp++:(Jp=0,Gw=e):Jp=0,Ou(),null}function Af(){if(pu!==null){var e=nO(z_),t=Ls.transition,n=un;try{if(Ls.transition=null,un=16>e?16:e,pu===null)var l=!1;else{if(e=pu,pu=null,z_=0,Vr&6)throw Error(Dt(331));var c=Vr;for(Vr|=4,Ht=e.current;Ht!==null;){var d=Ht,_=d.child;if(Ht.flags&16){var w=d.deletions;if(w!==null){for(var a=0;a<w.length;a++){var S=w[a];for(Ht=S;Ht!==null;){var D=Ht;switch(D.tag){case 0:case 11:case 15:Kp(8,D,d)}var R=D.child;if(R!==null)R.return=D,Ht=R;else for(;Ht!==null;){D=Ht;var I=D.sibling,M=D.return;if(pD(D),D===S){Ht=null;break}if(I!==null){I.return=M,Ht=I;break}Ht=M}}}var N=d.alternate;if(N!==null){var j=N.child;if(j!==null){N.child=null;do{var W=j.sibling;j.sibling=null,j=W}while(j!==null)}}Ht=d}}if(d.subtreeFlags&2064&&_!==null)_.return=d,Ht=_;else e:for(;Ht!==null;){if(d=Ht,d.flags&2048)switch(d.tag){case 0:case 11:case 15:Kp(9,d,d.return)}var B=d.sibling;if(B!==null){B.return=d.return,Ht=B;break e}Ht=d.return}}var k=e.current;for(Ht=k;Ht!==null;){_=Ht;var z=_.child;if(_.subtreeFlags&2064&&z!==null)z.return=_,Ht=z;else e:for(_=k;Ht!==null;){if(w=Ht,w.flags&2048)try{switch(w.tag){case 0:case 11:case 15:vv(9,w)}}catch(ee){si(w,w.return,ee)}if(w===_){Ht=null;break e}var Z=w.sibling;if(Z!==null){Z.return=w.return,Ht=Z;break e}Ht=w.return}}if(Vr=c,Ou(),Ba&&typeof Ba.onPostCommitFiberRoot=="function")try{Ba.onPostCommitFiberRoot(hv,e)}catch{}l=!0}return l}finally{un=n,Ls.transition=t}}return!1}function mM(e,t,n){t=Bf(n,t),t=nD(e,t,1),e=bu(e,t,1),t=Mo(),e!==null&&(Mm(e,1,t),ts(e,t))}function si(e,t,n){if(e.tag===3)mM(e,e,n);else for(;t!==null;){if(t.tag===3){mM(t,e,n);break}else if(t.tag===1){var l=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(wu===null||!wu.has(l))){e=Bf(n,e),e=iD(t,e,1),t=bu(t,e,1),e=Mo(),t!==null&&(Mm(t,1,e),ts(t,e));break}}t=t.return}}function AU(e,t,n){var l=e.pingCache;l!==null&&l.delete(t),t=Mo(),e.pingedLanes|=e.suspendedLanes&n,ji===e&&(Ji&n)===n&&(ki===4||ki===3&&(Ji&130023424)===Ji&&500>ci()-vT?Rc(e,0):_T|=n),ts(e,t)}function TD(e,t){t===0&&(e.mode&1?(t=my,my<<=1,!(my&130023424)&&(my=4194304)):t=1);var n=Mo();e=Al(e,t),e!==null&&(Mm(e,t,n),ts(e,n))}function CU(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),TD(e,n)}function IU(e,t){var n=0;switch(e.tag){case 13:var l=e.stateNode,c=e.memoizedState;c!==null&&(n=c.retryLane);break;case 19:l=e.stateNode;break;default:throw Error(Dt(314))}l!==null&&l.delete(t),TD(e,n)}var SD;SD=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||Qo.current)Jo=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return Jo=!1,mU(e,t,n);Jo=!!(e.flags&131072)}else Jo=!1,Nn&&t.flags&1048576&&MO(t,C_,t.index);switch(t.lanes=0,t.tag){case 2:var l=t.type;Qy(e,t),e=t.pendingProps;var c=Df(t,_o.current);Sf(t,n),c=fT(null,t,l,e,c,n);var d=dT();return t.flags|=1,typeof c=="object"&&c!==null&&typeof c.render=="function"&&c.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,es(l)?(d=!0,S_(t)):d=!1,t.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,aT(t),c.updater=_v,t.stateNode=c,c._reactInternals=t,Lw(t,l,e,n),t=Rw(null,t,l,!0,d,n)):(t.tag=0,Nn&&d&&eT(t),Io(null,t,c,n),t=t.child),t;case 16:l=t.elementType;e:{switch(Qy(e,t),e=t.pendingProps,c=l._init,l=c(l._payload),t.type=l,c=t.tag=PU(l),e=ta(l,e),c){case 0:t=Dw(null,t,l,e,n);break e;case 1:t=oM(null,t,l,e,n);break e;case 11:t=nM(null,t,l,e,n);break e;case 14:t=iM(null,t,l,ta(l.type,e),n);break e}throw Error(Dt(306,l,""))}return t;case 0:return l=t.type,c=t.pendingProps,c=t.elementType===l?c:ta(l,c),Dw(e,t,l,c,n);case 1:return l=t.type,c=t.pendingProps,c=t.elementType===l?c:ta(l,c),oM(e,t,l,c,n);case 3:e:{if(lD(t),e===null)throw Error(Dt(387));l=t.pendingProps,d=t.memoizedState,c=d.element,RO(e,t),P_(t,l,null,n);var _=t.memoizedState;if(l=_.element,d.isDehydrated)if(d={element:l,isDehydrated:!1,cache:_.cache,pendingSuspenseBoundaries:_.pendingSuspenseBoundaries,transitions:_.transitions},t.updateQueue.baseState=d,t.memoizedState=d,t.flags&256){c=Bf(Error(Dt(423)),t),t=sM(e,t,l,n,c);break e}else if(l!==c){c=Bf(Error(Dt(424)),t),t=sM(e,t,l,n,c);break e}else for(fs=xu(t.stateNode.containerInfo.firstChild),ds=t,Nn=!0,na=null,n=OO(t,null,l,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Rf(),l===c){t=Cl(e,t,n);break e}Io(e,t,l,n)}t=t.child}return t;case 5:return zO(t),e===null&&Mw(t),l=t.type,c=t.pendingProps,d=e!==null?e.memoizedProps:null,_=c.children,Tw(l,c)?_=null:d!==null&&Tw(l,d)&&(t.flags|=32),aD(e,t),Io(e,t,_,n),t.child;case 6:return e===null&&Mw(t),null;case 13:return uD(e,t,n);case 4:return lT(t,t.stateNode.containerInfo),l=t.pendingProps,e===null?t.child=zf(t,null,l,n):Io(e,t,l,n),t.child;case 11:return l=t.type,c=t.pendingProps,c=t.elementType===l?c:ta(l,c),nM(e,t,l,c,n);case 7:return Io(e,t,t.pendingProps,n),t.child;case 8:return Io(e,t,t.pendingProps.children,n),t.child;case 12:return Io(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(l=t.type._context,c=t.pendingProps,d=t.memoizedProps,_=c.value,Tn(I_,l._currentValue),l._currentValue=_,d!==null)if(sa(d.value,_)){if(d.children===c.children&&!Qo.current){t=Cl(e,t,n);break e}}else for(d=t.child,d!==null&&(d.return=t);d!==null;){var w=d.dependencies;if(w!==null){_=d.child;for(var a=w.firstContext;a!==null;){if(a.context===l){if(d.tag===1){a=El(-1,n&-n),a.tag=2;var S=d.updateQueue;if(S!==null){S=S.shared;var D=S.pending;D===null?a.next=a:(a.next=D.next,D.next=a),S.pending=a}}d.lanes|=n,a=d.alternate,a!==null&&(a.lanes|=n),Pw(d.return,n,t),w.lanes|=n;break}a=a.next}}else if(d.tag===10)_=d.type===t.type?null:d.child;else if(d.tag===18){if(_=d.return,_===null)throw Error(Dt(341));_.lanes|=n,w=_.alternate,w!==null&&(w.lanes|=n),Pw(_,n,t),_=d.sibling}else _=d.child;if(_!==null)_.return=d;else for(_=d;_!==null;){if(_===t){_=null;break}if(d=_.sibling,d!==null){d.return=_.return,_=d;break}_=_.return}d=_}Io(e,t,c.children,n),t=t.child}return t;case 9:return c=t.type,l=t.pendingProps.children,Sf(t,n),c=Ds(c),l=l(c),t.flags|=1,Io(e,t,l,n),t.child;case 14:return l=t.type,c=ta(l,t.pendingProps),c=ta(l.type,c),iM(e,t,l,c,n);case 15:return oD(e,t,t.type,t.pendingProps,n);case 17:return l=t.type,c=t.pendingProps,c=t.elementType===l?c:ta(l,c),Qy(e,t),t.tag=1,es(l)?(e=!0,S_(t)):e=!1,Sf(t,n),rD(t,l,c),Lw(t,l,c,n),Rw(null,t,l,!0,e,n);case 19:return cD(e,t,n);case 22:return sD(e,t,n)}throw Error(Dt(156,t.tag))};function AD(e,t){return Q3(e,t)}function MU(e,t,n,l){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ks(e,t,n,l){return new MU(e,t,n,l)}function ET(e){return e=e.prototype,!(!e||!e.isReactComponent)}function PU(e){if(typeof e=="function")return ET(e)?1:0;if(e!=null){if(e=e.$$typeof,e===jE)return 11;if(e===VE)return 14}return 2}function Tu(e,t){var n=e.alternate;return n===null?(n=ks(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function r_(e,t,n,l,c,d){var _=2;if(l=e,typeof e=="function")ET(e)&&(_=1);else if(typeof e=="string")_=5;else e:switch(e){case lf:return zc(n.children,c,d,t);case $E:_=8,c|=8;break;case rw:return e=ks(12,n,t,c|2),e.elementType=rw,e.lanes=d,e;case nw:return e=ks(13,n,t,c),e.elementType=nw,e.lanes=d,e;case iw:return e=ks(19,n,t,c),e.elementType=iw,e.lanes=d,e;case z3:return bv(n,c,d,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case D3:_=10;break e;case R3:_=9;break e;case jE:_=11;break e;case VE:_=14;break e;case uu:_=16,l=null;break e}throw Error(Dt(130,e==null?e:typeof e,""))}return t=ks(_,n,t,c),t.elementType=e,t.type=l,t.lanes=d,t}function zc(e,t,n,l){return e=ks(7,e,l,t),e.lanes=n,e}function bv(e,t,n,l){return e=ks(22,e,l,t),e.elementType=z3,e.lanes=n,e.stateNode={isHidden:!1},e}function a1(e,t,n){return e=ks(6,e,null,t),e.lanes=n,e}function l1(e,t,n){return t=ks(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function kU(e,t,n,l,c){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=jx(0),this.expirationTimes=jx(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=jx(0),this.identifierPrefix=l,this.onRecoverableError=c,this.mutableSourceEagerHydrationData=null}function TT(e,t,n,l,c,d,_,w,a){return e=new kU(e,t,n,w,a),t===1?(t=1,d===!0&&(t|=8)):t=0,d=ks(3,null,null,t),e.current=d,d.stateNode=e,d.memoizedState={element:l,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},aT(d),e}function LU(e,t,n){var l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:af,key:l==null?null:""+l,children:e,containerInfo:t,implementation:n}}function CD(e){if(!e)return Au;e=e._reactInternals;e:{if(qc(e)!==e||e.tag!==1)throw Error(Dt(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(es(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Dt(171))}if(e.tag===1){var n=e.type;if(es(n))return CO(e,n,t)}return t}function ID(e,t,n,l,c,d,_,w,a){return e=TT(n,l,!0,e,c,d,_,w,a),e.context=CD(null),n=e.current,l=Mo(),c=Eu(n),d=El(l,c),d.callback=t??null,bu(n,d,c),e.current.lanes=c,Mm(e,c,l),ts(e,l),e}function wv(e,t,n,l){var c=t.current,d=Mo(),_=Eu(c);return n=CD(n),t.context===null?t.context=n:t.pendingContext=n,t=El(d,_),t.payload={element:e},l=l===void 0?null:l,l!==null&&(t.callback=l),e=bu(c,t,_),e!==null&&(oa(e,c,_,d),Ky(e,c,_)),_}function B_(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function gM(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function ST(e,t){gM(e,t),(e=e.alternate)&&gM(e,t)}function OU(){return null}var MD=typeof reportError=="function"?reportError:function(e){console.error(e)};function AT(e){this._internalRoot=e}Ev.prototype.render=AT.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Dt(409));wv(e,t,null,null)};Ev.prototype.unmount=AT.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Vc(function(){wv(null,e,null,null)}),t[Sl]=null}};function Ev(e){this._internalRoot=e}Ev.prototype.unstable_scheduleHydration=function(e){if(e){var t=sO();e={blockedOn:null,target:e,priority:t};for(var n=0;n<hu.length&&t!==0&&t<hu[n].priority;n++);hu.splice(n,0,e),n===0&&lO(e)}};function CT(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Tv(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function yM(){}function DU(e,t,n,l,c){if(c){if(typeof l=="function"){var d=l;l=function(){var S=B_(_);d.call(S)}}var _=ID(t,l,e,0,null,!1,!1,"",yM);return e._reactRootContainer=_,e[Sl]=_.current,pm(e.nodeType===8?e.parentNode:e),Vc(),_}for(;c=e.lastChild;)e.removeChild(c);if(typeof l=="function"){var w=l;l=function(){var S=B_(a);w.call(S)}}var a=TT(e,0,!1,null,null,!1,!1,"",yM);return e._reactRootContainer=a,e[Sl]=a.current,pm(e.nodeType===8?e.parentNode:e),Vc(function(){wv(t,a,n,l)}),a}function Sv(e,t,n,l,c){var d=n._reactRootContainer;if(d){var _=d;if(typeof c=="function"){var w=c;c=function(){var a=B_(_);w.call(a)}}wv(t,_,e,c)}else _=DU(n,t,e,c,l);return B_(_)}iO=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Np(t.pendingLanes);n!==0&&(WE(t,n|1),ts(t,ci()),!(Vr&6)&&(Nf=ci()+500,Ou()))}break;case 13:Vc(function(){var l=Al(e,1);if(l!==null){var c=Mo();oa(l,e,1,c)}}),ST(e,1)}};ZE=function(e){if(e.tag===13){var t=Al(e,134217728);if(t!==null){var n=Mo();oa(t,e,134217728,n)}ST(e,134217728)}};oO=function(e){if(e.tag===13){var t=Eu(e),n=Al(e,t);if(n!==null){var l=Mo();oa(n,e,t,l)}ST(e,t)}};sO=function(){return un};aO=function(e,t){var n=un;try{return un=e,t()}finally{un=n}};pw=function(e,t,n){switch(t){case"input":if(aw(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var l=n[t];if(l!==e&&l.form===e.form){var c=mv(l);if(!c)throw Error(Dt(90));B3(l),aw(l,c)}}}break;case"textarea":U3(e,n);break;case"select":t=n.value,t!=null&&bf(e,!!n.multiple,t,!1)}};Z3=xT;H3=Vc;var RU={usingClientEntryPoint:!1,Events:[km,ff,mv,q3,W3,xT]},Lp={findFiberByHostInstance:kc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},zU={bundleType:Lp.bundleType,version:Lp.version,rendererPackageName:Lp.rendererPackageName,rendererConfig:Lp.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Il.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Y3(e),e===null?null:e.stateNode},findFiberByHostInstance:Lp.findFiberByHostInstance||OU,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ay=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ay.isDisabled&&Ay.supportsFiber)try{hv=Ay.inject(zU),Ba=Ay}catch{}}gs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=RU;gs.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!CT(t))throw Error(Dt(200));return LU(e,t,null,n)};gs.createRoot=function(e,t){if(!CT(e))throw Error(Dt(299));var n=!1,l="",c=MD;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(l=t.identifierPrefix),t.onRecoverableError!==void 0&&(c=t.onRecoverableError)),t=TT(e,1,!1,null,null,n,!1,l,c),e[Sl]=t.current,pm(e.nodeType===8?e.parentNode:e),new AT(t)};gs.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Dt(188)):(e=Object.keys(e).join(","),Error(Dt(268,e)));return e=Y3(t),e=e===null?null:e.stateNode,e};gs.flushSync=function(e){return Vc(e)};gs.hydrate=function(e,t,n){if(!Tv(t))throw Error(Dt(200));return Sv(null,e,t,!0,n)};gs.hydrateRoot=function(e,t,n){if(!CT(e))throw Error(Dt(405));var l=n!=null&&n.hydratedSources||null,c=!1,d="",_=MD;if(n!=null&&(n.unstable_strictMode===!0&&(c=!0),n.identifierPrefix!==void 0&&(d=n.identifierPrefix),n.onRecoverableError!==void 0&&(_=n.onRecoverableError)),t=ID(t,null,e,1,n??null,c,!1,d,_),e[Sl]=t.current,pm(e),l)for(e=0;e<l.length;e++)n=l[e],c=n._getVersion,c=c(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,c]:t.mutableSourceEagerHydrationData.push(n,c);return new Ev(t)};gs.render=function(e,t,n){if(!Tv(t))throw Error(Dt(200));return Sv(null,e,t,!1,n)};gs.unmountComponentAtNode=function(e){if(!Tv(e))throw Error(Dt(40));return e._reactRootContainer?(Vc(function(){Sv(null,null,e,!1,function(){e._reactRootContainer=null,e[Sl]=null})}),!0):!1};gs.unstable_batchedUpdates=xT;gs.unstable_renderSubtreeIntoContainer=function(e,t,n,l){if(!Tv(n))throw Error(Dt(200));if(e==null||e._reactInternals===void 0)throw Error(Dt(38));return Sv(e,t,n,!1,l)};gs.version="18.3.1-next-f1338f8080-20240426";function PD(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(PD)}catch(e){console.error(e)}}PD(),P3.exports=gs;var FU=P3.exports,_M=FU;ew.createRoot=_M.createRoot,ew.hydrateRoot=_M.hydrateRoot;function kD(e,t,n){if(e!==null)for(var l,c,d,_,w,a,S,D=0,R=0,I,M=e.type,N=M==="FeatureCollection",j=M==="Feature",W=N?e.features.length:1,B=0;B<W;B++){S=N?e.features[B].geometry:j?e.geometry:e,I=S?S.type==="GeometryCollection":!1,w=I?S.geometries.length:1;for(var k=0;k<w;k++){var z=0,Z=0;if(_=I?S.geometries[k]:S,_!==null){a=_.coordinates;var ee=_.type;switch(D=0,ee){case null:break;case"Point":if(t(a,R,B,z,Z)===!1)return!1;R++,z++;break;case"LineString":case"MultiPoint":for(l=0;l<a.length;l++){if(t(a[l],R,B,z,Z)===!1)return!1;R++,ee==="MultiPoint"&&z++}ee==="LineString"&&z++;break;case"Polygon":case"MultiLineString":for(l=0;l<a.length;l++){for(c=0;c<a[l].length-D;c++){if(t(a[l][c],R,B,z,Z)===!1)return!1;R++}ee==="MultiLineString"&&z++,ee==="Polygon"&&Z++}ee==="Polygon"&&z++;break;case"MultiPolygon":for(l=0;l<a.length;l++){for(Z=0,c=0;c<a[l].length;c++){for(d=0;d<a[l][c].length-D;d++){if(t(a[l][c][d],R,B,z,Z)===!1)return!1;R++}Z++}z++}break;case"GeometryCollection":for(l=0;l<_.geometries.length;l++)if(kD(_.geometries[l],t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Uf(e){var t=[1/0,1/0,-1/0,-1/0];return kD(e,function(n){t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}Uf.default=Uf;const BU=Object.freeze(Object.defineProperty({__proto__:null,default:Uf},Symbol.toStringTag,{value:"Module"}));function mo(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ua(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function LD(e){return e.type==="Feature"?e.geometry:e}function vM(e,t){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function xM(e,t,n){if(n===void 0&&(n={}),!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var l=mo(e),c=LD(t),d=c.type,_=t.bbox,w=c.coordinates;if(_&&NU(l,_)===!1)return!1;d==="Polygon"&&(w=[w]);for(var a=!1,S=0;S<w.length&&!a;S++)if(bM(l,w[S][0],n.ignoreBoundary)){for(var D=!1,R=1;R<w[S].length&&!D;)bM(l,w[S][R],!n.ignoreBoundary)&&(D=!0),R++;D||(a=!0)}return a}function bM(e,t,n){var l=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var c=0,d=t.length-1;c<t.length;d=c++){var _=t[c][0],w=t[c][1],a=t[d][0],S=t[d][1],D=e[1]*(_-a)+w*(a-e[0])+S*(e[0]-_)===0&&(_-e[0])*(a-e[0])<=0&&(w-e[1])*(S-e[1])<=0;if(D)return!n;var R=w>e[1]!=S>e[1]&&e[0]<(a-_)*(e[1]-w)/(S-w)+_;R&&(l=!l)}return l}function NU(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}var Zo=63710088e-1,UU={centimeters:Zo*100,centimetres:Zo*100,degrees:Zo/111325,feet:Zo*3.28084,inches:Zo*39.37,kilometers:Zo/1e3,kilometres:Zo/1e3,meters:Zo,metres:Zo,miles:Zo/1609.344,millimeters:Zo*1e3,millimetres:Zo*1e3,nauticalmiles:Zo/1852,radians:1,yards:Zo*1.0936};function $U(e,t){t===void 0&&(t="kilometers");var n=UU[t];if(!n)throw new Error(t+" units is invalid");return e*n}function Cy(e){var t=e%360;return t*Math.PI/180}function $i(e,t,n){n===void 0&&(n={});var l=mo(e),c=mo(t),d=Cy(c[1]-l[1]),_=Cy(c[0]-l[0]),w=Cy(l[1]),a=Cy(c[1]),S=Math.pow(Math.sin(d/2),2)+Math.pow(Math.sin(_/2),2)*Math.cos(w)*Math.cos(a);return $U(2*Math.atan2(Math.sqrt(S),Math.sqrt(1-S)),n.units)}const jU=Object.freeze(Object.defineProperty({__proto__:null,default:$i},Symbol.toStringTag,{value:"Module"}));function VU(e){var t=e[0],n=e[1],l=e[2],c=e[3],d=$i(e.slice(0,2),[l,n]),_=$i(e.slice(0,2),[t,c]);if(d>=_){var w=(n+c)/2;return[t,w-(l-t)/2,l,w+(l-t)/2]}else{var a=(t+l)/2;return[a-(c-n)/2,n,a+(c-n)/2,c]}}var Ho=63710088e-1,GU={centimeters:Ho*100,centimetres:Ho*100,degrees:Ho/111325,feet:Ho*3.28084,inches:Ho*39.37,kilometers:Ho/1e3,kilometres:Ho/1e3,meters:Ho,metres:Ho,miles:Ho/1609.344,millimeters:Ho*1e3,millimetres:Ho*1e3,nauticalmiles:Ho/1852,radians:1,yards:Ho*1.0936};function qU(e,t,n){n===void 0&&(n={});var l={type:"Feature"};return(n.id===0||n.id)&&(l.id=n.id),n.bbox&&(l.bbox=n.bbox),l.properties=t||{},l.geometry=e,l}function WU(e,t,n){if(n===void 0&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!EM(e[0])||!EM(e[1]))throw new Error("coordinates must contain numbers");var l={type:"Point",coordinates:e};return qU(l,t,n)}function ZU(e,t){t===void 0&&(t="kilometers");var n=GU[t];if(!n)throw new Error(t+" units is invalid");return e/n}function wM(e){var t=e%(2*Math.PI);return t*180/Math.PI}function u1(e){var t=e%360;return t*Math.PI/180}function EM(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function za(e,t,n,l){l===void 0&&(l={});var c=mo(e),d=u1(c[0]),_=u1(c[1]),w=u1(n),a=ZU(t,l.units),S=Math.asin(Math.sin(_)*Math.cos(a)+Math.cos(_)*Math.sin(a)*Math.cos(w)),D=d+Math.atan2(Math.sin(w)*Math.sin(a)*Math.cos(_),Math.cos(a)-Math.sin(_)*Math.sin(S)),R=wM(D),I=wM(S);return WU([R,I],l.properties)}function HU(e,t,n){n===void 0&&(n={});var l={type:"Feature"};return(n.id===0||n.id)&&(l.id=n.id),n.bbox&&(l.bbox=n.bbox),l.properties=t||{},l.geometry=e,l}function XU(e,t,n){n===void 0&&(n={});for(var l=0,c=e;l<c.length;l++){var d=c[l];if(d.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var _=0;_<d[d.length-1].length;_++)if(d[d.length-1][_]!==d[0][_])throw new Error("First and last Position are not equivalent.")}var w={type:"Polygon",coordinates:e};return HU(w,t,n)}function Zw(e,t,n){n===void 0&&(n={});for(var l=n.steps||64,c=n.properties?n.properties:!Array.isArray(e)&&e.type==="Feature"&&e.properties?e.properties:{},d=[],_=0;_<l;_++)d.push(za(e,t,_*-360/l,n).geometry.coordinates);return d.push(d[0]),XU([d],c)}const KU=Object.freeze(Object.defineProperty({__proto__:null,default:Zw},Symbol.toStringTag,{value:"Module"}));function YU(e){var t=e%(2*Math.PI);return t*180/Math.PI}function Iy(e){var t=e%360;return t*Math.PI/180}function Cu(e,t,n){if(n===void 0&&(n={}),n.final===!0)return JU(e,t);var l=mo(e),c=mo(t),d=Iy(l[0]),_=Iy(c[0]),w=Iy(l[1]),a=Iy(c[1]),S=Math.sin(_-d)*Math.cos(a),D=Math.cos(w)*Math.sin(a)-Math.sin(w)*Math.cos(a)*Math.cos(_-d);return YU(Math.atan2(S,D))}function JU(e,t){var n=Cu(t,e);return n=(n+180)%360,n}function TM(e,t){var n=$i(e,t),l=Cu(e,t),c=za(e,n/2,l);return c}function QU(e,t,n){n===void 0&&(n={});var l={type:"Feature"};return(n.id===0||n.id)&&(l.id=n.id),n.bbox&&(l.bbox=n.bbox),l.properties=t||{},l.geometry=e,l}function e$(e,t,n){if(n===void 0&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!SM(e[0])||!SM(e[1]))throw new Error("coordinates must contain numbers");var l={type:"Point",coordinates:e};return QU(l,t,n)}function SM(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function OD(e,t,n){if(e!==null)for(var l,c,d,_,w,a,S,D=0,R=0,I,M=e.type,N=M==="FeatureCollection",j=M==="Feature",W=N?e.features.length:1,B=0;B<W;B++){S=N?e.features[B].geometry:j?e.geometry:e,I=S?S.type==="GeometryCollection":!1,w=I?S.geometries.length:1;for(var k=0;k<w;k++){var z=0,Z=0;if(_=I?S.geometries[k]:S,_!==null){a=_.coordinates;var ee=_.type;switch(D=ee==="Polygon"||ee==="MultiPolygon"?1:0,ee){case null:break;case"Point":if(t(a,R,B,z,Z)===!1)return!1;R++,z++;break;case"LineString":case"MultiPoint":for(l=0;l<a.length;l++){if(t(a[l],R,B,z,Z)===!1)return!1;R++,ee==="MultiPoint"&&z++}ee==="LineString"&&z++;break;case"Polygon":case"MultiLineString":for(l=0;l<a.length;l++){for(c=0;c<a[l].length-D;c++){if(t(a[l][c],R,B,z,Z)===!1)return!1;R++}ee==="MultiLineString"&&z++,ee==="Polygon"&&Z++}ee==="Polygon"&&z++;break;case"MultiPolygon":for(l=0;l<a.length;l++){for(Z=0,c=0;c<a[l].length;c++){for(d=0;d<a[l][c].length-D;d++){if(t(a[l][c][d],R,B,z,Z)===!1)return!1;R++}Z++}z++}break;case"GeometryCollection":for(l=0;l<_.geometries.length;l++)if(OD(_.geometries[l],t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Cf(e,t){t===void 0&&(t={});var n=0,l=0,c=0;return OD(e,function(d){n+=d[0],l+=d[1],c++}),e$([n/c,l/c],t.properties)}function Hw(e,t,n){n===void 0&&(n={});var l={type:"Feature"};return(n.id===0||n.id)&&(l.id=n.id),n.bbox&&(l.bbox=n.bbox),l.properties={},l.geometry=e,l}function t$(e,t,n){if(n===void 0&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!CM(e[0])||!CM(e[1]))throw new Error("coordinates must contain numbers");var l={type:"Point",coordinates:e};return Hw(l,t,n)}function AM(e,t){t===void 0&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function CM(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Xw(e,t,n){n===void 0&&(n={});var l={type:"Feature"};return(n.id===0||n.id)&&(l.id=n.id),n.bbox&&(l.bbox=n.bbox),l.properties=t||{},l.geometry=e,l}function r$(e,t,n){if(n===void 0&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var l={type:"LineString",coordinates:e};return Xw(l,t,n)}function n$(e,t){t===void 0&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function i$(e,t){var n,l,c,d,_,w,a,S,D,R,I=0,M=e.type==="FeatureCollection",N=e.type==="Feature",j=M?e.features.length:1;for(n=0;n<j;n++){for(w=M?e.features[n].geometry:N?e.geometry:e,S=M?e.features[n].properties:N?e.properties:{},D=M?e.features[n].bbox:N?e.bbox:void 0,R=M?e.features[n].id:N?e.id:void 0,a=w?w.type==="GeometryCollection":!1,_=a?w.geometries.length:1,c=0;c<_;c++){if(d=a?w.geometries[c]:w,d===null){if(t(null,I,S,D,R)===!1)return!1;continue}switch(d.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(d,I,S,D,R)===!1)return!1;break}case"GeometryCollection":{for(l=0;l<d.geometries.length;l++)if(t(d.geometries[l],I,S,D,R)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}I++}}function o$(e,t){i$(e,function(n,l,c,d,_){var w=n===null?null:n.type;switch(w){case null:case"Point":case"LineString":case"Polygon":return t(Xw(n,c,{bbox:d,id:_}),l,0)===!1?!1:void 0}var a;switch(w){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var S=0;S<n.coordinates.length;S++){var D=n.coordinates[S],R={type:a,coordinates:D};if(t(Xw(R,c),l,S)===!1)return!1}})}function Kw(e){if(!e)throw new Error("geojson is required");var t=[];return o$(e,function(n){s$(n,t)}),n$(t)}function s$(e,t){var n=[],l=e.geometry;if(l!==null){switch(l.type){case"Polygon":n=Ua(l);break;case"LineString":n=[Ua(l)]}n.forEach(function(c){var d=a$(c,e.properties);d.forEach(function(_){_.id=t.length,t.push(_)})})}}function a$(e,t){var n=[];return e.reduce(function(l,c){var d=r$([l,c],t);return d.bbox=l$(l,c),n.push(d),c}),n}function l$(e,t){var n=e[0],l=e[1],c=t[0],d=t[1],_=n<c?n:c,w=l<d?l:d,a=n>c?n:c,S=l>d?l:d;return[_,w,a,S]}function IM(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var n=0;n<e.features.length&&t(e.features[n],n)!==!1;n++);}var IT={exports:{}},DD={exports:{}};(function(e,t){(function(n,l){e.exports=l()})(Am,function(){function n(k,z,Z,ee,se){(function ue(Te,Q,he,ye,J){for(;ye>he;){if(ye-he>600){var ie=ye-he+1,q=Q-he+1,Ke=Math.log(ie),Mt=.5*Math.exp(2*Ke/3),ct=.5*Math.sqrt(Ke*Mt*(ie-Mt)/ie)*(q-ie/2<0?-1:1),He=Math.max(he,Math.floor(Q-q*Mt/ie+ct)),_e=Math.min(ye,Math.floor(Q+(ie-q)*Mt/ie+ct));ue(Te,Q,He,_e,J)}var qe=Te[Q],Pe=he,Le=ye;for(l(Te,he,Q),J(Te[ye],qe)>0&&l(Te,he,ye);Pe<Le;){for(l(Te,Pe,Le),Pe++,Le--;J(Te[Pe],qe)<0;)Pe++;for(;J(Te[Le],qe)>0;)Le--}J(Te[he],qe)===0?l(Te,he,Le):l(Te,++Le,ye),Le<=Q&&(he=Le+1),Q<=Le&&(ye=Le-1)}})(k,z,Z||0,ee||k.length-1,se||c)}function l(k,z,Z){var ee=k[z];k[z]=k[Z],k[Z]=ee}function c(k,z){return k<z?-1:k>z?1:0}var d=function(k){k===void 0&&(k=9),this._maxEntries=Math.max(4,k),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function _(k,z,Z){if(!Z)return z.indexOf(k);for(var ee=0;ee<z.length;ee++)if(Z(k,z[ee]))return ee;return-1}function w(k,z){a(k,0,k.children.length,z,k)}function a(k,z,Z,ee,se){se||(se=W(null)),se.minX=1/0,se.minY=1/0,se.maxX=-1/0,se.maxY=-1/0;for(var ue=z;ue<Z;ue++){var Te=k.children[ue];S(se,k.leaf?ee(Te):Te)}return se}function S(k,z){return k.minX=Math.min(k.minX,z.minX),k.minY=Math.min(k.minY,z.minY),k.maxX=Math.max(k.maxX,z.maxX),k.maxY=Math.max(k.maxY,z.maxY),k}function D(k,z){return k.minX-z.minX}function R(k,z){return k.minY-z.minY}function I(k){return(k.maxX-k.minX)*(k.maxY-k.minY)}function M(k){return k.maxX-k.minX+(k.maxY-k.minY)}function N(k,z){return k.minX<=z.minX&&k.minY<=z.minY&&z.maxX<=k.maxX&&z.maxY<=k.maxY}function j(k,z){return z.minX<=k.maxX&&z.minY<=k.maxY&&z.maxX>=k.minX&&z.maxY>=k.minY}function W(k){return{children:k,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function B(k,z,Z,ee,se){for(var ue=[z,Z];ue.length;)if(!((Z=ue.pop())-(z=ue.pop())<=ee)){var Te=z+Math.ceil((Z-z)/ee/2)*ee;n(k,Te,z,Z,se),ue.push(z,Te,Te,Z)}}return d.prototype.all=function(){return this._all(this.data,[])},d.prototype.search=function(k){var z=this.data,Z=[];if(!j(k,z))return Z;for(var ee=this.toBBox,se=[];z;){for(var ue=0;ue<z.children.length;ue++){var Te=z.children[ue],Q=z.leaf?ee(Te):Te;j(k,Q)&&(z.leaf?Z.push(Te):N(k,Q)?this._all(Te,Z):se.push(Te))}z=se.pop()}return Z},d.prototype.collides=function(k){var z=this.data;if(!j(k,z))return!1;for(var Z=[];z;){for(var ee=0;ee<z.children.length;ee++){var se=z.children[ee],ue=z.leaf?this.toBBox(se):se;if(j(k,ue)){if(z.leaf||N(k,ue))return!0;Z.push(se)}}z=Z.pop()}return!1},d.prototype.load=function(k){if(!k||!k.length)return this;if(k.length<this._minEntries){for(var z=0;z<k.length;z++)this.insert(k[z]);return this}var Z=this._build(k.slice(),0,k.length-1,0);if(this.data.children.length)if(this.data.height===Z.height)this._splitRoot(this.data,Z);else{if(this.data.height<Z.height){var ee=this.data;this.data=Z,Z=ee}this._insert(Z,this.data.height-Z.height-1,!0)}else this.data=Z;return this},d.prototype.insert=function(k){return k&&this._insert(k,this.data.height-1),this},d.prototype.clear=function(){return this.data=W([]),this},d.prototype.remove=function(k,z){if(!k)return this;for(var Z,ee,se,ue=this.data,Te=this.toBBox(k),Q=[],he=[];ue||Q.length;){if(ue||(ue=Q.pop(),ee=Q[Q.length-1],Z=he.pop(),se=!0),ue.leaf){var ye=_(k,ue.children,z);if(ye!==-1)return ue.children.splice(ye,1),Q.push(ue),this._condense(Q),this}se||ue.leaf||!N(ue,Te)?ee?(Z++,ue=ee.children[Z],se=!1):ue=null:(Q.push(ue),he.push(Z),Z=0,ee=ue,ue=ue.children[0])}return this},d.prototype.toBBox=function(k){return k},d.prototype.compareMinX=function(k,z){return k.minX-z.minX},d.prototype.compareMinY=function(k,z){return k.minY-z.minY},d.prototype.toJSON=function(){return this.data},d.prototype.fromJSON=function(k){return this.data=k,this},d.prototype._all=function(k,z){for(var Z=[];k;)k.leaf?z.push.apply(z,k.children):Z.push.apply(Z,k.children),k=Z.pop();return z},d.prototype._build=function(k,z,Z,ee){var se,ue=Z-z+1,Te=this._maxEntries;if(ue<=Te)return w(se=W(k.slice(z,Z+1)),this.toBBox),se;ee||(ee=Math.ceil(Math.log(ue)/Math.log(Te)),Te=Math.ceil(ue/Math.pow(Te,ee-1))),(se=W([])).leaf=!1,se.height=ee;var Q=Math.ceil(ue/Te),he=Q*Math.ceil(Math.sqrt(Te));B(k,z,Z,he,this.compareMinX);for(var ye=z;ye<=Z;ye+=he){var J=Math.min(ye+he-1,Z);B(k,ye,J,Q,this.compareMinY);for(var ie=ye;ie<=J;ie+=Q){var q=Math.min(ie+Q-1,J);se.children.push(this._build(k,ie,q,ee-1))}}return w(se,this.toBBox),se},d.prototype._chooseSubtree=function(k,z,Z,ee){for(;ee.push(z),!z.leaf&&ee.length-1!==Z;){for(var se=1/0,ue=1/0,Te=void 0,Q=0;Q<z.children.length;Q++){var he=z.children[Q],ye=I(he),J=(ie=k,q=he,(Math.max(q.maxX,ie.maxX)-Math.min(q.minX,ie.minX))*(Math.max(q.maxY,ie.maxY)-Math.min(q.minY,ie.minY))-ye);J<ue?(ue=J,se=ye<se?ye:se,Te=he):J===ue&&ye<se&&(se=ye,Te=he)}z=Te||z.children[0]}var ie,q;return z},d.prototype._insert=function(k,z,Z){var ee=Z?k:this.toBBox(k),se=[],ue=this._chooseSubtree(ee,this.data,z,se);for(ue.children.push(k),S(ue,ee);z>=0&&se[z].children.length>this._maxEntries;)this._split(se,z),z--;this._adjustParentBBoxes(ee,se,z)},d.prototype._split=function(k,z){var Z=k[z],ee=Z.children.length,se=this._minEntries;this._chooseSplitAxis(Z,se,ee);var ue=this._chooseSplitIndex(Z,se,ee),Te=W(Z.children.splice(ue,Z.children.length-ue));Te.height=Z.height,Te.leaf=Z.leaf,w(Z,this.toBBox),w(Te,this.toBBox),z?k[z-1].children.push(Te):this._splitRoot(Z,Te)},d.prototype._splitRoot=function(k,z){this.data=W([k,z]),this.data.height=k.height+1,this.data.leaf=!1,w(this.data,this.toBBox)},d.prototype._chooseSplitIndex=function(k,z,Z){for(var ee,se,ue,Te,Q,he,ye,J=1/0,ie=1/0,q=z;q<=Z-z;q++){var Ke=a(k,0,q,this.toBBox),Mt=a(k,q,Z,this.toBBox),ct=(se=Ke,ue=Mt,Te=void 0,Q=void 0,he=void 0,ye=void 0,Te=Math.max(se.minX,ue.minX),Q=Math.max(se.minY,ue.minY),he=Math.min(se.maxX,ue.maxX),ye=Math.min(se.maxY,ue.maxY),Math.max(0,he-Te)*Math.max(0,ye-Q)),He=I(Ke)+I(Mt);ct<J?(J=ct,ee=q,ie=He<ie?He:ie):ct===J&&He<ie&&(ie=He,ee=q)}return ee||Z-z},d.prototype._chooseSplitAxis=function(k,z,Z){var ee=k.leaf?this.compareMinX:D,se=k.leaf?this.compareMinY:R;this._allDistMargin(k,z,Z,ee)<this._allDistMargin(k,z,Z,se)&&k.children.sort(ee)},d.prototype._allDistMargin=function(k,z,Z,ee){k.children.sort(ee);for(var se=this.toBBox,ue=a(k,0,z,se),Te=a(k,Z-z,Z,se),Q=M(ue)+M(Te),he=z;he<Z-z;he++){var ye=k.children[he];S(ue,k.leaf?se(ye):ye),Q+=M(ue)}for(var J=Z-z-1;J>=z;J--){var ie=k.children[J];S(Te,k.leaf?se(ie):ie),Q+=M(Te)}return Q},d.prototype._adjustParentBBoxes=function(k,z,Z){for(var ee=Z;ee>=0;ee--)S(z[ee],k)},d.prototype._condense=function(k){for(var z=k.length-1,Z=void 0;z>=0;z--)k[z].children.length===0?z>0?(Z=k[z-1].children).splice(Z.indexOf(k[z]),1):this.clear():w(k[z],this.toBBox)},d})})(DD);var u$=DD.exports,MT={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.earthRadius=63710088e-1,e.factors={centimeters:e.earthRadius*100,centimetres:e.earthRadius*100,degrees:e.earthRadius/111325,feet:e.earthRadius*3.28084,inches:e.earthRadius*39.37,kilometers:e.earthRadius/1e3,kilometres:e.earthRadius/1e3,meters:e.earthRadius,metres:e.earthRadius,miles:e.earthRadius/1609.344,millimeters:e.earthRadius*1e3,millimetres:e.earthRadius*1e3,nauticalmiles:e.earthRadius/1852,radians:1,yards:e.earthRadius*1.0936},e.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/e.earthRadius,yards:1.0936133},e.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function t(ye,J,ie){ie===void 0&&(ie={});var q={type:"Feature"};return(ie.id===0||ie.id)&&(q.id=ie.id),ie.bbox&&(q.bbox=ie.bbox),q.properties=J||{},q.geometry=ye,q}e.feature=t;function n(ye,J,ie){switch(ye){case"Point":return l(J).geometry;case"LineString":return w(J).geometry;case"Polygon":return d(J).geometry;case"MultiPoint":return R(J).geometry;case"MultiLineString":return D(J).geometry;case"MultiPolygon":return I(J).geometry;default:throw new Error(ye+" is invalid")}}e.geometry=n;function l(ye,J,ie){if(ie===void 0&&(ie={}),!ye)throw new Error("coordinates is required");if(!Array.isArray(ye))throw new Error("coordinates must be an Array");if(ye.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ue(ye[0])||!ue(ye[1]))throw new Error("coordinates must contain numbers");var q={type:"Point",coordinates:ye};return t(q,J,ie)}e.point=l;function c(ye,J,ie){return ie===void 0&&(ie={}),S(ye.map(function(q){return l(q,J)}),ie)}e.points=c;function d(ye,J,ie){ie===void 0&&(ie={});for(var q=0,Ke=ye;q<Ke.length;q++){var Mt=Ke[q];if(Mt.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var ct=0;ct<Mt[Mt.length-1].length;ct++)if(Mt[Mt.length-1][ct]!==Mt[0][ct])throw new Error("First and last Position are not equivalent.")}var He={type:"Polygon",coordinates:ye};return t(He,J,ie)}e.polygon=d;function _(ye,J,ie){return ie===void 0&&(ie={}),S(ye.map(function(q){return d(q,J)}),ie)}e.polygons=_;function w(ye,J,ie){if(ie===void 0&&(ie={}),ye.length<2)throw new Error("coordinates must be an array of two or more positions");var q={type:"LineString",coordinates:ye};return t(q,J,ie)}e.lineString=w;function a(ye,J,ie){return ie===void 0&&(ie={}),S(ye.map(function(q){return w(q,J)}),ie)}e.lineStrings=a;function S(ye,J){J===void 0&&(J={});var ie={type:"FeatureCollection"};return J.id&&(ie.id=J.id),J.bbox&&(ie.bbox=J.bbox),ie.features=ye,ie}e.featureCollection=S;function D(ye,J,ie){ie===void 0&&(ie={});var q={type:"MultiLineString",coordinates:ye};return t(q,J,ie)}e.multiLineString=D;function R(ye,J,ie){ie===void 0&&(ie={});var q={type:"MultiPoint",coordinates:ye};return t(q,J,ie)}e.multiPoint=R;function I(ye,J,ie){ie===void 0&&(ie={});var q={type:"MultiPolygon",coordinates:ye};return t(q,J,ie)}e.multiPolygon=I;function M(ye,J,ie){ie===void 0&&(ie={});var q={type:"GeometryCollection",geometries:ye};return t(q,J,ie)}e.geometryCollection=M;function N(ye,J){if(J===void 0&&(J=0),J&&!(J>=0))throw new Error("precision must be a positive number");var ie=Math.pow(10,J||0);return Math.round(ye*ie)/ie}e.round=N;function j(ye,J){J===void 0&&(J="kilometers");var ie=e.factors[J];if(!ie)throw new Error(J+" units is invalid");return ye*ie}e.radiansToLength=j;function W(ye,J){J===void 0&&(J="kilometers");var ie=e.factors[J];if(!ie)throw new Error(J+" units is invalid");return ye/ie}e.lengthToRadians=W;function B(ye,J){return z(W(ye,J))}e.lengthToDegrees=B;function k(ye){var J=ye%360;return J<0&&(J+=360),J}e.bearingToAzimuth=k;function z(ye){var J=ye%(2*Math.PI);return J*180/Math.PI}e.radiansToDegrees=z;function Z(ye){var J=ye%360;return J*Math.PI/180}e.degreesToRadians=Z;function ee(ye,J,ie){if(J===void 0&&(J="kilometers"),ie===void 0&&(ie="kilometers"),!(ye>=0))throw new Error("length must be a positive number");return j(W(ye,J),ie)}e.convertLength=ee;function se(ye,J,ie){if(J===void 0&&(J="meters"),ie===void 0&&(ie="kilometers"),!(ye>=0))throw new Error("area must be a positive number");var q=e.areaFactors[J];if(!q)throw new Error("invalid original units");var Ke=e.areaFactors[ie];if(!Ke)throw new Error("invalid final units");return ye/q*Ke}e.convertArea=se;function ue(ye){return!isNaN(ye)&&ye!==null&&!Array.isArray(ye)}e.isNumber=ue;function Te(ye){return!!ye&&ye.constructor===Object}e.isObject=Te;function Q(ye){if(!ye)throw new Error("bbox is required");if(!Array.isArray(ye))throw new Error("bbox must be an Array");if(ye.length!==4&&ye.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");ye.forEach(function(J){if(!ue(J))throw new Error("bbox must only contain numbers")})}e.validateBBox=Q;function he(ye){if(!ye)throw new Error("id is required");if(["string","number"].indexOf(typeof ye)===-1)throw new Error("id must be a number or a string")}e.validateId=he})(MT);var Li={};Object.defineProperty(Li,"__esModule",{value:!0});var ho=MT;function Om(e,t,n){if(e!==null)for(var l,c,d,_,w,a,S,D=0,R=0,I,M=e.type,N=M==="FeatureCollection",j=M==="Feature",W=N?e.features.length:1,B=0;B<W;B++){S=N?e.features[B].geometry:j?e.geometry:e,I=S?S.type==="GeometryCollection":!1,w=I?S.geometries.length:1;for(var k=0;k<w;k++){var z=0,Z=0;if(_=I?S.geometries[k]:S,_!==null){a=_.coordinates;var ee=_.type;switch(D=n&&(ee==="Polygon"||ee==="MultiPolygon")?1:0,ee){case null:break;case"Point":if(t(a,R,B,z,Z)===!1)return!1;R++,z++;break;case"LineString":case"MultiPoint":for(l=0;l<a.length;l++){if(t(a[l],R,B,z,Z)===!1)return!1;R++,ee==="MultiPoint"&&z++}ee==="LineString"&&z++;break;case"Polygon":case"MultiLineString":for(l=0;l<a.length;l++){for(c=0;c<a[l].length-D;c++){if(t(a[l][c],R,B,z,Z)===!1)return!1;R++}ee==="MultiLineString"&&z++,ee==="Polygon"&&Z++}ee==="Polygon"&&z++;break;case"MultiPolygon":for(l=0;l<a.length;l++){for(Z=0,c=0;c<a[l].length;c++){for(d=0;d<a[l][c].length-D;d++){if(t(a[l][c][d],R,B,z,Z)===!1)return!1;R++}Z++}z++}break;case"GeometryCollection":for(l=0;l<_.geometries.length;l++)if(Om(_.geometries[l],t,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function c$(e,t,n,l){var c=n;return Om(e,function(d,_,w,a,S){_===0&&n===void 0?c=d:c=t(c,d,_,w,a,S)},l),c}function RD(e,t){var n;switch(e.type){case"FeatureCollection":for(n=0;n<e.features.length&&t(e.features[n].properties,n)!==!1;n++);break;case"Feature":t(e.properties,0);break}}function h$(e,t,n){var l=n;return RD(e,function(c,d){d===0&&n===void 0?l=c:l=t(l,c,d)}),l}function zD(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var n=0;n<e.features.length&&t(e.features[n],n)!==!1;n++);}function f$(e,t,n){var l=n;return zD(e,function(c,d){d===0&&n===void 0?l=c:l=t(l,c,d)}),l}function d$(e){var t=[];return Om(e,function(n){t.push(n)}),t}function PT(e,t){var n,l,c,d,_,w,a,S,D,R,I=0,M=e.type==="FeatureCollection",N=e.type==="Feature",j=M?e.features.length:1;for(n=0;n<j;n++){for(w=M?e.features[n].geometry:N?e.geometry:e,S=M?e.features[n].properties:N?e.properties:{},D=M?e.features[n].bbox:N?e.bbox:void 0,R=M?e.features[n].id:N?e.id:void 0,a=w?w.type==="GeometryCollection":!1,_=a?w.geometries.length:1,c=0;c<_;c++){if(d=a?w.geometries[c]:w,d===null){if(t(null,I,S,D,R)===!1)return!1;continue}switch(d.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(d,I,S,D,R)===!1)return!1;break}case"GeometryCollection":{for(l=0;l<d.geometries.length;l++)if(t(d.geometries[l],I,S,D,R)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}I++}}function p$(e,t,n){var l=n;return PT(e,function(c,d,_,w,a){d===0&&n===void 0?l=c:l=t(l,c,d,_,w,a)}),l}function Av(e,t){PT(e,function(n,l,c,d,_){var w=n===null?null:n.type;switch(w){case null:case"Point":case"LineString":case"Polygon":return t(ho.feature(n,c,{bbox:d,id:_}),l,0)===!1?!1:void 0}var a;switch(w){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var S=0;S<n.coordinates.length;S++){var D=n.coordinates[S],R={type:a,coordinates:D};if(t(ho.feature(R,c),l,S)===!1)return!1}})}function m$(e,t,n){var l=n;return Av(e,function(c,d,_){d===0&&_===0&&n===void 0?l=c:l=t(l,c,d,_)}),l}function FD(e,t){Av(e,function(n,l,c){var d=0;if(n.geometry){var _=n.geometry.type;if(!(_==="Point"||_==="MultiPoint")){var w,a=0,S=0,D=0;if(Om(n,function(R,I,M,N,j){if(w===void 0||l>a||N>S||j>D){w=R,a=l,S=N,D=j,d=0;return}var W=ho.lineString([w,R],n.properties);if(t(W,l,c,j,d)===!1)return!1;d++,w=R})===!1)return!1}}})}function g$(e,t,n){var l=n,c=!1;return FD(e,function(d,_,w,a,S){c===!1&&n===void 0?l=d:l=t(l,d,_,w,a,S),c=!0}),l}function BD(e,t){if(!e)throw new Error("geojson is required");Av(e,function(n,l,c){if(n.geometry!==null){var d=n.geometry.type,_=n.geometry.coordinates;switch(d){case"LineString":if(t(n,l,c,0,0)===!1)return!1;break;case"Polygon":for(var w=0;w<_.length;w++)if(t(ho.lineString(_[w],n.properties),l,c,w)===!1)return!1;break}}})}function y$(e,t,n){var l=n;return BD(e,function(c,d,_,w){d===0&&n===void 0?l=c:l=t(l,c,d,_,w)}),l}function _$(e,t){if(t=t||{},!ho.isObject(t))throw new Error("options is invalid");var n=t.featureIndex||0,l=t.multiFeatureIndex||0,c=t.geometryIndex||0,d=t.segmentIndex||0,_=t.properties,w;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),_=_||e.features[n].properties,w=e.features[n].geometry;break;case"Feature":_=_||e.properties,w=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":w=e;break;default:throw new Error("geojson is invalid")}if(w===null)return null;var a=w.coordinates;switch(w.type){case"Point":case"MultiPoint":return null;case"LineString":return d<0&&(d=a.length+d-1),ho.lineString([a[d],a[d+1]],_,t);case"Polygon":return c<0&&(c=a.length+c),d<0&&(d=a[c].length+d-1),ho.lineString([a[c][d],a[c][d+1]],_,t);case"MultiLineString":return l<0&&(l=a.length+l),d<0&&(d=a[l].length+d-1),ho.lineString([a[l][d],a[l][d+1]],_,t);case"MultiPolygon":return l<0&&(l=a.length+l),c<0&&(c=a[l].length+c),d<0&&(d=a[l][c].length-d-1),ho.lineString([a[l][c][d],a[l][c][d+1]],_,t)}throw new Error("geojson is invalid")}function v$(e,t){if(t=t||{},!ho.isObject(t))throw new Error("options is invalid");var n=t.featureIndex||0,l=t.multiFeatureIndex||0,c=t.geometryIndex||0,d=t.coordIndex||0,_=t.properties,w;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),_=_||e.features[n].properties,w=e.features[n].geometry;break;case"Feature":_=_||e.properties,w=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":w=e;break;default:throw new Error("geojson is invalid")}if(w===null)return null;var a=w.coordinates;switch(w.type){case"Point":return ho.point(a,_,t);case"MultiPoint":return l<0&&(l=a.length+l),ho.point(a[l],_,t);case"LineString":return d<0&&(d=a.length+d),ho.point(a[d],_,t);case"Polygon":return c<0&&(c=a.length+c),d<0&&(d=a[c].length+d),ho.point(a[c][d],_,t);case"MultiLineString":return l<0&&(l=a.length+l),d<0&&(d=a[l].length+d),ho.point(a[l][d],_,t);case"MultiPolygon":return l<0&&(l=a.length+l),c<0&&(c=a[l].length+c),d<0&&(d=a[l][c].length-d),ho.point(a[l][c][d],_,t)}throw new Error("geojson is invalid")}Li.coordAll=d$;Li.coordEach=Om;Li.coordReduce=c$;Li.featureEach=zD;Li.featureReduce=f$;Li.findPoint=v$;Li.findSegment=_$;Li.flattenEach=Av;Li.flattenReduce=m$;Li.geomEach=PT;Li.geomReduce=p$;Li.lineEach=BD;Li.lineReduce=y$;Li.propEach=RD;Li.propReduce=h$;Li.segmentEach=FD;Li.segmentReduce=g$;const x$=Cm(BU);var ka=u$,ND=MT,UD=Li,Kh=x$.default,b$=UD.featureEach;UD.coordEach;ND.polygon;var MM=ND.featureCollection;function $D(e){var t=new ka(e);return t.insert=function(n){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:Kh(n),ka.prototype.insert.call(this,n)},t.load=function(n){var l=[];return Array.isArray(n)?n.forEach(function(c){if(c.type!=="Feature")throw new Error("invalid features");c.bbox=c.bbox?c.bbox:Kh(c),l.push(c)}):b$(n,function(c){if(c.type!=="Feature")throw new Error("invalid features");c.bbox=c.bbox?c.bbox:Kh(c),l.push(c)}),ka.prototype.load.call(this,l)},t.remove=function(n,l){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:Kh(n),ka.prototype.remove.call(this,n,l)},t.clear=function(){return ka.prototype.clear.call(this)},t.search=function(n){var l=ka.prototype.search.call(this,this.toBBox(n));return MM(l)},t.collides=function(n){return ka.prototype.collides.call(this,this.toBBox(n))},t.all=function(){var n=ka.prototype.all.call(this);return MM(n)},t.toJSON=function(){return ka.prototype.toJSON.call(this)},t.fromJSON=function(n){return ka.prototype.fromJSON.call(this,n)},t.toBBox=function(n){var l;if(n.bbox)l=n.bbox;else if(Array.isArray(n)&&n.length===4)l=n;else if(Array.isArray(n)&&n.length===6)l=[n[0],n[1],n[3],n[4]];else if(n.type==="Feature")l=Kh(n);else if(n.type==="FeatureCollection")l=Kh(n);else throw new Error("invalid geojson");return{minX:l[0],minY:l[1],maxX:l[2],maxY:l[3]}},t}IT.exports=$D;IT.exports.default=$D;var w$=IT.exports;const kT=Pu(w$);function jD(e,t){var n={},l=[];if(e.type==="LineString"&&(e=Hw(e)),t.type==="LineString"&&(t=Hw(t)),e.type==="Feature"&&t.type==="Feature"&&e.geometry!==null&&t.geometry!==null&&e.geometry.type==="LineString"&&t.geometry.type==="LineString"&&e.geometry.coordinates.length===2&&t.geometry.coordinates.length===2){var c=PM(e,t);return c&&l.push(c),AM(l)}var d=kT();return d.load(Kw(t)),IM(Kw(e),function(_){IM(d.search(_),function(w){var a=PM(_,w);if(a){var S=Ua(a).join(",");n[S]||(n[S]=!0,l.push(a))}})}),AM(l)}function PM(e,t){var n=Ua(e),l=Ua(t);if(n.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(l.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var c=n[0][0],d=n[0][1],_=n[1][0],w=n[1][1],a=l[0][0],S=l[0][1],D=l[1][0],R=l[1][1],I=(R-S)*(_-c)-(D-a)*(w-d),M=(D-a)*(d-S)-(R-S)*(c-a),N=(_-c)*(d-S)-(w-d)*(c-a);if(I===0)return null;var j=M/I,W=N/I;if(j>=0&&j<=1&&W>=0&&W<=1){var B=c+j*(_-c),k=d+j*(w-d);return t$([B,k])}return null}function N_(e,t,n){n===void 0&&(n={});var l={type:"Feature"};return(n.id===0||n.id)&&(l.id=n.id),n.bbox&&(l.bbox=n.bbox),l.properties=t||{},l.geometry=e,l}function c1(e,t,n){if(n===void 0&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!LM(e[0])||!LM(e[1]))throw new Error("coordinates must contain numbers");var l={type:"Point",coordinates:e};return N_(l,t,n)}function kM(e,t,n){if(n===void 0&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var l={type:"LineString",coordinates:e};return N_(l,t,n)}function LM(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function E$(e,t){var n,l,c,d,_,w,a,S,D,R,I=0,M=e.type==="FeatureCollection",N=e.type==="Feature",j=M?e.features.length:1;for(n=0;n<j;n++){for(w=M?e.features[n].geometry:N?e.geometry:e,S=M?e.features[n].properties:N?e.properties:{},D=M?e.features[n].bbox:N?e.bbox:void 0,R=M?e.features[n].id:N?e.id:void 0,a=w?w.type==="GeometryCollection":!1,_=a?w.geometries.length:1,c=0;c<_;c++){if(d=a?w.geometries[c]:w,d===null){if(t(null,I,S,D,R)===!1)return!1;continue}switch(d.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(d,I,S,D,R)===!1)return!1;break}case"GeometryCollection":{for(l=0;l<d.geometries.length;l++)if(t(d.geometries[l],I,S,D,R)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}I++}}function T$(e,t){E$(e,function(n,l,c,d,_){var w=n===null?null:n.type;switch(w){case null:case"Point":case"LineString":case"Polygon":return t(N_(n,c,{bbox:d,id:_}),l,0)===!1?!1:void 0}var a;switch(w){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var S=0;S<n.coordinates.length;S++){var D=n.coordinates[S],R={type:a,coordinates:D};if(t(N_(R,c),l,S)===!1)return!1}})}function S$(e,t,n){n===void 0&&(n={});var l=c1([1/0,1/0],{dist:1/0}),c=0;return T$(e,function(d){for(var _=Ua(d),w=0;w<_.length-1;w++){var a=c1(_[w]);a.properties.dist=$i(t,a,n);var S=c1(_[w+1]);S.properties.dist=$i(t,S,n);var D=$i(a,S,n),R=Math.max(a.properties.dist,S.properties.dist),I=Cu(a,S),M=za(t,R,I+90,n),N=za(t,R,I-90,n),j=jD(kM([M.geometry.coordinates,N.geometry.coordinates]),kM([a.geometry.coordinates,S.geometry.coordinates])),W=null;j.features.length>0&&(W=j.features[0],W.properties.dist=$i(t,W,n),W.properties.location=c+$i(a,W,n)),a.properties.dist<l.properties.dist&&(l=a,l.properties.index=w,l.properties.location=c),S.properties.dist<l.properties.dist&&(l=S,l.properties.index=w+1,l.properties.location=c+D),W&&W.properties.dist<l.properties.dist&&(l=W,l.properties.index=w),c+=D}}),l}var Ao=63710088e-1,VD={centimeters:Ao*100,centimetres:Ao*100,degrees:Ao/111325,feet:Ao*3.28084,inches:Ao*39.37,kilometers:Ao/1e3,kilometres:Ao/1e3,meters:Ao,metres:Ao,miles:Ao/1609.344,millimeters:Ao*1e3,millimetres:Ao*1e3,nauticalmiles:Ao/1852,radians:1,yards:Ao*1.0936};function A$(e,t){t===void 0&&(t="kilometers");var n=VD[t];if(!n)throw new Error(t+" units is invalid");return e*n}function C$(e,t){var n=VD[t];return e/n}function I$(e,t,n){if(n===void 0&&(n="kilometers"),!(e>=0))throw new Error("length must be a positive number");return A$(C$(e,t),n)}function M$(e,t,n){n===void 0&&(n={});var l=mo(e),c=mo(t);c[0]+=c[0]-l[0]>180?-360:l[0]-c[0]>180?360:0;var d=P$(l,c),_=I$(d,"meters",n.units);return _}function P$(e,t,n){n=n===void 0?Ao:Number(n);var l=n,c=e[1]*Math.PI/180,d=t[1]*Math.PI/180,_=d-c,w=Math.abs(t[0]-e[0])*Math.PI/180;w>Math.PI&&(w-=2*Math.PI);var a=Math.log(Math.tan(d/2+Math.PI/4)/Math.tan(c/2+Math.PI/4)),S=Math.abs(a)>1e-11?_/a:Math.cos(c),D=Math.sqrt(_*_+S*S*w*w),R=D*l;return R}function k$(e,t,n){n===void 0&&(n={});var l={type:"Feature"};return(n.id===0||n.id)&&(l.id=n.id),n.bbox&&(l.bbox=n.bbox),l.properties={},l.geometry=e,l}function OM(e,t,n){if(n===void 0&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!DM(e[0])||!DM(e[1]))throw new Error("coordinates must contain numbers");var l={type:"Point",coordinates:e};return k$(l,t,n)}function DM(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function RM(e,t,n){n===void 0&&(n={});for(var l=LD(e),c=l.coordinates,d=0,_=0;_<c.length&&!(t>=d&&_===c.length-1);_++)if(d>=t){var w=t-d;if(w){var a=Cu(c[_],c[_-1])-180,S=za(c[_],w,a,n);return S}else return OM(c[_])}else d+=$i(c[_],c[_+1],n);return OM(c[c.length-1])}function GD(e,t,n){if(e!==null)for(var l,c,d,_,w,a,S,D=0,R=0,I,M=e.type,N=M==="FeatureCollection",j=M==="Feature",W=N?e.features.length:1,B=0;B<W;B++){S=N?e.features[B].geometry:j?e.geometry:e,I=S?S.type==="GeometryCollection":!1,w=I?S.geometries.length:1;for(var k=0;k<w;k++){var z=0,Z=0;if(_=I?S.geometries[k]:S,_!==null){a=_.coordinates;var ee=_.type;switch(D=0,ee){case null:break;case"Point":if(t(a,R,B,z,Z)===!1)return!1;R++,z++;break;case"LineString":case"MultiPoint":for(l=0;l<a.length;l++){if(t(a[l],R,B,z,Z)===!1)return!1;R++,ee==="MultiPoint"&&z++}ee==="LineString"&&z++;break;case"Polygon":case"MultiLineString":for(l=0;l<a.length;l++){for(c=0;c<a[l].length-D;c++){if(t(a[l][c],R,B,z,Z)===!1)return!1;R++}ee==="MultiLineString"&&z++,ee==="Polygon"&&Z++}ee==="Polygon"&&z++;break;case"MultiPolygon":for(l=0;l<a.length;l++){for(Z=0,c=0;c<a[l].length;c++){for(d=0;d<a[l][c].length-D;d++){if(t(a[l][c][d],R,B,z,Z)===!1)return!1;R++}Z++}z++}break;case"GeometryCollection":for(l=0;l<_.geometries.length;l++)if(GD(_.geometries[l],t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function L$(e,t){t===void 0&&(t={});var n=t.precision,l=t.coordinates,c=t.mutate;if(n=n==null||isNaN(n)?6:n,l=l==null||isNaN(l)?3:l,!e)throw new Error("<geojson> is required");if(typeof n!="number")throw new Error("<precision> must be a number");if(typeof l!="number")throw new Error("<coordinates> must be a number");(c===!1||c===void 0)&&(e=JSON.parse(JSON.stringify(e)));var d=Math.pow(10,n);return GD(e,function(_){O$(_,d,l)}),e}function O$(e,t,n){e.length>n&&e.splice(n,e.length);for(var l=0;l<e.length;l++)e[l]=Math.round(e[l]*t)/t;return e}function Yw(e,t,n){n===void 0&&(n={});var l={type:"Feature"};return(n.id===0||n.id)&&(l.id=n.id),n.bbox&&(l.bbox=n.bbox),l.properties=t||{},l.geometry=e,l}function zM(e,t,n){if(n===void 0&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var l={type:"LineString",coordinates:e};return Yw(l,t,n)}function Qp(e,t){t===void 0&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function LT(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var n=0;n<e.features.length&&t(e.features[n],n)!==!1;n++);}function D$(e,t,n){var l=n;return LT(e,function(c,d){d===0&&n===void 0?l=c:l=t(l,c,d)}),l}function R$(e,t){var n,l,c,d,_,w,a,S,D,R,I=0,M=e.type==="FeatureCollection",N=e.type==="Feature",j=M?e.features.length:1;for(n=0;n<j;n++){for(w=M?e.features[n].geometry:N?e.geometry:e,S=M?e.features[n].properties:N?e.properties:{},D=M?e.features[n].bbox:N?e.bbox:void 0,R=M?e.features[n].id:N?e.id:void 0,a=w?w.type==="GeometryCollection":!1,_=a?w.geometries.length:1,c=0;c<_;c++){if(d=a?w.geometries[c]:w,d===null){if(t(null,I,S,D,R)===!1)return!1;continue}switch(d.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(d,I,S,D,R)===!1)return!1;break}case"GeometryCollection":{for(l=0;l<d.geometries.length;l++)if(t(d.geometries[l],I,S,D,R)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}I++}}function z$(e,t){R$(e,function(n,l,c,d,_){var w=n===null?null:n.type;switch(w){case null:case"Point":case"LineString":case"Polygon":return t(Yw(n,c,{bbox:d,id:_}),l,0)===!1?!1:void 0}var a;switch(w){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var S=0;S<n.coordinates.length;S++){var D=n.coordinates[S],R={type:a,coordinates:D};if(t(Yw(R,c),l,S)===!1)return!1}})}function F$(e,t){if(!e)throw new Error("line is required");if(!t)throw new Error("splitter is required");var n=vM(e),l=vM(t);if(n!=="LineString")throw new Error("line must be LineString");if(l==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(l==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var c=L$(t,{precision:7});switch(l){case"Point":return Jw(e,c);case"MultiPoint":return FM(e,c);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return FM(e,jD(e,c))}}function FM(e,t){var n=[],l=kT();return z$(t,function(c){if(n.forEach(function(w,a){w.id=a}),!n.length)n=Jw(e,c).features,n.forEach(function(w){w.bbox||(w.bbox=VU(Uf(w)))}),l.load(Qp(n));else{var d=l.search(c);if(d.features.length){var _=qD(c,d);n=n.filter(function(w){return w.id!==_.id}),l.remove(_),LT(Jw(_,c),function(w){n.push(w),l.insert(w)})}}}),Qp(n)}function Jw(e,t){var n=[],l=Ua(e)[0],c=Ua(e)[e.geometry.coordinates.length-1];if(h1(l,mo(t))||h1(c,mo(t)))return Qp([e]);var d=kT(),_=Kw(e);d.load(_);var w=d.search(t);if(!w.features.length)return Qp([e]);var a=qD(t,w),S=[l],D=D$(_,function(R,I,M){var N=Ua(I)[1],j=mo(t);return M===a.id?(R.push(j),n.push(zM(R)),h1(j,N)?[j]:[j,N]):(R.push(N),R)},S);return D.length>1&&n.push(zM(D)),Qp(n)}function qD(e,t){if(!t.features.length)throw new Error("lines must contain features");if(t.features.length===1)return t.features[0];var n,l=1/0;return LT(t,function(c){var d=S$(c,e),_=d.properties.dist;_<l&&(n=c,l=_)}),n}function h1(e,t){return e[0]===t[0]&&e[1]===t[1]}var BM=Object.prototype.toString,WD=function(t){var n=BM.call(t),l=n==="[object Arguments]";return l||(l=n!=="[object Array]"&&t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&BM.call(t.callee)==="[object Function]"),l},f1,NM;function B$(){if(NM)return f1;NM=1;var e;if(!Object.keys){var t=Object.prototype.hasOwnProperty,n=Object.prototype.toString,l=WD,c=Object.prototype.propertyIsEnumerable,d=!c.call({toString:null},"toString"),_=c.call(function(){},"prototype"),w=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],a=function(I){var M=I.constructor;return M&&M.prototype===I},S={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},D=function(){if(typeof window>"u")return!1;for(var I in window)try{if(!S["$"+I]&&t.call(window,I)&&window[I]!==null&&typeof window[I]=="object")try{a(window[I])}catch{return!0}}catch{return!0}return!1}(),R=function(I){if(typeof window>"u"||!D)return a(I);try{return a(I)}catch{return!1}};e=function(M){var N=M!==null&&typeof M=="object",j=n.call(M)==="[object Function]",W=l(M),B=N&&n.call(M)==="[object String]",k=[];if(!N&&!j&&!W)throw new TypeError("Object.keys called on a non-object");var z=_&&j;if(B&&M.length>0&&!t.call(M,0))for(var Z=0;Z<M.length;++Z)k.push(String(Z));if(W&&M.length>0)for(var ee=0;ee<M.length;++ee)k.push(String(ee));else for(var se in M)!(z&&se==="prototype")&&t.call(M,se)&&k.push(String(se));if(d)for(var ue=R(M),Te=0;Te<w.length;++Te)!(ue&&w[Te]==="constructor")&&t.call(M,w[Te])&&k.push(w[Te]);return k}}return f1=e,f1}var N$=Array.prototype.slice,U$=WD,UM=Object.keys,n_=UM?function(t){return UM(t)}:B$(),$M=Object.keys;n_.shim=function(){if(Object.keys){var t=function(){var n=Object.keys(arguments);return n&&n.length===arguments.length}(1,2);t||(Object.keys=function(l){return U$(l)?$M(N$.call(l)):$M(l)})}else Object.keys=n_;return Object.keys||n_};var $$=n_,OT=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},n=Symbol("test"),l=Object(n);if(typeof n=="string"||Object.prototype.toString.call(n)!=="[object Symbol]"||Object.prototype.toString.call(l)!=="[object Symbol]")return!1;var c=42;t[n]=c;for(var d in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var _=Object.getOwnPropertySymbols(t);if(_.length!==1||_[0]!==n||!Object.prototype.propertyIsEnumerable.call(t,n))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var w=Object.getOwnPropertyDescriptor(t,n);if(w.value!==c||w.enumerable!==!0)return!1}return!0},j$=OT,Ml=function(){return j$()&&!!Symbol.toStringTag},DT=Object,V$=Error,G$=EvalError,RT=RangeError,q$=ReferenceError,pa=SyntaxError,Tr=TypeError,W$=URIError,Cv=Math.abs,Wc=Math.floor,zT=Math.max,FT=Math.min,Zc=Math.pow,Z$=Math.round,Hc=Number.isNaN||function(t){return t!==t},H$=Hc,X$=function(t){return H$(t)||t===0?t:t<0?-1:1},K$=Object.getOwnPropertyDescriptor,i_=K$;if(i_)try{i_([],"length")}catch{i_=null}var Pl=i_,o_=Object.defineProperty||!1;if(o_)try{o_({},"a",{value:1})}catch{o_=!1}var Dm=o_,d1,jM;function ZD(){if(jM)return d1;jM=1;var e=typeof Symbol<"u"&&Symbol,t=OT;return d1=function(){return typeof e!="function"||typeof Symbol!="function"||typeof e("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:t()},d1}var HD=typeof Reflect<"u"&&Reflect.getPrototypeOf||null,Y$=DT,XD=Y$.getPrototypeOf||null,J$="Function.prototype.bind called on incompatible ",Q$=Object.prototype.toString,e8=Math.max,t8="[object Function]",VM=function(t,n){for(var l=[],c=0;c<t.length;c+=1)l[c]=t[c];for(var d=0;d<n.length;d+=1)l[d+t.length]=n[d];return l},r8=function(t,n){for(var l=[],c=n,d=0;c<t.length;c+=1,d+=1)l[d]=t[c];return l},n8=function(e,t){for(var n="",l=0;l<e.length;l+=1)n+=e[l],l+1<e.length&&(n+=t);return n},i8=function(t){var n=this;if(typeof n!="function"||Q$.apply(n)!==t8)throw new TypeError(J$+n);for(var l=r8(arguments,1),c,d=function(){if(this instanceof c){var D=n.apply(this,VM(l,arguments));return Object(D)===D?D:this}return n.apply(t,VM(l,arguments))},_=e8(0,n.length-l.length),w=[],a=0;a<_;a++)w[a]="$"+a;if(c=Function("binder","return function ("+n8(w,",")+"){ return binder.apply(this,arguments); }")(d),n.prototype){var S=function(){};S.prototype=n.prototype,c.prototype=new S,S.prototype=null}return c},o8=i8,Rm=Function.prototype.bind||o8,BT=Function.prototype.call,NT=Function.prototype.apply,s8=typeof Reflect<"u"&&Reflect&&Reflect.apply,a8=Rm,l8=NT,u8=BT,c8=s8,KD=c8||a8.call(u8,l8),h8=Rm,f8=Tr,d8=BT,p8=KD,UT=function(t){if(t.length<1||typeof t[0]!="function")throw new f8("a function is required");return p8(h8,d8,t)},m8=UT,GM=Pl,YD;try{YD=[].__proto__===Array.prototype}catch(e){if(!e||typeof e!="object"||!("code"in e)||e.code!=="ERR_PROTO_ACCESS")throw e}var p1=!!YD&&GM&&GM(Object.prototype,"__proto__"),JD=Object,qM=JD.getPrototypeOf,g8=p1&&typeof p1.get=="function"?m8([p1.get]):typeof qM=="function"?function(t){return qM(t==null?t:JD(t))}:!1,WM=HD,ZM=XD,HM=g8,Xc=WM?function(t){return WM(t)}:ZM?function(t){if(!t||typeof t!="object"&&typeof t!="function")throw new TypeError("getProto: not an object");return ZM(t)}:HM?function(t){return HM(t)}:null,y8=Function.prototype.call,_8=Object.prototype.hasOwnProperty,v8=Rm,kl=v8.call(y8,_8),Dr,x8=DT,b8=V$,w8=G$,E8=RT,T8=q$,$f=pa,If=Tr,S8=W$,A8=Cv,C8=Wc,I8=zT,M8=FT,P8=Zc,k8=Z$,L8=X$,QD=Function,m1=function(e){try{return QD('"use strict"; return ('+e+").constructor;")()}catch{}},Em=Pl,O8=Dm,g1=function(){throw new If},D8=Em?function(){try{return arguments.callee,g1}catch{try{return Em(arguments,"callee").get}catch{return g1}}}():g1,Yh=ZD()(),Ni=Xc,R8=XD,z8=HD,eR=NT,zm=BT,of={},F8=typeof Uint8Array>"u"||!Ni?Dr:Ni(Uint8Array),Fc={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?Dr:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Dr:ArrayBuffer,"%ArrayIteratorPrototype%":Yh&&Ni?Ni([][Symbol.iterator]()):Dr,"%AsyncFromSyncIteratorPrototype%":Dr,"%AsyncFunction%":of,"%AsyncGenerator%":of,"%AsyncGeneratorFunction%":of,"%AsyncIteratorPrototype%":of,"%Atomics%":typeof Atomics>"u"?Dr:Atomics,"%BigInt%":typeof BigInt>"u"?Dr:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Dr:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Dr:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Dr:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":b8,"%eval%":eval,"%EvalError%":w8,"%Float16Array%":typeof Float16Array>"u"?Dr:Float16Array,"%Float32Array%":typeof Float32Array>"u"?Dr:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Dr:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Dr:FinalizationRegistry,"%Function%":QD,"%GeneratorFunction%":of,"%Int8Array%":typeof Int8Array>"u"?Dr:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Dr:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Dr:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Yh&&Ni?Ni(Ni([][Symbol.iterator]())):Dr,"%JSON%":typeof JSON=="object"?JSON:Dr,"%Map%":typeof Map>"u"?Dr:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Yh||!Ni?Dr:Ni(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":x8,"%Object.getOwnPropertyDescriptor%":Em,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Dr:Promise,"%Proxy%":typeof Proxy>"u"?Dr:Proxy,"%RangeError%":E8,"%ReferenceError%":T8,"%Reflect%":typeof Reflect>"u"?Dr:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Dr:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Yh||!Ni?Dr:Ni(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Dr:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Yh&&Ni?Ni(""[Symbol.iterator]()):Dr,"%Symbol%":Yh?Symbol:Dr,"%SyntaxError%":$f,"%ThrowTypeError%":D8,"%TypedArray%":F8,"%TypeError%":If,"%Uint8Array%":typeof Uint8Array>"u"?Dr:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Dr:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Dr:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Dr:Uint32Array,"%URIError%":S8,"%WeakMap%":typeof WeakMap>"u"?Dr:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Dr:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Dr:WeakSet,"%Function.prototype.call%":zm,"%Function.prototype.apply%":eR,"%Object.defineProperty%":O8,"%Object.getPrototypeOf%":R8,"%Math.abs%":A8,"%Math.floor%":C8,"%Math.max%":I8,"%Math.min%":M8,"%Math.pow%":P8,"%Math.round%":k8,"%Math.sign%":L8,"%Reflect.getPrototypeOf%":z8};if(Ni)try{null.error}catch(e){var B8=Ni(Ni(e));Fc["%Error.prototype%"]=B8}var N8=function e(t){var n;if(t==="%AsyncFunction%")n=m1("async function () {}");else if(t==="%GeneratorFunction%")n=m1("function* () {}");else if(t==="%AsyncGeneratorFunction%")n=m1("async function* () {}");else if(t==="%AsyncGenerator%"){var l=e("%AsyncGeneratorFunction%");l&&(n=l.prototype)}else if(t==="%AsyncIteratorPrototype%"){var c=e("%AsyncGenerator%");c&&Ni&&(n=Ni(c.prototype))}return Fc[t]=n,n},XM={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Fm=Rm,U_=kl,U8=Fm.call(zm,Array.prototype.concat),$8=Fm.call(eR,Array.prototype.splice),KM=Fm.call(zm,String.prototype.replace),$_=Fm.call(zm,String.prototype.slice),j8=Fm.call(zm,RegExp.prototype.exec),V8=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,G8=/\\(\\)?/g,q8=function(t){var n=$_(t,0,1),l=$_(t,-1);if(n==="%"&&l!=="%")throw new $f("invalid intrinsic syntax, expected closing `%`");if(l==="%"&&n!=="%")throw new $f("invalid intrinsic syntax, expected opening `%`");var c=[];return KM(t,V8,function(d,_,w,a){c[c.length]=w?KM(a,G8,"$1"):_||d}),c},W8=function(t,n){var l=t,c;if(U_(XM,l)&&(c=XM[l],l="%"+c[0]+"%"),U_(Fc,l)){var d=Fc[l];if(d===of&&(d=N8(l)),typeof d>"u"&&!n)throw new If("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:c,name:l,value:d}}throw new $f("intrinsic "+t+" does not exist!")},On=function(t,n){if(typeof t!="string"||t.length===0)throw new If("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof n!="boolean")throw new If('"allowMissing" argument must be a boolean');if(j8(/^%?[^%]*%?$/,t)===null)throw new $f("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var l=q8(t),c=l.length>0?l[0]:"",d=W8("%"+c+"%",n),_=d.name,w=d.value,a=!1,S=d.alias;S&&(c=S[0],$8(l,U8([0,1],S)));for(var D=1,R=!0;D<l.length;D+=1){var I=l[D],M=$_(I,0,1),N=$_(I,-1);if((M==='"'||M==="'"||M==="`"||N==='"'||N==="'"||N==="`")&&M!==N)throw new $f("property names with quotes must have matching quotes");if((I==="constructor"||!R)&&(a=!0),c+="."+I,_="%"+c+"%",U_(Fc,_))w=Fc[_];else if(w!=null){if(!(I in w)){if(!n)throw new If("base intrinsic for "+t+" exists, but the property is not available.");return}if(Em&&D+1>=l.length){var j=Em(w,I);R=!!j,R&&"get"in j&&!("originalValue"in j.get)?w=j.get:w=w[I]}else R=U_(w,I),w=w[I];R&&!a&&(Fc[_]=w)}}return w},tR=On,rR=UT,Z8=rR([tR("%String.prototype.indexOf%")]),sn=function(t,n){var l=tR(t,!!n);return typeof l=="function"&&Z8(t,".prototype.")>-1?rR([l]):l},YM=Dm,H8=pa,Jh=Tr,JM=Pl,$T=function(t,n,l){if(!t||typeof t!="object"&&typeof t!="function")throw new Jh("`obj` must be an object or a function`");if(typeof n!="string"&&typeof n!="symbol")throw new Jh("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new Jh("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new Jh("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new Jh("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new Jh("`loose`, if provided, must be a boolean");var c=arguments.length>3?arguments[3]:null,d=arguments.length>4?arguments[4]:null,_=arguments.length>5?arguments[5]:null,w=arguments.length>6?arguments[6]:!1,a=!!JM&&JM(t,n);if(YM)YM(t,n,{configurable:_===null&&a?a.configurable:!_,enumerable:c===null&&a?a.enumerable:!c,value:l,writable:d===null&&a?a.writable:!d});else if(w||!c&&!d&&!_)t[n]=l;else throw new H8("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Qw=Dm,nR=function(){return!!Qw};nR.hasArrayLengthDefineBug=function(){if(!Qw)return null;try{return Qw([],"length",{value:1}).length!==1}catch{return!0}};var Iv=nR,X8=$$,K8=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",Y8=Object.prototype.toString,J8=Array.prototype.concat,QM=$T,Q8=function(e){return typeof e=="function"&&Y8.call(e)==="[object Function]"},iR=Iv(),ej=function(e,t,n,l){if(t in e){if(l===!0){if(e[t]===n)return}else if(!Q8(l)||!l())return}iR?QM(e,t,n,!0):QM(e,t,n)},oR=function(e,t){var n=arguments.length>2?arguments[2]:{},l=X8(t);K8&&(l=J8.call(l,Object.getOwnPropertySymbols(t)));for(var c=0;c<l.length;c+=1)ej(e,l[c],t[l[c]],n[l[c]])};oR.supportsDescriptors=!!iR;var Bm=oR,sR={exports:{}},tj=On,eP=$T,rj=Iv(),tP=Pl,rP=Tr,nj=tj("%Math.floor%"),ij=function(t,n){if(typeof t!="function")throw new rP("`fn` is not a function");if(typeof n!="number"||n<0||n>4294967295||nj(n)!==n)throw new rP("`length` must be a positive 32-bit integer");var l=arguments.length>2&&!!arguments[2],c=!0,d=!0;if("length"in t&&tP){var _=tP(t,"length");_&&!_.configurable&&(c=!1),_&&!_.writable&&(d=!1)}return(c||d||!l)&&(rj?eP(t,"length",n,!0,!0):eP(t,"length",n)),t},oj=Rm,sj=NT,aj=KD,lj=function(){return aj(oj,sj,arguments)};(function(e){var t=ij,n=Dm,l=UT,c=lj;e.exports=function(_){var w=l(arguments),a=_.length-(arguments.length-1);return t(w,1+(a>0?a:0),!0)},n?n(e.exports,"apply",{value:c}):e.exports.apply=c})(sR);var Du=sR.exports,nP=sn,uj=Ml(),cj=kl,hj=Pl,eE;if(uj){var fj=nP("RegExp.prototype.exec"),iP={},y1=function(){throw iP},oP={toString:y1,valueOf:y1};typeof Symbol.toPrimitive=="symbol"&&(oP[Symbol.toPrimitive]=y1),eE=function(t){if(!t||typeof t!="object")return!1;var n=hj(t,"lastIndex"),l=n&&cj(n,"value");if(!l)return!1;try{fj(t,oP)}catch(c){return c===iP}}}else{var dj=nP("Object.prototype.toString"),pj="[object RegExp]";eE=function(t){return!t||typeof t!="object"&&typeof t!="function"?!1:dj(t)===pj}}var aR=eE,Tm=function(){return typeof(function(){}).name=="string"},em=Object.getOwnPropertyDescriptor;if(em)try{em([],"length")}catch{em=null}Tm.functionsHaveConfigurableNames=function(){if(!Tm()||!em)return!1;var t=em(function(){},"name");return!!t&&!!t.configurable};var mj=Function.prototype.bind;Tm.boundFunctionsHaveNames=function(){return Tm()&&typeof mj=="function"&&(function(){}).bind().name!==""};var lR=Tm,uR=sn,gj=uR("Date.prototype.getDay"),yj=function(t){try{return gj(t),!0}catch{return!1}},_j=uR("Object.prototype.toString"),vj="[object Date]",xj=Ml(),cR=function(t){return typeof t!="object"||t===null?!1:xj?yj(t):_j(t)===vj};function bj(e){var t=e%(2*Math.PI);return t*180/Math.PI}function _1(e){var t=e%360;return t*Math.PI/180}function wj(e,t,n){n===void 0&&(n={});var l;n.final?l=sP(mo(t),mo(e)):l=sP(mo(e),mo(t));var c=l>180?-(360-l):l;return c}function sP(e,t){var n=_1(e[1]),l=_1(t[1]),c=_1(t[0]-e[0]);c>Math.PI&&(c-=2*Math.PI),c<-Math.PI&&(c+=2*Math.PI);var d=Math.log(Math.tan(l/2+Math.PI/4)/Math.tan(n/2+Math.PI/4)),_=Math.atan2(c,d);return(bj(_)+360)%360}var Co=63710088e-1,hR={centimeters:Co*100,centimetres:Co*100,degrees:Co/111325,feet:Co*3.28084,inches:Co*39.37,kilometers:Co/1e3,kilometres:Co/1e3,meters:Co,metres:Co,miles:Co/1609.344,millimeters:Co*1e3,millimetres:Co*1e3,nauticalmiles:Co/1852,radians:1,yards:Co*1.0936};function Ej(e,t,n){n===void 0&&(n={});var l={type:"Feature"};return(n.id===0||n.id)&&(l.id=n.id),n.bbox&&(l.bbox=n.bbox),l.properties=t||{},l.geometry=e,l}function Tj(e,t,n){if(n===void 0&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!lP(e[0])||!lP(e[1]))throw new Error("coordinates must contain numbers");var l={type:"Point",coordinates:e};return Ej(l,t,n)}function Sj(e,t){var n=hR[t];return e*n}function Aj(e,t){t===void 0&&(t="kilometers");var n=hR[t];if(!n)throw new Error(t+" units is invalid");return e/n}function aP(e){var t=e%360;return t*Math.PI/180}function Cj(e,t,n){if(t===void 0&&(t="kilometers"),!(e>=0))throw new Error("length must be a positive number");return Sj(Aj(e,t),n)}function lP(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Ij(e,t,n,l){l===void 0&&(l={});var c=t<0,d=Cj(Math.abs(t),l.units,"meters");c&&(d=-Math.abs(d));var _=mo(e),w=Mj(_,d,n);return w[0]+=w[0]-_[0]>180?-360:_[0]-w[0]>180?360:0,Tj(w,l.properties)}function Mj(e,t,n,l){l=l===void 0?Co:Number(l);var c=t/l,d=e[0]*Math.PI/180,_=aP(e[1]),w=aP(n),a=c*Math.cos(w),S=_+a;Math.abs(S)>Math.PI/2&&(S=S>0?Math.PI-S:-Math.PI-S);var D=Math.log(Math.tan(S/2+Math.PI/4)/Math.tan(_/2+Math.PI/4)),R=Math.abs(D)>1e-11?a/D:Math.cos(_),I=c*Math.sin(w)/R,M=d+I;return[(M*180/Math.PI+540)%360-180,S*180/Math.PI]}function Pj(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return fR(e);case"FeatureCollection":return kj(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return jT(e);default:throw new Error("unknown GeoJSON type")}}function fR(e){var t={type:"Feature"};return Object.keys(e).forEach(function(n){switch(n){case"type":case"properties":case"geometry":return;default:t[n]=e[n]}}),t.properties=dR(e.properties),t.geometry=jT(e.geometry),t}function dR(e){var t={};return e&&Object.keys(e).forEach(function(n){var l=e[n];typeof l=="object"?l===null?t[n]=null:Array.isArray(l)?t[n]=l.map(function(c){return c}):t[n]=dR(l):t[n]=l}),t}function kj(e){var t={type:"FeatureCollection"};return Object.keys(e).forEach(function(n){switch(n){case"type":case"features":return;default:t[n]=e[n]}}),t.features=e.features.map(function(n){return fR(n)}),t}function jT(e){var t={type:e.type};return e.bbox&&(t.bbox=e.bbox),e.type==="GeometryCollection"?(t.geometries=e.geometries.map(function(n){return jT(n)}),t):(t.coordinates=pR(e.coordinates),t)}function pR(e){var t=e;return typeof t[0]!="object"?t.slice():t.map(function(n){return pR(n)})}function Lj(e){return!!e&&e.constructor===Object}function mR(e,t,n){if(e!==null)for(var l,c,d,_,w,a,S,D=0,R=0,I,M=e.type,N=M==="FeatureCollection",j=M==="Feature",W=N?e.features.length:1,B=0;B<W;B++){S=N?e.features[B].geometry:j?e.geometry:e,I=S?S.type==="GeometryCollection":!1,w=I?S.geometries.length:1;for(var k=0;k<w;k++){var z=0,Z=0;if(_=I?S.geometries[k]:S,_!==null){a=_.coordinates;var ee=_.type;switch(D=0,ee){case null:break;case"Point":if(t(a,R,B,z,Z)===!1)return!1;R++,z++;break;case"LineString":case"MultiPoint":for(l=0;l<a.length;l++){if(t(a[l],R,B,z,Z)===!1)return!1;R++,ee==="MultiPoint"&&z++}ee==="LineString"&&z++;break;case"Polygon":case"MultiLineString":for(l=0;l<a.length;l++){for(c=0;c<a[l].length-D;c++){if(t(a[l][c],R,B,z,Z)===!1)return!1;R++}ee==="MultiLineString"&&z++,ee==="Polygon"&&Z++}ee==="Polygon"&&z++;break;case"MultiPolygon":for(l=0;l<a.length;l++){for(Z=0,c=0;c<a[l].length;c++){for(d=0;d<a[l][c].length-D;d++){if(t(a[l][c][d],R,B,z,Z)===!1)return!1;R++}Z++}z++}break;case"GeometryCollection":for(l=0;l<_.geometries.length;l++)if(mR(_.geometries[l],t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function uP(e,t,n){if(n=n||{},!Lj(n))throw new Error("options is invalid");var l=n.pivot,c=n.mutate;if(!e)throw new Error("geojson is required");if(t==null||isNaN(t))throw new Error("angle is required");return t===0||(l||(l=Cf(e)),(c===!1||c===void 0)&&(e=Pj(e)),mR(e,function(d){var _=wj(l,d),w=_+t,a=M$(l,d),S=Ua(Ij(l,a,w));d[0]=S[0],d[1]=S[1]})),e}function VT(e,t,n){n===void 0&&(n={});var l={type:"Feature"};return(n.id===0||n.id)&&(l.id=n.id),n.bbox&&(l.bbox=n.bbox),l.properties=t||{},l.geometry=e,l}function po(e,t,n){if(n===void 0&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!hP(e[0])||!hP(e[1]))throw new Error("coordinates must contain numbers");var l={type:"Point",coordinates:e};return VT(l,t,n)}function Oj(e,t,n){return n===void 0&&(n={}),Rj(e.map(function(l){return po(l,t)}),n)}function Dj(e,t,n){n===void 0&&(n={});for(var l=0,c=e;l<c.length;l++){var d=c[l];if(d.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var _=0;_<d[d.length-1].length;_++)if(d[d.length-1][_]!==d[0][_])throw new Error("First and last Position are not equivalent.")}var w={type:"Polygon",coordinates:e};return VT(w,t,n)}function cP(e,t,n){if(n===void 0&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var l={type:"LineString",coordinates:e};return VT(l,t,n)}function Rj(e,t){t===void 0&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function hP(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}var gR={exports:{}};(function(e,t){var n={};(function(l,c){e.exports=c()})(Am,function(){var l,c,d;function _(a,S){if(!l)l=S;else if(!c)c=S;else{var D="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+l+")(sharedChunk); ("+c+")(sharedChunk); self.onerror = null;",R={};l(R),d=S(R),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(d.workerUrl=window.URL.createObjectURL(new Blob([D],{type:"text/javascript"})))}}_(["exports"],function(a){var S=typeof self<"u"?self:{},D="2.15.0";let R;const I={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(R==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{R=n.API_URL_REGEX!=null?new RegExp(n.API_URL_REGEX):i}catch{R=i}}return R},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!I.API_URL)return null;try{const i=new URL(I.API_URL);return i.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":i.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},M={supported:!1,testSupport:function(i){!W&&j&&(B?k(i):N=i)}};let N,j,W=!1,B=!1;function k(i){const r=i.createTexture();i.bindTexture(i.TEXTURE_2D,r);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,j),i.isContextLost())return;M.supported=!0}catch{}i.deleteTexture(r),W=!0}S.document&&(j=S.document.createElement("img"),j.onload=function(){N&&k(N),N=null,B=!0},j.onerror=function(){W=!0,N=null},j.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const z="01";function Z(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ee=se;function se(i,r,o,u){this.cx=3*i,this.bx=3*(o-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(u-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=r,this.p2x=o,this.p2y=u}se.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,r){if(r===void 0&&(r=1e-6),i<0)return 0;if(i>1)return 1;for(var o=i,u=0;u<8;u++){var f=this.sampleCurveX(o)-i;if(Math.abs(f)<r)return o;var m=this.sampleCurveDerivativeX(o);if(Math.abs(m)<1e-6)break;o-=f/m}var y=0,x=1;for(o=i,u=0;u<20&&(f=this.sampleCurveX(o),!(Math.abs(f-i)<r));u++)i>f?y=o:x=o,o=.5*(x-y)+y;return o},solve:function(i,r){return this.sampleCurveY(this.solveCurveX(i,r))}};var ue=Z(ee),Te=Q;function Q(i,r){this.x=i,this.y=r}Q.prototype={clone:function(){return new Q(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,r){return this.clone()._rotateAround(i,r)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var r=i.x-this.x,o=i.y-this.y;return r*r+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,r){return Math.atan2(this.x*r-this.y*i,this.x*i+this.y*r)},_matMult:function(i){var r=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=r,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var r=Math.cos(i),o=Math.sin(i),u=o*this.x+r*this.y;return this.x=r*this.x-o*this.y,this.y=u,this},_rotateAround:function(i,r){var o=Math.cos(i),u=Math.sin(i),f=r.y+u*(this.x-r.x)+o*(this.y-r.y);return this.x=r.x+o*(this.x-r.x)-u*(this.y-r.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Q.convert=function(i){return i instanceof Q?i:Array.isArray(i)?new Q(i[0],i[1]):i};var he=Z(Te);const ye=Math.PI/180,J=180/Math.PI;function ie(i){return i*ye}function q(i){return i*J}const Ke=[[0,0],[1,0],[1,1],[0,1]];function Mt(i){if(i<=0)return 0;if(i>=1)return 1;const r=i*i,o=r*i;return 4*(i<.5?o:3*(i-r)+o-.75)}function ct(i,r,o,u){const f=new ue(i,r,o,u);return function(m){return f.solve(m)}}const He=ct(.25,.1,.25,1);function _e(i,r,o){return Math.min(o,Math.max(r,i))}function qe(i,r,o){return(o=_e((o-i)/(r-i),0,1))*o*(3-2*o)}function Pe(i,r,o){const u=o-r,f=((i-r)%u+u)%u+r;return f===r?o:f}function Le(i,r,o){if(!i.length)return o(null,[]);let u=i.length;const f=new Array(i.length);let m=null;i.forEach((y,x)=>{r(y,(E,T)=>{E&&(m=E),f[x]=T,--u==0&&o(m,f)})})}function Pt(i){const r=[];for(const o in i)r.push(i[o]);return r}function lt(i,...r){for(const o of r)for(const u in o)i[u]=o[u];return i}let at=1;function Jt(){return at++}function Er(){return function i(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function Kt(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function xr(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function Ir(i,r){i.forEach(o=>{r[o]&&(r[o]=r[o].bind(r))})}function jr(i,r){return i.indexOf(r,i.length-r.length)!==-1}function tr(i,r,o){const u={};for(const f in i)u[f]=r.call(this,i[f],f,i);return u}function jn(i,r,o){const u={};for(const f in i)r.call(o||this,i[f],f,i)&&(u[f]=i[f]);return u}function Y(i){return Array.isArray(i)?i.map(Y):typeof i=="object"&&i?tr(i,Y):i}const mt={};function et(i){mt[i]||(typeof console<"u"&&console.warn(i),mt[i]=!0)}function Ce(i,r,o){return(o.y-i.y)*(r.x-i.x)>(r.y-i.y)*(o.x-i.x)}function we(i){let r=0;for(let o,u,f=0,m=i.length,y=m-1;f<m;y=f++)o=i[f],u=i[y],r+=(u.x-o.x)*(o.y+u.y);return r}function $e(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function gt(i){const r={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,u,f,m)=>{const y=f||m;return r[u]=!y||y.toLowerCase(),""}),r["max-age"]){const o=parseInt(r["max-age"],10);isNaN(o)?delete r["max-age"]:r["max-age"]=o}return r}let St=null;function tt(i){if(St==null){const r=i.navigator?i.navigator.userAgent:null;St=!!i.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return St}function Lt(i){try{const r=S[i];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}}function $t(i,r){return[i[4*r],i[4*r+1],i[4*r+2],i[4*r+3]]}const Ot="mapbox-tiles";let Qt=500,Mr=50,sr,vn;function Dn(){try{return S.caches}catch{}}function Vn(){Dn()&&!sr&&(sr=S.caches.open(Ot))}function qi(i){const r=i.indexOf("?");if(r<0)return i;const o=function(f){const m=f.indexOf("?");return m>0?f.slice(m+1).split("&"):[]}(i),u=o.filter(f=>{const m=f.split("=");return m[0]==="language"||m[0]==="worldview"});return u.length?`${i.slice(0,r)}?${u.join("&")}`:i.slice(0,r)}let Jr=1/0;const Wi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Wi);class wi extends Error{constructor(r,o,u){o===401&&Ge(u)&&(r+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(r),this.status=o,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ti=$e()?()=>self.worker&&self.worker.referrer:()=>(S.location.protocol==="blob:"?S.parent:S).location.href,xo=function(i,r){if(!(/^file:/.test(o=i.url)||/^file:/.test(ti())&&!/^\w+:/.test(o))){if(S.fetch&&S.Request&&S.AbortController&&S.Request.prototype.hasOwnProperty("signal"))return function(u,f){const m=new S.AbortController,y=new S.Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:ti(),referrerPolicy:u.referrerPolicy,signal:m.signal});let x=!1,E=!1;const T=(P=y.url).indexOf("sku=")>0&&Ge(P);var P;u.type==="json"&&y.headers.set("Accept","application/json");const O=(V,G,K)=>{if(E)return;if(V&&V.message!=="SecurityError"&&et(V.toString()),G&&K)return F(G);const oe=Date.now();S.fetch(y).then(pe=>{if(pe.ok){const Ae=T?pe.clone():null;return F(pe,Ae,oe)}return f(new wi(pe.statusText,pe.status,u.url))}).catch(pe=>{pe.name!=="AbortError"&&f(new Error(`${pe.message} ${u.url}`))})},F=(V,G,K)=>{(u.type==="arrayBuffer"?V.arrayBuffer():u.type==="json"?V.json():V.text()).then(oe=>{E||(G&&K&&function(pe,Ae,me){if(Vn(),!sr)return;const Se={status:Ae.status,statusText:Ae.statusText,headers:new S.Headers};Ae.headers.forEach((Je,Ze)=>Se.headers.set(Ze,Je));const ke=gt(Ae.headers.get("Cache-Control")||"");if(ke["no-store"])return;ke["max-age"]&&Se.headers.set("Expires",new Date(me+1e3*ke["max-age"]).toUTCString());const Me=Se.headers.get("Expires");Me&&(new Date(Me).getTime()-me<42e4||function(Je,Ze){if(vn===void 0)try{new Response(new ReadableStream),vn=!0}catch{vn=!1}vn?Ze(Je.body):Je.blob().then(Ze)}(Ae,Je=>{const Ze=new S.Response(Je,Se);Vn(),sr&&sr.then(st=>st.put(qi(pe.url),Ze)).catch(st=>et(st.message))}))}(y,G,K),x=!0,f(null,oe,V.headers.get("Cache-Control"),V.headers.get("Expires")))}).catch(oe=>{E||f(new Error(oe.message))})};return T?function(V,G){if(Vn(),!sr)return G(null);const K=qi(V.url);sr.then(oe=>{oe.match(K).then(pe=>{const Ae=function(me){if(!me)return!1;const Se=new Date(me.headers.get("Expires")||0),ke=gt(me.headers.get("Cache-Control")||"");return Se>Date.now()&&!ke["no-cache"]}(pe);oe.delete(K),Ae&&oe.put(K,pe.clone()),G(null,pe,Ae)}).catch(G)}).catch(G)}(y,O):O(null,null),{cancel:()=>{E=!0,x||m.abort()}}}(i,r);if($e()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,r,void 0,!0)}var o;return function(u,f){const m=new S.XMLHttpRequest;m.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(const y in u.headers)m.setRequestHeader(y,u.headers[y]);return u.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=u.credentials==="include",m.onerror=()=>{f(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let y=m.response;if(u.type==="json")try{y=JSON.parse(m.response)}catch(x){return f(x)}f(null,y,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else f(new wi(m.statusText,m.status,u.url))},m.send(u.body),{cancel:()=>m.abort()}}(i,r)},vs=function(i,r){return xo(lt(i,{type:"arrayBuffer"}),r)};function eo(i){const r=S.document.createElement("a");return r.href=i,r.protocol===S.document.location.protocol&&r.host===S.document.location.host}const Ee="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let te,re;te=[],re=0;const xe=function(i,r){if(M.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),re>=I.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:i,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return te.push(m),m}re++;let o=!1;const u=()=>{if(!o)for(o=!0,re--;te.length&&re<I.MAX_PARALLEL_IMAGE_REQUESTS;){const m=te.shift(),{requestParameters:y,callback:x,cancelled:E}=m;E||(m.cancel=xe(y,x).cancel)}},f=vs(i,(m,y,x,E)=>{u(),m?r(m):y&&(S.createImageBitmap?function(T,P){const O=new S.Blob([new Uint8Array(T)],{type:"image/png"});S.createImageBitmap(O).then(F=>{P(null,F)}).catch(F=>{P(new Error(`Could not load image because of ${F.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(T,P)=>r(T,P,x,E)):function(T,P){const O=new S.Image,F=S.URL;O.onload=()=>{P(null,O),F.revokeObjectURL(O.src),O.onload=null,S.requestAnimationFrame(()=>{O.src=Ee})},O.onerror=()=>P(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const V=new S.Blob([new Uint8Array(T)],{type:"image/png"});O.src=T.byteLength?F.createObjectURL(V):Ee}(y,(T,P)=>r(T,P,x,E)))});return{cancel:()=>{f.cancel(),u()}}},Ie="NO_ACCESS_TOKEN";function Fe(i){return i.indexOf("mapbox:")===0}function Ge(i){return I.API_URL_REGEX.test(i)}function Ve(i){return I.API_CDN_URL_REGEX.test(i)}function ze(i){return I.API_STYLE_REGEX.test(i)&&!Qe(i)}function Qe(i){return I.API_SPRITE_REGEX.test(i)}const Ct=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function kt(i){const r=i.match(Ct);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function wt(i){const r=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${r}`}const ar="mapbox.eventData";function dr(i){if(!i)return null;const r=i.split(".");if(!r||r.length!==3)return null;try{return JSON.parse(decodeURIComponent(S.atob(r[1]).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class nr{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const o=dr(I.ACCESS_TOKEN);let u="";return u=o&&o.u?S.btoa(encodeURIComponent(o.u).replace(/%([0-9A-F]{2})/g,(f,m)=>String.fromCharCode(+("0x"+m)))):I.ACCESS_TOKEN||"",r?`${ar}.${r}:${u}`:`${ar}:${u}`}fetchEventData(){const r=Lt("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(r)try{const f=S.localStorage.getItem(o);f&&(this.eventData=JSON.parse(f));const m=S.localStorage.getItem(u);m&&(this.anonId=m)}catch{et("Unable to read from LocalStorage")}}saveEventData(){const r=Lt("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(r)try{S.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&S.localStorage.setItem(o,JSON.stringify(this.eventData))}catch{et("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,o,u,f){if(!I.EVENTS_URL)return;const m=kt(I.EVENTS_URL);m.params.push(`access_token=${f||I.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(r).toISOString()},x=o?lt(y,o):y,E={url:wt(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=function(T,P){return xo(lt(T,{method:"POST"}),P)}(E,T=>{this.pendingRequest=null,u(T),this.saveEventData(),this.processRequests(f)})}queueRequest(r,o){this.queue.push(r),this.processRequests(o)}}const ir=new class extends nr{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,r){I.EVENTS_URL&&I.ACCESS_TOKEN&&Array.isArray(i)&&i.some(o=>Fe(o)||Ge(o))&&this.queueRequest(Date.now(),r)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=dr(I.ACCESS_TOKEN),o=r?r.u:I.ACCESS_TOKEN;let u=o!==this.eventData.tokenU;xr(this.anonId)||(this.anonId=Er(),u=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),y=new Date(f),x=(f-this.eventData.lastSuccess)/864e5;u=u||x>=1||x<-1||m.getDate()!==y.getDate()}else u=!0;u?this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:D,skuId:z,"enabled.telemetry":!1,userId:this.anonId},m=>{m||(this.eventData.lastSuccess=f,this.eventData.tokenU=o)},i):this.processRequests()}},br=ir.postTurnstileEvent.bind(ir),an=new class extends nr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,r,o,u){this.skuToken=r,this.errorCb=u,I.EVENTS_URL&&(o||I.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},o):this.errorCb(new Error(Ie)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:o}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),xr(this.anonId)||(this.anonId=Er()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:D,skuId:z,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):r&&(this.success[r]=!0)},i))}},In=an.postMapLoadEvent.bind(an),hi=new class extends nr{constructor(){super("gljs.performance")}postPerformanceEvent(i,r){I.EVENTS_URL&&(i||I.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,performanceData:o}=this.queue.shift(),u=function(f){const m=S.performance.getEntriesByType("resource"),y=S.performance.getEntriesByType("mark"),x=function(F){const V={};if(F){for(const G in F)if(G!=="other")for(const K of F[G]){const oe=`${G}ResolveRangeMin`,pe=`${G}ResolveRangeMax`,Ae=`${G}RequestCount`,me=`${G}RequestCachedCount`;V[oe]=Math.min(V[oe]||1/0,K.startTime),V[pe]=Math.max(V[pe]||-1/0,K.responseEnd);const Se=ke=>{V[ke]===void 0&&(V[ke]=0),++V[ke]};K.transferSize!==void 0&&K.transferSize===0&&Se(me),Se(Ae)}}return V}(function(F,V){const G={};if(F)for(const K of F){const oe=V(K);G[oe]===void 0&&(G[oe]=[]),G[oe].push(K)}return G}(m,eh)),E=S.devicePixelRatio,T=S.navigator.connection||S.navigator.mozConnection||S.navigator.webkitConnection,P={counters:[],metadata:[],attributes:[]},O=(F,V,G)=>{G!=null&&F.push({name:V,value:G.toString()})};for(const F in x)O(P.counters,F,x[F]);if(f.interactionRange[0]!==1/0&&f.interactionRange[1]!==-1/0&&(O(P.counters,"interactionRangeMin",f.interactionRange[0]),O(P.counters,"interactionRangeMax",f.interactionRange[1])),y)for(const F of Object.keys(ga)){const V=ga[F],G=y.find(K=>K.name===V);G&&O(P.counters,V,G.startTime)}return O(P.counters,"visibilityHidden",f.visibilityHidden),O(P.attributes,"style",function(F){if(F)for(const V of F){const G=V.name.split("?")[0];if(ze(G)){const K=G.split("/").slice(-2);if(K.length===2)return`mapbox://styles/${K[0]}/${K[1]}`}}}(m)),O(P.attributes,"terrainEnabled",f.terrainEnabled?"true":"false"),O(P.attributes,"fogEnabled",f.fogEnabled?"true":"false"),O(P.attributes,"projection",f.projection),O(P.attributes,"zoom",f.zoom),O(P.metadata,"devicePixelRatio",E),O(P.metadata,"connectionEffectiveType",T?T.effectiveType:void 0),O(P.metadata,"navigatorUserAgent",S.navigator.userAgent),O(P.metadata,"screenWidth",S.screen.width),O(P.metadata,"screenHeight",S.screen.height),O(P.metadata,"windowWidth",S.innerWidth),O(P.metadata,"windowHeight",S.innerHeight),O(P.metadata,"mapWidth",f.width/E),O(P.metadata,"mapHeight",f.height/E),O(P.metadata,"webglRenderer",f.renderer),O(P.metadata,"webglVendor",f.vendor),O(P.metadata,"sdkVersion",D),O(P.metadata,"sdkIdentifier","mapbox-gl-js"),P}(o);for(const f of u.metadata);for(const f of u.counters);for(const f of u.attributes);this.postEvent(r,u,()=>{},i)}},Rn=hi.postPerformanceEvent.bind(hi),ri=new class extends nr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,r,o,u){if(!I.API_URL||!I.SESSION_PATH)return;const f=kt(I.API_URL+I.SESSION_PATH);f.params.push(`sku=${r||""}`),f.params.push(`access_token=${u||I.ACCESS_TOKEN||""}`);const m={url:wt(f),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(y,x){return xo(lt(y,{method:"GET"}),x)}(m,y=>{this.pendingRequest=null,o(y),this.saveEventData(),this.processRequests(u)})}getSessionAPI(i,r,o,u){this.skuToken=r,this.errorCb=u,I.SESSION_PATH&&I.API_URL&&(o||I.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},o):this.errorCb(new Error(Ie)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:o}=this.queue.shift();r&&this.success[r]||this.getSession(o,this.skuToken,u=>{u?this.errorCb(u):r&&(this.success[r]=!0)},i)}},ni=ri.getSessionAPI.bind(ri),Ei=new Set,ga={create:"create",load:"load",fullLoad:"fullLoad"},ad={mark(i){S.performance.mark(i)},measure(i,r,o){S.performance.measure(i,r,o)}};function eh(i){const r=i.name.split("?")[0];return Ve(r)&&r.includes("mapbox-gl.js")?"javascript":Ve(r)&&r.includes("mapbox-gl.css")?"css":function(o){return I.API_FONTS_REGEX.test(o)}(r)?"fontRange":Qe(r)?"sprite":ze(r)?"style":function(o){return I.API_TILEJSON_REGEX.test(o)}(r)?"tilejson":"other"}const wr=S.performance;function Uu(i){const r=i?i.url.toString():void 0;return wr.getEntriesByName(r)}let Za,$u,Dl,Fo;const to={now:()=>Dl!==void 0?Dl:S.performance.now(),setNow(i){Dl=i},restoreNow(){Dl=void 0},frame(i){const r=S.requestAnimationFrame(i);return{cancel:()=>S.cancelAnimationFrame(r)}},getImageData(i,r=0){const{width:o,height:u}=i;Fo||(Fo=S.document.createElement("canvas"));const f=Fo.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(o>Fo.width||u>Fo.height)&&(Fo.width=o,Fo.height=u),f.clearRect(-r,-r,o+2*r,u+2*r),f.drawImage(i,0,0,o,u),f.getImageData(-r,-r,o+2*r,u+2*r)},resolveURL:i=>(Za||(Za=S.document.createElement("a")),Za.href=i,Za.href),get devicePixelRatio(){return S.devicePixelRatio},get prefersReducedMotion(){return!!S.matchMedia&&($u==null&&($u=S.matchMedia("(prefers-reduced-motion: reduce)")),$u.matches)}};function ju(i,r,o){o[i]&&o[i].indexOf(r)!==-1||(o[i]=o[i]||[],o[i].push(r))}function Vu(i,r,o){if(o&&o[i]){const u=o[i].indexOf(r);u!==-1&&o[i].splice(u,1)}}class Oi{constructor(r,o={}){lt(this,o),this.type=r}}class ns extends Oi{constructor(r,o={}){super("error",lt({error:r},o))}}class Ha{on(r,o){return this._listeners=this._listeners||{},ju(r,o,this._listeners),this}off(r,o){return Vu(r,o,this._listeners),Vu(r,o,this._oneTimeListeners),this}once(r,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},ju(r,o,this._oneTimeListeners),this):new Promise(u=>this.once(r,u))}fire(r,o){typeof r=="string"&&(r=new Oi(r,o||{}));const u=r.type;if(this.listens(u)){r.target=this;const f=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const x of f)x.call(this,r);const m=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const x of m)Vu(u,x,this._oneTimeListeners),x.call(this,r);const y=this._eventedParent;y&&(lt(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(r))}else r instanceof ns&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,o){return this._eventedParent=r,this._eventedParentData=o,this}}var ot=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function is(i,...r){for(const o of r)for(const u in o)i[u]=o[u];return i}function Mn(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function ii(i){if(Array.isArray(i))return i.map(ii);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const r={};for(const o in i)r[o]=ii(i[o]);return r}return Mn(i)}class Xa extends Error{constructor(r,o){super(o),this.message=o,this.key=r}}var Bo=Xa;class Fs{constructor(r,o=[]){this.parent=r,this.bindings={};for(const[u,f]of o)this.bindings[u]=f}concat(r){return new Fs(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}var Gu=Fs;const Bs={kind:"null"},zt={kind:"number"},_r={kind:"string"},mr={kind:"boolean"},Zi={kind:"color"},ro={kind:"object"},gr={kind:"value"},Hi={kind:"collator"},ya={kind:"formatted"},No={kind:"resolvedImage"};function ai(i,r){return{kind:"array",itemType:i,N:r}}function nn(i){if(i.kind==="array"){const r=nn(i.itemType);return typeof i.N=="number"?`array<${r}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${r}>`}return i.kind}const th=[Bs,zt,_r,mr,Zi,ya,ro,ai(gr),No];function fi(i,r){if(r.kind==="error")return null;if(i.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!fi(i.itemType,r.itemType))&&(typeof i.N!="number"||i.N===r.N))return null}else{if(i.kind===r.kind)return null;if(i.kind==="value"){for(const o of th)if(!fi(o,r))return null}}return`Expected ${nn(i)} but found ${nn(r)} instead.`}function Ka(i,r){return r.some(o=>o.kind===i.kind)}function Ya(i,r){return r.some(o=>o==="null"?i===null:o==="array"?Array.isArray(i):o==="object"?i&&!Array.isArray(i)&&typeof i=="object":o===typeof i)}var qu,rh={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ja(i){return(i=Math.round(i))<0?0:i>255?255:i}function bo(i){return Ja(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function Qa(i){return(r=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:r>1?1:r;var r}function _a(i,r,o){return o<0?o+=1:o>1&&(o-=1),6*o<1?i+(r-i)*o*6:2*o<1?r:3*o<2?i+(r-i)*(2/3-o)*6:i}try{qu={}.parseCSSColor=function(i){var r,o=i.replace(/ /g,"").toLowerCase();if(o in rh)return rh[o].slice();if(o[0]==="#")return o.length===4?(r=parseInt(o.substr(1),16))>=0&&r<=4095?[(3840&r)>>4|(3840&r)>>8,240&r|(240&r)>>4,15&r|(15&r)<<4,1]:null:o.length===7&&(r=parseInt(o.substr(1),16))>=0&&r<=16777215?[(16711680&r)>>16,(65280&r)>>8,255&r,1]:null;var u=o.indexOf("("),f=o.indexOf(")");if(u!==-1&&f+1===o.length){var m=o.substr(0,u),y=o.substr(u+1,f-(u+1)).split(","),x=1;switch(m){case"rgba":if(y.length!==4)return null;x=Qa(y.pop());case"rgb":return y.length!==3?null:[bo(y[0]),bo(y[1]),bo(y[2]),x];case"hsla":if(y.length!==4)return null;x=Qa(y.pop());case"hsl":if(y.length!==3)return null;var E=(parseFloat(y[0])%360+360)%360/360,T=Qa(y[1]),P=Qa(y[2]),O=P<=.5?P*(T+1):P+T-P*T,F=2*P-O;return[Ja(255*_a(F,O,E+1/3)),Ja(255*_a(F,O,E)),Ja(255*_a(F,O,E-1/3)),x];default:return null}}return null}}catch{}class li{constructor(r,o,u,f=1){this.r=r,this.g=o,this.b=u,this.a=f}static parse(r){if(!r)return;if(r instanceof li)return r;if(typeof r!="string")return;const o=qu(r);return o?new li(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toString(){const[r,o,u,f]=this.toArray();return`rgba(${Math.round(r)},${Math.round(o)},${Math.round(u)},${f})`}toArray(){const{r,g:o,b:u,a:f}=this;return f===0?[0,0,0,0]:[255*r/f,255*o/f,255*u/f,f]}toArray01(){const{r,g:o,b:u,a:f}=this;return f===0?[0,0,0,0]:[r/f,o/f,u/f,f]}toArray01PremultipliedAlpha(){const{r,g:o,b:u,a:f}=this;return[r,o,u,f]}}li.black=new li(0,0,0,1),li.white=new li(1,1,1,1),li.transparent=new li(0,0,0,0),li.red=new li(1,0,0,1),li.blue=new li(0,0,1,1);var xn=li;class el{constructor(r,o,u){this.sensitivity=r?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,o){return this.collator.compare(r,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Wu{constructor(r,o,u,f,m){this.text=r.normalize?r.normalize():r,this.image=o,this.scale=u,this.fontStack=f,this.textColor=m}}class Ti{constructor(r){this.sections=r}static fromString(r){return new Ti([new Wu(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||r.image&&r.image.name.length!==0)}static factory(r){return r instanceof Ti?r:Ti.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const o of this.sections){if(o.image){r.push(["image",o.image.name]);continue}r.push(o.text);const u={};o.fontStack&&(u["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(u["font-scale"]=o.scale),o.textColor&&(u["text-color"]=["rgba"].concat(o.textColor.toArray())),r.push(u)}return r}}class Xi{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new Xi({name:r,available:!1}):null}serialize(){return["image",this.name]}}function Zu(i,r,o,u){return typeof i=="number"&&i>=0&&i<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof o=="number"&&o>=0&&o<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[i,r,o,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[i,r,o,u]:[i,r,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function os(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof xn||i instanceof el||i instanceof Ti||i instanceof Xi)return!0;if(Array.isArray(i)){for(const r of i)if(!os(r))return!1;return!0}if(typeof i=="object"){for(const r in i)if(!os(i[r]))return!1;return!0}return!1}function hn(i){if(i===null)return Bs;if(typeof i=="string")return _r;if(typeof i=="boolean")return mr;if(typeof i=="number")return zt;if(i instanceof xn)return Zi;if(i instanceof el)return Hi;if(i instanceof Ti)return ya;if(i instanceof Xi)return No;if(Array.isArray(i)){const r=i.length;let o;for(const u of i){const f=hn(u);if(o){if(o===f)continue;o=gr;break}o=f}return ai(o||gr,r)}return ro}function tl(i){const r=typeof i;return i===null?"":r==="string"||r==="number"||r==="boolean"?String(i):i instanceof xn||i instanceof Ti||i instanceof Xi?i.toString():JSON.stringify(i)}class Hu{constructor(r,o){this.type=r,this.value=o}static parse(r,o){if(r.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!os(r[1]))return o.error("invalid value");const u=r[1];let f=hn(u);const m=o.expectedType;return f.kind!=="array"||f.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(f=m),new Hu(f,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof xn?["rgba"].concat(this.value.toArray()):this.value instanceof Ti?this.value.serialize():this.value}}var Ns=Hu,ve=class{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}};const je={string:_r,number:zt,boolean:mr,object:ro};class Et{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");let u,f=1;const m=r[0];if(m==="array"){let x,E;if(r.length>2){const T=r[1];if(typeof T!="string"||!(T in je)||T==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);x=je[T],f++}else x=gr;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return o.error('The length argument to "array" must be a positive integer literal',2);E=r[2],f++}u=ai(x,E)}else u=je[m];const y=[];for(;f<r.length;f++){const x=o.parse(r[f],f,gr);if(!x)return null;y.push(x)}return new Et(u,y)}evaluate(r){for(let o=0;o<this.args.length;o++){const u=this.args[o].evaluate(r);if(!fi(this.type,hn(u)))return u;if(o===this.args.length-1)throw new ve(`Expected value to be of type ${nn(this.type)}, but found ${nn(hn(u))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,o=[r.kind];if(r.kind==="array"){const u=r.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);const f=r.N;(typeof f=="number"||this.args.length>1)&&o.push(f)}}return o.concat(this.args.map(u=>u.serialize()))}}var Gt=Et;class Fr{constructor(r){this.type=ya,this.sections=r}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");const u=r[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");const f=[];let m=!1;for(let y=1;y<=r.length-1;++y){const x=r[y];if(m&&typeof x=="object"&&!Array.isArray(x)){m=!1;let E=null;if(x["font-scale"]&&(E=o.parse(x["font-scale"],1,zt),!E))return null;let T=null;if(x["text-font"]&&(T=o.parse(x["text-font"],1,ai(_r)),!T))return null;let P=null;if(x["text-color"]&&(P=o.parse(x["text-color"],1,Zi),!P))return null;const O=f[f.length-1];O.scale=E,O.font=T,O.textColor=P}else{const E=o.parse(r[y],1,gr);if(!E)return null;const T=E.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,f.push({content:E,scale:null,font:null,textColor:null})}}return new Fr(f)}evaluate(r){return new Ti(this.sections.map(o=>{const u=o.content.evaluate(r);return hn(u)===No?new Wu("",u,null,null,null):new Wu(tl(u),null,o.scale?o.scale.evaluate(r):null,o.font?o.font.evaluate(r).join(","):null,o.textColor?o.textColor.evaluate(r):null)}))}eachChild(r){for(const o of this.sections)r(o.content),o.scale&&r(o.scale),o.font&&r(o.font),o.textColor&&r(o.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const o of this.sections){r.push(o.content.serialize());const u={};o.scale&&(u["font-scale"]=o.scale.serialize()),o.font&&(u["text-font"]=o.font.serialize()),o.textColor&&(u["text-color"]=o.textColor.serialize()),r.push(u)}return r}}class pr{constructor(r){this.type=No,this.input=r}static parse(r,o){if(r.length!==2)return o.error("Expected two arguments.");const u=o.parse(r[1],1,_r);return u?new pr(u):o.error("No image name provided.")}evaluate(r){const o=this.input.evaluate(r),u=Xi.fromString(o);return u&&r.availableImages&&(u.available=r.availableImages.indexOf(o)>-1),u}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const bn={"to-boolean":mr,"to-color":Zi,"to-number":zt,"to-string":_r};class zn{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");const u=r[0];if((u==="to-boolean"||u==="to-string")&&r.length!==2)return o.error("Expected one argument.");const f=bn[u],m=[];for(let y=1;y<r.length;y++){const x=o.parse(r[y],y,gr);if(!x)return null;m.push(x)}return new zn(f,m)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let o,u;for(const f of this.args){if(o=f.evaluate(r),u=null,o instanceof xn)return o;if(typeof o=="string"){const m=r.parseColor(o);if(m)return m}else if(Array.isArray(o)&&(u=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Zu(o[0],o[1],o[2],o[3]),!u))return new xn(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new ve(u||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}if(this.type.kind==="number"){let o=null;for(const u of this.args){if(o=u.evaluate(r),o===null)return 0;const f=Number(o);if(!isNaN(f))return f}throw new ve(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?Ti.fromString(tl(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?Xi.fromString(tl(this.args[0].evaluate(r))):tl(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Fr([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new pr(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild(o=>{r.push(o.serialize())}),r}}var wn=zn;const Br=["Unknown","Point","LineString","Polygon"];var Si=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Br[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:o,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*r-i[0])+this.featureDistanceData.bearing[1]*(u*r-i[1])}return 0}parseColor(i){let r=this._parseColorCache[i];return r||(r=this._parseColorCache[i]=xn.parse(i)),r}};class ui{constructor(r,o,u,f){this.name=r,this.type=o,this._evaluate=u,this.args=f}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,o){const u=r[0],f=ui.definitions[u];if(!f)return o.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(f)?f[0]:f.type,y=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,x=y.filter(([T])=>!Array.isArray(T)||T.length===r.length-1);let E=null;for(const[T,P]of x){E=new fd(o.registry,o.path,null,o.scope);const O=[];let F=!1;for(let V=1;V<r.length;V++){const G=r[V],K=Array.isArray(T)?T[V-1]:T.type,oe=E.parse(G,1+O.length,K);if(!oe){F=!0;break}O.push(oe)}if(!F)if(Array.isArray(T)&&T.length!==O.length)E.error(`Expected ${T.length} arguments, but found ${O.length} instead.`);else{for(let V=0;V<O.length;V++){const G=Array.isArray(T)?T[V]:T.type,K=O[V];E.concat(V+1).checkSubtype(G,K.type)}if(E.errors.length===0)return new ui(u,m,P,O)}}if(x.length===1)o.errors.push(...E.errors);else{const T=(x.length?x:y).map(([O])=>{return F=O,Array.isArray(F)?`(${F.map(nn).join(", ")})`:`(${nn(F.type)}...)`;var F}).join(" | "),P=[];for(let O=1;O<r.length;O++){const F=o.parse(r[O],1+P.length);if(!F)return null;P.push(nn(F.type))}o.error(`Expected arguments of type ${T}, but found (${P.join(", ")}) instead.`)}return null}static register(r,o){ui.definitions=o;for(const u in o)r[u]=ui}}var fn=ui;class di{constructor(r,o,u){this.type=Hi,this.locale=u,this.caseSensitive=r,this.diacriticSensitive=o}static parse(r,o){if(r.length!==2)return o.error("Expected one argument.");const u=r[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");const f=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,mr);if(!f)return null;const m=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,mr);if(!m)return null;let y=null;return u.locale&&(y=o.parse(u.locale,1,_r),!y)?null:new di(f,m,y)}evaluate(r){return new el(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const Fn=8192;function wo(i,r){i[0]=Math.min(i[0],r[0]),i[1]=Math.min(i[1],r[1]),i[2]=Math.max(i[2],r[0]),i[3]=Math.max(i[3],r[1])}function Di(i,r){return!(i[0]<=r[0]||i[2]>=r[2]||i[1]<=r[1]||i[3]>=r[3])}function Eo(i,r){const o=(180+i[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,f=Math.pow(2,r.z);return[Math.round(o*f*Fn),Math.round(u*f*Fn)]}function Xu(i,r,o){const u=i[0]-r[0],f=i[1]-r[1],m=i[0]-o[0],y=i[1]-o[1];return u*y-m*f==0&&u*m<=0&&f*y<=0}function Us(i,r){let o=!1;for(let y=0,x=r.length;y<x;y++){const E=r[y];for(let T=0,P=E.length;T<P-1;T++){if(Xu(i,E[T],E[T+1]))return!1;(f=E[T])[1]>(u=i)[1]!=(m=E[T+1])[1]>u[1]&&u[0]<(m[0]-f[0])*(u[1]-f[1])/(m[1]-f[1])+f[0]&&(o=!o)}}var u,f,m;return o}function va(i,r){for(let o=0;o<r.length;o++)if(Us(i,r[o]))return!0;return!1}function ld(i,r,o,u){const f=u[0]-o[0],m=u[1]-o[1],y=(i[0]-o[0])*m-f*(i[1]-o[1]),x=(r[0]-o[0])*m-f*(r[1]-o[1]);return y>0&&x<0||y<0&&x>0}function Rl(i,r,o){for(const T of o)for(let P=0;P<T.length-1;++P)if((x=[(y=T[P+1])[0]-(m=T[P])[0],y[1]-m[1]])[0]*(E=[(f=r)[0]-(u=i)[0],f[1]-u[1]])[1]-x[1]*E[0]!=0&&ld(u,f,m,y)&&ld(m,y,u,f))return!0;var u,f,m,y,x,E;return!1}function Nr(i,r){for(let o=0;o<i.length;++o)if(!Us(i[o],r))return!1;for(let o=0;o<i.length-1;++o)if(Rl(i[o],i[o+1],r))return!1;return!0}function s0(i,r){for(let o=0;o<r.length;o++)if(Nr(i,r[o]))return!0;return!1}function ud(i,r,o){const u=[];for(let f=0;f<i.length;f++){const m=[];for(let y=0;y<i[f].length;y++){const x=Eo(i[f][y],o);wo(r,x),m.push(x)}u.push(m)}return u}function Wm(i,r,o){const u=[];for(let f=0;f<i.length;f++){const m=ud(i[f],r,o);u.push(m)}return u}function cd(i,r,o,u){if(i[0]<o[0]||i[0]>o[2]){const f=.5*u;let m=i[0]-o[0]>f?-u:o[0]-i[0]>f?u:0;m===0&&(m=i[0]-o[2]>f?-u:o[2]-i[0]>f?u:0),i[0]+=m}wo(r,i)}function Zm(i,r,o,u){const f=Math.pow(2,u.z)*Fn,m=[u.x*Fn,u.y*Fn],y=[];if(!i)return y;for(const x of i)for(const E of x){const T=[E.x+m[0],E.y+m[1]];cd(T,r,o,f),y.push(T)}return y}function hd(i,r,o,u){const f=Math.pow(2,u.z)*Fn,m=[u.x*Fn,u.y*Fn],y=[];if(!i)return y;for(const E of i){const T=[];for(const P of E){const O=[P.x+m[0],P.y+m[1]];wo(r,O),T.push(O)}y.push(T)}if(r[2]-r[0]<=f/2){(x=r)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const E of y)for(const T of E)cd(T,r,o,f)}var x;return y}class zl{constructor(r,o){this.type=mr,this.geojson=r,this.geometries=o}static parse(r,o){if(r.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(os(r[1])){const u=r[1];if(u.type==="FeatureCollection")for(let f=0;f<u.features.length;++f){const m=u.features[f].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new zl(u,u.features[f].geometry)}else if(u.type==="Feature"){const f=u.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new zl(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new zl(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(o,u){const f=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=o.canonicalID();if(!y)return!1;if(u.type==="Polygon"){const x=ud(u.coordinates,m,y),E=Zm(o.geometry(),f,m,y);if(!Di(f,m))return!1;for(const T of E)if(!Us(T,x))return!1}if(u.type==="MultiPolygon"){const x=Wm(u.coordinates,m,y),E=Zm(o.geometry(),f,m,y);if(!Di(f,m))return!1;for(const T of E)if(!va(T,x))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(o,u){const f=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=o.canonicalID();if(!y)return!1;if(u.type==="Polygon"){const x=ud(u.coordinates,m,y),E=hd(o.geometry(),f,m,y);if(!Di(f,m))return!1;for(const T of E)if(!Nr(T,x))return!1}if(u.type==="MultiPolygon"){const x=Wm(u.coordinates,m,y),E=hd(o.geometry(),f,m,y);if(!Di(f,m))return!1;for(const T of E)if(!s0(T,x))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var nh=zl;function Fl(i){if(i instanceof fn&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof nh)return!1;let r=!0;return i.eachChild(o=>{r&&!Fl(o)&&(r=!1)}),r}function $s(i){if(i instanceof fn&&i.name==="feature-state")return!1;let r=!0;return i.eachChild(o=>{r&&!$s(o)&&(r=!1)}),r}function rl(i,r){if(i instanceof fn&&r.indexOf(i.name)>=0)return!1;let o=!0;return i.eachChild(u=>{o&&!rl(u,r)&&(o=!1)}),o}class ih{constructor(r,o){this.type=o.type,this.name=r,this.boundExpression=o}static parse(r,o){if(r.length!==2||typeof r[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const u=r[1];return o.scope.has(u)?new ih(u,o.scope.get(u)):o.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Hm=ih;class Ku{constructor(r,o=[],u,f=new Gu,m=[]){this.registry=r,this.path=o,this.key=o.map(y=>`[${y}]`).join(""),this.scope=f,this.errors=m,this.expectedType=u}parse(r,o,u,f,m={}){return o?this.concat(o,u,f)._parse(r,m):this._parse(r,m)}_parse(r,o){function u(f,m,y){return y==="assert"?new Gt(m,[f]):y==="coerce"?new wn(m,[f]):f}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=r[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[f];if(m){let y=m.parse(r,this);if(!y)return null;if(this.expectedType){const x=this.expectedType,E=y.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||E.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||E.kind!=="value"&&E.kind!=="string"){if(this.checkSubtype(x,E))return null}else y=u(y,x,o.typeAnnotation||"coerce");else y=u(y,x,o.typeAnnotation||"assert")}if(!(y instanceof Ns)&&y.type.kind!=="resolvedImage"&&dd(y)){const x=new Si;try{y=new Ns(y.type,y.evaluate(x))}catch(E){return this.error(E.message),null}}return y}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,o,u){const f=typeof r=="number"?this.path.concat(r):this.path,m=u?this.scope.concat(u):this.scope;return new Ku(this.registry,f,o||null,m,this.errors)}error(r,...o){const u=`${this.key}${o.map(f=>`[${f}]`).join("")}`;this.errors.push(new Bo(u,r))}checkSubtype(r,o){const u=fi(r,o);return u&&this.error(u),u}}var fd=Ku;function dd(i){if(i instanceof Hm)return dd(i.boundExpression);if(i instanceof fn&&i.name==="error"||i instanceof di||i instanceof nh)return!1;const r=i instanceof wn||i instanceof Gt;let o=!0;return i.eachChild(u=>{o=r?o&&dd(u):o&&u instanceof Ns}),!!o&&Fl(i)&&rl(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function oh(i,r){const o=i.length-1;let u,f,m=0,y=o,x=0;for(;m<=y;)if(x=Math.floor((m+y)/2),u=i[x],f=i[x+1],u<=r){if(x===o||r<f)return x;m=x+1}else{if(!(u>r))throw new ve("Input is not a number.");y=x-1}return 0}class sh{constructor(r,o,u){this.type=r,this.input=o,this.labels=[],this.outputs=[];for(const[f,m]of u)this.labels.push(f),this.outputs.push(m)}static parse(r,o){if(r.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return o.error("Expected an even number of arguments.");const u=o.parse(r[1],1,zt);if(!u)return null;const f=[];let m=null;o.expectedType&&o.expectedType.kind!=="value"&&(m=o.expectedType);for(let y=1;y<r.length;y+=2){const x=y===1?-1/0:r[y],E=r[y+1],T=y,P=y+1;if(typeof x!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(f.length&&f[f.length-1][0]>=x)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const O=o.parse(E,P,m);if(!O)return null;m=m||O.type,f.push([x,O])}return new sh(m,u,f)}evaluate(r){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(r);const f=this.input.evaluate(r);if(f<=o[0])return u[0].evaluate(r);const m=o.length;return f>=o[m-1]?u[m-1].evaluate(r):u[oh(o,f)].evaluate(r)}eachChild(r){r(this.input);for(const o of this.outputs)r(o)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&r.push(this.labels[o]),r.push(this.outputs[o].serialize());return r}}var pd=sh;function Cr(i,r,o){return i*(1-o)+r*o}var Yu=Object.freeze({__proto__:null,array:function(i,r,o){return i.map((u,f)=>Cr(u,r[f],o))},color:function(i,r,o){return new xn(Cr(i.r,r.r,o),Cr(i.g,r.g,o),Cr(i.b,r.b,o),Cr(i.a,r.a,o))},number:Cr});const Xm=.95047,md=1.08883,Km=4/29,nl=6/29,gd=3*nl*nl,a0=nl*nl*nl,l0=Math.PI/180,u0=180/Math.PI;function yd(i){return i>a0?Math.pow(i,1/3):i/gd+Km}function _d(i){return i>nl?i*i*i:gd*(i-Km)}function vd(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function ah(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Ym(i){const r=ah(i.r),o=ah(i.g),u=ah(i.b),f=yd((.4124564*r+.3575761*o+.1804375*u)/Xm),m=yd((.2126729*r+.7151522*o+.072175*u)/1);return{l:116*m-16,a:500*(f-m),b:200*(m-yd((.0193339*r+.119192*o+.9503041*u)/md)),alpha:i.a}}function Jm(i){let r=(i.l+16)/116,o=isNaN(i.a)?r:r+i.a/500,u=isNaN(i.b)?r:r-i.b/200;return r=1*_d(r),o=Xm*_d(o),u=md*_d(u),new xn(vd(3.2404542*o-1.5371385*r-.4985314*u),vd(-.969266*o+1.8760108*r+.041556*u),vd(.0556434*o-.2040259*r+1.0572252*u),i.alpha)}function c0(i,r,o){const u=r-i;return i+o*(u>180||u<-180?u-360*Math.round(u/360):u)}const Ju={forward:Ym,reverse:Jm,interpolate:function(i,r,o){return{l:Cr(i.l,r.l,o),a:Cr(i.a,r.a,o),b:Cr(i.b,r.b,o),alpha:Cr(i.alpha,r.alpha,o)}}},Bl={forward:function(i){const{l:r,a:o,b:u}=Ym(i),f=Math.atan2(u,o)*u0;return{h:f<0?f+360:f,c:Math.sqrt(o*o+u*u),l:r,alpha:i.a}},reverse:function(i){const r=i.h*l0,o=i.c;return Jm({l:i.l,a:Math.cos(r)*o,b:Math.sin(r)*o,alpha:i.alpha})},interpolate:function(i,r,o){return{h:c0(i.h,r.h,o),c:Cr(i.c,r.c,o),l:Cr(i.l,r.l,o),alpha:Cr(i.alpha,r.alpha,o)}}};var xd=Object.freeze({__proto__:null,hcl:Bl,lab:Ju});class Qu{constructor(r,o,u,f,m){this.type=r,this.operator=o,this.interpolation=u,this.input=f,this.labels=[],this.outputs=[];for(const[y,x]of m)this.labels.push(y),this.outputs.push(x)}static interpolationFactor(r,o,u,f){let m=0;if(r.name==="exponential")m=bd(o,r.base,u,f);else if(r.name==="linear")m=bd(o,1,u,f);else if(r.name==="cubic-bezier"){const y=r.controlPoints;m=new ue(y[0],y[1],y[2],y[3]).solve(bd(o,1,u,f))}return m}static parse(r,o){let[u,f,m,...y]=r;if(!Array.isArray(f)||f.length===0)return o.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const T=f[1];if(typeof T!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:T}}else{if(f[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const T=f.slice(1);if(T.length!==4||T.some(P=>typeof P!="number"||P<0||P>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:T}}}if(r.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(m=o.parse(m,2,zt),!m)return null;const x=[];let E=null;u==="interpolate-hcl"||u==="interpolate-lab"?E=Zi:o.expectedType&&o.expectedType.kind!=="value"&&(E=o.expectedType);for(let T=0;T<y.length;T+=2){const P=y[T],O=y[T+1],F=T+3,V=T+4;if(typeof P!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(x.length&&x[x.length-1][0]>=P)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const G=o.parse(O,V,E);if(!G)return null;E=E||G.type,x.push([P,G])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new Qu(E,u,f,m,x):o.error(`Type ${nn(E)} is not interpolatable.`)}evaluate(r){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(r);const f=this.input.evaluate(r);if(f<=o[0])return u[0].evaluate(r);const m=o.length;if(f>=o[m-1])return u[m-1].evaluate(r);const y=oh(o,f),x=Qu.interpolationFactor(this.interpolation,f,o[y],o[y+1]),E=u[y].evaluate(r),T=u[y+1].evaluate(r);return this.operator==="interpolate"?Yu[this.type.kind.toLowerCase()](E,T,x):this.operator==="interpolate-hcl"?Bl.reverse(Bl.interpolate(Bl.forward(E),Bl.forward(T),x)):Ju.reverse(Ju.interpolate(Ju.forward(E),Ju.forward(T),x))}eachChild(r){r(this.input);for(const o of this.outputs)r(o)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const o=[this.operator,r,this.input.serialize()];for(let u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o}}function bd(i,r,o,u){const f=u-o,m=i-o;return f===0?0:r===1?m/f:(Math.pow(r,m)-1)/(Math.pow(r,f)-1)}var xs=Qu;class lh{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expectected at least one argument.");let u=null;const f=o.expectedType;f&&f.kind!=="value"&&(u=f);const m=[];for(const x of r.slice(1)){const E=o.parse(x,1+m.length,u,void 0,{typeAnnotation:"omit"});if(!E)return null;u=u||E.type,m.push(E)}const y=f&&m.some(x=>fi(f,x.type));return new lh(y?gr:u,m)}evaluate(r){let o,u=null,f=0;for(const m of this.args){if(f++,u=m.evaluate(r),u&&u instanceof Xi&&!u.available&&(o||(o=u),u=null,f===this.args.length))return o;if(u!==null)break}return u}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(o=>{r.push(o.serialize())}),r}}var wd=lh;class uh{constructor(r,o){this.type=o.type,this.bindings=[].concat(r),this.result=o}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const o of this.bindings)r(o[1]);r(this.result)}static parse(r,o){if(r.length<4)return o.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const u=[];for(let m=1;m<r.length-1;m+=2){const y=r[m];if(typeof y!="string")return o.error(`Expected string, but found ${typeof y} instead.`,m);if(/[^a-zA-Z0-9_]/.test(y))return o.error("Variable names must contain only alphanumeric characters or '_'.",m);const x=o.parse(r[m+1],m+1);if(!x)return null;u.push([y,x])}const f=o.parse(r[r.length-1],r.length-1,o.expectedType,u);return f?new uh(u,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[o,u]of this.bindings)r.push(o,u.serialize());return r.push(this.result.serialize()),r}}var Qm=uh;class Ed{constructor(r,o,u){this.type=r,this.index=o,this.input=u}static parse(r,o){if(r.length!==3)return o.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=o.parse(r[1],1,zt),f=o.parse(r[2],2,ai(o.expectedType||gr));return u&&f?new Ed(f.type.itemType,u,f):null}evaluate(r){const o=this.index.evaluate(r),u=this.input.evaluate(r);if(o<0)throw new ve(`Array index out of bounds: ${o} < 0.`);if(o>=u.length)throw new ve(`Array index out of bounds: ${o} > ${u.length-1}.`);if(o!==Math.floor(o))throw new ve(`Array index must be an integer, but found ${o} instead.`);return u[o]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var h0=Ed;class Td{constructor(r,o){this.type=mr,this.needle=r,this.haystack=o}static parse(r,o){if(r.length!==3)return o.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=o.parse(r[1],1,gr),f=o.parse(r[2],2,gr);return u&&f?Ka(u.type,[mr,_r,zt,Bs,gr])?new Td(u,f):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${nn(u.type)} instead`):null}evaluate(r){const o=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(u==null)return!1;if(!Ya(o,["boolean","string","number","null"]))throw new ve(`Expected first argument to be of type boolean, string, number or null, but found ${nn(hn(o))} instead.`);if(!Ya(u,["string","array"]))throw new ve(`Expected second argument to be of type array or string, but found ${nn(hn(u))} instead.`);return u.indexOf(o)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ch=Td;class ec{constructor(r,o,u){this.type=zt,this.needle=r,this.haystack=o,this.fromIndex=u}static parse(r,o){if(r.length<=2||r.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=o.parse(r[1],1,gr),f=o.parse(r[2],2,gr);if(!u||!f)return null;if(!Ka(u.type,[mr,_r,zt,Bs,gr]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${nn(u.type)} instead`);if(r.length===4){const m=o.parse(r[3],3,zt);return m?new ec(u,f,m):null}return new ec(u,f)}evaluate(r){const o=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(!Ya(o,["boolean","string","number","null"]))throw new ve(`Expected first argument to be of type boolean, string, number or null, but found ${nn(hn(o))} instead.`);if(!Ya(u,["string","array"]))throw new ve(`Expected second argument to be of type array or string, but found ${nn(hn(u))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(r);return u.indexOf(o,f)}return u.indexOf(o)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var eg=ec;class Sd{constructor(r,o,u,f,m,y){this.inputType=r,this.type=o,this.input=u,this.cases=f,this.outputs=m,this.otherwise=y}static parse(r,o){if(r.length<5)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return o.error("Expected an even number of arguments.");let u,f;o.expectedType&&o.expectedType.kind!=="value"&&(f=o.expectedType);const m={},y=[];for(let T=2;T<r.length-1;T+=2){let P=r[T];const O=r[T+1];Array.isArray(P)||(P=[P]);const F=o.concat(T);if(P.length===0)return F.error("Expected at least one branch label.");for(const G of P){if(typeof G!="number"&&typeof G!="string")return F.error("Branch labels must be numbers or strings.");if(typeof G=="number"&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof G=="number"&&Math.floor(G)!==G)return F.error("Numeric branch labels must be integer values.");if(u){if(F.checkSubtype(u,hn(G)))return null}else u=hn(G);if(m[String(G)]!==void 0)return F.error("Branch labels must be unique.");m[String(G)]=y.length}const V=o.parse(O,T,f);if(!V)return null;f=f||V.type,y.push(V)}const x=o.parse(r[1],1,gr);if(!x)return null;const E=o.parse(r[r.length-1],r.length-1,f);return E?x.type.kind!=="value"&&o.concat(1).checkSubtype(u,x.type)?null:new Sd(u,f,x,m,y,E):null}evaluate(r){const o=this.input.evaluate(r);return(hn(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),u=[],f={};for(const y of o){const x=f[this.cases[y]];x===void 0?(f[this.cases[y]]=u.length,u.push([this.cases[y],[y]])):u[x][1].push(y)}const m=y=>this.inputType.kind==="number"?Number(y):y;for(const[y,x]of u)r.push(x.length===1?m(x[0]):x.map(m)),r.push(this.outputs[y].serialize());return r.push(this.otherwise.serialize()),r}}var f0=Sd;class Ad{constructor(r,o,u){this.type=r,this.branches=o,this.otherwise=u}static parse(r,o){if(r.length<4)return o.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return o.error("Expected an odd number of arguments.");let u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);const f=[];for(let y=1;y<r.length-1;y+=2){const x=o.parse(r[y],y,mr);if(!x)return null;const E=o.parse(r[y+1],y+1,u);if(!E)return null;f.push([x,E]),u=u||E.type}const m=o.parse(r[r.length-1],r.length-1,u);return m?new Ad(u,f,m):null}evaluate(r){for(const[o,u]of this.branches)if(o.evaluate(r))return u.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[o,u]of this.branches)r(o),r(u);r(this.otherwise)}outputDefined(){return this.branches.every(([r,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(o=>{r.push(o.serialize())}),r}}var tg=Ad;class tc{constructor(r,o,u,f){this.type=r,this.input=o,this.beginIndex=u,this.endIndex=f}static parse(r,o){if(r.length<=2||r.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=o.parse(r[1],1,gr),f=o.parse(r[2],2,zt);if(!u||!f)return null;if(!Ka(u.type,[ai(gr),_r,gr]))return o.error(`Expected first argument to be of type array or string, but found ${nn(u.type)} instead`);if(r.length===4){const m=o.parse(r[3],3,zt);return m?new tc(u.type,u,f,m):null}return new tc(u.type,u,f)}evaluate(r){const o=this.input.evaluate(r),u=this.beginIndex.evaluate(r);if(!Ya(o,["string","array"]))throw new ve(`Expected first argument to be of type array or string, but found ${nn(hn(o))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(r);return o.slice(u,f)}return o.slice(u)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var rg=tc;function hh(i,r){return i==="=="||i==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function ng(i,r,o,u){return u.compare(r,o)===0}function Nl(i,r,o){const u=i!=="=="&&i!=="!=";return class yR{constructor(m,y,x){this.type=mr,this.lhs=m,this.rhs=y,this.collator=x,this.hasUntypedArgument=m.type.kind==="value"||y.type.kind==="value"}static parse(m,y){if(m.length!==3&&m.length!==4)return y.error("Expected two or three arguments.");const x=m[0];let E=y.parse(m[1],1,gr);if(!E)return null;if(!hh(x,E.type))return y.concat(1).error(`"${x}" comparisons are not supported for type '${nn(E.type)}'.`);let T=y.parse(m[2],2,gr);if(!T)return null;if(!hh(x,T.type))return y.concat(2).error(`"${x}" comparisons are not supported for type '${nn(T.type)}'.`);if(E.type.kind!==T.type.kind&&E.type.kind!=="value"&&T.type.kind!=="value")return y.error(`Cannot compare types '${nn(E.type)}' and '${nn(T.type)}'.`);u&&(E.type.kind==="value"&&T.type.kind!=="value"?E=new Gt(T.type,[E]):E.type.kind!=="value"&&T.type.kind==="value"&&(T=new Gt(E.type,[T])));let P=null;if(m.length===4){if(E.type.kind!=="string"&&T.type.kind!=="string"&&E.type.kind!=="value"&&T.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(P=y.parse(m[3],3,Hi),!P)return null}return new yR(E,T,P)}evaluate(m){const y=this.lhs.evaluate(m),x=this.rhs.evaluate(m);if(u&&this.hasUntypedArgument){const E=hn(y),T=hn(x);if(E.kind!==T.kind||E.kind!=="string"&&E.kind!=="number")throw new ve(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${E.kind}, ${T.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const E=hn(y),T=hn(x);if(E.kind!=="string"||T.kind!=="string")return r(m,y,x)}return this.collator?o(m,y,x,this.collator.evaluate(m)):r(m,y,x)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[i];return this.eachChild(y=>{m.push(y.serialize())}),m}}}const d0=Nl("==",function(i,r,o){return r===o},ng),p0=Nl("!=",function(i,r,o){return r!==o},function(i,r,o,u){return!ng(0,r,o,u)}),m0=Nl("<",function(i,r,o){return r<o},function(i,r,o,u){return u.compare(r,o)<0}),g0=Nl(">",function(i,r,o){return r>o},function(i,r,o,u){return u.compare(r,o)>0}),y0=Nl("<=",function(i,r,o){return r<=o},function(i,r,o,u){return u.compare(r,o)<=0}),ig=Nl(">=",function(i,r,o){return r>=o},function(i,r,o,u){return u.compare(r,o)>=0});class fh{constructor(r,o,u,f,m,y){this.type=_r,this.number=r,this.locale=o,this.currency=u,this.unit=f,this.minFractionDigits=m,this.maxFractionDigits=y}static parse(r,o){if(r.length!==3)return o.error("Expected two arguments.");const u=o.parse(r[1],1,zt);if(!u)return null;const f=r[2];if(typeof f!="object"||Array.isArray(f))return o.error("NumberFormat options argument must be an object.");let m=null;if(f.locale&&(m=o.parse(f.locale,1,_r),!m))return null;let y=null;if(f.currency&&(y=o.parse(f.currency,1,_r),!y))return null;let x=null;if(f.unit&&(x=o.parse(f.unit,1,_r),!x))return null;let E=null;if(f["min-fraction-digits"]&&(E=o.parse(f["min-fraction-digits"],1,zt),!E))return null;let T=null;return f["max-fraction-digits"]&&(T=o.parse(f["max-fraction-digits"],1,zt),!T)?null:new fh(u,m,y,x,E,T)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class Ul{constructor(r){this.type=zt,this.input=r}static parse(r,o){if(r.length!==2)return o.error(`Expected 1 argument, but found ${r.length-1} instead.`);const u=o.parse(r[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${nn(u.type)} instead.`):new Ul(u):null}evaluate(r){const o=this.input.evaluate(r);if(typeof o=="string"||Array.isArray(o))return o.length;throw new ve(`Expected value to be of type string or array, but found ${nn(hn(o))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(o=>{r.push(o.serialize())}),r}}const og={"==":d0,"!=":p0,">":g0,"<":m0,">=":ig,"<=":y0,array:Gt,at:h0,boolean:Gt,case:tg,coalesce:wd,collator:di,format:Fr,image:pr,in:ch,"index-of":eg,interpolate:xs,"interpolate-hcl":xs,"interpolate-lab":xs,length:Ul,let:Qm,literal:Ns,match:f0,number:Gt,"number-format":fh,object:Gt,slice:rg,step:pd,string:Gt,"to-boolean":wn,"to-color":wn,"to-number":wn,"to-string":wn,var:Hm,within:nh};function sg(i,[r,o,u,f]){r=r.evaluate(i),o=o.evaluate(i),u=u.evaluate(i);const m=f?f.evaluate(i):1,y=Zu(r,o,u,m);if(y)throw new ve(y);return new xn(r/255*m,o/255*m,u/255*m,m)}function js(i,r){return i in r}function dh(i,r){const o=r[i];return o===void 0?null:o}function Uo(i){return{type:i}}fn.register(og,{error:[{kind:"error"},[_r],(i,[r])=>{throw new ve(r.evaluate(i))}],typeof:[_r,[gr],(i,[r])=>nn(hn(r.evaluate(i)))],"to-rgba":[ai(zt,4),[Zi],(i,[r])=>r.evaluate(i).toArray()],rgb:[Zi,[zt,zt,zt],sg],rgba:[Zi,[zt,zt,zt,zt],sg],has:{type:mr,overloads:[[[_r],(i,[r])=>js(r.evaluate(i),i.properties())],[[_r,ro],(i,[r,o])=>js(r.evaluate(i),o.evaluate(i))]]},get:{type:gr,overloads:[[[_r],(i,[r])=>dh(r.evaluate(i),i.properties())],[[_r,ro],(i,[r,o])=>dh(r.evaluate(i),o.evaluate(i))]]},"feature-state":[gr,[_r],(i,[r])=>dh(r.evaluate(i),i.featureState||{})],properties:[ro,[],i=>i.properties()],"geometry-type":[_r,[],i=>i.geometryType()],id:[gr,[],i=>i.id()],zoom:[zt,[],i=>i.globals.zoom],pitch:[zt,[],i=>i.globals.pitch||0],"distance-from-center":[zt,[],i=>i.distanceFromCenter()],"heatmap-density":[zt,[],i=>i.globals.heatmapDensity||0],"line-progress":[zt,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[zt,[],i=>i.globals.skyRadialProgress||0],accumulated:[gr,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[zt,Uo(zt),(i,r)=>{let o=0;for(const u of r)o+=u.evaluate(i);return o}],"*":[zt,Uo(zt),(i,r)=>{let o=1;for(const u of r)o*=u.evaluate(i);return o}],"-":{type:zt,overloads:[[[zt,zt],(i,[r,o])=>r.evaluate(i)-o.evaluate(i)],[[zt],(i,[r])=>-r.evaluate(i)]]},"/":[zt,[zt,zt],(i,[r,o])=>r.evaluate(i)/o.evaluate(i)],"%":[zt,[zt,zt],(i,[r,o])=>r.evaluate(i)%o.evaluate(i)],ln2:[zt,[],()=>Math.LN2],pi:[zt,[],()=>Math.PI],e:[zt,[],()=>Math.E],"^":[zt,[zt,zt],(i,[r,o])=>Math.pow(r.evaluate(i),o.evaluate(i))],sqrt:[zt,[zt],(i,[r])=>Math.sqrt(r.evaluate(i))],log10:[zt,[zt],(i,[r])=>Math.log(r.evaluate(i))/Math.LN10],ln:[zt,[zt],(i,[r])=>Math.log(r.evaluate(i))],log2:[zt,[zt],(i,[r])=>Math.log(r.evaluate(i))/Math.LN2],sin:[zt,[zt],(i,[r])=>Math.sin(r.evaluate(i))],cos:[zt,[zt],(i,[r])=>Math.cos(r.evaluate(i))],tan:[zt,[zt],(i,[r])=>Math.tan(r.evaluate(i))],asin:[zt,[zt],(i,[r])=>Math.asin(r.evaluate(i))],acos:[zt,[zt],(i,[r])=>Math.acos(r.evaluate(i))],atan:[zt,[zt],(i,[r])=>Math.atan(r.evaluate(i))],min:[zt,Uo(zt),(i,r)=>Math.min(...r.map(o=>o.evaluate(i)))],max:[zt,Uo(zt),(i,r)=>Math.max(...r.map(o=>o.evaluate(i)))],abs:[zt,[zt],(i,[r])=>Math.abs(r.evaluate(i))],round:[zt,[zt],(i,[r])=>{const o=r.evaluate(i);return o<0?-Math.round(-o):Math.round(o)}],floor:[zt,[zt],(i,[r])=>Math.floor(r.evaluate(i))],ceil:[zt,[zt],(i,[r])=>Math.ceil(r.evaluate(i))],"filter-==":[mr,[_r,gr],(i,[r,o])=>i.properties()[r.value]===o.value],"filter-id-==":[mr,[gr],(i,[r])=>i.id()===r.value],"filter-type-==":[mr,[_r],(i,[r])=>i.geometryType()===r.value],"filter-<":[mr,[_r,gr],(i,[r,o])=>{const u=i.properties()[r.value],f=o.value;return typeof u==typeof f&&u<f}],"filter-id-<":[mr,[gr],(i,[r])=>{const o=i.id(),u=r.value;return typeof o==typeof u&&o<u}],"filter->":[mr,[_r,gr],(i,[r,o])=>{const u=i.properties()[r.value],f=o.value;return typeof u==typeof f&&u>f}],"filter-id->":[mr,[gr],(i,[r])=>{const o=i.id(),u=r.value;return typeof o==typeof u&&o>u}],"filter-<=":[mr,[_r,gr],(i,[r,o])=>{const u=i.properties()[r.value],f=o.value;return typeof u==typeof f&&u<=f}],"filter-id-<=":[mr,[gr],(i,[r])=>{const o=i.id(),u=r.value;return typeof o==typeof u&&o<=u}],"filter->=":[mr,[_r,gr],(i,[r,o])=>{const u=i.properties()[r.value],f=o.value;return typeof u==typeof f&&u>=f}],"filter-id->=":[mr,[gr],(i,[r])=>{const o=i.id(),u=r.value;return typeof o==typeof u&&o>=u}],"filter-has":[mr,[gr],(i,[r])=>r.value in i.properties()],"filter-has-id":[mr,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[mr,[ai(_r)],(i,[r])=>r.value.indexOf(i.geometryType())>=0],"filter-id-in":[mr,[ai(gr)],(i,[r])=>r.value.indexOf(i.id())>=0],"filter-in-small":[mr,[_r,ai(gr)],(i,[r,o])=>o.value.indexOf(i.properties()[r.value])>=0],"filter-in-large":[mr,[_r,ai(gr)],(i,[r,o])=>function(u,f,m,y){for(;m<=y;){const x=m+y>>1;if(f[x]===u)return!0;f[x]>u?y=x-1:m=x+1}return!1}(i.properties()[r.value],o.value,0,o.value.length-1)],all:{type:mr,overloads:[[[mr,mr],(i,[r,o])=>r.evaluate(i)&&o.evaluate(i)],[Uo(mr),(i,r)=>{for(const o of r)if(!o.evaluate(i))return!1;return!0}]]},any:{type:mr,overloads:[[[mr,mr],(i,[r,o])=>r.evaluate(i)||o.evaluate(i)],[Uo(mr),(i,r)=>{for(const o of r)if(o.evaluate(i))return!0;return!1}]]},"!":[mr,[mr],(i,[r])=>!r.evaluate(i)],"is-supported-script":[mr,[_r],(i,[r])=>{const o=i.globals&&i.globals.isSupportedScript;return!o||o(r.evaluate(i))}],upcase:[_r,[_r],(i,[r])=>r.evaluate(i).toUpperCase()],downcase:[_r,[_r],(i,[r])=>r.evaluate(i).toLowerCase()],concat:[_r,Uo(gr),(i,r)=>r.map(o=>tl(o.evaluate(i))).join("")],"resolved-locale":[_r,[Hi],(i,[r])=>r.evaluate(i).resolvedLocale()]});var rc=og;function ag(i){return{result:"success",value:i}}function il(i){return{result:"error",value:i}}function $l(i){return i["property-type"]==="data-driven"}function ph(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function mh(i){return!!i.expression&&i.expression.interpolated}function Pr(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function nc(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function lg(i){return i}function gh(i,r){const o=r.type==="color",u=i.stops&&typeof i.stops[0][0]=="object",f=u||!(u||i.property!==void 0),m=i.type||(mh(r)?"exponential":"interval");if(o&&((i=is({},i)).stops&&(i.stops=i.stops.map(T=>[T[0],xn.parse(T[1])])),i.default=xn.parse(i.default?i.default:r.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!xd[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let y,x,E;if(m==="exponential")y=Vs;else if(m==="interval")y=yh;else if(m==="categorical"){y=ug,x=Object.create(null);for(const T of i.stops)x[T[0]]=T[1];E=typeof i.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);y=cg}if(u){const T={},P=[];for(let V=0;V<i.stops.length;V++){const G=i.stops[V],K=G[0].zoom;T[K]===void 0&&(T[K]={zoom:K,type:i.type,property:i.property,default:i.default,stops:[]},P.push(K)),T[K].stops.push([G[0].value,G[1]])}const O=[];for(const V of P)O.push([T[V].zoom,gh(T[V],r)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:xs.interpolationFactor.bind(void 0,F),zoomStops:O.map(V=>V[0]),evaluate:({zoom:V},G)=>Vs({stops:O,base:i.base},r,V).evaluate(V,G)}}if(f){const T=m==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:xs.interpolationFactor.bind(void 0,T),zoomStops:i.stops.map(P=>P[0]),evaluate:({zoom:P})=>y(i,r,P,x,E)}}return{kind:"source",evaluate(T,P){const O=P&&P.properties?P.properties[i.property]:void 0;return O===void 0?jl(i.default,r.default):y(i,r,O,x,E)}}}function jl(i,r,o){return i!==void 0?i:r!==void 0?r:o!==void 0?o:void 0}function ug(i,r,o,u,f){return jl(typeof o===f?u[o]:void 0,i.default,r.default)}function yh(i,r,o){if(Pr(o)!=="number")return jl(i.default,r.default);const u=i.stops.length;if(u===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[u-1][0])return i.stops[u-1][1];const f=oh(i.stops.map(m=>m[0]),o);return i.stops[f][1]}function Vs(i,r,o){const u=i.base!==void 0?i.base:1;if(Pr(o)!=="number")return jl(i.default,r.default);const f=i.stops.length;if(f===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[f-1][0])return i.stops[f-1][1];const m=oh(i.stops.map(P=>P[0]),o),y=function(P,O,F,V){const G=V-F,K=P-F;return G===0?0:O===1?K/G:(Math.pow(O,K)-1)/(Math.pow(O,G)-1)}(o,u,i.stops[m][0],i.stops[m+1][0]),x=i.stops[m][1],E=i.stops[m+1][1];let T=Yu[r.type]||lg;if(i.colorSpace&&i.colorSpace!=="rgb"){const P=xd[i.colorSpace];T=(O,F)=>P.reverse(P.interpolate(P.forward(O),P.forward(F),y))}return typeof x.evaluate=="function"?{evaluate(...P){const O=x.evaluate.apply(void 0,P),F=E.evaluate.apply(void 0,P);if(O!==void 0&&F!==void 0)return T(O,F,y)}}:T(x,E,y)}function cg(i,r,o){return r.type==="color"?o=xn.parse(o):r.type==="formatted"?o=Ti.fromString(o.toString()):r.type==="resolvedImage"?o=Xi.fromString(o.toString()):Pr(o)===r.type||r.type==="enum"&&r.values[o]||(o=void 0),jl(o,i.default,r.default)}class _h{constructor(r,o){this.expression=r,this._warningHistory={},this._evaluator=new Si,this._defaultValue=o?function(u){return u.type==="color"&&(nc(u.default)||Array.isArray(u.default))?new xn(0,0,0,0):u.type==="color"?xn.parse(u.default)||null:u.default===void 0?null:u.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(r,o,u,f,m,y,x,E){return this._evaluator.globals=r,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=f||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(r,o,u,f,m,y,x,E){this._evaluator.globals=r,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new ve(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function Vl(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in rc}function Gl(i,r){const o=new fd(rc,[],r?function(f){const m={color:Zi,string:_r,number:zt,enum:_r,boolean:mr,formatted:ya,resolvedImage:No};return f.type==="array"?ai(m[f.value]||gr,f.length):m[f.type]}(r):void 0),u=o.parse(i,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?ag(new _h(u,r)):il(o.errors)}class Cd{constructor(r,o){this.kind=r,this._styleExpression=o,this.isStateDependent=r!=="constant"&&!$s(o.expression)}evaluateWithoutErrorHandling(r,o,u,f,m,y){return this._styleExpression.evaluateWithoutErrorHandling(r,o,u,f,m,y)}evaluate(r,o,u,f,m,y){return this._styleExpression.evaluate(r,o,u,f,m,y)}}class ic{constructor(r,o,u,f){this.kind=r,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=r!=="camera"&&!$s(o.expression),this.interpolationType=f}evaluateWithoutErrorHandling(r,o,u,f,m,y){return this._styleExpression.evaluateWithoutErrorHandling(r,o,u,f,m,y)}evaluate(r,o,u,f,m,y){return this._styleExpression.evaluate(r,o,u,f,m,y)}interpolationFactor(r,o,u){return this.interpolationType?xs.interpolationFactor(this.interpolationType,r,o,u):0}}function oc(i,r){if((i=Gl(i,r)).result==="error")return i;const o=i.value.expression,u=Fl(o);if(!u&&!$l(r))return il([new Bo("","data expressions not supported")]);const f=rl(o,["zoom","pitch","distance-from-center"]);if(!f&&!ph(r))return il([new Bo("","zoom expressions not supported")]);const m=xh(o);return m||f?m instanceof Bo?il([m]):m instanceof xs&&!mh(r)?il([new Bo("",'"interpolate" expressions cannot be used with this property')]):ag(m?new ic(u?"camera":"composite",i.value,m.labels,m instanceof xs?m.interpolation:void 0):new Cd(u?"constant":"source",i.value)):il([new Bo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class vh{constructor(r,o){this._parameters=r,this._specification=o,is(this,gh(this._parameters,this._specification))}static deserialize(r){return new vh(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function xh(i){let r=null;if(i instanceof Qm)r=xh(i.result);else if(i instanceof wd){for(const o of i.args)if(r=xh(o),r)break}else(i instanceof pd||i instanceof xs)&&i.input instanceof fn&&i.input.name==="zoom"&&(r=i);return r instanceof Bo||i.eachChild(o=>{const u=xh(o);u instanceof Bo?r=u:!r&&u?r=new Bo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&u&&r!==u&&(r=new Bo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}class Nt{constructor(r,o,u,f){this.message=(r?`${r}: `:"")+u,f&&(this.identifier=f),o!=null&&o.__line__&&(this.line=o.__line__)}}function ss(i){const r=i.key,o=i.value,u=i.valueSpec||{},f=i.objectElementValidators||{},m=i.style,y=i.styleSpec;let x=[];const E=Pr(o);if(E!=="object")return[new Nt(r,o,`object expected, ${E} found`)];for(const T in o){const P=T.split(".")[0];let O;f[P]?O=f[P]:u[P]?O=Ri:f["*"]?O=f["*"]:u["*"]&&(O=Ri),O?x=x.concat(O({key:(r&&`${r}.`)+T,value:o[T],valueSpec:u[P]||u["*"],style:m,styleSpec:y,object:o,objectKey:T},o)):x.push(new Nt(r,o[T],`unknown property "${T}"`))}for(const T in u)f[T]||u[T].required&&u[T].default===void 0&&o[T]===void 0&&x.push(new Nt(r,o,`missing required property "${T}"`));return x}function hg(i){const r=i.value,o=i.valueSpec,u=i.style,f=i.styleSpec,m=i.key,y=i.arrayElementValidator||Ri;if(Pr(r)!=="array")return[new Nt(m,r,`array expected, ${Pr(r)} found`)];if(o.length&&r.length!==o.length)return[new Nt(m,r,`array length ${o.length} expected, length ${r.length} found`)];if(o["min-length"]&&r.length<o["min-length"])return[new Nt(m,r,`array length at least ${o["min-length"]} expected, length ${r.length} found`)];let x={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};f.$version<7&&(x.function=o.function),Pr(o.value)==="object"&&(x=o.value);let E=[];for(let T=0;T<r.length;T++)E=E.concat(y({array:r,arrayIndex:T,value:r[T],valueSpec:x,style:u,styleSpec:f,key:`${m}[${T}]`}));return E}function sc(i){const r=i.key,o=i.value,u=i.valueSpec;let f=Pr(o);if(f==="number"&&o!=o&&(f="NaN"),f!=="number")return[new Nt(r,o,`number expected, ${f} found`)];if("minimum"in u){let m=u.minimum;if(Pr(u.minimum)==="array"&&(m=u.minimum[i.arrayIndex]),o<m)return[new Nt(r,o,`${o} is less than the minimum value ${m}`)]}if("maximum"in u){let m=u.maximum;if(Pr(u.maximum)==="array"&&(m=u.maximum[i.arrayIndex]),o>m)return[new Nt(r,o,`${o} is greater than the maximum value ${m}`)]}return[]}function ac(i){const r=i.valueSpec,o=Mn(i.value.type);let u,f,m,y={};const x=o!=="categorical"&&i.value.property===void 0,E=!x,T=Pr(i.value.stops)==="array"&&Pr(i.value.stops[0])==="array"&&Pr(i.value.stops[0][0])==="object",P=ss({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(V){if(o==="identity")return[new Nt(V.key,V.value,'identity function may not have a "stops" property')];let G=[];const K=V.value;return G=G.concat(hg({key:V.key,value:K,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:O})),Pr(K)==="array"&&K.length===0&&G.push(new Nt(V.key,K,"array must have at least one stop")),G},default:function(V){return Ri({key:V.key,value:V.value,valueSpec:r,style:V.style,styleSpec:V.styleSpec})}}});return o==="identity"&&x&&P.push(new Nt(i.key,i.value,'missing required property "property"')),o==="identity"||i.value.stops||P.push(new Nt(i.key,i.value,'missing required property "stops"')),o==="exponential"&&i.valueSpec.expression&&!mh(i.valueSpec)&&P.push(new Nt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(E&&!$l(i.valueSpec)?P.push(new Nt(i.key,i.value,"property functions not supported")):x&&!ph(i.valueSpec)&&P.push(new Nt(i.key,i.value,"zoom functions not supported"))),o!=="categorical"&&!T||i.value.property!==void 0||P.push(new Nt(i.key,i.value,'"property" property is required')),P;function O(V){let G=[];const K=V.value,oe=V.key;if(Pr(K)!=="array")return[new Nt(oe,K,`array expected, ${Pr(K)} found`)];if(K.length!==2)return[new Nt(oe,K,`array length 2 expected, length ${K.length} found`)];if(T){if(Pr(K[0])!=="object")return[new Nt(oe,K,`object expected, ${Pr(K[0])} found`)];if(K[0].zoom===void 0)return[new Nt(oe,K,"object stop key must have zoom")];if(K[0].value===void 0)return[new Nt(oe,K,"object stop key must have value")];const pe=Mn(K[0].zoom);if(typeof pe!="number")return[new Nt(oe,K[0].zoom,"stop zoom values must be numbers")];if(m&&m>pe)return[new Nt(oe,K[0].zoom,"stop zoom values must appear in ascending order")];pe!==m&&(m=pe,f=void 0,y={}),G=G.concat(ss({key:`${oe}[0]`,value:K[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:sc,value:F}}))}else G=G.concat(F({key:`${oe}[0]`,value:K[0],style:V.style,styleSpec:V.styleSpec},K));return Vl(ii(K[1]))?G.concat([new Nt(`${oe}[1]`,K[1],"expressions are not allowed in function stops.")]):G.concat(Ri({key:`${oe}[1]`,value:K[1],valueSpec:r,style:V.style,styleSpec:V.styleSpec}))}function F(V,G){const K=Pr(V.value),oe=Mn(V.value),pe=V.value!==null?V.value:G;if(u){if(K!==u)return[new Nt(V.key,pe,`${K} stop domain type must match previous stop domain type ${u}`)]}else u=K;if(K!=="number"&&K!=="string"&&K!=="boolean"&&typeof oe!="number"&&typeof oe!="string"&&typeof oe!="boolean")return[new Nt(V.key,pe,"stop domain value must be a number, string, or boolean")];if(K!=="number"&&o!=="categorical"){let Ae=`number expected, ${K} found`;return $l(r)&&o===void 0&&(Ae+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Nt(V.key,pe,Ae)]}return o!=="categorical"||K!=="number"||typeof oe=="number"&&isFinite(oe)&&Math.floor(oe)===oe?o!=="categorical"&&K==="number"&&typeof oe=="number"&&typeof f=="number"&&f!==void 0&&oe<f?[new Nt(V.key,pe,"stop domain values must appear in ascending order")]:(f=oe,o==="categorical"&&oe in y?[new Nt(V.key,pe,"stop domain values must be unique")]:(y[oe]=!0,[])):[new Nt(V.key,pe,`integer expected, found ${String(oe)}`)]}}function pi(i){const r=(i.expressionContext==="property"?oc:Gl)(ii(i.value),i.valueSpec);if(r.result==="error")return r.value.map(u=>new Nt(`${i.key}${u.key}`,i.value,u.message));const o=r.value.expression||r.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!o.outputDefined())return[new Nt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!$s(o))return[new Nt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter")return lc(o,i);if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!rl(o,["zoom","feature-state"]))return[new Nt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Fl(o))return[new Nt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function lc(i,r){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const f of r.valueSpec.expression.parameters)o.delete(f);if(o.size===0)return[];const u=[];return i instanceof fn&&o.has(i.name)?[new Nt(r.key,r.value,`["${i.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(i.eachChild(f=>{u.push(...lc(f,r))}),u)}function bh(i){const r=i.key,o=i.value,u=i.valueSpec,f=[];return Array.isArray(u.values)?u.values.indexOf(Mn(o))===-1&&f.push(new Nt(r,o,`expected one of [${u.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(u.values).indexOf(Mn(o))===-1&&f.push(new Nt(r,o,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(o)} found`)),f}function Id(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const r of i.slice(1))if(!Id(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function wh(i,r="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Id(i)||(i=Wl(i));const o=i;let u=!0;try{u=function(T){if(!ql(T))return T;let P=ii(T);return Eh(P),P=fg(P),P}(o)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(o,null,2)}
        `)}const f=ot[`filter_${r}`],m=Gl(u,f);let y=null;if(m.result==="error")throw new Error(m.value.map(T=>`${T.key}: ${T.message}`).join(", "));y=(T,P,O)=>m.value.evaluate(T,P,{},O);let x=null,E=null;if(u!==o){const T=Gl(o,f);if(T.result==="error")throw new Error(T.value.map(P=>`${P.key}: ${P.message}`).join(", "));x=(P,O,F,V,G)=>T.value.evaluate(P,O,{},F,void 0,void 0,V,G),E=!Fl(T.value.expression)}return{filter:y,dynamicFilter:x||void 0,needGeometry:dg(u),needFeature:!!E}}function fg(i){if(!Array.isArray(i))return i;const r=function(o){if(Md.has(o[0])){for(let u=1;u<o.length;u++)if(ql(o[u]))return!0}return o}(i);return r===!0?r:r.map(o=>fg(o))}function Eh(i){let r=!1;const o=[];if(i[0]==="case"){for(let u=1;u<i.length-1;u+=2)r=r||ql(i[u]),o.push(i[u+1]);o.push(i[i.length-1])}else if(i[0]==="match"){r=r||ql(i[1]);for(let u=2;u<i.length-1;u+=2)o.push(i[u+1]);o.push(i[i.length-1])}else if(i[0]==="step"){r=r||ql(i[1]);for(let u=1;u<i.length-1;u+=2)o.push(i[u+1])}r&&(i.length=0,i.push("any",...o));for(let u=1;u<i.length;u++)Eh(i[u])}function ql(i){if(!Array.isArray(i))return!1;if((r=i[0])==="pitch"||r==="distance-from-center")return!0;var r;for(let o=1;o<i.length;o++)if(ql(i[o]))return!0;return!1}const Md=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function _0(i,r){return i<r?-1:i>r?1:0}function dg(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let r=1;r<i.length;r++)if(dg(i[r]))return!0;return!1}function Wl(i){if(!i)return!0;const r=i[0];return i.length<=1?r!=="any":r==="=="?Pd(i[1],i[2],"=="):r==="!="?Th(Pd(i[1],i[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Pd(i[1],i[2],r):r==="any"?(o=i.slice(1),["any"].concat(o.map(Wl))):r==="all"?["all"].concat(i.slice(1).map(Wl)):r==="none"?["all"].concat(i.slice(1).map(Wl).map(Th)):r==="in"?kd(i[1],i.slice(2)):r==="!in"?Th(kd(i[1],i.slice(2))):r==="has"?Ld(i[1]):r==="!has"?Th(Ld(i[1])):r!=="within"||i;var o}function Pd(i,r,o){switch(i){case"$type":return[`filter-type-${o}`,r];case"$id":return[`filter-id-${o}`,r];default:return[`filter-${o}`,i,r]}}function kd(i,r){if(r.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(o=>typeof o!=typeof r[0])?["filter-in-large",i,["literal",r.sort(_0)]]:["filter-in-small",i,["literal",r]]}}function Ld(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Th(i){return["!",i]}function uc(i){return Id(ii(i.value))?pi(is({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${i.layerType||"fill"}`]})):cc(i)}function cc(i){const r=i.value,o=i.key;if(Pr(r)!=="array")return[new Nt(o,r,`array expected, ${Pr(r)} found`)];const u=i.styleSpec;let f,m=[];if(r.length<1)return[new Nt(o,r,"filter array must have at least 1 element")];switch(m=m.concat(bh({key:`${o}[0]`,value:r[0],valueSpec:u.filter_operator,style:i.style,styleSpec:i.styleSpec})),Mn(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&Mn(r[1])==="$type"&&m.push(new Nt(o,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&m.push(new Nt(o,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(f=Pr(r[1]),f!=="string"&&m.push(new Nt(`${o}[1]`,r[1],`string expected, ${f} found`)));for(let y=2;y<r.length;y++)f=Pr(r[y]),Mn(r[1])==="$type"?m=m.concat(bh({key:`${o}[${y}]`,value:r[y],valueSpec:u.geometry_type,style:i.style,styleSpec:i.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&m.push(new Nt(`${o}[${y}]`,r[y],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let y=1;y<r.length;y++)m=m.concat(cc({key:`${o}[${y}]`,value:r[y],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":f=Pr(r[1]),r.length!==2?m.push(new Nt(o,r,`filter array for "${r[0]}" operator must have 2 elements`)):f!=="string"&&m.push(new Nt(`${o}[1]`,r[1],`string expected, ${f} found`));break;case"within":f=Pr(r[1]),r.length!==2?m.push(new Nt(o,r,`filter array for "${r[0]}" operator must have 2 elements`)):f!=="object"&&m.push(new Nt(`${o}[1]`,r[1],`object expected, ${f} found`))}return m}function Od(i,r){const o=i.key,u=i.style,f=i.styleSpec,m=i.value,y=i.objectKey,x=f[`${r}_${i.layerType}`];if(!x)return[];const E=y.match(/^(.*)-transition$/);if(r==="paint"&&E&&x[E[1]]&&x[E[1]].transition)return Ri({key:o,value:m,valueSpec:f.transition,style:u,styleSpec:f});const T=i.valueSpec||x[y];if(!T)return[new Nt(o,m,`unknown property "${y}"`)];let P;if(Pr(m)==="string"&&$l(T)&&!T.tokens&&(P=/^{([^}]+)}$/.exec(m))){const F=`\`{ "type": "identity", "property": ${P?JSON.stringify(P[1]):'"_"'} }\``;return[new Nt(o,m,`"${y}" does not support interpolation syntax
Use an identity property function instead: ${F}.`)]}const O=[];return i.layerType==="symbol"&&(y==="text-field"&&u&&!u.glyphs&&O.push(new Nt(o,m,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&nc(ii(m))&&Mn(m.type)==="identity"&&O.push(new Nt(o,m,'"text-font" does not support identity functions'))),O.concat(Ri({key:i.key,value:m,valueSpec:T,style:u,styleSpec:f,expressionContext:"property",propertyType:r,propertyKey:y}))}function pg(i){return Od(i,"paint")}function Dd(i){return Od(i,"layout")}function mg(i){let r=[];const o=i.value,u=i.key,f=i.style,m=i.styleSpec;o.type||o.ref||r.push(new Nt(u,o,'either "type" or "ref" is required'));let y=Mn(o.type);const x=Mn(o.ref);if(o.id){const E=Mn(o.id);for(let T=0;T<i.arrayIndex;T++){const P=f.layers[T];Mn(P.id)===E&&r.push(new Nt(u,o.id,`duplicate layer id "${o.id}", previously used at line ${P.id.__line__}`))}}if("ref"in o){let E;["type","source","source-layer","filter","layout"].forEach(T=>{T in o&&r.push(new Nt(u,o[T],`"${T}" is prohibited for ref layers`))}),f.layers.forEach(T=>{Mn(T.id)===x&&(E=T)}),E?E.ref?r.push(new Nt(u,o.ref,"ref cannot reference another ref layer")):y=Mn(E.type):typeof x=="string"&&r.push(new Nt(u,o.ref,`ref layer "${x}" not found`))}else if(y!=="background"&&y!=="sky")if(o.source){const E=f.sources&&f.sources[o.source],T=E&&Mn(E.type);E?T==="vector"&&y==="raster"?r.push(new Nt(u,o.source,`layer "${o.id}" requires a raster source`)):T==="raster"&&y!=="raster"?r.push(new Nt(u,o.source,`layer "${o.id}" requires a vector source`)):T!=="vector"||o["source-layer"]?T==="raster-dem"&&y!=="hillshade"?r.push(new Nt(u,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!o.paint||!o.paint["line-gradient"]&&!o.paint["line-trim-offset"]||T==="geojson"&&E.lineMetrics||r.push(new Nt(u,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new Nt(u,o,`layer "${o.id}" must specify a "source-layer"`)):r.push(new Nt(u,o.source,`source "${o.source}" not found`))}else r.push(new Nt(u,o,'missing required property "source"'));return r=r.concat(ss({key:u,value:o,valueSpec:m.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ri({key:`${u}.type`,value:o.type,valueSpec:m.layer.type,style:i.style,styleSpec:i.styleSpec,object:o,objectKey:"type"}),filter:E=>uc(is({layerType:y},E)),layout:E=>ss({layer:o,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":T=>Dd(is({layerType:y},T))}}),paint:E=>ss({layer:o,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":T=>pg(is({layerType:y},T))}})}})),r}function xa(i){const r=i.value,o=i.key,u=Pr(r);return u!=="string"?[new Nt(o,r,`string expected, ${u} found`)]:[]}const gg={promoteId:function({key:i,value:r}){if(Pr(r)==="string")return xa({key:i,value:r});{const o=[];for(const u in r)o.push(...xa({key:`${i}.${u}`,value:r[u]}));return o}}};function yg(i){const r=i.value,o=i.key,u=i.styleSpec,f=i.style;if(!r.type)return[new Nt(o,r,'"type" is required')];const m=Mn(r.type);let y;switch(m){case"vector":case"raster":case"raster-dem":return y=ss({key:o,value:r,valueSpec:u[`source_${m.replace("-","_")}`],style:i.style,styleSpec:u,objectElementValidators:gg}),y;case"geojson":if(y=ss({key:o,value:r,valueSpec:u.source_geojson,style:f,styleSpec:u,objectElementValidators:gg}),r.cluster)for(const x in r.clusterProperties){const[E,T]=r.clusterProperties[x],P=typeof E=="string"?[E,["accumulated"],["get",x]]:E;y.push(...pi({key:`${o}.${x}.map`,value:T,expressionContext:"cluster-map"})),y.push(...pi({key:`${o}.${x}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return y;case"video":return ss({key:o,value:r,valueSpec:u.source_video,style:f,styleSpec:u});case"image":return ss({key:o,value:r,valueSpec:u.source_image,style:f,styleSpec:u});case"canvas":return[new Nt(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return bh({key:`${o}.type`,value:r.type,valueSpec:{values:v0(u)}})}}function v0(i){return i.source.reduce((r,o)=>{const u=i[o];return u.type.type==="enum"&&(r=r.concat(Object.keys(u.type.values))),r},[])}function _g(i){const r=i.value,o=i.styleSpec,u=o.light,f=i.style;let m=[];const y=Pr(r);if(r===void 0)return m;if(y!=="object")return m=m.concat([new Nt("light",r,`object expected, ${y} found`)]),m;for(const x in r){const E=x.match(/^(.*)-transition$/);m=m.concat(E&&u[E[1]]&&u[E[1]].transition?Ri({key:x,value:r[x],valueSpec:o.transition,style:f,styleSpec:o}):u[x]?Ri({key:x,value:r[x],valueSpec:u[x],style:f,styleSpec:o}):[new Nt(x,r[x],`unknown property "${x}"`)])}return m}function Rd(i){const r=i.value,o=i.key,u=i.style,f=i.styleSpec,m=f.terrain;let y=[];const x=Pr(r);if(r===void 0)return y;if(x!=="object")return y=y.concat([new Nt("terrain",r,`object expected, ${x} found`)]),y;for(const E in r){const T=E.match(/^(.*)-transition$/);y=y.concat(T&&m[T[1]]&&m[T[1]].transition?Ri({key:E,value:r[E],valueSpec:f.transition,style:u,styleSpec:f}):m[E]?Ri({key:E,value:r[E],valueSpec:m[E],style:u,styleSpec:f}):[new Nt(E,r[E],`unknown property "${E}"`)])}if(r.source){const E=u.sources&&u.sources[r.source],T=E&&Mn(E.type);E?T!=="raster-dem"&&y.push(new Nt(o,r.source,`terrain cannot be used with a source of type ${String(T)}, it only be used with a "raster-dem" source type`)):y.push(new Nt(o,r.source,`source "${r.source}" not found`))}else y.push(new Nt(o,r,'terrain is missing required property "source"'));return y}function vg(i){const r=i.value,o=i.style,u=i.styleSpec,f=u.fog;let m=[];const y=Pr(r);if(r===void 0)return m;if(y!=="object")return m=m.concat([new Nt("fog",r,`object expected, ${y} found`)]),m;for(const x in r){const E=x.match(/^(.*)-transition$/);m=m.concat(E&&f[E[1]]&&f[E[1]].transition?Ri({key:x,value:r[x],valueSpec:u.transition,style:o,styleSpec:u}):f[x]?Ri({key:x,value:r[x],valueSpec:f[x],style:o,styleSpec:u}):[new Nt(x,r[x],`unknown property "${x}"`)])}return m}const xg={"*":()=>[],array:hg,boolean:function(i){const r=i.value,o=i.key,u=Pr(r);return u!=="boolean"?[new Nt(o,r,`boolean expected, ${u} found`)]:[]},number:sc,color:function(i){const r=i.key,o=i.value,u=Pr(o);return u!=="string"?[new Nt(r,o,`color expected, ${u} found`)]:qu(o)===null?[new Nt(r,o,`color expected, "${o}" found`)]:[]},enum:bh,filter:uc,function:ac,layer:mg,object:ss,source:yg,light:_g,terrain:Rd,fog:vg,string:xa,formatted:function(i){return xa(i).length===0?[]:pi(i)},resolvedImage:function(i){return xa(i).length===0?[]:pi(i)},projection:function(i){const r=i.value,o=i.styleSpec,u=o.projection,f=i.style;let m=[];const y=Pr(r);if(y==="object")for(const x in r)m=m.concat(Ri({key:x,value:r[x],valueSpec:u[x],style:f,styleSpec:o}));else y!=="string"&&(m=m.concat([new Nt("projection",r,`object or string expected, ${y} found`)]));return m}};function Ri(i){const r=i.value,o=i.valueSpec,u=i.styleSpec;return o.expression&&nc(Mn(r))?ac(i):o.expression&&Vl(ii(r))?pi(i):o.type&&xg[o.type]?xg[o.type](i):ss(is({},i,{valueSpec:o.type?u[o.type]:o}))}function x0(i){const r=i.value,o=i.key,u=xa(i);return u.length||(r.indexOf("{fontstack}")===-1&&u.push(new Nt(o,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&u.push(new Nt(o,r,'"glyphs" url must include a "{range}" token'))),u}function bg(i,r=ot){return $o(Ri({key:"",value:i,valueSpec:r.$root,styleSpec:r,style:i,objectElementValidators:{glyphs:x0,"*":()=>[]}}))}const b0=i=>$o(pg(i)),w0=i=>$o(Dd(i));function $o(i){return i.slice().sort((r,o)=>r.line&&o.line?r.line-o.line:0)}function wg(i,r){let o=!1;if(r&&r.length)for(const u of r)i.fire(new ns(new Error(u.message))),o=!0;return o}var E0=bs,as=3;function bs(i,r,o){var u=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var f=new Int32Array(this.arrayBuffer);i=f[0],this.d=(r=f[1])+2*(o=f[2]);for(var m=0;m<this.d*this.d;m++){var y=f[as+m],x=f[as+m+1];u.push(y===x?null:f.subarray(y,x))}var E=f[as+u.length+1];this.keys=f.subarray(f[as+u.length],E),this.bboxes=f.subarray(E),this.insert=this._insertReadonly}else{this.d=r+2*o;for(var T=0;T<this.d*this.d;T++)u.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=i,this.padding=o,this.scale=r/i,this.uid=0;var P=o/r*i;this.min=-P,this.max=i+P}bs.prototype.insert=function(i,r,o,u,f){this._forEachCell(r,o,u,f,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(f)},bs.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},bs.prototype._insertCell=function(i,r,o,u,f,m){this.cells[f].push(m)},bs.prototype.query=function(i,r,o,u,f){var m=this.min,y=this.max;if(i<=m&&r<=m&&y<=o&&y<=u&&!f)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(i,r,o,u,this._queryCell,x,{},f),x},bs.prototype._queryCell=function(i,r,o,u,f,m,y,x){var E=this.cells[f];if(E!==null)for(var T=this.keys,P=this.bboxes,O=0;O<E.length;O++){var F=E[O];if(y[F]===void 0){var V=4*F;(x?x(P[V+0],P[V+1],P[V+2],P[V+3]):i<=P[V+2]&&r<=P[V+3]&&o>=P[V+0]&&u>=P[V+1])?(y[F]=!0,m.push(T[F])):y[F]=!1}}},bs.prototype._forEachCell=function(i,r,o,u,f,m,y,x){for(var E=this._convertToCellCoord(i),T=this._convertToCellCoord(r),P=this._convertToCellCoord(o),O=this._convertToCellCoord(u),F=E;F<=P;F++)for(var V=T;V<=O;V++){var G=this.d*V+F;if((!x||x(this._convertFromCellCoord(F),this._convertFromCellCoord(V),this._convertFromCellCoord(F+1),this._convertFromCellCoord(V+1)))&&f.call(this,i,r,o,u,G,m,y,x))return}},bs.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},bs.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},bs.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,r=as+this.cells.length+1+1,o=0,u=0;u<this.cells.length;u++)o+=this.cells[u].length;var f=new Int32Array(r+o+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var m=r,y=0;y<i.length;y++){var x=i[y];f[as+y]=m,f.set(x,m),m+=x.length}return f[as+i.length]=m,f.set(this.keys,m),f[as+i.length+1]=m+=this.keys.length,f.set(this.bboxes,m),m+=this.bboxes.length,f.buffer};var ol=Z(E0);const Sh={};function Ut(i,r,o={}){Object.defineProperty(i,"_classRegistryKey",{value:r,writeable:!1}),Sh[r]={klass:i,omit:o.omit||[]}}Ut(Object,"Object"),ol.serialize=function(i,r){const o=i.toArrayBuffer();return r&&r.push(o),{buffer:o}},ol.deserialize=function(i){return new ol(i.buffer)},Object.defineProperty(ol,"name",{value:"Grid"}),Ut(ol,"Grid"),Ut(xn,"Color"),Ut(Error,"Error"),Ut(wi,"AJAXError"),Ut(Xi,"ResolvedImage"),Ut(vh,"StylePropertyFunction"),Ut(_h,"StyleExpression",{omit:["_evaluator"]}),Ut(ic,"ZoomDependentExpression"),Ut(Cd,"ZoomConstantExpression"),Ut(fn,"CompoundExpression",{omit:["_evaluate"]});for(const i in rc)Sh[rc[i]._classRegistryKey]||Ut(rc[i],`Expression${i}`);function zd(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Fd(i){return S.ImageBitmap&&i instanceof S.ImageBitmap}function Zl(i,r){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(zd(i)||Fd(i))return r&&r.push(i),i;if(ArrayBuffer.isView(i)){const o=i;return r&&r.push(o.buffer),o}if(i instanceof S.ImageData)return r&&r.push(i.data.buffer),i;if(Array.isArray(i)){const o=[];for(const u of i)o.push(Zl(u,r));return o}if(typeof i=="object"){const o=i.constructor,u=o._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);const f=o.serialize?o.serialize(i,r):{};if(!o.serialize){for(const m in i)i.hasOwnProperty(m)&&(Sh[u].omit.indexOf(m)>=0||(f[m]=Zl(i[m],r)));i instanceof Error&&(f.message=i.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(f.$name=u),f}throw new Error("can't serialize object of type "+typeof i)}function sl(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||zd(i)||Fd(i)||ArrayBuffer.isView(i)||i instanceof S.ImageData)return i;if(Array.isArray(i))return i.map(sl);if(typeof i=="object"){const r=i.$name||"Object",{klass:o}=Sh[r];if(!o)throw new Error(`can't deserialize unregistered class ${r}`);if(o.deserialize)return o.deserialize(i);const u=Object.create(o.prototype);for(const f of Object.keys(i))f!=="$name"&&(u[f]=sl(i[f]));return u}throw new Error("can't deserialize object of type "+typeof i)}const Bt={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Bd(i){for(const r of i)if(Nd(r.charCodeAt(0)))return!0;return!1}function T0(i){for(const r of i)if(!Eg(r.charCodeAt(0)))return!1;return!0}function Eg(i){return!(Bt.Arabic(i)||Bt["Arabic Supplement"](i)||Bt["Arabic Extended-A"](i)||Bt["Arabic Presentation Forms-A"](i)||Bt["Arabic Presentation Forms-B"](i))}function Nd(i){return!(i!==746&&i!==747&&(i<4352||!(Bt["Bopomofo Extended"](i)||Bt.Bopomofo(i)||Bt["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Bt["CJK Compatibility Ideographs"](i)||Bt["CJK Compatibility"](i)||Bt["CJK Radicals Supplement"](i)||Bt["CJK Strokes"](i)||!(!Bt["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Bt["CJK Unified Ideographs Extension A"](i)||Bt["CJK Unified Ideographs"](i)||Bt["Enclosed CJK Letters and Months"](i)||Bt["Hangul Compatibility Jamo"](i)||Bt["Hangul Jamo Extended-A"](i)||Bt["Hangul Jamo Extended-B"](i)||Bt["Hangul Jamo"](i)||Bt["Hangul Syllables"](i)||Bt.Hiragana(i)||Bt["Ideographic Description Characters"](i)||Bt.Kanbun(i)||Bt["Kangxi Radicals"](i)||Bt["Katakana Phonetic Extensions"](i)||Bt.Katakana(i)&&i!==12540||!(!Bt["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Bt["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Bt["Unified Canadian Aboriginal Syllabics"](i)||Bt["Unified Canadian Aboriginal Syllabics Extended"](i)||Bt["Vertical Forms"](i)||Bt["Yijing Hexagram Symbols"](i)||Bt["Yi Syllables"](i)||Bt["Yi Radicals"](i))))}function Tg(i){return!(Nd(i)||function(r){return!!(Bt["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||Bt["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||Bt["Letterlike Symbols"](r)||Bt["Number Forms"](r)||Bt["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||Bt["Control Pictures"](r)&&r!==9251||Bt["Optical Character Recognition"](r)||Bt["Enclosed Alphanumerics"](r)||Bt["Geometric Shapes"](r)||Bt["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||Bt["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||Bt["CJK Symbols and Punctuation"](r)||Bt.Katakana(r)||Bt["Private Use Area"](r)||Bt["CJK Compatibility Forms"](r)||Bt["Small Form Variants"](r)||Bt["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(i))}function Sg(i){return i>=1424&&i<=2303||Bt["Arabic Presentation Forms-A"](i)||Bt["Arabic Presentation Forms-B"](i)}function S0(i,r){return!(!r&&Sg(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Bt.Khmer(i))}function A0(i){for(const r of i)if(Sg(r.charCodeAt(0)))return!0;return!1}const Ud="deferred",$d="loading",jd="loaded";let Hl=null,p="unavailable",s=null;const h=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(p="error"),Hl&&Hl(i)};function g(){v.fire(new Oi("pluginStateChange",{pluginStatus:p,pluginURL:s}))}const v=new Ha,b=function(){return p},A=function(){if(p!==Ud||!s)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");p=$d,g(),s&&vs({url:s},i=>{i?h(i):(p=jd,g())})},C={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>p===jd||C.applyArabicShaping!=null,isLoading:()=>p===$d,setState(i){p=i.pluginStatus,s=i.pluginURL},isParsed:()=>C.applyArabicShaping!=null&&C.processBidirectionalText!=null&&C.processStyledBidirectionalText!=null,getPluginURL:()=>s};class L{constructor(r,o){this.zoom=r,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(r){return function(o,u){for(const f of o)if(!S0(f.charCodeAt(0),u))return!1;return!0}(r,C.isLoaded())}}class ${constructor(r,o){this.property=r,this.value=o,this.expression=function(u,f){if(nc(u))return new vh(u,f);if(Vl(u)){const m=oc(u,f);if(m.result==="error")throw new Error(m.value.map(y=>`${y.key}: ${y.message}`).join(", "));return m.value}{let m=u;return typeof u=="string"&&f.type==="color"&&(m=xn.parse(u)),{kind:"constant",evaluate:()=>m}}}(o===void 0?r.specification.default:o,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,o,u){return this.property.possiblyEvaluate(this,r,o,u)}}class U{constructor(r){this.property=r,this.value=new $(r,void 0)}transitioned(r,o){return new ne(this.property,this.value,o,lt({},r.transition,this.transition),r.now)}untransitioned(){return new ne(this.property,this.value,null,{},0)}}class H{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return Y(this._values[r].value.value)}setValue(r,o){this._values.hasOwnProperty(r)||(this._values[r]=new U(this._values[r].property)),this._values[r].value=new $(this._values[r].property,o===null?void 0:Y(o))}getTransition(r){return Y(this._values[r].transition)}setTransition(r,o){this._values.hasOwnProperty(r)||(this._values[r]=new U(this._values[r].property)),this._values[r].transition=Y(o)||void 0}serialize(){const r={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(r[o]=u);const f=this.getTransition(o);f!==void 0&&(r[`${o}-transition`]=f)}return r}transitioned(r,o){const u=new le(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].transitioned(r,o._values[f]);return u}untransitioned(){const r=new le(this._properties);for(const o of Object.keys(this._values))r._values[o]=this._values[o].untransitioned();return r}}class ne{constructor(r,o,u,f,m){const y=f.delay||0,x=f.duration||0;m=m||0,this.property=r,this.value=o,this.begin=m+y,this.end=this.begin+x,r.specification.transition&&(f.delay||f.duration)&&(this.prior=u)}possiblyEvaluate(r,o,u){const f=r.now||0,m=this.value.possiblyEvaluate(r,o,u),y=this.prior;if(y){if(f>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(f<this.begin)return y.possiblyEvaluate(r,o,u);{const x=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(r,o,u),m,Mt(x))}}return m}}class le{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,o,u){const f=new de(this._properties);for(const m of Object.keys(this._values))f._values[m]=this._values[m].possiblyEvaluate(r,o,u);return f}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class fe{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return Y(this._values[r].value)}setValue(r,o){this._values[r]=new $(this._values[r].property,o===null?void 0:Y(o))}serialize(){const r={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(r[o]=u)}return r}possiblyEvaluate(r,o,u){const f=new de(this._properties);for(const m of Object.keys(this._values))f._values[m]=this._values[m].possiblyEvaluate(r,o,u);return f}}class ce{constructor(r,o,u){this.property=r,this.value=o,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,o,u,f){return this.property.evaluate(this.value,this.parameters,r,o,u,f)}}class de{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class X{constructor(r){this.specification=r}possiblyEvaluate(r,o){return r.expression.evaluate(o)}interpolate(r,o,u){const f=Yu[this.specification.type];return f?f(r,o,u):r}}class ae{constructor(r,o){this.specification=r,this.overrides=o}possiblyEvaluate(r,o,u,f){return new ce(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(o,null,{},u,f)}:r.expression,o)}interpolate(r,o,u){if(r.value.kind!=="constant"||o.value.kind!=="constant")return r;if(r.value.value===void 0||o.value.value===void 0)return new ce(this,{kind:"constant",value:void 0},r.parameters);const f=Yu[this.specification.type];return f?new ce(this,{kind:"constant",value:f(r.value.value,o.value.value,u)},r.parameters):r}evaluate(r,o,u,f,m,y){return r.kind==="constant"?r.value:r.evaluate(o,u,f,m,y)}}class ge{constructor(r){this.specification=r}possiblyEvaluate(r,o,u,f){return!!r.expression.evaluate(o,null,{},u,f)}interpolate(){return!1}}class be{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new L(0,{});for(const u in r){const f=r[u];f.specification.overridable&&this.overridableProperties.push(u);const m=this.defaultPropertyValues[u]=new $(f,void 0),y=this.defaultTransitionablePropertyValues[u]=new U(f);this.defaultTransitioningPropertyValues[u]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=m.possiblyEvaluate(o)}}}function Oe(i,r){return 256*(i=_e(Math.floor(i),0,255))+_e(Math.floor(r),0,255)}Ut(ae,"DataDrivenProperty"),Ut(X,"DataConstantProperty"),Ut(ge,"ColorRampProperty");const Re={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class De{constructor(r,o){this._structArray=r,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ue{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,o){return r._trim(),o&&(r.isTransferred=!0,o.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const o=Object.create(this.prototype);return o.arrayBuffer=r.arrayBuffer,o.length=r.length,o.capacity=r.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ne(i,r=1){let o=0,u=0;return{members:i.map(f=>{const m=Re[f.type].BYTES_PER_ELEMENT,y=o=Ye(o,Math.max(r,m)),x=f.components||1;return u=Math.max(u,m),o+=m*x,{name:f.name,type:f.type,components:x,offset:y}}),size:Ye(o,Math.max(u,r)),alignment:r}}function Ye(i,r){return Math.ceil(i/r)*r}class vt extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o){const u=this.length;return this.resize(u+1),this.emplace(u,r,o)}emplace(r,o,u){const f=2*r;return this.int16[f+0]=o,this.int16[f+1]=u,r}}vt.prototype.bytesPerElement=4,Ut(vt,"StructArrayLayout2i4");class We extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,r,o,u)}emplace(r,o,u,f){const m=3*r;return this.int16[m+0]=o,this.int16[m+1]=u,this.int16[m+2]=f,r}}We.prototype.bytesPerElement=6,Ut(We,"StructArrayLayout3i6");class ht extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,r,o,u,f)}emplace(r,o,u,f,m){const y=4*r;return this.int16[y+0]=o,this.int16[y+1]=u,this.int16[y+2]=f,this.int16[y+3]=m,r}}ht.prototype.bytesPerElement=8,Ut(ht,"StructArrayLayout4i8");class rt extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,f,m,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,o,u,f,m,y,x)}emplace(r,o,u,f,m,y,x,E){const T=6*r,P=12*r,O=3*r;return this.int16[T+0]=o,this.int16[T+1]=u,this.uint8[P+4]=f,this.uint8[P+5]=m,this.uint8[P+6]=y,this.uint8[P+7]=x,this.float32[O+2]=E,r}}rt.prototype.bytesPerElement=12,Ut(rt,"StructArrayLayout2i4ub1f12");class _t extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,r,o,u,f)}emplace(r,o,u,f,m){const y=4*r;return this.float32[y+0]=o,this.float32[y+1]=u,this.float32[y+2]=f,this.float32[y+3]=m,r}}_t.prototype.bytesPerElement=16,Ut(_t,"StructArrayLayout4f16");class Xe extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,r,o,u,f,m)}emplace(r,o,u,f,m,y){const x=6*r,E=3*r;return this.uint16[x+0]=o,this.uint16[x+1]=u,this.uint16[x+2]=f,this.uint16[x+3]=m,this.float32[E+2]=y,r}}Xe.prototype.bytesPerElement=12,Ut(Xe,"StructArrayLayout4ui1f12");class ut extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,r,o,u,f)}emplace(r,o,u,f,m){const y=4*r;return this.uint16[y+0]=o,this.uint16[y+1]=u,this.uint16[y+2]=f,this.uint16[y+3]=m,r}}ut.prototype.bytesPerElement=8,Ut(ut,"StructArrayLayout4ui8");class bt extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,u,f,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,r,o,u,f,m,y)}emplace(r,o,u,f,m,y,x){const E=6*r;return this.int16[E+0]=o,this.int16[E+1]=u,this.int16[E+2]=f,this.int16[E+3]=m,this.int16[E+4]=y,this.int16[E+5]=x,r}}bt.prototype.bytesPerElement=12,Ut(bt,"StructArrayLayout6i12");class pt extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,u,f,m,y,x,E,T,P,O,F){const V=this.length;return this.resize(V+1),this.emplace(V,r,o,u,f,m,y,x,E,T,P,O,F)}emplace(r,o,u,f,m,y,x,E,T,P,O,F,V){const G=12*r;return this.int16[G+0]=o,this.int16[G+1]=u,this.int16[G+2]=f,this.int16[G+3]=m,this.uint16[G+4]=y,this.uint16[G+5]=x,this.uint16[G+6]=E,this.uint16[G+7]=T,this.int16[G+8]=P,this.int16[G+9]=O,this.int16[G+10]=F,this.int16[G+11]=V,r}}pt.prototype.bytesPerElement=24,Ut(pt,"StructArrayLayout4i4ui4i24");class Tt extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,f,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,r,o,u,f,m,y)}emplace(r,o,u,f,m,y,x){const E=10*r,T=5*r;return this.int16[E+0]=o,this.int16[E+1]=u,this.int16[E+2]=f,this.float32[T+2]=m,this.float32[T+3]=y,this.float32[T+4]=x,r}}Tt.prototype.bytesPerElement=20,Ut(Tt,"StructArrayLayout3i3f20");class Wt extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.uint32[1*r+0]=o,r}}Wt.prototype.bytesPerElement=4,Ut(Wt,"StructArrayLayout1ul4");class or extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,u,f,m,y,x,E,T,P,O,F,V){const G=this.length;return this.resize(G+1),this.emplace(G,r,o,u,f,m,y,x,E,T,P,O,F,V)}emplace(r,o,u,f,m,y,x,E,T,P,O,F,V,G){const K=20*r,oe=10*r;return this.int16[K+0]=o,this.int16[K+1]=u,this.int16[K+2]=f,this.int16[K+3]=m,this.int16[K+4]=y,this.float32[oe+3]=x,this.float32[oe+4]=E,this.float32[oe+5]=T,this.float32[oe+6]=P,this.int16[K+14]=O,this.uint32[oe+8]=F,this.uint16[K+18]=V,this.uint16[K+19]=G,r}}or.prototype.bytesPerElement=40,Ut(or,"StructArrayLayout5i4f1i1ul2ui40");class jt extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,u,f,m,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,o,u,f,m,y,x)}emplace(r,o,u,f,m,y,x,E){const T=8*r;return this.int16[T+0]=o,this.int16[T+1]=u,this.int16[T+2]=f,this.int16[T+4]=m,this.int16[T+5]=y,this.int16[T+6]=x,this.int16[T+7]=E,r}}jt.prototype.bytesPerElement=16,Ut(jt,"StructArrayLayout3i2i2i16");class Yt extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,u,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,r,o,u,f,m)}emplace(r,o,u,f,m,y){const x=4*r,E=8*r;return this.float32[x+0]=o,this.float32[x+1]=u,this.float32[x+2]=f,this.int16[E+6]=m,this.int16[E+7]=y,r}}Yt.prototype.bytesPerElement=16,Ut(Yt,"StructArrayLayout2f1f2i16");class vr extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,r,o,u,f)}emplace(r,o,u,f,m){const y=12*r,x=3*r;return this.uint8[y+0]=o,this.uint8[y+1]=u,this.float32[x+1]=f,this.float32[x+2]=m,r}}vr.prototype.bytesPerElement=12,Ut(vr,"StructArrayLayout2ub2f12");class yr extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,r,o,u)}emplace(r,o,u,f){const m=3*r;return this.float32[m+0]=o,this.float32[m+1]=u,this.float32[m+2]=f,r}}yr.prototype.bytesPerElement=12,Ut(yr,"StructArrayLayout3f12");class qt extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,r,o,u)}emplace(r,o,u,f){const m=3*r;return this.uint16[m+0]=o,this.uint16[m+1]=u,this.uint16[m+2]=f,r}}qt.prototype.bytesPerElement=6,Ut(qt,"StructArrayLayout3ui6");class $r extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,o,u,f,m,y,x,E,T,P,O,F,V,G,K,oe,pe,Ae,me,Se,ke){const Me=this.length;return this.resize(Me+1),this.emplace(Me,r,o,u,f,m,y,x,E,T,P,O,F,V,G,K,oe,pe,Ae,me,Se,ke)}emplace(r,o,u,f,m,y,x,E,T,P,O,F,V,G,K,oe,pe,Ae,me,Se,ke,Me){const Je=30*r,Ze=15*r,st=60*r;return this.int16[Je+0]=o,this.int16[Je+1]=u,this.int16[Je+2]=f,this.float32[Ze+2]=m,this.float32[Ze+3]=y,this.uint16[Je+8]=x,this.uint16[Je+9]=E,this.uint32[Ze+5]=T,this.uint32[Ze+6]=P,this.uint32[Ze+7]=O,this.uint16[Je+16]=F,this.uint16[Je+17]=V,this.uint16[Je+18]=G,this.float32[Ze+10]=K,this.float32[Ze+11]=oe,this.uint8[st+48]=pe,this.uint8[st+49]=Ae,this.uint8[st+50]=me,this.uint32[Ze+13]=Se,this.int16[Je+28]=ke,this.uint8[st+58]=Me,r}}$r.prototype.bytesPerElement=60,Ut($r,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Gr extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,o,u,f,m,y,x,E,T,P,O,F,V,G,K,oe,pe,Ae,me,Se,ke,Me,Je,Ze,st,xt,nt,ft,dt,yt){const At=this.length;return this.resize(At+1),this.emplace(At,r,o,u,f,m,y,x,E,T,P,O,F,V,G,K,oe,pe,Ae,me,Se,ke,Me,Je,Ze,st,xt,nt,ft,dt,yt)}emplace(r,o,u,f,m,y,x,E,T,P,O,F,V,G,K,oe,pe,Ae,me,Se,ke,Me,Je,Ze,st,xt,nt,ft,dt,yt,At){const it=38*r,Rt=19*r;return this.int16[it+0]=o,this.int16[it+1]=u,this.int16[it+2]=f,this.float32[Rt+2]=m,this.float32[Rt+3]=y,this.int16[it+8]=x,this.int16[it+9]=E,this.int16[it+10]=T,this.int16[it+11]=P,this.int16[it+12]=O,this.int16[it+13]=F,this.uint16[it+14]=V,this.uint16[it+15]=G,this.uint16[it+16]=K,this.uint16[it+17]=oe,this.uint16[it+18]=pe,this.uint16[it+19]=Ae,this.uint16[it+20]=me,this.uint16[it+21]=Se,this.uint16[it+22]=ke,this.uint16[it+23]=Me,this.uint16[it+24]=Je,this.uint16[it+25]=Ze,this.uint16[it+26]=st,this.uint16[it+27]=xt,this.uint16[it+28]=nt,this.uint32[Rt+15]=ft,this.float32[Rt+16]=dt,this.float32[Rt+17]=yt,this.float32[Rt+18]=At,r}}Gr.prototype.bytesPerElement=76,Ut(Gr,"StructArrayLayout3i2f6i15ui1ul3f76");class qr extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.float32[1*r+0]=o,r}}qr.prototype.bytesPerElement=4,Ut(qr,"StructArrayLayout1f4");class Wr extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,r,o,u,f,m)}emplace(r,o,u,f,m,y){const x=5*r;return this.float32[x+0]=o,this.float32[x+1]=u,this.float32[x+2]=f,this.float32[x+3]=m,this.float32[x+4]=y,r}}Wr.prototype.bytesPerElement=20,Ut(Wr,"StructArrayLayout5f20");class zi extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,r,o,u,f)}emplace(r,o,u,f,m){const y=6*r;return this.uint32[3*r+0]=o,this.uint16[y+2]=u,this.uint16[y+3]=f,this.uint16[y+4]=m,r}}zi.prototype.bytesPerElement=12,Ut(zi,"StructArrayLayout1ul3ui12");class mi extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o){const u=this.length;return this.resize(u+1),this.emplace(u,r,o)}emplace(r,o,u){const f=2*r;return this.uint16[f+0]=o,this.uint16[f+1]=u,r}}mi.prototype.bytesPerElement=4,Ut(mi,"StructArrayLayout2ui4");class jo extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.uint16[1*r+0]=o,r}}jo.prototype.bytesPerElement=2,Ut(jo,"StructArrayLayout1ui2");class ws extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o){const u=this.length;return this.resize(u+1),this.emplace(u,r,o)}emplace(r,o,u){const f=2*r;return this.float32[f+0]=o,this.float32[f+1]=u,r}}ws.prototype.bytesPerElement=8,Ut(ws,"StructArrayLayout2f8");class dn extends De{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}dn.prototype.size=40;class Zr extends or{get(r){return new dn(this,r)}}Ut(Zr,"CollisionBoxArray");class Lr extends De{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}Lr.prototype.size=60;class Gn extends $r{get(r){return new Lr(this,r)}}Ut(Gn,"PlacedSymbolArray");class Ki extends De{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Ki.prototype.size=76;class ln extends Gr{get(r){return new Ki(this,r)}}Ut(ln,"SymbolInstanceArray");class no extends qr{getoffsetX(r){return this.float32[1*r+0]}}Ut(no,"GlyphOffsetArray");class Ah extends vt{getx(r){return this.int16[2*r+0]}gety(r){return this.int16[2*r+1]}}Ut(Ah,"SymbolLineVertexArray");class al extends De{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}al.prototype.size=12;class hc extends zi{get(r){return new al(this,r)}}Ut(hc,"FeatureIndexArray");class Gs extends mi{geta_centroid_pos0(r){return this.uint16[2*r+0]}geta_centroid_pos1(r){return this.uint16[2*r+1]}}Ut(Gs,"FillExtrusionCentroidArray");const ba=Ne([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ll=Ne([{name:"a_dash",components:4,type:"Uint16"}]);var Ch={exports:{}},fc={exports:{}};fc.exports=function(i,r){var o,u,f,m,y,x,E,T;for(u=i.length-(o=3&i.length),f=r,y=3432918353,x=461845907,T=0;T<u;)E=255&i.charCodeAt(T)|(255&i.charCodeAt(++T))<<8|(255&i.charCodeAt(++T))<<16|(255&i.charCodeAt(++T))<<24,++T,f=27492+(65535&(m=5*(65535&(f=(f^=E=(65535&(E=(E=(65535&E)*y+(((E>>>16)*y&65535)<<16)&4294967295)<<15|E>>>17))*x+(((E>>>16)*x&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(E=0,o){case 3:E^=(255&i.charCodeAt(T+2))<<16;case 2:E^=(255&i.charCodeAt(T+1))<<8;case 1:f^=E=(65535&(E=(E=(65535&(E^=255&i.charCodeAt(T)))*y+(((E>>>16)*y&65535)<<16)&4294967295)<<15|E>>>17))*x+(((E>>>16)*x&65535)<<16)&4294967295}return f^=i.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0};var Vd=fc.exports,DS={exports:{}};DS.exports=function(i,r){for(var o,u=i.length,f=r^u,m=0;u>=4;)o=1540483477*(65535&(o=255&i.charCodeAt(m)|(255&i.charCodeAt(++m))<<8|(255&i.charCodeAt(++m))<<16|(255&i.charCodeAt(++m))<<24))+((1540483477*(o>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),u-=4,++m;switch(u){case 3:f^=(255&i.charCodeAt(m+2))<<16;case 2:f^=(255&i.charCodeAt(m+1))<<8;case 1:f=1540483477*(65535&(f^=255&i.charCodeAt(m)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};var RS=Vd,BB=DS.exports;Ch.exports=RS,Ch.exports.murmur3=RS,Ch.exports.murmur2=BB;var C0=Z(Ch.exports);class Ag{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,o,u,f){this.ids.push(zS(r)),this.positions.push(o,u,f)}getPositions(r){const o=zS(r);let u=0,f=this.ids.length-1;for(;u<f;){const y=u+f>>1;this.ids[y]>=o?f=y:u=y+1}const m=[];for(;this.ids[u]===o;)m.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return m}static serialize(r,o){const u=new Float64Array(r.ids),f=new Uint32Array(r.positions);return I0(u,f,0,u.length-1),o&&o.push(u.buffer,f.buffer),{ids:u,positions:f}}static deserialize(r){const o=new Ag;return o.ids=r.ids,o.positions=r.positions,o.indexed=!0,o}}function zS(i){const r=+i;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:C0(String(i))}function I0(i,r,o,u){for(;o<u;){const f=i[o+u>>1];let m=o-1,y=u+1;for(;;){do m++;while(i[m]<f);do y--;while(i[y]>f);if(m>=y)break;Cg(i,m,y),Cg(r,3*m,3*y),Cg(r,3*m+1,3*y+1),Cg(r,3*m+2,3*y+2)}y-o<u-y?(I0(i,r,o,y),o=y+1):(I0(i,r,y+1,u),u=y)}}function Cg(i,r,o){const u=i[r];i[r]=i[o],i[o]=u}Ut(Ag,"FeaturePositionMap");class ul{constructor(r){this.gl=r.gl,this.initialized=!1}fetchUniformLocation(r,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(r,o),this.initialized=!0),!!this.location}}class Ig extends ul{constructor(r){super(r),this.current=0}set(r,o,u){this.fetchUniformLocation(r,o)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class FS extends ul{constructor(r){super(r),this.current=[0,0,0,0]}set(r,o,u){this.fetchUniformLocation(r,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class BS extends ul{constructor(r){super(r),this.current=xn.transparent}set(r,o,u){this.fetchUniformLocation(r,o)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const NB=new Float32Array(16),UB=new Float32Array(9),$B=new Float32Array(4);function M0(i){return[Oe(255*i.r,255*i.g),Oe(255*i.b,255*i.a)]}class Gd{constructor(r,o,u){this.value=r,this.uniformNames=o.map(f=>`u_${f}`),this.type=u}setUniform(r,o,u,f,m){o.set(r,m,f.constantOr(this.value))}getBinding(r,o){return this.type==="color"?new BS(r):new Ig(r)}}class Ih{constructor(r,o){this.uniformNames=o.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(r){this.pixelRatio=r.pixelRatio||1,this.pattern=r.tl.concat(r.br)}setUniform(r,o,u,f,m){const y=m==="u_pattern"||m==="u_dash"?this.pattern:m==="u_pixel_ratio"?this.pixelRatio:null;y&&o.set(r,m,y)}getBinding(r,o){return o==="u_pattern"||o==="u_dash"?new FS(r):new Ig(r)}}class cl{constructor(r,o,u,f){this.expression=r,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(m=>({name:`a_${m}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(r,o,u,f,m,y){const x=this.paintVertexArray.length,E=this.expression.evaluate(new L(0),o,{},m,f,y);this.paintVertexArray.resize(r),this._setPaintValue(x,r,E)}updatePaintArray(r,o,u,f,m){const y=this.expression.evaluate({zoom:0},u,f,void 0,m);this._setPaintValue(r,o,y)}_setPaintValue(r,o,u){if(this.type==="color"){const f=M0(u);for(let m=r;m<o;m++)this.paintVertexArray.emplace(m,f[0],f[1])}else{for(let f=r;f<o;f++)this.paintVertexArray.emplace(f,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class qs{constructor(r,o,u,f,m,y){this.expression=r,this.uniformNames=o.map(x=>`u_${x}_t`),this.type=u,this.useIntegerZoom=f,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=o.map(x=>({name:`a_${x}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(r,o,u,f,m,y){const x=this.expression.evaluate(new L(this.zoom),o,{},m,f,y),E=this.expression.evaluate(new L(this.zoom+1),o,{},m,f,y),T=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(T,r,x,E)}updatePaintArray(r,o,u,f,m){const y=this.expression.evaluate({zoom:this.zoom},u,f,void 0,m),x=this.expression.evaluate({zoom:this.zoom+1},u,f,void 0,m);this._setPaintValue(r,o,y,x)}_setPaintValue(r,o,u,f){if(this.type==="color"){const m=M0(u),y=M0(f);for(let x=r;x<o;x++)this.paintVertexArray.emplace(x,m[0],m[1],y[0],y[1])}else{for(let m=r;m<o;m++)this.paintVertexArray.emplace(m,u,f);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(f))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,o,u,f,m){const y=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,x=_e(this.expression.interpolationFactor(y,this.zoom,this.zoom+1),0,1);o.set(r,m,x)}getBinding(r,o){return new Ig(r)}}class Xl{constructor(r,o,u,f,m){this.expression=r,this.layerId=m,this.paintVertexAttributes=(u==="array"?ll:ba).members;for(let y=0;y<o.length;++y);this.paintVertexArray=new f}populatePaintArray(r,o,u){const f=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValues(f,r,o.patterns&&o.patterns[this.layerId],u)}updatePaintArray(r,o,u,f,m,y){this._setPaintValues(r,o,u.patterns&&u.patterns[this.layerId],y)}_setPaintValues(r,o,u,f){if(!f||!u)return;const m=f[u];if(!m)return;const{tl:y,br:x,pixelRatio:E}=m;for(let T=r;T<o;T++)this.paintVertexArray.emplace(T,y[0],y[1],x[0],x[1],E)}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Kl{constructor(r,o,u=()=>!0){this.binders={},this._buffers=[];const f=[];for(const m in r.paint._values){if(!u(m))continue;const y=r.paint.get(m);if(!(y instanceof ce&&$l(y.property.specification)))continue;const x=VB(m,r.type),E=y.value,T=y.property.specification.type,P=!!y.property.useIntegerZoom,O=m==="line-dasharray"||m.endsWith("pattern"),F=m==="line-dasharray"&&r.layout.get("line-cap").value.kind!=="constant";if(E.kind!=="constant"||F)if(E.kind==="source"||F||O){const V=NS(m,T,"source");this.binders[m]=O?new Xl(E,x,T,V,r.id):new cl(E,x,T,V),f.push(`/a_${m}`)}else{const V=NS(m,T,"composite");this.binders[m]=new qs(E,x,T,P,o,V),f.push(`/z_${m}`)}else this.binders[m]=O?new Ih(E.value,x):new Gd(E.value,x,T),f.push(`/u_${m}`)}this.cacheKey=f.sort().join("")}getMaxValue(r){const o=this.binders[r];return o instanceof cl||o instanceof qs?o.maxValue:0}populatePaintArrays(r,o,u,f,m,y){for(const x in this.binders){const E=this.binders[x];(E instanceof cl||E instanceof qs||E instanceof Xl)&&E.populatePaintArray(r,o,u,f,m,y)}}setConstantPatternPositions(r){for(const o in this.binders){const u=this.binders[o];u instanceof Ih&&u.setConstantPatternPositions(r)}}updatePaintArrays(r,o,u,f,m,y){let x=!1;for(const E in r){const T=o.getPositions(E);for(const P of T){const O=u.feature(P.index);for(const F in this.binders){const V=this.binders[F];if((V instanceof cl||V instanceof qs||V instanceof Xl)&&V.expression.isStateDependent===!0){const G=f.paint.get(F);V.expression=G.value,V.updatePaintArray(P.start,P.end,O,r[E],m,y),x=!0}}}}return x}defines(){const r=[];for(const o in this.binders){const u=this.binders[o];(u instanceof Gd||u instanceof Ih)&&r.push(...u.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return r}getBinderAttributes(){const r=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof cl||u instanceof qs||u instanceof Xl)for(let f=0;f<u.paintVertexAttributes.length;f++)r.push(u.paintVertexAttributes[f].name)}return r}getBinderUniforms(){const r=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof Gd||u instanceof Ih||u instanceof qs)for(const f of u.uniformNames)r.push(f)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r){const o=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof Gd||f instanceof Ih||f instanceof qs)for(const m of f.uniformNames)o.push({name:m,property:u,binding:f.getBinding(r,m)})}return o}setUniforms(r,o,u,f,m){for(const{name:y,property:x,binding:E}of u)this.binders[x].setUniform(r,E,m,f.get(x),y)}updatePaintBuffers(){this._buffers=[];for(const r in this.binders){const o=this.binders[r];(o instanceof cl||o instanceof qs||o instanceof Xl)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(r){for(const o in this.binders){const u=this.binders[o];(u instanceof cl||u instanceof qs||u instanceof Xl)&&u.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const o=this.binders[r];(o instanceof cl||o instanceof qs||o instanceof Xl)&&o.destroy()}}}class dc{constructor(r,o,u=()=>!0){this.programConfigurations={};for(const f of r)this.programConfigurations[f.id]=new Kl(f,o,u);this.needsUpload=!1,this._featureMap=new Ag,this._bufferOffset=0}populatePaintArrays(r,o,u,f,m,y,x){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(r,o,f,m,y,x);o.id!==void 0&&this._featureMap.add(o.id,u,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,o,u,f,m){for(const y of u)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(r,this._featureMap,o,y,f,m)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const jB={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function VB(i,r){return jB[i]||[i.replace(`${r}-`,"").replace(/-/g,"_")]}const GB={"line-pattern":{source:Xe,composite:Xe},"fill-pattern":{source:Xe,composite:Xe},"fill-extrusion-pattern":{source:Xe,composite:Xe},"line-dasharray":{source:ut,composite:ut}},qB={color:{source:ws,composite:_t},number:{source:qr,composite:ws}};function NS(i,r,o){const u=GB[i];return u&&u[o]||qB[r][o]}Ut(Gd,"ConstantBinder"),Ut(Ih,"PatternConstantBinder"),Ut(cl,"SourceExpressionBinder"),Ut(Xl,"PatternCompositeBinder"),Ut(qs,"CompositeExpressionBinder"),Ut(Kl,"ProgramConfiguration",{omit:["_buffers"]}),Ut(dc,"ProgramConfigurationSet");const US="-transition";class Ws extends Ha{constructor(r,o){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&r.type!=="sky"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),o.layout&&(this._unevaluatedLayout=new fe(o.layout)),o.paint)){this._transitionablePaint=new H(o.paint);for(const u in r.paint)this.setPaintProperty(u,r.paint[u],{validate:!1});for(const u in r.layout)this.setLayoutProperty(u,r.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new de(o.paint)}}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,o,u={}){o!=null&&this._validate(w0,`layers.${this.id}.layout.${r}`,r,o,u)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,o):this.visibility=o)}getPaintProperty(r){return jr(r,US)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,o,u={}){if(o!=null&&this._validate(b0,`layers.${this.id}.paint.${r}`,r,o,u))return!1;if(jr(r,US))return this._transitionablePaint.setTransition(r.slice(0,-11),o||void 0),!1;{const f=this._transitionablePaint._values[r],m=f.value.isDataDriven(),y=f.value;this._transitionablePaint.setValue(r,o),this._handleSpecialPaintPropertyUpdate(r);const x=this._transitionablePaint._values[r].value,E=x.isDataDriven(),T=jr(r,"pattern")||r==="line-dasharray";return E||m||T||this._handleOverridablePaintPropertyUpdate(r,y,x)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,o,u){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,o)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),jn(r,(o,u)=>!(o===void 0||u==="layout"&&!Object.keys(o).length||u==="paint"&&!Object.keys(o).length))}_validate(r,o,u,f,m={}){return(!m||m.validate!==!1)&&wg(this,r.call(bg,{key:o,layerType:this.type,objectKey:u,value:f,styleSpec:ot,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const o=this.paint.get(r);if(o instanceof ce&&$l(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=wh(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const WB=Ne([{name:"a_pos",components:2,type:"Int16"}],4),ZB=Ne([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class qn{constructor(r=[]){this.segments=r}prepareSegment(r,o,u,f){let m=this.segments[this.segments.length-1];return r>qn.MAX_VERTEX_ARRAY_LENGTH&&et(`Max vertices per segment is ${qn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!m||m.vertexLength+r>qn.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==f)&&(m={vertexOffset:o.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},f!==void 0&&(m.sortKey=f),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const r of this.segments)for(const o in r.vaos)r.vaos[o].destroy()}static simpleSegment(r,o,u,f){return new qn([{vertexOffset:r,primitiveOffset:o,vertexLength:u,primitiveLength:f,vaos:{},sortKey:0}])}}qn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ut(qn,"SegmentVector");var Xt=8192;class Yl{constructor(r,o){r&&(o?this.setSouthWest(r).setNorthEast(o):r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof Hr?new Hr(r.lng,r.lat):Hr.convert(r),this}setSouthWest(r){return this._sw=r instanceof Hr?new Hr(r.lng,r.lat):Hr.convert(r),this}extend(r){const o=this._sw,u=this._ne;let f,m;if(r instanceof Hr)f=r,m=r;else{if(!(r instanceof Yl))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(Yl.convert(r)):this.extend(Hr.convert(r)):typeof r=="object"&&r!==null&&r.hasOwnProperty("lat")&&(r.hasOwnProperty("lon")||r.hasOwnProperty("lng"))?this.extend(Hr.convert(r)):this;if(f=r._sw,m=r._ne,!f||!m)return this}return o||u?(o.lng=Math.min(f.lng,o.lng),o.lat=Math.min(f.lat,o.lat),u.lng=Math.max(m.lng,u.lng),u.lat=Math.max(m.lat,u.lat)):(this._sw=new Hr(f.lng,f.lat),this._ne=new Hr(m.lng,m.lat)),this}getCenter(){return new Hr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Hr(this.getWest(),this.getNorth())}getSouthEast(){return new Hr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:o,lat:u}=Hr.convert(r);let f=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&f}static convert(r){return!r||r instanceof Yl?r:new Yl(r)}}var Mg=1e-6,Vo=typeof Float32Array<"u"?Float32Array:Array;function $S(){var i=new Vo(9);return Vo!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function jS(i,r,o){var u=r[0],f=r[1],m=r[2],y=r[3],x=r[4],E=r[5],T=r[6],P=r[7],O=r[8],F=o[0],V=o[1],G=o[2],K=o[3],oe=o[4],pe=o[5],Ae=o[6],me=o[7],Se=o[8];return i[0]=F*u+V*y+G*T,i[1]=F*f+V*x+G*P,i[2]=F*m+V*E+G*O,i[3]=K*u+oe*y+pe*T,i[4]=K*f+oe*x+pe*P,i[5]=K*m+oe*E+pe*O,i[6]=Ae*u+me*y+Se*T,i[7]=Ae*f+me*x+Se*P,i[8]=Ae*m+me*E+Se*O,i}function Zs(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function P0(i,r){var o=r[0],u=r[1],f=r[2],m=r[3],y=r[4],x=r[5],E=r[6],T=r[7],P=r[8],O=r[9],F=r[10],V=r[11],G=r[12],K=r[13],oe=r[14],pe=r[15],Ae=o*x-u*y,me=o*E-f*y,Se=o*T-m*y,ke=u*E-f*x,Me=u*T-m*x,Je=f*T-m*E,Ze=P*K-O*G,st=P*oe-F*G,xt=P*pe-V*G,nt=O*oe-F*K,ft=O*pe-V*K,dt=F*pe-V*oe,yt=Ae*dt-me*ft+Se*nt+ke*xt-Me*st+Je*Ze;return yt?(i[0]=(x*dt-E*ft+T*nt)*(yt=1/yt),i[1]=(f*ft-u*dt-m*nt)*yt,i[2]=(K*Je-oe*Me+pe*ke)*yt,i[3]=(F*Me-O*Je-V*ke)*yt,i[4]=(E*xt-y*dt-T*st)*yt,i[5]=(o*dt-f*xt+m*st)*yt,i[6]=(oe*Se-G*Je-pe*me)*yt,i[7]=(P*Je-F*Se+V*me)*yt,i[8]=(y*ft-x*xt+T*Ze)*yt,i[9]=(u*xt-o*ft-m*Ze)*yt,i[10]=(G*Me-K*Se+pe*Ae)*yt,i[11]=(O*Se-P*Me-V*Ae)*yt,i[12]=(x*st-y*nt-E*Ze)*yt,i[13]=(o*nt-u*st+f*Ze)*yt,i[14]=(K*me-G*ke-oe*Ae)*yt,i[15]=(P*ke-O*me+F*Ae)*yt,i):null}function pc(i,r,o){var u=r[0],f=r[1],m=r[2],y=r[3],x=r[4],E=r[5],T=r[6],P=r[7],O=r[8],F=r[9],V=r[10],G=r[11],K=r[12],oe=r[13],pe=r[14],Ae=r[15],me=o[0],Se=o[1],ke=o[2],Me=o[3];return i[0]=me*u+Se*x+ke*O+Me*K,i[1]=me*f+Se*E+ke*F+Me*oe,i[2]=me*m+Se*T+ke*V+Me*pe,i[3]=me*y+Se*P+ke*G+Me*Ae,i[4]=(me=o[4])*u+(Se=o[5])*x+(ke=o[6])*O+(Me=o[7])*K,i[5]=me*f+Se*E+ke*F+Me*oe,i[6]=me*m+Se*T+ke*V+Me*pe,i[7]=me*y+Se*P+ke*G+Me*Ae,i[8]=(me=o[8])*u+(Se=o[9])*x+(ke=o[10])*O+(Me=o[11])*K,i[9]=me*f+Se*E+ke*F+Me*oe,i[10]=me*m+Se*T+ke*V+Me*pe,i[11]=me*y+Se*P+ke*G+Me*Ae,i[12]=(me=o[12])*u+(Se=o[13])*x+(ke=o[14])*O+(Me=o[15])*K,i[13]=me*f+Se*E+ke*F+Me*oe,i[14]=me*m+Se*T+ke*V+Me*pe,i[15]=me*y+Se*P+ke*G+Me*Ae,i}function qd(i,r,o){var u,f,m,y,x,E,T,P,O,F,V,G,K=o[0],oe=o[1],pe=o[2];return r===i?(i[12]=r[0]*K+r[4]*oe+r[8]*pe+r[12],i[13]=r[1]*K+r[5]*oe+r[9]*pe+r[13],i[14]=r[2]*K+r[6]*oe+r[10]*pe+r[14],i[15]=r[3]*K+r[7]*oe+r[11]*pe+r[15]):(f=r[1],m=r[2],y=r[3],x=r[4],E=r[5],T=r[6],P=r[7],O=r[8],F=r[9],V=r[10],G=r[11],i[0]=u=r[0],i[1]=f,i[2]=m,i[3]=y,i[4]=x,i[5]=E,i[6]=T,i[7]=P,i[8]=O,i[9]=F,i[10]=V,i[11]=G,i[12]=u*K+x*oe+O*pe+r[12],i[13]=f*K+E*oe+F*pe+r[13],i[14]=m*K+T*oe+V*pe+r[14],i[15]=y*K+P*oe+G*pe+r[15]),i}function mc(i,r,o){var u=o[0],f=o[1],m=o[2];return i[0]=r[0]*u,i[1]=r[1]*u,i[2]=r[2]*u,i[3]=r[3]*u,i[4]=r[4]*f,i[5]=r[5]*f,i[6]=r[6]*f,i[7]=r[7]*f,i[8]=r[8]*m,i[9]=r[9]*m,i[10]=r[10]*m,i[11]=r[11]*m,i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],i}function k0(i,r,o){var u=Math.sin(o),f=Math.cos(o),m=r[4],y=r[5],x=r[6],E=r[7],T=r[8],P=r[9],O=r[10],F=r[11];return r!==i&&(i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]),i[4]=m*f+T*u,i[5]=y*f+P*u,i[6]=x*f+O*u,i[7]=E*f+F*u,i[8]=T*f-m*u,i[9]=P*f-y*u,i[10]=O*f-x*u,i[11]=F*f-E*u,i}function Pg(i,r,o){var u=Math.sin(o),f=Math.cos(o),m=r[0],y=r[1],x=r[2],E=r[3],T=r[8],P=r[9],O=r[10],F=r[11];return r!==i&&(i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]),i[0]=m*f-T*u,i[1]=y*f-P*u,i[2]=x*f-O*u,i[3]=E*f-F*u,i[8]=m*u+T*f,i[9]=y*u+P*f,i[10]=x*u+O*f,i[11]=E*u+F*f,i}function VS(i,r){return i[0]=r[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=r[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=r[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function GS(i,r,o){var u,f,m,y=o[0],x=o[1],E=o[2],T=Math.hypot(y,x,E);return T<Mg?null:(y*=T=1/T,x*=T,E*=T,u=Math.sin(r),f=Math.cos(r),i[0]=y*y*(m=1-f)+f,i[1]=x*y*m+E*u,i[2]=E*y*m-x*u,i[3]=0,i[4]=y*x*m-E*u,i[5]=x*x*m+f,i[6]=E*x*m+y*u,i[7]=0,i[8]=y*E*m+x*u,i[9]=x*E*m-y*u,i[10]=E*E*m+f,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}Math.hypot||(Math.hypot=function(){for(var i=0,r=arguments.length;r--;)i+=arguments[r]*arguments[r];return Math.sqrt(i)});var HB=pc;function L0(){var i=new Vo(3);return Vo!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function qS(i){var r=new Vo(3);return r[0]=i[0],r[1]=i[1],r[2]=i[2],r}function Wd(i){return Math.hypot(i[0],i[1],i[2])}function Mh(i,r,o){var u=new Vo(3);return u[0]=i,u[1]=r,u[2]=o,u}function hl(i,r,o){return i[0]=r[0]+o[0],i[1]=r[1]+o[1],i[2]=r[2]+o[2],i}function O0(i,r,o){return i[0]=r[0]-o[0],i[1]=r[1]-o[1],i[2]=r[2]-o[2],i}function WS(i,r,o){return i[0]=r[0]*o[0],i[1]=r[1]*o[1],i[2]=r[2]*o[2],i}function Zd(i,r,o){return i[0]=Math.min(r[0],o[0]),i[1]=Math.min(r[1],o[1]),i[2]=Math.min(r[2],o[2]),i}function Hd(i,r,o){return i[0]=Math.max(r[0],o[0]),i[1]=Math.max(r[1],o[1]),i[2]=Math.max(r[2],o[2]),i}function ls(i,r,o){return i[0]=r[0]*o,i[1]=r[1]*o,i[2]=r[2]*o,i}function Xd(i,r,o,u){return i[0]=r[0]+o[0]*u,i[1]=r[1]+o[1]*u,i[2]=r[2]+o[2]*u,i}function io(i,r){var o=r[0],u=r[1],f=r[2],m=o*o+u*u+f*f;return m>0&&(m=1/Math.sqrt(m)),i[0]=r[0]*m,i[1]=r[1]*m,i[2]=r[2]*m,i}function Es(i,r){return i[0]*r[0]+i[1]*r[1]+i[2]*r[2]}function D0(i,r,o){var u=r[0],f=r[1],m=r[2],y=o[0],x=o[1],E=o[2];return i[0]=f*E-m*x,i[1]=m*y-u*E,i[2]=u*x-f*y,i}function Bn(i,r,o){var u=r[0],f=r[1],m=r[2],y=o[3]*u+o[7]*f+o[11]*m+o[15];return i[0]=(o[0]*u+o[4]*f+o[8]*m+o[12])/(y=y||1),i[1]=(o[1]*u+o[5]*f+o[9]*m+o[13])/y,i[2]=(o[2]*u+o[6]*f+o[10]*m+o[14])/y,i}function ZS(i,r,o){var u=o[0],f=o[1],m=o[2],y=r[0],x=r[1],E=r[2],T=f*E-m*x,P=m*y-u*E,O=u*x-f*y,F=f*O-m*P,V=m*T-u*O,G=u*P-f*T,K=2*o[3];return P*=K,O*=K,V*=2,G*=2,i[0]=y+(T*=K)+(F*=2),i[1]=x+P+V,i[2]=E+O+G,i}var Kd,Hs=O0,XB=WS,KB=Wd;function HS(i,r,o){return i[0]=r[0]*o,i[1]=r[1]*o,i[2]=r[2]*o,i[3]=r[3]*o,i}function XS(i,r){var o=r[0],u=r[1],f=r[2],m=r[3],y=o*o+u*u+f*f+m*m;return y>0&&(y=1/Math.sqrt(y)),i[0]=o*y,i[1]=u*y,i[2]=f*y,i[3]=m*y,i}function gc(i,r,o){var u=r[0],f=r[1],m=r[2],y=r[3];return i[0]=o[0]*u+o[4]*f+o[8]*m+o[12]*y,i[1]=o[1]*u+o[5]*f+o[9]*m+o[13]*y,i[2]=o[2]*u+o[6]*f+o[10]*m+o[14]*y,i[3]=o[3]*u+o[7]*f+o[11]*m+o[15]*y,i}function KS(){var i=new Vo(4);return Vo!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function YS(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function JS(i,r,o){o*=.5;var u=r[0],f=r[1],m=r[2],y=r[3],x=Math.sin(o),E=Math.cos(o);return i[0]=u*E+y*x,i[1]=f*E+m*x,i[2]=m*E-f*x,i[3]=y*E-u*x,i}function QS(i,r,o){o*=.5;var u=r[0],f=r[1],m=r[2],y=r[3],x=Math.sin(o),E=Math.cos(o);return i[0]=u*E-m*x,i[1]=f*E+y*x,i[2]=m*E+u*x,i[3]=y*E-f*x,i}L0(),Kd=new Vo(4),Vo!=Float32Array&&(Kd[0]=0,Kd[1]=0,Kd[2]=0,Kd[3]=0);var YB=XS;L0(),Mh(1,0,0),Mh(0,1,0),KS(),KS(),$S();const JB=Ne([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:eA}=JB,tA=Ne([{name:"a_pos_3",components:3,type:"Int16"}]);var Yd=Ne([{name:"a_pos",type:"Int16",components:2}]);class R0{constructor(r,o){this.pos=r,this.dir=o}intersectsPlane(r,o,u){const f=Es(o,this.dir);if(Math.abs(f)<1e-6)return!1;const m=((r[0]-this.pos[0])*o[0]+(r[1]-this.pos[1])*o[1]+(r[2]-this.pos[2])*o[2])/f;return u[0]=this.pos[0]+this.dir[0]*m,u[1]=this.pos[1]+this.dir[1]*m,u[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(r,o,u){if(function(V,G){var K=V[0],oe=V[1],pe=V[2],Ae=G[0],me=G[1],Se=G[2];return Math.abs(K-Ae)<=Mg*Math.max(1,Math.abs(K),Math.abs(Ae))&&Math.abs(oe-me)<=Mg*Math.max(1,Math.abs(oe),Math.abs(me))&&Math.abs(pe-Se)<=Mg*Math.max(1,Math.abs(pe),Math.abs(Se))}(this.pos,r)||o===0)return u[0]=u[1]=u[2]=0,!1;const[f,m,y]=this.dir,x=this.pos[0]-r[0],E=this.pos[1]-r[1],T=this.pos[2]-r[2],P=f*f+m*m+y*y,O=2*(x*f+E*m+T*y),F=O*O-4*P*(x*x+E*E+T*T-o*o);if(F<0){const V=Math.max(-O/2,0),G=x+f*V,K=E+m*V,oe=T+y*V,pe=Math.hypot(G,K,oe);return u[0]=G*o/pe,u[1]=K*o/pe,u[2]=oe*o/pe,!1}{const V=(-O-Math.sqrt(F))/(2*P);if(V<0){const G=Math.hypot(x,E,T);return u[0]=x*o/G,u[1]=E*o/G,u[2]=T*o/G,!1}return u[0]=x+f*V,u[1]=E+m*V,u[2]=T+y*V,!0}}}class z0{constructor(r,o,u,f,m){this.TL=r,this.TR=o,this.BR=u,this.BL=f,this.horizon=m}static fromInvProjectionMatrix(r,o,u){const f=[-1,1,1],m=[1,1,1],y=[1,-1,1],x=[-1,-1,1],E=Bn(f,f,r),T=Bn(m,m,r),P=Bn(y,y,r),O=Bn(x,x,r);return new z0(E,T,P,O,o/u)}}class F0{constructor(r,o){this.points=r,this.planes=o}static fromInvProjectionMatrix(r,o,u,f){const m=Math.pow(2,u),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const T=gc([],E,r),P=1/T[3]/o*m;return function(O,F,V){return O[0]=F[0]*V[0],O[1]=F[1]*V[1],O[2]=F[2]*V[2],O[3]=F[3]*V[3],O}(T,T,[P,P,f?1/T[3]:P,P])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const T=io([],D0([],Hs([],y[E[0]],y[E[1]]),Hs([],y[E[2]],y[E[1]]))),P=-Es(T,y[E[1]]);return T.concat(P)});return new F0(y,x)}}class oo{static fromPoints(r){const o=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const f of r)Zd(o,o,f),Hd(u,u,f);return new oo(o,u)}static applyTransform(r,o){const u=r.getCorners();for(let f=0;f<u.length;++f)Bn(u[f],u[f],o);return oo.fromPoints(u)}constructor(r,o){this.min=r,this.max=o,this.center=ls([],hl([],this.min,this.max),.5)}quadrant(r){const o=[r%2==0,r<2],u=qS(this.min),f=qS(this.max);for(let m=0;m<o.length;m++)u[m]=o[m]?this.min[m]:this.center[m],f[m]=o[m]?this.center[m]:this.max[m];return f[2]=this.max[2],new oo(u,f)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,o=this.max;return[[r[0],r[1],r[2]],[o[0],r[1],r[2]],[o[0],o[1],r[2]],[r[0],o[1],r[2]],[r[0],r[1],o[2]],[o[0],r[1],o[2]],[o[0],o[1],o[2]],[r[0],o[1],o[2]]]}intersects(r){const o=this.getCorners();let u=!0;for(let f=0;f<r.planes.length;f++){const m=r.planes[f];let y=0;for(let x=0;x<o.length;x++)y+=Es(m,o[x])+m[3]>=0;if(y===0)return 0;y!==o.length&&(u=!1)}if(u)return 2;for(let f=0;f<3;f++){let m=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let x=0;x<r.points.length;x++){const E=r.points[x][f]-this.min[f];m=Math.min(m,E),y=Math.max(y,E)}if(y<0||m>this.max[f]-this.min[f])return 0}return 1}}const B0=5,rA=6,wa=Xt/Math.PI/2,QB=16383,yc=64,Jd=[yc,32,16],Ts=-wa,Ss=wa,e4=[new oo([Ts,Ts,Ts],[Ss,Ss,Ss]),new oo([Ts,Ts,Ts],[0,0,Ss]),new oo([0,Ts,Ts],[Ss,0,Ss]),new oo([Ts,0,Ts],[0,Ss,Ss]),new oo([0,0,Ts],[Ss,Ss,Ss])];function kg(i){return i*wa/tp}function nA(i,r,o,u=!0){const f=ls([],i._camera.position,i.worldSize),m=[r,o,1,1];gc(m,m,i.pixelMatrixInverse),HS(m,m,1/m[3]);const y=io([],Hs([],m,f)),x=i.globeMatrix,E=[x[12],x[13],x[14]],T=Hs([],E,f),P=Wd(T),O=io([],T),F=i.worldSize/(2*Math.PI),V=Es(O,y),G=Math.asin(F/P);if(G<Math.acos(V)){if(!u)return null;const xt=[],nt=[];ls(xt,y,P/V),io(nt,Hs(nt,xt,T)),io(y,hl(y,T,ls(y,nt,Math.tan(G)*P)))}const K=[];new R0(f,y).closestPointOnSphere(E,F,K);const oe=io([],$t(x,0)),pe=io([],$t(x,1)),Ae=io([],$t(x,2)),me=Es(oe,K),Se=Es(pe,K),ke=Es(Ae,K),Me=q(Math.asin(-Se/F));let Je=q(Math.atan2(me,ke));Je=i.center.lng+function(xt,nt){const ft=(nt-xt+180)%360-180;return ft<-180?ft+360:ft}(i.center.lng,Je);const Ze=Ta(Je),st=_e(Sa(Me),0,1);return new Oh(Ze,st)}class t4{constructor(r,o,u){this.a=Hs([],r,u),this.b=Hs([],o,u),this.center=u;const f=io([],this.a),m=io([],this.b);this.angle=Math.acos(Es(f,m))}}function N0(i,r){if(i.angle===0)return null;let o;return o=i.a[r]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[r]/i.a[r]/Math.sin(i.angle)-1/Math.tan(i.angle)),o<0||o>1?null:function(u,f,m,y){const x=Math.sin(m);return u*(Math.sin((1-y)*m)/x)+f*(Math.sin(y*m)/x)}(i.a[r],i.b[r],i.angle,_e(o,0,1))+i.center[r]}function Ea(i){if(i.z<=1)return e4[i.z+2*i.y+i.x];const r=U0(Lg(i));return oo.fromPoints(r)}function _c(i,r,o){return ls(i,i,1-o),Xd(i,i,r,o)}function iA(i,r){const o=Lh(r.zoom);if(o===0)return Ea(i);const u=Lg(i),f=U0(u),m=Ta(u.getWest())*r.worldSize,y=Ta(u.getEast())*r.worldSize,x=Sa(u.getNorth())*r.worldSize,E=Sa(u.getSouth())*r.worldSize,T=[m,x,0],P=[y,x,0],O=[m,E,0],F=[y,E,0],V=P0([],r.globeMatrix);return Bn(T,T,V),Bn(P,P,V),Bn(O,O,V),Bn(F,F,V),f[0]=_c(f[0],O,o),f[1]=_c(f[1],F,o),f[2]=_c(f[2],P,o),f[3]=_c(f[3],T,o),oo.fromPoints(f)}function oA(i,r,o){for(const u of i)Bn(u,u,r),ls(u,u,o)}function r4(i,r,o){const u=r/i.worldSize,f=i.globeMatrix;if(o.z<=1){const Ze=Ea(o).getCorners();return oA(Ze,f,u),oo.fromPoints(Ze)}const m=Lg(o),y=U0(m);oA(y,f,u);const x=Number.MAX_VALUE,E=[-x,-x,-x],T=[x,x,x];if(m.contains(i.center)){for(const xt of y)Zd(T,T,xt),Hd(E,E,xt);E[2]=0;const Ze=i.point,st=[Ze.x*u,Ze.y*u,0];return Zd(T,T,st),Hd(E,E,st),new oo(T,E)}const P=[f[12]*u,f[13]*u,f[14]*u],O=m.getCenter(),F=_e(i.center.lat,-Bi,Bi),V=_e(O.lat,-Bi,Bi),G=Ta(i.center.lng),K=Sa(F);let oe=G-Ta(O.lng);const pe=K-Sa(V);oe>.5?oe-=1:oe<-.5&&(oe+=1);let Ae=0;Math.abs(oe)>Math.abs(pe)?Ae=oe>=0?1:3:(Ae=pe>=0?0:2,Xd(P,P,[f[4]*u,f[5]*u,f[6]*u],-Math.sin(ie(pe>=0?m.getSouth():m.getNorth()))*wa));const me=y[Ae],Se=y[(Ae+1)%4],ke=new t4(me,Se,P),Me=[N0(ke,0)||me[0],N0(ke,1)||me[1],N0(ke,2)||me[2]],Je=Lh(i.zoom);if(Je>0){const Ze=function({x:xt,y:nt,z:ft},dt,yt,At,it){const Rt=1/(1<<ft);let Vt=xt*Rt,Ft=Vt+Rt,lr=nt*Rt,It=lr+Rt,Zt=0;const ur=(Vt+Ft)/2-At;return ur>.5?Zt=-1:ur<-.5&&(Zt=1),Vt=((Vt+Zt)*dt-(At*=dt))*yt+At,Ft=((Ft+Zt)*dt-At)*yt+At,lr=(lr*dt-(it*=dt))*yt+it,It=(It*dt-it)*yt+it,[[Vt,It,0],[Ft,It,0],[Ft,lr,0],[Vt,lr,0]]}(o,r,i._pixelsPerMercatorPixel,G,K);for(let xt=0;xt<y.length;xt++)_c(y[xt],Ze[xt],Je);const st=hl([],Ze[Ae],Ze[(Ae+1)%4]);ls(st,st,.5),_c(Me,st,Je)}for(const Ze of y)Zd(T,T,Ze),Hd(E,E,Ze);return T[2]=Math.min(me[2],Se[2]),Zd(T,T,Me),Hd(E,E,Me),new oo(T,E)}function Lg({x:i,y:r,z:o}){const u=1/(1<<o),f=new Hr(us(i*u),Fi((r+1)*u)),m=new Hr(us((i+1)*u),Fi(r*u));return new Yl(f,m)}function U0(i){const r=ie(i.getNorth()),o=ie(i.getSouth()),u=Math.cos(r),f=Math.cos(o),m=Math.sin(r),y=Math.sin(o),x=i.getWest(),E=i.getEast();return[Ph(f,y,x),Ph(f,y,E),Ph(u,m,E),Ph(u,m,x)]}function Ph(i,r,o,u=wa){return o=ie(o),[i*Math.sin(o)*u,-r*u,i*Math.cos(o)*u]}function kh(i,r,o){return Ph(Math.cos(ie(i)),Math.sin(ie(i)),r,o)}function Qd(i,r,o,u){const f=1<<o.z,m=(i/Xt+o.x)/f;return kh(Fi((r/Xt+o.y)/f),us(m),u)}function Og({min:i,max:r}){return QB/Math.max(r[0]-i[0],r[1]-i[1],r[2]-i[2])}const sA=new Float64Array(16);function ep(i){const r=Og(i),o=VS(sA,[r,r,r]);return qd(o,o,((u=[])[0]=-(f=i.min)[0],u[1]=-f[1],u[2]=-f[2],u));var u,f}function $0(i){const r=(u=i.min,(o=sA)[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=u[0],o[13]=u[1],o[14]=u[2],o[15]=1,o);var o,u;const f=1/Og(i);return mc(r,r,[f,f,f])}function aA(i,r,o,u,f){const m=function(E){const T=Xt/(2*Math.PI);return E/(2*Math.PI)/T}(o),y=[i,r,-o/(2*Math.PI)],x=Zs(new Float64Array(16));return qd(x,x,y),mc(x,x,[m,m,m]),k0(x,x,ie(-f)),Pg(x,x,ie(-u)),x}function Lh(i){return qe(B0,rA,i)}function lA(i,r){const o=kh(r.lat,r.lng),u=function(G){const K=kh(G._center.lat,G._center.lng);let oe=D0([],Mh(0,1,0),K);const pe=GS([],-G.angle,K);oe=Bn(oe,oe,pe),GS(pe,-G._pitch,oe);const Ae=io([],K);return ls(Ae,Ae,kg(G.cameraToCenterDistance/G.pixelsPerMeter)),Bn(Ae,Ae,pe),hl([],K,Ae)}(i);return y=(f=O0([],u,o))[0],x=f[1],E=f[2],T=(m=o)[0],P=m[1],O=m[2],V=(F=Math.sqrt(y*y+x*x+E*E)*Math.sqrt(T*T+P*P+O*O))&&Es(f,m)/F,Math.acos(Math.min(Math.max(V,-1),1));var f,m,y,x,E,T,P,O,F,V}function j0(i,r){return lA(i,r)>Math.PI/2*1.01}const uA=ie(85),n4=Math.cos(uA),i4=Math.sin(uA),tp=63710088e-1,cA=2*Math.PI*tp;class Jl{constructor(r,o){if(isNaN(r)||isNaN(o))throw new Error(`Invalid LngLat object: (${r}, ${o})`);if(this.lng=+r,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Jl(Pe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const o=Math.PI/180,u=this.lat*o,f=r.lat*o,m=Math.sin(u)*Math.sin(f)+Math.cos(u)*Math.cos(f)*Math.cos((r.lng-this.lng)*o);return tp*Math.acos(Math.min(m,1))}toBounds(r=0){const o=360*r/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new Yl(new Jl(this.lng-u,this.lat-o),new Jl(this.lng+u,this.lat+o))}toEcef(r){const o=kg(r);return kh(this.lat,this.lng,wa+o)}static convert(r){if(r instanceof Jl)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new Jl(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new Jl(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Hr=Jl;function V0(i){return cA*Math.cos(i*Math.PI/180)}function Ta(i){return(180+i)/360}function Sa(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Xs(i,r){return i/V0(r)}function us(i){return 360*i-180}function Fi(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function hA(i,r){return i*V0(Fi(r))}const Bi=85.051129;function fA(i){return 1/Math.cos(i*Math.PI/180)}class Oh{constructor(r,o,u=0){this.x=+r,this.y=+o,this.z=+u}static fromLngLat(r,o=0){const u=Hr.convert(r);return new Oh(Ta(u.lng),Sa(u.lat),Xs(o,u.lat))}toLngLat(){return new Hr(us(this.x),Fi(this.y))}toAltitude(){return hA(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/cA*fA(Fi(this.y))}}function G0(i,r,o,u,f,m,y,x,E){const T=(r+u)/2,P=(o+f)/2,O=new he(T,P);x(O),function(F,V,G,K,oe,pe){const Ae=G-oe,me=K-pe;return Math.abs((K-V)*Ae-(G-F)*me)/Math.hypot(Ae,me)}(O.x,O.y,m.x,m.y,y.x,y.y)>=E?(G0(i,r,o,T,P,m,O,x,E),G0(i,T,P,u,f,O,y,x,E)):i.push(y)}function dA(i,r,o){let u=i[0],f=u.x,m=u.y;r(u);const y=[u];for(let x=1;x<i.length;x++){const E=i[x],{x:T,y:P}=E;r(E),G0(y,f,m,T,P,u,E,r,o),f=T,m=P,u=E}return y}function q0(i,r,o,u){if(u(r,o)){const f=r.add(o)._mult(.5);q0(i,r,f,u),q0(i,f,o,u)}else i.push(o)}function o4(i,r){let o=i[0];const u=[o];for(let f=1;f<i.length;f++){const m=i[f];q0(u,o,m,r),o=m}return u}const W0=Math.pow(2,14)-1,pA=-W0-1;function s4(i,r){const o=Math.round(i.x*r),u=Math.round(i.y*r);return i.x=_e(o,pA,W0),i.y=_e(u,pA,W0),(o<i.x||o>i.x+1||u<i.y||u>i.y+1)&&et("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function fl(i,r,o){const u=i.loadGeometry(),f=i.extent,m=Xt/f;if(r&&o&&o.projection.isReprojectedInTileSpace){const y=1<<r.z,{scale:x,x:E,y:T,projection:P}=o,O=F=>{const V=us((r.x+F.x/f)/y),G=Fi((r.y+F.y/f)/y),K=P.project(V,G);F.x=(K.x*x-E)*f,F.y=(K.y*x-T)*f};for(let F=0;F<u.length;F++)if(i.type!==1)u[F]=dA(u[F],O,1);else{const V=[];for(const G of u[F])G.x<0||G.x>=f||G.y<0||G.y>=f||(O(G),V.push(G));u[F]=V}}for(const y of u)for(const x of y)s4(x,m);return u}function vc(i,r){return{type:i.type,id:i.id,properties:i.properties,geometry:r?fl(i):[]}}function Dg(i,r,o,u,f){i.emplaceBack(2*r+(u+1)/2,2*o+(f+1)/2)}function Rg(i,r,o){i.emplaceBack(r.x,r.y,r.z,o[0]*16384,o[1]*16384,o[2]*16384)}class Z0{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(o=>o.id),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new vt,this.indexArray=new qt,this.segments=new qn,this.programConfigurations=new dc(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(r,o,u,f){const m=this.layers[0],y=[];let x=null;m.type==="circle"&&(x=m.layout.get("circle-sort-key"));for(const{feature:T,id:P,index:O,sourceLayerIndex:F}of r){const V=this.layers[0]._featureFilter.needGeometry,G=vc(T,V);if(!this.layers[0]._featureFilter.filter(new L(this.zoom),G,u))continue;const K=x?x.evaluate(G,{},u):void 0,oe={id:P,properties:T.properties,type:T.type,sourceLayerIndex:F,index:O,geometry:V?G.geometry:fl(T,u,f),patterns:{},sortKey:K};y.push(oe)}x&&y.sort((T,P)=>T.sortKey-P.sortKey);let E=null;f.projection.name==="globe"&&(this.globeExtVertexArray=new bt,E=f.projection);for(const T of y){const{geometry:P,index:O,sourceLayerIndex:F}=T,V=r[O].feature;this.addFeature(T,P,O,o.availableImages,u,E),o.featureIndex.insert(V,P,O,F,this.index)}}update(r,o,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,o,this.stateDependentLayers,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,WB.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,ZB.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(r,o,u,f,m,y){for(const x of o)for(const E of x){const T=E.x,P=E.y;if(T<0||T>=Xt||P<0||P>=Xt)continue;if(y){const V=y.projectTilePoint(T,P,m),G=y.upVector(m,T,P),K=this.globeExtVertexArray;Rg(K,V,G),Rg(K,V,G),Rg(K,V,G),Rg(K,V,G)}const O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),F=O.vertexLength;Dg(this.layoutVertexArray,T,P,-1,-1),Dg(this.layoutVertexArray,T,P,1,-1),Dg(this.layoutVertexArray,T,P,1,1),Dg(this.layoutVertexArray,T,P,-1,1),this.indexArray.emplaceBack(F,F+1,F+2),this.indexArray.emplaceBack(F,F+2,F+3),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,{},f,m)}}function mA(i,r){for(let o=0;o<i.length;o++)if(xc(r,i[o]))return!0;for(let o=0;o<r.length;o++)if(xc(i,r[o]))return!0;return!!H0(i,r)}function a4(i,r,o){return!!xc(i,r)||!!X0(r,i,o)}function gA(i,r){if(i.length===1)return _A(r,i[0]);for(let o=0;o<r.length;o++){const u=r[o];for(let f=0;f<u.length;f++)if(xc(i,u[f]))return!0}for(let o=0;o<i.length;o++)if(_A(r,i[o]))return!0;for(let o=0;o<r.length;o++)if(H0(i,r[o]))return!0;return!1}function l4(i,r,o){if(i.length>1){if(H0(i,r))return!0;for(let u=0;u<r.length;u++)if(X0(r[u],i,o))return!0}for(let u=0;u<i.length;u++)if(X0(i[u],r,o))return!0;return!1}function H0(i,r){if(i.length===0||r.length===0)return!1;for(let o=0;o<i.length-1;o++){const u=i[o],f=i[o+1];for(let m=0;m<r.length-1;m++)if(u4(u,f,r[m],r[m+1]))return!0}return!1}function u4(i,r,o,u){return Ce(i,o,u)!==Ce(r,o,u)&&Ce(i,r,o)!==Ce(i,r,u)}function X0(i,r,o){const u=o*o;if(r.length===1)return i.distSqr(r[0])<u;for(let f=1;f<r.length;f++)if(yA(i,r[f-1],r[f])<u)return!0;return!1}function yA(i,r,o){const u=r.distSqr(o);if(u===0)return i.distSqr(r);const f=((i.x-r.x)*(o.x-r.x)+(i.y-r.y)*(o.y-r.y))/u;return i.distSqr(f<0?r:f>1?o:o.sub(r)._mult(f)._add(r))}function _A(i,r){let o,u,f,m=!1;for(let y=0;y<i.length;y++){o=i[y];for(let x=0,E=o.length-1;x<o.length;E=x++)u=o[x],f=o[E],u.y>r.y!=f.y>r.y&&r.x<(f.x-u.x)*(r.y-u.y)/(f.y-u.y)+u.x&&(m=!m)}return m}function xc(i,r){let o=!1;for(let u=0,f=i.length-1;u<i.length;f=u++){const m=i[u],y=i[f];m.y>r.y!=y.y>r.y&&r.x<(y.x-m.x)*(r.y-m.y)/(y.y-m.y)+m.x&&(o=!o)}return o}function vA(i,r,o,u,f){for(const y of i)if(r<=y.x&&o<=y.y&&u>=y.x&&f>=y.y)return!0;const m=[new he(r,o),new he(r,f),new he(u,f),new he(u,o)];if(i.length>2){for(const y of m)if(xc(i,y))return!0}for(let y=0;y<i.length-1;y++)if(c4(i[y],i[y+1],m))return!0;return!1}function c4(i,r,o){const u=o[0],f=o[2];if(i.x<u.x&&r.x<u.x||i.x>f.x&&r.x>f.x||i.y<u.y&&r.y<u.y||i.y>f.y&&r.y>f.y)return!1;const m=Ce(i,r,o[0]);return m!==Ce(i,r,o[1])||m!==Ce(i,r,o[2])||m!==Ce(i,r,o[3])}function Dh(i,r,o){const u=r.paint.get(i).value;return u.kind==="constant"?u.value:o.programConfigurations.get(r.id).getMaxValue(i)}function zg(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function xA(i,r,o,u,f){if(!r[0]&&!r[1])return i;const m=he.convert(r)._mult(f);o==="viewport"&&m._rotate(-u);const y=[];for(let x=0;x<i.length;x++)y.push(i[x].sub(m));return y}function bA(i,r,o,u){const f=he.convert(i)._mult(u);return r==="viewport"&&f._rotate(-o),f}Ut(Z0,"CircleBucket",{omit:["layers"]});const h4=new be({"circle-sort-key":new ae(ot.layout_circle["circle-sort-key"])});var f4={paint:new be({"circle-radius":new ae(ot.paint_circle["circle-radius"]),"circle-color":new ae(ot.paint_circle["circle-color"]),"circle-blur":new ae(ot.paint_circle["circle-blur"]),"circle-opacity":new ae(ot.paint_circle["circle-opacity"]),"circle-translate":new X(ot.paint_circle["circle-translate"]),"circle-translate-anchor":new X(ot.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new X(ot.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new X(ot.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ae(ot.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ae(ot.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ae(ot.paint_circle["circle-stroke-opacity"])}),layout:h4};function wA(i,r,o,u,f,m,y,x,E){if(m&&i.queryGeometry.isAboveHorizon)return!1;m&&(E*=i.pixelToTileUnitsFactor);const T=i.tileID.canonical,P=o.projection.upVectorScale(T,o.center.lat,o.worldSize).metersToTile;for(const O of r)for(const F of O){const V=F.add(x),G=f&&o.elevation?o.elevation.exaggeration()*f.getElevationAt(V.x,V.y,!0):0,K=o.projection.projectTilePoint(V.x,V.y,T);if(G>0){const me=o.projection.upVector(T,V.x,V.y);K.x+=me[0]*P*G,K.y+=me[1]*P*G,K.z+=me[2]*P*G}const oe=m?V:d4(K.x,K.y,K.z,u),pe=m?i.tilespaceRays.map(me=>m4(me,G)):i.queryGeometry.screenGeometry,Ae=gc([],[K.x,K.y,K.z,1],u);if(!y&&m?E*=Ae[3]/o.cameraToCenterDistance:y&&!m&&(E*=o.cameraToCenterDistance/Ae[3]),m){const me=Fi((F.y/Xt+T.y)/(1<<T.z));E/=o.projection.pixelsPerMeter(me,1)/Xs(1,me)}if(a4(pe,oe,E))return!0}return!1}function d4(i,r,o,u){const f=gc([],[i,r,o,1],u);return new he(f[0]/f[3],f[1]/f[3])}const EA=Mh(0,0,0),p4=Mh(0,0,1);function m4(i,r){const o=L0();return EA[2]=r,i.intersectsPlane(EA,p4,o),new he(o[0],o[1])}class TA extends Z0{}function SA(i,{width:r,height:o},u,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==r*o*u)throw new RangeError("mismatched image size")}else f=new Uint8Array(r*o*u);return i.width=r,i.height=o,i.data=f,i}function AA(i,r,o){const{width:u,height:f}=r;u===i.width&&f===i.height||(K0(i,r,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,u),height:Math.min(i.height,f)},o),i.width=u,i.height=f,i.data=r.data)}function K0(i,r,o,u,f,m){if(f.width===0||f.height===0)return r;if(f.width>i.width||f.height>i.height||o.x>i.width-f.width||o.y>i.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>r.width||f.height>r.height||u.x>r.width-f.width||u.y>r.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const y=i.data,x=r.data;for(let E=0;E<f.height;E++){const T=((o.y+E)*i.width+o.x)*m,P=((u.y+E)*r.width+u.x)*m;for(let O=0;O<f.width*m;O++)x[P+O]=y[T+O]}return r}Ut(TA,"HeatmapBucket",{omit:["layers"]});class dl{constructor(r,o){SA(this,r,1,o)}resize(r){AA(this,new dl(r),1)}clone(){return new dl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,o,u,f,m){K0(r,o,u,f,m,1)}}class Go{constructor(r,o){SA(this,r,4,o)}resize(r){AA(this,new Go(r),4)}replace(r,o){o?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Go({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,o,u,f,m){K0(r,o,u,f,m,4)}}Ut(dl,"AlphaImage"),Ut(Go,"RGBAImage");var g4={paint:new be({"heatmap-radius":new ae(ot.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ae(ot.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new X(ot.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ge(ot.paint_heatmap["heatmap-color"]),"heatmap-opacity":new X(ot.paint_heatmap["heatmap-opacity"])})};function Y0(i){const r={},o=i.resolution||256,u=i.clips?i.clips.length:1,f=i.image||new Go({width:o,height:u}),m=(y,x,E)=>{r[i.evaluationKey]=E;const T=i.expression.evaluate(r);f.data[y+x+0]=Math.floor(255*T.r/T.a),f.data[y+x+1]=Math.floor(255*T.g/T.a),f.data[y+x+2]=Math.floor(255*T.b/T.a),f.data[y+x+3]=Math.floor(255*T.a)};if(i.clips)for(let y=0,x=0;y<u;++y,x+=4*o)for(let E=0,T=0;E<o;E++,T+=4){const P=E/(o-1),{start:O,end:F}=i.clips[y];m(x,T,O*(1-P)+F*P)}else for(let y=0,x=0;y<o;y++,x+=4)m(0,x,y/(o-1));return f}var y4={paint:new be({"hillshade-illumination-direction":new X(ot.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new X(ot.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new X(ot.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new X(ot.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new X(ot.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new X(ot.paint_hillshade["hillshade-accent-color"])})};const _4=Ne([{name:"a_pos",components:2,type:"Int16"}],4),{members:v4}=_4;var J0={exports:{}};function Fg(i,r,o){o=o||2;var u,f,m,y,x,E,T,P=r&&r.length,O=P?r[0]*o:i.length,F=CA(i,0,O,o,!0),V=[];if(!F||F.next===F.prev)return V;if(P&&(F=function(K,oe,pe,Ae){var me,Se,ke,Me=[];for(me=0,Se=oe.length;me<Se;me++)(ke=CA(K,oe[me]*Ae,me<Se-1?oe[me+1]*Ae:K.length,Ae,!1))===ke.next&&(ke.steiner=!0),Me.push(C4(ke));for(Me.sort(T4),me=0;me<Me.length;me++)pe=S4(Me[me],pe);return pe}(i,r,F,o)),i.length>80*o){u=m=i[0],f=y=i[1];for(var G=o;G<O;G+=o)(x=i[G])<u&&(u=x),(E=i[G+1])<f&&(f=E),x>m&&(m=x),E>y&&(y=E);T=(T=Math.max(m-u,y-f))!==0?32767/T:0}return rp(F,V,o,u,f,T,0),V}function CA(i,r,o,u,f){var m,y;if(f===tx(i,r,o,u)>0)for(m=r;m<o;m+=u)y=PA(m,i[m],i[m+1],y);else for(m=o-u;m>=r;m-=u)y=PA(m,i[m],i[m+1],y);return y&&Bg(y,y.next)&&(ip(y),y=y.next),y}function bc(i,r){if(!i)return i;r||(r=i);var o,u=i;do if(o=!1,u.steiner||!Bg(u,u.next)&&Wn(u.prev,u,u.next)!==0)u=u.next;else{if(ip(u),(u=r=u.prev)===u.next)break;o=!0}while(o||u!==r);return r}function rp(i,r,o,u,f,m,y){if(i){!y&&m&&function(P,O,F,V){var G=P;do G.z===0&&(G.z=Q0(G.x,G.y,O,F,V)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next;while(G!==P);G.prevZ.nextZ=null,G.prevZ=null,function(K){var oe,pe,Ae,me,Se,ke,Me,Je,Ze=1;do{for(pe=K,K=null,Se=null,ke=0;pe;){for(ke++,Ae=pe,Me=0,oe=0;oe<Ze&&(Me++,Ae=Ae.nextZ);oe++);for(Je=Ze;Me>0||Je>0&&Ae;)Me!==0&&(Je===0||!Ae||pe.z<=Ae.z)?(me=pe,pe=pe.nextZ,Me--):(me=Ae,Ae=Ae.nextZ,Je--),Se?Se.nextZ=me:K=me,me.prevZ=Se,Se=me;pe=Ae}Se.nextZ=null,Ze*=2}while(ke>1)}(G)}(i,u,f,m);for(var x,E,T=i;i.prev!==i.next;)if(x=i.prev,E=i.next,m?b4(i,u,f,m):x4(i))r.push(x.i/o|0),r.push(i.i/o|0),r.push(E.i/o|0),ip(i),i=E.next,T=E.next;else if((i=E)===T){y?y===1?rp(i=w4(bc(i),r,o),r,o,u,f,m,2):y===2&&E4(i,r,o,u,f,m):rp(bc(i),r,o,u,f,m,1);break}}}function x4(i){var r=i.prev,o=i,u=i.next;if(Wn(r,o,u)>=0)return!1;for(var f=r.x,m=o.x,y=u.x,x=r.y,E=o.y,T=u.y,P=f<m?f<y?f:y:m<y?m:y,O=x<E?x<T?x:T:E<T?E:T,F=f>m?f>y?f:y:m>y?m:y,V=x>E?x>T?x:T:E>T?E:T,G=u.next;G!==r;){if(G.x>=P&&G.x<=F&&G.y>=O&&G.y<=V&&Rh(f,x,m,E,y,T,G.x,G.y)&&Wn(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function b4(i,r,o,u){var f=i.prev,m=i,y=i.next;if(Wn(f,m,y)>=0)return!1;for(var x=f.x,E=m.x,T=y.x,P=f.y,O=m.y,F=y.y,V=x<E?x<T?x:T:E<T?E:T,G=P<O?P<F?P:F:O<F?O:F,K=x>E?x>T?x:T:E>T?E:T,oe=P>O?P>F?P:F:O>F?O:F,pe=Q0(V,G,r,o,u),Ae=Q0(K,oe,r,o,u),me=i.prevZ,Se=i.nextZ;me&&me.z>=pe&&Se&&Se.z<=Ae;){if(me.x>=V&&me.x<=K&&me.y>=G&&me.y<=oe&&me!==f&&me!==y&&Rh(x,P,E,O,T,F,me.x,me.y)&&Wn(me.prev,me,me.next)>=0||(me=me.prevZ,Se.x>=V&&Se.x<=K&&Se.y>=G&&Se.y<=oe&&Se!==f&&Se!==y&&Rh(x,P,E,O,T,F,Se.x,Se.y)&&Wn(Se.prev,Se,Se.next)>=0))return!1;Se=Se.nextZ}for(;me&&me.z>=pe;){if(me.x>=V&&me.x<=K&&me.y>=G&&me.y<=oe&&me!==f&&me!==y&&Rh(x,P,E,O,T,F,me.x,me.y)&&Wn(me.prev,me,me.next)>=0)return!1;me=me.prevZ}for(;Se&&Se.z<=Ae;){if(Se.x>=V&&Se.x<=K&&Se.y>=G&&Se.y<=oe&&Se!==f&&Se!==y&&Rh(x,P,E,O,T,F,Se.x,Se.y)&&Wn(Se.prev,Se,Se.next)>=0)return!1;Se=Se.nextZ}return!0}function w4(i,r,o){var u=i;do{var f=u.prev,m=u.next.next;!Bg(f,m)&&IA(f,u,u.next,m)&&np(f,m)&&np(m,f)&&(r.push(f.i/o|0),r.push(u.i/o|0),r.push(m.i/o|0),ip(u),ip(u.next),u=i=m),u=u.next}while(u!==i);return bc(u)}function E4(i,r,o,u,f,m){var y=i;do{for(var x=y.next.next;x!==y.prev;){if(y.i!==x.i&&I4(y,x)){var E=MA(y,x);return y=bc(y,y.next),E=bc(E,E.next),rp(y,r,o,u,f,m,0),void rp(E,r,o,u,f,m,0)}x=x.next}y=y.next}while(y!==i)}function T4(i,r){return i.x-r.x}function S4(i,r){var o=function(f,m){var y,x=m,E=f.x,T=f.y,P=-1/0;do{if(T<=x.y&&T>=x.next.y&&x.next.y!==x.y){var O=x.x+(T-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(O<=E&&O>P&&(P=O,y=x.x<x.next.x?x:x.next,O===E))return y}x=x.next}while(x!==m);if(!y)return null;var F,V=y,G=y.x,K=y.y,oe=1/0;x=y;do E>=x.x&&x.x>=G&&E!==x.x&&Rh(T<K?E:P,T,G,K,T<K?P:E,T,x.x,x.y)&&(F=Math.abs(T-x.y)/(E-x.x),np(x,f)&&(F<oe||F===oe&&(x.x>y.x||x.x===y.x&&A4(y,x)))&&(y=x,oe=F)),x=x.next;while(x!==V);return y}(i,r);if(!o)return r;var u=MA(o,i);return bc(u,u.next),bc(o,o.next)}function A4(i,r){return Wn(i.prev,i,r.prev)<0&&Wn(r.next,i,i.next)<0}function Q0(i,r,o,u,f){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-o)*f|0)|i<<8))|i<<4))|i<<2))|i<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-u)*f|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function C4(i){var r=i,o=i;do(r.x<o.x||r.x===o.x&&r.y<o.y)&&(o=r),r=r.next;while(r!==i);return o}function Rh(i,r,o,u,f,m,y,x){return(f-y)*(r-x)>=(i-y)*(m-x)&&(i-y)*(u-x)>=(o-y)*(r-x)&&(o-y)*(m-x)>=(f-y)*(u-x)}function I4(i,r){return i.next.i!==r.i&&i.prev.i!==r.i&&!function(o,u){var f=o;do{if(f.i!==o.i&&f.next.i!==o.i&&f.i!==u.i&&f.next.i!==u.i&&IA(f,f.next,o,u))return!0;f=f.next}while(f!==o);return!1}(i,r)&&(np(i,r)&&np(r,i)&&function(o,u){var f=o,m=!1,y=(o.x+u.x)/2,x=(o.y+u.y)/2;do f.y>x!=f.next.y>x&&f.next.y!==f.y&&y<(f.next.x-f.x)*(x-f.y)/(f.next.y-f.y)+f.x&&(m=!m),f=f.next;while(f!==o);return m}(i,r)&&(Wn(i.prev,i,r.prev)||Wn(i,r.prev,r))||Bg(i,r)&&Wn(i.prev,i,i.next)>0&&Wn(r.prev,r,r.next)>0)}function Wn(i,r,o){return(r.y-i.y)*(o.x-r.x)-(r.x-i.x)*(o.y-r.y)}function Bg(i,r){return i.x===r.x&&i.y===r.y}function IA(i,r,o,u){var f=Ug(Wn(i,r,o)),m=Ug(Wn(i,r,u)),y=Ug(Wn(o,u,i)),x=Ug(Wn(o,u,r));return f!==m&&y!==x||!(f!==0||!Ng(i,o,r))||!(m!==0||!Ng(i,u,r))||!(y!==0||!Ng(o,i,u))||!(x!==0||!Ng(o,r,u))}function Ng(i,r,o){return r.x<=Math.max(i.x,o.x)&&r.x>=Math.min(i.x,o.x)&&r.y<=Math.max(i.y,o.y)&&r.y>=Math.min(i.y,o.y)}function Ug(i){return i>0?1:i<0?-1:0}function np(i,r){return Wn(i.prev,i,i.next)<0?Wn(i,r,i.next)>=0&&Wn(i,i.prev,r)>=0:Wn(i,r,i.prev)<0||Wn(i,i.next,r)<0}function MA(i,r){var o=new ex(i.i,i.x,i.y),u=new ex(r.i,r.x,r.y),f=i.next,m=r.prev;return i.next=r,r.prev=i,o.next=f,f.prev=o,u.next=o,o.prev=u,m.next=u,u.prev=m,u}function PA(i,r,o,u){var f=new ex(i,r,o);return u?(f.next=u.next,f.prev=u,u.next.prev=f,u.next=f):(f.prev=f,f.next=f),f}function ip(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function ex(i,r,o){this.i=i,this.x=r,this.y=o,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function tx(i,r,o,u){for(var f=0,m=r,y=o-u;m<o;m+=u)f+=(i[y]-i[m])*(i[m+1]+i[y+1]),y=m;return f}J0.exports=Fg,J0.exports.default=Fg,Fg.deviation=function(i,r,o,u){var f=r&&r.length,m=Math.abs(tx(i,0,f?r[0]*o:i.length,o));if(f)for(var y=0,x=r.length;y<x;y++)m-=Math.abs(tx(i,r[y]*o,y<x-1?r[y+1]*o:i.length,o));var E=0;for(y=0;y<u.length;y+=3){var T=u[y]*o,P=u[y+1]*o,O=u[y+2]*o;E+=Math.abs((i[T]-i[O])*(i[P+1]-i[T+1])-(i[T]-i[P])*(i[O+1]-i[T+1]))}return m===0&&E===0?0:Math.abs((E-m)/m)},Fg.flatten=function(i){for(var r=i[0][0].length,o={vertices:[],holes:[],dimensions:r},u=0,f=0;f<i.length;f++){for(var m=0;m<i[f].length;m++)for(var y=0;y<r;y++)o.vertices.push(i[f][m][y]);f>0&&o.holes.push(u+=i[f-1].length)}return o};var rx=Z(J0.exports);function M4(i,r,o,u,f){kA(i,r,o,u||i.length-1,f||P4)}function kA(i,r,o,u,f){for(;u>o;){if(u-o>600){var m=u-o+1,y=r-o+1,x=Math.log(m),E=.5*Math.exp(2*x/3),T=.5*Math.sqrt(x*E*(m-E)/m)*(y-m/2<0?-1:1);kA(i,r,Math.max(o,Math.floor(r-y*E/m+T)),Math.min(u,Math.floor(r+(m-y)*E/m+T)),f)}var P=i[r],O=o,F=u;for(op(i,o,r),f(i[u],P)>0&&op(i,o,u);O<F;){for(op(i,O,F),O++,F--;f(i[O],P)<0;)O++;for(;f(i[F],P)>0;)F--}f(i[o],P)===0?op(i,o,F):op(i,++F,u),F<=r&&(o=F+1),r<=F&&(u=F-1)}}function op(i,r,o){var u=i[r];i[r]=i[o],i[o]=u}function P4(i,r){return i<r?-1:i>r?1:0}function nx(i,r){const o=i.length;if(o<=1)return[i];const u=[];let f,m;for(let y=0;y<o;y++){const x=we(i[y]);x!==0&&(i[y].area=Math.abs(x),m===void 0&&(m=x<0),m===x<0?(f&&u.push(f),f=[i[y]]):f.push(i[y]))}if(f&&u.push(f),r>1)for(let y=0;y<u.length;y++)u[y].length<=r||(M4(u[y],r,1,u[y].length-1,k4),u[y]=u[y].slice(0,r));return u}function k4(i,r){return r.area-i.area}function ix(i,r,o){const u=o.patternDependencies;let f=!1;for(const m of r){const y=m.paint.get(`${i}-pattern`);y.isConstant()||(f=!0);const x=y.constantOr(null);x&&(f=!0,u[x]=!0)}return f}function ox(i,r,o,u,f){const m=f.patternDependencies;for(const y of r){const x=y.paint.get(`${i}-pattern`).value;if(x.kind!=="constant"){let E=x.evaluate({zoom:u},o,{},f.availableImages);E=E&&E.name?E.name:E,m[E]=!0,o.patterns[y.id]=E}}return o}class $g{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(o=>o.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new vt,this.indexArray=new qt,this.indexArray2=new mi,this.programConfigurations=new dc(r.layers,r.zoom),this.segments=new qn,this.segments2=new qn,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=r.projection}populate(r,o,u,f){this.hasPattern=ix("fill",this.layers,o);const m=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:x,id:E,index:T,sourceLayerIndex:P}of r){const O=this.layers[0]._featureFilter.needGeometry,F=vc(x,O);if(!this.layers[0]._featureFilter.filter(new L(this.zoom),F,u))continue;const V=m?m.evaluate(F,{},u,o.availableImages):void 0,G={id:E,properties:x.properties,type:x.type,sourceLayerIndex:P,index:T,geometry:O?F.geometry:fl(x,u,f),patterns:{},sortKey:V};y.push(G)}m&&y.sort((x,E)=>x.sortKey-E.sortKey);for(const x of y){const{geometry:E,index:T,sourceLayerIndex:P}=x;if(this.hasPattern){const O=ox("fill",this.layers,x,this.zoom,o);this.patternFeatures.push(O)}else this.addFeature(x,E,T,u,{},o.availableImages);o.featureIndex.insert(r[T].feature,E,T,P,this.index)}}update(r,o,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,o,this.stateDependentLayers,u,f)}addFeatures(r,o,u,f,m){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,o,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,v4),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,o,u,f,m,y=[]){for(const x of nx(o,500)){let E=0;for(const G of x)E+=G.length;const T=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),P=T.vertexLength,O=[],F=[];for(const G of x){if(G.length===0)continue;G!==x[0]&&F.push(O.length/2);const K=this.segments2.prepareSegment(G.length,this.layoutVertexArray,this.indexArray2),oe=K.vertexLength;this.layoutVertexArray.emplaceBack(G[0].x,G[0].y),this.indexArray2.emplaceBack(oe+G.length-1,oe),O.push(G[0].x),O.push(G[0].y);for(let pe=1;pe<G.length;pe++)this.layoutVertexArray.emplaceBack(G[pe].x,G[pe].y),this.indexArray2.emplaceBack(oe+pe-1,oe+pe),O.push(G[pe].x),O.push(G[pe].y);K.vertexLength+=G.length,K.primitiveLength+=G.length}const V=rx(O,F);for(let G=0;G<V.length;G+=3)this.indexArray.emplaceBack(P+V[G],P+V[G+1],P+V[G+2]);T.vertexLength+=E,T.primitiveLength+=V.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,m,y,f)}}Ut($g,"FillBucket",{omit:["layers","patternFeatures"]});const L4=new be({"fill-sort-key":new ae(ot.layout_fill["fill-sort-key"])});var O4={paint:new be({"fill-antialias":new X(ot.paint_fill["fill-antialias"]),"fill-opacity":new ae(ot.paint_fill["fill-opacity"]),"fill-color":new ae(ot.paint_fill["fill-color"]),"fill-outline-color":new ae(ot.paint_fill["fill-outline-color"]),"fill-translate":new X(ot.paint_fill["fill-translate"]),"fill-translate-anchor":new X(ot.paint_fill["fill-translate-anchor"]),"fill-pattern":new ae(ot.paint_fill["fill-pattern"])}),layout:L4};const D4=Ne([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),R4=Ne([{name:"a_centroid_pos",components:2,type:"Uint16"}]),z4=Ne([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:F4}=D4;var jg={},B4=Te,LA=zh;function zh(i,r,o,u,f){this.properties={},this.extent=o,this.type=0,this._pbf=i,this._geometry=-1,this._keys=u,this._values=f,i.readFields(N4,this,r)}function N4(i,r,o){i==1?r.id=o.readVarint():i==2?function(u,f){for(var m=u.readVarint()+u.pos;u.pos<m;){var y=f._keys[u.readVarint()],x=f._values[u.readVarint()];f.properties[y]=x}}(o,r):i==3?r.type=o.readVarint():i==4&&(r._geometry=o.pos)}function U4(i){for(var r,o,u=0,f=0,m=i.length,y=m-1;f<m;y=f++)u+=((o=i[y]).x-(r=i[f]).x)*(r.y+o.y);return u}zh.types=["Unknown","Point","LineString","Polygon"],zh.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var r,o=i.readVarint()+i.pos,u=1,f=0,m=0,y=0,x=[];i.pos<o;){if(f<=0){var E=i.readVarint();u=7&E,f=E>>3}if(f--,u===1||u===2)m+=i.readSVarint(),y+=i.readSVarint(),u===1&&(r&&x.push(r),r=[]),r.push(new B4(m,y));else{if(u!==7)throw new Error("unknown command "+u);r&&r.push(r[0].clone())}}return r&&x.push(r),x},zh.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var r=i.readVarint()+i.pos,o=1,u=0,f=0,m=0,y=1/0,x=-1/0,E=1/0,T=-1/0;i.pos<r;){if(u<=0){var P=i.readVarint();o=7&P,u=P>>3}if(u--,o===1||o===2)(f+=i.readSVarint())<y&&(y=f),f>x&&(x=f),(m+=i.readSVarint())<E&&(E=m),m>T&&(T=m);else if(o!==7)throw new Error("unknown command "+o)}return[y,E,x,T]},zh.prototype.toGeoJSON=function(i,r,o){var u,f,m=this.extent*Math.pow(2,o),y=this.extent*i,x=this.extent*r,E=this.loadGeometry(),T=zh.types[this.type];function P(V){for(var G=0;G<V.length;G++){var K=V[G];V[G]=[360*(K.x+y)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(K.y+x)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(u=0;u<E.length;u++)O[u]=E[u][0];P(E=O);break;case 2:for(u=0;u<E.length;u++)P(E[u]);break;case 3:for(E=function(V){var G=V.length;if(G<=1)return[V];for(var K,oe,pe=[],Ae=0;Ae<G;Ae++){var me=U4(V[Ae]);me!==0&&(oe===void 0&&(oe=me<0),oe===me<0?(K&&pe.push(K),K=[V[Ae]]):K.push(V[Ae]))}return K&&pe.push(K),pe}(E),u=0;u<E.length;u++)for(f=0;f<E[u].length;f++)P(E[u][f])}E.length===1?E=E[0]:T="Multi"+T;var F={type:"Feature",geometry:{type:T,coordinates:E},properties:this.properties};return"id"in this&&(F.id=this.id),F};var $4=LA,OA=DA;function DA(i,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(j4,this,r),this.length=this._features.length}function j4(i,r,o){i===15?r.version=o.readVarint():i===1?r.name=o.readString():i===5?r.extent=o.readVarint():i===2?r._features.push(o.pos):i===3?r._keys.push(o.readString()):i===4&&r._values.push(function(u){for(var f=null,m=u.readVarint()+u.pos;u.pos<m;){var y=u.readVarint()>>3;f=y===1?u.readString():y===2?u.readFloat():y===3?u.readDouble():y===4?u.readVarint64():y===5?u.readVarint():y===6?u.readSVarint():y===7?u.readBoolean():null}return f}(o))}DA.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var r=this._pbf.readVarint()+this._pbf.pos;return new $4(this._pbf,r,this.extent,this._keys,this._values)};var V4=OA;function G4(i,r,o){if(i===3){var u=new V4(o,o.readVarint()+o.pos);u.length&&(r[u.name]=u)}}var sx=jg.VectorTile=function(i,r){this.layers=i.readFields(G4,{},r)},Vg=jg.VectorTileFeature=LA;function Gg(i,r,o,u){const f=[],m=u===0?(y,x,E,T,P,O)=>{y.push(new he(O,E+(O-x)/(T-x)*(P-E)))}:(y,x,E,T,P,O)=>{y.push(new he(x+(O-E)/(P-E)*(T-x),O))};for(const y of i){const x=[];for(const E of y){if(E.length<=2)continue;const T=[];for(let F=0;F<E.length-1;F++){const V=E[F].x,G=E[F].y,K=E[F+1].x,oe=E[F+1].y,pe=u===0?V:G,Ae=u===0?K:oe;pe<r?Ae>r&&m(T,V,G,K,oe,r):pe>o?Ae<o&&m(T,V,G,K,oe,o):T.push(E[F]),Ae<r&&pe>=r&&m(T,V,G,K,oe,r),Ae>o&&pe<=o&&m(T,V,G,K,oe,o)}let P=E[E.length-1];const O=u===0?P.x:P.y;O>=r&&O<=o&&T.push(P),T.length&&(P=T[T.length-1],T[0].x===P.x&&T[0].y===P.y||T.push(T[0]),x.push(T))}x.length&&f.push(x)}return f}jg.VectorTileLayer=OA;const q4=Vg.types,W4=Math.pow(2,13);function sp(i,r,o,u,f,m,y,x){i.emplaceBack((r<<1)+y,(o<<1)+m,(Math.floor(u*W4)<<1)+f,Math.round(x))}function ap(i,r,o){i.emplaceBack(r.x,r.y,r.z,o[0]*16384,o[1]*16384,o[2]*16384)}class RA{constructor(){this.acc=new he(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new he(r.x,r.y),this.max=new he(r.x,r.y))}append(r,o){this.currentPolyCount.edges++,this.acc._add(r);const u=this.min,f=this.max;r.x<u.x?u.x=r.x:r.x>f.x&&(f.x=r.x),r.y<u.y?u.y=r.y:r.y>f.y&&(f.y=r.y),((r.x===0||r.x===Xt)&&r.x===o.x)!=((r.y===0||r.y===Xt)&&r.y===o.y)&&this.processBorderOverlap(r,o),o.x<0!=r.x<0&&this.addBorderIntersection(0,Cr(o.y,r.y,(0-o.x)/(r.x-o.x))),o.x>Xt!=r.x>Xt&&this.addBorderIntersection(1,Cr(o.y,r.y,(Xt-o.x)/(r.x-o.x))),o.y<0!=r.y<0&&this.addBorderIntersection(2,Cr(o.x,r.x,(0-o.y)/(r.y-o.y))),o.y>Xt!=r.y>Xt&&this.addBorderIntersection(3,Cr(o.x,r.x,(Xt-o.y)/(r.y-o.y)))}addBorderIntersection(r,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[r];o<u[0]&&(u[0]=o),o>u[1]&&(u[1]=o)}processBorderOverlap(r,o){if(r.x===o.x){if(r.y===o.y)return;const u=r.x===0?0:1;this.addBorderIntersection(u,o.y),this.addBorderIntersection(u,r.y)}else{const u=r.y===0?2:3;this.addBorderIntersection(u,o.x),this.addBorderIntersection(u,r.x)}}centroid(){const r=this.polyCount.reduce((o,u)=>o+u.edges,0);return r!==0?this.acc.div(r)._round():new he(0,0)}span(){return new he(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((r,o)=>r+ +(o[0]!==Number.MAX_VALUE),0)}}class lp{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(o=>o.id),this.index=r.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=r.projection,this.layoutVertexArray=new ht,this.centroidVertexArray=new Gs,this.indexArray=new qt,this.programConfigurations=new dc(r.layers,r.zoom),this.segments=new qn,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.enableTerrain=r.enableTerrain}populate(r,o,u,f){this.features=[],this.hasPattern=ix("fill-extrusion",this.layers,o),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(m){const y=Math.exp(Math.PI*(1-m.y/(1<<m.z)*2));return 80150034*y/(y*y+1)/Xt/(1<<m.z)}(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:m,id:y,index:x,sourceLayerIndex:E}of r){const T=this.layers[0]._featureFilter.needGeometry,P=vc(m,T);if(!this.layers[0]._featureFilter.filter(new L(this.zoom),P,u))continue;const O={id:y,sourceLayerIndex:E,index:x,geometry:T?P.geometry:fl(m,u,f),properties:m.properties,type:m.type,patterns:{}},F=this.layoutVertexArray.length;this.hasPattern?this.features.push(ox("fill-extrusion",this.layers,O,this.zoom,o)):this.addFeature(O,O.geometry,x,u,{},o.availableImages,f),o.featureIndex.insert(m,O.geometry,x,E,this.index,F)}this.sortBorders()}addFeatures(r,o,u,f,m){for(const y of this.features){const{geometry:x}=y;this.addFeature(y,x,y.index,o,u,f,m)}this.sortBorders()}update(r,o,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,o,this.stateDependentLayers,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,F4),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,z4.members,!0))),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,R4.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,o,u,f,m,y,x){const E=[new he(0,0),new he(Xt,Xt)],T=x.projection,P=T.name==="globe",O=this.enableTerrain&&!P?new RA:null,F=q4[r.type]==="Polygon";P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new bt);const V=nx(o,500);for(let pe=V.length-1;pe>=0;pe--){const Ae=V[pe];(Ae.length===0||(G=Ae[0]).every(me=>me.x<=0)||G.every(me=>me.x>=Xt)||G.every(me=>me.y<=0)||G.every(me=>me.y>=Xt))&&V.splice(pe,1)}var G;let K;if(P)K=jA(V,E,f);else{K=[];for(const pe of V)K.push({polygon:pe,bounds:E})}const oe=F?this.edgeRadius:0;for(const{polygon:pe,bounds:Ae}of K){let me=0,Se=0;for(const Me of pe)F&&!Me[0].equals(Me[Me.length-1])&&Me.push(Me[0]),Se+=F?Me.length-1:Me.length;const ke=this.segments.prepareSegment((F?5:4)*Se,this.layoutVertexArray,this.indexArray);if(F){const Me=[],Je=[];me=ke.vertexLength;for(const st of pe){let xt,nt;st.length&&st!==pe[0]&&Je.push(Me.length/2),xt=st[1].sub(st[0])._perp()._unit();for(let ft=1;ft<st.length;ft++){const dt=st[ft],yt=st[ft===st.length-1?1:ft+1];let{x:At,y:it}=dt;if(oe){nt=yt.sub(dt)._perp()._unit();const Rt=xt.add(nt)._unit(),Vt=oe*Math.min(4,1/(xt.x*Rt.x+xt.y*Rt.y));At+=Vt*Rt.x,it+=Vt*Rt.y,xt=nt}sp(this.layoutVertexArray,At,it,0,0,1,1,0),ke.vertexLength++,Me.push(dt.x,dt.y),P&&ap(this.layoutVertexExtArray,T.projectTilePoint(At,it,f),T.upVector(f,At,it))}}const Ze=rx(Me,Je);for(let st=0;st<Ze.length;st+=3)this.indexArray.emplaceBack(me+Ze[st],me+Ze[st+2],me+Ze[st+1]),ke.primitiveLength++}for(const Me of pe){O&&Me.length&&O.startRing(Me[0]);let Je,Ze,st,xt=Me.length>4&&NA(Me[Me.length-2],Me[0],Me[1]),nt=oe?Z4(Me[Me.length-2],Me[0],Me[1],oe):0;Ze=Me[1].sub(Me[0])._perp()._unit();let ft=!0;for(let dt=1,yt=0;dt<Me.length;dt++){let At=Me[dt-1],it=Me[dt];const Rt=Me[dt===Me.length-1?1:dt+1];if(O&&F&&O.currentPolyCount.top++,BA(it,At,Ae)){oe&&(Ze=Rt.sub(it)._perp()._unit(),ft=!ft);continue}O&&O.append(it,At);const Vt=it.sub(At)._perp(),Ft=Vt.x/(Math.abs(Vt.x)+Math.abs(Vt.y)),lr=Vt.y>0?1:0,It=At.dist(it);if(yt+It>32768&&(yt=0),oe){st=Rt.sub(it)._perp()._unit();let cr=FA(At,it,Rt,zA(Ze,st),oe);isNaN(cr)&&(cr=0);const er=it.sub(At)._unit();At=At.add(er.mult(nt))._round(),it=it.add(er.mult(-cr))._round(),nt=cr,Ze=st}const Zt=ke.vertexLength,ur=Me.length>4&&NA(At,it,Rt);let kr=UA(yt,xt,ft);if(sp(this.layoutVertexArray,At.x,At.y,Ft,lr,0,0,kr),sp(this.layoutVertexArray,At.x,At.y,Ft,lr,0,1,kr),yt+=It,kr=UA(yt,ur,!ft),xt=ur,sp(this.layoutVertexArray,it.x,it.y,Ft,lr,0,0,kr),sp(this.layoutVertexArray,it.x,it.y,Ft,lr,0,1,kr),ke.vertexLength+=4,this.indexArray.emplaceBack(Zt+0,Zt+1,Zt+2),this.indexArray.emplaceBack(Zt+1,Zt+3,Zt+2),ke.primitiveLength+=2,oe){const cr=me+(dt===1?Me.length-2:dt-2),er=dt===1?me:cr+1;if(this.indexArray.emplaceBack(Zt+1,cr,Zt+3),this.indexArray.emplaceBack(cr,er,Zt+3),ke.primitiveLength+=2,Je===void 0&&(Je=Zt),!BA(Rt,Me[dt],Ae)){const on=dt===Me.length-1?Je:ke.vertexLength;this.indexArray.emplaceBack(Zt+2,Zt+3,on),this.indexArray.emplaceBack(Zt+3,on+1,on),this.indexArray.emplaceBack(Zt+3,er,on+1),ke.primitiveLength+=3}ft=!ft}if(P){const cr=this.layoutVertexExtArray,er=T.projectTilePoint(At.x,At.y,f),on=T.projectTilePoint(it.x,it.y,f),hr=T.upVector(f,At.x,At.y),fr=T.upVector(f,it.x,it.y);ap(cr,er,hr),ap(cr,er,hr),ap(cr,on,fr),ap(cr,on,fr)}}F&&(me+=Me.length-1)}}if(O&&O.polyCount.length>0){if(O.borders){O.vertexArrayOffset=this.centroidVertexArray.length;const pe=O.borders,Ae=this.featuresOnBorder.push(O)-1;for(let me=0;me<4;me++)pe[me][0]!==Number.MAX_VALUE&&this.borders[me].push(Ae)}this.encodeCentroid(O.borders?void 0:O.centroid(),O)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,m,y,f)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort((o,u)=>this.featuresOnBorder[o].borders[r][0]-this.featuresOnBorder[u].borders[r][0])}encodeCentroid(r,o,u=!0){let f,m;if(r)if(r.y!==0){const x=o.span()._mult(this.tileToMeter);f=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(x.x/10)),m=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else f=Math.ceil(7*(r.x+450)),m=0;else f=0,m=+u;let y=u?this.centroidVertexArray.length:o.vertexArrayOffset;for(const x of o.polyCount){u&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let E=0;E<x.top;E++)this.centroidVertexArray.emplace(y++,f,m);for(let E=0;E<2*x.edges;E++)this.centroidVertexArray.emplace(y++,0,m),this.centroidVertexArray.emplace(y++,f,m)}}}function zA(i,r){const o=i.add(r)._unit();return i.x*o.x+i.y*o.y}function Z4(i,r,o,u){const f=r.sub(i)._perp()._unit(),m=o.sub(r)._perp()._unit();return FA(i,r,o,zA(f,m),u)}function FA(i,r,o,u,f){const m=Math.sqrt(1-u*u);return Math.min(i.dist(r)/3,r.dist(o)/3,f*m/u)}function BA(i,r,o){return i.x<o[0].x&&r.x<o[0].x||i.x>o[1].x&&r.x>o[1].x||i.y<o[0].y&&r.y<o[0].y||i.y>o[1].y&&r.y>o[1].y}function NA(i,r,o){if(i.x<0||i.x>=Xt||r.x<0||r.x>=Xt||o.x<0||o.x>=Xt)return!1;const u=o.sub(r),f=u.perp(),m=i.sub(r);return(u.x*m.x+u.y*m.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(m.x*m.x+m.y*m.y))>-.866&&f.x*m.x+f.y*m.y<0}function UA(i,r,o){const u=r?2|i:-3&i;return o?1|u:-2&u}function $A(){const i=Math.PI/32,r=Math.tan(i),o=tp;return o*Math.sqrt(1+2*r*r)-o}function jA(i,r,o){const u=1<<o.z,f=us(o.x/u),m=us((o.x+1)/u),y=Fi(o.y/u),x=Fi((o.y+1)/u);return function(E,T,P,O,F=0,V){const G=[];if(!E.length||!P||!O)return G;const K=(Me,Je)=>{for(const Ze of Me)G.push({polygon:Ze,bounds:Je})},oe=Math.ceil(Math.log2(P)),pe=Math.ceil(Math.log2(O)),Ae=oe-pe,me=[];for(let Me=0;Me<Math.abs(Ae);Me++)me.push(Ae>0?0:1);for(let Me=0;Me<Math.min(oe,pe);Me++)me.push(0),me.push(1);let Se=E;if(Se=Gg(Se,T[0].y-F,T[1].y+F,1),Se=Gg(Se,T[0].x-F,T[1].x+F,0),!Se.length)return G;const ke=[];for(me.length?ke.push({polygons:Se,bounds:T,depth:0}):K(Se,T);ke.length;){const Me=ke.pop(),Je=Me.depth,Ze=me[Je],st=Me.bounds[0],xt=Me.bounds[1],nt=Ze===0?st.x:st.y,ft=Ze===0?xt.x:xt.y,dt=V?V(Ze,nt,ft):.5*(nt+ft),yt=Gg(Me.polygons,nt-F,dt+F,Ze),At=Gg(Me.polygons,dt-F,ft+F,Ze);if(yt.length){const it=[st,new he(Ze===0?dt:xt.x,Ze===1?dt:xt.y)];me.length>Je+1?ke.push({polygons:yt,bounds:it,depth:Je+1}):K(yt,it)}if(At.length){const it=[new he(Ze===0?dt:st.x,Ze===1?dt:st.y),xt];me.length>Je+1?ke.push({polygons:At,bounds:it,depth:Je+1}):K(At,it)}}return G}(i,r,Math.ceil((m-f)/11.25),Math.ceil((y-x)/11.25),1,(E,T,P)=>{if(E===0)return .5*(T+P);{const O=Fi((o.y+T/Xt)/u);return(Sa(.5*(Fi((o.y+P/Xt)/u)+O))*u-o.y)*Xt}})}Ut(lp,"FillExtrusionBucket",{omit:["layers","features"]}),Ut(RA,"PartMetadata");const H4=new be({"fill-extrusion-edge-radius":new X(ot["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var X4={paint:new be({"fill-extrusion-opacity":new X(ot["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ae(ot["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new X(ot["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new X(ot["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ae(ot["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ae(ot["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ae(ot["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new X(ot["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new X(ot["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new X(ot["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new X(ot["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:H4};function VA(i,r,o){var u=2*Math.PI*6378137/256/Math.pow(2,o);return[i*u-2*Math.PI*6378137/2,r*u-2*Math.PI*6378137/2]}class qg{constructor(r,o,u){this.z=r,this.x=o,this.y=u,this.key=up(0,r,r,o,u)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,o){const u=function(m,y,x){var E=VA(256*m,256*(y=Math.pow(2,x)-y-1),x),T=VA(256*(m+1),256*(y+1),x);return E[0]+","+E[1]+","+T[0]+","+T[1]}(this.x,this.y,this.z),f=function(m,y,x){let E,T="";for(let P=m;P>0;P--)E=1<<P-1,T+=(y&E?1:0)+(x&E?2:0);return T}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class GA{constructor(r,o){this.wrap=r,this.canonical=o,this.key=up(r,o.z,o.z,o.x,o.y)}}class so{constructor(r,o,u,f,m){this.overscaledZ=r,this.wrap=o,this.canonical=new qg(u,+f,+m),this.key=o===0&&r===u?this.canonical.key:up(o,r,u,f,m)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const o=this.canonical.z-r;return r>this.canonical.z?new so(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new so(r,this.wrap,r,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(r,o=!0){if(this.overscaledZ===r&&o)return this.key;if(r>this.canonical.z)return up(this.wrap*+o,r,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-r;return up(this.wrap*+o,r,r,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const o=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>o&&r.canonical.y===this.canonical.y>>o}children(r){if(this.overscaledZ>=r)return[new so(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,u=2*this.canonical.x,f=2*this.canonical.y;return[new so(o,this.wrap,o,u,f),new so(o,this.wrap,o,u+1,f),new so(o,this.wrap,o,u,f+1),new so(o,this.wrap,o,u+1,f+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new so(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new so(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new GA(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function up(i,r,o,u,f){const m=1<<Math.min(o,22);let y=m*(f%m)+u%m;return i&&o<22&&(y+=m*m*((i<0?-2*i-1:2*i)%(1<<2*(22-o)))),16*(32*y+o)+(r-o)}Ut(qg,"CanonicalTileID"),Ut(so,"OverscaledTileID",{omit:["projMatrix"]});class Fh extends he{constructor(r,o,u){super(r,o),this.z=u}}function cp(i,r){return i.x*r.x+i.y*r.y}function qA(i,r){if(i.length===1){let o=0;const u=r[o++];let f;for(;!f||u.equals(f);)if(f=r[o++],!f)return 1/0;for(;o<r.length;o++){const m=r[o],y=i[0],x=f.sub(u),E=m.sub(u),T=y.sub(u),P=cp(x,x),O=cp(x,E),F=cp(E,E),V=cp(T,x),G=cp(T,E),K=P*F-O*O,oe=(F*V-O*G)/K,pe=(P*G-O*V)/K,Ae=u.z*(1-oe-pe)+f.z*oe+m.z*pe;if(isFinite(Ae))return Ae}return 1/0}{let o=1/0;for(const u of r)o=Math.min(o,u.z);return o}}function WA(i,r,o,u,f,m,y,x){const E=y*f.getElevationAt(i,r,!0,!0),T=m[0]!==0,P=T?m[1]===0?y*(m[0]/7-450):y*function(O,F,V){const G=Math.floor(F[0]/8),K=Math.floor(F[1]/8),oe=10*(F[0]-8*G),pe=10*(F[1]-8*K),Ae=O.getElevationAt(G,K,!0,!0),me=O.getMeterToDEM(V),Se=Math.floor(.5*(oe*me-1)),ke=Math.floor(.5*(pe*me-1)),Me=O.tileCoordToPixel(G,K),Je=2*Se+1,Ze=2*ke+1,st=function(At,it,Rt,Vt,Ft){return[At.getElevationAtPixel(it,Rt,!0),At.getElevationAtPixel(it+Ft,Rt,!0),At.getElevationAtPixel(it,Rt+Ft,!0),At.getElevationAtPixel(it+Vt,Rt+Ft,!0)]}(O,Me.x-Se,Me.y-ke,Je,Ze),xt=Math.abs(st[0]-st[1]),nt=Math.abs(st[2]-st[3]),ft=Math.abs(st[0]-st[2])+Math.abs(st[1]-st[3]),dt=Math.min(.25,.5*me*(xt+nt)/Je),yt=Math.min(.25,.5*me*ft/Ze);return Ae+Math.max(dt*oe,yt*pe)}(f,m,x):E;return{base:E+(o===0)?-1:o,top:T?Math.max(P+u,E+o+2):E+u}}const K4=Ne([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Y4}=K4,J4=Ne([{name:"a_packed",components:4,type:"Float32"}]),{members:Q4}=J4,e5=Vg.types,t5=Math.cos(Math.PI/180*37.5);class Wg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(o=>o.id),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new rt,this.layoutVertexArray2=new _t,this.indexArray=new qt,this.programConfigurations=new dc(r.layers,r.zoom),this.segments=new qn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(r,o,u,f){this.hasPattern=ix("line",this.layers,o);const m=this.layers[0].layout.get("line-sort-key"),y=[];for(const{feature:P,id:O,index:F,sourceLayerIndex:V}of r){const G=this.layers[0]._featureFilter.needGeometry,K=vc(P,G);if(!this.layers[0]._featureFilter.filter(new L(this.zoom),K,u))continue;const oe=m?m.evaluate(K,{},u):void 0,pe={id:O,properties:P.properties,type:P.type,sourceLayerIndex:V,index:F,geometry:G?K.geometry:fl(P,u,f),patterns:{},sortKey:oe};y.push(pe)}m&&y.sort((P,O)=>P.sortKey-O.sortKey);const{lineAtlas:x,featureIndex:E}=o,T=this.addConstantDashes(x);for(const P of y){const{geometry:O,index:F,sourceLayerIndex:V}=P;if(T&&this.addFeatureDashes(P,x),this.hasPattern){const G=ox("line",this.layers,P,this.zoom,o);this.patternFeatures.push(G)}else this.addFeature(P,O,F,u,x.positions,o.availableImages);E.insert(r[F].feature,O,F,V,this.index)}}addConstantDashes(r){let o=!1;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,m=u.layout.get("line-cap").value;if(f.kind!=="constant"||m.kind!=="constant")o=!0;else{const y=m.value,x=f.value;if(!x)continue;r.addDash(x,y)}}return o}addFeatureDashes(r,o){const u=this.zoom;for(const f of this.layers){const m=f.paint.get("line-dasharray").value,y=f.layout.get("line-cap").value;if(m.kind==="constant"&&y.kind==="constant")continue;let x,E;if(m.kind==="constant"){if(x=m.value,!x)continue}else x=m.evaluate({zoom:u},r);E=y.kind==="constant"?y.value:y.evaluate({zoom:u},r),o.addDash(x,E),r.patterns[f.id]=o.getKey(x,E)}}update(r,o,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,o,this.stateDependentLayers,u,f)}addFeatures(r,o,u,f,m){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,o,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,Q4)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Y4),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,o,u,f,m,y){const x=this.layers[0].layout,E=x.get("line-join").evaluate(r,{}),T=x.get("line-cap").evaluate(r,{}),P=x.get("line-miter-limit"),O=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const F of o)this.addLine(F,r,E,T,P,O);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,m,y,f)}addLine(r,o,u,f,m,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let pe=0;pe<r.length-1;pe++)this.totalDistance+=r[pe].dist(r[pe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x=e5[o.type]==="Polygon";let E=r.length;for(;E>=2&&r[E-1].equals(r[E-2]);)E--;let T=0;for(;T<E-1&&r[T].equals(r[T+1]);)T++;if(E<(x?3:2))return;u==="bevel"&&(m=1.05);const P=this.overscaling<=16?15*Xt/(512*this.overscaling):0,O=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let F,V,G,K,oe;this.e1=this.e2=-1,x&&(F=r[E-2],oe=r[T].sub(F)._unit()._perp());for(let pe=T;pe<E;pe++){if(G=pe===E-1?x?r[T+1]:void 0:r[pe+1],G&&r[pe].equals(G))continue;oe&&(K=oe),F&&(V=F),F=r[pe],oe=G?G.sub(F)._unit()._perp():K,K=K||oe;let Ae=K.add(oe);Ae.x===0&&Ae.y===0||Ae._unit();const me=K.x*oe.x+K.y*oe.y,Se=Ae.x*oe.x+Ae.y*oe.y,ke=Se!==0?1/Se:1/0,Me=2*Math.sqrt(2-2*Se),Je=Se<t5&&V&&G,Ze=K.x*oe.y-K.y*oe.x>0;if(Je&&pe>T){const nt=F.dist(V);if(nt>2*P){const ft=F.sub(F.sub(V)._mult(P/nt)._round());this.updateDistance(V,ft),this.addCurrentVertex(ft,K,0,0,O),V=ft}}const st=V&&G;let xt=st?u:x?"butt":f;if(st&&xt==="round"&&(ke<y?xt="miter":ke<=2&&(xt="fakeround")),xt==="miter"&&ke>m&&(xt="bevel"),xt==="bevel"&&(ke>2&&(xt="flipbevel"),ke<m&&(xt="miter")),V&&this.updateDistance(V,F),xt==="miter")Ae._mult(ke),this.addCurrentVertex(F,Ae,0,0,O);else if(xt==="flipbevel"){if(ke>100)Ae=oe.mult(-1);else{const nt=ke*K.add(oe).mag()/K.sub(oe).mag();Ae._perp()._mult(nt*(Ze?-1:1))}this.addCurrentVertex(F,Ae,0,0,O),this.addCurrentVertex(F,Ae.mult(-1),0,0,O)}else if(xt==="bevel"||xt==="fakeround"){const nt=-Math.sqrt(ke*ke-1),ft=Ze?nt:0,dt=Ze?0:nt;if(V&&this.addCurrentVertex(F,K,ft,dt,O),xt==="fakeround"){const yt=Math.round(180*Me/Math.PI/20);for(let At=1;At<yt;At++){let it=At/yt;if(it!==.5){const Vt=it-.5;it+=it*Vt*(it-1)*((1.0904+me*(me*(3.55645-1.43519*me)-3.2452))*Vt*Vt+(.848013+me*(.215638*me-1.06021)))}const Rt=oe.sub(K)._mult(it)._add(K)._unit()._mult(Ze?-1:1);this.addHalfVertex(F,Rt.x,Rt.y,!1,Ze,0,O)}}G&&this.addCurrentVertex(F,oe,-ft,-dt,O)}else if(xt==="butt")this.addCurrentVertex(F,Ae,0,0,O);else if(xt==="square"){const nt=V?1:-1;V||this.addCurrentVertex(F,Ae,nt,nt,O),this.addCurrentVertex(F,Ae,0,0,O),V&&this.addCurrentVertex(F,Ae,nt,nt,O)}else xt==="round"&&(V&&(this.addCurrentVertex(F,K,0,0,O),this.addCurrentVertex(F,K,1,1,O,!0)),G&&(this.addCurrentVertex(F,oe,-1,-1,O,!0),this.addCurrentVertex(F,oe,0,0,O)));if(Je&&pe<E-1){const nt=F.dist(G);if(nt>2*P){const ft=F.add(G.sub(F)._mult(P/nt)._round());this.updateDistance(F,ft),this.addCurrentVertex(ft,oe,0,0,O),F=ft}}}}addCurrentVertex(r,o,u,f,m,y=!1){const x=o.y*f-o.x,E=-o.y-o.x*f;this.addHalfVertex(r,o.x+o.y*u,o.y-o.x*u,y,!1,u,m),this.addHalfVertex(r,x,E,y,!0,-f,m)}addHalfVertex({x:r,y:o},u,f,m,y,x,E){this.layoutVertexArray.emplaceBack((r<<1)+(m?1:0),(o<<1)+(y?1:0),Math.round(63*u)+128,Math.round(63*f)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const T=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),E.primitiveLength++),y?this.e2=T:this.e1=T}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,o){this.distance+=r.dist(o),this.updateScaledDistance()}}Ut(Wg,"LineBucket",{omit:["layers","patternFeatures"]});const r5=new be({"line-cap":new ae(ot.layout_line["line-cap"]),"line-join":new ae(ot.layout_line["line-join"]),"line-miter-limit":new X(ot.layout_line["line-miter-limit"]),"line-round-limit":new X(ot.layout_line["line-round-limit"]),"line-sort-key":new ae(ot.layout_line["line-sort-key"])});var ZA={paint:new be({"line-opacity":new ae(ot.paint_line["line-opacity"]),"line-color":new ae(ot.paint_line["line-color"]),"line-translate":new X(ot.paint_line["line-translate"]),"line-translate-anchor":new X(ot.paint_line["line-translate-anchor"]),"line-width":new ae(ot.paint_line["line-width"]),"line-gap-width":new ae(ot.paint_line["line-gap-width"]),"line-offset":new ae(ot.paint_line["line-offset"]),"line-blur":new ae(ot.paint_line["line-blur"]),"line-dasharray":new ae(ot.paint_line["line-dasharray"]),"line-pattern":new ae(ot.paint_line["line-pattern"]),"line-gradient":new ge(ot.paint_line["line-gradient"]),"line-trim-offset":new X(ot.paint_line["line-trim-offset"])}),layout:r5};const HA=new class extends ae{possiblyEvaluate(i,r){return r=new L(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition}),super.possiblyEvaluate(i,r)}evaluate(i,r,o,u){return r=lt({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(i,r,o,u)}}(ZA.paint.properties["line-width"].specification);function XA(i,r){return r>0?r+2*i:i}HA.useIntegerZoom=!0;const n5=Ne([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),i5=Ne([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),o5=Ne([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ne([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const s5=Ne([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),a5=Ne([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ne([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const KA=Ne([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),l5=Ne([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ne([{name:"triangle",components:3,type:"Uint16"}]),Ne([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ne([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ne([{type:"Float32",name:"offsetX"}]),Ne([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ai=24;const Ks=128;function ax(i,r){const{expression:o}=r;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new L(i+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:f}=o;let m=0;for(;m<u.length&&u[m]<=i;)m++;m=Math.max(0,m-1);let y=m;for(;y<u.length&&u[y]<i+1;)y++;y=Math.min(u.length-1,y);const x=u[m],E=u[y];return o.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:E,interpolationType:f}:{kind:"camera",minZoom:x,maxZoom:E,minSize:o.evaluate(new L(x)),maxSize:o.evaluate(new L(E)),interpolationType:f}}}function Zg(i,{uSize:r,uSizeT:o},{lowerSize:u,upperSize:f}){return i.kind==="source"?u/Ks:i.kind==="composite"?Cr(u/Ks,f/Ks,o):r}function Bh(i,r){let o=0,u=0;if(i.kind==="constant")u=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:f,minZoom:m,maxZoom:y}=i,x=f?_e(xs.interpolationFactor(f,r,m,y),0,1):0;i.kind==="camera"?u=Cr(i.minSize,i.maxSize,x):o=x}return{uSizeT:o,uSize:u}}var u5=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ks,evaluateSizeForFeature:Zg,evaluateSizeForZoom:Bh,getSizeData:ax});function c5(i,r,o){return i.sections.forEach(u=>{u.text=function(f,m,y){const x=m.layout.get("text-transform").evaluate(y,{});return x==="uppercase"?f=f.toLocaleUpperCase():x==="lowercase"&&(f=f.toLocaleLowerCase()),C.applyArabicShaping&&(f=C.applyArabicShaping(f)),f}(u.text,r,o)}),i}const hp={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function h5(i){return i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""}function f5(i){return i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""}var YA=Qr,JA=function(i,r,o,u,f){var m,y,x=8*f-u-1,E=(1<<x)-1,T=E>>1,P=-7,O=f-1,F=-1,V=i[r+O];for(O+=F,m=V&(1<<-P)-1,V>>=-P,P+=x;P>0;m=256*m+i[r+O],O+=F,P-=8);for(y=m&(1<<-P)-1,m>>=-P,P+=u;P>0;y=256*y+i[r+O],O+=F,P-=8);if(m===0)m=1-T;else{if(m===E)return y?NaN:1/0*(V?-1:1);y+=Math.pow(2,u),m-=T}return(V?-1:1)*y*Math.pow(2,m-u)},QA=function(i,r,o,u,f,m){var y,x,E,T=8*m-f-1,P=(1<<T)-1,O=P>>1,F=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,V=0,G=1,K=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(x=isNaN(r)?1:0,y=P):(y=Math.floor(Math.log(r)/Math.LN2),r*(E=Math.pow(2,-y))<1&&(y--,E*=2),(r+=y+O>=1?F/E:F*Math.pow(2,1-O))*E>=2&&(y++,E/=2),y+O>=P?(x=0,y=P):y+O>=1?(x=(r*E-1)*Math.pow(2,f),y+=O):(x=r*Math.pow(2,O-1)*Math.pow(2,f),y=0));f>=8;i[o+V]=255&x,V+=G,x/=256,f-=8);for(y=y<<f|x,T+=f;T>0;i[o+V]=255&y,V+=G,y/=256,T-=8);i[o+V-G]|=128*K};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Qr(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Qr.Varint=0,Qr.Fixed64=1,Qr.Bytes=2,Qr.Fixed32=5;var lx=4294967296,eC=1/lx,tC=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function pl(i){return i.type===Qr.Bytes?i.readVarint()+i.pos:i.pos+1}function Nh(i,r,o){return o?4294967296*r+(i>>>0):4294967296*(r>>>0)+(i>>>0)}function rC(i,r,o){var u=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));o.realloc(u);for(var f=o.pos-1;f>=i;f--)o.buf[f+u]=o.buf[f]}function d5(i,r){for(var o=0;o<i.length;o++)r.writeVarint(i[o])}function p5(i,r){for(var o=0;o<i.length;o++)r.writeSVarint(i[o])}function m5(i,r){for(var o=0;o<i.length;o++)r.writeFloat(i[o])}function g5(i,r){for(var o=0;o<i.length;o++)r.writeDouble(i[o])}function y5(i,r){for(var o=0;o<i.length;o++)r.writeBoolean(i[o])}function _5(i,r){for(var o=0;o<i.length;o++)r.writeFixed32(i[o])}function v5(i,r){for(var o=0;o<i.length;o++)r.writeSFixed32(i[o])}function x5(i,r){for(var o=0;o<i.length;o++)r.writeFixed64(i[o])}function b5(i,r){for(var o=0;o<i.length;o++)r.writeSFixed64(i[o])}function Hg(i,r){return(i[r]|i[r+1]<<8|i[r+2]<<16)+16777216*i[r+3]}function Uh(i,r,o){i[o]=r,i[o+1]=r>>>8,i[o+2]=r>>>16,i[o+3]=r>>>24}function nC(i,r){return(i[r]|i[r+1]<<8|i[r+2]<<16)+(i[r+3]<<24)}Qr.prototype={destroy:function(){this.buf=null},readFields:function(i,r,o){for(o=o||this.length;this.pos<o;){var u=this.readVarint(),f=u>>3,m=this.pos;this.type=7&u,i(f,r,this),this.pos===m&&this.skip(u)}return r},readMessage:function(i,r){return this.readFields(i,r,this.readVarint()+this.pos)},readFixed32:function(){var i=Hg(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=nC(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Hg(this.buf,this.pos)+Hg(this.buf,this.pos+4)*lx;return this.pos+=8,i},readSFixed64:function(){var i=Hg(this.buf,this.pos)+nC(this.buf,this.pos+4)*lx;return this.pos+=8,i},readFloat:function(){var i=JA(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=JA(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var r,o,u=this.buf;return r=127&(o=u[this.pos++]),o<128?r:(r|=(127&(o=u[this.pos++]))<<7,o<128?r:(r|=(127&(o=u[this.pos++]))<<14,o<128?r:(r|=(127&(o=u[this.pos++]))<<21,o<128?r:function(f,m,y){var x,E,T=y.buf;if(x=(112&(E=T[y.pos++]))>>4,E<128||(x|=(127&(E=T[y.pos++]))<<3,E<128)||(x|=(127&(E=T[y.pos++]))<<10,E<128)||(x|=(127&(E=T[y.pos++]))<<17,E<128)||(x|=(127&(E=T[y.pos++]))<<24,E<128)||(x|=(1&(E=T[y.pos++]))<<31,E<128))return Nh(f,x,m);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(o=u[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,r=this.pos;return this.pos=i,i-r>=12&&tC?function(o,u,f){return tC.decode(o.subarray(u,f))}(this.buf,r,i):function(o,u,f){for(var m="",y=u;y<f;){var x,E,T,P=o[y],O=null,F=P>239?4:P>223?3:P>191?2:1;if(y+F>f)break;F===1?P<128&&(O=P):F===2?(192&(x=o[y+1]))==128&&(O=(31&P)<<6|63&x)<=127&&(O=null):F===3?(E=o[y+2],(192&(x=o[y+1]))==128&&(192&E)==128&&((O=(15&P)<<12|(63&x)<<6|63&E)<=2047||O>=55296&&O<=57343)&&(O=null)):F===4&&(E=o[y+2],T=o[y+3],(192&(x=o[y+1]))==128&&(192&E)==128&&(192&T)==128&&((O=(15&P)<<18|(63&x)<<12|(63&E)<<6|63&T)<=65535||O>=1114112)&&(O=null)),O===null?(O=65533,F=1):O>65535&&(O-=65536,m+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),m+=String.fromCharCode(O),y+=F}return m}(this.buf,r,i)},readBytes:function(){var i=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,i);return this.pos=i,r},readPackedVarint:function(i,r){if(this.type!==Qr.Bytes)return i.push(this.readVarint(r));var o=pl(this);for(i=i||[];this.pos<o;)i.push(this.readVarint(r));return i},readPackedSVarint:function(i){if(this.type!==Qr.Bytes)return i.push(this.readSVarint());var r=pl(this);for(i=i||[];this.pos<r;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Qr.Bytes)return i.push(this.readBoolean());var r=pl(this);for(i=i||[];this.pos<r;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Qr.Bytes)return i.push(this.readFloat());var r=pl(this);for(i=i||[];this.pos<r;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Qr.Bytes)return i.push(this.readDouble());var r=pl(this);for(i=i||[];this.pos<r;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Qr.Bytes)return i.push(this.readFixed32());var r=pl(this);for(i=i||[];this.pos<r;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Qr.Bytes)return i.push(this.readSFixed32());var r=pl(this);for(i=i||[];this.pos<r;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Qr.Bytes)return i.push(this.readFixed64());var r=pl(this);for(i=i||[];this.pos<r;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Qr.Bytes)return i.push(this.readSFixed64());var r=pl(this);for(i=i||[];this.pos<r;)i.push(this.readSFixed64());return i},skip:function(i){var r=7&i;if(r===Qr.Varint)for(;this.buf[this.pos++]>127;);else if(r===Qr.Bytes)this.pos=this.readVarint()+this.pos;else if(r===Qr.Fixed32)this.pos+=4;else{if(r!==Qr.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(i,r){this.writeVarint(i<<3|r)},realloc:function(i){for(var r=this.length||16;r<this.pos+i;)r*=2;if(r!==this.length){var o=new Uint8Array(r);o.set(this.buf),this.buf=o,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Uh(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Uh(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Uh(this.buf,-1&i,this.pos),Uh(this.buf,Math.floor(i*eC),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Uh(this.buf,-1&i,this.pos),Uh(this.buf,Math.floor(i*eC),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(r,o){var u,f;if(r>=0?(u=r%4294967296|0,f=r/4294967296|0):(f=~(-r/4294967296),4294967295^(u=~(-r%4294967296))?u=u+1|0:(u=0,f=f+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),function(m,y,x){x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,x.buf[x.pos]=127&(m>>>=7)}(u,0,o),function(m,y){var x=(7&m)<<4;y.buf[y.pos++]|=x|((m>>>=3)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m)))))}(f,o)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var r=this.pos;this.pos=function(u,f,m){for(var y,x,E=0;E<f.length;E++){if((y=f.charCodeAt(E))>55295&&y<57344){if(!x){y>56319||E+1===f.length?(u[m++]=239,u[m++]=191,u[m++]=189):x=y;continue}if(y<56320){u[m++]=239,u[m++]=191,u[m++]=189,x=y;continue}y=x-55296<<10|y-56320|65536,x=null}else x&&(u[m++]=239,u[m++]=191,u[m++]=189,x=null);y<128?u[m++]=y:(y<2048?u[m++]=y>>6|192:(y<65536?u[m++]=y>>12|224:(u[m++]=y>>18|240,u[m++]=y>>12&63|128),u[m++]=y>>6&63|128),u[m++]=63&y|128)}return m}(this.buf,i,this.pos);var o=this.pos-r;o>=128&&rC(r,o,this),this.pos=r-1,this.writeVarint(o),this.pos+=o},writeFloat:function(i){this.realloc(4),QA(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),QA(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var r=i.length;this.writeVarint(r),this.realloc(r);for(var o=0;o<r;o++)this.buf[this.pos++]=i[o]},writeRawMessage:function(i,r){this.pos++;var o=this.pos;i(r,this);var u=this.pos-o;u>=128&&rC(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeMessage:function(i,r,o){this.writeTag(i,Qr.Bytes),this.writeRawMessage(r,o)},writePackedVarint:function(i,r){r.length&&this.writeMessage(i,d5,r)},writePackedSVarint:function(i,r){r.length&&this.writeMessage(i,p5,r)},writePackedBoolean:function(i,r){r.length&&this.writeMessage(i,y5,r)},writePackedFloat:function(i,r){r.length&&this.writeMessage(i,m5,r)},writePackedDouble:function(i,r){r.length&&this.writeMessage(i,g5,r)},writePackedFixed32:function(i,r){r.length&&this.writeMessage(i,_5,r)},writePackedSFixed32:function(i,r){r.length&&this.writeMessage(i,v5,r)},writePackedFixed64:function(i,r){r.length&&this.writeMessage(i,x5,r)},writePackedSFixed64:function(i,r){r.length&&this.writeMessage(i,b5,r)},writeBytesField:function(i,r){this.writeTag(i,Qr.Bytes),this.writeBytes(r)},writeFixed32Field:function(i,r){this.writeTag(i,Qr.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(i,r){this.writeTag(i,Qr.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(i,r){this.writeTag(i,Qr.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(i,r){this.writeTag(i,Qr.Fixed64),this.writeSFixed64(r)},writeVarintField:function(i,r){this.writeTag(i,Qr.Varint),this.writeVarint(r)},writeSVarintField:function(i,r){this.writeTag(i,Qr.Varint),this.writeSVarint(r)},writeStringField:function(i,r){this.writeTag(i,Qr.Bytes),this.writeString(r)},writeFloatField:function(i,r){this.writeTag(i,Qr.Fixed32),this.writeFloat(r)},writeDoubleField:function(i,r){this.writeTag(i,Qr.Fixed64),this.writeDouble(r)},writeBooleanField:function(i,r){this.writeVarintField(i,!!r)}};var Xg=Z(YA);const ux=3;function w5(i,r,o){r.glyphs=[],i===1&&o.readMessage(E5,r)}function E5(i,r,o){if(i===3){const{id:u,bitmap:f,width:m,height:y,left:x,top:E,advance:T}=o.readMessage(T5,{});r.glyphs.push({id:u,bitmap:new dl({width:m+2*ux,height:y+2*ux},f),metrics:{width:m,height:y,left:x,top:E,advance:T}})}else i===4?r.ascender=o.readSVarint():i===5&&(r.descender=o.readSVarint())}function T5(i,r,o){i===1?r.id=o.readVarint():i===2?r.bitmap=o.readBytes():i===3?r.width=o.readVarint():i===4?r.height=o.readVarint():i===5?r.left=o.readSVarint():i===6?r.top=o.readSVarint():i===7&&(r.advance=o.readVarint())}const iC=ux;function cx(i){let r=0,o=0;for(const y of i)r+=y.w*y.h,o=Math.max(o,y.w);i.sort((y,x)=>x.h-y.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),o),h:1/0}];let f=0,m=0;for(const y of i)for(let x=u.length-1;x>=0;x--){const E=u[x];if(!(y.w>E.w||y.h>E.h)){if(y.x=E.x,y.y=E.y,m=Math.max(m,y.y+y.h),f=Math.max(f,y.x+y.w),y.w===E.w&&y.h===E.h){const T=u.pop();x<u.length&&(u[x]=T)}else y.h===E.h?(E.x+=y.w,E.w-=y.w):y.w===E.w?(E.y+=y.h,E.h-=y.h):(u.push({x:E.x+y.w,y:E.y,w:E.w-y.w,h:y.h}),E.y+=y.h,E.h-=y.h);break}}return{w:f,h:m,fill:r/(f*m)||0}}const To=1;class hx{constructor(r,{pixelRatio:o,version:u,stretchX:f,stretchY:m,content:y}){this.paddedRect=r,this.pixelRatio=o,this.stretchX=f,this.stretchY=m,this.content=y,this.version=u}get tl(){return[this.paddedRect.x+To,this.paddedRect.y+To]}get br(){return[this.paddedRect.x+this.paddedRect.w-To,this.paddedRect.y+this.paddedRect.h-To]}get displaySize(){return[(this.paddedRect.w-2*To)/this.pixelRatio,(this.paddedRect.h-2*To)/this.pixelRatio]}}class oC{constructor(r,o){const u={},f={};this.haveRenderCallbacks=[];const m=[];this.addImages(r,u,m),this.addImages(o,f,m);const{w:y,h:x}=cx(m),E=new Go({width:y||1,height:x||1});for(const T in r){const P=r[T],O=u[T].paddedRect;Go.copy(P.data,E,{x:0,y:0},{x:O.x+To,y:O.y+To},P.data)}for(const T in o){const P=o[T],O=f[T].paddedRect,F=O.x+To,V=O.y+To,G=P.data.width,K=P.data.height;Go.copy(P.data,E,{x:0,y:0},{x:F,y:V},P.data),Go.copy(P.data,E,{x:0,y:K-1},{x:F,y:V-1},{width:G,height:1}),Go.copy(P.data,E,{x:0,y:0},{x:F,y:V+K},{width:G,height:1}),Go.copy(P.data,E,{x:G-1,y:0},{x:F-1,y:V},{width:1,height:K}),Go.copy(P.data,E,{x:0,y:0},{x:F+G,y:V},{width:1,height:K})}this.image=E,this.iconPositions=u,this.patternPositions=f}addImages(r,o,u){for(const f in r){const m=r[f],y={x:0,y:0,w:m.data.width+2*To,h:m.data.height+2*To};u.push(y),o[f]=new hx(y,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(r,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>r.hasImage(u)),r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in r.updatedImages)this.patchUpdatedImage(this.iconPositions[u],r.getImage(u),o),this.patchUpdatedImage(this.patternPositions[u],r.getImage(u),o)}patchUpdatedImage(r,o,u){if(!r||!o||r.version===o.version)return;r.version=o.version;const[f,m]=r.tl;u.update(o.data,void 0,{x:f,y:m})}}Ut(hx,"ImagePosition"),Ut(oC,"ImageAtlas");const cs={horizontal:1,vertical:2,horizontalOnly:3},sC=-17;class fp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,o){const u=new fp;return u.scale=r||1,u.fontStack=o,u}static forImage(r){const o=new fp;return o.imageName=r,o}}class $h{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,o){const u=new $h;for(let f=0;f<r.sections.length;f++){const m=r.sections[f];m.image?u.addImageSection(m):u.addTextSection(m,o)}return u}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=function(o,u){let f="";for(let m=0;m<o.length;m++){const y=o.charCodeAt(m+1)||null,x=o.charCodeAt(m-1)||null;f+=!u&&(y&&Tg(y)&&!hp[o[m+1]]||x&&Tg(x)&&!hp[o[m-1]])||!hp[o[m]]?o[m]:hp[o[m]]}return f}(this.text,r)}trim(){let r=0;for(let u=0;u<this.text.length&&Kg[this.text.charCodeAt(u)];u++)r++;let o=this.text.length;for(let u=this.text.length-1;u>=0&&u>=r&&Kg[this.text.charCodeAt(u)];u--)o--;this.text=this.text.substring(r,o),this.sectionIndex=this.sectionIndex.slice(r,o)}substring(r,o){const u=new $h;return u.text=this.text.substring(r,o),u.sectionIndex=this.sectionIndex.slice(r,o),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,o)=>Math.max(r,this.sections[o].scale),0)}addTextSection(r,o){this.text+=r.text,this.sections.push(fp.forText(r.scale,r.fontStack||o));const u=this.sections.length-1;for(let f=0;f<r.text.length;++f)this.sectionIndex.push(u)}addImageSection(r){const o=r.image?r.image.name:"";if(o.length===0)return void et("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(fp.forImage(o)),this.sectionIndex.push(this.sections.length-1)):et("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function fx(i,r,o,u,f,m,y,x,E,T,P,O,F,V,G){const K=$h.fromFeature(i,f);O===cs.vertical&&K.verticalizePunctuation(F);let oe=[];const pe=function(Me,Je,Ze,st,xt,nt){if(!Me)return[];const ft=[],dt=function(Rt,Vt,Ft,lr,It,Zt){let ur=0;for(let kr=0;kr<Rt.length();kr++){const cr=Rt.getSection(kr);ur+=aC(Rt.getCharCode(kr),cr,lr,It,Vt,Zt)}return ur/Math.max(1,Math.ceil(ur/Ft))}(Me,Je,Ze,st,xt,nt),yt=Me.text.indexOf("")>=0;let At=0;for(let Rt=0;Rt<Me.length();Rt++){const Vt=Me.getSection(Rt),Ft=Me.getCharCode(Rt);if(Kg[Ft]||(At+=aC(Ft,Vt,st,xt,Je,nt)),Rt<Me.length()-1){const lr=!((it=Ft)<11904||!(Bt["Bopomofo Extended"](it)||Bt.Bopomofo(it)||Bt["CJK Compatibility Forms"](it)||Bt["CJK Compatibility Ideographs"](it)||Bt["CJK Compatibility"](it)||Bt["CJK Radicals Supplement"](it)||Bt["CJK Strokes"](it)||Bt["CJK Symbols and Punctuation"](it)||Bt["CJK Unified Ideographs Extension A"](it)||Bt["CJK Unified Ideographs"](it)||Bt["Enclosed CJK Letters and Months"](it)||Bt["Halfwidth and Fullwidth Forms"](it)||Bt.Hiragana(it)||Bt["Ideographic Description Characters"](it)||Bt["Kangxi Radicals"](it)||Bt["Katakana Phonetic Extensions"](it)||Bt.Katakana(it)||Bt["Vertical Forms"](it)||Bt["Yi Radicals"](it)||Bt["Yi Syllables"](it)));(S5[Ft]||lr||Vt.imageName)&&ft.push(uC(Rt+1,At,dt,ft,A5(Ft,Me.getCharCode(Rt+1),lr&&yt),!1))}}var it;return cC(uC(Me.length(),At,dt,ft,0,!0))}(K,T,m,r,u,V),{processBidirectionalText:Ae,processStyledBidirectionalText:me}=C;if(Ae&&K.sections.length===1){const Me=Ae(K.toString(),pe);for(const Je of Me){const Ze=new $h;Ze.text=Je,Ze.sections=K.sections;for(let st=0;st<Je.length;st++)Ze.sectionIndex.push(0);oe.push(Ze)}}else if(me){const Me=me(K.text,K.sectionIndex,pe);for(const Je of Me){const Ze=new $h;Ze.text=Je[0],Ze.sectionIndex=Je[1],Ze.sections=K.sections,oe.push(Ze)}}else oe=function(Me,Je){const Ze=[],st=Me.text;let xt=0;for(const nt of Je)Ze.push(Me.substring(xt,nt)),xt=nt;return xt<st.length&&Ze.push(Me.substring(xt,st.length)),Ze}(K,pe);const Se=[],ke={positionedLines:Se,text:K.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:O,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Me,Je,Ze,st,xt,nt,ft,dt,yt,At,it,Rt){let Vt=0,Ft=0,lr=0;const It=dt==="right"?1:dt==="left"?0:.5;let Zt=!1;for(const hr of xt){const fr=hr.getSections();for(const Xr of fr){if(Xr.imageName)continue;const en=Je[Xr.fontStack];if(en&&(Zt=en.ascender!==void 0&&en.descender!==void 0,!Zt))break}if(!Zt)break}let ur=0;for(const hr of xt){hr.trim();const fr=hr.getMaxScale(),Xr=(fr-1)*Ai,en={positionedGlyphs:[],lineOffset:0};Me.positionedLines[ur]=en;const tn=en.positionedGlyphs;let Kr=0;if(!hr.length()){Ft+=nt,++ur;continue}let mn=0,Pn=0;for(let Yr=0;Yr<hr.length();Yr++){const oi=hr.getSection(Yr),Hn=hr.getSectionIndex(Yr),En=hr.getCharCode(Yr);let Or=oi.scale,Xn=null,rn=null,ao=null,Kn=Ai,Ci=0;const gi=!(yt===cs.horizontal||!it&&!Nd(En)||it&&(Kg[En]||(kr=En,Bt.Arabic(kr)||Bt["Arabic Supplement"](kr)||Bt["Arabic Extended-A"](kr)||Bt["Arabic Presentation Forms-A"](kr)||Bt["Arabic Presentation Forms-B"](kr))));if(oi.imageName){const lo=st[oi.imageName];if(!lo)continue;ao=oi.imageName,Me.iconsInText=Me.iconsInText||!0,rn=lo.paddedRect;const yi=lo.displaySize;Or=Or*Ai/Rt,Xn={width:yi[0],height:yi[1],left:To,top:-iC,advance:gi?yi[1]:yi[0],localGlyph:!1},Ci=Zt?-Xn.height*Or:sC+fr*Ai-yi[1]*Or,Kn=Xn.advance;const Qs=(gi?yi[0]:yi[1])*Or-Ai*fr;Qs>0&&Qs>Kr&&(Kr=Qs)}else{const lo=Ze[oi.fontStack];if(!lo)continue;lo[En]&&(rn=lo[En]);const yi=Je[oi.fontStack];if(!yi)continue;const Qs=yi.glyphs[En];if(!Qs)continue;if(Xn=Qs.metrics,Kn=En!==8203?Ai:0,Zt){const Hh=yi.ascender!==void 0?Math.abs(yi.ascender):0,wp=yi.descender!==void 0?Math.abs(yi.descender):0,Ep=(Hh+wp)*Or;mn<Ep&&(mn=Ep,Pn=(Hh-wp)/2*Or),Ci=-Hh*Or}else Ci=sC+(fr-Or)*Ai}gi?(Me.verticalizable=!0,tn.push({glyph:En,imageName:ao,x:Vt,y:Ft+Ci,vertical:gi,scale:Or,localGlyph:Xn.localGlyph,fontStack:oi.fontStack,sectionIndex:Hn,metrics:Xn,rect:rn}),Vt+=Kn*Or+At):(tn.push({glyph:En,imageName:ao,x:Vt,y:Ft+Ci,vertical:gi,scale:Or,localGlyph:Xn.localGlyph,fontStack:oi.fontStack,sectionIndex:Hn,metrics:Xn,rect:rn}),Vt+=Xn.advance*Or+At)}tn.length!==0&&(lr=Math.max(Vt-At,lr),Zt?hC(tn,It,Kr,Pn,nt*fr/2):hC(tn,It,Kr,0,nt/2)),Vt=0;const Zn=nt*fr+Kr;en.lineOffset=Math.max(Kr,Xr),Ft+=Zn,++ur}var kr;const cr=Ft,{horizontalAlign:er,verticalAlign:on}=dx(ft);(function(hr,fr,Xr,en,tn,Kr){const mn=(fr-Xr)*tn,Pn=-Kr*en;for(const Zn of hr)for(const Yr of Zn.positionedGlyphs)Yr.x+=mn,Yr.y+=Pn})(Me.positionedLines,It,er,on,lr,cr),Me.top+=-on*cr,Me.bottom=Me.top+cr,Me.left+=-er*lr,Me.right=Me.left+lr,Me.hasBaseline=Zt}(ke,r,o,u,oe,y,x,E,O,T,F,G),!function(Me){for(const Je of Me)if(Je.positionedGlyphs.length!==0)return!1;return!0}(Se)&&ke}const Kg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},S5={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function aC(i,r,o,u,f,m){if(r.imageName){const y=u[r.imageName];return y?y.displaySize[0]*r.scale*Ai/m+f:0}{const y=o[r.fontStack],x=y&&y.glyphs[i];return x?x.metrics.advance*r.scale+f:0}}function lC(i,r,o,u){const f=Math.pow(i-r,2);return u?i<r?f/2:2*f:f+Math.abs(o)*o}function A5(i,r,o){let u=0;return i===10&&(u-=1e4),o&&(u+=150),i!==40&&i!==65288||(u+=50),r!==41&&r!==65289||(u+=50),u}function uC(i,r,o,u,f,m){let y=null,x=lC(r,o,f,m);for(const E of u){const T=lC(r-E.x,o,f,m)+E.badness;T<=x&&(y=E,x=T)}return{index:i,x:r,priorBreak:y,badness:x}}function cC(i){return i?cC(i.priorBreak).concat(i.index):[]}function dx(i){let r=.5,o=.5;switch(i){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:r,verticalAlign:o}}function hC(i,r,o,u,f){if(!(r||o||u||f))return;const m=i.length-1,y=i[m],x=(y.x+y.metrics.advance*y.scale)*r;for(let E=0;E<=m;E++)i[E].x-=x,i[E].y+=o+u+f}function C5(i,r,o){const{horizontalAlign:u,verticalAlign:f}=dx(o),m=r[0]-i.displaySize[0]*u,y=r[1]-i.displaySize[1]*f;return{image:i,top:y,bottom:y+i.displaySize[1],left:m,right:m+i.displaySize[0]}}function fC(i,r,o,u,f,m){const y=i.image;let x;if(y.content){const oe=y.content,pe=y.pixelRatio||1;x=[oe[0]/pe,oe[1]/pe,y.displaySize[0]-oe[2]/pe,y.displaySize[1]-oe[3]/pe]}const E=r.left*m,T=r.right*m;let P,O,F,V;o==="width"||o==="both"?(V=f[0]+E-u[3],O=f[0]+T+u[1]):(V=f[0]+(E+T-y.displaySize[0])/2,O=V+y.displaySize[0]);const G=r.top*m,K=r.bottom*m;return o==="height"||o==="both"?(P=f[1]+G-u[0],F=f[1]+K+u[2]):(P=f[1]+(G+K-y.displaySize[1])/2,F=P+y.displaySize[1]),{image:y,top:P,right:O,bottom:F,left:V,collisionPadding:x}}class ml extends he{constructor(r,o,u,f,m){super(r,o),this.angle=f,this.z=u,m!==void 0&&(this.segment=m)}clone(){return new ml(this.x,this.y,this.z,this.angle,this.segment)}}function dC(i,r,o,u,f){if(r.segment===void 0)return!0;let m=r,y=r.segment+1,x=0;for(;x>-o/2;){if(y--,y<0)return!1;x-=i[y].dist(m),m=i[y]}x+=i[y].dist(i[y+1]),y++;const E=[];let T=0;for(;x<o/2;){const P=i[y],O=i[y+1];if(!O)return!1;let F=i[y-1].angleTo(P)-P.angleTo(O);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:x,angleDelta:F}),T+=F;x-E[0].distance>u;)T-=E.shift().angleDelta;if(T>f)return!1;y++,x+=P.dist(O)}return!0}function pC(i){let r=0;for(let o=0;o<i.length-1;o++)r+=i[o].dist(i[o+1]);return r}function mC(i,r,o){return i?.6*r*o:0}function gC(i,r){return Math.max(i?i.right-i.left:0,r?r.right-r.left:0)}function I5(i,r,o,u,f,m){const y=mC(o,f,m),x=gC(o,u)*m;let E=0;const T=pC(i)/2;for(let P=0;P<i.length-1;P++){const O=i[P],F=i[P+1],V=O.dist(F);if(E+V>T){const G=(T-E)/V,K=Cr(O.x,F.x,G),oe=Cr(O.y,F.y,G),pe=new ml(K,oe,0,F.angleTo(O),P);return!y||dC(i,pe,x,y,r)?pe:void 0}E+=V}}function M5(i,r,o,u,f,m,y,x,E){const T=mC(u,m,y),P=gC(u,f),O=P*y,F=i[0].x===0||i[0].x===E||i[0].y===0||i[0].y===E;return r-O<r/4&&(r=O+r/4),yC(i,F?r/2*x%r:(P/2+2*m)*y*x%r,r,T,o,O,F,!1,E)}function yC(i,r,o,u,f,m,y,x,E){const T=m/2,P=pC(i);let O=0,F=r-o,V=[];for(let G=0;G<i.length-1;G++){const K=i[G],oe=i[G+1],pe=K.dist(oe),Ae=oe.angleTo(K);for(;F+o<O+pe;){F+=o;const me=(F-O)/pe,Se=Cr(K.x,oe.x,me),ke=Cr(K.y,oe.y,me);if(Se>=0&&Se<E&&ke>=0&&ke<E&&F-T>=0&&F+T<=P){const Me=new ml(Se,ke,0,Ae,G);Me._round(),u&&!dC(i,Me,m,u,f)||V.push(Me)}}O+=pe}return x||V.length||y||(V=yC(i,O/2,o,u,f,m,y,!0,E)),V}function _C(i,r,o,u,f){const m=[];for(let y=0;y<i.length;y++){const x=i[y];let E;for(let T=0;T<x.length-1;T++){let P=x[T],O=x[T+1];P.x<r&&O.x<r||(P.x<r?P=new he(r,P.y+(r-P.x)/(O.x-P.x)*(O.y-P.y))._round():O.x<r&&(O=new he(r,P.y+(r-P.x)/(O.x-P.x)*(O.y-P.y))._round()),P.y<o&&O.y<o||(P.y<o?P=new he(P.x+(o-P.y)/(O.y-P.y)*(O.x-P.x),o)._round():O.y<o&&(O=new he(P.x+(o-P.y)/(O.y-P.y)*(O.x-P.x),o)._round()),P.x>=u&&O.x>=u||(P.x>=u?P=new he(u,P.y+(u-P.x)/(O.x-P.x)*(O.y-P.y))._round():O.x>=u&&(O=new he(u,P.y+(u-P.x)/(O.x-P.x)*(O.y-P.y))._round()),P.y>=f&&O.y>=f||(P.y>=f?P=new he(P.x+(f-P.y)/(O.y-P.y)*(O.x-P.x),f)._round():O.y>=f&&(O=new he(P.x+(f-P.y)/(O.y-P.y)*(O.x-P.x),f)._round()),E&&P.equals(E[E.length-1])||(E=[P],m.push(E)),E.push(O)))))}}return m}Ut(ml,"Anchor");const dp=1e20;function vC(i,r,o,u,f,m,y,x,E){for(let T=r;T<r+u;T++)xC(i,o*m+T,m,f,y,x,E);for(let T=o;T<o+f;T++)xC(i,T*m+r,1,u,y,x,E)}function xC(i,r,o,u,f,m,y){m[0]=0,y[0]=-dp,y[1]=dp,f[0]=i[r];for(let x=1,E=0,T=0;x<u;x++){f[x]=i[r+x*o];const P=x*x;do{const O=m[E];T=(f[x]-f[O]+P-O*O)/(x-O)/2}while(T<=y[E]&&--E>-1);E++,m[E]=x,y[E]=T,y[E+1]=dp}for(let x=0,E=0;x<u;x++){for(;y[E+1]<x;)E++;const T=m[E],P=x-T;i[r+x*o]=f[T]+P*P}}const Ys=2,px={none:0,ideographs:1,all:2};class jh{constructor(r,o,u){this.requestManager=r,this.localGlyphMode=o,this.localFontFamily=u,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,o){const u=[];for(const f in r)for(const m of r[f])u.push({stack:f,id:m});Le(u,({stack:f,id:m},y)=>{let x=this.entries[f];x||(x=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=x.glyphs[m];if(E!==void 0)return void y(null,{stack:f,id:m,glyph:E});if(E=this._tinySDF(x,f,m),E)return x.glyphs[m]=E,void y(null,{stack:f,id:m,glyph:E});const T=Math.floor(m/256);if(256*T>65535)return void y(new Error("glyphs > 65535 not supported"));if(x.ranges[T])return void y(null,{stack:f,id:m,glyph:E});let P=x.requests[T];P||(P=x.requests[T]=[],jh.loadGlyphRange(f,T,this.url,this.requestManager,(O,F)=>{if(F){x.ascender=F.ascender,x.descender=F.descender;for(const V in F.glyphs)this._doesCharSupportLocalGlyph(+V)||(x.glyphs[+V]=F.glyphs[+V]);x.ranges[T]=!0}for(const V of P)V(O,F);delete x.requests[T]})),P.push((O,F)=>{O?y(O):F&&y(null,{stack:f,id:m,glyph:F.glyphs[m]||null})})},(f,m)=>{if(f)o(f);else if(m){const y={};for(const{stack:x,id:E,glyph:T}of m)y[x]===void 0&&(y[x]={}),y[x].glyphs===void 0&&(y[x].glyphs={}),y[x].glyphs[E]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},y[x].ascender=this.entries[x].ascender,y[x].descender=this.entries[x].descender;o(null,y)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==px.none&&(this.localGlyphMode===px.all?!!this.localFontFamily:!!this.localFontFamily&&(Bt["CJK Unified Ideographs"](r)||Bt["Hangul Syllables"](r)||Bt.Hiragana(r)||Bt.Katakana(r)||Bt["CJK Symbols and Punctuation"](r)))}_tinySDF(r,o,u){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(u))return;let m=r.tinySDF;if(!m){let K="400";/bold/i.test(o)?K="900":/medium/i.test(o)?K="500":/light/i.test(o)&&(K="200"),m=r.tinySDF=new jh.TinySDF({fontFamily:f,fontWeight:K,fontSize:24*Ys,buffer:3*Ys,radius:8*Ys}),m.fontWeight=K}if(this.localGlyphs[m.fontWeight][u])return this.localGlyphs[m.fontWeight][u];const y=String.fromCharCode(u),{data:x,width:E,height:T,glyphWidth:P,glyphHeight:O,glyphLeft:F,glyphTop:V,glyphAdvance:G}=m.draw(y);return this.localGlyphs[m.fontWeight][u]={id:u,bitmap:new dl({width:E,height:T},x),metrics:{width:P/Ys,height:O/Ys,left:F/Ys,top:V/Ys-27,advance:G/Ys,localGlyph:!0}}}}jh.loadGlyphRange=function(i,r,o,u,f){const m=256*r,y=m+255,x=u.transformRequest(u.normalizeGlyphsURL(o).replace("{fontstack}",i).replace("{range}",`${m}-${y}`),Wi.Glyphs);vs(x,(E,T)=>{if(E)f(E);else if(T){const P={},O=function(F){return new Xg(F).readFields(w5,{})}(T);for(const F of O.glyphs)P[F.id]=F;f(null,{glyphs:P,ascender:O.ascender,descender:O.descender})}})},jh.TinySDF=class{constructor({fontSize:i=24,buffer:r=3,radius:o=8,cutoff:u=.25,fontFamily:f="sans-serif",fontWeight:m="normal",fontStyle:y="normal"}={}){this.buffer=r,this.cutoff=u,this.radius=o;const x=this.size=i+4*r,E=this._createCanvas(x),T=this.ctx=E.getContext("2d",{willReadFrequently:!0});T.font=`${y} ${m} ${i}px ${f}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(i){const r=document.createElement("canvas");return r.width=r.height=i,r}draw(i){const{width:r,actualBoundingBoxAscent:o,actualBoundingBoxDescent:u,actualBoundingBoxLeft:f,actualBoundingBoxRight:m}=this.ctx.measureText(i),y=Math.ceil(o),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-f))),E=Math.min(this.size-this.buffer,y+Math.ceil(u)),T=x+2*this.buffer,P=E+2*this.buffer,O=Math.max(T*P,0),F=new Uint8ClampedArray(O),V={data:F,width:T,height:P,glyphWidth:x,glyphHeight:E,glyphTop:y,glyphLeft:0,glyphAdvance:r};if(x===0||E===0)return V;const{ctx:G,buffer:K,gridInner:oe,gridOuter:pe}=this;G.clearRect(K,K,x,E),G.fillText(i,K,K+y);const Ae=G.getImageData(K,K,x,E);pe.fill(dp,0,O),oe.fill(0,0,O);for(let me=0;me<E;me++)for(let Se=0;Se<x;Se++){const ke=Ae.data[4*(me*x+Se)+3]/255;if(ke===0)continue;const Me=(me+K)*T+Se+K;if(ke===1)pe[Me]=0,oe[Me]=dp;else{const Je=.5-ke;pe[Me]=Je>0?Je*Je:0,oe[Me]=Je<0?Je*Je:0}}vC(pe,0,0,T,P,T,this.f,this.v,this.z),vC(oe,K,K,x,E,T,this.f,this.v,this.z);for(let me=0;me<O;me++){const Se=Math.sqrt(pe[me])-Math.sqrt(oe[me]);F[me]=Math.round(255-255*(Se/this.radius+this.cutoff))}return V}};const Vh=To;function bC(i,r,o,u){const f=[],m=i.image,y=m.pixelRatio,x=m.paddedRect.w-2*Vh,E=m.paddedRect.h-2*Vh,T=i.right-i.left,P=i.bottom-i.top,O=m.stretchX||[[0,x]],F=m.stretchY||[[0,E]],V=(nt,ft)=>nt+ft[1]-ft[0],G=O.reduce(V,0),K=F.reduce(V,0),oe=x-G,pe=E-K;let Ae=0,me=G,Se=0,ke=K,Me=0,Je=oe,Ze=0,st=pe;if(m.content&&u){const nt=m.content;Ae=Yg(O,0,nt[0]),Se=Yg(F,0,nt[1]),me=Yg(O,nt[0],nt[2]),ke=Yg(F,nt[1],nt[3]),Me=nt[0]-Ae,Ze=nt[1]-Se,Je=nt[2]-nt[0]-me,st=nt[3]-nt[1]-ke}const xt=(nt,ft,dt,yt)=>{const At=Jg(nt.stretch-Ae,me,T,i.left),it=Qg(nt.fixed-Me,Je,nt.stretch,G),Rt=Jg(ft.stretch-Se,ke,P,i.top),Vt=Qg(ft.fixed-Ze,st,ft.stretch,K),Ft=Jg(dt.stretch-Ae,me,T,i.left),lr=Qg(dt.fixed-Me,Je,dt.stretch,G),It=Jg(yt.stretch-Se,ke,P,i.top),Zt=Qg(yt.fixed-Ze,st,yt.stretch,K),ur=new he(At,Rt),kr=new he(Ft,Rt),cr=new he(Ft,It),er=new he(At,It),on=new he(it/y,Vt/y),hr=new he(lr/y,Zt/y),fr=r*Math.PI/180;if(fr){const tn=Math.sin(fr),Kr=Math.cos(fr),mn=[Kr,-tn,tn,Kr];ur._matMult(mn),kr._matMult(mn),er._matMult(mn),cr._matMult(mn)}const Xr=nt.stretch+nt.fixed,en=ft.stretch+ft.fixed;return{tl:ur,tr:kr,bl:er,br:cr,tex:{x:m.paddedRect.x+Vh+Xr,y:m.paddedRect.y+Vh+en,w:dt.stretch+dt.fixed-Xr,h:yt.stretch+yt.fixed-en},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:on,pixelOffsetBR:hr,minFontScaleX:Je/y/T,minFontScaleY:st/y/P,isSDF:o}};if(u&&(m.stretchX||m.stretchY)){const nt=wC(O,oe,G),ft=wC(F,pe,K);for(let dt=0;dt<nt.length-1;dt++){const yt=nt[dt],At=nt[dt+1];for(let it=0;it<ft.length-1;it++)f.push(xt(yt,ft[it],At,ft[it+1]))}}else f.push(xt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:E+1}));return f}function Yg(i,r,o){let u=0;for(const f of i)u+=Math.max(r,Math.min(o,f[1]))-Math.max(r,Math.min(o,f[0]));return u}function wC(i,r,o){const u=[{fixed:-Vh,stretch:0}];for(const[f,m]of i){const y=u[u.length-1];u.push({fixed:f-y.stretch,stretch:y.stretch}),u.push({fixed:f-y.stretch,stretch:y.stretch+(m-f)})}return u.push({fixed:r+Vh,stretch:o}),u}function Jg(i,r,o,u){return i/r*o+u}function Qg(i,r,o,u){return i-r*o/u}function P5(i,r,o,u){const f=r+i.positionedLines[u].lineOffset;return u===0?o+f/2:o+(f+(r+i.positionedLines[u-1].lineOffset))/2}class k5{constructor(r=[],o=L5){if(this.data=r,this.length=this.data.length,this.compare=o,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const r=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:o,compare:u}=this,f=o[r];for(;r>0;){const m=r-1>>1,y=o[m];if(u(f,y)>=0)break;o[r]=y,r=m}o[r]=f}_down(r){const{data:o,compare:u}=this,f=this.length>>1,m=o[r];for(;r<f;){let y=1+(r<<1),x=o[y];const E=y+1;if(E<this.length&&u(o[E],x)<0&&(y=E,x=o[E]),u(x,m)>=0)break;o[r]=x,r=y}o[r]=m}}function L5(i,r){return i<r?-1:i>r?1:0}function O5(i,r=1,o=!1){let u=1/0,f=1/0,m=-1/0,y=-1/0;const x=i[0];for(let V=0;V<x.length;V++){const G=x[V];(!V||G.x<u)&&(u=G.x),(!V||G.y<f)&&(f=G.y),(!V||G.x>m)&&(m=G.x),(!V||G.y>y)&&(y=G.y)}const E=Math.min(m-u,y-f);let T=E/2;const P=new k5([],D5);if(E===0)return new he(u,f);for(let V=u;V<m;V+=E)for(let G=f;G<y;G+=E)P.push(new Gh(V+T,G+T,T,i));let O=function(V){let G=0,K=0,oe=0;const pe=V[0];for(let Ae=0,me=pe.length,Se=me-1;Ae<me;Se=Ae++){const ke=pe[Ae],Me=pe[Se],Je=ke.x*Me.y-Me.x*ke.y;K+=(ke.x+Me.x)*Je,oe+=(ke.y+Me.y)*Je,G+=3*Je}return new Gh(K/G,oe/G,0,V)}(i),F=P.length;for(;P.length;){const V=P.pop();(V.d>O.d||!O.d)&&(O=V,o&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,F)),V.max-O.d<=r||(T=V.h/2,P.push(new Gh(V.p.x-T,V.p.y-T,T,i)),P.push(new Gh(V.p.x+T,V.p.y-T,T,i)),P.push(new Gh(V.p.x-T,V.p.y+T,T,i)),P.push(new Gh(V.p.x+T,V.p.y+T,T,i)),F+=4)}return o&&(console.log(`num probes: ${F}`),console.log(`best distance: ${O.d}`)),O.p}function D5(i,r){return r.max-i.max}class Gh{constructor(r,o,u,f){this.p=new he(r,o),this.h=u,this.d=function(m,y){let x=!1,E=1/0;for(let T=0;T<y.length;T++){const P=y[T];for(let O=0,F=P.length,V=F-1;O<F;V=O++){const G=P[O],K=P[V];G.y>m.y!=K.y>m.y&&m.x<(K.x-G.x)*(m.y-G.y)/(K.y-G.y)+G.x&&(x=!x),E=Math.min(E,yA(m,G,K))}}return(x?1:-1)*Math.sqrt(E)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}}const qh=7,mx=Number.POSITIVE_INFINITY,R5=Math.sqrt(2);function EC(i,[r,o]){let u=0,f=0;if(o===mx){r<0&&(r=0);const m=r/R5;switch(i){case"top-right":case"top-left":f=m-qh;break;case"bottom-right":case"bottom-left":f=-m+qh;break;case"bottom":f=-r+qh;break;case"top":f=r-qh}switch(i){case"top-right":case"bottom-right":u=-m;break;case"top-left":case"bottom-left":u=m;break;case"left":u=r;break;case"right":u=-r}}else{switch(r=Math.abs(r),o=Math.abs(o),i){case"top-right":case"top-left":case"top":f=o-qh;break;case"bottom-right":case"bottom-left":case"bottom":f=-o+qh}switch(i){case"top-right":case"bottom-right":case"right":u=-r;break;case"top-left":case"bottom-left":case"left":u=r}}return[u,f]}function z5(i,r,o,u,f,m,y,x,E,T){i.createArrays(),i.tilePixelRatio=Xt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const P=i.layers[0].layout,O=i.layers[0]._unevaluatedLayout._values,F={};if(i.textSizeData.kind==="composite"){const{minZoom:K,maxZoom:oe}=i.textSizeData;F.compositeTextSizes=[O["text-size"].possiblyEvaluate(new L(K),x),O["text-size"].possiblyEvaluate(new L(oe),x)]}if(i.iconSizeData.kind==="composite"){const{minZoom:K,maxZoom:oe}=i.iconSizeData;F.compositeIconSizes=[O["icon-size"].possiblyEvaluate(new L(K),x),O["icon-size"].possiblyEvaluate(new L(oe),x)]}F.layoutTextSize=O["text-size"].possiblyEvaluate(new L(E+1),x),F.layoutIconSize=O["icon-size"].possiblyEvaluate(new L(E+1),x),F.textMaxSize=O["text-size"].possiblyEvaluate(new L(18),x);const V=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",G=P.get("text-size");for(const K of i.features){const oe=P.get("text-font").evaluate(K,{},x).join(","),pe=G.evaluate(K,{},x),Ae=F.layoutTextSize.evaluate(K,{},x),me=(F.layoutIconSize.evaluate(K,{},x),{horizontal:{},vertical:void 0}),Se=K.text;let ke,Me=[0,0];if(Se){const st=Se.toString(),xt=P.get("text-letter-spacing").evaluate(K,{},x)*Ai,nt=P.get("text-line-height").evaluate(K,{},x)*Ai,ft=T0(st)?xt:0,dt=P.get("text-anchor").evaluate(K,{},x),yt=P.get("text-variable-anchor");if(!yt){const Ft=P.get("text-radial-offset").evaluate(K,{},x);Me=Ft?EC(dt,[Ft*Ai,mx]):P.get("text-offset").evaluate(K,{},x).map(lr=>lr*Ai)}let At=V?"center":P.get("text-justify").evaluate(K,{},x);const it=P.get("symbol-placement")==="point",Rt=it?P.get("text-max-width").evaluate(K,{},x)*Ai:1/0,Vt=Ft=>{i.allowVerticalPlacement&&Bd(st)&&(me.vertical=fx(Se,r,o,f,oe,Rt,nt,dt,Ft,ft,Me,cs.vertical,!0,Ae,pe))};if(!V&&yt){const Ft=At==="auto"?yt.map(It=>gx(It)):[At];let lr=!1;for(let It=0;It<Ft.length;It++){const Zt=Ft[It];if(!me.horizontal[Zt])if(lr)me.horizontal[Zt]=me.horizontal[0];else{const ur=fx(Se,r,o,f,oe,Rt,nt,"center",Zt,ft,Me,cs.horizontal,!1,Ae,pe);ur&&(me.horizontal[Zt]=ur,lr=ur.positionedLines.length===1)}}Vt("left")}else{if(At==="auto"&&(At=gx(dt)),it||P.get("text-writing-mode").indexOf("horizontal")>=0||!Bd(st)){const Ft=fx(Se,r,o,f,oe,Rt,nt,dt,At,ft,Me,cs.horizontal,!1,Ae,pe);Ft&&(me.horizontal[At]=Ft)}Vt(it?"left":At)}}let Je=!1;if(K.icon&&K.icon.name){const st=u[K.icon.name];st&&(ke=C5(f[K.icon.name],P.get("icon-offset").evaluate(K,{},x),P.get("icon-anchor").evaluate(K,{},x)),Je=st.sdf,i.sdfIcons===void 0?i.sdfIcons=st.sdf:i.sdfIcons!==st.sdf&&et("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(st.pixelRatio!==i.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const Ze=SC(me.horizontal)||me.vertical;i.iconsInText||(i.iconsInText=!!Ze&&Ze.iconsInText),(Ze||ke)&&F5(i,K,me,ke,u,F,Ae,0,Me,Je,y,x,T)}m&&i.generateCollisionDebugBuffers(E,i.collisionBoxArray)}function gx(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function F5(i,r,o,u,f,m,y,x,E,T,P,O,F){let V=m.textMaxSize.evaluate(r,{},O);V===void 0&&(V=y);const G=i.layers[0].layout,K=G.get("icon-offset").evaluate(r,{},O),oe=SC(o.horizontal)||o.vertical,pe=F.name==="globe",Ae=Ai,me=y/Ae,Se=i.tilePixelRatio*V/Ae,ke=(dt=i.overscaling,i.zoom>18&&dt>2&&(dt>>=1),Math.max(Xt/(512*dt),1)*G.get("symbol-spacing")),Me=G.get("text-padding")*i.tilePixelRatio,Je=G.get("icon-padding")*i.tilePixelRatio,Ze=ie(G.get("text-max-angle")),st=G.get("text-rotation-alignment")==="map"&&G.get("symbol-placement")!=="point",xt=G.get("icon-rotation-alignment")==="map"&&G.get("symbol-placement")!=="point",nt=G.get("symbol-placement"),ft=ke/2;var dt;const yt=G.get("icon-text-fit");let At;u&&yt!=="none"&&(i.allowVerticalPlacement&&o.vertical&&(At=fC(u,o.vertical,yt,G.get("icon-text-fit-padding"),K,me)),oe&&(u=fC(u,oe,yt,G.get("icon-text-fit-padding"),K,me)));const it=(Rt,Vt,Ft)=>{if(Vt.x<0||Vt.x>=Xt||Vt.y<0||Vt.y>=Xt)return;let lr=null;if(pe){const{x:It,y:Zt,z:ur}=F.projectTilePoint(Vt.x,Vt.y,Ft);lr={anchor:new ml(It,Zt,ur,0,void 0),up:F.upVector(Ft,Vt.x,Vt.y)}}(function(It,Zt,ur,kr,cr,er,on,hr,fr,Xr,en,tn,Kr,mn,Pn,Zn,Yr,oi,Hn,En,Or,Xn,rn,ao,Kn){const Ci=It.addToLineVertexArray(Zt,kr);let gi,lo,yi,Qs,Hh,wp,Ep,iI=0,oI=0,sI=0,aI=0,kx=-1,Lx=-1;const Ma={};let lI=C0("");const Tc=ur?ur.anchor:Zt;let Ox=0,Dx=0;if(fr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Ox,Dx]=fr.layout.get("text-offset").evaluate(Or,{},Kn).map(qo=>qo*Ai):(Ox=fr.layout.get("text-radial-offset").evaluate(Or,{},Kn)*Ai,Dx=mx),It.allowVerticalPlacement&&cr.vertical){const qo=cr.vertical;if(Pn)wp=yx(qo),hr&&(Ep=yx(hr));else{const Wo=fr.layout.get("text-rotate").evaluate(Or,{},Kn)+90;yi=ey(Xr,Tc,Zt,en,tn,Kr,qo,mn,Wo,Zn),hr&&(Qs=ey(Xr,Tc,Zt,en,tn,Kr,hr,oi,Wo))}}if(er){const qo=fr.layout.get("icon-rotate").evaluate(Or,{},Kn),Wo=fr.layout.get("icon-text-fit")!=="none",Tp=bC(er,qo,rn,Wo),zx=hr?bC(hr,qo,rn,Wo):void 0;lo=ey(Xr,Tc,Zt,en,tn,Kr,er,oi,qo),iI=4*Tp.length;const uI=It.iconSizeData;let Sc=null;uI.kind==="source"?(Sc=[Ks*fr.layout.get("icon-size").evaluate(Or,{},Kn)],Sc[0]>Ql&&et(`${It.layerIds[0]}: Value for "icon-size" is >= ${pp}. Reduce your "icon-size".`)):uI.kind==="composite"&&(Sc=[Ks*Xn.compositeIconSizes[0].evaluate(Or,{},Kn),Ks*Xn.compositeIconSizes[1].evaluate(Or,{},Kn)],(Sc[0]>Ql||Sc[1]>Ql)&&et(`${It.layerIds[0]}: Value for "icon-size" is >= ${pp}. Reduce your "icon-size".`)),It.addSymbols(It.icon,Tp,Sc,En,Hn,Or,!1,ur,Zt,Ci.lineStartIndex,Ci.lineLength,-1,ao,Kn),kx=It.icon.placedSymbolArray.length-1,zx&&(oI=4*zx.length,It.addSymbols(It.icon,zx,Sc,En,Hn,Or,cs.vertical,ur,Zt,Ci.lineStartIndex,Ci.lineLength,-1,ao,Kn),Lx=It.icon.placedSymbolArray.length-1)}for(const qo in cr.horizontal){const Wo=cr.horizontal[qo];gi||(lI=C0(Wo.text),Pn?Hh=yx(Wo):gi=ey(Xr,Tc,Zt,en,tn,Kr,Wo,mn,fr.layout.get("text-rotate").evaluate(Or,{},Kn),Zn));const Tp=Wo.positionedLines.length===1;if(sI+=TC(It,ur,Zt,Wo,on,fr,Pn,Or,Zn,Ci,cr.vertical?cs.horizontal:cs.horizontalOnly,Tp?Object.keys(cr.horizontal):[qo],Ma,kx,Xn,ao,Kn),Tp)break}cr.vertical&&(aI+=TC(It,ur,Zt,cr.vertical,on,fr,Pn,Or,Zn,Ci,cs.vertical,["vertical"],Ma,Lx,Xn,ao,Kn));let ou=-1;const Rx=(qo,Wo)=>qo?Math.max(qo,Wo):Wo;ou=Rx(Hh,ou),ou=Rx(wp,ou),ou=Rx(Ep,ou);const hN=ou>-1?1:0;It.glyphOffsetArray.length>=tu.MAX_GLYPHS&&et("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Or.sortKey!==void 0&&It.addToSortKeyRanges(It.symbolInstances.length,Or.sortKey),It.symbolInstances.emplaceBack(Tc.x,Tc.y,Tc.z,Zt.x,Zt.y,Ma.right>=0?Ma.right:-1,Ma.center>=0?Ma.center:-1,Ma.left>=0?Ma.left:-1,Ma.vertical>=0?Ma.vertical:-1,kx,Lx,lI,gi!==void 0?gi:It.collisionBoxArray.length,gi!==void 0?gi+1:It.collisionBoxArray.length,yi!==void 0?yi:It.collisionBoxArray.length,yi!==void 0?yi+1:It.collisionBoxArray.length,lo!==void 0?lo:It.collisionBoxArray.length,lo!==void 0?lo+1:It.collisionBoxArray.length,Qs||It.collisionBoxArray.length,Qs?Qs+1:It.collisionBoxArray.length,en,sI,aI,iI,oI,hN,0,Ox,Dx,ou)})(i,Vt,lr,Rt,o,u,f,At,i.layers[0],i.collisionBoxArray,r.index,r.sourceLayerIndex,i.index,Me,st,E,0,Je,xt,K,r,m,T,P,O)};if(nt==="line")for(const Rt of _C(r.geometry,0,0,Xt,Xt)){const Vt=M5(Rt,ke,Ze,o.vertical||oe,u,Ae,Se,i.overscaling,Xt);for(const Ft of Vt)oe&&B5(i,oe.text,ft,Ft)||it(Rt,Ft,O)}else if(nt==="line-center"){for(const Rt of r.geometry)if(Rt.length>1){const Vt=I5(Rt,Ze,o.vertical||oe,u,Ae,Se);Vt&&it(Rt,Vt,O)}}else if(r.type==="Polygon")for(const Rt of nx(r.geometry,0)){const Vt=O5(Rt,16);it(Rt[0],new ml(Vt.x,Vt.y,0,0,void 0),O)}else if(r.type==="LineString")for(const Rt of r.geometry)it(Rt,new ml(Rt[0].x,Rt[0].y,0,0,void 0),O);else if(r.type==="Point")for(const Rt of r.geometry)for(const Vt of Rt)it([Vt],new ml(Vt.x,Vt.y,0,0,void 0),O)}const pp=255,Ql=pp*Ks;function TC(i,r,o,u,f,m,y,x,E,T,P,O,F,V,G,K,oe){const pe=function(Se,ke,Me,Je,Ze,st,xt,nt){const ft=[];if(ke.positionedLines.length===0)return ft;const dt=Je.layout.get("text-rotate").evaluate(st,{})*Math.PI/180,yt=function(Ft){const lr=Ft[0],It=Ft[1],Zt=lr*It;return Zt>0?[lr,-It]:Zt<0?[-lr,It]:lr===0?[It,lr]:[It,-lr]}(Me);let At=Math.abs(ke.top-ke.bottom);for(const Ft of ke.positionedLines)At-=Ft.lineOffset;const it=ke.positionedLines.length,Rt=At/it;let Vt=ke.top-Me[1];for(let Ft=0;Ft<it;++Ft){const lr=ke.positionedLines[Ft];Vt=P5(ke,Rt,Vt,Ft);for(const It of lr.positionedGlyphs){if(!It.rect)continue;const Zt=It.rect||{};let ur=iC+1,kr=!0,cr=1,er=0;if(It.imageName){const rn=xt[It.imageName];if(!rn)continue;if(rn.sdf){et("SDF images are not supported in formatted text and will be ignored.");continue}kr=!1,cr=rn.pixelRatio,ur=To/cr}const on=(Ze||nt)&&It.vertical,hr=It.metrics.advance*It.scale/2,fr=It.metrics,Xr=It.rect;if(Xr===null)continue;nt&&ke.verticalizable&&(er=It.imageName?hr-It.metrics.width*It.scale/2:0);const en=Ze?[It.x+hr,It.y]:[0,0];let tn=[0,0],Kr=[0,0],mn=!1;Ze||(on?(Kr=[It.x+hr+yt[0],It.y+yt[1]-er],mn=!0):tn=[It.x+hr+Me[0],It.y+Me[1]-er]);const Pn=Xr.w*It.scale/(cr*(It.localGlyph?Ys:1)),Zn=Xr.h*It.scale/(cr*(It.localGlyph?Ys:1));let Yr,oi,Hn,En;if(on){const rn=It.y-Vt,ao=new he(-hr,hr-rn),Kn=-Math.PI/2,Ci=new he(...Kr);Yr=new he(-hr+tn[0],tn[1]),Yr._rotateAround(Kn,ao)._add(Ci),Yr.x+=-rn+hr,Yr.y-=(fr.left-ur)*It.scale;const gi=It.imageName?fr.advance*It.scale:Ai*It.scale,lo=String.fromCharCode(It.glyph);h5(lo)?Yr.x+=(1-ur)*It.scale:f5(lo)?Yr.x+=gi-fr.height*It.scale+(-ur-1)*It.scale:Yr.x+=It.imageName||fr.width+2*ur===Xr.w&&fr.height+2*ur===Xr.h?(gi-Zn)/2:(gi-(fr.height+2*ur)*It.scale)/2,oi=new he(Yr.x,Yr.y-Pn),Hn=new he(Yr.x+Zn,Yr.y),En=new he(Yr.x+Zn,Yr.y-Pn)}else{const rn=(fr.left-ur)*It.scale-hr+tn[0],ao=(-fr.top-ur)*It.scale+tn[1],Kn=rn+Pn,Ci=ao+Zn;Yr=new he(rn,ao),oi=new he(Kn,ao),Hn=new he(rn,Ci),En=new he(Kn,Ci)}if(dt){let rn;rn=Ze?new he(0,0):mn?new he(yt[0],yt[1]):new he(Me[0],Me[1]),Yr._rotateAround(dt,rn),oi._rotateAround(dt,rn),Hn._rotateAround(dt,rn),En._rotateAround(dt,rn)}const Or=new he(0,0),Xn=new he(0,0);ft.push({tl:Yr,tr:oi,bl:Hn,br:En,tex:Zt,writingMode:ke.writingMode,glyphOffset:en,sectionIndex:It.sectionIndex,isSDF:kr,pixelOffsetTL:Or,pixelOffsetBR:Xn,minFontScaleX:0,minFontScaleY:0})}}return ft}(0,u,E,m,y,x,f,i.allowVerticalPlacement),Ae=i.textSizeData;let me=null;Ae.kind==="source"?(me=[Ks*m.layout.get("text-size").evaluate(x,{},oe)],me[0]>Ql&&et(`${i.layerIds[0]}: Value for "text-size" is >= ${pp}. Reduce your "text-size".`)):Ae.kind==="composite"&&(me=[Ks*G.compositeTextSizes[0].evaluate(x,{},oe),Ks*G.compositeTextSizes[1].evaluate(x,{},oe)],(me[0]>Ql||me[1]>Ql)&&et(`${i.layerIds[0]}: Value for "text-size" is >= ${pp}. Reduce your "text-size".`)),i.addSymbols(i.text,pe,me,E,y,x,P,r,o,T.lineStartIndex,T.lineLength,V,K,oe);for(const Se of O)F[Se]=i.text.placedSymbolArray.length-1;return 4*pe.length}function SC(i){for(const r in i)return i[r];return null}function ey(i,r,o,u,f,m,y,x,E,T){let P=y.top,O=y.bottom,F=y.left,V=y.right;const G=y.collisionPadding;if(G&&(F-=G[0],P-=G[1],V+=G[2],O+=G[3]),E){const K=new he(F,P),oe=new he(V,P),pe=new he(F,O),Ae=new he(V,O),me=ie(E);let Se=new he(0,0);T&&(Se=new he(T[0],T[1])),K._rotateAround(me,Se),oe._rotateAround(me,Se),pe._rotateAround(me,Se),Ae._rotateAround(me,Se),F=Math.min(K.x,oe.x,pe.x,Ae.x),V=Math.max(K.x,oe.x,pe.x,Ae.x),P=Math.min(K.y,oe.y,pe.y,Ae.y),O=Math.max(K.y,oe.y,pe.y,Ae.y)}return i.emplaceBack(r.x,r.y,r.z,o.x,o.y,F,P,V,O,x,u,f,m),i.length-1}function yx(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const r=i.bottom-i.top;return r>0?Math.max(10,r):null}function B5(i,r,o,u){const f=i.compareText;if(r in f){const m=f[r];for(let y=m.length-1;y>=0;y--)if(u.dist(m[y])<o)return!0}else f[r]=[];return f[r].push(u),!1}function AC(i,r){const o=i.fovAboveCenter,u=i.elevation?i.elevation.getMinElevationBelowMSL()*r:0,f=(i._camera.position[2]*i.worldSize-u)/Math.cos(i._pitch),m=Math.sin(o)*f/Math.sin(Math.max(Math.PI/2-i._pitch-o,.01)),y=Math.sin(i._pitch)*m+f;return Math.min(1.01*y,f*(1/i._horizonShift))}function wc(i,r){if(!r.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:r};const o=Math.pow(2,-i.z),u=i.x*o,f=(i.x+1)*o,m=i.y*o,y=(i.y+1)*o,x=us(u),E=us(f),T=Fi(m),P=Fi(y),O=r.project(x,T),F=r.project(E,T),V=r.project(E,P),G=r.project(x,P);let K=Math.min(O.x,F.x,V.x,G.x),oe=Math.min(O.y,F.y,V.y,G.y),pe=Math.max(O.x,F.x,V.x,G.x),Ae=Math.max(O.y,F.y,V.y,G.y);const me=o/16;function Se(Me,Je,Ze,st,xt,nt){const ft=(Ze+xt)/2,dt=(st+nt)/2,yt=r.project(us(ft),Fi(dt)),At=Math.max(0,K-yt.x,oe-yt.y,yt.x-pe,yt.y-Ae);K=Math.min(K,yt.x),pe=Math.max(pe,yt.x),oe=Math.min(oe,yt.y),Ae=Math.max(Ae,yt.y),At>me&&(Se(Me,yt,Ze,st,ft,dt),Se(yt,Je,ft,dt,xt,nt))}Se(O,F,u,m,f,m),Se(F,V,f,m,f,y),Se(V,G,f,y,u,y),Se(G,O,u,y,u,m),K-=me,oe-=me,pe+=me,Ae+=me;const ke=1/Math.max(pe-K,Ae-oe);return{scale:ke,x:K*ke,y:oe*ke,x2:pe*ke,y2:Ae*ke,projection:r}}const N5=Zs(new Float32Array(16));class eu{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,o){return{x:0,y:0,z:0}}unproject(r,o){return new Hr(0,0)}projectTilePoint(r,o,u){return{x:r,y:o,z:0}}locationPoint(r,o,u=!0){return r._coordinatePoint(r.locationCoordinate(o),u)}pixelsPerMeter(r,o){return Xs(1,r)*o}pixelSpaceConversion(r,o,u){return 1}farthestPixelDistance(r){return AC(r,r.pixelsPerMeter)}pointCoordinate(r,o,u,f){const m=r.horizonLineFromTop(!1),y=new he(o,Math.max(m,u));return r.rayIntersectionCoordinate(r.pointRayIntersection(y,f))}pointCoordinate3D(r,o,u){const f=new he(o,u);if(r.elevation)return r.elevation.pointCoordinate(f);{const m=this.pointCoordinate(r,f.x,f.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(r,o){if(r.elevation)return!this.pointCoordinate3D(r,o.x,o.y);const u=r.horizonLineFromTop();return o.y<u}createInversionMatrix(r,o){return N5}createTileMatrix(r,o,u){let f,m,y;const x=u.canonical,E=Zs(new Float64Array(16));if(this.isReprojectedInTileSpace){const T=wc(x,this);f=1,m=T.x+u.wrap*T.scale,y=T.y,mc(E,E,[f/T.scale,f/T.scale,r.pixelsPerMeter/o])}else f=o/r.zoomScale(x.z),m=(x.x+Math.pow(2,x.z)*u.wrap)*f,y=x.y*f;return qd(E,E,[m,y,0]),mc(E,E,[f/Xt,f/Xt,1]),E}upVector(r,o,u){return[0,0,1]}upVectorScale(r,o,u){return{metersToTile:1}}}class U5 extends eu{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[o,u]=this.parallels=r.parallels||[29.5,45.5],f=Math.sin(ie(o));this.n=(f+Math.sin(ie(u)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(r,o){const{n:u,c:f,r0:m}=this,y=ie(r-this.center[0]),x=ie(o),E=Math.sqrt(f-2*u*Math.sin(x))/u;return{x:E*Math.sin(y*u),y:E*Math.cos(y*u)-m,z:0}}unproject(r,o){const{n:u,c:f,r0:m}=this,y=m+o;let x=Math.atan2(r,Math.abs(y))*Math.sign(y);y*u<0&&(x-=Math.PI*Math.sign(r)*Math.sign(y));const E=ie(this.center[0])*u;x=Pe(x,-Math.PI-E,Math.PI-E);const T=_e(q(x/u)+this.center[0],-180,180),P=Math.asin(_e((f-(r*r+y*y)*u*u)/(2*u),-1,1)),O=_e(q(P),-Bi,Bi);return new Hr(T,O)}}const mp=1.340264,gp=-.081106,yp=893e-6,_p=.003796,ty=Math.sqrt(3)/2;class $5 extends eu{project(r,o){o=o/180*Math.PI,r=r/180*Math.PI;const u=Math.asin(ty*Math.sin(o)),f=u*u,m=f*f*f;return{x:.5*(r*Math.cos(u)/(ty*(mp+3*gp*f+m*(7*yp+9*_p*f)))/Math.PI+.5),y:1-.5*(u*(mp+gp*f+m*(yp+_p*f))/Math.PI+1),z:0}}unproject(r,o){r=(2*r-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,f=u*u,m=f*f*f;for(let P,O,F,V=0;V<12&&(O=u*(mp+gp*f+m*(yp+_p*f))-o,F=mp+3*gp*f+m*(7*yp+9*_p*f),P=O/F,u=_e(u-P,-Math.PI/3,Math.PI/3),f=u*u,m=f*f*f,!(Math.abs(P)<1e-12));++V);const y=ty*r*(mp+3*gp*f+m*(7*yp+9*_p*f))/Math.cos(u),x=Math.asin(Math.sin(u)/ty),E=_e(180*y/Math.PI,-180,180),T=_e(180*x/Math.PI,-Bi,Bi);return new Hr(E,T)}}class j5 extends eu{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,o){return{x:.5+r/360,y:.5-o/360,z:0}}unproject(r,o){const u=360*(r-.5),f=_e(360*(.5-o),-Bi,Bi);return new Hr(u,f)}}const Wh=Math.PI/2;function ry(i){return Math.tan((Wh+i)/2)}class V5 extends eu{constructor(r){super(r),this.center=r.center||[0,30];const[o,u]=this.parallels=r.parallels||[30,30];let f=ie(o),m=ie(u);this.southernCenter=f+m<0,this.southernCenter&&(f=-f,m=-m);const y=Math.cos(f),x=ry(f);this.n=f===m?Math.sin(f):Math.log(y/Math.cos(m))/Math.log(ry(m)/x),this.f=y*Math.pow(ry(f),this.n)/this.n}project(r,o){o=ie(o),this.southernCenter&&(o=-o),r=ie(r-this.center[0]);const u=1e-6,{n:f,f:m}=this;m>0?o<-Wh+u&&(o=-Wh+u):o>Wh-u&&(o=Wh-u);const y=m/Math.pow(ry(o),f);let x=y*Math.sin(f*r),E=m-y*Math.cos(f*r);return x=.5*(x/Math.PI+.5),E=.5*(E/Math.PI+.5),{x,y:this.southernCenter?E:1-E,z:0}}unproject(r,o){r=(2*r-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:u,f}=this,m=f-o,y=Math.sign(m),x=Math.sign(u)*Math.sqrt(r*r+m*m);let E=Math.atan2(r,Math.abs(m))*y;m*u<0&&(E-=Math.PI*Math.sign(r)*y);const T=_e(q(E/u)+this.center[0],-180,180),P=_e(q(2*Math.atan(Math.pow(f/x,1/u))-Wh),-Bi,Bi);return new Hr(T,this.southernCenter?-P:P)}}class CC extends eu{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,o){return{x:Ta(r),y:Sa(o),z:0}}unproject(r,o){const u=us(r),f=Fi(o);return new Hr(u,f)}}const IC=ie(Bi);class G5 extends eu{project(r,o){const u=(o=ie(o))*o,f=u*u;return{x:.5*((r=ie(r))*(.8707-.131979*u+f*(f*(.003971*u-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+u*(.015085+f*(.028874*u-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(r,o){r=(2*r-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,f=25,m=0,y=u*u;do{y=u*u;const T=y*y;m=(u*(1.007226+y*(.015085+T*(.028874*y-.044475-.005916*T)))-o)/(1.007226+y*(.045255+T*(.259866*y-.311325-.005916*11*T))),u=_e(u-m,-IC,IC)}while(Math.abs(m)>1e-6&&--f>0);y=u*u;const x=_e(q(r/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),E=q(u);return new Hr(x,E)}}const MC=ie(Bi);class q5 extends eu{project(r,o){o=ie(o),r=ie(r);const u=Math.cos(o),f=2/Math.PI,m=Math.acos(u*Math.cos(r/2)),y=Math.sin(m)/m,x=.5*(r*f+2*u*Math.sin(r/2)/y)||0,E=.5*(o+Math.sin(o)/y)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(r,o){let u=r=(2*r-.5)*Math.PI,f=o=(2*(1-o)-1)*Math.PI,m=25;const y=1e-6;let x=0,E=0;do{const T=Math.cos(f),P=Math.sin(f),O=2*P*T,F=P*P,V=T*T,G=Math.cos(u/2),K=Math.sin(u/2),oe=2*G*K,pe=K*K,Ae=1-V*G*G,me=Ae?1/Ae:0,Se=Ae?Math.acos(T*G)*Math.sqrt(1/Ae):0,ke=.5*(2*Se*T*K+2*u/Math.PI)-r,Me=.5*(Se*P+f)-o,Je=.5*me*(V*pe+Se*T*G*F)+1/Math.PI,Ze=me*(oe*O/4-Se*P*K),st=.125*me*(O*K-Se*P*V*oe),xt=.5*me*(F*G+Se*pe*T)+.5,nt=Ze*st-xt*Je;x=(Me*Ze-ke*xt)/nt,E=(ke*st-Me*Je)/nt,u=_e(u-x,-Math.PI,Math.PI),f=_e(f-E,-MC,MC)}while((Math.abs(x)>y||Math.abs(E)>y)&&--m>0);return new Hr(q(u),q(f))}}class PC extends eu{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ie(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,o){const{scale:u,cosPhi:f}=this;return{x:ie(r)*f*u+.5,y:-Math.sin(ie(o))/f*u+.5,z:0}}unproject(r,o){const{scale:u,cosPhi:f}=this,m=-(o-.5)/u,y=_e(q((r-.5)/u)/f,-180,180),x=Math.asin(_e(m*f,-1,1)),E=_e(q(x),-Bi,Bi);return new Hr(y,E)}}class W5 extends CC{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(r,o,u){const f=Qd(r,o,u);return Bn(f,f,ep(Ea(u))),{x:f[0],y:f[1],z:f[2]}}locationPoint(r,o){const u=kh(o.lat,o.lng),f=io([],u),m=r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(o),r._centerAltitude):r._centerAltitude;Xd(u,u,f,Xs(1,0)*Xt*m);const y=Zs(new Float64Array(16));return pc(y,r.pixelMatrix,r.globeMatrix),Bn(u,u,y),new he(u[0],u[1])}pixelsPerMeter(r,o){return Xs(1,0)*o}pixelSpaceConversion(r,o,u){const f=Xs(1,r)*o,m=Cr(Xs(1,45)*o,f,u);return this.pixelsPerMeter(r,o)/m}createTileMatrix(r,o,u){const f=$0(Ea(u.canonical));return pc(new Float64Array(16),r.globeMatrix,f)}createInversionMatrix(r,o){const{center:u}=r,f=ep(Ea(o));return Pg(f,f,ie(u.lng)),k0(f,f,ie(u.lat)),mc(f,f,[r._pixelsPerMercatorPixel,r._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(r,o,u,f){return nA(r,o,u,!0)||new Oh(0,0)}pointCoordinate3D(r,o,u){const f=this.pointCoordinate(r,o,u,0);return[f.x,f.y,f.z]}isPointAboveHorizon(r,o){return!nA(r,o.x,o.y,!1)}farthestPixelDistance(r){const o=function(f,m){const y=f.cameraToCenterDistance,x=f._centerAltitude*m,E=f._camera,T=f._camera.forward(),P=hl([],ls([],T,-y),[0,0,x]),O=f.worldSize/(2*Math.PI),F=[0,0,-O],V=f.width/f.height,G=Math.tan(f.fovAboveCenter),K=ls([],E.up(),G),oe=ls([],E.right(),G*V),pe=io([],hl([],hl([],T,K),oe)),Ae=[];let me;if(new R0(P,pe).closestPointOnSphere(F,O,Ae)){const Se=hl([],Ae,F),ke=Hs([],Se,P);me=Math.cos(f.fovAboveCenter)*Wd(ke)}else{const Se=Hs([],P,F),ke=Hs([],F,P);io(ke,ke);const Me=Wd(Se)-O;me=Math.sqrt(Me*(Me+2*O));const Je=Math.acos(me/(O+Me))-Math.acos(Es(T,ke));me*=Math.cos(Je)}return 1.01*me}(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),u=Lh(r.zoom);if(u>0){const f=AC(r,Xs(1,r.center.lat)*r.worldSize),m=r.worldSize/(2*Math.PI),y=Math.max(r.width,r.height)/r.worldSize*Math.PI;return Cr(o,f+m*(1-Math.cos(y)),Math.pow(u,10))}return o}upVector(r,o,u){return Qd(o,u,r,1)}upVectorScale(r){return{metersToTile:kg(Og(Ea(r)))}}}function kC(i){const r=i.parallels,o=!!r&&Math.abs(r[0]+r[1])<.01;switch(i.name){case"mercator":return new CC(i);case"equirectangular":return new j5(i);case"naturalEarth":return new G5(i);case"equalEarth":return new $5(i);case"winkelTripel":return new q5(i);case"albers":return o?new PC(i):new U5(i);case"lambertConformalConic":return o?new PC(i):new V5(i);case"globe":return new W5(i)}throw new Error(`Invalid projection name: ${i.name}`)}const Z5=Vg.types,H5=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ny(i,r,o,u,f,m,y,x,E,T,P,O,F){const V=x?Math.min(Ql,Math.round(x[0])):0,G=x?Math.min(Ql,Math.round(x[1])):0;i.emplaceBack(r,o,Math.round(32*u),Math.round(32*f),m,y,(V<<1)+(E?1:0),G,16*T,16*P,256*O,256*F)}function iy(i,r,o,u,f,m,y){i.emplaceBack(r,o,u,f,m,y)}function oy(i,r,o,u,f){i.emplaceBack(r,o,u,f),i.emplaceBack(r,o,u,f),i.emplaceBack(r,o,u,f),i.emplaceBack(r,o,u,f)}function X5(i){for(const r of i.sections)if(A0(r.text))return!0;return!1}class _x{constructor(r){this.layoutVertexArray=new pt,this.indexArray=new qt,this.programConfigurations=r,this.segments=new qn,this.dynamicLayoutVertexArray=new _t,this.opacityVertexArray=new Wt,this.placedSymbolArray=new Gn,this.globeExtVertexArray=new Tt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,o,u,f){this.isEmpty()||(u&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,n5.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,o5.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,H5,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,i5.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||f)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Ut(_x,"SymbolBuffers");class vx{constructor(r,o,u){this.layoutVertexArray=new r,this.layoutAttributes=o,this.indexArray=new u,this.segments=new qn,this.collisionVertexArray=new vr,this.collisionVertexArrayExt=new yr}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,s5.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,a5.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ut(vx,"CollisionBuffers");class tu{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(y=>y.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Zs([]),this.placementViewportMatrix=Zs([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ax(this.zoom,o["text-size"]),this.iconSizeData=ax(this.zoom,o["icon-size"]);const u=this.layers[0].layout,f=u.get("symbol-sort-key"),m=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(y=>cs[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=r.sourceID,this.projection=r.projection}createArrays(){this.text=new _x(new dc(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new _x(new dc(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new no,this.lineVertexArray=new Ah,this.symbolInstances=new ln}calculateGlyphDependencies(r,o,u,f,m){for(let y=0;y<r.length;y++)if(o[r.charCodeAt(y)]=!0,f&&m){const x=hp[r.charAt(y)];x&&(o[x.charCodeAt(0)]=!0)}}populate(r,o,u,f){const m=this.layers[0],y=m.layout,x=this.projection.name==="globe",E=y.get("text-font"),T=y.get("text-field"),P=y.get("icon-image"),O=(T.value.kind!=="constant"||T.value.value instanceof Ti&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),F=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,V=y.get("symbol-sort-key");if(this.features=[],!O&&!F)return;const G=o.iconDependencies,K=o.glyphDependencies,oe=o.availableImages,pe=new L(this.zoom);for(const{feature:Ae,id:me,index:Se,sourceLayerIndex:ke}of r){const Me=m._featureFilter.needGeometry,Je=vc(Ae,Me);if(!m._featureFilter.filter(pe,Je,u))continue;if(Me||(Je.geometry=fl(Ae,u,f)),x&&Ae.type!==1&&u.z<=5){const nt=Je.geometry,ft=.98078528056,dt=(yt,At)=>Es(Qd(yt.x,yt.y,u,1),Qd(At.x,At.y,u,1))<ft;for(let yt=0;yt<nt.length;yt++)nt[yt]=o4(nt[yt],dt)}let Ze,st;if(O){const nt=m.getValueAndResolveTokens("text-field",Je,u,oe),ft=Ti.factory(nt);X5(ft)&&(this.hasRTLText=!0),(!this.hasRTLText||b()==="unavailable"||this.hasRTLText&&C.isParsed())&&(Ze=c5(ft,m,Je))}if(F){const nt=m.getValueAndResolveTokens("icon-image",Je,u,oe);st=nt instanceof Xi?nt:Xi.fromString(nt)}if(!Ze&&!st)continue;const xt=this.sortFeaturesByKey?V.evaluate(Je,{},u):void 0;if(this.features.push({id:me,text:Ze,icon:st,index:Se,sourceLayerIndex:ke,geometry:Je.geometry,properties:Ae.properties,type:Z5[Ae.type],sortKey:xt}),st&&(G[st.name]=!0),Ze){const nt=E.evaluate(Je,{},u).join(","),ft=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(cs.vertical)>=0;for(const dt of Ze.sections)if(dt.image)G[dt.image.name]=!0;else{const yt=Bd(Ze.toString()),At=dt.fontStack||nt,it=K[At]=K[At]||{};this.calculateGlyphDependencies(dt.text,it,ft,this.allowVerticalPlacement,yt)}}}y.get("symbol-placement")==="line"&&(this.features=function(Ae){const me={},Se={},ke=[];let Me=0;function Je(nt){ke.push(Ae[nt]),Me++}function Ze(nt,ft,dt){const yt=Se[nt];return delete Se[nt],Se[ft]=yt,ke[yt].geometry[0].pop(),ke[yt].geometry[0]=ke[yt].geometry[0].concat(dt[0]),yt}function st(nt,ft,dt){const yt=me[ft];return delete me[ft],me[nt]=yt,ke[yt].geometry[0].shift(),ke[yt].geometry[0]=dt[0].concat(ke[yt].geometry[0]),yt}function xt(nt,ft,dt){const yt=dt?ft[0][ft[0].length-1]:ft[0][0];return`${nt}:${yt.x}:${yt.y}`}for(let nt=0;nt<Ae.length;nt++){const ft=Ae[nt],dt=ft.geometry,yt=ft.text?ft.text.toString():null;if(!yt){Je(nt);continue}const At=xt(yt,dt),it=xt(yt,dt,!0);if(At in Se&&it in me&&Se[At]!==me[it]){const Rt=st(At,it,dt),Vt=Ze(At,it,ke[Rt].geometry);delete me[At],delete Se[it],Se[xt(yt,ke[Vt].geometry,!0)]=Vt,ke[Rt].geometry=null}else At in Se?Ze(At,it,dt):it in me?st(At,it,dt):(Je(nt),me[At]=Me-1,Se[it]=Me-1)}return ke.filter(nt=>nt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ae,me)=>Ae.sortKey-me.sortKey)}update(r,o,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,o,this.layers,u,f),this.icon.programConfigurations.updatePaintArrays(r,o,this.layers,u,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=kC(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,o){const u=this.lineVertexArray.length;if(r.segment!==void 0)for(const{x:f,y:m}of o)this.lineVertexArray.emplaceBack(f,m);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(r,o,u,f,m,y,x,E,T,P,O,F,V,G){const K=r.indexArray,oe=r.layoutVertexArray,pe=r.globeExtVertexArray,Ae=r.segments.prepareSegment(4*o.length,oe,K,this.canOverlap?y.sortKey:void 0),me=this.glyphOffsetArray.length,Se=Ae.vertexLength,ke=this.allowVerticalPlacement&&x===cs.vertical?Math.PI/2:0,Me=y.text&&y.text.sections;for(let Ze=0;Ze<o.length;Ze++){const{tl:st,tr:xt,bl:nt,br:ft,tex:dt,pixelOffsetTL:yt,pixelOffsetBR:At,minFontScaleX:it,minFontScaleY:Rt,glyphOffset:Vt,isSDF:Ft,sectionIndex:lr}=o[Ze],It=Ae.vertexLength,Zt=Vt[1];if(ny(oe,T.x,T.y,st.x,Zt+st.y,dt.x,dt.y,u,Ft,yt.x,yt.y,it,Rt),ny(oe,T.x,T.y,xt.x,Zt+xt.y,dt.x+dt.w,dt.y,u,Ft,At.x,yt.y,it,Rt),ny(oe,T.x,T.y,nt.x,Zt+nt.y,dt.x,dt.y+dt.h,u,Ft,yt.x,At.y,it,Rt),ny(oe,T.x,T.y,ft.x,Zt+ft.y,dt.x+dt.w,dt.y+dt.h,u,Ft,At.x,At.y,it,Rt),E){const{x:ur,y:kr,z:cr}=E.anchor,[er,on,hr]=E.up;iy(pe,ur,kr,cr,er,on,hr),iy(pe,ur,kr,cr,er,on,hr),iy(pe,ur,kr,cr,er,on,hr),iy(pe,ur,kr,cr,er,on,hr),oy(r.dynamicLayoutVertexArray,ur,kr,cr,ke)}else oy(r.dynamicLayoutVertexArray,T.x,T.y,T.z,ke);K.emplaceBack(It,It+1,It+2),K.emplaceBack(It+1,It+2,It+3),Ae.vertexLength+=4,Ae.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Vt[0]),Ze!==o.length-1&&lr===o[Ze+1].sectionIndex||r.programConfigurations.populatePaintArrays(oe.length,y,y.index,{},V,G,Me&&Me[lr])}const Je=E?E.anchor:T;r.placedSymbolArray.emplaceBack(Je.x,Je.y,Je.z,T.x,T.y,me,this.glyphOffsetArray.length-me,Se,P,O,T.segment,u?u[0]:0,u?u[1]:0,f[0],f[1],x,0,!1,0,F,0)}_commitLayoutVertex(r,o,u,f,m,y,x){r.emplaceBack(o,u,f,m,y,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(r,o,u,f,m,y,x){const E=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),T=E.vertexLength,P=x.tileAnchorX,O=x.tileAnchorY;for(let V=0;V<4;V++)u.collisionVertexArray.emplaceBack(0,0,0,0);u.collisionVertexArrayExt.emplaceBack(o,-r.padding,-r.padding),u.collisionVertexArrayExt.emplaceBack(o,r.padding,-r.padding),u.collisionVertexArrayExt.emplaceBack(o,r.padding,r.padding),u.collisionVertexArrayExt.emplaceBack(o,-r.padding,r.padding),this._commitLayoutVertex(u.layoutVertexArray,f,m,y,P,O,new he(r.x1,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,m,y,P,O,new he(r.x2,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,m,y,P,O,new he(r.x2,r.y2)),this._commitLayoutVertex(u.layoutVertexArray,f,m,y,P,O,new he(r.x1,r.y2)),E.vertexLength+=4;const F=u.indexArray;F.emplaceBack(T,T+1),F.emplaceBack(T+1,T+2),F.emplaceBack(T+2,T+3),F.emplaceBack(T+3,T),E.primitiveLength+=4}_addTextDebugCollisionBoxes(r,o,u,f,m,y){for(let x=f;x<m;x++){const E=u.get(x),T=this.getSymbolInstanceTextSize(r,y,o,x);this._addCollisionDebugVertices(E,T,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(r,o,u,f,m,y){for(let x=f;x<m;x++){const E=u.get(x),T=this.getSymbolInstanceIconSize(r,o,y.placedIconSymbolIndex);this._addCollisionDebugVertices(E,T,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,y)}}generateCollisionDebugBuffers(r,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vx(jt,KA.members,mi),this.iconCollisionBox=new vx(jt,KA.members,mi);const u=Bh(this.iconSizeData,r),f=Bh(this.textSizeData,r);for(let m=0;m<this.symbolInstances.length;m++){const y=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(f,r,o,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(f,r,o,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,r,o,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,r,o,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(r,o,u,f){const m=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:f),y=Zg(this.textSizeData,r,m)/Ai;return this.tilePixelRatio*y}getSymbolInstanceIconSize(r,o,u){const f=this.icon.placedSymbolArray.get(u),m=Zg(this.iconSizeData,r,f);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(r,o,u){r.emplaceBack(o,-u,-u),r.emplaceBack(o,u,-u),r.emplaceBack(o,u,u),r.emplaceBack(o,-u,u)}_updateTextDebugCollisionBoxes(r,o,u,f,m,y){for(let x=f;x<m;x++){const E=u.get(x),T=this.getSymbolInstanceTextSize(r,y,o,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,T,E.padding)}}_updateIconDebugCollisionBoxes(r,o,u,f,m,y){for(let x=f;x<m;x++){const E=u.get(x),T=this.getSymbolInstanceIconSize(r,o,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,T,E.padding)}}updateCollisionDebugBuffers(r,o){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=Bh(this.iconSizeData,r),f=Bh(this.textSizeData,r);for(let m=0;m<this.symbolInstances.length;m++){const y=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(f,r,o,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(f,r,o,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(u,r,o,y.iconBoxStartIndex,y.iconBoxEndIndex,y.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(u,r,o,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,o,u,f,m,y,x,E,T){const P={};if(o<u){const{x1:O,y1:F,x2:V,y2:G,padding:K,projectedAnchorX:oe,projectedAnchorY:pe,projectedAnchorZ:Ae,tileAnchorX:me,tileAnchorY:Se,featureIndex:ke}=r.get(o);P.textBox={x1:O,y1:F,x2:V,y2:G,padding:K,projectedAnchorX:oe,projectedAnchorY:pe,projectedAnchorZ:Ae,tileAnchorX:me,tileAnchorY:Se},P.textFeatureIndex=ke}if(f<m){const{x1:O,y1:F,x2:V,y2:G,padding:K,projectedAnchorX:oe,projectedAnchorY:pe,projectedAnchorZ:Ae,tileAnchorX:me,tileAnchorY:Se,featureIndex:ke}=r.get(f);P.verticalTextBox={x1:O,y1:F,x2:V,y2:G,padding:K,projectedAnchorX:oe,projectedAnchorY:pe,projectedAnchorZ:Ae,tileAnchorX:me,tileAnchorY:Se},P.verticalTextFeatureIndex=ke}if(y<x){const{x1:O,y1:F,x2:V,y2:G,padding:K,projectedAnchorX:oe,projectedAnchorY:pe,projectedAnchorZ:Ae,tileAnchorX:me,tileAnchorY:Se,featureIndex:ke}=r.get(y);P.iconBox={x1:O,y1:F,x2:V,y2:G,padding:K,projectedAnchorX:oe,projectedAnchorY:pe,projectedAnchorZ:Ae,tileAnchorX:me,tileAnchorY:Se},P.iconFeatureIndex=ke}if(E<T){const{x1:O,y1:F,x2:V,y2:G,padding:K,projectedAnchorX:oe,projectedAnchorY:pe,projectedAnchorZ:Ae,tileAnchorX:me,tileAnchorY:Se,featureIndex:ke}=r.get(E);P.verticalIconBox={x1:O,y1:F,x2:V,y2:G,padding:K,projectedAnchorX:oe,projectedAnchorY:pe,projectedAnchorZ:Ae,tileAnchorX:me,tileAnchorY:Se},P.verticalIconFeatureIndex=ke}return P}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,o){const u=r.placedSymbolArray.get(o),f=u.vertexStartIndex+4*u.numGlyphs;for(let m=u.vertexStartIndex;m<f;m+=4)r.indexArray.emplaceBack(m,m+1,m+2),r.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(r),u=Math.cos(r),f=[],m=[],y=[];for(let x=0;x<this.symbolInstances.length;++x){y.push(x);const E=this.symbolInstances.get(x);f.push(0|Math.round(o*E.tileAnchorX+u*E.tileAnchorY)),m.push(E.featureIndex)}return y.sort((x,E)=>f[x]-f[E]||m[E]-m[x]),y}addToSortKeyRanges(r,o){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const u=this.symbolInstances.get(o);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:T}=u;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),m>=0&&m!==f&&this.addIndicesForPlacedSymbol(this.text,m),y>=0&&y!==m&&y!==f&&this.addIndicesForPlacedSymbol(this.text,y),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ut(tu,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),tu.MAX_GLYPHS=65535,tu.addDynamicAttributes=oy;const K5=new be({"symbol-placement":new X(ot.layout_symbol["symbol-placement"]),"symbol-spacing":new X(ot.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new X(ot.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ae(ot.layout_symbol["symbol-sort-key"]),"symbol-z-order":new X(ot.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new X(ot.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new X(ot.layout_symbol["icon-ignore-placement"]),"icon-optional":new X(ot.layout_symbol["icon-optional"]),"icon-rotation-alignment":new X(ot.layout_symbol["icon-rotation-alignment"]),"icon-size":new ae(ot.layout_symbol["icon-size"]),"icon-text-fit":new X(ot.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new X(ot.layout_symbol["icon-text-fit-padding"]),"icon-image":new ae(ot.layout_symbol["icon-image"]),"icon-rotate":new ae(ot.layout_symbol["icon-rotate"]),"icon-padding":new X(ot.layout_symbol["icon-padding"]),"icon-keep-upright":new X(ot.layout_symbol["icon-keep-upright"]),"icon-offset":new ae(ot.layout_symbol["icon-offset"]),"icon-anchor":new ae(ot.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new X(ot.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new X(ot.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new X(ot.layout_symbol["text-rotation-alignment"]),"text-field":new ae(ot.layout_symbol["text-field"]),"text-font":new ae(ot.layout_symbol["text-font"]),"text-size":new ae(ot.layout_symbol["text-size"]),"text-max-width":new ae(ot.layout_symbol["text-max-width"]),"text-line-height":new ae(ot.layout_symbol["text-line-height"]),"text-letter-spacing":new ae(ot.layout_symbol["text-letter-spacing"]),"text-justify":new ae(ot.layout_symbol["text-justify"]),"text-radial-offset":new ae(ot.layout_symbol["text-radial-offset"]),"text-variable-anchor":new X(ot.layout_symbol["text-variable-anchor"]),"text-anchor":new ae(ot.layout_symbol["text-anchor"]),"text-max-angle":new X(ot.layout_symbol["text-max-angle"]),"text-writing-mode":new X(ot.layout_symbol["text-writing-mode"]),"text-rotate":new ae(ot.layout_symbol["text-rotate"]),"text-padding":new X(ot.layout_symbol["text-padding"]),"text-keep-upright":new X(ot.layout_symbol["text-keep-upright"]),"text-transform":new ae(ot.layout_symbol["text-transform"]),"text-offset":new ae(ot.layout_symbol["text-offset"]),"text-allow-overlap":new X(ot.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new X(ot.layout_symbol["text-ignore-placement"]),"text-optional":new X(ot.layout_symbol["text-optional"])});var xx={paint:new be({"icon-opacity":new ae(ot.paint_symbol["icon-opacity"]),"icon-color":new ae(ot.paint_symbol["icon-color"]),"icon-halo-color":new ae(ot.paint_symbol["icon-halo-color"]),"icon-halo-width":new ae(ot.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ae(ot.paint_symbol["icon-halo-blur"]),"icon-translate":new X(ot.paint_symbol["icon-translate"]),"icon-translate-anchor":new X(ot.paint_symbol["icon-translate-anchor"]),"text-opacity":new ae(ot.paint_symbol["text-opacity"]),"text-color":new ae(ot.paint_symbol["text-color"],{runtimeType:Zi,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new ae(ot.paint_symbol["text-halo-color"]),"text-halo-width":new ae(ot.paint_symbol["text-halo-width"]),"text-halo-blur":new ae(ot.paint_symbol["text-halo-blur"]),"text-translate":new X(ot.paint_symbol["text-translate"]),"text-translate-anchor":new X(ot.paint_symbol["text-translate-anchor"])}),layout:K5};class LC{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:Bs,this.defaultValue=r}evaluate(r){if(r.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(r.formattedSection))return o.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ut(LC,"FormatSectionOverride",{omit:["defaultValue"]});class sy extends Ws{constructor(r){super(r,xx)}recalculate(r,o){super.recalculate(r,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const f=[];for(const m of u)f.indexOf(m)<0&&f.push(m);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,o,u,f){const m=this.layout.get(r).evaluate(o,{},u,f),y=this._unevaluatedLayout._values[r];return y.isDataDriven()||Vl(y.value)||!m?m:function(x,E){return E.replace(/{([^{}]+)}/g,(T,P)=>P in x?String(x[P]):"")}(o.properties,m)}createBucket(r){return new tu(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of xx.paint.overridableProperties){if(!sy.hasPaintOverride(this.layout,r))continue;const o=this.paint.get(r),u=new LC(o),f=new _h(u,o.property.specification);let m=null;m=o.value.kind==="constant"||o.value.kind==="source"?new Cd("source",f):new ic("composite",f,o.value.zoomStops,o.value._interpolationType),this.paint._values[r]=new ce(o.property,m,o.parameters)}}_handleOverridablePaintPropertyUpdate(r,o,u){return!(!this.layout||o.isDataDriven()||u.isDataDriven())&&sy.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,o){const u=r.get("text-field"),f=xx.paint.properties[o];let m=!1;const y=x=>{for(const E of x)if(f.overrides&&f.overrides.hasOverride(E))return void(m=!0)};if(u.value.kind==="constant"&&u.value.value instanceof Ti)y(u.value.value.sections);else if(u.value.kind==="source"){const x=T=>{m||(T instanceof Ns&&hn(T.value)===ya?y(T.value.sections):T instanceof Fr?y(T.sections):T.eachChild(x))},E=u.value;E._styleExpression&&x(E._styleExpression.expression)}return m}getProgramConfiguration(r){return new Kl(this,r)}}var Y5={paint:new be({"background-color":new X(ot.paint_background["background-color"]),"background-pattern":new X(ot.paint_background["background-pattern"]),"background-opacity":new X(ot.paint_background["background-opacity"])})},J5={paint:new be({"raster-opacity":new X(ot.paint_raster["raster-opacity"]),"raster-hue-rotate":new X(ot.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new X(ot.paint_raster["raster-brightness-min"]),"raster-brightness-max":new X(ot.paint_raster["raster-brightness-max"]),"raster-saturation":new X(ot.paint_raster["raster-saturation"]),"raster-contrast":new X(ot.paint_raster["raster-contrast"]),"raster-resampling":new X(ot.paint_raster["raster-resampling"]),"raster-fade-duration":new X(ot.paint_raster["raster-fade-duration"])})};class Q5 extends Ws{constructor(r){super(r,{}),this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var eN={paint:new be({"sky-type":new X(ot.paint_sky["sky-type"]),"sky-atmosphere-sun":new X(ot.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new X(ot.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new X(ot.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new X(ot.paint_sky["sky-gradient-radius"]),"sky-gradient":new ge(ot.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new X(ot.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new X(ot.paint_sky["sky-atmosphere-color"]),"sky-opacity":new X(ot.paint_sky["sky-opacity"])})};function bx(i,r,o){const u=[0,0,1],f=YS([]);return QS(f,f,o?-ie(i)+Math.PI:ie(i)),JS(f,f,-ie(r)),ZS(u,u,f),io(u,u)}const tN={circle:class extends Ws{constructor(i){super(i,f4)}createBucket(i){return new Z0(i)}queryRadius(i){const r=i;return Dh("circle-radius",this,r)+Dh("circle-stroke-width",this,r)+zg(this.paint.get("circle-translate"))}queryIntersectsFeature(i,r,o,u,f,m,y,x){const E=bA(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,i.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(r,o)+this.paint.get("circle-stroke-width").evaluate(r,o);return wA(i,u,m,y,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",E,T)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new Kl(this,i)}},heatmap:class extends Ws{createBucket(i){return new TA(i)}constructor(i){super(i,g4),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Y0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return Dh("heatmap-radius",this,i)}queryIntersectsFeature(i,r,o,u,f,m,y,x){const E=this.paint.get("heatmap-radius").evaluate(r,o);return wA(i,u,m,y,x,!0,!0,new he(0,0),E)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new Kl(this,i)}},hillshade:class extends Ws{constructor(i){super(i,y4)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Ws{constructor(i){super(i,O4)}getProgramIds(){const i=this.paint.get("fill-pattern"),r=i&&i.constantOr(1),o=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getProgramConfiguration(i){return new Kl(this,i)}recalculate(i,r){super.recalculate(i,r);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new $g(i)}queryRadius(){return zg(this.paint.get("fill-translate"))}queryIntersectsFeature(i,r,o,u,f,m){return!i.queryGeometry.isAboveHorizon&&gA(xA(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,i.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends Ws{constructor(i){super(i,X4)}createBucket(i){return new lp(i)}queryRadius(){return zg(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new Kl(this,i)}queryIntersectsFeature(i,r,o,u,f,m,y,x,E){const T=bA(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,i.pixelToTileUnitsFactor),P=this.paint.get("fill-extrusion-height").evaluate(r,o),O=this.paint.get("fill-extrusion-base").evaluate(r,o),F=[0,0],V=x&&m.elevation,G=m.elevation?m.elevation.exaggeration():1,K=i.tile.getBucket(this);if(V&&K instanceof lp){const Se=K.centroidVertexArray,ke=E+1;ke<Se.length&&(F[0]=Se.geta_centroid_pos0(ke),F[1]=Se.geta_centroid_pos1(ke))}if(F[0]===0&&F[1]===1)return!1;m.projection.name==="globe"&&(u=jA([u],[new he(0,0),new he(Xt,Xt)],i.tileID.canonical).map(Se=>Se.polygon).flat());const oe=V?x:null,[pe,Ae]=function(Se,ke,Me,Je,Ze,st,xt,nt,ft,dt,yt){return Se.projection.name==="globe"?function(At,it,Rt,Vt,Ft,lr,It,Zt,ur,kr,cr){const er=[],on=[],hr=At.projection.upVectorScale(cr,At.center.lat,At.worldSize).metersToTile,fr=[0,0,0,1],Xr=[0,0,0,1],en=(Kr,mn,Pn,Zn)=>{Kr[0]=mn,Kr[1]=Pn,Kr[2]=Zn,Kr[3]=1},tn=$A();Rt>0&&(Rt+=tn),Vt+=tn;for(const Kr of it){const mn=[],Pn=[];for(const Zn of Kr){const Yr=Zn.x+Ft.x,oi=Zn.y+Ft.y,Hn=At.projection.projectTilePoint(Yr,oi,cr),En=At.projection.upVector(cr,Zn.x,Zn.y);let Or=Rt,Xn=Vt;if(It){const rn=WA(Yr,oi,Rt,Vt,It,Zt,ur,kr);Or+=rn.base,Xn+=rn.top}Rt!==0?en(fr,Hn.x+En[0]*hr*Or,Hn.y+En[1]*hr*Or,Hn.z+En[2]*hr*Or):en(fr,Hn.x,Hn.y,Hn.z),en(Xr,Hn.x+En[0]*hr*Xn,Hn.y+En[1]*hr*Xn,Hn.z+En[2]*hr*Xn),Bn(fr,fr,lr),Bn(Xr,Xr,lr),mn.push(new Fh(fr[0],fr[1],fr[2])),Pn.push(new Fh(Xr[0],Xr[1],Xr[2]))}er.push(mn),on.push(Pn)}return[er,on]}(Se,ke,Me,Je,Ze,st,xt,nt,ft,dt,yt):xt?function(At,it,Rt,Vt,Ft,lr,It,Zt,ur){const kr=[],cr=[],er=[0,0,0,1];for(const on of At){const hr=[],fr=[];for(const Xr of on){const en=Xr.x+Vt.x,tn=Xr.y+Vt.y,Kr=WA(en,tn,it,Rt,lr,It,Zt,ur);er[0]=en,er[1]=tn,er[2]=Kr.base,er[3]=1,gc(er,er,Ft),er[3]=Math.max(er[3],1e-5);const mn=new Fh(er[0]/er[3],er[1]/er[3],er[2]/er[3]);er[0]=en,er[1]=tn,er[2]=Kr.top,er[3]=1,gc(er,er,Ft),er[3]=Math.max(er[3],1e-5);const Pn=new Fh(er[0]/er[3],er[1]/er[3],er[2]/er[3]);hr.push(mn),fr.push(Pn)}kr.push(hr),cr.push(fr)}return[kr,cr]}(ke,Me,Je,Ze,st,xt,nt,ft,dt):function(At,it,Rt,Vt,Ft){const lr=[],It=[],Zt=Ft[8]*it,ur=Ft[9]*it,kr=Ft[10]*it,cr=Ft[11]*it,er=Ft[8]*Rt,on=Ft[9]*Rt,hr=Ft[10]*Rt,fr=Ft[11]*Rt;for(const Xr of At){const en=[],tn=[];for(const Kr of Xr){const mn=Kr.x+Vt.x,Pn=Kr.y+Vt.y,Zn=Ft[0]*mn+Ft[4]*Pn+Ft[12],Yr=Ft[1]*mn+Ft[5]*Pn+Ft[13],oi=Ft[2]*mn+Ft[6]*Pn+Ft[14],Hn=Ft[3]*mn+Ft[7]*Pn+Ft[15],En=Zn+Zt,Or=Yr+ur,Xn=oi+kr,rn=Math.max(Hn+cr,1e-5),ao=Zn+er,Kn=Yr+on,Ci=oi+hr,gi=Math.max(Hn+fr,1e-5);en.push(new Fh(En/rn,Or/rn,Xn/rn)),tn.push(new Fh(ao/gi,Kn/gi,Ci/gi))}lr.push(en),It.push(tn)}return[lr,It]}(ke,Me,Je,Ze,st)}(m,u,O,P,T,y,oe,F,G,m.center.lat,i.tileID.canonical),me=i.queryGeometry;return function(Se,ke,Me){let Je=1/0;gA(Me,ke)&&(Je=qA(Me,ke[0]));for(let Ze=0;Ze<ke.length;Ze++){const st=ke[Ze],xt=Se[Ze];for(let nt=0;nt<st.length-1;nt++){const ft=st[nt],dt=[ft,st[nt+1],xt[nt+1],xt[nt],ft];mA(Me,dt)&&(Je=Math.min(Je,qA(Me,dt)))}}return Je!==1/0&&Je}(pe,Ae,me.isPointQuery()?me.screenBounds:me.screenGeometry)}},line:class extends Ws{constructor(i){super(i,ZA),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof pd,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(i,r){super.recalculate(i,r),this.paint._values["line-floorwidth"]=HA.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Wg(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new Kl(this,i)}queryRadius(i){const r=i,o=XA(Dh("line-width",this,r),Dh("line-gap-width",this,r)),u=Dh("line-offset",this,r);return o/2+Math.abs(u)+zg(this.paint.get("line-translate"))}queryIntersectsFeature(i,r,o,u,f,m){if(i.queryGeometry.isAboveHorizon)return!1;const y=xA(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,i.pixelToTileUnitsFactor),x=i.pixelToTileUnitsFactor/2*XA(this.paint.get("line-width").evaluate(r,o),this.paint.get("line-gap-width").evaluate(r,o)),E=this.paint.get("line-offset").evaluate(r,o);return E&&(u=function(T,P){const O=[],F=new he(0,0);for(let V=0;V<T.length;V++){const G=T[V],K=[];for(let oe=0;oe<G.length;oe++){const pe=G[oe],Ae=G[oe+1],me=oe===0?F:pe.sub(G[oe-1])._unit()._perp(),Se=oe===G.length-1?F:Ae.sub(pe)._unit()._perp(),ke=me._add(Se)._unit();ke._mult(1/(ke.x*Se.x+ke.y*Se.y)),K.push(ke._mult(P)._add(pe))}O.push(K)}return O}(u,E*i.pixelToTileUnitsFactor)),function(T,P,O){for(let F=0;F<P.length;F++){const V=P[F];if(T.length>=3){for(let G=0;G<V.length;G++)if(xc(T,V[G]))return!0}if(l4(T,V,O))return!0}return!1}(y,u,x)}isTileClipped(){return!0}},symbol:sy,background:class extends Ws{constructor(i){super(i,Y5)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ws{constructor(i){super(i,J5)}getProgramIds(){return["raster"]}},sky:class extends Ws{constructor(i){super(i,eN),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Y0({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(i,r){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),f=!u,m=i.style.light,y=m.properties.get("position");return f&&m.properties.get("anchor")==="viewport"&&et("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?bx(y.azimuthal,90-y.polar,r):bx(u[0],90-u[1],r)}const o=this.paint.get("sky-gradient-center");return bx(o[0],90-o[1],r)}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}}};class vp{constructor(r,o,u,f){this.context=r,this.format=u,this.texture=r.gl.createTexture(),this.update(o,f)}update(r,o,u){const{width:f,height:m}=r,{context:y}=this,{gl:x}=y,{HTMLImageElement:E,HTMLCanvasElement:T,HTMLVideoElement:P,ImageData:O,ImageBitmap:F}=S;if(x.bindTexture(x.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!o||o.premultiply!==!1)),u||this.size&&this.size[0]===f&&this.size[1]===m){const{x:V,y:G}=u||{x:0,y:0};r instanceof E||r instanceof T||r instanceof P||r instanceof O||F&&r instanceof F?x.texSubImage2D(x.TEXTURE_2D,0,V,G,x.RGBA,x.UNSIGNED_BYTE,r):x.texSubImage2D(x.TEXTURE_2D,0,V,G,f,m,x.RGBA,x.UNSIGNED_BYTE,r.data)}else this.size=[f,m],r instanceof E||r instanceof T||r instanceof P||r instanceof O||F&&r instanceof F?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,r):x.texImage2D(x.TEXTURE_2D,0,this.format,f,m,0,this.format,x.UNSIGNED_BYTE,r.data);this.useMipmap=!!(o&&o.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(r,o){const{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),r!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,r),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?r===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_NEAREST:r),this.filter=r),o!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,o),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class rN{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class nN{constructor(){this.tasks={},this.taskQueue=[],Ir(["process"],this),this.invoker=new rN(this.process),this.nextId=0}add(r,o){const u=this.nextId++,f=function({type:m,isSymbolTile:y,zoom:x}){return x=x||0,m==="message"?0:m!=="maybePrepare"||y?m!=="parseTile"||y?m==="parseTile"&&y?300-x:m==="maybePrepare"&&y?400-x:500:200-x:100-x}(o);if(f===0){$e();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[u]={fn:r,metadata:o,priority:f,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){$e();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const r=this.pick();if(r===null)return;const o=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let r=null,o=1/0;for(let f=0;f<this.taskQueue.length;f++){const m=this.tasks[this.taskQueue[f]];m.priority<o&&(o=m.priority,r=f)}if(r===null)return null;const u=this.taskQueue[r];return this.taskQueue.splice(r,1),u}remove(){this.invoker.remove()}}class OC{constructor(r){this._stringToNumber={},this._numberToString=[];for(let o=0;o<r.length;o++){const u=r[o];this._stringToNumber[u]=o,this._numberToString[o]=u}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const iN=["tile","layer","source","sourceLayer","state"];class DC{constructor(r,o,u,f,m){this.type="Feature",this._vectorTileFeature=r,this._z=o,this._x=u,this._y=f,this.properties=r.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(r.id=this.id);for(const o of iN)this[o]!==void 0&&(r[o]=this[o]);return r}}const As=32,Aa=33,ru=new Uint16Array(8184);for(let i=0;i<2046;i++){let r=i+2,o=0,u=0,f=0,m=0,y=0,x=0;for(1&r?f=m=y=As:o=u=x=As;(r>>=1)>1;){const T=o+f>>1,P=u+m>>1;1&r?(f=o,m=u,o=y,u=x):(o=f,u=m,f=y,m=x),y=T,x=P}const E=4*i;ru[E+0]=o,ru[E+1]=u,ru[E+2]=f,ru[E+3]=m}const Ca=new Uint16Array(2178),nu=new Uint8Array(1089),ay=new Uint16Array(1089);function RC(i){return i===0?-.03125:i===32?.03125:0}var zC=Ne([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const FC={type:2,extent:Xt,loadGeometry:()=>[[new he(0,0),new he(Xt+1,0),new he(Xt+1,Xt+1),new he(0,Xt+1),new he(0,0)]]};class wx{constructor(r,o,u,f,m){this.tileID=r,this.uid=Jt(),this.uses=0,this.tileSize=o,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(r){const o=r+this.timeAdded;o<to.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=wc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,o,u){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(f,m){const y={};if(!m)return y;for(const x of f){const E=x.layerIds.map(T=>m.getLayer(T)).filter(Boolean);if(E.length!==0){x.layers=E,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(T=>E.filter(P=>P.id===T)[0]));for(const T of E)y[T.id]=x}}return y}(r.buckets,o.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const m=this.buckets[f];if(m instanceof tu){if(this.hasSymbolBuckets=!0,!u)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const m=this.buckets[f];if(m instanceof tu&&m.hasRTLText){this.hasRTLText=!0,C.isLoading()||C.isLoaded()||b()!=="deferred"||A();break}}this.queryPadding=0;for(const f in this.buckets){const m=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(f).queryRadius(m))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new Zr}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.id]}upload(r){for(const u in this.buckets){const f=this.buckets[u];f.uploadPending()&&f.upload(r)}const o=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new vp(r,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new vp(r,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new vp(r,this.lineAtlas.image,o.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,o,u,f,m,y,x,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:x,transform:y,params:m,tileTransform:this.tileTransform},r,o,u):{}}querySourceFeatures(r,o){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const f=u.loadVTLayers(),m=o?o.sourceLayer:"",y=f._geojsonTileLayer||f[m];if(!y)return;const x=wh(o&&o.filter),{z:E,x:T,y:P}=this.tileID.canonical,O={z:E,x:T,y:P};for(let F=0;F<y.length;F++){const V=y.feature(F);if(x.needGeometry){const oe=vc(V,!0);if(!x.filter(new L(this.tileID.overscaledZ),oe,this.tileID.canonical))continue}else if(!x.filter(new L(this.tileID.overscaledZ),V))continue;const G=u.getId(V,m),K=new DC(V,E,T,P,G);K.tile=O,r.push(K)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const o=this.expirationTime;if(r.cacheControl){const u=gt(r.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const u=Date.now();let f=!1;if(this.expirationTime>u)f=!1;else if(o)if(this.expirationTime<o)f=!0;else{const m=this.expirationTime-o;m?this.expirationTime=u+Math.max(m,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0||!o)return;const u=this.latestFeatureIndex.loadVTLayers(),f=o.style.listImages();for(const m in this.buckets){if(!o.style.hasLayer(m))continue;const y=this.buckets[m],x=y.layers[0].sourceLayer||"_geojsonTileLayer",E=u[x],T=r[x];if(!E||!T||Object.keys(T).length===0)continue;if(y.update(T,E,f,this.imageAtlas&&this.imageAtlas.patternPositions||{}),y instanceof Wg||y instanceof $g){const O=o.style._getSourceCache(y.layers[0].source);o._terrain&&o._terrain.enabled&&O&&y.programConfigurations.needsUpload&&o._terrain._clearRenderCacheForTile(O.id,this.tileID)}const P=o&&o.style&&o.style.getLayer(m);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<to.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=to.now()+r}setTexture(r,o){const u=o.context,f=u.gl;this.texture=this.texture||o.getTileTexture(r.width),this.texture?this.texture.update(r,{useMipmap:!0}):(this.texture=new vp(u,r,f.RGBA,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE))}setDependencies(r,o){const u={};for(const f of o)u[f]=!0;this.dependencies[r]=u}hasDependency(r,o){for(const u of r){const f=this.dependencies[u];if(f){for(const m of o)if(f[m])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;const u=fl(FC,this.tileID.canonical,this.tileTransform)[0],f=new vt,m=new jo;for(let y=0;y<u.length;y++){const{x,y:E}=u[y];f.emplaceBack(x,E),m.emplaceBack(y)}m.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(m),this._tileDebugBuffer=r.createVertexBuffer(f,Yd.members),this._tileDebugSegments=qn.simpleSegment(0,0,f.length,m.length)}_makeTileBoundsBuffers(r,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;const u=fl(FC,this.tileID.canonical,this.tileTransform)[0];let f,m;if(this.isRaster){const y=function(x,E){const T=wc(x,E),P=Math.pow(2,x.z);for(let oe=0;oe<Aa;oe++)for(let pe=0;pe<Aa;pe++){const Ae=us((x.x+(pe+RC(pe))/As)/P),me=Fi((x.y+(oe+RC(oe))/As)/P),Se=E.project(Ae,me),ke=oe*Aa+pe;Ca[2*ke+0]=Math.round((Se.x*T.scale-T.x)*Xt),Ca[2*ke+1]=Math.round((Se.y*T.scale-T.y)*Xt)}nu.fill(0),ay.fill(0);for(let oe=2045;oe>=0;oe--){const pe=4*oe,Ae=ru[pe+0],me=ru[pe+1],Se=ru[pe+2],ke=ru[pe+3],Me=Ae+Se>>1,Je=me+ke>>1,Ze=Me+Je-me,st=Je+Ae-Me,xt=me*Aa+Ae,nt=ke*Aa+Se,ft=Je*Aa+Me,dt=Math.hypot((Ca[2*xt+0]+Ca[2*nt+0])/2-Ca[2*ft+0],(Ca[2*xt+1]+Ca[2*nt+1])/2-Ca[2*ft+1])>=16;nu[ft]=nu[ft]||(dt?1:0),oe<1022&&(nu[ft]=nu[ft]||nu[(me+st>>1)*Aa+(Ae+Ze>>1)]||nu[(ke+st>>1)*Aa+(Se+Ze>>1)])}const O=new ht,F=new qt;let V=0;function G(oe,pe){const Ae=pe*Aa+oe;return ay[Ae]===0&&(O.emplaceBack(Ca[2*Ae+0],Ca[2*Ae+1],oe*Xt/As,pe*Xt/As),ay[Ae]=++V),ay[Ae]-1}function K(oe,pe,Ae,me,Se,ke){const Me=oe+Ae>>1,Je=pe+me>>1;if(Math.abs(oe-Se)+Math.abs(pe-ke)>1&&nu[Je*Aa+Me])K(Se,ke,oe,pe,Me,Je),K(Ae,me,Se,ke,Me,Je);else{const Ze=G(oe,pe),st=G(Ae,me),xt=G(Se,ke);F.emplaceBack(Ze,st,xt)}}return K(0,0,As,As,As,0),K(As,As,0,0,0,As),{vertices:O,indices:F}}(this.tileID.canonical,o);f=y.vertices,m=y.indices}else{f=new ht,m=new qt;for(const{x,y:E}of u)f.emplaceBack(x,E,0,0);const y=rx(f.int16,void 0,4);for(let x=0;x<y.length;x+=3)m.emplaceBack(y[x],y[x+1],y[x+2])}this._tileBoundsBuffer=r.createVertexBuffer(f,zC.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(m),this._tileBoundsSegments=qn.simpleSegment(0,0,f.length,m.length)}_makeGlobeTileDebugBuffers(r,o){const u=o.projection;if(!u||u.name!=="globe"||o.freezeTileCoverage)return;const f=this.tileID.canonical,m=ep(iA(f,o)),y=Lh(o.zoom);let x;y>0&&(x=P0(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,f,o,m,x,y),this._makeGlobeTileDebugTextBuffer(r,f,o,m,x,y)}_globePoint(r,o,u,f,m,y,x){let E=Qd(r,o,u);if(y){const T=1<<u.z,P=Ta(f.center.lng),O=Sa(f.center.lat),F=(u.x+.5)/T-P;let V=0;F>.5?V=-1:F<-.5&&(V=1);let G=(r/Xt+u.x)/T+V,K=(o/Xt+u.y)/T;G=(G-P)*f._pixelsPerMercatorPixel+P,K=(K-O)*f._pixelsPerMercatorPixel+O;const oe=[G*f.worldSize,K*f.worldSize,0];Bn(oe,oe,y),E=_c(E,oe,x)}return Bn(E,E,m)}_makeGlobeTileDebugBorderBuffer(r,o,u,f,m,y){const x=new vt,E=new jo,T=new We,P=(F,V,G,K,oe)=>{const pe=(G-F)/(oe-1),Ae=(K-V)/(oe-1),me=x.length;for(let Se=0;Se<oe;Se++){const ke=F+Se*pe,Me=V+Se*Ae;x.emplaceBack(ke,Me);const Je=this._globePoint(ke,Me,o,u,f,m,y);T.emplaceBack(Je[0],Je[1],Je[2]),E.emplaceBack(me+Se)}},O=Xt;P(0,0,O,0,16),P(O,0,O,O,16),P(O,O,0,O,16),P(0,O,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(E),this._tileDebugBuffer=r.createVertexBuffer(x,Yd.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(T,tA.members),this._tileDebugSegments=qn.simpleSegment(0,0,x.length,E.length)}_makeGlobeTileDebugTextBuffer(r,o,u,f,m,y){const x=Xt/4,E=new vt,T=new qt,P=new We,O=25;T.reserve(32),E.reserve(O),P.reserve(O);const F=(V,G)=>O*V+G;for(let V=0;V<O;V++){const G=V*x;for(let K=0;K<O;K++){const oe=K*x;E.emplaceBack(oe,G);const pe=this._globePoint(oe,G,o,u,f,m,y);P.emplaceBack(pe[0],pe[1],pe[2])}}for(let V=0;V<4;V++)for(let G=0;G<4;G++){const K=F(V,G),oe=F(V,G+1),pe=F(V+1,G),Ae=F(V+1,G+1);T.emplaceBack(K,oe,pe),T.emplaceBack(pe,oe,Ae)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(T),this._tileDebugTextBuffer=r.createVertexBuffer(E,Yd.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(P,tA.members),this._tileDebugTextSegments=qn.simpleSegment(0,0,O,32)}}class oN{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,o,u){const f=String(o);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][f]=this.stateChanges[r][f]||{},lt(this.stateChanges[r][f],u),this.deletedStates[r]===null){this.deletedStates[r]={};for(const m in this.state[r])m!==f&&(this.deletedStates[r][m]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][f]===null){this.deletedStates[r][f]={};for(const m in this.state[r][f])u[m]||(this.deletedStates[r][f][m]=null)}else for(const m in u)this.deletedStates[r]&&this.deletedStates[r][f]&&this.deletedStates[r][f][m]===null&&delete this.deletedStates[r][f][m]}removeFeatureState(r,o,u){if(this.deletedStates[r]===null)return;const f=String(o);if(this.deletedStates[r]=this.deletedStates[r]||{},u&&o!==void 0)this.deletedStates[r][f]!==null&&(this.deletedStates[r][f]=this.deletedStates[r][f]||{},this.deletedStates[r][f][u]=null);else if(o!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][f])for(u in this.deletedStates[r][f]={},this.stateChanges[r][f])this.deletedStates[r][f][u]=null;else this.deletedStates[r][f]=null;else this.deletedStates[r]=null}getState(r,o){const u=String(o),f=lt({},(this.state[r]||{})[u],(this.stateChanges[r]||{})[u]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const m=this.deletedStates[r][o];if(m===null)return{};for(const y in m)delete f[y]}return f}initializeTileState(r,o){r.setFeatureState(this.state,o)}coalesceChanges(r,o){const u={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const m={};for(const y in this.stateChanges[f])this.state[f][y]||(this.state[f][y]={}),lt(this.state[f][y],this.stateChanges[f][y]),m[y]=this.state[f][y];u[f]=m}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const m={};if(this.deletedStates[f]===null)for(const y in this.state[f])m[y]={},this.state[f][y]={};else for(const y in this.deletedStates[f]){if(this.deletedStates[f][y]===null)this.state[f][y]={};else if(this.state[f][y])for(const x of Object.keys(this.deletedStates[f][y]))delete this.state[f][y][x];m[y]=this.state[f][y]}u[f]=u[f]||{},lt(u[f],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const f in r)r[f].setFeatureState(u,o)}}class BC{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,o){const u=this.toIdx(r,o);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(r,o){return this.leaves[this.toIdx(r,o)]}toIdx(r,o){return o*this.size+r}}function NC(i,r,o,u){let f=0,m=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(u[y])<1e-15){if(o[y]<i[y]||o[y]>r[y])return null}else{const x=1/u[y];let E=(i[y]-o[y])*x,T=(r[y]-o[y])*x;if(E>T){const P=E;E=T,T=P}if(E>f&&(f=E),T<m&&(m=T),f>m)return null}return f}function UC(i,r,o,u,f,m,y,x,E,T,P){const O=u-i,F=f-r,V=m-o,G=y-i,K=x-r,oe=E-o,pe=P[1]*oe-P[2]*K,Ae=P[2]*G-P[0]*oe,me=P[0]*K-P[1]*G,Se=O*pe+F*Ae+V*me;if(Math.abs(Se)<1e-15)return null;const ke=1/Se,Me=T[0]-i,Je=T[1]-r,Ze=T[2]-o,st=(Me*pe+Je*Ae+Ze*me)*ke;if(st<0||st>1)return null;const xt=Je*V-Ze*F,nt=Ze*O-Me*V,ft=Me*F-Je*O,dt=(P[0]*xt+P[1]*nt+P[2]*ft)*ke;return dt<0||st+dt>1?null:(G*xt+K*nt+oe*ft)*ke}function $C(i,r,o){return(i-r)/(o-r)}function jC(i,r,o,u,f,m,y,x,E){const T=1<<o,P=m-u,O=y-f,F=(i+1)/T*P+u,V=(r+0)/T*O+f,G=(r+1)/T*O+f;x[0]=(i+0)/T*P+u,x[1]=V,E[0]=F,E[1]=G}class VC{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=function(m){const y=Math.ceil(Math.log2(m.dim/8)),x=[];let E=Math.ceil(Math.pow(2,y));const T=1/E,P=(V,G,K,oe,pe)=>{const Ae=oe?1:0,me=(V+1)*K-Ae,Se=G*K,ke=(G+1)*K-Ae;pe[0]=V*K,pe[1]=Se,pe[2]=me,pe[3]=ke};let O=new BC(E);const F=[];for(let V=0;V<E*E;V++){P(V%E,Math.floor(V/E),T,!1,F);const G=iu(F[0],F[1],m),K=iu(F[2],F[1],m),oe=iu(F[2],F[3],m),pe=iu(F[0],F[3],m);O.minimums.push(Math.min(G,K,oe,pe)),O.maximums.push(Math.max(G,K,oe,pe)),O.leaves.push(1)}for(x.push(O),E/=2;E>=1;E/=2){const V=x[x.length-1];O=new BC(E);for(let G=0;G<E*E;G++){P(G%E,Math.floor(G/E),2,!0,F);const K=V.getElevation(F[0],F[1]),oe=V.getElevation(F[2],F[1]),pe=V.getElevation(F[2],F[3]),Ae=V.getElevation(F[0],F[3]),me=V.isLeaf(F[0],F[1]),Se=V.isLeaf(F[2],F[1]),ke=V.isLeaf(F[2],F[3]),Me=V.isLeaf(F[0],F[3]),Je=Math.min(K.min,oe.min,pe.min,Ae.min),Ze=Math.max(K.max,oe.max,pe.max,Ae.max),st=me&&Se&&ke&&Me;O.maximums.push(Ze),O.minimums.push(Je),O.leaves.push(Ze-Je<=5&&st?1:0)}x.push(O)}return x}(this.dem),u=o.length-1,f=o[u];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(o,0,0,u,0)}raycastRoot(r,o,u,f,m,y,x=1){return NC([r,o,-100],[u,f,this.maximums[0]*x],m,y)}raycast(r,o,u,f,m,y,x=1){if(!this.nodeCount)return null;const E=this.raycastRoot(r,o,u,f,m,y,x);if(E==null)return null;const T=[],P=[],O=[],F=[],V=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;V.length>0;){const{idx:G,t:K,nodex:oe,nodey:pe,depth:Ae}=V.pop();if(this.leaves[G]){jC(oe,pe,Ae,r,o,u,f,O,F);const Se=1<<Ae,ke=(oe+0)/Se,Me=(oe+1)/Se,Je=(pe+0)/Se,Ze=(pe+1)/Se,st=iu(ke,Je,this.dem)*x,xt=iu(Me,Je,this.dem)*x,nt=iu(Me,Ze,this.dem)*x,ft=iu(ke,Ze,this.dem)*x,dt=UC(O[0],O[1],st,F[0],O[1],xt,F[0],F[1],nt,m,y),yt=UC(F[0],F[1],nt,O[0],F[1],ft,O[0],O[1],st,m,y),At=Math.min(dt!==null?dt:Number.MAX_VALUE,yt!==null?yt:Number.MAX_VALUE);if(At!==Number.MAX_VALUE)return At;{const it=Xd([],m,y,K);if(GC(st,xt,ft,nt,$C(it[0],O[0],F[0]),$C(it[1],O[1],F[1]))>=it[2])return K}continue}let me=0;for(let Se=0;Se<this._siblingOffset.length;Se++){jC((oe<<1)+this._siblingOffset[Se][0],(pe<<1)+this._siblingOffset[Se][1],Ae+1,r,o,u,f,O,F),O[2]=-100,F[2]=this.maximums[this.childOffsets[G]+Se]*x;const ke=NC(O,F,m,y);if(ke!=null){const Me=ke;T[Se]=Me;let Je=!1;for(let Ze=0;Ze<me&&!Je;Ze++)Me>=T[P[Ze]]&&(P.splice(Ze,0,Se),Je=!0);Je||(P[me]=Se),me++}}for(let Se=0;Se<me;Se++){const ke=P[Se];V.push({idx:this.childOffsets[G]+ke,t:T[ke],nodex:(oe<<1)+this._siblingOffset[ke][0],nodey:(pe<<1)+this._siblingOffset[ke][1],depth:Ae+1})}}return null}_addNode(r,o,u){return this.minimums.push(r),this.maximums.push(o),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(r,o,u,f,m){if(r[f].isLeaf(o,u)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const y=f-1,x=r[y];let E=0,T=0;for(let P=0;P<this._siblingOffset.length;P++){const O=2*o+this._siblingOffset[P][0],F=2*u+this._siblingOffset[P][1],V=x.getElevation(O,F),G=x.isLeaf(O,F),K=this._addNode(V.min,V.max,G);G&&(E|=1<<P),T||(T=K)}for(let P=0;P<this._siblingOffset.length;P++)E&1<<P||this._construct(r,2*o+this._siblingOffset[P][0],2*u+this._siblingOffset[P][1],y,T+P)}}function GC(i,r,o,u,f,m){return Cr(Cr(i,o,m),Cr(r,u,m),f)}function iu(i,r,o){const u=o.dim,f=_e(i*u-.5,0,u-1),m=_e(r*u-.5,0,u-1),y=Math.floor(f),x=Math.floor(m),E=Math.min(y+1,u-1),T=Math.min(x+1,u-1);return GC(o.get(y,x),o.get(E,x),o.get(y,T),o.get(E,T),f-y,m-x)}const qC={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function sN(i,r,o){return(256*i*256+256*r+o)/10-1e4}function aN(i,r,o){return 256*i+r+o/256-32768}class ly{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,o,u,f=!1,m=!1){if(this.uid=r,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return et(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const y=this.dim=o.height-2,x=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.encoding=u||"mapbox",this.borderReady=f,!f){for(let E=0;E<y;E++)x[this._idx(-1,E)]=x[this._idx(0,E)],x[this._idx(y,E)]=x[this._idx(y-1,E)],x[this._idx(E,-1)]=x[this._idx(E,0)],x[this._idx(E,y)]=x[this._idx(E,y-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(y,-1)]=x[this._idx(y-1,0)],x[this._idx(-1,y)]=x[this._idx(0,y-1)],x[this._idx(y,y)]=x[this._idx(y-1,y-1)],m&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new VC(this)}get(r,o,u=!1){u&&(r=_e(r,-1,this.dim),o=_e(o,-1,this.dim));const f=4*this._idx(r,o);return(this.encoding==="terrarium"?aN:sN)(this.pixels[f],this.pixels[f+1],this.pixels[f+2])}static getUnpackVector(r){return qC[r]}get unpackVector(){return qC[this.encoding]}_idx(r,o){if(r<-1||r>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(r+1)}static pack(r,o){const u=[0,0,0,0],f=ly.getUnpackVector(o);let m=Math.floor((r+f[3])/f[2]);return u[2]=m%256,m=Math.floor(m/256),u[1]=m%256,m=Math.floor(m/256),u[0]=m,u}getPixels(){return new Go({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,o,u){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let f=o*this.dim,m=o*this.dim+this.dim,y=u*this.dim,x=u*this.dim+this.dim;switch(o){case-1:f=m-1;break;case 1:m=f+1}switch(u){case-1:y=x-1;break;case 1:x=y+1}const E=-o*this.dim,T=-u*this.dim;for(let P=y;P<x;P++)for(let O=f;O<m;O++){const F=4*this._idx(O,P),V=4*this._idx(O+E,P+T);this.pixels[F+0]=r.pixels[V+0],this.pixels[F+1]=r.pixels[V+1],this.pixels[F+2]=r.pixels[V+2],this.pixels[F+3]=r.pixels[V+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ut(ly,"DEMData"),Ut(VC,"DemMinMaxQuadTree",{omit:["dem"]});class lN{constructor(r,o){this.max=r,this.onRemove=o,this.reset()}reset(){for(const r in this.data)for(const o of this.data[r])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(r,o,u){const f=r.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);const m={value:o,timeout:void 0};if(u!==void 0&&(m.timeout=setTimeout(()=>{this.remove(r,m)},u)),this.data[f].push(m),this.order.push(f),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const o=this.data[r].shift();return o.timeout&&clearTimeout(o.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),o.value}getByKey(r){const o=this.data[r];return o?o[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,o){if(!this.has(r))return this;const u=r.wrapped().key,f=o===void 0?0:this.data[u].indexOf(o),m=this.data[u][f];return this.data[u].splice(f,1),m.timeout&&clearTimeout(m.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(m.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(r){const o=[];for(const u in this.data)for(const f of this.data[u])r(f.value)||o.push(f);for(const u of o)this.remove(u.value.tileID,u)}}class Zh{constructor(r,o,u){this.func=r,this.mask=o,this.range=u}}Zh.ReadOnly=!1,Zh.ReadWrite=!0,Zh.disabled=new Zh(519,Zh.ReadOnly,[0,1]);const Ex=7680;class Tx{constructor(r,o,u,f,m,y){this.test=r,this.ref=o,this.mask=u,this.fail=f,this.depthFail=m,this.pass=y}}Tx.disabled=new Tx({func:519,mask:0},0,0,Ex,Ex,Ex);class Ia{constructor(r,o,u){this.blendFunction=r,this.blendColor=o,this.mask=u}}Ia.Replace=[1,0],Ia.disabled=new Ia(Ia.Replace,xn.transparent,[!1,!1,!1,!1]),Ia.unblended=new Ia(Ia.Replace,xn.transparent,[!0,!0,!0,!0]),Ia.alphaBlended=new Ia([1,771],xn.transparent,[!0,!0,!0,!0]);const Sx=1029,Ax=2305;class Js{constructor(r,o,u){this.enable=r,this.mode=o,this.frontFace=u}}Js.disabled=new Js(!1,Sx,Ax),Js.backCCW=new Js(!0,Sx,Ax),Js.backCW=new Js(!0,Sx,2304),Js.frontCW=new Js(!0,1028,2304),Js.frontCCW=new Js(!0,1028,Ax);class Ec extends Ha{constructor(r,o,u){super(),this.id=r,this._onlySymbols=u,o.on("data",f=>{f.dataType==="source"&&f.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&f.dataType==="source"&&f.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new lN(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new oN,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const o=this._tiles[r];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,o){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,o)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,()=>{})}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const u=this._tiles[o];u.upload(r),u.prepare(this.map.style.imageManager)}}getIds(){return Pt(this._tiles).map(r=>r.tileID).sort(WC).map(r=>r.key)}getRenderableIds(r){const o=[];for(const u in this._tiles)this._isIdRenderable(+u,r)&&o.push(this._tiles[u]);return r?o.sort((u,f)=>{const m=u.tileID,y=f.tileID,x=new he(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),E=new he(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-y.overscaledZ||E.y-x.y||E.x-x.x}).map(u=>u.tileID.key):o.map(u=>u.tileID).sort(WC).map(u=>u.key)}hasRenderableParent(r){const o=this.findLoadedParent(r,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(r,o){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(o||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,o){const u=this._tiles[r];u&&(u.state!=="loading"&&(u.state=o),this._loadTile(u,this._tileLoaded.bind(this,u,r,o)))}_tileLoaded(r,o,u,f){if(f)if(r.state="errored",f.status!==404)this._source.fire(new ns(f,{tile:r}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const m=this.map.painter.terrain;this.update(this.transform,m.getScaledDemTileSize(),!0),m.resetTileLookupCache(this.id)}else this.update(this.transform);else r.timeAdded=to.now(),u==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(o,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new Oi("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const o=this.getRenderableIds();for(let f=0;f<o.length;f++){const m=o[f];if(r.neighboringTiles&&r.neighboringTiles[m]){const y=this.getTileByID(m);u(r,y),u(y,r)}}function u(f,m){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let y=m.tileID.canonical.x-f.tileID.canonical.x;const x=m.tileID.canonical.y-f.tileID.canonical.y,E=Math.pow(2,f.tileID.canonical.z),T=m.tileID.key;y===0&&x===0||Math.abs(x)>1||(Math.abs(y)>1&&(Math.abs(y+E)===1?y+=E:Math.abs(y-E)===1&&(y-=E)),m.dem&&f.dem&&(f.dem.backfillBorder(m.dem,y,x),f.neighboringTiles&&f.neighboringTiles[T]&&(f.neighboringTiles[T].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,o,u,f){for(const m in this._tiles){let y=this._tiles[m];if(f[m]||!y.hasData()||y.tileID.overscaledZ<=o||y.tileID.overscaledZ>u)continue;let x=y.tileID;for(;y&&y.tileID.overscaledZ>o+1;){const T=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[T.key],y&&y.hasData()&&(x=T)}let E=x;for(;E.overscaledZ>o;)if(E=E.scaledTo(E.overscaledZ-1),r[E.key]){f[x.key]=x;break}}}findLoadedParent(r,o){if(r.key in this._loadedParentTiles){const u=this._loadedParentTiles[r.key];return u&&u.tileID.overscaledZ>=o?u:null}for(let u=r.overscaledZ-1;u>=o;u--){const f=r.scaledTo(u),m=this._getLoadedTile(f);if(m)return m}}_getLoadedTile(r){const o=this._tiles[r.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,o){o=o||this._source.tileSize;const u=Math.ceil(r.width/o)+1,f=Math.ceil(r.height/o)+1,m=Math.floor(u*f*5),y=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,m):m,x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(x)}handleWrapJump(r){const o=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,o){const u={};for(const f in this._tiles){const m=this._tiles[f];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+o),u[m.tileID.key]=m}this._tiles=u;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(r,o,u){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let f;this.updateCacheSize(r,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new so(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(f=r.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(x=>this._source.hasTile(x)))):f=[];const m=this._updateRetainedTiles(f);if(ZC(this._source.type)&&f.length!==0){const x={},E={},T=Object.keys(m);for(const O of T){const F=m[O],V=this._tiles[O];if(!V||V.fadeEndTime&&V.fadeEndTime<=to.now())continue;const G=this.findLoadedParent(F,Math.max(F.overscaledZ-Ec.maxOverzooming,this._source.minzoom));G&&(this._addTile(G.tileID),x[G.tileID.key]=G.tileID),E[O]=F}const P=f[f.length-1].overscaledZ;for(const O in this._tiles){const F=this._tiles[O];if(m[O]||!F.hasData())continue;let V=F.tileID;for(;V.overscaledZ>P;){V=V.scaledTo(V.overscaledZ-1);const G=this._tiles[V.key];if(G&&G.hasData()&&E[V.key]){m[O]=F.tileID;break}}}for(const O in x)m[O]||(this._coveredTiles[O]=!0,m[O]=x[O])}for(const x in m)this._tiles[x].clearFadeHold();const y=function(x,E){const T=[];for(const P in x)P in E||T.push(P);return T}(this._tiles,m);for(const x of y){const E=this._tiles[x];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const o={};if(r.length===0)return o;const u={},f=r.reduce((T,P)=>Math.min(T,P.overscaledZ),1/0),m=r[0].overscaledZ,y=Math.max(m-Ec.maxOverzooming,this._source.minzoom),x=Math.max(m+Ec.maxUnderzooming,this._source.minzoom),E={};for(const T of r){const P=this._addTile(T);o[T.key]=T,P.hasData()||f<this._source.maxzoom&&(E[T.key]=T)}this._retainLoadedChildren(E,f,x,o);for(const T of r){let P=this._tiles[T.key];if(P.hasData())continue;if(T.canonical.z>=this._source.maxzoom){const F=T.children(this._source.maxzoom)[0],V=this.getTile(F);if(V&&V.hasData()){o[F.key]=F;continue}}else{const F=T.children(this._source.maxzoom);if(o[F[0].key]&&o[F[1].key]&&o[F[2].key]&&o[F[3].key])continue}let O=P.wasRequested();for(let F=T.overscaledZ-1;F>=y;--F){const V=T.scaledTo(F);if(u[V.key]||(u[V.key]=!0,P=this.getTile(V),!P&&O&&(P=this._addTile(V)),P&&(o[V.key]=V,O=P.wasRequested(),P.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const o=[];let u,f=this._tiles[r].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){u=this._loadedParentTiles[f.key];break}o.push(f.key);const m=f.scaledTo(f.overscaledZ-1);if(u=this._getLoadedTile(m),u)break;f=m}for(const m of o)this._loadedParentTiles[m]=u}}_addTile(r){let o=this._tiles[r.key];if(o)return o;o=this._cache.getAndRemove(r),o&&(this._setTileReloadTimer(r.key,o),o.tileID=r,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,o)));const u=!!o;if(!u){const f=this.map?this.map.painter:null;o=new wx(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom,f,this._isRaster),this._loadTile(o,this._tileLoaded.bind(this,o,r.key,o.state))}return o?(o.uses++,this._tiles[r.key]=o,u||this._source.fire(new Oi("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(r,o){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const u=o.getExpiryTimeout();u&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},u))}_removeTile(r){const o=this._tiles[r];o&&(o.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,o,u){const f=[],m=this.transform;if(!m)return f;const y=m.projection.name==="globe",x=Ta(m.center.lng);for(const E in this._tiles){const T=this._tiles[E];if(u&&T.clearQueryDebugViz(),T.holdingForFade())continue;let P;if(y){const O=T.tileID.canonical;if(O.z===0){const F=[Math.abs(_e(x,...xp(O,-1))-x),Math.abs(_e(x,...xp(O,1))-x)];P=[0,2*F.indexOf(Math.min(...F))-1]}else{const F=[Math.abs(_e(x,...xp(O,-1))-x),Math.abs(_e(x,...xp(O,0))-x),Math.abs(_e(x,...xp(O,1))-x)];P=[F.indexOf(Math.min(...F))-1]}}else P=[0];for(const O of P){const F=r.containsTile(T,m,o,O);F&&f.push(F)}}return f}getVisibleCoordinates(r){const o=this.getRenderableIds(r).map(u=>this._tiles[u].tileID);for(const u of o)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(ZC(this._source.type))for(const r in this._tiles){const o=this._tiles[r];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=to.now())return!0}return!1}setFeatureState(r,o,u){this._state.updateState(r=r||"_geojsonTileLayer",o,u)}removeFeatureState(r,o,u){this._state.removeFeatureState(r=r||"_geojsonTileLayer",o,u)}getFeatureState(r,o){return this._state.getState(r=r||"_geojsonTileLayer",o)}setDependencies(r,o,u){const f=this._tiles[r];f&&f.setDependencies(o,u)}reloadTilesForDependencies(r,o){for(const u in this._tiles)this._tiles[u].hasDependency(r,o)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(r,o))}_preloadTiles(r,o){if(!this._sourceLoaded){const x=()=>{this._sourceLoaded&&(this._source.off("data",x),this._preloadTiles(r,o))};return void this._source.on("data",x)}const u=new Map,f=Array.isArray(r)?r:[r],m=this.map.painter.terrain,y=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(const x of f){const E=x.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const T of E)u.set(T.key,T);this.usedForTerrain&&x.updateElevation(!1)}Le(Array.from(u.values()),(x,E)=>{const T=new wx(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(T,P=>{this._source.type==="raster-dem"&&T.dem&&this._backfillDEM(T),E(P,T)})},o)}}function WC(i,r){const o=Math.abs(2*i.wrap)-+(i.wrap<0),u=Math.abs(2*r.wrap)-+(r.wrap<0);return i.overscaledZ-r.overscaledZ||u-o||r.canonical.y-i.canonical.y||r.canonical.x-i.canonical.x}function ZC(i){return i==="raster"||i==="image"||i==="video"||i==="custom"}function xp(i,r){const o=1<<i.z;return[i.x/o+r,(i.x+1)/o+r]}Ec.maxOverzooming=10,Ec.maxUnderzooming=3;class uy{constructor(r,o,u){this._demTile=r,this._dem=this._demTile.dem,this._scale=o,this._offset=u}static create(r,o,u){const f=u||r.findDEMTileFor(o);if(!f||!f.dem)return;const m=f.dem,y=f.tileID,x=1<<o.canonical.z-y.canonical.z;return new uy(f,f.tileSize/Xt/x,[(o.canonical.x/x-y.canonical.x)*m.dim,(o.canonical.y/x-y.canonical.y)*m.dim])}tileCoordToPixel(r,o){const u=o*this._scale+this._offset[1],f=Math.floor(r*this._scale+this._offset[0]),m=Math.floor(u);return new he(f,m)}getElevationAt(r,o,u,f){const m=r*this._scale+this._offset[0],y=o*this._scale+this._offset[1],x=Math.floor(m),E=Math.floor(y),T=this._dem;return f=!!f,u?Cr(Cr(T.get(x,E,f),T.get(x,E+1,f),y-E),Cr(T.get(x+1,E,f),T.get(x+1,E+1,f),y-E),m-x):T.get(x,E,f)}getElevationAtPixel(r,o,u){return this._dem.get(r,o,!!u)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*Xs(1,r)*this._dem.stride}}class HC{constructor(r,o){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new ol(Xt,16,0),this.featureIndexArray=new hc,this.promoteId=o}insert(r,o,u,f,m,y=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,f,m,y);const E=this.grid;for(let T=0;T<o.length;T++){const P=o[T],O=[1/0,1/0,-1/0,-1/0];for(let F=0;F<P.length;F++){const V=P[F];O[0]=Math.min(O[0],V.x),O[1]=Math.min(O[1],V.y),O[2]=Math.max(O[2],V.x),O[3]=Math.max(O[3],V.y)}O[0]<Xt&&O[1]<Xt&&O[2]>=0&&O[3]>=0&&E.insert(x,O[0],O[1],O[2],O[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new sx(new Xg(this.rawTileData)).layers,this.sourceLayerCoder=new OC(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,o,u,f){this.loadVTLayers();const m=r.params||{},y=wh(m.filter),x=r.tileResult,E=r.transform,T=x.bufferedTilespaceBounds,P=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(G,K,oe,pe)=>vA(x.bufferedTilespaceGeometry,G,K,oe,pe));P.sort(uN);let O=null;E.elevation&&P.length>0&&(O=uy.create(E.elevation,this.tileID));const F={};let V;for(let G=0;G<P.length;G++){const K=P[G];if(K===V)continue;V=K;const oe=this.featureIndexArray.get(K);let pe=null;this.loadMatchingFeature(F,oe,y,m.layers,m.availableImages,o,u,f,(Ae,me,Se,ke=0)=>(pe||(pe=fl(Ae,this.tileID.canonical,r.tileTransform)),me.queryIntersectsFeature(x,Ae,Se,pe,this.z,r.transform,r.pixelPosMatrix,O,ke)))}return F}loadMatchingFeature(r,o,u,f,m,y,x,E,T){const{featureIndex:P,bucketIndex:O,sourceLayerIndex:F,layoutVertexArrayOffset:V}=o,G=this.bucketLayerIDs[O];if(f&&!function(Ae,me){for(let Se=0;Se<Ae.length;Se++)if(me.indexOf(Ae[Se])>=0)return!0;return!1}(f,G))return;const K=this.sourceLayerCoder.decode(F),oe=this.vtLayers[K].feature(P);if(u.needGeometry){const Ae=vc(oe,!0);if(!u.filter(new L(this.tileID.overscaledZ),Ae,this.tileID.canonical))return}else if(!u.filter(new L(this.tileID.overscaledZ),oe))return;const pe=this.getId(oe,K);for(let Ae=0;Ae<G.length;Ae++){const me=G[Ae];if(f&&f.indexOf(me)<0)continue;const Se=y[me];if(!Se)continue;let ke={};pe!==void 0&&E&&(ke=E.getState(Se.sourceLayer||"_geojsonTileLayer",pe));const Me=lt({},x[me]);Me.paint=XC(Me.paint,Se.paint,oe,ke,m),Me.layout=XC(Me.layout,Se.layout,oe,ke,m);const Je=!T||T(oe,Se,ke,V);if(!Je)continue;const Ze=new DC(oe,this.z,this.x,this.y,pe);Ze.layer=Me;let st=r[me];st===void 0&&(st=r[me]=[]),st.push({featureIndex:P,feature:Ze,intersectionZ:Je})}}lookupSymbolFeatures(r,o,u,f,m,y,x,E){const T={};this.loadVTLayers();const P=wh(m);for(const O of r)this.loadMatchingFeature(T,{bucketIndex:u,sourceLayerIndex:f,featureIndex:O,layoutVertexArrayOffset:0},P,y,x,E,o);return T}loadFeature(r){const{featureIndex:o,sourceLayerIndex:u}=r;this.loadVTLayers();const f=this.sourceLayerCoder.decode(u),m=this.vtFeatures[f];if(m[o])return m[o];const y=this.vtLayers[f].feature(o);return m[o]=y,y}hasLayer(r){for(const o of this.bucketLayerIDs)for(const u of o)if(r===u)return!0;return!1}getId(r,o){let u=r.id;if(this.promoteId){const f=typeof this.promoteId=="string"?this.promoteId:this.promoteId[o];f!=null&&(u=r.properties[f]),typeof u=="boolean"&&(u=Number(u))}return u}}function XC(i,r,o,u,f){return tr(i,(m,y)=>{const x=r instanceof de?r.get(y):null;return x&&x.evaluate?x.evaluate(o,u,f):x})}function uN(i,r){return r-i}Ut(HC,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class KC{constructor(r,o){this.width=r,this.height=o,this.nextRow=0,this.image=new dl({width:r,height:o}),this.positions={},this.uploaded=!1}getDash(r,o){const u=this.getKey(r,o);return this.positions[u]}trim(){const r=this.width,o=this.height=Kt(this.nextRow);this.image.resize({width:r,height:o})}getKey(r,o){return r.join(",")+o}getDashRanges(r,o,u){const f=[];let m=r.length%2==1?-r[r.length-1]*u:0,y=r[0]*u,x=!0;f.push({left:m,right:y,isDash:x,zeroLength:r[0]===0});let E=r[0];for(let T=1;T<r.length;T++){x=!x;const P=r[T];m=E*u,E+=P,y=E*u,f.push({left:m,right:y,isDash:x,zeroLength:P===0})}return f}addRoundDash(r,o,u){const f=o/2;for(let m=-u;m<=u;m++){const y=this.width*(this.nextRow+u+m);let x=0,E=r[x];for(let T=0;T<this.width;T++){T/E.right>1&&(E=r[++x]);const P=Math.abs(T-E.left),O=Math.abs(T-E.right),F=Math.min(P,O);let V;const G=m/u*(f+1);if(E.isDash){const K=f-Math.abs(G);V=Math.sqrt(F*F+K*K)}else V=f-Math.sqrt(F*F+G*G);this.image.data[y+T]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(r,o){for(let E=r.length-1;E>=0;--E){const T=r[E],P=r[E+1];T.zeroLength?r.splice(E,1):P&&P.isDash===T.isDash&&(P.left=T.left,r.splice(E,1))}const u=r[0],f=r[r.length-1];u.isDash===f.isDash&&(u.left=f.left-this.width,f.right=u.right+this.width);const m=this.width*this.nextRow;let y=0,x=r[y];for(let E=0;E<this.width;E++){E/x.right>1&&(x=r[++y]);const T=Math.abs(E-x.left),P=Math.abs(E-x.right),O=Math.min(T,P);this.image.data[m+E]=Math.max(0,Math.min(255,(x.isDash?O:-O)+o+128))}}addDash(r,o){const u=this.getKey(r,o);if(this.positions[u])return this.positions[u];const f=o==="round",m=f?7:0,y=2*m+1;if(this.nextRow+y>this.height)return et("LineAtlas out of space"),null;r.length===0&&r.push(1);let x=0;for(let P=0;P<r.length;P++)r[P]<0&&(et("Negative value is found in line dasharray, replacing values with 0"),r[P]=0),x+=r[P];if(x!==0){const P=this.width/x,O=this.getDashRanges(r,this.width,P);f?this.addRoundDash(O,P,m):this.addRegularDash(O,o==="square"?.5*P:0)}const E=this.nextRow+m;this.nextRow+=y;const T={tl:[E,m],br:[x,0]};return this.positions[u]=T,T}}Ut(KC,"LineAtlas");const YC=1*Ys;class JC{constructor(r){const o={},u=[];for(const x in r){const E=r[x],T=o[x]={};for(const P in E.glyphs){const O=E.glyphs[+P];if(!O||O.bitmap.width===0||O.bitmap.height===0)continue;const F=O.metrics.localGlyph?YC:1,V={x:0,y:0,w:O.bitmap.width+2*F,h:O.bitmap.height+2*F};u.push(V),T[P]=V}}const{w:f,h:m}=cx(u),y=new dl({width:f||1,height:m||1});for(const x in r){const E=r[x];for(const T in E.glyphs){const P=E.glyphs[+T];if(!P||P.bitmap.width===0||P.bitmap.height===0)continue;const O=o[x][T],F=P.metrics.localGlyph?YC:1;dl.copy(P.bitmap,y,{x:0,y:0},{x:O.x+F,y:O.y+F},P.bitmap)}}this.image=y,this.positions=o}}Ut(JC,"GlyphAtlas");class cN{constructor(r){this.tileID=new so(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.canonical=r.tileID.canonical,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile,this.tileTransform=wc(r.tileID.canonical,r.projection),this.projection=r.projection}parse(r,o,u,f,m){this.status="parsing",this.data=r,this.collisionBoxArray=new Zr;const y=new OC(Object.keys(r.layers).sort()),x=new HC(this.tileID,this.promoteId);x.bucketLayerIDs=[];const E={},T=new KC(256,256),P={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:T,availableImages:u},O=o.familiesBySource[this.source];for(const ke in O){const Me=r.layers[ke];if(!Me)continue;let Je=!1,Ze=!1;for(const nt of O[ke])nt[0].type==="symbol"?Je=!0:Ze=!0;if(this.isSymbolTile===!0&&!Je||this.isSymbolTile===!1&&!Ze)continue;Me.version===1&&et(`Vector tile source "${this.source}" layer "${ke}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const st=y.encode(ke),xt=[];for(let nt=0;nt<Me.length;nt++){const ft=Me.feature(nt),dt=x.getId(ft,ke);xt.push({feature:ft,id:dt,index:nt,sourceLayerIndex:st})}for(const nt of O[ke]){const ft=nt[0];this.isSymbolTile!==void 0&&ft.type==="symbol"!==this.isSymbolTile||ft.minzoom&&this.zoom<Math.floor(ft.minzoom)||ft.maxzoom&&this.zoom>=ft.maxzoom||ft.visibility!=="none"&&(Cx(nt,this.zoom,u),(E[ft.id]=ft.createBucket({index:x.bucketLayerIDs.length,layers:nt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:st,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:u})).populate(xt,P,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(nt.map(dt=>dt.id)))}}let F,V,G,K;T.trim();const oe={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},pe=()=>{if(F)return m(F);if(V&&G&&K){const ke=new JC(V),Me=new oC(G,K);for(const Je in E){const Ze=E[Je];Ze instanceof tu?(Cx(Ze.layers,this.zoom,u),z5(Ze,V,ke.positions,G,Me.iconPositions,this.showCollisionBoxes,u,this.tileID.canonical,this.tileZoom,this.projection)):Ze.hasPattern&&(Ze instanceof Wg||Ze instanceof $g||Ze instanceof lp)&&(Cx(Ze.layers,this.zoom,u),Ze.addFeatures(P,this.tileID.canonical,Me.patternPositions,u,this.tileTransform))}this.status="done",m(null,{buckets:Pt(E).filter(Je=>!Je.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ke.image,lineAtlas:T,imageAtlas:Me,glyphMap:this.returnDependencies?V:null,iconMap:this.returnDependencies?G:null,glyphPositions:this.returnDependencies?ke.positions:null})}},Ae=tr(P.glyphDependencies,ke=>Object.keys(ke).map(Number));Object.keys(Ae).length?f.send("getGlyphs",{uid:this.uid,stacks:Ae},(ke,Me)=>{F||(F=ke,V=Me,pe())},void 0,!1,oe):V={};const me=Object.keys(P.iconDependencies);me.length?f.send("getImages",{icons:me,source:this.source,tileID:this.tileID,type:"icons"},(ke,Me)=>{F||(F=ke,G=Me,pe())},void 0,!1,oe):G={};const Se=Object.keys(P.patternDependencies);Se.length?f.send("getImages",{icons:Se,source:this.source,tileID:this.tileID,type:"patterns"},(ke,Me)=>{F||(F=ke,K=Me,pe())},void 0,!1,oe):K={},pe()}}function Cx(i,r,o){const u=new L(r);for(const f of i)f.recalculate(u,o)}class QC{constructor(r){this.entries={},this.scheduler=r}request(r,o,u,f){const m=this.entries[r]=this.entries[r]||{callbacks:[]};if(m.result){const[y,x]=m.result;return this.scheduler?this.scheduler.add(()=>{f(y,x)},o):f(y,x),()=>{}}return m.callbacks.push(f),m.cancel||(m.cancel=u((y,x)=>{m.result=[y,x];for(const E of m.callbacks)this.scheduler?this.scheduler.add(()=>{E(y,x)},o):E(y,x);setTimeout(()=>delete this.entries[r],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(y=>y!==f),m.callbacks.length||(m.cancel(),delete this.entries[r]))}}}function eI(i,r,o){const u=JSON.stringify(i.request);return i.data&&(this.deduped.entries[u]={result:[null,i.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},f=>{const m=vs(i.request,(y,x,E,T)=>{y?f(y):x&&f(null,{vectorTile:o?void 0:new sx(new Xg(x)),rawData:x,cacheControl:E,expires:T})});return()=>{m.cancel(),f()}},r)}const tI=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ix{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,u]=new Uint8Array(r,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=u>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const m=tI[15&u];if(!m)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(r,2,1),[x]=new Uint32Array(r,4,1);return new Ix(x,y,m,r)}constructor(r,o=64,u=Float64Array,f){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=u,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const m=tI.indexOf(this.ArrayType),y=2*r*this.ArrayType.BYTES_PER_ELEMENT,x=r*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-x%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${u}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+x+E,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+y+x+E),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+x+E,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=r)}add(r,o){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=r,this.coords[this._pos++]=o,u}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return Mx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,o,u,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:y,nodeSize:x}=this,E=[0,m.length-1,0],T=[];for(;E.length;){const P=E.pop()||0,O=E.pop()||0,F=E.pop()||0;if(O-F<=x){for(let oe=F;oe<=O;oe++){const pe=y[2*oe],Ae=y[2*oe+1];pe>=r&&pe<=u&&Ae>=o&&Ae<=f&&T.push(m[oe])}continue}const V=F+O>>1,G=y[2*V],K=y[2*V+1];G>=r&&G<=u&&K>=o&&K<=f&&T.push(m[V]),(P===0?r<=G:o<=K)&&(E.push(F),E.push(V-1),E.push(1-P)),(P===0?u>=G:f>=K)&&(E.push(V+1),E.push(O),E.push(1-P))}return T}within(r,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:m,nodeSize:y}=this,x=[0,f.length-1,0],E=[],T=u*u;for(;x.length;){const P=x.pop()||0,O=x.pop()||0,F=x.pop()||0;if(O-F<=y){for(let oe=F;oe<=O;oe++)nI(m[2*oe],m[2*oe+1],r,o)<=T&&E.push(f[oe]);continue}const V=F+O>>1,G=m[2*V],K=m[2*V+1];nI(G,K,r,o)<=T&&E.push(f[V]),(P===0?r-u<=G:o-u<=K)&&(x.push(F),x.push(V-1),x.push(1-P)),(P===0?r+u>=G:o+u>=K)&&(x.push(V+1),x.push(O),x.push(1-P))}return E}}function Mx(i,r,o,u,f,m){if(f-u<=o)return;const y=u+f>>1;rI(i,r,y,u,f,m),Mx(i,r,o,u,y-1,1-m),Mx(i,r,o,y+1,f,1-m)}function rI(i,r,o,u,f,m){for(;f>u;){if(f-u>600){const T=f-u+1,P=o-u+1,O=Math.log(T),F=.5*Math.exp(2*O/3),V=.5*Math.sqrt(O*F*(T-F)/T)*(P-T/2<0?-1:1);rI(i,r,o,Math.max(u,Math.floor(o-P*F/T+V)),Math.min(f,Math.floor(o+(T-P)*F/T+V)),m)}const y=r[2*o+m];let x=u,E=f;for(bp(i,r,u,o),r[2*f+m]>y&&bp(i,r,u,f);x<E;){for(bp(i,r,x,E),x++,E--;r[2*x+m]<y;)x++;for(;r[2*E+m]>y;)E--}r[2*u+m]===y?bp(i,r,u,E):(E++,bp(i,r,E,f)),E<=o&&(u=E+1),o<=E&&(f=E-1)}}function bp(i,r,o,u){Px(i,o,u),Px(r,2*o,2*u),Px(r,2*o+1,2*u+1)}function Px(i,r,o){const u=i[r];i[r]=i[o],i[o]=u}function nI(i,r,o,u){const f=i-o,m=r-u;return f*f+m*m}a.ARRAY_TYPE=Vo,a.AUTH_ERR_MSG=Ie,a.Aabb=oo,a.Actor=class{constructor(i,r,o){this.target=i,this.parent=r,this.mapId=o,this.callbacks={},this.cancelCallbacks={},Ir(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=$e()?i:S,this.scheduler=new nN}send(i,r,o,u,f=!1,m){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=m,this.callbacks[y]=o);const x=tt(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:i,hasCallback:!!o,targetMapId:u,mustQueue:f,sourceMapId:this.mapId,data:Zl(r,x)},x),{cancel:()=>{o&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(i){const r=i.data,o=r.id;if(o&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const u=this.cancelCallbacks[o];delete this.cancelCallbacks[o],u&&u.cancel()}else if(r.mustQueue||$e()){const u=this.callbacks[o];this.cancelCallbacks[o]=this.scheduler.add(()=>this.processTask(o,r),u&&u.metadata||{type:"message"})}else this.processTask(o,r)}processTask(i,r){if(r.type==="<response>"){const o=this.callbacks[i];delete this.callbacks[i],o&&(r.error?o(sl(r.error)):o(null,sl(r.data)))}else{const o=tt(this.globalScope)?void 0:[],u=r.hasCallback?(m,y)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:m?Zl(m):null,data:Zl(y,o)},o)}:m=>{},f=sl(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,f,u);else if(this.parent.getWorkerSource){const m=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,m[0],f.source)[m[1]](f,u)}else u(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.CanonicalTileID=qg,a.Color=xn,a.ColorMode=Ia,a.CullFaceMode=Js,a.DEMData=ly,a.DataConstantProperty=X,a.DedupedRequest=QC,a.DepthMode=Zh,a.EXTENT=Xt,a.Elevation=class{isDataAvailableAtPoint(i){const r=this._source();if(this.isUsingMockSource()||!r||i.y<0||i.y>1)return!1;const o=r.getSource().maxzoom,u=1<<o,f=Math.floor(i.x),m=Math.floor((i.x-f)*u),y=Math.floor(i.y*u),x=this.findDEMTileFor(new so(o,f,o,m,y));return!(!x||!x.dem)}getAtPointOrZero(i,r=0){return this.getAtPoint(i,r)||0}getAtPoint(i,r,o=!0){if(this.isUsingMockSource())return null;r==null&&(r=null);const u=this._source();if(!u||i.y<0||i.y>1)return r;const f=u.getSource().maxzoom,m=1<<f,y=Math.floor(i.x),x=i.x-y,E=new so(f,y,f,Math.floor(x*m),Math.floor(i.y*m)),T=this.findDEMTileFor(E);if(!T||!T.dem)return r;const P=T.dem,O=1<<T.tileID.canonical.z,F=(x*O-T.tileID.canonical.x)*P.dim,V=(i.y*O-T.tileID.canonical.y)*P.dim,G=Math.floor(F),K=Math.floor(V);return(o?this.exaggeration():1)*Cr(Cr(P.get(G,K),P.get(G,K+1),V-K),Cr(P.get(G+1,K),P.get(G+1,K+1),V-K),F-G)}getAtTileOffset(i,r,o){const u=1<<i.canonical.z;return this.getAtPointOrZero(new Oh(i.wrap+(i.canonical.x+r/Xt)/u,(i.canonical.y+o/Xt)/u))}getAtTileOffsetFunc(i,r,o,u){return f=>{const m=this.getAtTileOffset(i,f.x,f.y),y=u.upVector(i.canonical,f.x,f.y);return ls(y,y,m*u.upVectorScale(i.canonical,r,o).metersToTile),y}}getForTilePoints(i,r,o,u){if(this.isUsingMockSource())return!1;const f=uy.create(this,i,u);return!!f&&(r.forEach(m=>{m[2]=this.exaggeration()*f.getElevationAt(m[0],m[1],o)}),!0)}getMinMaxForTile(i){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(i);if(!r||!r.dem)return null;const o=r.dem.tree,u=r.tileID,f=1<<i.canonical.z-u.canonical.z;let m=i.canonical.x/f-u.canonical.x,y=i.canonical.y/f-u.canonical.y,x=0;for(let E=0;E<i.canonical.z-u.canonical.z&&!o.leaves[x];E++){m*=2,y*=2;const T=2*Math.floor(y)+Math.floor(m);x=o.childOffsets[x]+T,m%=1,y%=1}return{min:this.exaggeration()*o.minimums[x],max:this.exaggeration()*o.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,r,o){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},a.ErrorEvent=ns,a.EvaluationParameters=L,a.Event=Oi,a.Evented=Ha,a.FillExtrusionBucket=lp,a.Frustum=F0,a.FrustumCorners=z0,a.GLOBE_RADIUS=wa,a.GLOBE_SCALE_MATCH_LATITUDE=45,a.GLOBE_ZOOM_THRESHOLD_MAX=rA,a.GLOBE_ZOOM_THRESHOLD_MIN=B0,a.GlobeSharedBuffers=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();for(const i of this._gridSegments)i.withSkirts.destroy(),i.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const i of this._wireframeSegments)i.destroy()}}_fillGridMeshWithLods(i,r){const o=new vt,u=new qt,f=[],m=i+1+2,y=r[0]+1,x=r[0]+1+(1+r.length),E=(T,P,O)=>{let F=T===m-1?T-2:T===0?T:T-1;return F+=O?24575:0,[F,P]};for(let T=0;T<m;++T)o.emplaceBack(...E(T,0,!0));for(let T=0;T<y;++T)for(let P=0;P<m;++P)o.emplaceBack(...E(P,T,(P===0||P===m-1)&&!0));for(let T=0;T<r.length;++T){const P=r[T];for(let O=0;O<m;++O)o.emplaceBack(...E(O,P,!0))}for(let T=0;T<r.length;++T){const P=u.length,O=r[T]+1+2,F=new qt;for(let K=0;K<O-1;K++){const oe=K===O-2,pe=oe?m*(x-r.length+T-K):m;for(let Ae=0;Ae<m-1;Ae++){const me=K*m+Ae;K===0||oe||Ae===0||Ae===m-2?(F.emplaceBack(me+1,me,me+pe),F.emplaceBack(me+pe,me+pe+1,me+1)):(u.emplaceBack(me+1,me,me+pe),u.emplaceBack(me+pe,me+pe+1,me+1))}}const V=qn.simpleSegment(0,P,o.length,u.length-P);for(let K=0;K<F.uint16.length;K+=3)u.emplaceBack(F.uint16[K],F.uint16[K+1],F.uint16[K+2]);const G=qn.simpleSegment(0,P,o.length,u.length-P);f.push({withoutSkirts:V,withSkirts:G})}return{vertices:o,indices:u,segments:f}}_createGrid(i){const r=this._fillGridMeshWithLods(yc,Jd);this._gridSegments=r.segments,this._gridBuffer=i.createVertexBuffer(r.vertices,Yd.members),this._gridIndexBuffer=i.createIndexBuffer(r.indices,!0)}_createPoles(i){const r=new qt;for(let f=0;f<=yc;f++)r.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=i.createIndexBuffer(r,!0);const o=new Wr,u=new Wr;this._poleSegments=[];for(let f=0,m=0;f<B0;f++){const y=360/(1<<f);o.emplaceBack(0,-wa,0,.5,0),u.emplaceBack(0,-wa,0,.5,1);for(let x=0;x<=yc;x++){const E=x/yc,T=Cr(0,y,E),[P,O,F]=Ph(n4,i4,T,wa);o.emplaceBack(P,O,F,E,0),u.emplaceBack(P,O,F,E,1)}this._poleSegments.push(qn.simpleSegment(m,0,66,64)),m+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(o,eA,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(u,eA,!1)}getGridBuffers(i,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[i].withSkirts:this._gridSegments[i].withoutSkirts]}getPoleBuffers(i){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}getWirefameBuffers(i,r){if(!this._wireframeSegments){const o=new mi,u=yc,f=u+1+2,m=1;this._wireframeSegments=[];for(let y=0,x=0;y<Jd.length;y++){const E=Jd[y];for(let P=m;P<E+m;P++)for(let O=m;O<u+m;O++){const F=P*f+O;o.emplaceBack(F,F+1),o.emplaceBack(F,F+f),o.emplaceBack(F,F+f+1)}const T=E*u*3;this._wireframeSegments.push(qn.simpleSegment(0,x,(E+1)*f,T)),x+=T}this._wireframeIndexBuffer=i.createIndexBuffer(o)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[r]]}},a.GlyphManager=jh,a.ImagePosition=hx,a.KDBush=Ix,a.LivePerformanceUtils=ad,a.LngLat=Hr,a.LngLatBounds=Yl,a.LocalGlyphMode=px,a.MAX_MERCATOR_LATITUDE=Bi,a.MercatorCoordinate=Oh,a.ONE_EM=Ai,a.OverscaledTileID=so,a.PerformanceMarkers=ga,a.Point=he,a.Properties=be,a.RGBAImage=Go,a.Ray=R0,a.RequestManager=class{constructor(i,r,o){this._transformRequestFn=i,this._customAccessToken=r,this._silenceAuthErrors=!!o,this._createSkuToken()}_createSkuToken(){const i=function(){let r="";for(let o=0;o<10;o++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",z,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,r){return this._transformRequestFn&&this._transformRequestFn(i,r)||{url:i}}normalizeStyleURL(i,r){if(!Fe(i))return i;const o=kt(i);return o.path=`/styles/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||r)}normalizeGlyphsURL(i,r){if(!Fe(i))return i;const o=kt(i);return o.path=`/fonts/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||r)}normalizeSourceURL(i,r,o,u){if(!Fe(i))return i;const f=kt(i);return f.path=`/v4/${f.authority}.json`,f.params.push("secure"),o&&f.params.push(`language=${o}`),u&&f.params.push(`worldview=${u}`),this._makeAPIURL(f,this._customAccessToken||r)}normalizeSpriteURL(i,r,o,u){const f=kt(i);return Fe(i)?(f.path=`/styles/v1${f.path}/sprite${r}${o}`,this._makeAPIURL(f,this._customAccessToken||u)):(f.path+=`${r}${o}`,wt(f))}normalizeTileURL(i,r,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!Fe(i))return i;const u=kt(i);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||o&&u.authority!=="raster"&&o===512?"@2x":""}${M.supported?".webp":"$1"}`),u.authority==="raster"?u.path=`/${I.RASTER_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${I.TILE_URL_VERSION}${u.path}`);const f=this._customAccessToken||function(m){for(const y of m){const x=y.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(u.params)||I.ACCESS_TOKEN;return I.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,f)}canonicalizeTileURL(i,r){const o=kt(i);if(!o.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!o.path.match(/\.[\w]+$/))return i;let u="mapbox://";o.path.match(/^\/raster\/v1\//)?u+=`raster/${o.path.replace(`/${I.RASTER_URL_PREFIX}/`,"")}`:u+=`tiles/${o.path.replace(`/${I.TILE_URL_VERSION}/`,"")}`;let f=o.params;return r&&(f=f.filter(m=>!m.match(/^access_token=/))),f.length&&(u+=`?${f.join("&")}`),u}canonicalizeTileset(i,r){const o=!!r&&Fe(r),u=[];for(const f of i.tiles||[])Ge(f)?u.push(this.canonicalizeTileURL(f,o)):u.push(f);return u}_makeAPIURL(i,r){const o="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",u=kt(I.API_URL);if(i.protocol=u.protocol,i.authority=u.authority,i.protocol==="http"){const f=i.params.indexOf("secure");f>=0&&i.params.splice(f,1)}if(u.path!=="/"&&(i.path=`${u.path}${i.path}`),!I.REQUIRE_ACCESS_TOKEN)return wt(i);if(r=r||I.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${o}`);if(r[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${o}`)}return i.params=i.params.filter(f=>f.indexOf("access_token")===-1),i.params.push(`access_token=${r||""}`),wt(i)}},a.ResourceType=Wi,a.SegmentVector=qn,a.SourceCache=Ec,a.StencilMode=Tx,a.StructArrayLayout1ui2=jo,a.StructArrayLayout2f1f2i16=Yt,a.StructArrayLayout2i4=vt,a.StructArrayLayout2ui4=mi,a.StructArrayLayout3f12=yr,a.StructArrayLayout3ui6=qt,a.StructArrayLayout4i8=ht,a.StructArrayLayout5f20=Wr,a.Texture=vp,a.Tile=wx,a.Transitionable=H,a.Uniform1f=Ig,a.Uniform1i=class extends ul{constructor(i){super(i),this.current=0}set(i,r,o){this.fetchUniformLocation(i,r)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},a.Uniform2f=class extends ul{constructor(i){super(i),this.current=[0,0]}set(i,r,o){this.fetchUniformLocation(i,r)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}},a.Uniform3f=class extends ul{constructor(i){super(i),this.current=[0,0,0]}set(i,r,o){this.fetchUniformLocation(i,r)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}},a.Uniform4f=FS,a.UniformColor=BS,a.UniformMatrix2f=class extends ul{constructor(i){super(i),this.current=$B}set(i,r,o){if(this.fetchUniformLocation(i,r)){for(let u=0;u<4;u++)if(o[u]!==this.current[u]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}},a.UniformMatrix3f=class extends ul{constructor(i){super(i),this.current=UB}set(i,r,o){if(this.fetchUniformLocation(i,r)){for(let u=0;u<9;u++)if(o[u]!==this.current[u]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}}},a.UniformMatrix4f=class extends ul{constructor(i){super(i),this.current=NB}set(i,r,o){if(this.fetchUniformLocation(i,r)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let u=1;u<16;u++)if(o[u]!==this.current[u]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}},a.UnwrappedTileID=GA,a.ValidationError=Nt,a.VectorTileFeature=Vg,a.VectorTileWorkerSource=class extends Ha{constructor(i,r,o,u,f){super(),this.actor=i,this.layerIndex=r,this.availableImages=o,this.loadVectorData=f||eI,this.loading={},this.loaded={},this.deduped=new QC(i.scheduler),this.isSpriteLoaded=u,this.scheduler=i.scheduler}loadTile(i,r){const o=i.uid,u=i&&i.request,f=u&&u.collectResourceTiming,m=this.loading[o]=new cN(i);m.abort=this.loadVectorData(i,(y,x)=>{const E=!this.loading[o];if(delete this.loading[o],E||y||!x)return m.status="done",E||(this.loaded[o]=m),r(y);const T=x.rawData,P={};x.expires&&(P.expires=x.expires),x.cacheControl&&(P.cacheControl=x.cacheControl),m.vectorTile=x.vectorTile||new sx(new Xg(T));const O=()=>{m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,(F,V)=>{if(F||!V)return r(F);const G={};if(f){const K=Uu(u);K.length>0&&(G.resourceTiming=JSON.parse(JSON.stringify(K)))}r(null,lt({rawTileData:T.slice(0)},V,P,G))})};this.isSpriteLoaded?O():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(O,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):O()}),this.loaded=this.loaded||{},this.loaded[o]=m})}reloadTile(i,r){const o=this.loaded,u=i.uid,f=this;if(o&&o[u]){const m=o[u];m.showCollisionBoxes=i.showCollisionBoxes,m.enableTerrain=!!i.enableTerrain,m.projection=i.projection,m.tileTransform=wc(i.tileID.canonical,i.projection);const y=(x,E)=>{const T=m.reloadCallback;T&&(delete m.reloadCallback,m.parse(m.vectorTile,f.layerIndex,this.availableImages,f.actor,T)),r(x,E)};m.status==="parsing"?m.reloadCallback=y:m.status==="done"&&(m.vectorTile?m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(i,r){const o=i.uid,u=this.loading[o];u&&(u.abort&&u.abort(),delete this.loading[o]),r()}removeTile(i,r){const o=this.loaded,u=i.uid;o&&o[u]&&delete o[u],r()}},a.WritingMode=cs,a.ZoomDependentExpression=ic,a.add=hl,a.addDynamicAttributes=oy,a.adjoint=function(i,r){var o=r[0],u=r[1],f=r[2],m=r[3],y=r[4],x=r[5],E=r[6],T=r[7],P=r[8];return i[0]=y*P-x*T,i[1]=f*T-u*P,i[2]=u*x-f*y,i[3]=x*E-m*P,i[4]=o*P-f*E,i[5]=f*m-o*x,i[6]=m*T-y*E,i[7]=u*E-o*T,i[8]=o*y-u*m,i},a.asyncAll=Le,a.bezier=ct,a.bindAll=Ir,a.boundsAttributes=zC,a.bufferConvexPolygon=function(i,r){const o=[];for(let u=0;u<i.length;u++){const f=Pe(u-1,-1,i.length-1),m=Pe(u+1,-1,i.length-1),y=i[u],x=i[m],E=i[f].sub(y).unit(),T=x.sub(y).unit(),P=T.angleWithSep(E.x,E.y),O=E.add(T).unit().mult(-1*r/Math.sin(P/2));o.push(y.add(O))}return o},a.cacheEntryPossiblyAdded=function(i){Jr++,Jr>Mr&&(i.getActor().send("enforceCacheSizeLimit",Qt),Jr=0)},a.calculateGlobeLabelMatrix=function(i,r){const{x:o,y:u}=i.point,f=aA(o,u,i.worldSize/i._pixelsPerMercatorPixel,0,0);return pc(f,f,$0(Ea(r)))},a.calculateGlobeMatrix=function(i){const{x:r,y:o}=i.point,{lng:u,lat:f}=i._center;return aA(r,o,i.worldSize,u,f)},a.calculateGlobeMercatorMatrix=function(i){const r=i.pixelsPerMeter,o=r/Xs(1,i.center.lat),u=Zs(new Float64Array(16));return qd(u,u,[i.point.x,i.point.y,0]),mc(u,u,[o,o,r]),Float32Array.from(u)},a.circumferenceAtLatitude=V0,a.clamp=_e,a.clearTileCache=function(i){if(!Dn())return;const r=S.caches.delete(Ot);i&&r.catch(i).then(()=>i())},a.clipLine=_C,a.clone=function(i){var r=new Vo(16);return r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r[4]=i[4],r[5]=i[5],r[6]=i[6],r[7]=i[7],r[8]=i[8],r[9]=i[9],r[10]=i[10],r[11]=i[11],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15],r},a.clone$1=Y,a.collisionCircleLayout=l5,a.config=I,a.conjugate=function(i,r){return i[0]=-r[0],i[1]=-r[1],i[2]=-r[2],i[3]=r[3],i},a.create=function(){var i=new Vo(16);return Vo!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},a.create$1=$S,a.createExpression=Gl,a.createLayout=Ne,a.createStyleLayer=function(i){return i.type==="custom"?new Q5(i):new tN[i.type](i)},a.cross=D0,a.degToRad=ie,a.distance=function(i,r){return Math.hypot(r[0]-i[0],r[1]-i[1],r[2]-i[2])},a.div=function(i,r,o){return i[0]=r[0]/o[0],i[1]=r[1]/o[1],i[2]=r[2]/o[2],i},a.dot=Es,a.earthRadius=tp,a.ease=He,a.easeCubicInOut=Mt,a.ecefToLatLng=function([i,r,o]){const u=Math.hypot(i,r,o),f=Math.atan2(i,o),m=.5*Math.PI-Math.acos(-r/u);return new Hr(q(f),q(m))},a.emitValidationErrors=wg,a.endsWith=jr,a.enforceCacheSizeLimit=function(i){Vn(),sr&&sr.then(r=>{r.keys().then(o=>{for(let u=0;u<o.length-i;u++)r.delete(o[u])})})},a.evaluateSizeForFeature=Zg,a.evaluateSizeForZoom=Bh,a.evaluateVariableOffset=EC,a.evented=v,a.exactEquals=function(i,r){return i[0]===r[0]&&i[1]===r[1]&&i[2]===r[2]&&i[3]===r[3]},a.exactEquals$1=function(i,r){return i[0]===r[0]&&i[1]===r[1]&&i[2]===r[2]},a.exported=to,a.exported$1=M,a.extend=lt,a.extend$1=is,a.fillExtrusionHeightLift=$A,a.filterObject=jn,a.fromMat4=function(i,r){return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[4],i[4]=r[5],i[5]=r[6],i[6]=r[8],i[7]=r[9],i[8]=r[10],i},a.fromQuat=function(i,r){var o=r[0],u=r[1],f=r[2],m=r[3],y=o+o,x=u+u,E=f+f,T=o*y,P=u*y,O=u*x,F=f*y,V=f*x,G=f*E,K=m*y,oe=m*x,pe=m*E;return i[0]=1-O-G,i[1]=P+pe,i[2]=F-oe,i[3]=0,i[4]=P-pe,i[5]=1-T-G,i[6]=V+K,i[7]=0,i[8]=F+oe,i[9]=V-K,i[10]=1-T-O,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},a.fromRotation=function(i,r){var o=Math.sin(r),u=Math.cos(r);return i[0]=u,i[1]=o,i[2]=0,i[3]=-o,i[4]=u,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},a.fromScaling=VS,a.furthestTileCorner=function(i){const r=Math.round((i+45+360)%360/90)%4;return Ke[r]},a.getAABBPointSquareDist=function(i,r,o){let u=0;for(let f=0;f<2;++f){const m=o?o[f]:0;i[f]>m&&(u+=(i[f]-m)*(i[f]-m)),r[f]<m&&(u+=(m-r[f])*(m-r[f]))}return u},a.getAnchorAlignment=dx,a.getAnchorJustification=gx,a.getBounds=function(i){let r=1/0,o=1/0,u=-1/0,f=-1/0;for(const m of i)r=Math.min(r,m.x),o=Math.min(o,m.y),u=Math.max(u,m.x),f=Math.max(f,m.y);return{min:new he(r,o),max:new he(u,f)}},a.getColumn=$t,a.getDefaultExportFromCjs=Z,a.getGridMatrix=function(i,r,o,u){const f=r.getNorth(),m=r.getSouth(),y=r.getWest(),x=r.getEast(),E=1<<i.z,T=x-y,P=f-m,O=T/yc,F=-P/Jd[o],V=[0,O,0,F,0,0,f,y,0];if(i.z>0){const G=180/u;jS(V,V,[G/T+1,0,0,0,G/P+1,0,-.5*G/O,.5*G/F,1])}return V[2]=E,V[5]=i.x,V[8]=i.y,V},a.getImage=xe,a.getJSON=function(i,r){return xo(lt(i,{type:"json"}),r)},a.getLatitudinalLod=function(i){const r=Bi-5;i=_e(i,-r,r)/r*90;const o=Math.pow(Math.abs(Math.sin(ie(i))),3);return Math.round(o*(Jd.length-1))},a.getMapSessionAPI=ni,a.getPerformanceMeasurement=Uu,a.getProjection=kC,a.getRTLTextPluginStatus=b,a.getReferrer=ti,a.getTilePoint=function(i,{x:r,y:o},u=0){return new he(((r-u)*i.scale-i.x)*Xt,(o*i.scale-i.y)*Xt)},a.getTileVec3=function(i,r,o=0){return Mh(((r.x-o)*i.scale-i.x)*Xt,(r.y*i.scale-i.y)*Xt,hA(r.z,r.y))},a.getVideo=function(i,r){const o=S.document.createElement("video");o.muted=!0,o.onloadstart=function(){r(null,o)};for(let u=0;u<i.length;u++){const f=S.document.createElement("source");eo(i[u])||(o.crossOrigin="Anonymous"),f.src=i[u],o.appendChild(f)}return{cancel:()=>{}}},a.globeCenterToScreenPoint=function(i){const r=[0,0,0],o=Zs(new Float64Array(16));return pc(o,i.pixelMatrix,i.globeMatrix),Bn(r,r,o),new he(r[0],r[1])},a.globeDenormalizeECEF=$0,a.globeECEFOrigin=function(i,r){const o=[0,0,0];return Bn(o,o,ep(Ea(r.canonical))),Bn(o,o,i),o},a.globeMetersToEcef=kg,a.globeNormalizeECEF=ep,a.globePixelsToTileUnits=function(i,r){return Xt/(512*Math.pow(2,i))*Og(Ea(r))},a.globePoleMatrixForTile=function(i,r,o){const u=Zs(new Float64Array(16)),f=(r/(1<<i)-.5)*Math.PI*2;return Pg(u,o.globeMatrix,f),Float32Array.from(u)},a.globeTileBounds=Ea,a.globeTiltAtLngLat=lA,a.globeToMercatorTransition=Lh,a.globeUseCustomAntiAliasing=function(i,r,o){const u=Lh(o.zoom),f=i.style.map._antialias,m=!!r.extStandardDerivatives,y=r.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return u===0&&!f&&!y&&m},a.identity=Zs,a.identity$1=YS,a.invert=P0,a.isFullscreen=function(){return!!S.document.fullscreenElement||!!S.document.webkitFullscreenElement},a.isLngLatBehindGlobe=j0,a.isMapAuthenticated=function(i){return Ei.has(i)},a.isMapboxURL=Fe,a.isSafariWithAntialiasingBug=function(i){const r=i.navigator?i.navigator.userAgent:null;return!!tt(i)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.latFromMercatorY=Fi,a.latLngToECEF=kh,a.len=KB,a.length=Wd,a.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},a.lngFromMercatorX=us,a.loadVectorTile=eI,a.makeRequest=xo,a.mapValue=function(i,r,o,u,f){return _e((i-r)/(o-r)*(f-u)+u,u,f)},a.mercatorScale=fA,a.mercatorXfromLng=Ta,a.mercatorYfromLat=Sa,a.mercatorZfromAltitude=Xs,a.mul=HB,a.mul$1=XB,a.multiply=pc,a.multiply$1=jS,a.multiply$2=WS,a.nextPowerOfTwo=Kt,a.normalize=io,a.normalize$1=YB,a.normalize$2=XS,a.number=Cr,a.ortho=function(i,r,o,u,f,m,y){var x=1/(r-o),E=1/(u-f),T=1/(m-y);return i[0]=-2*x,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*E,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*T,i[11]=0,i[12]=(r+o)*x,i[13]=(f+u)*E,i[14]=(y+m)*T,i[15]=1,i},a.pbf=YA,a.perspective=function(i,r,o,u,f){var m,y=1/Math.tan(r/2);return i[0]=y/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,f!=null&&f!==1/0?(i[10]=(f+u)*(m=1/(u-f)),i[14]=2*f*u*m):(i[10]=-1,i[14]=-2*u),i},a.pick=function(i,r){const o={};for(let u=0;u<r.length;u++){const f=r[u];f in i&&(o[f]=i[f])}return o},a.plugin=C,a.pointGeometry=Te,a.polesInViewport=function(i){const r=Zs(new Float64Array(16));pc(r,i.pixelMatrix,i.globeMatrix);const o=[0,Ts,0],u=[0,Ss,0];return Bn(o,o,r),Bn(u,u,r),[o[0]>0&&o[0]<=i.width&&o[1]>0&&o[1]<=i.height&&!j0(i,new Hr(i.center.lat,90)),u[0]>0&&u[0]<=i.width&&u[1]>0&&u[1]<=i.height&&!j0(i,new Hr(i.center.lat,-90))]},a.polygonContainsPoint=xc,a.polygonIntersectsBox=vA,a.polygonIntersectsPolygon=mA,a.polygonizeBounds=function(i,r,o=0,u=!0){const f=new he(o,o),m=i.sub(f),y=r.add(f),x=[m,new he(y.x,m.y),y,new he(m.x,y.y)];return u&&x.push(m.clone()),x},a.posAttributes=Yd,a.postMapLoadEvent=In,a.postPerformanceEvent=Rn,a.postTurnstileEvent=br,a.potpack=cx,a.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},a.radToDeg=q,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.registerForPluginStateChange=function(i){return i({pluginStatus:p,pluginURL:s}),v.on("pluginStateChange",i),i},a.removeAuthState=function(i){Ei.delete(i)},a.renderColorRamp=Y0,a.resample=dA,a.rotateX=k0,a.rotateX$1=JS,a.rotateY=Pg,a.rotateY$1=QS,a.rotateZ=function(i,r,o){var u=Math.sin(o),f=Math.cos(o),m=r[0],y=r[1],x=r[2],E=r[3],T=r[4],P=r[5],O=r[6],F=r[7];return r!==i&&(i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]),i[0]=m*f+T*u,i[1]=y*f+P*u,i[2]=x*f+O*u,i[3]=E*f+F*u,i[4]=T*f-m*u,i[5]=P*f-y*u,i[6]=O*f-x*u,i[7]=F*f-E*u,i},a.rotateZ$1=function(i,r,o){o*=.5;var u=r[0],f=r[1],m=r[2],y=r[3],x=Math.sin(o),E=Math.cos(o);return i[0]=u*E+f*x,i[1]=f*E-u*x,i[2]=m*E+y*x,i[3]=y*E-m*x,i},a.scale=mc,a.scale$1=HS,a.scale$2=ls,a.scaleAndAdd=Xd,a.set=function(i,r,o,u){return i[0]=r,i[1]=o,i[2]=u,i},a.setCacheLimits=function(i,r){Qt=i,Mr=r},a.setColumn=function(i,r,o){i[4*r+0]=o[0],i[4*r+1]=o[1],i[4*r+2]=o[2],i[4*r+3]=o[3]},a.setRTLTextPlugin=function(i,r,o=!1){if(p===Ud||p===$d||p===jd)throw new Error("setRTLTextPlugin cannot be called multiple times.");s=to.resolveURL(i),p=Ud,Hl=r,g(),o||A()},a.smoothstep=qe,a.spec=ot,a.squaredLength=function(i){var r=i[0],o=i[1],u=i[2];return r*r+o*o+u*u},a.storeAuthState=function(i,r){r?Ei.add(i):Ei.delete(i)},a.sub=Hs,a.subtract=O0,a.symbolSize=u5,a.tileAABB=function(i,r,o,u,f,m,y,x,E){if(E.name==="globe")return r4(i,r,new qg(o,u,f));const T=wc({z:o,x:u,y:f},E);return new oo([(m+T.x/T.scale)*r,r*(T.y/T.scale),y],[(m+T.x2/T.scale)*r,r*(T.y2/T.scale),x])},a.tileCornersToBounds=Lg,a.tileTransform=wc,a.transformMat3=function(i,r,o){var u=r[0],f=r[1],m=r[2];return i[0]=u*o[0]+f*o[3]+m*o[6],i[1]=u*o[1]+f*o[4]+m*o[7],i[2]=u*o[2]+f*o[5]+m*o[8],i},a.transformMat4=Bn,a.transformMat4$1=gc,a.transformQuat=ZS,a.transitionTileAABBinECEF=iA,a.translate=qd,a.transpose=function(i,r){if(i===r){var o=r[1],u=r[2],f=r[5];i[1]=r[3],i[2]=r[6],i[3]=o,i[5]=r[7],i[6]=u,i[7]=f}else i[0]=r[0],i[1]=r[3],i[2]=r[6],i[3]=r[1],i[4]=r[4],i[5]=r[7],i[6]=r[2],i[7]=r[5],i[8]=r[8];return i},a.triggerPluginCompletionEvent=h,a.uniqueId=Jt,a.updateGlobeVertexNormal=function(i,r,o,u,f){const m=5*r+2;i.float32[m+0]=o,i.float32[m+1]=u,i.float32[m+2]=f},a.validateCustomStyleLayer=function(i){const r=[],o=i.id;return o===void 0&&r.push({message:`layers.${o}: missing required property "id"`}),i.render===void 0&&r.push({message:`layers.${o}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&r.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),r},a.validateFilter=i=>$o(uc(i)),a.validateFog=i=>$o(vg(i)),a.validateLayer=i=>$o(mg(i)),a.validateLight=i=>$o(_g(i)),a.validateSource=i=>$o(yg(i)),a.validateStyle=bg,a.validateTerrain=i=>$o(Rd(i)),a.values=Pt,a.vectorTile=jg,a.version=D,a.warnOnce=et,a.window=S,a.wrap=Pe}),_(["./shared"],function(a){function S(Ee){if(typeof Ee=="number"||typeof Ee=="boolean"||typeof Ee=="string"||Ee==null)return JSON.stringify(Ee);if(Array.isArray(Ee)){let re="[";for(const xe of Ee)re+=`${S(xe)},`;return`${re}]`}let te="{";for(const re of Object.keys(Ee).sort())te+=`${re}:${S(Ee[re])},`;return`${te}}`}function D(Ee){let te="";for(const re of a.refProperties)te+=`/${S(Ee[re])}`;return te}class R{constructor(te){this.keyCache={},te&&this.replace(te)}replace(te){this._layerConfigs={},this._layers={},this.update(te,[])}update(te,re){for(const Ie of te)this._layerConfigs[Ie.id]=Ie,(this._layers[Ie.id]=a.createStyleLayer(Ie)).compileFilter(),this.keyCache[Ie.id]&&delete this.keyCache[Ie.id];for(const Ie of re)delete this.keyCache[Ie],delete this._layerConfigs[Ie],delete this._layers[Ie];this.familiesBySource={};const xe=function(Ie,Fe){const Ge={};for(let ze=0;ze<Ie.length;ze++){const Qe=Fe&&Fe[Ie[ze].id]||D(Ie[ze]);Fe&&(Fe[Ie[ze].id]=Qe);let Ct=Ge[Qe];Ct||(Ct=Ge[Qe]=[]),Ct.push(Ie[ze])}const Ve=[];for(const ze in Ge)Ve.push(Ge[ze]);return Ve}(a.values(this._layerConfigs),this.keyCache);for(const Ie of xe){const Fe=Ie.map(kt=>this._layers[kt.id]),Ge=Fe[0];if(Ge.visibility==="none")continue;const Ve=Ge.source||"";let ze=this.familiesBySource[Ve];ze||(ze=this.familiesBySource[Ve]={});const Qe=Ge.sourceLayer||"_geojsonTileLayer";let Ct=ze[Qe];Ct||(Ct=ze[Qe]=[]),Ct.push(Fe)}}}class I{loadTile(te,re){const{uid:xe,encoding:Ie,rawImageData:Fe,padding:Ge,buildQuadTree:Ve}=te,ze=a.window.ImageBitmap&&Fe instanceof a.window.ImageBitmap?this.getImageData(Fe,Ge):Fe;re(null,new a.DEMData(xe,ze,Ie,Ge<1,Ve))}getImageData(te,re){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(te.width,te.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=te.width,this.offscreenCanvas.height=te.height,this.offscreenCanvasContext.drawImage(te,0,0,te.width,te.height);const xe=this.offscreenCanvasContext.getImageData(-re,-re,te.width+2*re,te.height+2*re);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),xe}}function M(Ee,te){if(Ee.length!==0){N(Ee[0],te);for(var re=1;re<Ee.length;re++)N(Ee[re],!te)}}function N(Ee,te){for(var re=0,xe=0,Ie=0,Fe=Ee.length,Ge=Fe-1;Ie<Fe;Ge=Ie++){var Ve=(Ee[Ie][0]-Ee[Ge][0])*(Ee[Ge][1]+Ee[Ie][1]),ze=re+Ve;xe+=Math.abs(re)>=Math.abs(Ve)?re-ze+Ve:Ve-ze+re,re=ze}re+xe>=0!=!!te&&Ee.reverse()}var j=a.getDefaultExportFromCjs(function Ee(te,re){var xe,Ie=te&&te.type;if(Ie==="FeatureCollection")for(xe=0;xe<te.features.length;xe++)Ee(te.features[xe],re);else if(Ie==="GeometryCollection")for(xe=0;xe<te.geometries.length;xe++)Ee(te.geometries[xe],re);else if(Ie==="Feature")Ee(te.geometry,re);else if(Ie==="Polygon")M(te.coordinates,re);else if(Ie==="MultiPolygon")for(xe=0;xe<te.coordinates.length;xe++)M(te.coordinates[xe],re);return te});const W=a.VectorTileFeature.prototype.toGeoJSON;var B={exports:{}},k=a.pointGeometry,z=a.vectorTile.VectorTileFeature,Z=ee;function ee(Ee,te){this.options=te||{},this.features=Ee,this.length=Ee.length}function se(Ee,te){this.id=typeof Ee.id=="number"?Ee.id:void 0,this.type=Ee.type,this.rawGeometry=Ee.type===1?[Ee.geometry]:Ee.geometry,this.properties=Ee.tags,this.extent=te||4096}ee.prototype.feature=function(Ee){return new se(this.features[Ee],this.options.extent)},se.prototype.loadGeometry=function(){var Ee=this.rawGeometry;this.geometry=[];for(var te=0;te<Ee.length;te++){for(var re=Ee[te],xe=[],Ie=0;Ie<re.length;Ie++)xe.push(new k(re[Ie][0],re[Ie][1]));this.geometry.push(xe)}return this.geometry},se.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ee=this.geometry,te=1/0,re=-1/0,xe=1/0,Ie=-1/0,Fe=0;Fe<Ee.length;Fe++)for(var Ge=Ee[Fe],Ve=0;Ve<Ge.length;Ve++){var ze=Ge[Ve];te=Math.min(te,ze.x),re=Math.max(re,ze.x),xe=Math.min(xe,ze.y),Ie=Math.max(Ie,ze.y)}return[te,xe,re,Ie]},se.prototype.toGeoJSON=z.prototype.toGeoJSON;var ue=a.pbf,Te=Z;function Q(Ee){var te=new ue;return function(re,xe){for(var Ie in re.layers)xe.writeMessage(3,he,re.layers[Ie])}(Ee,te),te.finish()}function he(Ee,te){var re;te.writeVarintField(15,Ee.version||1),te.writeStringField(1,Ee.name||""),te.writeVarintField(5,Ee.extent||4096);var xe={keys:[],values:[],keycache:{},valuecache:{}};for(re=0;re<Ee.length;re++)xe.feature=Ee.feature(re),te.writeMessage(2,ye,xe);var Ie=xe.keys;for(re=0;re<Ie.length;re++)te.writeStringField(3,Ie[re]);var Fe=xe.values;for(re=0;re<Fe.length;re++)te.writeMessage(4,Mt,Fe[re])}function ye(Ee,te){var re=Ee.feature;re.id!==void 0&&te.writeVarintField(1,re.id),te.writeMessage(2,J,Ee),te.writeVarintField(3,re.type),te.writeMessage(4,Ke,re)}function J(Ee,te){var re=Ee.feature,xe=Ee.keys,Ie=Ee.values,Fe=Ee.keycache,Ge=Ee.valuecache;for(var Ve in re.properties){var ze=re.properties[Ve],Qe=Fe[Ve];if(ze!==null){Qe===void 0&&(xe.push(Ve),Fe[Ve]=Qe=xe.length-1),te.writeVarint(Qe);var Ct=typeof ze;Ct!=="string"&&Ct!=="boolean"&&Ct!=="number"&&(ze=JSON.stringify(ze));var kt=Ct+":"+ze,wt=Ge[kt];wt===void 0&&(Ie.push(ze),Ge[kt]=wt=Ie.length-1),te.writeVarint(wt)}}}function ie(Ee,te){return(te<<3)+(7&Ee)}function q(Ee){return Ee<<1^Ee>>31}function Ke(Ee,te){for(var re=Ee.loadGeometry(),xe=Ee.type,Ie=0,Fe=0,Ge=re.length,Ve=0;Ve<Ge;Ve++){var ze=re[Ve],Qe=1;xe===1&&(Qe=ze.length),te.writeVarint(ie(1,Qe));for(var Ct=xe===3?ze.length-1:ze.length,kt=0;kt<Ct;kt++){kt===1&&xe!==1&&te.writeVarint(ie(2,Ct-1));var wt=ze[kt].x-Ie,ar=ze[kt].y-Fe;te.writeVarint(q(wt)),te.writeVarint(q(ar)),Ie+=wt,Fe+=ar}xe===3&&te.writeVarint(ie(7,1))}}function Mt(Ee,te){var re=typeof Ee;re==="string"?te.writeStringField(1,Ee):re==="boolean"?te.writeBooleanField(7,Ee):re==="number"&&(Ee%1!=0?te.writeDoubleField(3,Ee):Ee<0?te.writeSVarintField(6,Ee):te.writeVarintField(5,Ee))}B.exports=Q,B.exports.fromVectorTileJs=Q,B.exports.fromGeojsonVt=function(Ee,te){te=te||{};var re={};for(var xe in Ee)re[xe]=new Te(Ee[xe].features,te),re[xe].name=xe,re[xe].version=te.version,re[xe].extent=te.extent;return Q({layers:re})},B.exports.GeoJSONWrapper=Te;var ct=a.getDefaultExportFromCjs(B.exports);const He={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ee=>Ee},_e=Math.fround||(qe=new Float32Array(1),Ee=>(qe[0]=+Ee,qe[0]));var qe;const Pe=3,Le=5,Pt=6;class lt{constructor(te){this.options=Object.assign(Object.create(He),te),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(te){const{log:re,minZoom:xe,maxZoom:Ie}=this.options;re&&console.time("total time");const Fe=`prepare ${te.length} points`;re&&console.time(Fe),this.points=te;const Ge=[];for(let ze=0;ze<te.length;ze++){const Qe=te[ze];if(!Qe.geometry)continue;const[Ct,kt]=Qe.geometry.coordinates,wt=_e(Er(Ct)),ar=_e(Kt(kt));Ge.push(wt,ar,1/0,ze,-1,1),this.options.reduce&&Ge.push(0)}let Ve=this.trees[Ie+1]=this._createTree(Ge);re&&console.timeEnd(Fe);for(let ze=Ie;ze>=xe;ze--){const Qe=+Date.now();Ve=this.trees[ze]=this._createTree(this._cluster(Ve,ze)),re&&console.log("z%d: %d clusters in %dms",ze,Ve.numItems,+Date.now()-Qe)}return re&&console.timeEnd("total time"),this}getClusters(te,re){let xe=((te[0]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,te[1]));let Fe=te[2]===180?180:((te[2]+180)%360+360)%360-180;const Ge=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)xe=-180,Fe=180;else if(xe>Fe){const kt=this.getClusters([xe,Ie,180,Ge],re),wt=this.getClusters([-180,Ie,Fe,Ge],re);return kt.concat(wt)}const Ve=this.trees[this._limitZoom(re)],ze=Ve.range(Er(xe),Kt(Ge),Er(Fe),Kt(Ie)),Qe=Ve.data,Ct=[];for(const kt of ze){const wt=this.stride*kt;Ct.push(Qe[wt+Le]>1?at(Qe,wt,this.clusterProps):this.points[Qe[wt+Pe]])}return Ct}getChildren(te){const re=this._getOriginId(te),xe=this._getOriginZoom(te),Ie="No cluster with the specified id.",Fe=this.trees[xe];if(!Fe)throw new Error(Ie);const Ge=Fe.data;if(re*this.stride>=Ge.length)throw new Error(Ie);const Ve=this.options.radius/(this.options.extent*Math.pow(2,xe-1)),ze=Fe.within(Ge[re*this.stride],Ge[re*this.stride+1],Ve),Qe=[];for(const Ct of ze){const kt=Ct*this.stride;Ge[kt+4]===te&&Qe.push(Ge[kt+Le]>1?at(Ge,kt,this.clusterProps):this.points[Ge[kt+Pe]])}if(Qe.length===0)throw new Error(Ie);return Qe}getLeaves(te,re,xe){const Ie=[];return this._appendLeaves(Ie,te,re=re||10,xe=xe||0,0),Ie}getTile(te,re,xe){const Ie=this.trees[this._limitZoom(te)],Fe=Math.pow(2,te),{extent:Ge,radius:Ve}=this.options,ze=Ve/Ge,Qe=(xe-ze)/Fe,Ct=(xe+1+ze)/Fe,kt={features:[]};return this._addTileFeatures(Ie.range((re-ze)/Fe,Qe,(re+1+ze)/Fe,Ct),Ie.data,re,xe,Fe,kt),re===0&&this._addTileFeatures(Ie.range(1-ze/Fe,Qe,1,Ct),Ie.data,Fe,xe,Fe,kt),re===Fe-1&&this._addTileFeatures(Ie.range(0,Qe,ze/Fe,Ct),Ie.data,-1,xe,Fe,kt),kt.features.length?kt:null}getClusterExpansionZoom(te){let re=this._getOriginZoom(te)-1;for(;re<=this.options.maxZoom;){const xe=this.getChildren(te);if(re++,xe.length!==1)break;te=xe[0].properties.cluster_id}return re}_appendLeaves(te,re,xe,Ie,Fe){const Ge=this.getChildren(re);for(const Ve of Ge){const ze=Ve.properties;if(ze&&ze.cluster?Fe+ze.point_count<=Ie?Fe+=ze.point_count:Fe=this._appendLeaves(te,ze.cluster_id,xe,Ie,Fe):Fe<Ie?Fe++:te.push(Ve),te.length===xe)break}return Fe}_createTree(te){const re=new a.KDBush(te.length/this.stride|0,this.options.nodeSize,Float32Array);for(let xe=0;xe<te.length;xe+=this.stride)re.add(te[xe],te[xe+1]);return re.finish(),re.data=te,re}_addTileFeatures(te,re,xe,Ie,Fe,Ge){for(const Ve of te){const ze=Ve*this.stride,Qe=re[ze+Le]>1;let Ct,kt,wt;if(Qe)Ct=Jt(re,ze,this.clusterProps),kt=re[ze],wt=re[ze+1];else{const nr=this.points[re[ze+Pe]];Ct=nr.properties;const[ir,br]=nr.geometry.coordinates;kt=Er(ir),wt=Kt(br)}const ar={type:1,geometry:[[Math.round(this.options.extent*(kt*Fe-xe)),Math.round(this.options.extent*(wt*Fe-Ie))]],tags:Ct};let dr;dr=Qe||this.options.generateId?re[ze+Pe]:this.points[re[ze+Pe]].id,dr!==void 0&&(ar.id=dr),Ge.features.push(ar)}}_limitZoom(te){return Math.max(this.options.minZoom,Math.min(Math.floor(+te),this.options.maxZoom+1))}_cluster(te,re){const{radius:xe,extent:Ie,reduce:Fe,minPoints:Ge}=this.options,Ve=xe/(Ie*Math.pow(2,re)),ze=te.data,Qe=[],Ct=this.stride;for(let kt=0;kt<ze.length;kt+=Ct){if(ze[kt+2]<=re)continue;ze[kt+2]=re;const wt=ze[kt],ar=ze[kt+1],dr=te.within(ze[kt],ze[kt+1],Ve),nr=ze[kt+Le];let ir=nr;for(const br of dr){const an=br*Ct;ze[an+2]>re&&(ir+=ze[an+Le])}if(ir>nr&&ir>=Ge){let br,an=wt*nr,In=ar*nr,hi=-1;const Rn=((kt/Ct|0)<<5)+(re+1)+this.points.length;for(const ri of dr){const ni=ri*Ct;if(ze[ni+2]<=re)continue;ze[ni+2]=re;const Ei=ze[ni+Le];an+=ze[ni]*Ei,In+=ze[ni+1]*Ei,ze[ni+4]=Rn,Fe&&(br||(br=this._map(ze,kt,!0),hi=this.clusterProps.length,this.clusterProps.push(br)),Fe(br,this._map(ze,ni)))}ze[kt+4]=Rn,Qe.push(an/ir,In/ir,1/0,Rn,-1,ir),Fe&&Qe.push(hi)}else{for(let br=0;br<Ct;br++)Qe.push(ze[kt+br]);if(ir>1)for(const br of dr){const an=br*Ct;if(!(ze[an+2]<=re)){ze[an+2]=re;for(let In=0;In<Ct;In++)Qe.push(ze[an+In])}}}}return Qe}_getOriginId(te){return te-this.points.length>>5}_getOriginZoom(te){return(te-this.points.length)%32}_map(te,re,xe){if(te[re+Le]>1){const Ge=this.clusterProps[te[re+Pt]];return xe?Object.assign({},Ge):Ge}const Ie=this.points[te[re+Pe]].properties,Fe=this.options.map(Ie);return xe&&Fe===Ie?Object.assign({},Fe):Fe}}function at(Ee,te,re){return{type:"Feature",id:Ee[te+Pe],properties:Jt(Ee,te,re),geometry:{type:"Point",coordinates:[(xe=Ee[te],360*(xe-.5)),xr(Ee[te+1])]}};var xe}function Jt(Ee,te,re){const xe=Ee[te+Le],Ie=xe>=1e4?`${Math.round(xe/1e3)}k`:xe>=1e3?Math.round(xe/100)/10+"k":xe,Fe=Ee[te+Pt],Ge=Fe===-1?{}:Object.assign({},re[Fe]);return Object.assign(Ge,{cluster:!0,cluster_id:Ee[te+Pe],point_count:xe,point_count_abbreviated:Ie})}function Er(Ee){return Ee/360+.5}function Kt(Ee){const te=Math.sin(Ee*Math.PI/180),re=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return re<0?0:re>1?1:re}function xr(Ee){const te=(180-360*Ee)*Math.PI/180;return 360*Math.atan(Math.exp(te))/Math.PI-90}function Ir(Ee,te,re,xe){for(var Ie,Fe=xe,Ge=re-te>>1,Ve=re-te,ze=Ee[te],Qe=Ee[te+1],Ct=Ee[re],kt=Ee[re+1],wt=te+3;wt<re;wt+=3){var ar=jr(Ee[wt],Ee[wt+1],ze,Qe,Ct,kt);if(ar>Fe)Ie=wt,Fe=ar;else if(ar===Fe){var dr=Math.abs(wt-Ge);dr<Ve&&(Ie=wt,Ve=dr)}}Fe>xe&&(Ie-te>3&&Ir(Ee,te,Ie,xe),Ee[Ie+2]=Fe,re-Ie>3&&Ir(Ee,Ie,re,xe))}function jr(Ee,te,re,xe,Ie,Fe){var Ge=Ie-re,Ve=Fe-xe;if(Ge!==0||Ve!==0){var ze=((Ee-re)*Ge+(te-xe)*Ve)/(Ge*Ge+Ve*Ve);ze>1?(re=Ie,xe=Fe):ze>0&&(re+=Ge*ze,xe+=Ve*ze)}return(Ge=Ee-re)*Ge+(Ve=te-xe)*Ve}function tr(Ee,te,re,xe){var Ie={id:Ee===void 0?null:Ee,type:te,geometry:re,tags:xe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Fe){var Ge=Fe.geometry,Ve=Fe.type;if(Ve==="Point"||Ve==="MultiPoint"||Ve==="LineString")jn(Fe,Ge);else if(Ve==="Polygon"||Ve==="MultiLineString")for(var ze=0;ze<Ge.length;ze++)jn(Fe,Ge[ze]);else if(Ve==="MultiPolygon")for(ze=0;ze<Ge.length;ze++)for(var Qe=0;Qe<Ge[ze].length;Qe++)jn(Fe,Ge[ze][Qe])}(Ie),Ie}function jn(Ee,te){for(var re=0;re<te.length;re+=3)Ee.minX=Math.min(Ee.minX,te[re]),Ee.minY=Math.min(Ee.minY,te[re+1]),Ee.maxX=Math.max(Ee.maxX,te[re]),Ee.maxY=Math.max(Ee.maxY,te[re+1])}function Y(Ee,te,re,xe){if(te.geometry){var Ie=te.geometry.coordinates,Fe=te.geometry.type,Ge=Math.pow(re.tolerance/((1<<re.maxZoom)*re.extent),2),Ve=[],ze=te.id;if(re.promoteId?ze=te.properties[re.promoteId]:re.generateId&&(ze=xe||0),Fe==="Point")mt(Ie,Ve);else if(Fe==="MultiPoint")for(var Qe=0;Qe<Ie.length;Qe++)mt(Ie[Qe],Ve);else if(Fe==="LineString")et(Ie,Ve,Ge,!1);else if(Fe==="MultiLineString"){if(re.lineMetrics){for(Qe=0;Qe<Ie.length;Qe++)et(Ie[Qe],Ve=[],Ge,!1),Ee.push(tr(ze,"LineString",Ve,te.properties));return}Ce(Ie,Ve,Ge,!1)}else if(Fe==="Polygon")Ce(Ie,Ve,Ge,!0);else{if(Fe!=="MultiPolygon"){if(Fe==="GeometryCollection"){for(Qe=0;Qe<te.geometry.geometries.length;Qe++)Y(Ee,{id:ze,geometry:te.geometry.geometries[Qe],properties:te.properties},re,xe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Qe=0;Qe<Ie.length;Qe++){var Ct=[];Ce(Ie[Qe],Ct,Ge,!0),Ve.push(Ct)}}Ee.push(tr(ze,Fe,Ve,te.properties))}}function mt(Ee,te){te.push(we(Ee[0])),te.push($e(Ee[1])),te.push(0)}function et(Ee,te,re,xe){for(var Ie,Fe,Ge=0,Ve=0;Ve<Ee.length;Ve++){var ze=we(Ee[Ve][0]),Qe=$e(Ee[Ve][1]);te.push(ze),te.push(Qe),te.push(0),Ve>0&&(Ge+=xe?(Ie*Qe-ze*Fe)/2:Math.sqrt(Math.pow(ze-Ie,2)+Math.pow(Qe-Fe,2))),Ie=ze,Fe=Qe}var Ct=te.length-3;te[2]=1,Ir(te,0,Ct,re),te[Ct+2]=1,te.size=Math.abs(Ge),te.start=0,te.end=te.size}function Ce(Ee,te,re,xe){for(var Ie=0;Ie<Ee.length;Ie++){var Fe=[];et(Ee[Ie],Fe,re,xe),te.push(Fe)}}function we(Ee){return Ee/360+.5}function $e(Ee){var te=Math.sin(Ee*Math.PI/180),re=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return re<0?0:re>1?1:re}function gt(Ee,te,re,xe,Ie,Fe,Ge,Ve){if(xe/=te,Fe>=(re/=te)&&Ge<xe)return Ee;if(Ge<re||Fe>=xe)return null;for(var ze=[],Qe=0;Qe<Ee.length;Qe++){var Ct=Ee[Qe],kt=Ct.geometry,wt=Ct.type,ar=Ie===0?Ct.minX:Ct.minY,dr=Ie===0?Ct.maxX:Ct.maxY;if(ar>=re&&dr<xe)ze.push(Ct);else if(!(dr<re||ar>=xe)){var nr=[];if(wt==="Point"||wt==="MultiPoint")St(kt,nr,re,xe,Ie);else if(wt==="LineString")tt(kt,nr,re,xe,Ie,!1,Ve.lineMetrics);else if(wt==="MultiLineString")$t(kt,nr,re,xe,Ie,!1);else if(wt==="Polygon")$t(kt,nr,re,xe,Ie,!0);else if(wt==="MultiPolygon")for(var ir=0;ir<kt.length;ir++){var br=[];$t(kt[ir],br,re,xe,Ie,!0),br.length&&nr.push(br)}if(nr.length){if(Ve.lineMetrics&&wt==="LineString"){for(ir=0;ir<nr.length;ir++)ze.push(tr(Ct.id,wt,nr[ir],Ct.tags));continue}wt!=="LineString"&&wt!=="MultiLineString"||(nr.length===1?(wt="LineString",nr=nr[0]):wt="MultiLineString"),wt!=="Point"&&wt!=="MultiPoint"||(wt=nr.length===3?"Point":"MultiPoint"),ze.push(tr(Ct.id,wt,nr,Ct.tags))}}}return ze.length?ze:null}function St(Ee,te,re,xe,Ie){for(var Fe=0;Fe<Ee.length;Fe+=3){var Ge=Ee[Fe+Ie];Ge>=re&&Ge<=xe&&(te.push(Ee[Fe]),te.push(Ee[Fe+1]),te.push(Ee[Fe+2]))}}function tt(Ee,te,re,xe,Ie,Fe,Ge){for(var Ve,ze,Qe=Lt(Ee),Ct=Ie===0?Qt:Mr,kt=Ee.start,wt=0;wt<Ee.length-3;wt+=3){var ar=Ee[wt],dr=Ee[wt+1],nr=Ee[wt+2],ir=Ee[wt+3],br=Ee[wt+4],an=Ie===0?ar:dr,In=Ie===0?ir:br,hi=!1;Ge&&(Ve=Math.sqrt(Math.pow(ar-ir,2)+Math.pow(dr-br,2))),an<re?In>re&&(ze=Ct(Qe,ar,dr,ir,br,re),Ge&&(Qe.start=kt+Ve*ze)):an>xe?In<xe&&(ze=Ct(Qe,ar,dr,ir,br,xe),Ge&&(Qe.start=kt+Ve*ze)):Ot(Qe,ar,dr,nr),In<re&&an>=re&&(ze=Ct(Qe,ar,dr,ir,br,re),hi=!0),In>xe&&an<=xe&&(ze=Ct(Qe,ar,dr,ir,br,xe),hi=!0),!Fe&&hi&&(Ge&&(Qe.end=kt+Ve*ze),te.push(Qe),Qe=Lt(Ee)),Ge&&(kt+=Ve)}var Rn=Ee.length-3;ar=Ee[Rn],dr=Ee[Rn+1],nr=Ee[Rn+2],(an=Ie===0?ar:dr)>=re&&an<=xe&&Ot(Qe,ar,dr,nr),Rn=Qe.length-3,Fe&&Rn>=3&&(Qe[Rn]!==Qe[0]||Qe[Rn+1]!==Qe[1])&&Ot(Qe,Qe[0],Qe[1],Qe[2]),Qe.length&&te.push(Qe)}function Lt(Ee){var te=[];return te.size=Ee.size,te.start=Ee.start,te.end=Ee.end,te}function $t(Ee,te,re,xe,Ie,Fe){for(var Ge=0;Ge<Ee.length;Ge++)tt(Ee[Ge],te,re,xe,Ie,Fe,!1)}function Ot(Ee,te,re,xe){Ee.push(te),Ee.push(re),Ee.push(xe)}function Qt(Ee,te,re,xe,Ie,Fe){var Ge=(Fe-te)/(xe-te);return Ee.push(Fe),Ee.push(re+(Ie-re)*Ge),Ee.push(1),Ge}function Mr(Ee,te,re,xe,Ie,Fe){var Ge=(Fe-re)/(Ie-re);return Ee.push(te+(xe-te)*Ge),Ee.push(Fe),Ee.push(1),Ge}function sr(Ee,te){for(var re=[],xe=0;xe<Ee.length;xe++){var Ie,Fe=Ee[xe],Ge=Fe.type;if(Ge==="Point"||Ge==="MultiPoint"||Ge==="LineString")Ie=vn(Fe.geometry,te);else if(Ge==="MultiLineString"||Ge==="Polygon"){Ie=[];for(var Ve=0;Ve<Fe.geometry.length;Ve++)Ie.push(vn(Fe.geometry[Ve],te))}else if(Ge==="MultiPolygon")for(Ie=[],Ve=0;Ve<Fe.geometry.length;Ve++){for(var ze=[],Qe=0;Qe<Fe.geometry[Ve].length;Qe++)ze.push(vn(Fe.geometry[Ve][Qe],te));Ie.push(ze)}re.push(tr(Fe.id,Ge,Ie,Fe.tags))}return re}function vn(Ee,te){var re=[];re.size=Ee.size,Ee.start!==void 0&&(re.start=Ee.start,re.end=Ee.end);for(var xe=0;xe<Ee.length;xe+=3)re.push(Ee[xe]+te,Ee[xe+1],Ee[xe+2]);return re}function Dn(Ee,te){if(Ee.transformed)return Ee;var re,xe,Ie,Fe=1<<Ee.z,Ge=Ee.x,Ve=Ee.y;for(re=0;re<Ee.features.length;re++){var ze=Ee.features[re],Qe=ze.geometry,Ct=ze.type;if(ze.geometry=[],Ct===1)for(xe=0;xe<Qe.length;xe+=2)ze.geometry.push(Vn(Qe[xe],Qe[xe+1],te,Fe,Ge,Ve));else for(xe=0;xe<Qe.length;xe++){var kt=[];for(Ie=0;Ie<Qe[xe].length;Ie+=2)kt.push(Vn(Qe[xe][Ie],Qe[xe][Ie+1],te,Fe,Ge,Ve));ze.geometry.push(kt)}}return Ee.transformed=!0,Ee}function Vn(Ee,te,re,xe,Ie,Fe){return[Math.round(re*(Ee*xe-Ie)),Math.round(re*(te*xe-Fe))]}function qi(Ee,te,re,xe,Ie){for(var Fe=te===Ie.maxZoom?0:Ie.tolerance/((1<<te)*Ie.extent),Ge={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:re,y:xe,z:te,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ve=0;Ve<Ee.length;Ve++){Ge.numFeatures++,Jr(Ge,Ee[Ve],Fe,Ie);var ze=Ee[Ve].minX,Qe=Ee[Ve].minY,Ct=Ee[Ve].maxX,kt=Ee[Ve].maxY;ze<Ge.minX&&(Ge.minX=ze),Qe<Ge.minY&&(Ge.minY=Qe),Ct>Ge.maxX&&(Ge.maxX=Ct),kt>Ge.maxY&&(Ge.maxY=kt)}return Ge}function Jr(Ee,te,re,xe){var Ie=te.geometry,Fe=te.type,Ge=[];if(Fe==="Point"||Fe==="MultiPoint")for(var Ve=0;Ve<Ie.length;Ve+=3)Ge.push(Ie[Ve]),Ge.push(Ie[Ve+1]),Ee.numPoints++,Ee.numSimplified++;else if(Fe==="LineString")Wi(Ge,Ie,Ee,re,!1,!1);else if(Fe==="MultiLineString"||Fe==="Polygon")for(Ve=0;Ve<Ie.length;Ve++)Wi(Ge,Ie[Ve],Ee,re,Fe==="Polygon",Ve===0);else if(Fe==="MultiPolygon")for(var ze=0;ze<Ie.length;ze++){var Qe=Ie[ze];for(Ve=0;Ve<Qe.length;Ve++)Wi(Ge,Qe[Ve],Ee,re,!0,Ve===0)}if(Ge.length){var Ct=te.tags||null;if(Fe==="LineString"&&xe.lineMetrics){for(var kt in Ct={},te.tags)Ct[kt]=te.tags[kt];Ct.mapbox_clip_start=Ie.start/Ie.size,Ct.mapbox_clip_end=Ie.end/Ie.size}var wt={geometry:Ge,type:Fe==="Polygon"||Fe==="MultiPolygon"?3:Fe==="LineString"||Fe==="MultiLineString"?2:1,tags:Ct};te.id!==null&&(wt.id=te.id),Ee.features.push(wt)}}function Wi(Ee,te,re,xe,Ie,Fe){var Ge=xe*xe;if(xe>0&&te.size<(Ie?Ge:xe))re.numPoints+=te.length/3;else{for(var Ve=[],ze=0;ze<te.length;ze+=3)(xe===0||te[ze+2]>Ge)&&(re.numSimplified++,Ve.push(te[ze]),Ve.push(te[ze+1])),re.numPoints++;Ie&&function(Qe,Ct){for(var kt=0,wt=0,ar=Qe.length,dr=ar-2;wt<ar;dr=wt,wt+=2)kt+=(Qe[wt]-Qe[dr])*(Qe[wt+1]+Qe[dr+1]);if(kt>0===Ct)for(wt=0,ar=Qe.length;wt<ar/2;wt+=2){var nr=Qe[wt],ir=Qe[wt+1];Qe[wt]=Qe[ar-2-wt],Qe[wt+1]=Qe[ar-1-wt],Qe[ar-2-wt]=nr,Qe[ar-1-wt]=ir}}(Ve,Fe),Ee.push(Ve)}}function wi(Ee,te){var re=(te=this.options=function(Ie,Fe){for(var Ge in Fe)Ie[Ge]=Fe[Ge];return Ie}(Object.create(this.options),te)).debug;if(re&&console.time("preprocess data"),te.maxZoom<0||te.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(te.promoteId&&te.generateId)throw new Error("promoteId and generateId cannot be used together.");var xe=function(Ie,Fe){var Ge=[];if(Ie.type==="FeatureCollection")for(var Ve=0;Ve<Ie.features.length;Ve++)Y(Ge,Ie.features[Ve],Fe,Ve);else Y(Ge,Ie.type==="Feature"?Ie:{geometry:Ie},Fe);return Ge}(Ee,te);this.tiles={},this.tileCoords=[],re&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",te.indexMaxZoom,te.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),xe=function(Ie,Fe){var Ge=Fe.buffer/Fe.extent,Ve=Ie,ze=gt(Ie,1,-1-Ge,Ge,0,-1,2,Fe),Qe=gt(Ie,1,1-Ge,2+Ge,0,-1,2,Fe);return(ze||Qe)&&(Ve=gt(Ie,1,-Ge,1+Ge,0,-1,2,Fe)||[],ze&&(Ve=sr(ze,1).concat(Ve)),Qe&&(Ve=Ve.concat(sr(Qe,-1)))),Ve}(xe,te),xe.length&&this.splitTile(xe,0,0,0),re&&(xe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ti(Ee,te,re){return 32*((1<<Ee)*re+te)+Ee}function xo(Ee,te){const re=Ee.tileID.canonical;if(!this._geoJSONIndex)return te(null,null);const xe=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!xe)return te(null,null);const Ie=new class{constructor(Ge){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=Ge.length,this._features=Ge}feature(Ge){return new class{constructor(Ve){this._feature=Ve,this.extent=a.EXTENT,this.type=Ve.type,this.properties=Ve.tags,"id"in Ve&&!isNaN(Ve.id)&&(this.id=parseInt(Ve.id,10))}loadGeometry(){if(this._feature.type===1){const Ve=[];for(const ze of this._feature.geometry)Ve.push([new a.Point(ze[0],ze[1])]);return Ve}{const Ve=[];for(const ze of this._feature.geometry){const Qe=[];for(const Ct of ze)Qe.push(new a.Point(Ct[0],Ct[1]));Ve.push(Qe)}return Ve}}toGeoJSON(Ve,ze,Qe){return W.call(this,Ve,ze,Qe)}}(this._features[Ge])}}(xe.features);let Fe=ct(Ie);Fe.byteOffset===0&&Fe.byteLength===Fe.buffer.byteLength||(Fe=new Uint8Array(Fe)),te(null,{vectorTile:Ie,rawData:Fe.buffer})}wi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},wi.prototype.splitTile=function(Ee,te,re,xe,Ie,Fe,Ge){for(var Ve=[Ee,te,re,xe],ze=this.options,Qe=ze.debug;Ve.length;){xe=Ve.pop(),re=Ve.pop(),te=Ve.pop(),Ee=Ve.pop();var Ct=1<<te,kt=ti(te,re,xe),wt=this.tiles[kt];if(!wt&&(Qe>1&&console.time("creation"),wt=this.tiles[kt]=qi(Ee,te,re,xe,ze),this.tileCoords.push({z:te,x:re,y:xe}),Qe)){Qe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",te,re,xe,wt.numFeatures,wt.numPoints,wt.numSimplified),console.timeEnd("creation"));var ar="z"+te;this.stats[ar]=(this.stats[ar]||0)+1,this.total++}if(wt.source=Ee,Ie){if(te===ze.maxZoom||te===Ie)continue;var dr=1<<Ie-te;if(re!==Math.floor(Fe/dr)||xe!==Math.floor(Ge/dr))continue}else if(te===ze.indexMaxZoom||wt.numPoints<=ze.indexMaxPoints)continue;if(wt.source=null,Ee.length!==0){Qe>1&&console.time("clipping");var nr,ir,br,an,In,hi,Rn=.5*ze.buffer/ze.extent,ri=.5-Rn,ni=.5+Rn,Ei=1+Rn;nr=ir=br=an=null,In=gt(Ee,Ct,re-Rn,re+ni,0,wt.minX,wt.maxX,ze),hi=gt(Ee,Ct,re+ri,re+Ei,0,wt.minX,wt.maxX,ze),Ee=null,In&&(nr=gt(In,Ct,xe-Rn,xe+ni,1,wt.minY,wt.maxY,ze),ir=gt(In,Ct,xe+ri,xe+Ei,1,wt.minY,wt.maxY,ze),In=null),hi&&(br=gt(hi,Ct,xe-Rn,xe+ni,1,wt.minY,wt.maxY,ze),an=gt(hi,Ct,xe+ri,xe+Ei,1,wt.minY,wt.maxY,ze),hi=null),Qe>1&&console.timeEnd("clipping"),Ve.push(nr||[],te+1,2*re,2*xe),Ve.push(ir||[],te+1,2*re,2*xe+1),Ve.push(br||[],te+1,2*re+1,2*xe),Ve.push(an||[],te+1,2*re+1,2*xe+1)}}},wi.prototype.getTile=function(Ee,te,re){var xe=this.options,Ie=xe.extent,Fe=xe.debug;if(Ee<0||Ee>24)return null;var Ge=1<<Ee,Ve=ti(Ee,te=(te%Ge+Ge)%Ge,re);if(this.tiles[Ve])return Dn(this.tiles[Ve],Ie);Fe>1&&console.log("drilling down to z%d-%d-%d",Ee,te,re);for(var ze,Qe=Ee,Ct=te,kt=re;!ze&&Qe>0;)Qe--,Ct=Math.floor(Ct/2),kt=Math.floor(kt/2),ze=this.tiles[ti(Qe,Ct,kt)];return ze&&ze.source?(Fe>1&&console.log("found parent tile z%d-%d-%d",Qe,Ct,kt),Fe>1&&console.time("drilling down"),this.splitTile(ze.source,Qe,Ct,kt,Ee,te,re),Fe>1&&console.timeEnd("drilling down"),this.tiles[Ve]?Dn(this.tiles[Ve],Ie):null):null};class vs extends a.VectorTileWorkerSource{constructor(te,re,xe,Ie,Fe){super(te,re,xe,Ie,xo),Fe&&(this.loadGeoJSON=Fe)}loadData(te,re){const xe=te&&te.request,Ie=xe&&xe.collectResourceTiming;this.loadGeoJSON(te,(Fe,Ge)=>{if(Fe||!Ge)return re(Fe);if(typeof Ge!="object")return re(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));{j(Ge,!0);try{if(te.filter){const ze=a.createExpression(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ze.result==="error")throw new Error(ze.value.map(Ct=>`${Ct.key}: ${Ct.message}`).join(", "));Ge={type:"FeatureCollection",features:Ge.features.filter(Ct=>ze.value.evaluate({zoom:0},Ct))}}this._geoJSONIndex=te.cluster?new lt(function({superclusterOptions:ze,clusterProperties:Qe}){if(!Qe||!ze)return ze;const Ct={},kt={},wt={accumulated:null,zoom:0},ar={properties:null},dr=Object.keys(Qe);for(const nr of dr){const[ir,br]=Qe[nr],an=a.createExpression(br),In=a.createExpression(typeof ir=="string"?[ir,["accumulated"],["get",nr]]:ir);Ct[nr]=an.value,kt[nr]=In.value}return ze.map=nr=>{ar.properties=nr;const ir={};for(const br of dr)ir[br]=Ct[br].evaluate(wt,ar);return ir},ze.reduce=(nr,ir)=>{ar.properties=ir;for(const br of dr)wt.accumulated=nr[br],nr[br]=kt[br].evaluate(wt,ar)},ze}(te)).load(Ge.features):function(ze,Qe){return new wi(ze,Qe)}(Ge,te.geojsonVtOptions)}catch(ze){return re(ze)}this.loaded={};const Ve={};if(Ie){const ze=a.getPerformanceMeasurement(xe);ze&&(Ve.resourceTiming={},Ve.resourceTiming[te.source]=JSON.parse(JSON.stringify(ze)))}re(null,Ve)}})}reloadTile(te,re){const xe=this.loaded;return xe&&xe[te.uid]?super.reloadTile(te,re):this.loadTile(te,re)}loadGeoJSON(te,re){if(te.request)a.getJSON(te.request,re);else{if(typeof te.data!="string")return re(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));try{return re(null,JSON.parse(te.data))}catch{return re(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(te,re){try{re(null,this._geoJSONIndex.getClusterExpansionZoom(te.clusterId))}catch(xe){re(xe)}}getClusterChildren(te,re){try{re(null,this._geoJSONIndex.getChildren(te.clusterId))}catch(xe){re(xe)}}getClusterLeaves(te,re){try{re(null,this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset))}catch(xe){re(xe)}}}class eo{constructor(te){this.self=te,this.actor=new a.Actor(te,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.getProjection({name:"mercator"}),this.workerSourceTypes={vector:a.VectorTileWorkerSource,geojson:vs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(re,xe)=>{if(this.workerSourceTypes[re])throw new Error(`Worker source with name "${re}" already registered.`);this.workerSourceTypes[re]=xe},this.self.registerRTLTextPlugin=re=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=re.applyArabicShaping,a.plugin.processBidirectionalText=re.processBidirectionalText,a.plugin.processStyledBidirectionalText=re.processStyledBidirectionalText}}clearCaches(te,re,xe){delete this.layerIndexes[te],delete this.availableImages[te],delete this.workerSources[te],delete this.demWorkerSources[te],xe()}checkIfReady(te,re,xe){xe()}setReferrer(te,re){this.referrer=re}spriteLoaded(te,re){this.isSpriteLoaded[te]=re;for(const xe in this.workerSources[te]){const Ie=this.workerSources[te][xe];for(const Fe in Ie)Ie[Fe]instanceof a.VectorTileWorkerSource&&(Ie[Fe].isSpriteLoaded=re,Ie[Fe].fire(new a.Event("isSpriteLoaded")))}}setImages(te,re,xe){this.availableImages[te]=re;for(const Ie in this.workerSources[te]){const Fe=this.workerSources[te][Ie];for(const Ge in Fe)Fe[Ge].availableImages=re}xe()}enableTerrain(te,re,xe){this.terrain=re,xe()}setProjection(te,re){this.projections[te]=a.getProjection(re)}setLayers(te,re,xe){this.getLayerIndex(te).replace(re),xe()}updateLayers(te,re,xe){this.getLayerIndex(te).update(re.layers,re.removedIds),xe()}loadTile(te,re,xe){const Ie=this.enableTerrain?a.extend({enableTerrain:this.terrain},re):re;Ie.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,re.type,re.source).loadTile(Ie,xe)}loadDEMTile(te,re,xe){const Ie=this.enableTerrain?a.extend({buildQuadTree:this.terrain},re):re;this.getDEMWorkerSource(te,re.source).loadTile(Ie,xe)}reloadTile(te,re,xe){const Ie=this.enableTerrain?a.extend({enableTerrain:this.terrain},re):re;Ie.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,re.type,re.source).reloadTile(Ie,xe)}abortTile(te,re,xe){this.getWorkerSource(te,re.type,re.source).abortTile(re,xe)}removeTile(te,re,xe){this.getWorkerSource(te,re.type,re.source).removeTile(re,xe)}removeSource(te,re,xe){if(!this.workerSources[te]||!this.workerSources[te][re.type]||!this.workerSources[te][re.type][re.source])return;const Ie=this.workerSources[te][re.type][re.source];delete this.workerSources[te][re.type][re.source],Ie.removeSource!==void 0?Ie.removeSource(re,xe):xe()}loadWorkerSource(te,re,xe){try{this.self.importScripts(re.url),xe()}catch(Ie){xe(Ie.toString())}}syncRTLPluginState(te,re,xe){try{a.plugin.setState(re);const Ie=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&Ie!=null){this.self.importScripts(Ie);const Fe=a.plugin.isParsed();xe(Fe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ie}`),Fe)}}catch(Ie){xe(Ie.toString())}}getAvailableImages(te){let re=this.availableImages[te];return re||(re=[]),re}getLayerIndex(te){let re=this.layerIndexes[te];return re||(re=this.layerIndexes[te]=new R),re}getWorkerSource(te,re,xe){if(this.workerSources[te]||(this.workerSources[te]={}),this.workerSources[te][re]||(this.workerSources[te][re]={}),!this.workerSources[te][re][xe]){const Ie={send:(Fe,Ge,Ve,ze,Qe,Ct)=>{this.actor.send(Fe,Ge,Ve,te,Qe,Ct)},scheduler:this.actor.scheduler};this.workerSources[te][re][xe]=new this.workerSourceTypes[re](Ie,this.getLayerIndex(te),this.getAvailableImages(te),this.isSpriteLoaded[te])}return this.workerSources[te][re][xe]}getDEMWorkerSource(te,re){return this.demWorkerSources[te]||(this.demWorkerSources[te]={}),this.demWorkerSources[te][re]||(this.demWorkerSources[te][re]=new I),this.demWorkerSources[te][re]}enforceCacheSizeLimit(te,re){a.enforceCacheSizeLimit(re)}getWorkerPerformanceMetrics(te,re,xe){xe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new eo(self)),eo}),_(["./shared"],function(a){function S(p,s){if(Array.isArray(p)){if(!Array.isArray(s)||p.length!==s.length)return!1;for(let h=0;h<p.length;h++)if(!S(p[h],s[h]))return!1;return!0}if(typeof p=="object"&&p!==null&&s!==null){if(typeof s!="object"||Object.keys(p).length!==Object.keys(s).length)return!1;for(const h in p)if(!S(p[h],s[h]))return!1;return!0}return p===s}var D=R;function R(p){return!function(s){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,v,b=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(b);try{v=new Worker(A),g=!0}catch{g=!1}return v&&v.terminate(),URL.revokeObjectURL(A),g}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var g=document.createElement("canvas");g.width=g.height=1;var v=g.getContext("2d");if(!v)return!1;var b=v.getImageData(0,0,1,1);return b&&b.width===g.width}()?(I[h=s&&s.failIfMajorPerformanceCaveat]===void 0&&(I[h]=function(g){var v,b=function(A){var C=document.createElement("canvas"),L=Object.create(R.webGLContextAttributes);return L.failIfMajorPerformanceCaveat=A,C.getContext("webgl",L)||C.getContext("experimental-webgl",L)}(g);if(!b)return!1;try{v=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!v||b.isContextLost())&&(b.shaderSource(v,"void main() {}"),b.compileShader(v),b.getShaderParameter(v,b.COMPILE_STATUS)===!0)}(h)),I[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var h}(p)}var I={};function M(p,s,h){const g=a.window.document.createElement(p);return s!==void 0&&(g.className=s),h&&h.appendChild(g),g}function N(p,s,h){const g=a.window.document.createElementNS("http://www.w3.org/2000/svg",p);for(const v of Object.keys(s))g.setAttributeNS(null,v,s[v]);return h&&h.appendChild(g),g}R.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const j=a.window.document&&a.window.document.documentElement.style,W=j&&j.userSelect!==void 0?"userSelect":"WebkitUserSelect";let B;function k(){j&&W&&(B=j[W],j[W]="none")}function z(){j&&W&&(j[W]=B)}function Z(p){p.preventDefault(),p.stopPropagation(),a.window.removeEventListener("click",Z,!0)}function ee(){a.window.addEventListener("click",Z,!0),a.window.setTimeout(()=>{a.window.removeEventListener("click",Z,!0)},0)}function se(p,s){const h=p.getBoundingClientRect();return Q(p,h,s)}function ue(p,s){const h=p.getBoundingClientRect(),g=[];for(let v=0;v<s.length;v++)g.push(Q(p,h,s[v]));return g}function Te(p){return a.window.InstallTrigger!==void 0&&p.button===2&&p.ctrlKey&&a.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function Q(p,s,h){const g=p.offsetWidth===s.width?1:p.offsetWidth/s.width;return new a.Point((h.clientX-s.left)*g,(h.clientY-s.top)*g)}function he(p,s){var h=s[0],g=s[1],v=s[2],b=s[3],A=h*b-v*g;return A?(p[0]=b*(A=1/A),p[1]=-g*A,p[2]=-v*A,p[3]=h*A,p):null}function ye(p){const{userImage:s}=p;return!!(s&&s.render&&s.render())&&(p.data.replace(new Uint8Array(s.data.buffer)),!0)}class J extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:h,callback:g}of this.requestors)this._notify(h,g);this.requestors=[]}}hasImage(s){return!!this.getImage(s)}getImage(s){return this.images[s]}addImage(s,h){this._validate(s,h)&&(this.images[s]=h)}_validate(s,h){let g=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${s}" has invalid "stretchX" value`))),g=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${s}" has invalid "stretchY" value`))),g=!1),this._validateContent(h.content,h)||(this.fire(new a.ErrorEvent(new Error(`Image "${s}" has invalid "content" value`))),g=!1),g}_validateStretch(s,h){if(!s)return!0;let g=0;for(const v of s){if(v[0]<g||v[1]<v[0]||h<v[1])return!1;g=v[1]}return!0}_validateContent(s,h){return!(s&&(s.length!==4||s[0]<0||h.data.width<s[0]||s[1]<0||h.data.height<s[1]||s[2]<0||h.data.width<s[2]||s[3]<0||h.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,h){h.version=this.images[s].version+1,this.images[s]=h,this.updatedImages[s]=!0}removeImage(s){const h=this.images[s];delete this.images[s],delete this.patterns[s],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s,h){let g=!0;if(!this.isLoaded())for(const v of s)this.images[v]||(g=!1);this.isLoaded()||g?this._notify(s,h):this.requestors.push({ids:s,callback:h})}_notify(s,h){const g={};for(const v of s){this.images[v]||this.fire(new a.Event("styleimagemissing",{id:v}));const b=this.images[v];b?g[v]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:a.warnOnce(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,g)}getPixelSize(){const{width:s,height:h}=this.atlasImage;return{width:s,height:h}}getPattern(s){const h=this.patterns[s],g=this.getImage(s);if(!g)return null;if(h&&h.position.version===g.version)return h.position;if(h)h.position.version=g.version;else{const v={w:g.data.width+2,h:g.data.height+2,x:0,y:0},b=new a.ImagePosition(v,g);this.patterns[s]={bin:v,position:b}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const h=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.Texture(s,this.atlasImage,h.RGBA),this.atlasTexture&&this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const b in this.patterns)s.push(this.patterns[b].bin);const{w:h,h:g}=a.potpack(s),v=this.atlasImage;v.resize({width:h||1,height:g||1});for(const b in this.patterns){const{bin:A}=this.patterns[b],C=A.x+1,L=A.y+1,$=this.images[b].data,U=$.width,H=$.height;a.RGBAImage.copy($,v,{x:0,y:0},{x:C,y:L},{width:U,height:H}),a.RGBAImage.copy($,v,{x:0,y:H-1},{x:C,y:L-1},{width:U,height:1}),a.RGBAImage.copy($,v,{x:0,y:0},{x:C,y:L+H},{width:U,height:1}),a.RGBAImage.copy($,v,{x:U-1,y:0},{x:C-1,y:L},{width:1,height:H}),a.RGBAImage.copy($,v,{x:0,y:0},{x:C+U,y:L},{width:1,height:H})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const h of s){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const g=this.images[h];ye(g)&&this.updateImage(h,g)}}}const ie=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(p,s){return function([h,g,v]){const b=a.degToRad(g+90),A=a.degToRad(v);return{x:h*Math.cos(b)*Math.sin(A),y:h*Math.sin(b)*Math.sin(A),z:h*Math.cos(A),azimuthal:g,polar:v}}(p.expression.evaluate(s))}interpolate(p,s,h){return{x:a.number(p.x,s.x,h),y:a.number(p.y,s.y,h),z:a.number(p.z,s.z,h),azimuthal:a.number(p.azimuthal,s.azimuthal,h),polar:a.number(p.polar,s.polar,h)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)});class q extends a.Evented{constructor(s){super(),this._transitionable=new a.Transitionable(ie),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,h={}){if(!this._validate(a.validateLight,s,h))for(const g in s){const v=s[g];a.endsWith(g,"-transition")?this._transitionable.setTransition(g.slice(0,-11),v):this._transitionable.setValue(g,v)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,g){return(!g||g.validate!==!1)&&a.emitValidationErrors(this,s.call(a.validateStyle,a.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}const Ke=new a.Properties({source:new a.DataConstantProperty(a.spec.terrain.source),exaggeration:new a.DataConstantProperty(a.spec.terrain.exaggeration)});let Mt=class extends a.Evented{constructor(p,s){super(),this._transitionable=new a.Transitionable(Ke),this.set(p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(p){for(const s in p){const h=p[s];a.endsWith(s,"-transition")?this._transitionable.setTransition(s.slice(0,-11),h):this._transitionable.setValue(s,h)}}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}};function ct(p,s,h,g){const v=a.smoothstep(45,65,h),[b,A]=He(p,g),C=a.length(s);let L=1-Math.min(1,Math.exp((C-b)/(A-b)*-6));return L*=L*L,L=Math.min(1,1.00747*L),L*v*p.alpha}function He(p,s){const h=.5/Math.tan(.5*s);return[p.range[0]+h,p.range[1]+h]}const _e=new a.Properties({range:new a.DataConstantProperty(a.spec.fog.range),color:new a.DataConstantProperty(a.spec.fog.color),"high-color":new a.DataConstantProperty(a.spec.fog["high-color"]),"space-color":new a.DataConstantProperty(a.spec.fog["space-color"]),"horizon-blend":new a.DataConstantProperty(a.spec.fog["horizon-blend"]),"star-intensity":new a.DataConstantProperty(a.spec.fog["star-intensity"])});class qe extends a.Evented{constructor(s,h){super(),this._transitionable=new a.Transitionable(_e),this.set(s),this._transitioning=this._transitionable.untransitioned(),this._transform=h}get state(){const s=this._transform,h=s.projection.name==="globe",g=a.globeToMercatorTransition(s.zoom),v=this.properties.get("range"),b=[.5,3];return{range:h?[a.number(b[0],v[0],g),a.number(b[1],v[1],g)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,h={}){if(!this._validate(a.validateFog,s,h)){for(const g of Object.keys(a.spec.fog))s&&s[g]===void 0&&(s[g]=a.spec.fog[g].default);for(const g in s){const v=s[g];a.endsWith(g,"-transition")?this._transitionable.setTransition(g.slice(0,-11),v):this._transitionable.setValue(g,v)}}}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.smoothstep(45,65,s))*h.a}getOpacityAtLatLng(s,h){return this._transform.projection.supportsFog?function(g,v,b){const A=a.MercatorCoordinate.fromLngLat(v),C=b.elevation?b.elevation.getAtPointOrZero(A):0,L=[A.x,A.y,C];return a.transformMat4(L,L,b.mercatorFogMatrix),ct(g,L,b.pitch,b._fov)}(this.state,s,h):0}getFovAdjustedRange(s){return this._transform.projection.supportsFog?He(this.state,s):[0,1]}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,g){return(!g||g.validate!==!1)&&a.emitValidationErrors(this,s.call(a.validateStyle,a.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class Pe{constructor(s,h){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const g=this.workerPool.acquire(this.id);for(let v=0;v<g.length;v++){const b=new Pe.Actor(g[v],h,this.id);b.name=`Worker ${v}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(s,h,g){a.asyncAll(this.actors,(v,b)=>{v.send(s,h,b)},g=g||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(s=>{s.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Le(p,s,h){return s*(a.EXTENT/(p.tileSize*Math.pow(2,h-p.tileID.overscaledZ)))}Pe.Actor=a.Actor;class Pt{constructor(s,h,g,v){this.screenBounds=s,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(s,h){let g,v;if(s instanceof a.Point||typeof s[0]=="number"){const b=a.Point.convert(s);g=[b],v=h.isPointAboveHorizon(b)}else{const b=a.Point.convert(s[0]),A=a.Point.convert(s[1]);g=[b,A],v=a.polygonizeBounds(b,A).every(C=>h.isPointAboveHorizon(C))}return new Pt(g,h.getCameraPoint(),v,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(s){return a.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){const h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new a.Point(1,1)):this.screenBounds[1],v=a.polygonizeBounds(h,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<g.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?v[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(v[3]=this.cameraPoint)),a.bufferConvexPolygon(v,s)}bufferedCameraGeometryGlobe(s){const h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new a.Point(1,1)):this.screenBounds[1],v=a.polygonizeBounds(h,g,s),b=this.cameraPoint.clone();switch(3*((b.y>h.y)+(b.y>g.y))+((b.x>h.x)+(b.x>g.x))){case 0:v[0]=b,v[4]=b.clone();break;case 1:v.splice(1,0,b);break;case 2:v[1]=b;break;case 3:v.splice(4,0,b);break;case 5:v.splice(2,0,b);break;case 6:v[3]=b;break;case 7:v.splice(3,0,b);break;case 8:v[2]=b}return v}containsTile(s,h,g,v=0){const b=s.queryPadding/h._pixelsPerMercatorPixel+1,A=g?this._bufferedCameraMercator(b,h):this._bufferedScreenMercator(b,h);let C=s.tileID.wrap+(A.unwrapped?v:0);const L=A.polygon.map(de=>a.getTilePoint(s.tileTransform,de,C));if(!a.polygonIntersectsBox(L,0,0,a.EXTENT,a.EXTENT))return;C=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const $=this.screenGeometryMercator.polygon.map(de=>a.getTileVec3(s.tileTransform,de,C)),U=$.map(de=>new a.Point(de[0],de[1])),H=h.getFreeCameraOptions().position||new a.MercatorCoordinate(0,0,0),ne=a.getTileVec3(s.tileTransform,H,C),le=$.map(de=>{const X=a.sub(de,de,ne);return a.normalize(X,X),new a.Ray(ne,X)}),fe=Le(s,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:U,tilespaceRays:le,bufferedTilespaceGeometry:L,bufferedTilespaceBounds:(ce=a.getBounds(L),ce.min.x=a.clamp(ce.min.x,0,a.EXTENT),ce.min.y=a.clamp(ce.min.y,0,a.EXTENT),ce.max.x=a.clamp(ce.max.x,0,a.EXTENT),ce.max.y=a.clamp(ce.max.y,0,a.EXTENT),ce),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:fe};var ce}_bufferedScreenMercator(s,h){const g=Jt(s);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(s),h):{polygon:this.bufferedScreenGeometry(s).map(b=>h.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[g]=v,v}}_bufferedCameraMercator(s,h){const g=Jt(s);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),h):{polygon:this.bufferedCameraGeometry(s).map(b=>h.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[g]=v,v}}_projectAndResample(s,h){const g=function(b,A){const C=a.multiply([],A.pixelMatrix,A.globeMatrix),L=[0,-a.GLOBE_RADIUS,0,1],$=[0,a.GLOBE_RADIUS,0,1],U=[0,0,0,1];a.transformMat4$1(L,L,C),a.transformMat4$1($,$,C),a.transformMat4$1(U,U,C);const H=new a.Point(L[0]/L[3],L[1]/L[3]),ne=new a.Point($[0]/$[3],$[1]/$[3]),le=a.polygonContainsPoint(b,H)&&L[3]<U[3],fe=a.polygonContainsPoint(b,ne)&&$[3]<U[3];if(!le&&!fe)return null;const ce=function(De,Ue,Ne){for(let Ye=1;Ye<De.length;Ye++){const vt=at(Ue.pointCoordinate3D(De[Ye-1]).x),We=at(Ue.pointCoordinate3D(De[Ye]).x);if(Ne<0){if(vt<We)return{idx:Ye,t:-vt/(We-1-vt)}}else if(We<vt)return{idx:Ye,t:(1-vt)/(We+1-vt)}}return null}(b,A,le?-1:1);if(!ce)return null;const{idx:de,t:X}=ce;let ae=de>1?lt(b.slice(0,de),A):[],ge=de<b.length?lt(b.slice(de),A):[];ae=ae.map(De=>new a.Point(at(De.x),De.y)),ge=ge.map(De=>new a.Point(at(De.x),De.y));const be=[...ae];be.length===0&&be.push(ge[ge.length-1]);const Oe=a.number(be[be.length-1].y,(ge.length===0?ae[0]:ge[0]).y,X);let Re;return Re=le?[new a.Point(0,Oe),new a.Point(0,0),new a.Point(1,0),new a.Point(1,Oe)]:[new a.Point(1,Oe),new a.Point(1,1),new a.Point(0,1),new a.Point(0,Oe)],be.push(...Re),ge.length===0?be.push(ae[0]):be.push(...ge),{polygon:be.map(De=>new a.MercatorCoordinate(De.x,De.y)),unwrapped:!1}}(s,h);if(g)return g;const v=function(b,A){let C=!1,L=-1/0,$=0;for(let H=0;H<b.length-1;H++)b[H].x>L&&(L=b[H].x,$=H);for(let H=0;H<b.length-1;H++){const ne=($+H)%(b.length-1),le=b[ne],fe=b[ne+1];Math.abs(le.x-fe.x)>.5&&(le.x<fe.x?(le.x+=1,ne===0&&(b[b.length-1].x+=1)):(fe.x+=1,ne+1===b.length-1&&(b[0].x+=1)),C=!0)}const U=a.mercatorXfromLng(A.center.lng);return C&&U<Math.abs(U-1)&&b.forEach(H=>{H.x-=1}),{polygon:b,unwrapped:C}}(lt(s,h).map(b=>new a.Point(at(b.x),b.y)),h);return{polygon:v.polygon.map(b=>new a.MercatorCoordinate(b.x,b.y)),unwrapped:v.unwrapped}}}function lt(p,s){return a.resample(p,h=>{const g=s.pointCoordinate3D(h);h.x=g.x,h.y=g.y},1/256)}function at(p){return p<0?1+p%1:p%1}function Jt(p){return 100*p|0}function Er(p,s,h,g,v){const b=function(A,C){if(A)return v(A);if(C){p.url&&C.tiles&&p.tiles&&delete p.tiles;const L=a.pick(a.extend(C,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(L.vectorLayers=C.vector_layers,L.vectorLayerIds=L.vectorLayers.map($=>$.id)),L.tiles=s.canonicalizeTileset(L,p.url),v(null,L)}};return p.url?a.getJSON(s.transformRequest(s.normalizeSourceURL(p.url,null,h,g),a.ResourceType.Source),b):a.exported.frame(()=>b(null,p))}class Kt{constructor(s,h,g){this.bounds=a.LngLatBounds.convert(this.validateBounds(s)),this.minzoom=h||0,this.maxzoom=g||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const h=Math.pow(2,s.z),g=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*h),v=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*h),b=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*h),A=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*h);return s.x>=g&&s.x<b&&s.y>=v&&s.y<A}}class xr{constructor(s,h,g){this.context=s;const v=s.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ir={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class jr{constructor(s,h,g,v){this.length=h.length,this.attributes=g,this.itemSize=h.bytesPerElement,this.dynamicDraw=v,this.context=s;const b=s.gl;this.buffer=b.createBuffer(),s.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,h){for(let g=0;g<this.attributes.length;g++){const v=h.attributes[this.attributes[g].name];v!==void 0&&s.enableVertexAttribArray(v)}}setVertexAttribPointers(s,h,g){for(let v=0;v<this.attributes.length;v++){const b=this.attributes[v],A=h.attributes[b.name];A!==void 0&&s.vertexAttribPointer(A,b.components,s[Ir[b.type]],!1,this.itemSize,b.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class tr{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class jn extends tr{getDefault(){return a.Color.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Y extends tr{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class mt extends tr{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class et extends tr{getDefault(){return[!0,!0,!0,!0]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Ce extends tr{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class we extends tr{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class $e extends tr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const h=this.current;(s.func!==h.func||s.ref!==h.ref||s.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class gt extends tr{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class St extends tr{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=s,this.dirty=!1}}class tt extends tr{getDefault(){return[0,1]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class Lt extends tr{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=s,this.dirty=!1}}class $t extends tr{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Ot extends tr{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.BLEND):h.disable(h.BLEND),this.current=s,this.dirty=!1}}class Qt extends tr{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class Mr extends tr{getDefault(){return a.Color.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class sr extends tr{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class vn extends tr{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=s,this.dirty=!1}}class Dn extends tr{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class Vn extends tr{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}let qi,Jr=class extends tr{getDefault(){return null}set(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)}};class Wi extends tr{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class wi extends tr{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class ti extends tr{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class xo extends tr{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class vs extends tr{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class eo extends tr{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Ee extends tr{getDefault(){return null}set(s){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class te extends tr{constructor(s){super(s),this.vao=s.extVertexArrayObject}getDefault(){return null}set(s){this.vao&&(s!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(s),this.current=s,this.dirty=!1)}}class re extends tr{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class xe extends tr{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class Ie extends tr{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class Fe extends tr{constructor(s,h){super(s),this.context=s,this.parent=h}getDefault(){return null}}class Ge extends Fe{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Ve extends Fe{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class ze extends Ve{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Qe{constructor(s,h,g,v){this.context=s,this.width=h,this.height=g;const b=this.framebuffer=s.gl.createFramebuffer();this.colorAttachment=new Ge(s,b),v&&(this.depthAttachment=new Ve(s,b))}destroy(){const s=this.context.gl,h=this.colorAttachment.get();if(h&&s.deleteTexture(h),this.depthAttachment){const g=this.depthAttachment.get();g&&s.deleteRenderbuffer(g)}s.deleteFramebuffer(this.framebuffer)}}class Ct{constructor(s,h=!1){if(this.gl=s,this.isWebGL2=h,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),h){const g=s;this.extVertexArrayObject={createVertexArrayOES:g.createVertexArray.bind(s),deleteVertexArrayOES:g.deleteVertexArray.bind(s),bindVertexArrayOES:g.bindVertexArray.bind(s)}}this.clearColor=new jn(this),this.clearDepth=new Y(this),this.clearStencil=new mt(this),this.colorMask=new et(this),this.depthMask=new Ce(this),this.stencilMask=new we(this),this.stencilFunc=new $e(this),this.stencilOp=new gt(this),this.stencilTest=new St(this),this.depthRange=new tt(this),this.depthTest=new Lt(this),this.depthFunc=new $t(this),this.blend=new Ot(this),this.blendFunc=new Qt(this),this.blendColor=new Mr(this),this.blendEquation=new sr(this),this.cullFace=new vn(this),this.cullFaceSide=new Dn(this),this.frontFace=new Vn(this),this.program=new Jr(this),this.activeTexture=new Wi(this),this.viewport=new wi(this),this.bindFramebuffer=new ti(this),this.bindRenderbuffer=new xo(this),this.bindTexture=new vs(this),this.bindVertexBuffer=new eo(this),this.bindElementBuffer=new Ee(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new te(this),this.pixelStoreUnpack=new re(this),this.pixelStoreUnpackPremultiplyAlpha=new xe(this),this.pixelStoreUnpackFlipY=new Ie(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),h||(this.extTextureHalfFloat=s.getExtension("OES_texture_half_float")),(h||this.extTextureHalfFloat&&s.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=h||s.getExtension("OES_standard_derivatives"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,h){return new xr(this,s,h)}createVertexBuffer(s,h,g){return new jr(this,s,h,g)}createRenderbuffer(s,h,g){const v=this.gl,b=v.createRenderbuffer();return this.bindRenderbuffer.set(b),v.renderbufferStorage(v.RENDERBUFFER,s,h,g),this.bindRenderbuffer.set(null),b}createFramebuffer(s,h,g){return new Qe(this,s,h,g)}clear({color:s,depth:h,stencil:g}){const v=this.gl;let b=0;s&&(b|=v.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(b|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),g!==void 0&&(b|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),v.clear(b)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){S(s.blendFunction,a.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class kt extends a.Evented{constructor(s,h,g,v){if(super(),this.id=s,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(h,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new a.DedupedRequest}load(s){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map._worldview;this._tileJSONRequest=Er(this._options,this.map._requestManager,h,g,(v,b)=>{this._tileJSONRequest=null,this._loaded=!0,v?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),g&&g.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new a.ErrorEvent(v))):b&&(a.extend(this,b),b.bounds&&(this.tileBounds=new Kt(b.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(b.tiles,this.map._requestManager._customAccessToken),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))),s&&s(v)})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return a.extend({},this._options)}loadTile(s,h){const g=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme)),v={request:this.map._requestManager.transformRequest(g,a.ResourceType.Tile),data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile};if(v.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired")s.state==="loading"?s.reloadCallback=h:s.request=s.actor.send("reloadTile",v,b.bind(this));else if(s.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",v,b.bind(this),void 0,!0);else{const A=a.loadVectorTile.call({deduped:this._deduped},v,(C,L)=>{C||!L?b.call(this,C):(v.data={cacheControl:L.cacheControl,expires:L.expires,rawData:L.rawData.slice(0)},s.actor&&s.actor.send("loadTile",v,b.bind(this),void 0,!0))},!0);s.request={cancel:A}}function b(A,C){return delete s.request,s.aborted?h(null):A&&A.status!==404?h(A):(C&&C.resourceTiming&&(s.resourceTiming=C.resourceTiming),this.map._refreshExpiredTiles&&C&&s.setExpiryData(C),s.loadVectorData(C,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id})}unloadTile(s){s.unloadVectorData(),s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class wt extends a.Evented{constructor(s,h,g,v){super(),this.id=s,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},h),a.extend(this,a.pick(h,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Er(this._options,this.map._requestManager,null,null,(h,g)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new a.ErrorEvent(h)):g&&(a.extend(this,g),g.bounds&&(this.tileBounds=new Kt(g.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(g.tiles),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))),s&&s(h)})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return a.extend({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,h){const g=a.exported.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);s.request=a.getImage(this.map._requestManager.transformRequest(v,a.ResourceType.Tile),(b,A,C,L)=>(delete s.request,s.aborted?(s.state="unloaded",h(null)):b?(s.state="errored",h(b)):A?(this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:C,expires:L}),s.setTexture(A,this.map.painter),s.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),void h(null)):h(null)))}static loadTileData(s,h,g){s.setTexture(h,g)}static unloadTileData(s,h){s.texture&&h.saveTileTexture(s.texture)}abortTile(s,h){s.request&&(s.request.cancel(),delete s.request),h()}unloadTile(s,h){s.texture&&this.map.painter.saveTileTexture(s.texture),h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function ar(p,s,h,g,v,b,A,C){const L=[p,h,v,s,g,b,1,1,1],$=[A,C,1],U=a.adjoint([],L),[H,ne,le]=a.transformMat3($,$,a.transpose(U,U));return a.multiply$1(L,[H,0,0,0,ne,0,0,0,le],L)}class dr extends a.Evented{constructor(s,h,g,v){super(),this.id=s,this.dispatcher=g,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=h,this._dirty=!1}load(s,h){this._loaded=h||!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(g,v)=>{if(this._imageRequest=null,this._loaded=!0,g)this.fire(new a.ErrorEvent(g));else if(v){const{HTMLImageElement:b}=a.window;this.image=v instanceof b?a.exported.getImageData(v):v,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,s&&(this.coordinates=s),this._finishLoading()}})}loaded(){return this._loaded}updateImage(s){return this.image&&s.url?(this._imageRequest&&s.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=s.url,this.load(s.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(s){this.coordinates=s,this._boundsArray=void 0;const h=s.map(a.MercatorCoordinate.fromLngLat);return this.tileID=function(g){let v=1/0,b=1/0,A=-1/0,C=-1/0;for(const H of g)v=Math.min(v,H.x),b=Math.min(b,H.y),A=Math.max(A,H.x),C=Math.max(C,H.y);const L=Math.max(A-v,C-b),$=Math.max(0,Math.floor(-Math.log(L)/Math.LN2)),U=Math.pow(2,$);return new a.CanonicalTileID($,Math.floor((v+A)/2*U),Math.floor((b+C)/2*U))}(h),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(s){for(const L in this.tiles){const $=this.tiles[L];$.state!=="loaded"&&($.state="loaded",$.texture=this.texture)}if(this._boundsArray)return;const h=a.tileTransform(this.tileID,this.map.transform.projection),[g,v,b,A]=this.coordinates.map(L=>{const $=h.projection.project(L[0],L[1]);return a.getTilePoint(h,$)._round()});this.perspectiveTransform=function(L,$,U,H,ne,le,fe,ce,de,X){const ae=ar(0,0,L,0,0,$,L,$),ge=ar(U,H,ne,le,fe,ce,de,X);return a.multiply$1(ge,a.adjoint(ae,ae),ge),[ge[6]/ge[8]*L/a.EXTENT,ge[7]/ge[8]*$/a.EXTENT]}(this.width,this.height,g.x,g.y,v.x,v.y,A.x,A.y,b.x,b.y);const C=this._boundsArray=new a.StructArrayLayout4i8;C.emplaceBack(g.x,g.y,0,0),C.emplaceBack(v.x,v.y,a.EXTENT,0),C.emplaceBack(A.x,A.y,0,a.EXTENT),C.emplaceBack(b.x,b.y,a.EXTENT,a.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=s.createVertexBuffer(C,a.boundsAttributes.members),this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const s=this.map.painter.context,h=s.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new a.Texture(s,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(s)}loadTile(s,h){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},h(null)):(s.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const nr={vector:kt,raster:wt,"raster-dem":class extends wt{constructor(p,s,h,g){super(p,s,h,g),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(p,s){const h=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(v,b){v&&(p.state="errored",s(v)),b&&(p.dem=b,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",s(null))}p.request=a.getImage(this.map._requestManager.transformRequest(h,a.ResourceType.Tile),(function(v,b,A,C){if(delete p.request,p.aborted)p.state="unloaded",s(null);else if(v)p.state="errored",s(v);else if(b){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:A,expires:C});const L=a.window.ImageBitmap&&b instanceof a.window.ImageBitmap&&(qi==null&&(qi=a.window.OffscreenCanvas&&new a.window.OffscreenCanvas(1,1).getContext("2d")&&typeof a.window.createImageBitmap=="function"),qi),$=1-(b.width-a.prevPowerOfTwo(b.width))/2;$<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const U=L?b:a.exported.getImageData(b,$),H={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:U,encoding:this.encoding,padding:$};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",H,g.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(p){const s=p.canonical,h=Math.pow(2,s.z),g=(s.x-1+h)%h,v=s.x===0?p.wrap-1:p.wrap,b=(s.x+1+h)%h,A=s.x+1===h?p.wrap+1:p.wrap,C={};return C[new a.OverscaledTileID(p.overscaledZ,v,s.z,g,s.y).key]={backfilled:!1},C[new a.OverscaledTileID(p.overscaledZ,A,s.z,b,s.y).key]={backfilled:!1},s.y>0&&(C[new a.OverscaledTileID(p.overscaledZ,v,s.z,g,s.y-1).key]={backfilled:!1},C[new a.OverscaledTileID(p.overscaledZ,p.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},C[new a.OverscaledTileID(p.overscaledZ,A,s.z,b,s.y-1).key]={backfilled:!1}),s.y+1<h&&(C[new a.OverscaledTileID(p.overscaledZ,v,s.z,g,s.y+1).key]={backfilled:!1},C[new a.OverscaledTileID(p.overscaledZ,p.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},C[new a.OverscaledTileID(p.overscaledZ,A,s.z,b,s.y+1).key]={backfilled:!1}),C}unloadTile(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded"}},geojson:class extends a.Evented{constructor(p,s,h,g){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(g),this._data=s.data,this._options=a.extend({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const v=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*v,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*v,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:a.EXTENT,radius:(s.clusterRadius!==void 0?s.clusterRadius:50)*v,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},s),this}getClusterChildren(p,s){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},s),this}getClusterLeaves(p,s,h,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:s,offset:h},g),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.Event("dataloading",{dataType:"source"})),this._loaded=!1;const p=a.extend({},this.workerOptions),s=this._data;typeof s=="string"?(p.request=this.map._requestManager.transformRequest(a.exported.resolveURL(s),a.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(h,g)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new a.ErrorEvent(h));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(v.resourceTiming=g.resourceTiming[this.id]),this.fire(new a.Event("data",v)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,s){const h=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(h,{type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(g,v)=>(delete p.request,p.unloadVectorData(),p.aborted?s(null):g?s(g):(p.loadVectorData(v,this.map.painter,h==="reloadTile"),s(null))),void 0,h==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends dr{constructor(p,s,h,g){super(p,s,h,g),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const s of p.urls)this.urls.push(this.map._requestManager.transformRequest(s,a.ResourceType.Source).url);a.getVideo(this.urls,(s,h)=>{this._loaded=!0,s?this.fire(new a.ErrorEvent(s)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const s=this.video.seekable;p<s.start(0)||p>s.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const p=this.map.painter.context,s=p.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new a.Texture(p,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:dr,canvas:class extends dr{constructor(p,s,h,g){super(p,s,h,g),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(b=>typeof b!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${p}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof a.window.HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${p}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof a.window.HTMLCanvasElement?this.options.canvas:a.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context;this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.Texture(s,this.canvas,s.gl.RGBA,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends a.Evented{constructor(p,s,h,g){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=s,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Kt(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),a.extend(this,a.pick(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this._map=p,this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:s,y:h,z:g}=p.canonical;return this._implementation.hasTile({x:s,y:h,z:g})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,s){const{x:h,y:g,z:v}=p.tileID.canonical,b=new a.window.AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:h,y:g,z:v},{signal:b.signal})).then((function(A){return delete p.request,p.aborted?(p.state="unloaded",s(null)):A===void 0?(p.state="errored",s(null)):A===null?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",s(null)):function(C){return C instanceof a.window.ImageData||C instanceof a.window.HTMLCanvasElement||C instanceof a.window.ImageBitmap||C instanceof a.window.HTMLImageElement}(A)?(this.loadTileData(p,A),p.state="loaded",void s(null)):(p.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(A=>{A.code!==20&&(p.state="errored",s(A))}),p.request.cancel=()=>b.abort()}loadTileData(p,s){wt.loadTileData(p,s,this._map.painter)}unloadTileData(p){wt.unloadTileData(p,this._map.painter)}unloadTile(p,s){if(this.unloadTileData(p),this._implementation.unloadTile){const{x:h,y:g,z:v}=p.tileID.canonical;this._implementation.unloadTile({x:h,y:g,z:v})}s()}abortTile(p,s){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),s()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}}},ir=function(p,s,h,g){const v=new nr[s.type](p,s,h,g);if(v.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${v.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],v),v};function br(p,s){const h=a.identity([]);return a.scale(h,h,[.5*p.width,.5*-p.height,1]),a.translate(h,h,[1,-1,0]),a.multiply(h,h,p.calculateProjMatrix(s.toUnwrapped())),Float32Array.from(h)}function an(p,s,h,g,v,b,A,C=!1){const L=p.tilesIn(g,A,C);L.sort(hi);const $=[];for(const H of L)$.push({wrappedTileID:H.tile.tileID.wrapped().key,queryResults:H.tile.queryRenderedFeatures(s,h,p._state,H,v,b,br(p.transform,H.tile.tileID),C)});const U=function(H){const ne={},le={};for(const fe of H){const ce=fe.queryResults,de=fe.wrappedTileID,X=le[de]=le[de]||{};for(const ae in ce){const ge=ce[ae],be=X[ae]=X[ae]||{},Oe=ne[ae]=ne[ae]||[];for(const Re of ge)be[Re.featureIndex]||(be[Re.featureIndex]=!0,Oe.push(Re))}}return ne}($);for(const H in U)U[H].forEach(ne=>{const le=ne.feature,fe=le.layer;fe&&fe.type!=="background"&&fe.type!=="sky"&&(le.source=fe.source,fe["source-layer"]&&(le.sourceLayer=fe["source-layer"]),le.state=le.id!==void 0?p.getFeatureState(fe["source-layer"],le.id):{})});return U}function In(p,s){const h=p.getRenderableIds().map(b=>p.getTileByID(b)),g=[],v={};for(let b=0;b<h.length;b++){const A=h[b],C=A.tileID.canonical.key;v[C]||(v[C]=!0,A.querySourceFeatures(g,s))}return g}function hi(p,s){const h=p.tileID,g=s.tileID;return h.overscaledZ-g.overscaledZ||h.canonical.y-g.canonical.y||h.wrap-g.wrap||h.canonical.x-g.canonical.x}function Rn(){return Hl.workerClass!=null?new Hl.workerClass:new a.window.Worker(Hl.workerUrl)}const ri="mapboxgl_preloaded_worker_pool";class ni{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<ni.workerCount;)this.workers.push(new Rn);return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ri]}numActive(){return Object.keys(this.active).length}}let Ei;function ga(){return Ei||(Ei=new ni),Ei}function ad(p,s){const h={};for(const g in p)g!=="ref"&&(h[g]=p[g]);return a.refProperties.forEach(g=>{g in s&&(h[g]=s[g])}),h}function eh(p){p=p.slice();const s=Object.create(null);for(let h=0;h<p.length;h++)s[p[h].id]=p[h];for(let h=0;h<p.length;h++)"ref"in p[h]&&(p[h]=ad(p[h],s[p[h].ref]));return p}ni.workerCount=2;const wr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Uu(p,s,h){h.push({command:wr.addSource,args:[p,s[p]]})}function Za(p,s,h){s.push({command:wr.removeSource,args:[p]}),h[p]=!0}function $u(p,s,h,g){Za(p,h,g),Uu(p,s,h)}function Dl(p,s,h){let g;for(g in p[h])if(p[h].hasOwnProperty(g)&&g!=="data"&&!S(p[h][g],s[h][g]))return!1;for(g in s[h])if(s[h].hasOwnProperty(g)&&g!=="data"&&!S(p[h][g],s[h][g]))return!1;return!0}function Fo(p,s,h,g,v,b){let A;for(A in s=s||{},p=p||{})p.hasOwnProperty(A)&&(S(p[A],s[A])||h.push({command:b,args:[g,A,s[A],v]}));for(A in s)s.hasOwnProperty(A)&&!p.hasOwnProperty(A)&&(S(p[A],s[A])||h.push({command:b,args:[g,A,s[A],v]}))}function to(p){return p.id}function ju(p,s){return p[s.id]=s,p}class Vu{constructor(s,h){this.reset(s,h)}reset(s,h){this.points=s||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=a.clamp(s,0,1);let h=1,g=this._distances[h];const v=s*this.paddedLength+this.padding;for(;g<v&&h<this._distances.length;)g=this._distances[++h];const b=h-1,A=this._distances[b],C=g-A,L=C>0?(v-A)/C:0;return this.points[b].mult(1-L).add(this.points[h].mult(L))}}class Oi{constructor(s,h,g){const v=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(s/g),this.yCellCount=Math.ceil(h/g);for(let A=0;A<this.xCellCount*this.yCellCount;A++)v.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=h,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,h,g,v,b){this._forEachCell(h,g,v,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(b)}insertCircle(s,h,g,v){this._forEachCell(h-v,g-v,h+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(h),this.circles.push(g),this.circles.push(v)}_insertBoxCell(s,h,g,v,b,A){this.boxCells[b].push(A)}_insertCircleCell(s,h,g,v,b,A){this.circleCells[b].push(A)}_query(s,h,g,v,b,A){if(g<0||s>this.width||v<0||h>this.height)return!b&&[];const C=[];if(s<=0&&h<=0&&this.width<=g&&this.height<=v){if(b)return!0;for(let L=0;L<this.boxKeys.length;L++)C.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(let L=0;L<this.circleKeys.length;L++){const $=this.circles[3*L],U=this.circles[3*L+1],H=this.circles[3*L+2];C.push({key:this.circleKeys[L],x1:$-H,y1:U-H,x2:$+H,y2:U+H})}return A?C.filter(A):C}return this._forEachCell(s,h,g,v,this._queryCell,C,{hitTest:b,seenUids:{box:{},circle:{}}},A),b?C.length>0:C}_queryCircle(s,h,g,v,b){const A=s-g,C=s+g,L=h-g,$=h+g;if(C<0||A>this.width||$<0||L>this.height)return!v&&[];const U=[];return this._forEachCell(A,L,C,$,this._queryCellCircle,U,{hitTest:v,circle:{x:s,y:h,radius:g},seenUids:{box:{},circle:{}}},b),v?U.length>0:U}query(s,h,g,v,b){return this._query(s,h,g,v,!1,b)}hitTest(s,h,g,v,b){return this._query(s,h,g,v,!0,b)}hitTestCircle(s,h,g,v){return this._queryCircle(s,h,g,!0,v)}_queryCell(s,h,g,v,b,A,C,L){const $=C.seenUids,U=this.boxCells[b];if(U!==null){const ne=this.bboxes;for(const le of U)if(!$.box[le]){$.box[le]=!0;const fe=4*le;if(s<=ne[fe+2]&&h<=ne[fe+3]&&g>=ne[fe+0]&&v>=ne[fe+1]&&(!L||L(this.boxKeys[le]))){if(C.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[le],x1:ne[fe],y1:ne[fe+1],x2:ne[fe+2],y2:ne[fe+3]})}}}const H=this.circleCells[b];if(H!==null){const ne=this.circles;for(const le of H)if(!$.circle[le]){$.circle[le]=!0;const fe=3*le;if(this._circleAndRectCollide(ne[fe],ne[fe+1],ne[fe+2],s,h,g,v)&&(!L||L(this.circleKeys[le]))){if(C.hitTest)return A.push(!0),!0;{const ce=ne[fe],de=ne[fe+1],X=ne[fe+2];A.push({key:this.circleKeys[le],x1:ce-X,y1:de-X,x2:ce+X,y2:de+X})}}}}}_queryCellCircle(s,h,g,v,b,A,C,L){const $=C.circle,U=C.seenUids,H=this.boxCells[b];if(H!==null){const le=this.bboxes;for(const fe of H)if(!U.box[fe]){U.box[fe]=!0;const ce=4*fe;if(this._circleAndRectCollide($.x,$.y,$.radius,le[ce+0],le[ce+1],le[ce+2],le[ce+3])&&(!L||L(this.boxKeys[fe])))return A.push(!0),!0}}const ne=this.circleCells[b];if(ne!==null){const le=this.circles;for(const fe of ne)if(!U.circle[fe]){U.circle[fe]=!0;const ce=3*fe;if(this._circlesCollide(le[ce],le[ce+1],le[ce+2],$.x,$.y,$.radius)&&(!L||L(this.circleKeys[fe])))return A.push(!0),!0}}}_forEachCell(s,h,g,v,b,A,C,L){const $=this._convertToXCellCoord(s),U=this._convertToYCellCoord(h),H=this._convertToXCellCoord(g),ne=this._convertToYCellCoord(v);for(let le=$;le<=H;le++)for(let fe=U;fe<=ne;fe++)if(b.call(this,s,h,g,v,this.xCellCount*fe+le,A,C,L))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,h,g,v,b,A){const C=v-s,L=b-h,$=g+A;return $*$>C*C+L*L}_circleAndRectCollide(s,h,g,v,b,A,C){const L=(A-v)/2,$=Math.abs(s-(v+L));if($>L+g)return!1;const U=(C-b)/2,H=Math.abs(h-(b+U));if(H>U+g)return!1;if($<=L||H<=U)return!0;const ne=$-L,le=H-U;return ne*ne+le*le<=g*g}}const ns={unknown:0,flipRequired:1,flipNotRequired:2},Ha=Math.tan(85*Math.PI/180);function ot(p,s,h,g,v,b,A){const C=a.create();if(h)if(b.name==="globe"){const L=a.calculateGlobeLabelMatrix(v,s);a.multiply(C,C,L)}else{const L=he([],A);C[0]=L[0],C[1]=L[1],C[4]=L[2],C[5]=L[3],g||a.rotateZ(C,C,v.angle)}else a.multiply(C,v.labelPlaneMatrix,p);return C}function is(p,s,h,g,v,b,A){const C=ot(p,s,h,g,v,b,A);return b.name==="globe"&&h||(C[2]=C[6]=C[10]=C[14]=0),C}function Mn(p,s,h,g,v,b,A){if(h){if(b.name==="globe"){const C=ot(p,s,h,g,v,b,A);return a.invert(C,C),a.multiply(C,p,C),C}{const C=a.clone(p),L=a.identity([]);return L[0]=A[0],L[1]=A[1],L[4]=A[2],L[5]=A[3],a.multiply(C,C,L),g||a.rotateZ(C,C,-v.angle),C}}return v.glCoordMatrix}function ii(p,s,h,g){const v=[p,s,h,1];h?a.transformMat4$1(v,v,g):gr(v,v,g);const b=v[3];return v[0]/=b,v[1]/=b,v[2]/=b,v}function Xa(p,s){return Math.min(.5+p/s*.5,1.5)}function Bo(p,s){const h=p[0]/p[3],g=p[1]/p[3];return h>=-s[0]&&h<=s[0]&&g>=-s[1]&&g<=s[1]}function Fs(p,s,h,g,v,b,A,C,L,$){const U=h.transform,H=g?p.textSizeData:p.iconSizeData,ne=a.evaluateSizeForZoom(H,h.transform.zoom),le=U.projection.name==="globe",fe=[256/h.width*2+1,256/h.height*2+1],ce=g?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;ce.clear();let de=null;le&&(de=g?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const X=p.lineVertexArray,ae=g?p.text.placedSymbolArray:p.icon.placedSymbolArray,ge=h.transform.width/h.transform.height;let be,Oe=!1;for(let Re=0;Re<ae.length;Re++){const De=ae.get(Re),{numGlyphs:Ue,writingMode:Ne}=De;if(Ne!==a.WritingMode.vertical||Oe||be===a.WritingMode.horizontal||(Oe=!0),be=Ne,(De.hidden||Ne===a.WritingMode.vertical)&&!Oe){ro(Ue,ce);continue}Oe=!1;const Ye=new a.Point(De.tileAnchorX,De.tileAnchorY);let{x:vt,y:We,z:ht}=U.projection.projectTilePoint(Ye.x,Ye.y,$.canonical);if(L){const[or,jt,Yt]=L(Ye);vt+=or,We+=jt,ht+=Yt}const rt=[vt,We,ht,1];if(a.transformMat4$1(rt,rt,s),!Bo(rt,fe)){ro(Ue,ce);continue}const _t=Xa(h.transform.cameraToCenterDistance,rt[3]),Xe=a.evaluateSizeForFeature(H,ne,De),ut=A?Xe/_t:Xe*_t,bt=ii(vt,We,ht,v);if(bt[3]<=0){ro(Ue,ce);continue}let pt={};const Tt=A?null:L,Wt=zt(De,ut,!1,C,s,v,b,p.glyphOffsetArray,X,ce,de,bt,Ye,pt,ge,Tt,U.projection,$,A);Oe=Wt.useVertical,Tt&&Wt.needsFlipping&&(pt={}),(Wt.notEnoughRoom||Oe||Wt.needsFlipping&&zt(De,ut,!0,C,s,v,b,p.glyphOffsetArray,X,ce,de,bt,Ye,pt,ge,Tt,U.projection,$,A).notEnoughRoom)&&ro(Ue,ce)}g?(p.text.dynamicLayoutVertexBuffer.updateData(ce),de&&p.text.globeExtVertexBuffer.updateData(de)):(p.icon.dynamicLayoutVertexBuffer.updateData(ce),de&&p.icon.globeExtVertexBuffer.updateData(de))}function Gu(p,s,h,g,v,b,A,C,L,$,U,H,ne,le,fe,ce){const{lineStartIndex:de,glyphStartIndex:X,segment:ae}=C,ge=X+C.numGlyphs,be=de+C.lineLength,Oe=s.getoffsetX(X),Re=s.getoffsetX(ge-1),De=Zi(p*Oe,h,g,v,b,A,ae,de,be,L,$,U,H,ne,!0,le,fe,ce);if(!De)return null;const Ue=Zi(p*Re,h,g,v,b,A,ae,de,be,L,$,U,H,ne,!0,le,fe,ce);return Ue?{first:De,last:Ue}:null}function Bs(p,s,h,g){return p===a.WritingMode.horizontal&&Math.abs(g)>Math.abs(h)?{useVertical:!0}:p===a.WritingMode.vertical?g>0?{needsFlipping:!0}:null:s!==ns.unknown&&function(v,b){return v===0||Math.abs(b/v)>Ha}(h,g)?s===ns.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null}function zt(p,s,h,g,v,b,A,C,L,$,U,H,ne,le,fe,ce,de,X,ae){const ge=s/24,be=p.lineOffsetX*ge,Oe=p.lineOffsetY*ge,{lineStartIndex:Re,glyphStartIndex:De,numGlyphs:Ue,segment:Ne,writingMode:Ye,flipState:vt}=p,We=Re+p.lineLength,ht=rt=>{if(U){const[bt,pt,Tt]=rt.up,Wt=$.length;a.updateGlobeVertexNormal(U,Wt+0,bt,pt,Tt),a.updateGlobeVertexNormal(U,Wt+1,bt,pt,Tt),a.updateGlobeVertexNormal(U,Wt+2,bt,pt,Tt),a.updateGlobeVertexNormal(U,Wt+3,bt,pt,Tt)}const[_t,Xe,ut]=rt.point;a.addDynamicAttributes($,_t,Xe,ut,rt.angle)};if(Ue>1){const rt=Gu(ge,C,be,Oe,h,H,ne,p,L,b,le,ce,!1,de,X,ae);if(!rt)return{notEnoughRoom:!0};if(g&&!h){let[_t,Xe,ut]=rt.first.point,[bt,pt,Tt]=rt.last.point;[_t,Xe]=ii(_t,Xe,ut,A),[bt,pt]=ii(bt,pt,Tt,A);const Wt=Bs(Ye,vt,(bt-_t)*fe,pt-Xe);if(p.flipState=Wt&&Wt.needsFlipping?ns.flipRequired:ns.flipNotRequired,Wt)return Wt}ht(rt.first);for(let _t=De+1;_t<De+Ue-1;_t++){const Xe=Zi(ge*C.getoffsetX(_t),be,Oe,h,H,ne,Ne,Re,We,L,b,le,ce,!1,!1,de,X,ae);if(!Xe)return $.length-=4*(_t-De),{notEnoughRoom:!0};ht(Xe)}ht(rt.last)}else{if(g&&!h){const _t=ii(ne.x,ne.y,0,v),Xe=Re+Ne+1,ut=new a.Point(L.getx(Xe),L.gety(Xe)),bt=ii(ut.x,ut.y,0,v),pt=bt[3]>0?bt:mr(ne,ut,_t,1,v,void 0,de,X.canonical),Tt=Bs(Ye,vt,(pt[0]-_t[0])*fe,pt[1]-_t[1]);if(p.flipState=Tt&&Tt.needsFlipping?ns.flipRequired:ns.flipNotRequired,Tt)return Tt}const rt=Zi(ge*C.getoffsetX(De),be,Oe,h,H,ne,Ne,Re,We,L,b,le,ce,!1,!1,de,X,ae);if(!rt)return{notEnoughRoom:!0};ht(rt)}return{}}function _r(p,s,h,g,v){const{x:b,y:A,z:C}=g.projectTilePoint(p.x,p.y,s);if(!v)return ii(b,A,C,h);const[L,$,U]=v(p);return ii(b+L,A+$,C+U,h)}function mr(p,s,h,g,v,b,A,C){const L=_r(p.sub(s)._unit()._add(p),C,v,A,b);return a.sub(L,h,L),a.normalize(L,L),a.scaleAndAdd(L,h,L,g)}function Zi(p,s,h,g,v,b,A,C,L,$,U,H,ne,le,fe,ce,de,X){const ae=g?p-s:p+s;let ge=ae>0?1:-1,be=0;g&&(ge*=-1,be=Math.PI),ge<0&&(be+=Math.PI);let Oe=C+A+(ge>0?0:1)|0,Re=v,De=v,Ue=0,Ne=0;const Ye=Math.abs(ae),vt=[],We=[];let ht=b,rt=ht;const _t=()=>mr(rt,ht,De,Ye-Ue+1,U,ne,ce,de.canonical);for(;Ue+Ne<=Ye;){if(Oe+=ge,Oe<C||Oe>=L)return null;if(De=Re,rt=ht,vt.push(De),le&&We.push(rt),ht=new a.Point($.getx(Oe),$.gety(Oe)),Re=H[Oe],!Re){const Yt=_r(ht,de.canonical,U,ce,ne);Re=Yt[3]>0?H[Oe]=Yt:_t()}Ue+=Ne,Ne=a.distance(De,Re)}fe&&ne&&(H[Oe]&&(Re=_t(),Ne=a.distance(De,Re)),H[Oe]=Re);const Xe=(Ye-Ue)/Ne,ut=ht.sub(rt)._mult(Xe)._add(rt),bt=a.sub([],Re,De),pt=a.scaleAndAdd([],De,bt,Xe);let Tt=[0,0,1],Wt=bt[0],or=bt[1];if(X&&(Tt=ce.upVector(de.canonical,ut.x,ut.y),Tt[0]!==0||Tt[1]!==0||Tt[2]!==1)){const Yt=[Tt[2],0,-Tt[0]],vr=a.cross([],Tt,Yt);a.normalize(Yt,Yt),a.normalize(vr,vr),Wt=a.dot(bt,Yt),or=a.dot(bt,vr)}if(h){const Yt=a.cross([],Tt,bt);a.normalize(Yt,Yt),a.scaleAndAdd(pt,pt,Yt,h*ge)}const jt=be+Math.atan2(or,Wt);return vt.push(pt),le&&We.push(ut),{point:pt,angle:jt,path:vt,tilePath:We,up:Tt}}function ro(p,s){const h=s.length,g=h+4*p;s.resize(g),s.float32.fill(-1/0,4*h,4*g)}function gr(p,s,h){const g=s[0],v=s[1];return p[0]=h[0]*g+h[4]*v+h[12],p[1]=h[1]*g+h[5]*v+h[13],p[3]=h[3]*g+h[7]*v+h[15],p}const Hi=100;class ya{constructor(s,h,g=new Oi(s.width+200,s.height+200,25),v=new Oi(s.width+200,s.height+200,25)){this.transform=s,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+Hi,this.screenBottomBoundary=s.height+Hi,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=h}placeCollisionBox(s,h,g,v,b,A,C,L){let $=g.projectedAnchorX,U=g.projectedAnchorY,H=g.projectedAnchorZ;const ne=g.elevation,le=g.tileID,fe=s.getProjection();if(ne&&le){const[Re,De,Ue]=fe.upVector(le.canonical,g.tileAnchorX,g.tileAnchorY),Ne=fe.upVectorScale(le.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;$+=Re*ne*Ne,U+=De*ne*Ne,H+=Ue*ne*Ne}const ce=this.projectAndGetPerspectiveRatio(C,$,U,H,g.tileID,fe.name==="globe"||!!ne||this.transform.pitch>0,fe),de=A*ce.perspectiveRatio,X=(g.x1*h+v.x-g.padding)*de+ce.point.x,ae=(g.y1*h+v.y-g.padding)*de+ce.point.y,ge=(g.x2*h+v.x+g.padding)*de+ce.point.x,be=(g.y2*h+v.y+g.padding)*de+ce.point.y,Oe=ce.perspectiveRatio<=.55||ce.occluded;return!this.isInsideGrid(X,ae,ge,be)||!b&&this.grid.hitTest(X,ae,ge,be,L)||Oe?{box:[],offscreen:!1,occluded:ce.occluded}:{box:[X,ae,ge,be],offscreen:this.isOffscreen(X,ae,ge,be),occluded:!1}}placeCollisionCircles(s,h,g,v,b,A,C,L,$,U,H,ne,le,fe,ce){const de=[],X=this.transform.elevation,ae=s.getProjection(),ge=X?X.getAtTileOffsetFunc(ce,this.transform.center.lat,this.transform.worldSize,ae):null,be=new a.Point(g.tileAnchorX,g.tileAnchorY);let{x:Oe,y:Re,z:De}=ae.projectTilePoint(be.x,be.y,ce.canonical);if(ge){const[ut,bt,pt]=ge(be);Oe+=ut,Re+=bt,De+=pt}const Ue=ae.name==="globe",Ne=this.projectAndGetPerspectiveRatio(C,Oe,Re,De,ce,Ue||!!X||this.transform.pitch>0,ae),{perspectiveRatio:Ye}=Ne,vt=(H?A/Ye:A*Ye)/a.ONE_EM,We=ii(Oe,Re,De,L),ht=Ne.signedDistanceFromCamera>0?Gu(vt,b,g.lineOffsetX*vt,g.lineOffsetY*vt,!1,We,be,g,v,L,{},X&&!H?ge:null,H&&!!X,ae,ce,H):null;let rt=!1,_t=!1,Xe=!0;if(ht&&!Ne.occluded){const ut=.5*le*Ye+fe,bt=new a.Point(-100,-100),pt=new a.Point(this.screenRightBoundary,this.screenBottomBoundary),Tt=new Vu,{first:Wt,last:or}=ht,jt=Wt.path.length;let Yt=[];for(let qt=jt-1;qt>=1;qt--)Yt.push(Wt.path[qt]);for(let qt=1;qt<or.path.length;qt++)Yt.push(or.path[qt]);const vr=2.5*ut;$&&(Yt=Yt.map(([qt,$r,Gr],qr)=>(ge&&!Ue&&(Gr=ge(qr<jt-1?Wt.tilePath[jt-1-qr]:or.tilePath[qr-jt+2])[2]),ii(qt,$r,Gr,$))),Yt.some(qt=>qt[3]<=0)&&(Yt=[]));let yr=[];if(Yt.length>0){let qt=1/0,$r=-1/0,Gr=1/0,qr=-1/0;for(const Wr of Yt)qt=Math.min(qt,Wr[0]),Gr=Math.min(Gr,Wr[1]),$r=Math.max($r,Wr[0]),qr=Math.max(qr,Wr[1]);$r>=bt.x&&qt<=pt.x&&qr>=bt.y&&Gr<=pt.y&&(yr=[Yt.map(Wr=>new a.Point(Wr[0],Wr[1]))],(qt<bt.x||$r>pt.x||Gr<bt.y||qr>pt.y)&&(yr=a.clipLine(yr,bt.x,bt.y,pt.x,pt.y)))}for(const qt of yr){Tt.reset(qt,.25*ut);let $r=0;$r=Tt.length<=.5*ut?1:Math.ceil(Tt.paddedLength/vr)+1;for(let Gr=0;Gr<$r;Gr++){const qr=Gr/Math.max($r-1,1),Wr=Tt.lerp(qr),zi=Wr.x+Hi,mi=Wr.y+Hi;de.push(zi,mi,ut,0);const jo=zi-ut,ws=mi-ut,dn=zi+ut,Zr=mi+ut;if(Xe=Xe&&this.isOffscreen(jo,ws,dn,Zr),_t=_t||this.isInsideGrid(jo,ws,dn,Zr),!h&&this.grid.hitTestCircle(zi,mi,ut,ne)&&(rt=!0,!U))return{circles:[],offscreen:!1,collisionDetected:rt,occluded:!1}}}}return{circles:!U&&rt||!_t?[]:de,offscreen:Xe,collisionDetected:rt,occluded:Ne.occluded}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let g=1/0,v=1/0,b=-1/0,A=-1/0;for(const U of s){const H=new a.Point(U.x+Hi,U.y+Hi);g=Math.min(g,H.x),v=Math.min(v,H.y),b=Math.max(b,H.x),A=Math.max(A,H.y),h.push(H)}const C=this.grid.query(g,v,b,A).concat(this.ignoredGrid.query(g,v,b,A)),L={},$={};for(const U of C){const H=U.key;if(L[H.bucketInstanceId]===void 0&&(L[H.bucketInstanceId]={}),L[H.bucketInstanceId][H.featureIndex])continue;const ne=[new a.Point(U.x1,U.y1),new a.Point(U.x2,U.y1),new a.Point(U.x2,U.y2),new a.Point(U.x1,U.y2)];a.polygonIntersectsPolygon(h,ne)&&(L[H.bucketInstanceId][H.featureIndex]=!0,$[H.bucketInstanceId]===void 0&&($[H.bucketInstanceId]=[]),$[H.bucketInstanceId].push(H.featureIndex))}return $}insertCollisionBox(s,h,g,v,b){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:b},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,h,g,v,b){const A=h?this.ignoredGrid:this.grid,C={bucketInstanceId:g,featureIndex:v,collisionGroupID:b};for(let L=0;L<s.length;L+=4)A.insertCircle(C,s[L],s[L+1],s[L+2])}projectAndGetPerspectiveRatio(s,h,g,v,b,A,C){const L=[h,g,v,1];let $=!1;v||this.transform.pitch>0?(a.transformMat4$1(L,L,s),this.fogState&&b&&C.name!=="globe"&&($=function(ne,le,fe,ce,de,X){const ae=X.calculateFogTileMatrix(de),ge=[le,fe,ce];return a.transformMat4(ge,ge,ae),ct(ne,ge,X.pitch,X._fov)}(this.fogState,h,g,v,b.toUnwrapped(),this.transform)>.9)):gr(L,L,s);const U=L[3];return{point:new a.Point((L[0]/U+1)/2*this.transform.width+Hi,(-L[1]/U+1)/2*this.transform.height+Hi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/U*.5,1.5),signedDistanceFromCamera:U,occluded:A&&L[2]>U||$}}isOffscreen(s,h,g,v){return g<Hi||s>=this.screenRightBoundary||v<Hi||h>this.screenBottomBoundary}isInsideGrid(s,h,g,v){return g>=0&&s<this.gridRightBoundary&&v>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const s=a.identity([]);return a.translate(s,s,[-100,-100,0]),s}}function No(p,s,h){const g=s.createTileMatrix(p,p.worldSize,h.toUnwrapped());return a.multiply(new Float32Array(16),p.projMatrix,g)}function ai(p,s,h){if(s.projection.name===h.projection.name)return p.projMatrix;const g=h.clone();return g.setProjection(s.projection),No(g,s.getProjection(),p)}function nn(p,s,h){return s.name===h.projection.name?p.projMatrix:No(h,s,p)}class th{constructor(s,h,g,v){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?h:-h))):v&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class fi{constructor(s,h,g,v,b,A=!1){this.text=new th(s?s.text:null,h,g,b),this.icon=new th(s?s.icon:null,h,v,b),this.clipped=A}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ka{constructor(s,h,g,v=!1){this.text=s,this.icon=h,this.skipFade=g,this.clipped=v}}class Ya{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class qu{constructor(s,h,g,v,b){this.bucketInstanceId=s,this.featureIndex=h,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=b}}class rh{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const h=++this.maxGroupID;this.collisionGroups[s]={ID:h,predicate:g=>g.collisionGroupID===h}}return this.collisionGroups[s]}}function Ja(p,s,h,g,v){const{horizontalAlign:b,verticalAlign:A}=a.getAnchorAlignment(p),C=-(b-.5)*s,L=-(A-.5)*h,$=a.evaluateVariableOffset(p,g);return new a.Point(C+$[0]*v,L+$[1]*v)}function bo(p,s,h,g,v){const b=new a.Point(p,s);return h&&b._rotate(g?v:-v),b}class Qa{constructor(s,h,g,v,b){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new ya(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new rh(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,h,g,v){const b=g.getBucket(h),A=g.latestFeatureIndex;if(!b||!A||h.id!==b.layerIds[0])return;const C=b.layers[0].layout,L=g.collisionBoxArray,$=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),U=g.tileSize/a.EXTENT,H=g.tileID.toUnwrapped();this.transform.setProjection(b.projection);const ne=(le=g.tileID,fe=b.getProjection(),ce=this.transform,fe.name===this.projection?ce.calculateProjMatrix(le.toUnwrapped()):No(ce,fe,le));var le,fe,ce;const de=C.get("text-pitch-alignment")==="map",X=C.get("text-rotation-alignment")==="map";h.compileFilter();const ae=h.dynamicFilter(),ge=h.dynamicFilterNeedsFeature(),be=this.transform.calculatePixelsToTileUnitsMatrix(g),Oe=is(ne,g.tileID.canonical,de,X,this.transform,b.getProjection(),be);let Re=null;if(de){const Ne=Mn(ne,g.tileID.canonical,de,X,this.transform,b.getProjection(),be);Re=a.multiply([],this.transform.labelPlaneMatrix,Ne)}let De=null;ae&&g.latestFeatureIndex&&(De={unwrappedTileID:H,dynamicFilter:ae,dynamicFilterNeedsFeature:ge,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new qu(b.bucketInstanceId,A,b.sourceLayerIndex,b.index,g.tileID);const Ue={bucket:b,layout:C,posMatrix:ne,textLabelPlaneMatrix:Oe,labelToScreenMatrix:Re,clippingData:De,scale:$,textPixelRatio:U,holdingForFade:g.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(v)for(const Ne of b.sortKeyRanges){const{sortKey:Ye,symbolInstanceStart:vt,symbolInstanceEnd:We}=Ne;s.push({sortKey:Ye,symbolInstanceStart:vt,symbolInstanceEnd:We,parameters:Ue})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ue})}attemptAnchorPlacement(s,h,g,v,b,A,C,L,$,U,H,ne,le,fe,ce,de,X,ae){const{textOffset0:ge,textOffset1:be,crossTileID:Oe}=ne,Re=[ge,be],De=Ja(s,g,v,Re,b),Ue=this.collisionIndex.placeCollisionBox(fe,b,h,bo(De.x,De.y,A,C,this.transform.angle),H,L,$,U.predicate);if(de){const Ne=fe.getSymbolInstanceIconSize(ae,this.transform.zoom,ne.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(fe,Ne,de,bo(De.x,De.y,A,C,this.transform.angle),H,L,$,U.predicate).box.length===0)return}if(Ue.box.length>0){let Ne;return this.prevPlacement&&this.prevPlacement.variableOffsets[Oe]&&this.prevPlacement.placements[Oe]&&this.prevPlacement.placements[Oe].text&&(Ne=this.prevPlacement.variableOffsets[Oe].anchor),this.variableOffsets[Oe]={textOffset:Re,width:g,height:v,anchor:s,textScale:b,prevAnchor:Ne},this.markUsedJustification(fe,s,ne,ce),fe.allowVerticalPlacement&&(this.markUsedOrientation(fe,ce,ne),this.placedOrientations[Oe]=ce),{shift:De,placedGlyphBoxes:Ue}}}placeLayerBucketPart(s,h,g,v){const{bucket:b,layout:A,posMatrix:C,textLabelPlaneMatrix:L,labelToScreenMatrix:$,clippingData:U,textPixelRatio:H,holdingForFade:ne,collisionBoxArray:le,partiallyEvaluatedTextSize:fe,partiallyEvaluatedIconSize:ce,collisionGroup:de}=s.parameters,X=A.get("text-optional"),ae=A.get("icon-optional"),ge=A.get("text-allow-overlap"),be=A.get("icon-allow-overlap"),Oe=A.get("text-rotation-alignment")==="map",Re=A.get("text-pitch-alignment")==="map",De=A.get("icon-text-fit")!=="none",Ue=A.get("symbol-z-order")==="viewport-y";this.transform.setProjection(b.projection);let Ne=ge&&(be||!b.hasIconData()||ae),Ye=be&&(ge||!b.hasTextData()||X);!b.collisionArrays&&le&&b.deserializeCollisionBoxes(le),g&&v&&b.updateCollisionDebugBuffers(this.transform.zoom,le);const vt=(We,ht,rt)=>{const{crossTileID:_t,numVerticalGlyphVertices:Xe}=We;if(U){const dn={zoom:this.transform.zoom,pitch:this.transform.pitch};let Zr=null;if(U.dynamicFilterNeedsFeature){const Lr=this.retainedQueryData[b.bucketInstanceId];Zr=U.featureIndex.loadFeature({featureIndex:We.featureIndex,bucketIndex:Lr.bucketIndex,sourceLayerIndex:Lr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,U.dynamicFilter)(dn,Zr,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new a.Point(We.tileAnchorX,We.tileAnchorY),this.transform.calculateDistanceTileData(U.unwrappedTileID)))return this.placements[_t]=new Ka(!1,!1,!1,!0),void h.add(_t)}if(h.has(_t))return;if(ne)return void(this.placements[_t]=new Ka(!1,!1,!1));let ut=!1,bt=!1,pt=!0,Tt=!1,Wt=!1,or=null,jt={box:null,offscreen:null,occluded:null},Yt={box:null},vr=null,yr=null,qt=null,$r=0,Gr=0,qr=0;rt.textFeatureIndex?$r=rt.textFeatureIndex:We.useRuntimeCollisionCircles&&($r=We.featureIndex),rt.verticalTextFeatureIndex&&(Gr=rt.verticalTextFeatureIndex);const Wr=dn=>{dn.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;const Zr=this.transform.elevation;(Zr||dn.elevation)&&(dn.elevation=Zr?Zr.getAtTileOffset(dn.tileID,dn.tileAnchorX,dn.tileAnchorY):0)},zi=rt.textBox;if(zi){Wr(zi);const dn=Lr=>{let Gn=a.WritingMode.horizontal;if(b.allowVerticalPlacement&&!Lr&&this.prevPlacement){const Ki=this.prevPlacement.placedOrientations[_t];Ki&&(this.placedOrientations[_t]=Ki,Gn=Ki,this.markUsedOrientation(b,Gn,We))}return Gn},Zr=(Lr,Gn)=>{if(b.allowVerticalPlacement&&Xe>0&&rt.verticalTextBox){for(const Ki of b.writingModes)if(Ki===a.WritingMode.vertical?(jt=Gn(),Yt=jt):jt=Lr(),jt&&jt.box&&jt.box.length)break}else jt=Lr()};if(A.get("text-variable-anchor")){let Lr=A.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[_t]){const ln=this.prevPlacement.variableOffsets[_t];Lr.indexOf(ln.anchor)>0&&(Lr=Lr.filter(no=>no!==ln.anchor),Lr.unshift(ln.anchor))}const Gn=(ln,no,Ah)=>{const al=b.getSymbolInstanceTextSize(fe,We,this.transform.zoom,ht),hc=(ln.x2-ln.x1)*al+2*ln.padding,Gs=(ln.y2-ln.y1)*al+2*ln.padding,ba=De&&!be?no:null;ba&&Wr(ba);let ll={box:[],offscreen:!1,occluded:!1};const Ch=ge?2*Lr.length:Lr.length;for(let fc=0;fc<Ch;++fc){const Vd=this.attemptAnchorPlacement(Lr[fc%Lr.length],ln,hc,Gs,al,Oe,Re,H,C,de,fc>=Lr.length,We,ht,b,Ah,ba,fe,ce);if(Vd&&(ll=Vd.placedGlyphBoxes,ll&&ll.box&&ll.box.length)){ut=!0,or=Vd.shift;break}}return ll};Zr(()=>Gn(zi,rt.iconBox,a.WritingMode.horizontal),()=>{const ln=rt.verticalTextBox;return ln&&Wr(ln),b.allowVerticalPlacement&&!(jt&&jt.box&&jt.box.length)&&Xe>0&&ln?Gn(ln,rt.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),jt&&(ut=jt.box,pt=jt.offscreen,Tt=jt.occluded);const Ki=dn(!(!jt||!jt.box));if(!ut&&this.prevPlacement){const ln=this.prevPlacement.variableOffsets[_t];ln&&(this.variableOffsets[_t]=ln,this.markUsedJustification(b,ln.anchor,We,Ki))}}else{const Lr=(Gn,Ki)=>{const ln=b.getSymbolInstanceTextSize(fe,We,this.transform.zoom,ht),no=this.collisionIndex.placeCollisionBox(b,ln,Gn,new a.Point(0,0),ge,H,C,de.predicate);return no&&no.box&&no.box.length&&(this.markUsedOrientation(b,Ki,We),this.placedOrientations[_t]=Ki),no};Zr(()=>Lr(zi,a.WritingMode.horizontal),()=>{const Gn=rt.verticalTextBox;return b.allowVerticalPlacement&&Xe>0&&Gn?(Wr(Gn),Lr(Gn,a.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),dn(!!(jt&&jt.box&&jt.box.length))}}if(vr=jt,ut=vr&&vr.box&&vr.box.length>0,pt=vr&&vr.offscreen,Tt=vr&&vr.occluded,We.useRuntimeCollisionCircles){const dn=b.text.placedSymbolArray.get(We.centerJustifiedTextSymbolIndex>=0?We.centerJustifiedTextSymbolIndex:We.verticalPlacedTextSymbolIndex),Zr=a.evaluateSizeForFeature(b.textSizeData,fe,dn),Lr=A.get("text-padding");yr=this.collisionIndex.placeCollisionCircles(b,ge,dn,b.lineVertexArray,b.glyphOffsetArray,Zr,C,L,$,g,Re,de.predicate,We.collisionCircleDiameter*Zr/a.ONE_EM,Lr,this.retainedQueryData[b.bucketInstanceId].tileID),ut=ge||yr.circles.length>0&&!yr.collisionDetected,pt=pt&&yr.offscreen,Tt=yr.occluded}if(rt.iconFeatureIndex&&(qr=rt.iconFeatureIndex),rt.iconBox){const dn=Zr=>{Wr(Zr);const Lr=De&&or?bo(or.x,or.y,Oe,Re,this.transform.angle):new a.Point(0,0),Gn=b.getSymbolInstanceIconSize(ce,this.transform.zoom,We.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,Gn,Zr,Lr,be,H,C,de.predicate)};Yt&&Yt.box&&Yt.box.length&&rt.verticalIconBox?(qt=dn(rt.verticalIconBox),bt=qt.box.length>0):(qt=dn(rt.iconBox),bt=qt.box.length>0),pt=pt&&qt.offscreen,Wt=qt.occluded}const mi=X||We.numHorizontalGlyphVertices===0&&Xe===0,jo=ae||We.numIconVertices===0;if(mi||jo?jo?mi||(bt=bt&&ut):ut=bt&&ut:bt=ut=bt&&ut,ut&&vr&&vr.box&&this.collisionIndex.insertCollisionBox(vr.box,A.get("text-ignore-placement"),b.bucketInstanceId,Yt&&Yt.box&&Gr?Gr:$r,de.ID),bt&&qt&&this.collisionIndex.insertCollisionBox(qt.box,A.get("icon-ignore-placement"),b.bucketInstanceId,qr,de.ID),yr&&(ut&&this.collisionIndex.insertCollisionCircles(yr.circles,A.get("text-ignore-placement"),b.bucketInstanceId,$r,de.ID),g)){const dn=b.bucketInstanceId;let Zr=this.collisionCircleArrays[dn];Zr===void 0&&(Zr=this.collisionCircleArrays[dn]=new Ya);for(let Lr=0;Lr<yr.circles.length;Lr+=4)Zr.circles.push(yr.circles[Lr+0]),Zr.circles.push(yr.circles[Lr+1]),Zr.circles.push(yr.circles[Lr+2]),Zr.circles.push(yr.collisionDetected?1:0)}const ws=b.projection.name!=="globe";Ne=Ne&&(ws||!Tt),Ye=Ye&&(ws||!Wt),this.placements[_t]=new Ka(ut||Ne,bt||Ye,pt||b.justReloaded),h.add(_t)};if(Ue){const We=b.getSortedSymbolIndexes(this.transform.angle);for(let ht=We.length-1;ht>=0;--ht){const rt=We[ht];vt(b.symbolInstances.get(rt),rt,b.collisionArrays[rt])}}else for(let We=s.symbolInstanceStart;We<s.symbolInstanceEnd;We++)vt(b.symbolInstances.get(We),We,b.collisionArrays[We]);if(g&&b.bucketInstanceId in this.collisionCircleArrays){const We=this.collisionCircleArrays[b.bucketInstanceId];a.invert(We.invProjMatrix,C),We.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(s,h,g,v){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:L,crossTileID:$}=g,U=a.getAnchorJustification(h),H=v===a.WritingMode.vertical?L:U==="left"?b:U==="center"?A:U==="right"?C:-1;b>=0&&(s.text.placedSymbolArray.get(b).crossTileID=H>=0&&b!==H?0:$),A>=0&&(s.text.placedSymbolArray.get(A).crossTileID=H>=0&&A!==H?0:$),C>=0&&(s.text.placedSymbolArray.get(C).crossTileID=H>=0&&C!==H?0:$),L>=0&&(s.text.placedSymbolArray.get(L).crossTileID=H>=0&&L!==H?0:$)}markUsedOrientation(s,h,g){const v=h===a.WritingMode.horizontal||h===a.WritingMode.horizontalOnly?h:0,b=h===a.WritingMode.vertical?h:0,{leftJustifiedTextSymbolIndex:A,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:L,verticalPlacedTextSymbolIndex:$}=g,U=s.text.placedSymbolArray;A>=0&&(U.get(A).placedOrientation=v),C>=0&&(U.get(C).placedOrientation=v),L>=0&&(U.get(L).placedOrientation=v),$>=0&&(U.get($).placedOrientation=b)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let g=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const v=h?h.symbolFadeChange(s):1,b=h?h.opacities:{},A=h?h.variableOffsets:{},C=h?h.placedOrientations:{};for(const L in this.placements){const $=this.placements[L],U=b[L];U?(this.opacities[L]=new fi(U,v,$.text,$.icon,null,$.clipped),g=g||$.text!==U.text.placed||$.icon!==U.icon.placed):(this.opacities[L]=new fi(null,v,$.text,$.icon,$.skipFade,$.clipped),g=g||$.text||$.icon)}for(const L in b){const $=b[L];if(!this.opacities[L]){const U=new fi($,v,!1,!1);U.isHidden()||(this.opacities[L]=U,g=g||$.text.placed||$.icon.placed)}}for(const L in A)this.variableOffsets[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.variableOffsets[L]=A[L]);for(const L in C)this.placedOrientations[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.placedOrientations[L]=C[L]);g?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:s)}updateLayerOpacities(s,h){const g=new Set;for(const v of h){const b=v.getBucket(s);b&&v.latestFeatureIndex&&s.id===b.layerIds[0]&&this.updateBucketOpacities(b,g,v.collisionBoxArray)}}updateBucketOpacities(s,h,g){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const v=s.layers[0].layout,b=!!s.layers[0].dynamicFilter(),A=new fi(null,0,!1,!1,!0),C=v.get("text-allow-overlap"),L=v.get("icon-allow-overlap"),$=v.get("text-variable-anchor"),U=v.get("text-rotation-alignment")==="map",H=v.get("text-pitch-alignment")==="map",ne=v.get("icon-text-fit")!=="none",le=new fi(null,0,C&&(L||!s.hasIconData()||v.get("icon-optional")),L&&(C||!s.hasTextData()||v.get("text-optional")),!0);!s.collisionArrays&&g&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(g);const fe=(de,X,ae)=>{for(let ge=0;ge<X/4;ge++)de.opacityVertexArray.emplaceBack(ae)};let ce=0;for(let de=0;de<s.symbolInstances.length;de++){const X=s.symbolInstances.get(de),{numHorizontalGlyphVertices:ae,numVerticalGlyphVertices:ge,crossTileID:be,numIconVertices:Oe}=X,Re=h.has(be);let De=this.opacities[be];Re?De=A:De||(De=le,this.opacities[be]=De),h.add(be);const Ue=ae>0||ge>0,Ne=Oe>0,Ye=this.placedOrientations[be],vt=Ye===a.WritingMode.vertical,We=Ye===a.WritingMode.horizontal||Ye===a.WritingMode.horizontalOnly;if(!Ue&&!Ne||De.isHidden()||ce++,Ue){const ht=os(De.text);fe(s.text,ae,vt?hn:ht),fe(s.text,ge,We?hn:ht);const rt=De.text.isHidden(),{leftJustifiedTextSymbolIndex:_t,centerJustifiedTextSymbolIndex:Xe,rightJustifiedTextSymbolIndex:ut,verticalPlacedTextSymbolIndex:bt}=X,pt=s.text.placedSymbolArray,Tt=rt||vt?1:0;_t>=0&&(pt.get(_t).hidden=Tt),Xe>=0&&(pt.get(Xe).hidden=Tt),ut>=0&&(pt.get(ut).hidden=Tt),bt>=0&&(pt.get(bt).hidden=rt||We?1:0);const Wt=this.variableOffsets[be];Wt&&this.markUsedJustification(s,Wt.anchor,X,Ye);const or=this.placedOrientations[be];or&&(this.markUsedJustification(s,"left",X,or),this.markUsedOrientation(s,or,X))}if(Ne){const ht=os(De.icon),{placedIconSymbolIndex:rt,verticalPlacedIconSymbolIndex:_t}=X,Xe=s.icon.placedSymbolArray,ut=De.icon.isHidden()?1:0;rt>=0&&(fe(s.icon,Oe,vt?hn:ht),Xe.get(rt).hidden=ut),_t>=0&&(fe(s.icon,X.numVerticalIconVertices,We?hn:ht),Xe.get(_t).hidden=ut)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const ht=s.collisionArrays[de];if(ht){let rt=new a.Point(0,0),_t=!0;if(ht.textBox||ht.verticalTextBox){if($){const ut=this.variableOffsets[be];ut?(rt=Ja(ut.anchor,ut.width,ut.height,ut.textOffset,ut.textScale),U&&rt._rotate(H?this.transform.angle:-this.transform.angle)):_t=!1}b&&(_t=!De.clipped),ht.textBox&&_a(s.textCollisionBox.collisionVertexArray,De.text.placed,!_t||vt,rt.x,rt.y),ht.verticalTextBox&&_a(s.textCollisionBox.collisionVertexArray,De.text.placed,!_t||We,rt.x,rt.y)}const Xe=_t&&!!(!We&&ht.verticalIconBox);ht.iconBox&&_a(s.iconCollisionBox.collisionVertexArray,De.icon.placed,Xe,ne?rt.x:0,ne?rt.y:0),ht.verticalIconBox&&_a(s.iconCollisionBox.collisionVertexArray,De.icon.placed,!Xe,ne?rt.x:0,ne?rt.y:0)}}}if(s.fullyClipped=ce===0,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){const de=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=de.invProjMatrix,s.placementViewportMatrix=de.viewportMatrix,s.collisionCircleArray=de.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,h){const g=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*g>s}setStale(){this.stale=!0}}function _a(p,s,h,g,v){p.emplaceBack(s?1:0,h?1:0,g||0,v||0),p.emplaceBack(s?1:0,h?1:0,g||0,v||0),p.emplaceBack(s?1:0,h?1:0,g||0,v||0),p.emplaceBack(s?1:0,h?1:0,g||0,v||0)}const li=Math.pow(2,25),xn=Math.pow(2,24),el=Math.pow(2,17),Wu=Math.pow(2,16),Ti=Math.pow(2,9),Xi=Math.pow(2,8),Zu=Math.pow(2,1);function os(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const s=p.placed?1:0,h=Math.floor(127*p.opacity);return h*li+s*xn+h*el+s*Wu+h*Ti+s*Xi+h*Zu+s}const hn=0;class tl{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&s.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(s,h,g,v,b){const A=this._bucketParts;for(;this._currentTileIndex<s.length;)if(h.getBucketParts(A,v,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort((C,L)=>C.sortKey-L.sortKey));this._currentPartIndex<A.length;){const C=A[this._currentPartIndex];if(h.placeLayerBucketPart(C,this._seenCrossTileIDs,g,C.symbolInstanceStart===0),this._currentPartIndex++,b())return!0}return!1}}class Hu{constructor(s,h,g,v,b,A,C,L){this.placement=new Qa(s,b,A,C,L),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(s,h,g){const v=a.exported.now(),b=()=>{const A=a.exported.now()-v;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){const A=h[s[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=C)&&(!A.maxzoom||A.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new tl(A)),this._inProgressLayer.continuePlacement(g[A.source],this.placement,this._showCollisionBoxes,A,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const Ns=512/a.EXTENT/2;class ve{constructor(s,h,g){this.tileID=s,this.bucketInstanceId=g,this.index=new a.KDBush(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const v=s.canonical.x*a.EXTENT,b=s.canonical.y*a.EXTENT;for(let A=0;A<h.length;A++){const{key:C,crossTileID:L,tileAnchorX:$,tileAnchorY:U}=h.get(A),H=Math.floor((v+$)*Ns),ne=Math.floor((b+U)*Ns);this.index.add(H,ne),this.keys.push(C),this.crossTileIDs.push(L)}this.index.finish()}findMatches(s,h,g){const v=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),b=Ns/Math.pow(2,h.canonical.z-this.tileID.canonical.z),A=h.canonical.x*a.EXTENT,C=h.canonical.y*a.EXTENT;for(let L=0;L<s.length;L++){const $=s.get(L);if($.crossTileID)continue;const{key:U,tileAnchorX:H,tileAnchorY:ne}=$,le=Math.floor((A+H)*b),fe=Math.floor((C+ne)*b),ce=this.index.range(le-v,fe-v,le+v,fe+v);for(const de of ce){const X=this.crossTileIDs[de];if(this.keys[de]===U&&!g.has(X)){g.add(X),$.crossTileID=X;break}}}}}class je{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Et{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const h=Math.round((s-this.lng)/360);if(h!==0)for(const g in this.indexes){const v=this.indexes[g],b={};for(const A in v){const C=v[A];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+h),b[C.tileID.key]=C}this.indexes[g]=b}this.lng=s}addBucket(s,h,g){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let b=0;b<h.symbolInstances.length;b++)h.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]=new Set);const v=this.usedCrossTileIDs[s.overscaledZ];for(const b in this.indexes){const A=this.indexes[b];if(Number(b)>s.overscaledZ)for(const C in A){const L=A[C];L.tileID.isChildOf(s)&&L.findMatches(h.symbolInstances,s,v)}else{const C=A[s.scaledTo(Number(b)).key];C&&C.findMatches(h.symbolInstances,s,v)}}for(let b=0;b<h.symbolInstances.length;b++){const A=h.symbolInstances.get(b);A.crossTileID||(A.crossTileID=g.generate(),v.add(A.crossTileID))}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new ve(s,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(s,h){for(const g of h.crossTileIDs)this.usedCrossTileIDs[s].delete(g)}removeStaleBuckets(s){let h=!1;for(const g in this.indexes){const v=this.indexes[g];for(const b in v)s[v[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[b]),delete v[b],h=!0)}return h}}class Gt{constructor(){this.layerIndexes={},this.crossTileIDs=new je,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,h,g,v){let b=this.layerIndexes[s.id];b===void 0&&(b=this.layerIndexes[s.id]=new Et);let A=!1;const C={};v.name!=="globe"&&b.handleWrapJump(g);for(const L of h){const $=L.getBucket(s);$&&s.id===$.layerIds[0]&&($.bucketInstanceId||($.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(L.tileID,$,this.crossTileIDs)&&(A=!0),C[$.bucketInstanceId]=!0)}return b.removeStaleBuckets(C)&&(A=!0),A}pruneUnusedLayers(s){const h={};s.forEach(g=>{h[g]=!0});for(const g in this.layerIndexes)h[g]||delete this.layerIndexes[g]}}const Fr=(p,s)=>a.emitValidationErrors(p,s&&s.filter(h=>h.identifier!=="source.canvas")),pr=a.pick(wr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),bn=a.pick(wr,["setCenter","setZoom","setBearing","setPitch"]),zn={version:8,layers:[],sources:{}},wn={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Br extends a.Evented{constructor(s,h={}){super(),this.map=s,this.dispatcher=new Pe(ga(),this),this.imageManager=new J,this.imageManager.setEventedParent(this),this.glyphManager=new a.GlyphManager(s._requestManager,h.localFontFamily?a.LocalGlyphMode.all:h.localIdeographFontFamily?a.LocalGlyphMode.ideographs:a.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.crossTileSymbolIndex=new Gt,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const g=this;this._rtlTextPluginCallback=Br.registerForPluginStateChange(v=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(b,A)=>{if(a.triggerPluginCompletionEvent(b),A&&A.every(C=>C))for(const C in g._sourceCaches){const L=g._sourceCaches[C],$=L.getSource().type;$!=="vector"&&$!=="geojson"||L.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const b=this.getSource(v.sourceId);if(b&&b.vectorLayerIds)for(const A in this._layers){const C=this._layers[A];C.source===b.id&&this._validateLayer(C)}})}loadURL(s,h={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const g=typeof h.validate=="boolean"?h.validate:!a.isMapboxURL(s);s=this.map._requestManager.normalizeStyleURL(s,h.accessToken);const v=this.map._requestManager.transformRequest(s,a.ResourceType.Style);this._request=a.getJSON(v,(b,A)=>{this._request=null,b?this.fire(new a.ErrorEvent(b)):A&&this._load(A,g)})}loadJSON(s,h={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(s,h.validate!==!1)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(zn,!1)}_updateLayerCount(s,h){const g=h?1:-1;s.is3D()&&(this._num3DLayers+=g),s.type==="circle"&&(this._numCircleLayers+=g),s.type==="symbol"&&(this._numSymbolLayers+=g)}_load(s,h){if(h&&Fr(this,a.validateStyle(s)))return;this._loaded=!0,this.stylesheet=a.clone$1(s),this._updateMapProjection();for(const v in s.sources)this.addSource(v,s.sources[v],{validate:!1});this._changed=!1,s.sprite?this._loadSprite(s.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(s.glyphs);const g=eh(this.stylesheet.layers);this._order=g.map(v=>v.id),this._layers={},this._serializedLayers={};for(const v of g){const b=a.createStyleLayer(v);b.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=b,this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new q(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(s){this._spriteRequest=function(h,g,v){let b,A,C;const L=a.exported.devicePixelRatio>1?"@2x":"";let $=a.getJSON(g.transformRequest(g.normalizeSpriteURL(h,L,".json"),a.ResourceType.SpriteJSON),(ne,le)=>{$=null,C||(C=ne,b=le,H())}),U=a.getImage(g.transformRequest(g.normalizeSpriteURL(h,L,".png"),a.ResourceType.SpriteImage),(ne,le)=>{U=null,C||(C=ne,A=le,H())});function H(){if(C)v(C);else if(b&&A){const ne=a.exported.getImageData(A),le={};for(const fe in b){const{width:ce,height:de,x:X,y:ae,sdf:ge,pixelRatio:be,stretchX:Oe,stretchY:Re,content:De}=b[fe],Ue=new a.RGBAImage({width:ce,height:de});a.RGBAImage.copy(ne,Ue,{x:X,y:ae},{x:0,y:0},{width:ce,height:de}),le[fe]={data:Ue,pixelRatio:be,sdf:ge,stretchX:Oe,stretchY:Re,content:De}}v(null,le)}}return{cancel(){$&&($.cancel(),$=null),U&&(U.cancel(),U=null)}}}(s,this.map._requestManager,(h,g)=>{if(this._spriteRequest=null,h)this.fire(new a.ErrorEvent(h));else if(g)for(const v in g)this.imageManager.addImage(v,g[v]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(s){const h=this.getSource(s.source);if(!h)return;const g=s.sourceLayer;g&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(g)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${g}" does not exist on source "${h.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(s){const h=[];for(const g of s){const v=this._layers[g];v.type!=="custom"&&h.push(v.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(s){return!!this.terrain&&(typeof s.isLayerDraped=="function"?s.isLayerDraped():wn[s.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(s){if(!this._loaded)return;const h=this._changed;if(this._changed){const v=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(v.length||b.length)&&this._updateWorkerLayers(v,b);for(const A in this._updatedSources){const C=this._updatedSources[A];C==="reload"?this._reloadSource(A):C==="clear"&&this._clearSource(A)}this._updateTilesForChangedImages();for(const A in this._updatedPaintProps)this._layers[A].updateTransitions(s);this.light.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this._resetUpdates()}const g={};for(const v in this._sourceCaches){const b=this._sourceCaches[v];g[v]=b.used,b.used=!1}for(const v of this._order){const b=this._layers[v];if(b.recalculate(s,this._availableImages),!b.isHidden(s.zoom)){const C=this._getLayerSourceCache(b);C&&(C.used=!0)}const A=this.map.painter;if(A){const C=b.getProgramIds();if(!C)continue;const L=b.getProgramConfiguration(s.zoom);for(const $ of C)A.useProgram($,L)}}for(const v in g){const b=this._sourceCaches[v];g[v]!==b.used&&b.getSource().fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateWorkerLayers(s,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(s),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(s){if(this._checkLoaded(),Fr(this,a.validateStyle(s)))return!1;(s=a.clone$1(s)).layers=eh(s.layers);const h=function(v,b){if(!v)return[{command:wr.setStyle,args:[b]}];let A=[];try{if(!S(v.version,b.version))return[{command:wr.setStyle,args:[b]}];S(v.center,b.center)||A.push({command:wr.setCenter,args:[b.center]}),S(v.zoom,b.zoom)||A.push({command:wr.setZoom,args:[b.zoom]}),S(v.bearing,b.bearing)||A.push({command:wr.setBearing,args:[b.bearing]}),S(v.pitch,b.pitch)||A.push({command:wr.setPitch,args:[b.pitch]}),S(v.sprite,b.sprite)||A.push({command:wr.setSprite,args:[b.sprite]}),S(v.glyphs,b.glyphs)||A.push({command:wr.setGlyphs,args:[b.glyphs]}),S(v.transition,b.transition)||A.push({command:wr.setTransition,args:[b.transition]}),S(v.light,b.light)||A.push({command:wr.setLight,args:[b.light]}),S(v.fog,b.fog)||A.push({command:wr.setFog,args:[b.fog]}),S(v.projection,b.projection)||A.push({command:wr.setProjection,args:[b.projection]});const C={},L=[];(function(H,ne,le,fe){let ce;for(ce in ne=ne||{},H=H||{})H.hasOwnProperty(ce)&&(ne.hasOwnProperty(ce)||Za(ce,le,fe));for(ce in ne){if(!ne.hasOwnProperty(ce))continue;const de=ne[ce];H.hasOwnProperty(ce)?S(H[ce],de)||(H[ce].type==="geojson"&&de.type==="geojson"&&Dl(H,ne,ce)?le.push({command:wr.setGeoJSONSourceData,args:[ce,de.data]}):$u(ce,ne,le,fe)):Uu(ce,ne,le)}})(v.sources,b.sources,L,C);const $=[];v.layers&&v.layers.forEach(H=>{H.source&&C[H.source]?A.push({command:wr.removeLayer,args:[H.id]}):$.push(H)});let U=v.terrain;U&&C[U.source]&&(A.push({command:wr.setTerrain,args:[void 0]}),U=void 0),A=A.concat(L),S(U,b.terrain)||A.push({command:wr.setTerrain,args:[b.terrain]}),function(H,ne,le){ne=ne||[];const fe=(H=H||[]).map(to),ce=ne.map(to),de=H.reduce(ju,{}),X=ne.reduce(ju,{}),ae=fe.slice(),ge=Object.create(null);let be,Oe,Re,De,Ue,Ne,Ye;for(be=0,Oe=0;be<fe.length;be++)Re=fe[be],X.hasOwnProperty(Re)?Oe++:(le.push({command:wr.removeLayer,args:[Re]}),ae.splice(ae.indexOf(Re,Oe),1));for(be=0,Oe=0;be<ce.length;be++)Re=ce[ce.length-1-be],ae[ae.length-1-be]!==Re&&(de.hasOwnProperty(Re)?(le.push({command:wr.removeLayer,args:[Re]}),ae.splice(ae.lastIndexOf(Re,ae.length-Oe),1)):Oe++,Ne=ae[ae.length-be],le.push({command:wr.addLayer,args:[X[Re],Ne]}),ae.splice(ae.length-be,0,Re),ge[Re]=!0);for(be=0;be<ce.length;be++)if(Re=ce[be],De=de[Re],Ue=X[Re],!ge[Re]&&!S(De,Ue))if(S(De.source,Ue.source)&&S(De["source-layer"],Ue["source-layer"])&&S(De.type,Ue.type)){for(Ye in Fo(De.layout,Ue.layout,le,Re,null,wr.setLayoutProperty),Fo(De.paint,Ue.paint,le,Re,null,wr.setPaintProperty),S(De.filter,Ue.filter)||le.push({command:wr.setFilter,args:[Re,Ue.filter]}),S(De.minzoom,Ue.minzoom)&&S(De.maxzoom,Ue.maxzoom)||le.push({command:wr.setLayerZoomRange,args:[Re,Ue.minzoom,Ue.maxzoom]}),De)De.hasOwnProperty(Ye)&&Ye!=="layout"&&Ye!=="paint"&&Ye!=="filter"&&Ye!=="metadata"&&Ye!=="minzoom"&&Ye!=="maxzoom"&&(Ye.indexOf("paint.")===0?Fo(De[Ye],Ue[Ye],le,Re,Ye.slice(6),wr.setPaintProperty):S(De[Ye],Ue[Ye])||le.push({command:wr.setLayerProperty,args:[Re,Ye,Ue[Ye]]}));for(Ye in Ue)Ue.hasOwnProperty(Ye)&&!De.hasOwnProperty(Ye)&&Ye!=="layout"&&Ye!=="paint"&&Ye!=="filter"&&Ye!=="metadata"&&Ye!=="minzoom"&&Ye!=="maxzoom"&&(Ye.indexOf("paint.")===0?Fo(De[Ye],Ue[Ye],le,Re,Ye.slice(6),wr.setPaintProperty):S(De[Ye],Ue[Ye])||le.push({command:wr.setLayerProperty,args:[Re,Ye,Ue[Ye]]}))}else le.push({command:wr.removeLayer,args:[Re]}),Ne=ae[ae.lastIndexOf(Re)+1],le.push({command:wr.addLayer,args:[Ue,Ne]})}($,b.layers,A)}catch(C){console.warn("Unable to compute style diff:",C),A=[{command:wr.setStyle,args:[b]}]}return A}(this.serialize(),s).filter(v=>!(v.command in bn));if(h.length===0)return!1;const g=h.filter(v=>!(v.command in pr));if(g.length>0)throw new Error(`Unimplemented: ${g.map(v=>v.command).join(", ")}.`);return h.forEach(v=>{v.command!=="setTransition"&&v.command!=="setProjection"&&this[v.command].apply(this,v.args)}),this.stylesheet=s,this._updateMapProjection(),!0}addImage(s,h){return this.getImage(s)?this.fire(new a.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(s,h),this._afterImageUpdated(s),this)}updateImage(s,h){this.imageManager.updateImage(s,h)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s),this._afterImageUpdated(s),this):this.fire(new a.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(s,h,g={}){if(this._checkLoaded(),this.getSource(s)!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(a.validateSource,`sources.${s}`,h,null,g))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const v=ir(s,h,this.dispatcher,this);v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(s),source:v.serialize(),sourceId:s}));const b=A=>{const C=(A?"symbol:":"other:")+s,L=this._sourceCaches[C]=new a.SourceCache(C,v,A);(A?this._symbolSourceCaches:this._otherSourceCaches)[s]=L,L.style=this,L.onAdd(this.map)};b(!1),h.type!=="vector"&&h.type!=="geojson"||b(!0),v.onAdd&&v.onAdd(this.map),this._changed=!0}removeSource(s){this._checkLoaded();const h=this.getSource(s);if(!h)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===s)return this.fire(new a.ErrorEvent(new Error(`Source "${s}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.get().source===s)return this.fire(new a.ErrorEvent(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));const g=this._getSourceCaches(s);for(const v of g)delete this._sourceCaches[v.id],delete this._updatedSources[v.id],v.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles();return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(s,h){this._checkLoaded(),this.getSource(s).setData(h),this._changed=!0}getSource(s){const h=this._getSourceCache(s);return h&&h.getSource()}_getSources(){const s=[];for(const h in this._otherSourceCaches){const g=this._getSourceCache(h);g&&s.push(g.getSource())}return s}addLayer(s,h,g={}){this._checkLoaded();const v=s.id;if(this.getLayer(v))return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${v}" already exists on this map`)));let b;if(s.type==="custom"){if(Fr(this,a.validateCustomStyleLayer(s)))return;b=a.createStyleLayer(s)}else{if(typeof s.source=="object"&&(this.addSource(v,s.source),s=a.clone$1(s),s=a.extend(s,{source:v})),this._validate(a.validateLayer,`layers.${v}`,s,{arrayIndex:-1},g))return;b=a.createStyleLayer(s),this._validateLayer(b),b.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const A=h?this._order.indexOf(h):this._order.length;if(h&&A===-1)return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(A,0,v),this._layerOrderChanged=!0,this._layers[v]=b;const C=this._getLayerSourceCache(b);if(this._removedLayers[v]&&b.source&&C&&b.type!=="custom"){const L=this._removedLayers[v];delete this._removedLayers[v],L.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",C.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(s,h){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new a.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===h)return;const g=this._order.indexOf(s);this._order.splice(g,1);const v=h?this._order.indexOf(h):this._order.length;h&&v===-1?this.fire(new a.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(v,0,s),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(s){this._checkLoaded();const h=this._layers[s];if(!h)return void this.fire(new a.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);const g=this._order.indexOf(s);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=h,delete this._layers[s],delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(s){return this._layers[s]}hasLayer(s){return s in this._layers}hasLayerType(s){for(const h in this._layers)if(this._layers[h].type===s)return!0;return!1}setLayerZoomRange(s,h,g){this._checkLoaded();const v=this.getLayer(s);v?v.minzoom===h&&v.maxzoom===g||(h!=null&&(v.minzoom=h),g!=null&&(v.maxzoom=g),this._updateLayer(v)):this.fire(new a.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(s,h,g={}){this._checkLoaded();const v=this.getLayer(s);if(v){if(!S(v.filter,h))return h==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(a.validateFilter,`layers.${v.id}.filter`,h,{layerType:v.type},g)||(v.filter=a.clone$1(h),this._updateLayer(v)))}else this.fire(new a.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be filtered.`)))}getFilter(s){const h=this.getLayer(s);return h&&a.clone$1(h.filter)}setLayoutProperty(s,h,g,v={}){this._checkLoaded();const b=this.getLayer(s);b?S(b.getLayoutProperty(h),g)||(b.setLayoutProperty(h,g,v),this._updateLayer(b)):this.fire(new a.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(s,h){const g=this.getLayer(s);if(g)return g.getLayoutProperty(h);this.fire(new a.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style.`)))}setPaintProperty(s,h,g,v={}){this._checkLoaded();const b=this.getLayer(s);b?S(b.getPaintProperty(h),g)||(b.setPaintProperty(h,g,v)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new a.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(s,h){const g=this.getLayer(s);return g&&g.getPaintProperty(h)}setFeatureState(s,h){this._checkLoaded();const g=s.source,v=s.sourceLayer,b=this.getSource(g);if(!b)return void this.fire(new a.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const A=b.type;if(A==="geojson"&&v)return void this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(A==="vector"&&!v)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));s.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided.")));const C=this._getSourceCaches(g);for(const L of C)L.setFeatureState(v,s.id,h)}removeFeatureState(s,h){this._checkLoaded();const g=s.source,v=this.getSource(g);if(!v)return void this.fire(new a.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const b=v.type,A=b==="vector"?s.sourceLayer:void 0;if(b==="vector"&&!A)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof s.id!="string"&&typeof s.id!="number")return void this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const C=this._getSourceCaches(g);for(const L of C)L.removeFeatureState(A,s.id,h)}getFeatureState(s){this._checkLoaded();const h=s.source,g=s.sourceLayer,v=this.getSource(h);if(v){if(v.type!=="vector"||g)return s.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(g,s.id);this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const s={};for(const h in this._sourceCaches){const g=this._sourceCaches[h].getSource();s[g.id]||(s[g.id]=g.serialize())}return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:s,layers:this._serializeLayers(this._order)},h=>h!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0;const h=this._getLayerSourceCache(s);s.source&&!this._updatedSources[s.source]&&h&&h.getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",h.pause()),this._changed=!0,s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){const h=A=>this._layers[A].type==="fill-extrusion",g={},v=[];for(let A=this._order.length-1;A>=0;A--){const C=this._order[A];if(h(C)){g[C]=A;for(const L of s){const $=L[C];if($)for(const U of $)v.push(U)}}}v.sort((A,C)=>C.intersectionZ-A.intersectionZ);const b=[];for(let A=this._order.length-1;A>=0;A--){const C=this._order[A];if(h(C))for(let L=v.length-1;L>=0;L--){const $=v[L].feature;if(g[$.layer.id]<A)break;b.push($),v.pop()}else for(const L of s){const $=L[C];if($)for(const U of $)b.push(U.feature)}}return b}queryRenderedFeatures(s,h,g){h&&h.filter&&this._validate(a.validateFilter,"queryRenderedFeatures.filter",h.filter,null,h);const v={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const L of h.layers){const $=this._layers[L];if(!$)return this.fire(new a.ErrorEvent(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];v[$.source]=!0}}const b=[];h.availableImages=this._availableImages;const A=h&&h.layers?h.layers.some(L=>{const $=this.getLayer(L);return $&&$.is3D()}):this.has3DLayers(),C=Pt.createFromScreenPoints(s,g);for(const L in this._sourceCaches){const $=this._sourceCaches[L].getSource().id;h.layers&&!v[$]||b.push(an(this._sourceCaches[L],this._layers,this._serializedLayers,C,h,g,A,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(L,$,U,H,ne,le,fe){const ce={},de=le.queryRenderedSymbols(H),X=[];for(const ae of Object.keys(de).map(Number))X.push(fe[ae]);X.sort(hi);for(const ae of X){const ge=ae.featureIndex.lookupSymbolFeatures(de[ae.bucketInstanceId],$,ae.bucketIndex,ae.sourceLayerIndex,ne.filter,ne.layers,ne.availableImages,L);for(const be in ge){const Oe=ce[be]=ce[be]||[],Re=ge[be];Re.sort((De,Ue)=>{const Ne=ae.featureSortOrder;if(Ne){const Ye=Ne.indexOf(De.featureIndex);return Ne.indexOf(Ue.featureIndex)-Ye}return Ue.featureIndex-De.featureIndex});for(const De of Re)Oe.push(De)}}for(const ae in ce)ce[ae].forEach(ge=>{const be=ge.feature,Oe=U(L[ae]);if(!Oe)return;const Re=Oe.getFeatureState(be.layer["source-layer"],be.id);be.source=be.layer.source,be.layer["source-layer"]&&(be.sourceLayer=be.layer["source-layer"]),be.state=Re});return ce}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),C.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(s,h){h&&h.filter&&this._validate(a.validateFilter,"querySourceFeatures.filter",h.filter,null,h);const g=this._getSourceCaches(s);let v=[];for(const b of g)v=v.concat(In(b,h));return v}addSourceType(s,h,g){return Br.getSourceType(s)?g(new Error(`A source type called "${s}" already exists.`)):(Br.setSourceType(s,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:h.workerSourceURL},g):g(null,null))}getLight(){return this.light.getLight()}setLight(s,h={}){this._checkLoaded();const g=this.light.getLight();let v=!1;for(const A in s)if(!S(s[A],g[A])){v=!0;break}if(!v)return;const b=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(s,h),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(s,h=1){if(this._checkLoaded(),!s)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let g=s;if(h===1){if(typeof g.source=="object"){const v="terrain-dem-src";this.addSource(v,g.source),g=a.clone$1(g),g=a.extend(g,{source:v})}if(this._validate(a.validateTerrain,"terrain",g))return}if(!this.terrain||this.terrain&&h!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,h)}else{const v=this.terrain,b=v.get();for(const A of Object.keys(a.spec.terrain))!g.hasOwnProperty(A)&&a.spec.terrain[A].default&&(g[A]=a.spec.terrain[A].default);for(const A in g)if(!S(g[A],b[A])){v.set(g),this.stylesheet.terrain=g;const C=this._setTransitionParameters({duration:0});v.updateTransitions(C);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){const h=this.fog=new qe(s,this.map.transform);this.stylesheet.fog=s;const g=this._setTransitionParameters({duration:0});h.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog,g=h.get();Object.keys(s).length===0&&h.set(s);for(const v in s)if(!S(s[v],g[v])){h.set(s),this.stylesheet.fog=s;const b=this._setTransitionParameters({duration:0});h.updateTransitions(b);break}}else this._createFog(s);this._markersNeedUpdate=!0}_setTransitionParameters(s){return{now:a.exported.now(),transition:a.extend(s,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const s=this._order.filter(g=>this.isLayerDraped(this._layers[g])),h=this._order.filter(g=>!this.isLayerDraped(this._layers[g]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...h)}_createTerrain(s,h){const g=this.terrain=new Mt(s,h);this.stylesheet.terrain=s,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const v=this._setTransitionParameters({duration:0});g.updateTransitions(v)}_force3DLayerUpdate(){for(const s in this._layers){const h=this._layers[s];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const s in this._layers){const h=this._layers[s];h.type==="symbol"&&this._updateLayer(h)}}_validate(s,h,g,v,b={}){return(!b||b.validate!==!1)&&Fr(this,s.call(a.validateStyle,a.extend({key:h,style:this.serialize(),value:g,styleSpec:a.spec},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this._sourceCaches)this._sourceCaches[s].clearTiles(),this._sourceCaches[s].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(s){const h=this._getSourceCaches(s);for(const g of h)g.clearTiles()}_reloadSource(s){const h=this._getSourceCaches(s);for(const g of h)g.resume(),g.reload()}_reloadSources(){for(const s of this._getSources())s.reload&&s.reload()}_updateSources(s){for(const h in this._sourceCaches)this._sourceCaches[h].update(s)}_generateCollisionBoxes(){for(const s in this._sourceCaches){const h=this._sourceCaches[s];h.resume(),h.reload()}}_updatePlacement(s,h,g,v,b=!1){let A=!1,C=!1;const L={};for(const $ of this._order){const U=this._layers[$];if(U.type!=="symbol")continue;if(!L[U.source]){const ne=this._getLayerSourceCache(U);if(!ne)continue;L[U.source]=ne.getRenderableIds(!0).map(le=>ne.getTileByID(le)).sort((le,fe)=>fe.tileID.overscaledZ-le.tileID.overscaledZ||(le.tileID.isLessThan(fe.tileID)?-1:1))}const H=this.crossTileSymbolIndex.addLayer(U,L[U.source],s.center.lng,s.projection);A=A||H}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||g===0,this._layerOrderChanged&&this.fire(new a.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),s.zoom))&&(this.pauseablePlacement=new Hu(s,this._order,b,h,g,v,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,L),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),C=!0),A&&this.pauseablePlacement.placement.setStale()),C||A)for(const $ of this._order){const U=this._layers[$];U.type==="symbol"&&this.placement.updateLayerOpacities(U,L[U.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,h,g){this.imageManager.getImages(h.icons,g),this._updateTilesForChangedImages();const v=b=>{b&&b.setDependencies(h.tileID.key,h.type,h.icons)};v(this._otherSourceCaches[h.source]),v(this._symbolSourceCaches[h.source])}getGlyphs(s,h,g){this.glyphManager.getGlyphs(h.stacks,g)}getResource(s,h,g){return a.makeRequest(h,g)}_getSourceCache(s){return this._otherSourceCaches[s]}_getLayerSourceCache(s){return s.type==="symbol"?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}_getSourceCaches(s){const h=[];return this._otherSourceCaches[s]&&h.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&h.push(this._symbolSourceCaches[s]),h}_isSourceCacheLoaded(s){const h=this._getSourceCaches(s);return h.length===0?(this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${s}'`))),!1):h.every(g=>g.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Br.getSourceType=function(p){return nr[p]},Br.setSourceType=function(p,s){nr[p]=s},Br.registerForPluginStateChange=a.registerForPluginStateChange;var Si=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,ui="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",fn=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,di=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Fn=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let wo={},Di={};const Eo=[];Rl(Si,Eo),Rl(fn,Eo),Rl(di,Eo),Rl(Fn,Eo),wo=Nr("",fn),Di=Nr(Fn,di);const Xu=Nr(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Us=Si,va=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var ld={background:Nr(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Nr(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Nr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Nr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Nr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Nr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Nr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Nr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Nr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Nr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Nr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Nr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Nr(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Nr(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Nr(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Nr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Nr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Nr(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Nr(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Nr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Nr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Nr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Nr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Nr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Nr(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Nr(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ui),skyboxGradient:Nr(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ui),skyboxCapture:Nr(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Nr(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Nr(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Rl(p,s){const h=p.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let g of h)if(g=g.trim(),g[0]==="#"&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const v=g.split(" ");for(const b of v)s.includes(b)||s.push(b)}}function Nr(p,s){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=s.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),v={},b=[...Eo];return Rl(p,b),Rl(s,b),{fragmentSource:p=p.replace(h,(A,C,L,$,U)=>(v[U]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${U}
varying ${L} ${$} ${U};
#else
uniform ${L} ${$} u_${U};
#endif
`:`
#ifdef HAS_UNIFORM_u_${U}
    ${L} ${$} ${U} = u_${U};
#endif
`)),vertexSource:s=s.replace(h,(A,C,L,$,U)=>{const H=$==="float"?"vec2":"vec4",ne=U.match(/color/)?"color":H;return v[U]?C==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
attribute ${L} ${H} a_${U};
varying ${L} ${$} ${U};
#else
uniform ${L} ${$} u_${U};
#endif
`:ne==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = a_${U};
#else
    ${L} ${$} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = unpack_mix_${ne}(a_${U}, u_${U}_t);
#else
    ${L} ${$} ${U} = u_${U};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
attribute ${L} ${H} a_${U};
#else
uniform ${L} ${$} u_${U};
#endif
`:ne==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${L} ${$} ${U} = a_${U};
#else
    ${L} ${$} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${L} ${$} ${U} = unpack_mix_${ne}(a_${U}, u_${U}_t);
#else
    ${L} ${$} ${U} = u_${U};
#endif
`}),staticAttributes:g,usedDefines:b}}class s0{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,h,g,v,b,A,C){this.context=s;let L=this.boundPaintVertexBuffers.length!==v.length;for(let U=0;!L&&U<v.length;U++)this.boundPaintVertexBuffers[U]!==v[U]&&(L=!0);let $=this.boundDynamicVertexBuffers.length!==C.length;for(let U=0;!$&&U<C.length;U++)this.boundDynamicVertexBuffers[U]!==C[U]&&($=!0);if(!s.extVertexArrayObject||!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==g||L||$||this.boundIndexBuffer!==b||this.boundVertexOffset!==A)this.freshBind(h,g,v,b,A,C);else{s.bindVertexArrayOES.set(this.vao);for(const U of C)U&&U.bind();b&&b.dynamicDraw&&b.bind()}}freshBind(s,h,g,v,b,A){let C;const L=s.numAttributes,$=this.context,U=$.gl;if($.extVertexArrayObject)this.vao&&this.destroy(),this.vao=$.extVertexArrayObject.createVertexArrayOES(),$.bindVertexArrayOES.set(this.vao),C=0,this.boundProgram=s,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=A;else{C=$.currentNumAttributes||0;for(let H=L;H<C;H++)U.disableVertexAttribArray(H)}h.enableAttributes(U,s),h.bind(),h.setVertexAttribPointers(U,s,b);for(const H of g)H.enableAttributes(U,s),H.bind(),H.setVertexAttribPointers(U,s,b);for(const H of A)H&&(H.enableAttributes(U,s),H.bind(),H.setVertexAttribPointers(U,s,b));v&&v.bind(),$.currentNumAttributes=L}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function ud(p,s){const h=Math.pow(2,s.canonical.z),g=s.canonical.y;return[new a.MercatorCoordinate(0,g/h).toLngLat().lat,new a.MercatorCoordinate(0,(g+1)/h).toLngLat().lat]}function Wm(p,s,h,g,v,b,A){const C=p.context,L=C.gl,$=h.fbo;if(!$)return;p.prepareDrawTile();const U=p.useProgram("hillshade");C.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,$.colorAttachment.get());const H=((ce,de,X,ae)=>{const ge=X.paint.get("hillshade-shadow-color"),be=X.paint.get("hillshade-highlight-color"),Oe=X.paint.get("hillshade-accent-color");let Re=X.paint.get("hillshade-illumination-direction")*(Math.PI/180);X.paint.get("hillshade-illumination-anchor")==="viewport"&&(Re-=ce.transform.angle);const De=!ce.options.moving;return{u_matrix:ae||ce.transform.calculateProjMatrix(de.tileID.toUnwrapped(),De),u_image:0,u_latrange:ud(0,de.tileID),u_light:[X.paint.get("hillshade-exaggeration"),Re],u_shadow:ge,u_highlight:be,u_accent:Oe}})(p,h,g,p.terrain?s.projMatrix:null);p.prepareDrawProgram(C,U,s.toUnwrapped());const{tileBoundsBuffer:ne,tileBoundsIndexBuffer:le,tileBoundsSegments:fe}=p.getTileBoundsBuffers(h);U.draw(C,L.TRIANGLES,v,b,A,a.CullFaceMode.disabled,H,g.id,ne,le,fe)}function cd(p,s,h){if(!s.needsDEMTextureUpload)return;const g=p.context,v=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||p.getTileTexture(h.stride);const b=h.getPixels();s.demTexture?s.demTexture.update(b,{premultiply:!1}):s.demTexture=new a.Texture(g,b,v.RGBA,{premultiply:!1}),s.needsDEMTextureUpload=!1}function Zm(p,s,h,g,v,b){const A=p.context,C=A.gl;if(!s.dem)return;const L=s.dem;if(A.activeTexture.set(C.TEXTURE1),cd(p,s,L),!s.demTexture)return;s.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);const $=L.dim;A.activeTexture.set(C.TEXTURE0);let U=s.fbo;if(!U){const fe=new a.Texture(A,{width:$,height:$,data:null},C.RGBA);fe.bind(C.LINEAR,C.CLAMP_TO_EDGE),U=s.fbo=A.createFramebuffer($,$,!0),U.colorAttachment.set(fe.texture)}A.bindFramebuffer.set(U.framebuffer),A.viewport.set([0,0,$,$]);const{tileBoundsBuffer:H,tileBoundsIndexBuffer:ne,tileBoundsSegments:le}=p.getMercatorTileBoundsBuffers();p.useProgram("hillshadePrepare").draw(A,C.TRIANGLES,g,v,b,a.CullFaceMode.disabled,((fe,ce)=>{const de=ce.stride,X=a.create();return a.ortho(X,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(X,X,[0,-a.EXTENT,0]),{u_matrix:X,u_image:1,u_dimension:[de,de],u_zoom:fe.overscaledZ,u_unpack:ce.unpackVector}})(s.tileID,L),h.id,H,ne,le),s.needsHillshadePrepare=!1}const hd=p=>({u_matrix:new a.UniformMatrix4f(p),u_image0:new a.Uniform1i(p),u_skirt_height:new a.Uniform1f(p)}),zl=(p,s)=>({u_matrix:p,u_image0:0,u_skirt_height:s}),nh=(p,s,h,g,v,b,A,C,L,$,U,H,ne,le,fe)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:h,u_zoom_transition:v,u_merc_center:b,u_image0:0,u_frustum_tl:A,u_frustum_tr:C,u_frustum_br:L,u_frustum_bl:$,u_globe_pos:U,u_globe_radius:H,u_viewport:ne,u_grid_matrix:fe?Float32Array.from(fe):new Float32Array(9),u_skirt_height:le});function Fl(p,s){return p!=null&&s!=null&&!(!p.hasData()||!s.hasData())&&p.demTexture!=null&&s.demTexture!=null&&p.tileID.key!==s.tileID.key}const $s=new class{constructor(){this.operations={}}newMorphing(p,s,h,g,v){if(p in this.operations){const b=this.operations[p];b.to.tileID.key!==h.tileID.key&&(b.queued=h)}else this.operations[p]={startTime:g,phase:0,duration:v,from:s,to:h,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const s=this.operations[p];return{from:s.from,to:s.to,phase:s.phase}}update(p){for(const s in this.operations){const h=this.operations[s];for(h.phase=(p-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,p)){delete this.operations[s];break}}}_nextOp(p,s){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=s,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},rl={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ih(p){return 6*Math.pow(1.5,22-p)}function Hm(p,s){const h=1<<p.z;return!s&&(p.x===0||p.x===h-1)||p.y===0||p.y===h-1}const Ku=p=>({u_matrix:p});function fd(p,s,h,g,v){if(v>0){const b=a.exported.now(),A=(b-p.timeAdded)/v,C=s?(b-s.timeAdded)/v:-1,L=h.getSource(),$=g.coveringZoomLevel({tileSize:L.tileSize,roundZoom:L.roundZoom}),U=!s||Math.abs(s.tileID.overscaledZ-$)>Math.abs(p.tileID.overscaledZ-$),H=U&&p.refreshedUponExpiration?1:a.clamp(U?A:1-C,0,1);return p.refreshedUponExpiration&&A>=1&&(p.refreshedUponExpiration=!1),s?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}class dd extends a.SourceCache{constructor(s){const h={type:"raster-dem",maxzoom:s.transform.maxZoom},g=new Pe(ga(),null),v=ir("mock-dem",h,g,s.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,h){s.state="loaded",h(null)}}class oh extends a.SourceCache{constructor(s){const h=ir("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},new Pe(ga(),null),s.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,h,g){if(s.freezeTileCoverage)return;this.transform=s;const v=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,A)=>{if(b[A.key]="",!this._tiles[A.key]){const C=new a.Tile(A,this._source.tileSize*A.overscaleFactor(),s.tileZoom);C.state="loaded",this._tiles[A.key]=C}return b},{});for(const b in this._tiles)b in v||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(s){const h=this.proxyCachedFBO[s];if(h!==void 0){const g=Object.values(h);this.renderCachePool.push(...g),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class sh extends a.OverscaledTileID{constructor(s,h,g){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=h,this.projMatrix=g}}class pd extends a.Elevation{constructor(s,h){super(),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,v,b]=function(L){const $=new a.StructArrayLayout2i4,U=new a.StructArrayLayout3ui6,H=131;$.reserve(17161),U.reserve(33800);const ne=a.EXTENT/128,le=a.EXTENT+ne/2,fe=le+ne;for(let de=-ne;de<fe;de+=ne)for(let X=-ne;X<fe;X+=ne){const ae=X<0||X>le||de<0||de>le?24575:0,ge=a.clamp(Math.round(X),0,a.EXTENT),be=a.clamp(Math.round(de),0,a.EXTENT);$.emplaceBack(ge+ae,be)}const ce=(de,X)=>{const ae=X*H+de;U.emplaceBack(ae+1,ae,ae+H),U.emplaceBack(ae+H,ae+H+1,ae+1)};for(let de=1;de<129;de++)for(let X=1;X<129;X++)ce(X,de);return[0,129].forEach(de=>{for(let X=0;X<130;X++)ce(X,de),ce(de,X)}),[$,U,32768]}(),A=s.context;this.gridBuffer=A.createVertexBuffer(g,a.posAttributes.members),this.gridIndexBuffer=A.createIndexBuffer(v),this.gridSegments=a.SegmentVector.simpleSegment(0,0,g.length,v.length),this.gridNoSkirtSegments=a.SegmentVector.simpleSegment(0,0,g.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new oh(h.map),this.orthoMatrix=a.create(),a.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,a.EXTENT,0,a.EXTENT,0,1);const C=A.gl;this._overlapStencilMode=new a.StencilMode({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new dd(h.map)}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),s.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=s,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(s,h,g){if(s&&s.terrain){this._style!==s&&(this.style=s),this.enabled=!0;const v=s.terrain.properties;this.sourceCache=s.terrain.drapeRenderMode===0?this._mockSourceCache:s._getSourceCache(v.get("source")),this._exaggeration=v.get("exaggeration");const b=()=>{this.sourceCache.used&&a.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const A=this.getScaledDemTileSize();this.sourceCache.update(h,A,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),h.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const s=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||s.efficiency!==100&&a.warnOnce(`Terrain render cache efficiency is not optimal (${s.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${s.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(s){s.coord&&s.dataType==="source"?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):s.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const s in this._style._sourceCaches)this._style._sourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=h.getIds().map(L=>{const $=h.getTileByID(L).tileID;return $.projMatrix=g.calculateProjMatrix($.toUnwrapped()),$});(function(L,$){const U=$.transform.pointCoordinate($.transform.getCameraPoint()),H=new a.Point(U.x,U.y);L.sort((ne,le)=>{if(le.overscaledZ-ne.overscaledZ)return le.overscaledZ-ne.overscaledZ;const fe=new a.Point(ne.canonical.x+(1<<ne.canonical.z)*ne.wrap,ne.canonical.y),ce=new a.Point(le.canonical.x+(1<<le.canonical.z)*le.wrap,le.canonical.y),de=H.mult(1<<ne.canonical.z);return de.x-=.5,de.y-=.5,de.distSqr(fe)-de.distSqr(ce)})})(v,this.painter),this._previousZoom=g.zoom;const b=this.proxyToSource||{};this.proxyToSource={},v.forEach(L=>{this.proxyToSource[L.key]={}}),this.terrainTileForTile={};const A=this._style._sourceCaches;for(const L in A){const $=A[L];if(!$.used||($!==this.sourceCache&&this.resetTileLookupCache($.id),this._setupProxiedCoordsForOrtho($,s[L],b),$.usedForTerrain))continue;const U=s[L];$.getSource().reparseOverscaled&&this._assignTerrainTiles(U)}this.proxiedCoords[h.id]=v.map(L=>new sh(L,L.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=a.exported.now();const C={};this._visibleDemTiles=[];for(const L of this.proxyCoords){const $=this.terrainTileForTile[L.key];if(!$)continue;const U=$.tileID.key;U in C||(this._visibleDemTiles.push($),C[U]=U)}}_assignTerrainTiles(s){this._initializing||s.forEach(h=>{if(this.terrainTileForTile[h.key])return;const g=this._findTileCoveringTileID(h,this.sourceCache);g&&(this.terrainTileForTile[h.key]=g)})}_prepareDEMTextures(){const s=this.painter.context,h=s.gl;for(const g in this.terrainTileForTile){const v=this.terrainTileForTile[g],b=v.dem;!b||v.demTexture&&!v.needsDEMTextureUpload||(s.activeTexture.set(h.TEXTURE1),cd(this.painter,v,b))}}_prepareDemTileUniforms(s,h,g,v){if(!h||h.demTexture==null)return!1;const b=s.tileID.canonical,A=Math.pow(2,h.tileID.canonical.z-b.z),C=v||"";return g[`u_dem_tl${C}`]=[b.x*A%1,b.y*A%1],g[`u_dem_scale${C}`]=A,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const s=this.painter.context,h=s.gl;if(!this._emptyDepthBufferTexture){const g=new a.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new a.Texture(s,g,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let s=0;const h=this._visibleDemTiles.reduce((g,v)=>{if(!v.dem)return g;const b=v.dem.tree.minimums[0];return b>0&&s++,g+b},0);return s?h/s:0}_updateEmptyDEMTexture(){const s=this.painter.context,h=s.gl;s.activeTexture.set(h.TEXTURE2);const g=this._getLoadedAreaMinimum(),v=new a.RGBAImage({width:1,height:1},new Uint8Array(a.DEMData.pack(g,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(v,{premultiply:!1}):b=this._emptyDEMTexture=new a.Texture(s,v,h.RGBA,{premultiply:!1}),b}setupElevationDraw(s,h,g){const v=this.painter.context,b=v.gl,A=(C=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:a.DEMData.getUnpackVector(C),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var C;A.u_dem_size=this.sourceCache.getSource().tileSize,A.u_exaggeration=this.exaggeration();let L=null,$=null,U=1;if(g&&g.morphing&&this._useVertexMorphing){const H=g.morphing.srcDemTile,ne=g.morphing.dstDemTile;U=g.morphing.phase,H&&ne&&(this._prepareDemTileUniforms(s,H,A,"_prev")&&($=H),this._prepareDemTileUniforms(s,ne,A)&&(L=ne))}if($&&L?(v.activeTexture.set(b.TEXTURE2),L.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),v.activeTexture.set(b.TEXTURE4),$.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),A.u_dem_lerp=U):(L=this.terrainTileForTile[s.tileID.key],v.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(s,L,A)?L.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),v.activeTexture.set(b.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),this._depthFBO&&(A.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),A.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&L){const H=(1<<L.tileID.canonical.z)*a.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;A.u_meter_to_dem=H}if(g&&g.labelPlaneMatrixInv&&(A.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),h.setTerrainUniformValues(v,A),this.painter.transform.projection.name==="globe"){const H=this.globeUniformValues(this.painter.transform,s.tileID.canonical,g&&g.useDenormalizedUpVectorScale);h.setGlobeUniformValues(v,H)}}globeUniformValues(s,h,g){const v=s.projection;return{u_tile_tl_up:v.upVector(h,0,0),u_tile_tr_up:v.upVector(h,a.EXTENT,0),u_tile_br_up:v.upVector(h,a.EXTENT,a.EXTENT),u_tile_bl_up:v.upVector(h,0,a.EXTENT),u_tile_up_scale:g?a.globeMetersToEcef(1):v.upVectorScale(h,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){const h=this.painter,g=this.painter.context;s.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,b,A,C,L){if(v.transform.projection.name==="globe")(function($,U,H,ne,le){const fe=$.context,ce=fe.gl;let de,X;const ae=$.options.showTerrainWireframe?2:0,ge=$.transform,be=a.globeUseCustomAntiAliasing($,fe,ge),Oe=(_t,Xe)=>{if(X===_t)return;const ut=[rl[_t],"PROJECTION_GLOBE_VIEW"];be&&ut.push("CUSTOM_ANTIALIASING"),Xe&&ut.push(rl[ae]),de=$.useProgram("globeRaster",null,ut),X=_t},Re=$.colorModeForRenderPass(),De=new a.DepthMode(ce.LEQUAL,a.DepthMode.ReadWrite,$.depthRangeFor3D);$s.update(le);const Ue=a.calculateGlobeMercatorMatrix(ge),Ne=[a.mercatorXfromLng(ge.center.lng),a.mercatorYfromLat(ge.center.lat)],Ye=ae?[!1,!0]:[!1],vt=$.globeSharedBuffers,We=[ge.width*a.exported.devicePixelRatio,ge.height*a.exported.devicePixelRatio],ht=Float32Array.from(ge.globeMatrix),rt={useDenormalizedUpVectorScale:!0};if(Ye.forEach(_t=>{const Xe=$.transform,ut=ih(Xe.zoom)*U.exaggeration();X=-1;const bt=_t?ce.LINES:ce.TRIANGLES;for(const pt of ne){const Tt=H.getTile(pt),Wt=a.StencilMode.disabled,or=U.prevTerrainTileForTile[pt.key],jt=U.terrainTileForTile[pt.key];Fl(or,jt)&&$s.newMorphing(pt.key,or,jt,le,250),fe.activeTexture.set(ce.TEXTURE0),Tt.texture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE);const Yt=$s.getMorphValuesForProxy(pt.key),vr=Yt?1:0;Yt&&a.extend$1(rt,{morphing:{srcDemTile:Yt.from,dstDemTile:Yt.to,phase:a.easeCubicInOut(Yt.phase)}});const yr=a.tileCornersToBounds(pt.canonical),qt=a.getLatitudinalLod(yr.getCenter().lat),$r=a.getGridMatrix(pt.canonical,yr,qt,Xe.worldSize/Xe._pixelsPerMercatorPixel),Gr=a.globeNormalizeECEF(a.globeTileBounds(pt.canonical)),qr=nh(Xe.projMatrix,ht,Ue,Gr,a.globeToMercatorTransition(Xe.zoom),Ne,Xe.frustumCorners.TL,Xe.frustumCorners.TR,Xe.frustumCorners.BR,Xe.frustumCorners.BL,Xe.globeCenterInViewSpace,Xe.globeRadius,We,ut,$r);if(Oe(vr,_t),U.setupElevationDraw(Tt,de,rt),$.prepareDrawProgram(fe,de,pt.toUnwrapped()),vt){const[Wr,zi,mi]=_t?vt.getWirefameBuffers($.context,qt):vt.getGridBuffers(qt,ut!==0);de.draw(fe,bt,De,Wt,Re,a.CullFaceMode.backCCW,qr,"globe_raster",Wr,zi,mi)}}}),vt){const _t=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];be&&_t.push("CUSTOM_ANTIALIASING"),de=$.useProgram("globeRaster",null,_t);for(const Xe of ne){const{x:ut,y:bt,z:pt}=Xe.canonical,Tt=bt===0,Wt=bt===(1<<pt)-1,[or,jt,Yt,vr]=vt.getPoleBuffers(pt);if(vr&&(Tt||Wt)){const yr=H.getTile(Xe);fe.activeTexture.set(ce.TEXTURE0),yr.texture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE);let qt=a.globePoleMatrixForTile(pt,ut,ge);const $r=a.globeNormalizeECEF(a.globeTileBounds(Xe.canonical)),Gr=(qr,Wr)=>qr.draw(fe,ce.TRIANGLES,De,a.StencilMode.disabled,Re,a.CullFaceMode.disabled,nh(ge.projMatrix,qt,qt,$r,0,Ne,ge.frustumCorners.TL,ge.frustumCorners.TR,ge.frustumCorners.BR,ge.frustumCorners.BL,ge.globeCenterInViewSpace,ge.globeRadius,We,0),"globe_pole_raster",Wr,Yt,vr);U.setupElevationDraw(yr,de,rt),$.prepareDrawProgram(fe,de,Xe.toUnwrapped()),Tt&&Gr(de,or),Wt&&(qt=a.scale(a.create(),qt,[1,-1,1]),Gr(de,jt))}}}})(v,b,A,C,L);else{const $=v.context,U=$.gl;let H,ne;const le=v.options.showTerrainWireframe?2:0,fe=(ge,be)=>{if(ne===ge)return;const Oe=[rl[ge]];be&&Oe.push(rl[le]),H=v.useProgram("terrainRaster",null,Oe),ne=ge},ce=v.colorModeForRenderPass(),de=new a.DepthMode(U.LEQUAL,a.DepthMode.ReadWrite,v.depthRangeFor3D);$s.update(L);const X=v.transform,ae=ih(X.zoom)*b.exaggeration();(le?[!1,!0]:[!1]).forEach(ge=>{ne=-1;const be=ge?U.LINES:U.TRIANGLES,[Oe,Re]=ge?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const De of C){const Ue=A.getTile(De),Ne=a.StencilMode.disabled,Ye=b.prevTerrainTileForTile[De.key],vt=b.terrainTileForTile[De.key];Fl(Ye,vt)&&$s.newMorphing(De.key,Ye,vt,L,250),$.activeTexture.set(U.TEXTURE0),Ue.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE,U.LINEAR_MIPMAP_NEAREST);const We=$s.getMorphValuesForProxy(De.key),ht=We?1:0;let rt;We&&(rt={morphing:{srcDemTile:We.from,dstDemTile:We.to,phase:a.easeCubicInOut(We.phase)}});const _t=zl(De.projMatrix,Hm(De.canonical,X.renderWorldCopies)?ae/10:ae);fe(ht,ge),b.setupElevationDraw(Ue,H,rt),v.prepareDrawProgram($,H,De.toUnwrapped()),H.draw($,be,de,Ne,ce,a.CullFaceMode.backCCW,_t,"terrain_raster",b.gridBuffer,Oe,Re)}})}}(h,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(this._drapedRenderBatches.length===0)return s+1;this.renderingToTexture=!0;const h=this.painter,g=this.painter.context,v=this.proxySourceCache,b=this.proxiedCoords[v.id],A=this._drapedRenderBatches.shift(),C=[],L=h.style.order;let $=0;for(const U of b){const H=v.getTileByID(U.proxyTileKey),ne=v.proxyCachedFBO[U.key]?v.proxyCachedFBO[U.key][s]:void 0,le=ne!==void 0?v.renderCache[ne]:this.pool[$++],fe=ne!==void 0;if(H.texture=le.tex,fe&&!le.dirty){C.push(H.tileID);continue}let ce;g.bindFramebuffer.set(le.fb.framebuffer),this.renderedToTile=!1,le.dirty&&(g.clear({color:a.Color.transparent,stencil:0}),le.dirty=!1);for(let de=A.start;de<=A.end;++de){const X=h.style._layers[L[de]];if(X.isHidden(h.transform.zoom))continue;const ae=h.style._getLayerSourceCache(X),ge=ae?this.proxyToSource[U.key][ae.id]:[U];if(!ge)continue;const be=ge;g.viewport.set([0,0,le.fb.width,le.fb.height]),ce!==(ae?ae.id:null)&&(this._setupStencil(le,ge,X,ae),ce=ae?ae.id:null),h.renderLayer(h,ae,X,be)}this.renderedToTile?(le.dirty=!0,C.push(H.tileID)):fe||--$,$===5&&($=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),A.end+1}postRender(){}renderCacheEfficiency(s){const h=s.order.length;if(h===0)return{efficiency:100};let g,v=0,b=0,A=!1;for(let C=0;C<h;++C){const L=s._layers[s.order[C]];this._style.isLayerDraped(L)?(A&&++v,++b):A||(A=!0,g=L.id)}return b===0?{efficiency:100}:{efficiency:100*(1-v/b),firstUndrapedLayer:g}}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{s=Math.min(s,h.dem.tree.minimums[0])}),s===0?s:(s-30)*this._exaggeration}raycast(s,h,g){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const A=b.tileID,C=1<<A.overscaledZ,{x:L,y:$}=A.canonical,U=L/C,H=(L+1)/C,ne=$/C,le=($+1)/C;return{minx:U,miny:ne,maxx:H,maxy:le,t:b.dem.tree.raycastRoot(U,ne,H,le,s,h,g),tile:b}});v.sort((b,A)=>(b.t!==null?b.t:Number.MAX_VALUE)-(A.t!==null?A.t:Number.MAX_VALUE));for(const b of v){if(b.t==null)return null;const A=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,s,h,g);if(A!=null)return A}return null}_createFBO(){const s=this.painter.context,h=s.gl,g=this.drapeBufferSize;s.activeTexture.set(h.TEXTURE0);const v=new a.Texture(s,{width:g[0],height:g[1],data:null},h.RGBA);v.bind(h.LINEAR,h.CLAMP_TO_EDGE);const b=s.createFramebuffer(g[0],g[1],!1);return b.colorAttachment.set(v.texture),b.depthAttachment=new ze(s,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&!s.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:b,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const s in this._style._sourceCaches)if(this._style._sourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{const h=this._style._layers[s],g=h.isHidden(this.painter.transform.zoom);return h.type==="custom"?!g&&h.shouldRedrape():!g&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let s=!1;for(const g of this._style._getSources())if(g instanceof kt){s=!0;break}if(!s)return;const h={};for(let g=0;g<this._style.order.length;++g){const v=this._style._layers[this._style.order[g]],b=this._style._getLayerSourceCache(v);if(b&&!h[b.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof a.ZoomDependentExpression){h[b.id]=!0;for(const A of this.proxyCoords){const C=this.proxyToSource[A.key][b.id];if(C)for(const L of C)this._clearRenderCacheForTile(b.id,L)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(const g in this._style._sourceCaches)if(this._style._sourceCaches[g]._source instanceof wt){s=!0;break}if(!s)return;const h={};for(let g=0;g<this._style.order.length;++g){const v=this._style._layers[this._style.order[g]],b=this._style._getLayerSourceCache(v);if(!b||h[b.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;const A=v.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const L=this.proxyToSource[C.key][b.id];if(L)for(const $ of L){const U=fd(b.getTile($),b.findLoadedParent($,0),b,this.painter.transform,A);(U.opacity!==1||U.mix!==0)&&this._clearRenderCacheForTile(b.id,$)}}}}_setupDrapedRenderBatches(){const s=this._style.order,h=s.length;if(h===0)return;const g=[];let v,b=0,A=this._style._layers[s[b]];for(;!this._style.isLayerDraped(A)&&A.isHidden(this.painter.transform.zoom)&&++b<h;)A=this._style._layers[s[b]];for(;b<h;++b){const C=this._style._layers[s[b]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?v===void 0&&(v=b):v!==void 0&&(g.push({start:v,end:b-1}),v=void 0))}v!==void 0&&g.push({start:v,end:b-1}),this._drapedRenderBatches=g}_setupRenderCache(s){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const A=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let C=0;C<A.length;++C){const L=Object.values(A[C]);h.renderCachePool.push(...L)}}return}this._clearRasterLayersFromRenderCache();const g=this.proxyCoords,v=this._tilesDirty;for(let A=g.length-1;A>=0;A--){const C=g[A];if(h.getTileByID(C.key),h.proxyCachedFBO[C.key]!==void 0){const L=s[C.key],$=this.proxyToSource[C.key];let U=0;for(const H in $){const ne=$[H],le=L[H];if(!le||le.length!==ne.length||ne.some((fe,ce)=>fe!==le[ce]||v[H]&&v[H].hasOwnProperty(fe.key))){U=-1;break}++U}for(const H in h.proxyCachedFBO[C.key])h.renderCache[h.proxyCachedFBO[C.key][H]].dirty=U<0||U!==Object.values(L).length}}const b=[...this._drapedRenderBatches];b.sort((A,C)=>C.end-C.start-(A.end-A.start));for(const A of b)for(const C of g){if(h.proxyCachedFBO[C.key])continue;let L=h.renderCachePool.pop();L===void 0&&h.renderCache.length<50&&(L=h.renderCache.length,h.renderCache.push(this._createFBO())),L!==void 0&&(h.proxyCachedFBO[C.key]={},h.proxyCachedFBO[C.key][A.start]=L,h.renderCache[L].dirty=!0)}this._tilesDirty={}}_setupStencil(s,h,g,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,A=b.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let C;if(g.isTileClipped())C=h.length,this._overlapStencilMode.test={func:A.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:A.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):a.StencilMode.disabled}_renderTileClippingMasks(s,h){const g=this.painter,v=this.painter.context,b=v.gl;g._tileClippingMaskIDs={},v.setColorMode(a.ColorMode.disabled),v.setDepthMode(a.DepthMode.disabled);const A=g.useProgram("clippingMask");for(const C of s){const L=g._tileClippingMaskIDs[C.key]=--h;A.draw(v,b.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:b.ALWAYS,mask:0},L,255,b.KEEP,b.KEEP,b.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,Ku(C.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(s){const h=this.painter.transform;if(s.x<0||s.x>h.width||s.y<0||s.y>h.height)return null;const g=[s.x,s.y,1,1];a.transformMat4$1(g,g,h.pixelMatrixInverse),a.scale$1(g,g,1/g[3]),g[0]/=h.worldSize,g[1]/=h.worldSize;const v=h._camera.position,b=a.mercatorZfromAltitude(1,h.center.lat),A=[v[0],v[1],v[2]/b,0],C=a.subtract([],g.slice(0,3),A);a.normalize(C,C);const L=this.raycast(A,C,this._exaggeration);return L!==null&&L?(a.scaleAndAdd(A,A,C,L),A[3]=A[2],A[2]*=b,A):null}drawDepth(){const s=this.painter,h=s.context,g=this.proxySourceCache,v=Math.ceil(s.width),b=Math.ceil(s.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===b||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const A=h.gl,C=h.createFramebuffer(v,b,!0);h.activeTexture.set(A.TEXTURE0);const L=new a.Texture(h,{width:v,height:b,data:null},A.RGBA);L.bind(A.NEAREST,A.CLAMP_TO_EDGE),C.colorAttachment.set(L.texture);const $=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,v,b);C.depthAttachment.set($),this._depthFBO=C,this._depthTexture=L}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,v,b]),function(A,C,L,$){if(A.transform.projection.name==="globe")return;const U=A.context,H=U.gl;U.clear({depth:1});const ne=A.useProgram("terrainDepth"),le=new a.DepthMode(H.LESS,a.DepthMode.ReadWrite,A.depthRangeFor3D);for(const fe of $){const ce=L.getTile(fe),de=zl(fe.projMatrix,0);C.setupElevationDraw(ce,ne),ne.draw(U,H.TRIANGLES,le,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.backCCW,de,"terrain_depth",C.gridBuffer,C.gridIndexBuffer,C.gridNoSkirtSegments)}}(s,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(s,h,g){if(s.getSource()instanceof dr)return this._setupProxiedCoordsForImageSource(s,h,g);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};const v=this.proxiedCoords[s.id]=[],b=this.proxyCoords;for(let C=0;C<b.length;C++){const L=b[C],$=this._findTileCoveringTileID(L,s);if($){const U=this._createProxiedId(L,$,g[L.key]&&g[L.key][s.id]);v.push(U),this.proxyToSource[L.key][s.id]=[U]}}let A=!1;for(let C=0;C<h.length;C++){const L=s.getTile(h[C]);if(!L||!L.hasData())continue;const $=this._findTileCoveringTileID(L.tileID,this.proxySourceCache);if($&&$.tileID.canonical.z!==L.tileID.canonical.z){const U=this.proxyToSource[$.tileID.key][s.id],H=this._createProxiedId($.tileID,L,g[$.tileID.key]&&g[$.tileID.key][s.id]);U?U.splice(U.length-1,0,H):this.proxyToSource[$.tileID.key][s.id]=[H],v.push(H),A=!0}}this._sourceTilesOverlap[s.id]=A}_setupProxiedCoordsForImageSource(s,h,g){if(!s.getSource().loaded())return;const v=this.proxiedCoords[s.id]=[],b=this.proxyCoords,A=s.getSource(),C=new a.Point(A.tileID.x,A.tileID.y)._div(1<<A.tileID.z),L=A.coordinates.map(a.MercatorCoordinate.fromLngLat).reduce((U,H)=>(U.min.x=Math.min(U.min.x,H.x-C.x),U.min.y=Math.min(U.min.y,H.y-C.y),U.max.x=Math.max(U.max.x,H.x-C.x),U.max.y=Math.max(U.max.y,H.y-C.y),U),{min:new a.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),$=(U,H)=>{const ne=U.wrap+U.canonical.x/(1<<U.canonical.z),le=U.canonical.y/(1<<U.canonical.z),fe=a.EXTENT/(1<<U.canonical.z),ce=H.wrap+H.canonical.x/(1<<H.canonical.z),de=H.canonical.y/(1<<H.canonical.z);return ne+fe<ce+L.min.x||ne>ce+L.max.x||le+fe<de+L.min.y||le>de+L.max.y};for(let U=0;U<b.length;U++){const H=b[U];for(let ne=0;ne<h.length;ne++){const le=s.getTile(h[ne]);if(!le||!le.hasData()||$(H,le.tileID))continue;const fe=this._createProxiedId(H,le,g[H.key]&&g[H.key][s.id]),ce=this.proxyToSource[H.key][s.id];ce?ce.push(fe):this.proxyToSource[H.key][s.id]=[fe],v.push(fe)}}}_createProxiedId(s,h,g){let v=this.orthoMatrix;if(g){const b=g.find(A=>A.key===h.tileID.key);if(b)return b}if(h.tileID.key!==s.key){const b=s.canonical.z-h.tileID.canonical.z;let A,C,L;v=a.create();const $=h.tileID.wrap-s.wrap<<s.overscaledZ;b>0?(A=a.EXTENT>>b,C=A*((h.tileID.canonical.x<<b)-s.canonical.x+$),L=A*((h.tileID.canonical.y<<b)-s.canonical.y)):(A=a.EXTENT<<-b,C=a.EXTENT*(h.tileID.canonical.x-(s.canonical.x+$<<-b)),L=a.EXTENT*(h.tileID.canonical.y-(s.canonical.y<<-b))),a.ortho(v,0,A,0,A,0,1),a.translate(v,v,[C,L,0])}return new sh(h.tileID,s.key,v)}_findTileCoveringTileID(s,h){let g=h.getTile(s);if(g&&g.hasData())return g;const v=this._findCoveringTileCache[h.id],b=v[s.key];if(g=b?h.getTileByID(b):null,g&&g.hasData()||b===null)return g;let A=g?g.tileID:s,C=A.overscaledZ;const L=h.getSource().minzoom,$=[];if(!b){const H=h.getSource().maxzoom;if(s.canonical.z>=H){const ne=s.canonical.z-H;h.getSource().reparseOverscaled?(C=Math.max(s.canonical.z+2,h.transform.tileZoom),A=new a.OverscaledTileID(C,s.wrap,H,s.canonical.x>>ne,s.canonical.y>>ne)):ne!==0&&(C=H,A=new a.OverscaledTileID(C,s.wrap,H,s.canonical.x>>ne,s.canonical.y>>ne))}A.key!==s.key&&($.push(A.key),g=h.getTile(A))}const U=H=>{$.forEach(ne=>{v[ne]=H}),$.length=0};for(C-=1;C>=L&&(!g||!g.hasData());C--){g&&U(g.tileID.key);const H=A.calculateScaledKey(C);if(g=h.getTileByID(H),g&&g.hasData())break;const ne=v[H];if(ne===null)break;ne===void 0?$.push(H):g=h.getTileByID(ne)}return U(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,h){let g=this._tilesDirty[s];g||(g=this._tilesDirty[s]={}),g[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const s=function(h){let g=0;const v=new a.StructArrayLayout2ui4,b=131;for(let A=1;A<129;A++){for(let C=1;C<129;C++)g=A*b+C,v.emplaceBack(g,g+1),v.emplaceBack(g,g+b),v.emplaceBack(g+1,g+b),A===128&&v.emplaceBack(g+b,g+b+1);v.emplaceBack(g+1,g+1+b)}return v}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(s),this.wireframeSegments=a.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,s.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Cr{static cacheKey(s,h,g,v){let b=`${h}${v?v.cacheKey:""}`;for(const A of g)s.usedDefines.includes(A)&&(b+=`/${A}`);return b}constructor(s,h,g,v,b,A){const C=s.gl;this.program=C.createProgram();const L=function(X){const ae=[];for(let ge=0;ge<X.length;ge++){if(X[ge]===null)continue;const be=X[ge].split(" ");ae.push(be.pop())}return ae}(g.staticAttributes),$=v?v.getBinderAttributes():[],U=L.concat($);let H=v?v.defines():[];H=H.concat(A.map(X=>`#define ${X}`));const ne=s.isWebGL2?`#version 300 es
`:"",le=ne+H.concat(s.extStandardDerivatives&&ne.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(va):va,va,Us,Xu.fragmentSource,Di.fragmentSource,g.fragmentSource).join(`
`),fe=ne+H.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Us,Xu.vertexSource,Di.vertexSource,wo.vertexSource,g.vertexSource).join(`
`),ce=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(ce,le),C.compileShader(ce),C.attachShader(this.program,ce);const de=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(de,fe),C.compileShader(de),C.attachShader(this.program,de),this.attributes={},this.numAttributes=U.length;for(let X=0;X<this.numAttributes;X++)U[X]&&(C.bindAttribLocation(this.program,X,U[X]),this.attributes[U[X]]=X);C.linkProgram(this.program),C.deleteShader(de),C.deleteShader(ce),this.fixedUniforms=b(s),this.binderUniforms=v?v.getUniforms(s):[],A.includes("TERRAIN")&&(this.terrainUniforms=(X=>({u_dem:new a.Uniform1i(X),u_dem_prev:new a.Uniform1i(X),u_dem_unpack:new a.Uniform4f(X),u_dem_tl:new a.Uniform2f(X),u_dem_scale:new a.Uniform1f(X),u_dem_tl_prev:new a.Uniform2f(X),u_dem_scale_prev:new a.Uniform1f(X),u_dem_size:new a.Uniform1f(X),u_dem_lerp:new a.Uniform1f(X),u_exaggeration:new a.Uniform1f(X),u_depth:new a.Uniform1i(X),u_depth_size_inv:new a.Uniform2f(X),u_meter_to_dem:new a.Uniform1f(X),u_label_plane_matrix_inv:new a.UniformMatrix4f(X)}))(s)),A.includes("GLOBE")&&(this.globeUniforms=(X=>({u_tile_tl_up:new a.Uniform3f(X),u_tile_tr_up:new a.Uniform3f(X),u_tile_br_up:new a.Uniform3f(X),u_tile_bl_up:new a.Uniform3f(X),u_tile_up_scale:new a.Uniform1f(X)}))(s)),A.includes("FOG")&&(this.fogUniforms=(X=>({u_fog_matrix:new a.UniformMatrix4f(X),u_fog_range:new a.Uniform2f(X),u_fog_color:new a.Uniform4f(X),u_fog_horizon_blend:new a.Uniform1f(X),u_fog_temporal_offset:new a.Uniform1f(X),u_frustum_tl:new a.Uniform3f(X),u_frustum_tr:new a.Uniform3f(X),u_frustum_br:new a.Uniform3f(X),u_frustum_bl:new a.Uniform3f(X),u_globe_pos:new a.Uniform3f(X),u_globe_radius:new a.Uniform1f(X),u_globe_transition:new a.Uniform1f(X),u_is_globe:new a.Uniform1i(X),u_viewport:new a.Uniform2f(X)}))(s))}}setTerrainUniformValues(s,h){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in h)g[v]&&g[v].set(this.program,v,h[v])}}setGlobeUniformValues(s,h){if(!this.globeUniforms)return;const g=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in h)g[v]&&g[v].set(this.program,v,h[v])}}setFogUniformValues(s,h){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in h)g[v].set(this.program,v,h[v])}}draw(s,h,g,v,b,A,C,L,$,U,H,ne,le,fe,ce){const de=s.gl;if(this.failedToCreate)return;s.program.set(this.program),s.setDepthMode(g),s.setStencilMode(v),s.setColorMode(b),s.setCullFace(A);for(const ae of Object.keys(this.fixedUniforms))this.fixedUniforms[ae].set(this.program,ae,C[ae]);fe&&fe.setUniforms(this.program,s,this.binderUniforms,ne,{zoom:le});const X={[de.LINES]:2,[de.TRIANGLES]:3,[de.LINE_STRIP]:1}[h];for(const ae of H.get()){const ge=ae.vaos||(ae.vaos={});(ge[L]||(ge[L]=new s0)).bind(s,this,$,fe?fe.getPaintVertexBuffers():[],U,ae.vertexOffset,ce||[]),de.drawElements(h,ae.primitiveLength*X,de.UNSIGNED_SHORT,ae.primitiveOffset*X*2)}}}function Yu(p,s){const h=Math.pow(2,s.tileID.overscaledZ),g=s.tileSize*Math.pow(2,p.transform.tileZoom)/h,v=g*(s.tileID.canonical.x+s.tileID.wrap*h),b=g*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_tile_units_to_pixels:1/Le(s,1,p.transform.tileZoom),u_pixel_coord_upper:[v>>16,b>>16],u_pixel_coord_lower:[65535&v,65535&b]}}const Xm=a.create(),md=(p,s,h,g,v,b,A,C,L,$,U)=>{const H=s.style.light,ne=H.properties.get("position"),le=[ne.x,ne.y,ne.z],fe=a.create$1();H.properties.get("anchor")==="viewport"&&(a.fromRotation(fe,-s.transform.angle),a.transformMat3(le,le,fe));const ce=H.properties.get("color"),de=s.transform,X={u_matrix:p,u_lightpos:le,u_lightintensity:H.properties.get("intensity"),u_lightcolor:[ce.r,ce.g,ce.b],u_vertical_gradient:+h,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Xm,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:v,u_edge_radius:b};return de.projection.name==="globe"&&(X.u_tile_id=[A.canonical.x,A.canonical.y,1<<A.canonical.z],X.u_zoom_transition=L,X.u_inv_rot_matrix=U,X.u_merc_center=$,X.u_up_dir=de.projection.upVector(new a.CanonicalTileID(0,0,0),$[0]*a.EXTENT,$[1]*a.EXTENT),X.u_height_lift=C),X},Km=(p,s,h,g,v,b,A,C,L,$,U,H)=>{const ne=md(p,s,h,g,v,b,A,L,$,U,H),le={u_height_factor:-Math.pow(2,A.overscaledZ)/C.tileSize/8};return a.extend(ne,Yu(s,C),le)},nl=p=>({u_matrix:p}),gd=(p,s,h)=>a.extend(nl(p),Yu(s,h)),a0=(p,s)=>({u_matrix:p,u_world:s}),l0=(p,s,h,g)=>a.extend(gd(p,s,h),{u_world:g}),u0=a.create(),yd=(p,s,h,g,v,b)=>{const A=p.transform,C=A.projection.name==="globe";let L;if(b.paint.get("circle-pitch-alignment")==="map")if(C){const U=a.globePixelsToTileUnits(A.zoom,s.canonical)*A._pixelsPerMercatorPixel;L=Float32Array.from([U,0,0,U])}else L=A.calculatePixelsToTileUnitsMatrix(h);else L=new Float32Array([A.pixelsToGLUnits[0],0,0,A.pixelsToGLUnits[1]]);const $={u_camera_to_center_distance:A.cameraToCenterDistance,u_matrix:p.translatePosMatrix(s.projMatrix,h,b.paint.get("circle-translate"),b.paint.get("circle-translate-anchor")),u_device_pixel_ratio:a.exported.devicePixelRatio,u_extrude_scale:L,u_inv_rot_matrix:u0,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){$.u_inv_rot_matrix=g,$.u_merc_center=v,$.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],$.u_zoom_transition=a.globeToMercatorTransition(A.zoom);const U=v[0]*a.EXTENT,H=v[1]*a.EXTENT;$.u_up_dir=A.projection.upVector(new a.CanonicalTileID(0,0,0),U,H)}return $},_d=p=>{const s=[];return p.paint.get("circle-pitch-alignment")==="map"&&s.push("PITCH_WITH_MAP"),p.paint.get("circle-pitch-scale")==="map"&&s.push("SCALE_WITH_MAP"),s},vd=(p,s,h,g)=>{const v=a.EXTENT/h.tileSize;return{u_matrix:p,u_camera_to_center_distance:s.getCameraToCenterDistance(g),u_extrude_scale:[s.pixelsToGLUnits[0]/v,s.pixelsToGLUnits[1]/v]}},ah=(p,s,h=1)=>({u_matrix:p,u_color:s,u_overlay:0,u_overlay_scale:h}),Ym=a.create(),Jm=(p,s,h,g,v,b,A)=>{const C=p.transform,L=C.projection.name==="globe",$=L?a.globePixelsToTileUnits(C.zoom,s.canonical)*C._pixelsPerMercatorPixel:Le(h,1,b),U={u_matrix:s.projMatrix,u_extrude_scale:$,u_intensity:A,u_inv_rot_matrix:Ym,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(L){U.u_inv_rot_matrix=g,U.u_merc_center=v,U.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],U.u_zoom_transition=a.globeToMercatorTransition(C.zoom);const H=v[0]*a.EXTENT,ne=v[1]*a.EXTENT;U.u_up_dir=C.projection.upVector(new a.CanonicalTileID(0,0,0),H,ne)}return U},c0=(p,s,h,g,v,b,A)=>{const C=p.transform,L=C.calculatePixelsToTileUnitsMatrix(s);return{u_matrix:xd(p,s,h,g),u_pixels_to_tile_units:L,u_device_pixel_ratio:b,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:v,u_texsize:Qu(h)?s.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Bl(s,p.transform),u_alpha_discard_threshold:0,u_trim_offset:A}},Ju=(p,s,h,g,v)=>{const b=p.transform;return{u_matrix:xd(p,s,h,g),u_texsize:s.imageAtlasTexture.size,u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(s),u_device_pixel_ratio:v,u_image:0,u_tile_units_to_pixels:Bl(s,b),u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Bl(p,s){return 1/Le(p,1,s.tileZoom)}function xd(p,s,h,g){return p.translatePosMatrix(g||s.tileID.projMatrix,s,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}function Qu(p){const s=p.paint.get("line-dasharray").value;return s.value||s.kind!=="constant"}const bd=(p,s,h,g,v,b)=>{return{u_matrix:p,u_tl_parent:s,u_scale_parent:h,u_fade_t:g.mix,u_opacity:g.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(C=v.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(A=v.paint.get("raster-contrast"),A>0?1/(1-A):1+A),u_spin_weights:xs(v.paint.get("raster-hue-rotate")),u_perspective_transform:b};var A,C};function xs(p){p*=Math.PI/180;const s=Math.sin(p),h=Math.cos(p);return[(2*h+1)/3,(-Math.sqrt(3)*s-h+1)/3,(Math.sqrt(3)*s-h+1)/3]}const lh=a.create(),wd=(p,s,h,g,v,b,A,C,L,$,U,H,ne,le,fe,ce)=>{const de=v.transform,X={u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:de.cameraToCenterDistance,u_rotate_symbol:+h,u_aspect_ratio:de.width/de.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:A,u_coord_matrix:C,u_is_text:+L,u_pitch_with_map:+g,u_texsize:$,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:lh,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:lh,u_up_vector:[0,-1,0]};return ce.name==="globe"&&(X.u_tile_id=[U.canonical.x,U.canonical.y,1<<U.canonical.z],X.u_zoom_transition=H,X.u_inv_rot_matrix=le,X.u_merc_center=ne,X.u_camera_forward=de._camera.forward(),X.u_ecef_origin=a.globeECEFOrigin(de.globeMatrix,U.toUnwrapped()),X.u_tile_matrix=Float32Array.from(de.globeMatrix),X.u_up_vector=fe),X},uh=(p,s,h,g,v,b,A,C,L,$,U,H,ne,le,fe,ce,de)=>a.extend(wd(p,s,h,g,v,b,A,C,L,$,H,ne,le,fe,ce,de),{u_gamma_scale:g?v.transform.cameraToCenterDistance*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:a.exported.devicePixelRatio,u_is_halo:1}),Qm=(p,s,h,g,v,b,A,C,L,$,U,H,ne,le,fe,ce)=>a.extend(uh(p,s,h,g,v,b,A,C,!0,L,!0,U,H,ne,le,fe,ce),{u_texsize_icon:$,u_texture_icon:1}),Ed=(p,s,h)=>({u_matrix:p,u_opacity:s,u_color:h}),h0=(p,s,h,g,v)=>a.extend(function(b,A,C){const L=A.imageManager.getPattern(b.toString()),{width:$,height:U}=A.imageManager.getPixelSize(),H=Math.pow(2,C.tileID.overscaledZ),ne=C.tileSize*Math.pow(2,A.transform.tileZoom)/H,le=ne*(C.tileID.canonical.x+C.tileID.wrap*H),fe=ne*C.tileID.canonical.y;return{u_image:0,u_pattern_tl:L.tl,u_pattern_br:L.br,u_texsize:[$,U],u_pattern_size:L.displaySize,u_tile_units_to_pixels:1/Le(C,1,A.transform.tileZoom),u_pixel_coord_upper:[le>>16,fe>>16],u_pixel_coord_lower:[65535&le,65535&fe]}}(g,h,v),{u_matrix:p,u_opacity:s}),Td={fillExtrusion:p=>({u_matrix:new a.UniformMatrix4f(p),u_lightpos:new a.Uniform3f(p),u_lightintensity:new a.Uniform1f(p),u_lightcolor:new a.Uniform3f(p),u_vertical_gradient:new a.Uniform1f(p),u_opacity:new a.Uniform1f(p),u_edge_radius:new a.Uniform1f(p),u_ao:new a.Uniform2f(p),u_tile_id:new a.Uniform3f(p),u_zoom_transition:new a.Uniform1f(p),u_inv_rot_matrix:new a.UniformMatrix4f(p),u_merc_center:new a.Uniform2f(p),u_up_dir:new a.Uniform3f(p),u_height_lift:new a.Uniform1f(p)}),fillExtrusionPattern:p=>({u_matrix:new a.UniformMatrix4f(p),u_lightpos:new a.Uniform3f(p),u_lightintensity:new a.Uniform1f(p),u_lightcolor:new a.Uniform3f(p),u_vertical_gradient:new a.Uniform1f(p),u_height_factor:new a.Uniform1f(p),u_edge_radius:new a.Uniform1f(p),u_ao:new a.Uniform2f(p),u_tile_id:new a.Uniform3f(p),u_zoom_transition:new a.Uniform1f(p),u_inv_rot_matrix:new a.UniformMatrix4f(p),u_merc_center:new a.Uniform2f(p),u_up_dir:new a.Uniform3f(p),u_height_lift:new a.Uniform1f(p),u_image:new a.Uniform1i(p),u_texsize:new a.Uniform2f(p),u_pixel_coord_upper:new a.Uniform2f(p),u_pixel_coord_lower:new a.Uniform2f(p),u_tile_units_to_pixels:new a.Uniform1f(p),u_opacity:new a.Uniform1f(p)}),fill:p=>({u_matrix:new a.UniformMatrix4f(p)}),fillPattern:p=>({u_matrix:new a.UniformMatrix4f(p),u_image:new a.Uniform1i(p),u_texsize:new a.Uniform2f(p),u_pixel_coord_upper:new a.Uniform2f(p),u_pixel_coord_lower:new a.Uniform2f(p),u_tile_units_to_pixels:new a.Uniform1f(p)}),fillOutline:p=>({u_matrix:new a.UniformMatrix4f(p),u_world:new a.Uniform2f(p)}),fillOutlinePattern:p=>({u_matrix:new a.UniformMatrix4f(p),u_world:new a.Uniform2f(p),u_image:new a.Uniform1i(p),u_texsize:new a.Uniform2f(p),u_pixel_coord_upper:new a.Uniform2f(p),u_pixel_coord_lower:new a.Uniform2f(p),u_tile_units_to_pixels:new a.Uniform1f(p)}),circle:p=>({u_camera_to_center_distance:new a.Uniform1f(p),u_extrude_scale:new a.UniformMatrix2f(p),u_device_pixel_ratio:new a.Uniform1f(p),u_matrix:new a.UniformMatrix4f(p),u_inv_rot_matrix:new a.UniformMatrix4f(p),u_merc_center:new a.Uniform2f(p),u_tile_id:new a.Uniform3f(p),u_zoom_transition:new a.Uniform1f(p),u_up_dir:new a.Uniform3f(p)}),collisionBox:p=>({u_matrix:new a.UniformMatrix4f(p),u_camera_to_center_distance:new a.Uniform1f(p),u_extrude_scale:new a.Uniform2f(p)}),collisionCircle:p=>({u_matrix:new a.UniformMatrix4f(p),u_inv_matrix:new a.UniformMatrix4f(p),u_camera_to_center_distance:new a.Uniform1f(p),u_viewport_size:new a.Uniform2f(p)}),debug:p=>({u_color:new a.UniformColor(p),u_matrix:new a.UniformMatrix4f(p),u_overlay:new a.Uniform1i(p),u_overlay_scale:new a.Uniform1f(p)}),clippingMask:p=>({u_matrix:new a.UniformMatrix4f(p)}),heatmap:p=>({u_extrude_scale:new a.Uniform1f(p),u_intensity:new a.Uniform1f(p),u_matrix:new a.UniformMatrix4f(p),u_inv_rot_matrix:new a.UniformMatrix4f(p),u_merc_center:new a.Uniform2f(p),u_tile_id:new a.Uniform3f(p),u_zoom_transition:new a.Uniform1f(p),u_up_dir:new a.Uniform3f(p)}),heatmapTexture:p=>({u_image:new a.Uniform1i(p),u_color_ramp:new a.Uniform1i(p),u_opacity:new a.Uniform1f(p)}),hillshade:p=>({u_matrix:new a.UniformMatrix4f(p),u_image:new a.Uniform1i(p),u_latrange:new a.Uniform2f(p),u_light:new a.Uniform2f(p),u_shadow:new a.UniformColor(p),u_highlight:new a.UniformColor(p),u_accent:new a.UniformColor(p)}),hillshadePrepare:p=>({u_matrix:new a.UniformMatrix4f(p),u_image:new a.Uniform1i(p),u_dimension:new a.Uniform2f(p),u_zoom:new a.Uniform1f(p),u_unpack:new a.Uniform4f(p)}),line:p=>({u_matrix:new a.UniformMatrix4f(p),u_pixels_to_tile_units:new a.UniformMatrix2f(p),u_device_pixel_ratio:new a.Uniform1f(p),u_units_to_pixels:new a.Uniform2f(p),u_dash_image:new a.Uniform1i(p),u_gradient_image:new a.Uniform1i(p),u_image_height:new a.Uniform1f(p),u_texsize:new a.Uniform2f(p),u_tile_units_to_pixels:new a.Uniform1f(p),u_alpha_discard_threshold:new a.Uniform1f(p),u_trim_offset:new a.Uniform2f(p)}),linePattern:p=>({u_matrix:new a.UniformMatrix4f(p),u_texsize:new a.Uniform2f(p),u_pixels_to_tile_units:new a.UniformMatrix2f(p),u_device_pixel_ratio:new a.Uniform1f(p),u_image:new a.Uniform1i(p),u_units_to_pixels:new a.Uniform2f(p),u_tile_units_to_pixels:new a.Uniform1f(p),u_alpha_discard_threshold:new a.Uniform1f(p)}),raster:p=>({u_matrix:new a.UniformMatrix4f(p),u_tl_parent:new a.Uniform2f(p),u_scale_parent:new a.Uniform1f(p),u_fade_t:new a.Uniform1f(p),u_opacity:new a.Uniform1f(p),u_image0:new a.Uniform1i(p),u_image1:new a.Uniform1i(p),u_brightness_low:new a.Uniform1f(p),u_brightness_high:new a.Uniform1f(p),u_saturation_factor:new a.Uniform1f(p),u_contrast_factor:new a.Uniform1f(p),u_spin_weights:new a.Uniform3f(p),u_perspective_transform:new a.Uniform2f(p)}),symbolIcon:p=>({u_is_size_zoom_constant:new a.Uniform1i(p),u_is_size_feature_constant:new a.Uniform1i(p),u_size_t:new a.Uniform1f(p),u_size:new a.Uniform1f(p),u_camera_to_center_distance:new a.Uniform1f(p),u_rotate_symbol:new a.Uniform1i(p),u_aspect_ratio:new a.Uniform1f(p),u_fade_change:new a.Uniform1f(p),u_matrix:new a.UniformMatrix4f(p),u_label_plane_matrix:new a.UniformMatrix4f(p),u_coord_matrix:new a.UniformMatrix4f(p),u_is_text:new a.Uniform1i(p),u_pitch_with_map:new a.Uniform1i(p),u_texsize:new a.Uniform2f(p),u_tile_id:new a.Uniform3f(p),u_zoom_transition:new a.Uniform1f(p),u_inv_rot_matrix:new a.UniformMatrix4f(p),u_merc_center:new a.Uniform2f(p),u_camera_forward:new a.Uniform3f(p),u_tile_matrix:new a.UniformMatrix4f(p),u_up_vector:new a.Uniform3f(p),u_ecef_origin:new a.Uniform3f(p),u_texture:new a.Uniform1i(p)}),symbolSDF:p=>({u_is_size_zoom_constant:new a.Uniform1i(p),u_is_size_feature_constant:new a.Uniform1i(p),u_size_t:new a.Uniform1f(p),u_size:new a.Uniform1f(p),u_camera_to_center_distance:new a.Uniform1f(p),u_rotate_symbol:new a.Uniform1i(p),u_aspect_ratio:new a.Uniform1f(p),u_fade_change:new a.Uniform1f(p),u_matrix:new a.UniformMatrix4f(p),u_label_plane_matrix:new a.UniformMatrix4f(p),u_coord_matrix:new a.UniformMatrix4f(p),u_is_text:new a.Uniform1i(p),u_pitch_with_map:new a.Uniform1i(p),u_texsize:new a.Uniform2f(p),u_texture:new a.Uniform1i(p),u_gamma_scale:new a.Uniform1f(p),u_device_pixel_ratio:new a.Uniform1f(p),u_tile_id:new a.Uniform3f(p),u_zoom_transition:new a.Uniform1f(p),u_inv_rot_matrix:new a.UniformMatrix4f(p),u_merc_center:new a.Uniform2f(p),u_camera_forward:new a.Uniform3f(p),u_tile_matrix:new a.UniformMatrix4f(p),u_up_vector:new a.Uniform3f(p),u_ecef_origin:new a.Uniform3f(p),u_is_halo:new a.Uniform1i(p)}),symbolTextAndIcon:p=>({u_is_size_zoom_constant:new a.Uniform1i(p),u_is_size_feature_constant:new a.Uniform1i(p),u_size_t:new a.Uniform1f(p),u_size:new a.Uniform1f(p),u_camera_to_center_distance:new a.Uniform1f(p),u_rotate_symbol:new a.Uniform1i(p),u_aspect_ratio:new a.Uniform1f(p),u_fade_change:new a.Uniform1f(p),u_matrix:new a.UniformMatrix4f(p),u_label_plane_matrix:new a.UniformMatrix4f(p),u_coord_matrix:new a.UniformMatrix4f(p),u_is_text:new a.Uniform1i(p),u_pitch_with_map:new a.Uniform1i(p),u_texsize:new a.Uniform2f(p),u_texsize_icon:new a.Uniform2f(p),u_texture:new a.Uniform1i(p),u_texture_icon:new a.Uniform1i(p),u_gamma_scale:new a.Uniform1f(p),u_device_pixel_ratio:new a.Uniform1f(p),u_is_halo:new a.Uniform1i(p)}),background:p=>({u_matrix:new a.UniformMatrix4f(p),u_opacity:new a.Uniform1f(p),u_color:new a.UniformColor(p)}),backgroundPattern:p=>({u_matrix:new a.UniformMatrix4f(p),u_opacity:new a.Uniform1f(p),u_image:new a.Uniform1i(p),u_pattern_tl:new a.Uniform2f(p),u_pattern_br:new a.Uniform2f(p),u_texsize:new a.Uniform2f(p),u_pattern_size:new a.Uniform2f(p),u_pixel_coord_upper:new a.Uniform2f(p),u_pixel_coord_lower:new a.Uniform2f(p),u_tile_units_to_pixels:new a.Uniform1f(p)}),terrainRaster:hd,terrainDepth:hd,skybox:p=>({u_matrix:new a.UniformMatrix4f(p),u_sun_direction:new a.Uniform3f(p),u_cubemap:new a.Uniform1i(p),u_opacity:new a.Uniform1f(p),u_temporal_offset:new a.Uniform1f(p)}),skyboxGradient:p=>({u_matrix:new a.UniformMatrix4f(p),u_color_ramp:new a.Uniform1i(p),u_center_direction:new a.Uniform3f(p),u_radius:new a.Uniform1f(p),u_opacity:new a.Uniform1f(p),u_temporal_offset:new a.Uniform1f(p)}),skyboxCapture:p=>({u_matrix_3f:new a.UniformMatrix3f(p),u_sun_direction:new a.Uniform3f(p),u_sun_intensity:new a.Uniform1f(p),u_color_tint_r:new a.Uniform4f(p),u_color_tint_m:new a.Uniform4f(p),u_luminance:new a.Uniform1f(p)}),globeRaster:p=>({u_proj_matrix:new a.UniformMatrix4f(p),u_globe_matrix:new a.UniformMatrix4f(p),u_normalize_matrix:new a.UniformMatrix4f(p),u_merc_matrix:new a.UniformMatrix4f(p),u_zoom_transition:new a.Uniform1f(p),u_merc_center:new a.Uniform2f(p),u_image0:new a.Uniform1i(p),u_grid_matrix:new a.UniformMatrix3f(p),u_skirt_height:new a.Uniform1f(p),u_frustum_tl:new a.Uniform3f(p),u_frustum_tr:new a.Uniform3f(p),u_frustum_br:new a.Uniform3f(p),u_frustum_bl:new a.Uniform3f(p),u_globe_pos:new a.Uniform3f(p),u_globe_radius:new a.Uniform1f(p),u_viewport:new a.Uniform2f(p)}),globeAtmosphere:p=>({u_frustum_tl:new a.Uniform3f(p),u_frustum_tr:new a.Uniform3f(p),u_frustum_br:new a.Uniform3f(p),u_frustum_bl:new a.Uniform3f(p),u_horizon:new a.Uniform1f(p),u_transition:new a.Uniform1f(p),u_fadeout_range:new a.Uniform1f(p),u_color:new a.Uniform4f(p),u_high_color:new a.Uniform4f(p),u_space_color:new a.Uniform4f(p),u_star_intensity:new a.Uniform1f(p),u_star_density:new a.Uniform1f(p),u_star_size:new a.Uniform1f(p),u_temporal_offset:new a.Uniform1f(p),u_horizon_angle:new a.Uniform1f(p),u_rotation_matrix:new a.UniformMatrix4f(p)})};let ch;function ec(p,s,h,g,v,b,A){const C=p.context,L=C.gl,$=p.transform,U=p.useProgram("collisionBox"),H=[];let ne=0,le=0;for(let be=0;be<g.length;be++){const Oe=g[be],Re=s.getTile(Oe),De=Re.getBucket(h);if(!De)continue;const Ue=ai(Oe,De,$);let Ne=Ue;v[0]===0&&v[1]===0||(Ne=p.translatePosMatrix(Ue,Re,v,b));const Ye=A?De.textCollisionBox:De.iconCollisionBox,vt=De.collisionCircleArray;if(vt.length>0){const We=a.create(),ht=Ne;a.mul(We,De.placementInvProjMatrix,$.glCoordMatrix),a.mul(We,We,De.placementViewportMatrix),H.push({circleArray:vt,circleOffset:le,transform:ht,invTransform:We,projection:De.getProjection()}),ne+=vt.length/4,le=ne}Ye&&(p.terrain&&p.terrain.setupElevationDraw(Re,U),U.draw(C,L.LINES,a.DepthMode.disabled,a.StencilMode.disabled,p.colorModeForRenderPass(),a.CullFaceMode.disabled,vd(Ne,$,Re,De.getProjection()),h.id,Ye.layoutVertexBuffer,Ye.indexBuffer,Ye.segments,null,$.zoom,null,[Ye.collisionVertexBuffer,Ye.collisionVertexBufferExt]))}if(!A||!H.length)return;const fe=p.useProgram("collisionCircle"),ce=new a.StructArrayLayout2f1f2i16;ce.resize(4*ne),ce._trim();let de=0;for(const be of H)for(let Oe=0;Oe<be.circleArray.length/4;Oe++){const Re=4*Oe,De=be.circleArray[Re+0],Ue=be.circleArray[Re+1],Ne=be.circleArray[Re+2],Ye=be.circleArray[Re+3];ce.emplace(de++,De,Ue,Ne,Ye,0),ce.emplace(de++,De,Ue,Ne,Ye,1),ce.emplace(de++,De,Ue,Ne,Ye,2),ce.emplace(de++,De,Ue,Ne,Ye,3)}(!ch||ch.length<2*ne)&&(ch=function(be){const Oe=2*be,Re=new a.StructArrayLayout3ui6;Re.resize(Oe),Re._trim();for(let De=0;De<Oe;De++){const Ue=6*De;Re.uint16[Ue+0]=4*De+0,Re.uint16[Ue+1]=4*De+1,Re.uint16[Ue+2]=4*De+2,Re.uint16[Ue+3]=4*De+2,Re.uint16[Ue+4]=4*De+3,Re.uint16[Ue+5]=4*De+0}return Re}(ne));const X=C.createIndexBuffer(ch,!0),ae=C.createVertexBuffer(ce,a.collisionCircleLayout.members,!0);for(const be of H){const Oe={u_matrix:be.transform,u_inv_matrix:be.invTransform,u_camera_to_center_distance:(ge=$).getCameraToCenterDistance(be.projection),u_viewport_size:[ge.width,ge.height]};fe.draw(C,L.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,p.colorModeForRenderPass(),a.CullFaceMode.disabled,Oe,h.id,ae,X,a.SegmentVector.simpleSegment(0,2*be.circleOffset,be.circleArray.length,be.circleArray.length/2),null,$.zoom)}var ge;ae.destroy(),X.destroy()}const eg=a.create();function Sd({width:p,height:s,anchor:h,textOffset:g,textScale:v},b){const{horizontalAlign:A,verticalAlign:C}=a.getAnchorAlignment(h),L=-(A-.5)*p,$=-(C-.5)*s,U=a.evaluateVariableOffset(h,g);return new a.Point((L/v+U[0])*b,($/v+U[1])*b)}function f0(p,s,h,g,v,b,A,C,L,$,U){const H=p.text.placedSymbolArray,ne=p.text.dynamicLayoutVertexArray,le=p.icon.dynamicLayoutVertexArray,fe={},ce=p.getProjection(),de=nn(C,ce,b),X=b.elevation,ae=ce.upVectorScale(C.canonical,b.center.lat,b.worldSize).metersToTile;ne.clear();for(let ge=0;ge<H.length;ge++){const be=H.get(ge),{tileAnchorX:Oe,tileAnchorY:Re,numGlyphs:De}=be,Ue=be.hidden||!be.crossTileID||p.allowVerticalPlacement&&!be.placedOrientation?null:g[be.crossTileID];if(Ue){let Ne=0,Ye=0,vt=0;if(X){const Tt=X?X.getAtTileOffset(C,Oe,Re):0,[Wt,or,jt]=ce.upVector(C.canonical,Oe,Re);Ne=Tt*Wt*ae,Ye=Tt*or*ae,vt=Tt*jt*ae}let[We,ht,rt,_t]=ii(be.projectedAnchorX+Ne,be.projectedAnchorY+Ye,be.projectedAnchorZ+vt,h?de:A);const Xe=Xa(b.getCameraToCenterDistance(ce),_t);let ut=v.evaluateSizeForFeature(p.textSizeData,$,be)*Xe/a.ONE_EM;h&&(ut*=p.tilePixelRatio/L);const bt=Sd(Ue,ut);h?({x:We,y:ht,z:rt}=ce.projectTilePoint(Oe+bt.x,Re+bt.y,C.canonical),[We,ht,rt]=ii(We+Ne,ht+Ye,rt+vt,A)):(s&&bt._rotate(-b.angle),We+=bt.x,ht+=bt.y,rt=0);const pt=p.allowVerticalPlacement&&be.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let Tt=0;Tt<De;Tt++)a.addDynamicAttributes(ne,We,ht,rt,pt);U&&be.associatedIconIndex>=0&&(fe[be.associatedIconIndex]={x:We,y:ht,z:rt,angle:pt})}else ro(De,ne)}if(U){le.clear();const ge=p.icon.placedSymbolArray;for(let be=0;be<ge.length;be++){const Oe=ge.get(be),{numGlyphs:Re}=Oe,De=fe[be];if(Oe.hidden||!De)ro(Re,le);else{const{x:Ue,y:Ne,z:Ye,angle:vt}=De;for(let We=0;We<Re;We++)a.addDynamicAttributes(le,Ue,Ne,Ye,vt)}}p.icon.dynamicLayoutVertexBuffer.updateData(le)}p.text.dynamicLayoutVertexBuffer.updateData(ne)}function Ad(p,s,h){return h.iconsInText&&s?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function tg(p,s,h,g,v,b,A,C,L,$,U,H){const ne=p.context,le=ne.gl,fe=p.transform,ce=C==="map",de=L==="map",X=ce&&h.layout.get("symbol-placement")!=="point",ae=ce&&!de&&!X,ge=h.layout.get("symbol-sort-key").constantOr(1)!==void 0;let be=!1;const Oe=p.depthModeForSublayer(0,a.DepthMode.ReadOnly),Re=[a.mercatorXfromLng(fe.center.lng),a.mercatorYfromLat(fe.center.lat)],De=h.layout.get("text-variable-anchor"),Ue=fe.projection.name==="globe",Ne=[],Ye=[0,-1,0];let vt=Ye;!Ue&&!fe.mercatorFromTransition||ce||(vt=function(We){const ht=We._camera.getWorldToCamera(We.worldSize,1),rt=a.multiply([],ht,We.globeMatrix);a.invert(rt,rt);const _t=[0,0,0],Xe=[0,1,0,0];return a.transformMat4$1(Xe,Xe,rt),_t[0]=Xe[0],_t[1]=Xe[1],_t[2]=Xe[2],a.normalize(_t,_t),_t}(fe));for(const We of g){const ht=s.getTile(We),rt=ht.getBucket(h);if(!rt||rt.projection.name==="mercator"&&Ue)continue;const _t=v?rt.text:rt.icon;if(!_t||rt.fullyClipped||!_t.segments.get().length)continue;const Xe=_t.programConfigurations.get(h.id),ut=v||rt.sdfIcons,bt=v?rt.textSizeData:rt.iconSizeData,pt=de||fe.pitch!==0,Tt=a.evaluateSizeForZoom(bt,fe.zoom);let Wt,or,jt,Yt,vr=[0,0],yr=null;if(v)or=ht.glyphAtlasTexture,jt=le.LINEAR,Wt=ht.glyphAtlasTexture.size,rt.iconsInText&&(vr=ht.imageAtlasTexture.size,yr=ht.imageAtlasTexture,Yt=pt||p.options.rotating||p.options.zooming||bt.kind==="composite"||bt.kind==="camera"?le.LINEAR:le.NEAREST);else{const Gs=h.layout.get("icon-size").constantOr(0)!==1||rt.iconsNeedLinear;or=ht.imageAtlasTexture,jt=ut||p.options.rotating||p.options.zooming||Gs||pt?le.LINEAR:le.NEAREST,Wt=ht.imageAtlasTexture.size}const qt=rt.projection.name==="globe",$r=qt?vt:Ye,Gr=qt?a.globeToMercatorTransition(fe.zoom):0,qr=nn(We,rt.getProjection(),fe),Wr=fe.calculatePixelsToTileUnitsMatrix(ht),zi=ot(qr,ht.tileID.canonical,de,ce,fe,rt.getProjection(),Wr),mi=p.terrain&&de&&X?a.invert(a.create(),zi):eg,jo=Mn(qr,ht.tileID.canonical,de,ce,fe,rt.getProjection(),Wr),ws=De&&rt.hasTextData(),dn=h.layout.get("icon-text-fit")!=="none"&&ws&&rt.hasIconData();if(X){const Gs=fe.elevation,ba=Gs?Gs.getAtTileOffsetFunc(We,fe.center.lat,fe.worldSize,rt.getProjection()):null,ll=is(qr,ht.tileID.canonical,de,ce,fe,rt.getProjection(),Wr);Fs(rt,qr,p,v,ll,jo,de,$,ba,We)}const Zr=X||v&&De||dn,Lr=p.translatePosMatrix(qr,ht,b,A),Gn=Zr?eg:zi,Ki=p.translatePosMatrix(jo,ht,b,A,!0),ln=rt.getProjection().createInversionMatrix(fe,We.canonical),no=[];p.terrainRenderModeElevated()&&de&&no.push("PITCH_WITH_MAP_TERRAIN"),qt&&no.push("PROJECTION_GLOBE_VIEW"),Zr&&no.push("PROJECTED_POS_ON_VIEWPORT");const Ah=ut&&h.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let al;al=ut?rt.iconsInText?Qm(bt.kind,Tt,ae,de,p,Lr,Gn,Ki,Wt,vr,We,Gr,Re,ln,$r,rt.getProjection()):uh(bt.kind,Tt,ae,de,p,Lr,Gn,Ki,v,Wt,!0,We,Gr,Re,ln,$r,rt.getProjection()):wd(bt.kind,Tt,ae,de,p,Lr,Gn,Ki,v,Wt,We,Gr,Re,ln,$r,rt.getProjection());const hc={program:p.useProgram(Ad(ut,v,rt),Xe,no),buffers:_t,uniformValues:al,atlasTexture:or,atlasTextureIcon:yr,atlasInterpolation:jt,atlasInterpolationIcon:Yt,isSDF:ut,hasHalo:Ah,tile:ht,labelPlaneMatrixInv:mi};if(ge&&rt.canOverlap){be=!0;const Gs=_t.segments.get();for(const ba of Gs)Ne.push({segments:new a.SegmentVector([ba]),sortKey:ba.sortKey,state:hc})}else Ne.push({segments:_t.segments,sortKey:0,state:hc})}be&&Ne.sort((We,ht)=>We.sortKey-ht.sortKey);for(const We of Ne){const ht=We.state;if(p.terrain&&p.terrain.setupElevationDraw(ht.tile,ht.program,{useDepthForOcclusion:!Ue,labelPlaneMatrixInv:ht.labelPlaneMatrixInv}),ne.activeTexture.set(le.TEXTURE0),ht.atlasTexture.bind(ht.atlasInterpolation,le.CLAMP_TO_EDGE),ht.atlasTextureIcon&&(ne.activeTexture.set(le.TEXTURE1),ht.atlasTextureIcon&&ht.atlasTextureIcon.bind(ht.atlasInterpolationIcon,le.CLAMP_TO_EDGE)),ht.isSDF){const rt=ht.uniformValues;ht.hasHalo&&(rt.u_is_halo=1,tc(ht.buffers,We.segments,h,p,ht.program,Oe,U,H,rt)),rt.u_is_halo=0}tc(ht.buffers,We.segments,h,p,ht.program,Oe,U,H,ht.uniformValues)}}function tc(p,s,h,g,v,b,A,C,L){const $=g.context,U=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.globeExtVertexBuffer];v.draw($,$.gl.TRIANGLES,b,A,C,a.CullFaceMode.disabled,L,h.id,p.layoutVertexBuffer,p.indexBuffer,s,h.paint,g.transform.zoom,p.programConfigurations.get(h.id),U)}function rg(p,s,h,g,v,b,A){const C=p.context.gl,L=h.paint.get("fill-pattern"),$=L&&L.constantOr(1);let U,H,ne,le,fe;A?(H=$&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=C.LINES):(H=$?"fillPattern":"fill",U=C.TRIANGLES);for(const ce of g){const de=s.getTile(ce);if($&&!de.patternsLoaded())continue;const X=de.getBucket(h);if(!X)continue;p.prepareDrawTile();const ae=X.programConfigurations.get(h.id),ge=p.useProgram(H,ae);$&&(p.context.activeTexture.set(C.TEXTURE0),de.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),ae.updatePaintBuffers());const be=L.constantOr(null);if(be&&de.imageAtlas){const Re=de.imageAtlas.patternPositions[be.toString()];Re&&ae.setConstantPatternPositions(Re)}const Oe=p.translatePosMatrix(ce.projMatrix,de,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(A){le=X.indexBuffer2,fe=X.segments2;const Re=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];ne=H==="fillOutlinePattern"&&$?l0(Oe,p,de,Re):a0(Oe,Re)}else le=X.indexBuffer,fe=X.segments,ne=$?gd(Oe,p,de):nl(Oe);p.prepareDrawProgram(p.context,ge,ce.toUnwrapped()),ge.draw(p.context,U,v,p.stencilModeForClipping(ce),b,a.CullFaceMode.disabled,ne,h.id,X.layoutVertexBuffer,le,fe,h.paint,p.transform.zoom,ae)}}function hh(p,s,h,g,v,b,A){const C=p.context,L=C.gl,$=p.transform,U=h.paint.get("fill-extrusion-pattern"),H=U.constantOr(1),ne=h.paint.get("fill-extrusion-opacity"),le=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),h.paint.get("fill-extrusion-ambient-occlusion-radius")],fe=h.layout.get("fill-extrusion-edge-radius"),ce=fe>0&&!h.paint.get("fill-extrusion-rounded-roof"),de=ce?0:fe,X=$.projection.name==="globe"?a.fillExtrusionHeightLift():0,ae=$.projection.name==="globe",ge=ae?a.globeToMercatorTransition($.zoom):0,be=[a.mercatorXfromLng($.center.lng),a.mercatorYfromLat($.center.lat)],Oe=[];ae&&Oe.push("PROJECTION_GLOBE_VIEW"),le[0]>0&&Oe.push("FAUX_AO"),ce&&Oe.push("ZERO_ROOF_RADIUS");for(const Re of g){const De=s.getTile(Re),Ue=De.getBucket(h);if(!Ue||Ue.projection.name!==$.projection.name)continue;const Ne=Ue.programConfigurations.get(h.id),Ye=p.useProgram(H?"fillExtrusionPattern":"fillExtrusion",Ne,Oe);if(p.terrain){const ut=p.terrain;if(p.style.terrainSetForDrapingOnly())ut.setupElevationDraw(De,Ye,{useMeterToDem:!0});else{if(!Ue.enableTerrain)continue;if(ut.setupElevationDraw(De,Ye,{useMeterToDem:!0}),ng(C,s,Re,Ue,h,ut),!Ue.centroidVertexBuffer){const bt=Ye.attributes.a_centroid_pos;bt!==void 0&&L.vertexAttrib2f(bt,0,0)}}}H&&(p.context.activeTexture.set(L.TEXTURE0),De.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Ne.updatePaintBuffers());const vt=U.constantOr(null);if(vt&&De.imageAtlas){const ut=De.imageAtlas.patternPositions[vt.toString()];ut&&Ne.setConstantPatternPositions(ut)}const We=p.translatePosMatrix(Re.projMatrix,De,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),ht=$.projection.createInversionMatrix($,Re.canonical),rt=h.paint.get("fill-extrusion-vertical-gradient"),_t=H?Km(We,p,rt,ne,le,de,Re,De,X,ge,be,ht):md(We,p,rt,ne,le,de,Re,X,ge,be,ht);p.prepareDrawProgram(C,Ye,Re.toUnwrapped());const Xe=[];p.terrain&&Xe.push(Ue.centroidVertexBuffer),ae&&Xe.push(Ue.layoutVertexExtBuffer),Ye.draw(C,C.gl.TRIANGLES,v,b,A,a.CullFaceMode.backCCW,_t,h.id,Ue.layoutVertexBuffer,Ue.indexBuffer,Ue.segments,h.paint,p.transform.zoom,Ne,Xe)}}function ng(p,s,h,g,v,b){const A=[X=>{let ae=X.canonical.x-1,ge=X.wrap;return ae<0&&(ae=(1<<X.canonical.z)-1,ge--),new a.OverscaledTileID(X.overscaledZ,ge,X.canonical.z,ae,X.canonical.y)},X=>{let ae=X.canonical.x+1,ge=X.wrap;return ae===1<<X.canonical.z&&(ae=0,ge++),new a.OverscaledTileID(X.overscaledZ,ge,X.canonical.z,ae,X.canonical.y)},X=>new a.OverscaledTileID(X.overscaledZ,X.wrap,X.canonical.z,X.canonical.x,(X.canonical.y===0?1<<X.canonical.z:X.canonical.y)-1),X=>new a.OverscaledTileID(X.overscaledZ,X.wrap,X.canonical.z,X.canonical.x,X.canonical.y===(1<<X.canonical.z)-1?0:X.canonical.y+1)],C=X=>{const ae=s.getSource().minzoom,ge=Oe=>{const Re=s.getTileByID(Oe);if(Re&&Re.hasData())return Re.getBucket(v)},be=[0,-1,1];for(const Oe of be){if(X.overscaledZ+Oe<ae)continue;const Re=ge(X.calculateScaledKey(X.overscaledZ+Oe));if(Re)return Re}},L=[0,0,0],$=(X,ae)=>(L[0]=Math.min(X.min.y,ae.min.y),L[1]=Math.max(X.max.y,ae.max.y),L[2]=a.EXTENT-ae.min.x>X.max.x?ae.min.x-a.EXTENT:X.max.x,L),U=(X,ae)=>(L[0]=Math.min(X.min.x,ae.min.x),L[1]=Math.max(X.max.x,ae.max.x),L[2]=a.EXTENT-ae.min.y>X.max.y?ae.min.y-a.EXTENT:X.max.y,L),H=[(X,ae)=>$(X,ae),(X,ae)=>$(ae,X),(X,ae)=>U(X,ae),(X,ae)=>U(ae,X)],ne=new a.Point(0,0);let le,fe,ce;const de=(X,ae,ge,be,Oe)=>{const Re=[[be?ge:X,be?X:ge,0],[be?ge:ae,be?ae:ge,0]],De=Oe<0?a.EXTENT+Oe:Oe,Ue=[be?De:(X+ae)/2,be?(X+ae)/2:De,0];return ge===0&&Oe<0||ge!==0&&Oe>0?b.getForTilePoints(ce,[Ue],!0,fe):Re.push(Ue),b.getForTilePoints(h,Re,!0,le),Math.max(Re[0][2],Re[1][2],Ue[2])/b.exaggeration()};for(let X=0;X<4;X++){const ae=(X<2?1:5)-X,ge=g.borders[X];if(ge.length===0)continue;const be=ce=A[X](h),Oe=C(be);if(!(Oe&&Oe instanceof a.FillExtrusionBucket&&Oe.enableTerrain)||g.borderDoneWithNeighborZ[X]===Oe.canonical.z&&Oe.borderDoneWithNeighborZ[ae]===g.canonical.z||(fe=b.findDEMTileFor(be),!fe||!fe.dem))continue;if(!le){const Ne=b.findDEMTileFor(h);if(!Ne||!Ne.dem)return;le=Ne}const Re=Oe.borders[ae];let De=0;const Ue=Oe.borderDoneWithNeighborZ[ae]!==g.canonical.z;if(g.canonical.z===Oe.canonical.z){for(let Ne=0;Ne<ge.length;Ne++){const Ye=g.featuresOnBorder[ge[Ne]],vt=Ye.borders[X];let We;for(;De<Re.length&&(We=Oe.featuresOnBorder[Re[De]],!(We.borders[ae][1]>vt[0]+3));)Ue&&Oe.encodeCentroid(void 0,We,!1),De++;if(We&&De<Re.length){const ht=De;let rt=0;for(;!(We.borders[ae][0]>vt[1]-3)&&(rt++,++De!==Re.length);)We=Oe.featuresOnBorder[Re[De]];if(We=Oe.featuresOnBorder[Re[ht]],Ye.intersectsCount()>1||We.intersectsCount()>1||rt!==1){rt!==1&&(De=ht),g.encodeCentroid(void 0,Ye,!1),Ue&&Oe.encodeCentroid(void 0,We,!1);continue}const _t=H[X](Ye,We),Xe=X%2?a.EXTENT-1:0;ne.x=de(_t[0],Math.min(a.EXTENT-1,_t[1]),Xe,X<2,_t[2]),ne.y=0,g.encodeCentroid(ne,Ye,!1),Ue&&Oe.encodeCentroid(ne,We,!1)}else g.encodeCentroid(void 0,Ye,!1)}g.borderDoneWithNeighborZ[X]=Oe.canonical.z,g.needsCentroidUpdate=!0,Ue&&(Oe.borderDoneWithNeighborZ[ae]=g.canonical.z,Oe.needsCentroidUpdate=!0)}else{for(const Ne of ge)g.encodeCentroid(void 0,g.featuresOnBorder[Ne],!1);if(Ue){for(const Ne of Re)Oe.encodeCentroid(void 0,Oe.featuresOnBorder[Ne],!1);Oe.borderDoneWithNeighborZ[ae]=g.canonical.z,Oe.needsCentroidUpdate=!0}g.borderDoneWithNeighborZ[X]=Oe.canonical.z,g.needsCentroidUpdate=!0}}(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(p)}const Nl=new a.Color(1,0,0,1),d0=new a.Color(0,1,0,1),p0=new a.Color(0,0,1,1),m0=new a.Color(1,0,1,1),g0=new a.Color(0,1,1,1);function y0(p,s,h){const g=p.context,v=p.transform,b=g.gl,A=v.projection.name==="globe",C=A?["PROJECTION_GLOBE_VIEW"]:null;let L=h.projMatrix;if(A&&a.globeToMercatorTransition(v.zoom)>0){const Ye=a.transitionTileAABBinECEF(h.canonical,v),vt=a.globeDenormalizeECEF(Ye);L=a.multiply(new Float32Array(16),v.globeMatrix,vt),a.multiply(L,v.projMatrix,L)}const $=p.useProgram("debug",null,C),U=s.getTileByID(h.key);p.terrain&&p.terrain.setupElevationDraw(U,$);const H=a.DepthMode.disabled,ne=a.StencilMode.disabled,le=p.colorModeForRenderPass(),fe="$debug";g.activeTexture.set(b.TEXTURE0),p.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),A?U._makeGlobeTileDebugBuffers(p.context,v):U._makeDebugTileBoundsBuffers(p.context,v.projection);const ce=U._tileDebugBuffer||p.debugBuffer,de=U._tileDebugIndexBuffer||p.debugIndexBuffer,X=U._tileDebugSegments||p.debugSegments;$.draw(g,b.LINE_STRIP,H,ne,le,a.CullFaceMode.disabled,ah(L,a.Color.red),fe,ce,de,X,null,null,null,[U._globeTileDebugBorderBuffer]);const ae=U.latestRawTileData,ge=Math.floor((ae&&ae.byteLength||0)/1024),be=s.getTile(h).tileSize,Oe=512/Math.min(be,512)*(h.overscaledZ/v.zoom)*.5;let Re=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Re+=` => ${h.overscaledZ}`),Re+=` ${ge}kb`,function(Ye,vt){Ye.initDebugOverlayCanvas();const We=Ye.debugOverlayCanvas,ht=Ye.context.gl,rt=Ye.debugOverlayCanvas.getContext("2d");rt.clearRect(0,0,We.width,We.height),rt.shadowColor="white",rt.shadowBlur=2,rt.lineWidth=1.5,rt.strokeStyle="white",rt.textBaseline="top",rt.font="bold 36px Open Sans, sans-serif",rt.fillText(vt,5,5),rt.strokeText(vt,5,5),Ye.debugOverlayTexture.update(We),Ye.debugOverlayTexture.bind(ht.LINEAR,ht.CLAMP_TO_EDGE)}(p,Re);const De=U._tileDebugTextBuffer||p.debugBuffer,Ue=U._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,Ne=U._tileDebugTextSegments||p.debugSegments;$.draw(g,b.TRIANGLES,H,ne,a.ColorMode.alphaBlended,a.CullFaceMode.disabled,ah(L,a.Color.transparent,Oe),fe,De,Ue,Ne,null,null,null,[U._globeTileDebugTextBuffer])}function ig(p,s,h,g){Ul(p,0,s+h/2,p.transform.width,h,g)}function fh(p,s,h,g){Ul(p,s-h/2,0,h,p.transform.height,g)}function Ul(p,s,h,g,v,b){const A=p.context,C=A.gl;C.enable(C.SCISSOR_TEST),C.scissor(s*a.exported.devicePixelRatio,h*a.exported.devicePixelRatio,g*a.exported.devicePixelRatio,v*a.exported.devicePixelRatio),A.clear({color:b}),C.disable(C.SCISSOR_TEST)}const og=a.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:sg}=og;function js(p,s,h,g){p.emplaceBack(s,h,g)}class dh{constructor(s){this.vertexArray=new a.StructArrayLayout3f12,this.indices=new a.StructArrayLayout3ui6,js(this.vertexArray,-1,-1,1),js(this.vertexArray,1,-1,1),js(this.vertexArray,-1,1,1),js(this.vertexArray,1,1,1),js(this.vertexArray,-1,-1,-1),js(this.vertexArray,1,-1,-1),js(this.vertexArray,-1,1,-1),js(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,sg),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=a.SegmentVector.simpleSegment(0,0,36,12)}}function Uo(p,s,h,g,v,b){const A=p.gl,C=s.paint.get("sky-atmosphere-color"),L=s.paint.get("sky-atmosphere-halo-color"),$=s.paint.get("sky-atmosphere-sun-intensity"),U=((H,ne,le,fe,ce)=>({u_matrix_3f:H,u_sun_direction:ne,u_sun_intensity:le,u_color_tint_r:[fe.r,fe.g,fe.b,fe.a],u_color_tint_m:[ce.r,ce.g,ce.b,ce.a],u_luminance:5e-5}))(a.fromMat4(a.create$1(),g),v,$,C,L);A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_CUBE_MAP_POSITIVE_X+b,s.skyboxTexture,0),h.draw(p,A.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.frontCW,U,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}const rc=a.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ag{constructor(s){const h=new a.StructArrayLayout5f20;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const g=new a.StructArrayLayout3ui6;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(h,rc.members),this.indexBuffer=s.createIndexBuffer(g),this.segments=a.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const il={symbol:function(p,s,h,g,v){if(p.renderPass!=="translucent")return;const b=a.StencilMode.disabled,A=p.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(C,L,$,U,H,ne,le){const fe=L.transform,ce=H==="map",de=ne==="map";for(const X of C){const ae=U.getTile(X),ge=ae.getBucket($);if(!ge||!ge.text||!ge.text.segments.get().length)continue;const be=a.evaluateSizeForZoom(ge.textSizeData,fe.zoom),Oe=nn(X,ge.getProjection(),fe),Re=fe.calculatePixelsToTileUnitsMatrix(ae),De=ot(Oe,ae.tileID.canonical,de,ce,fe,ge.getProjection(),Re),Ue=$.layout.get("icon-text-fit")!=="none"&&ge.hasIconData();if(be){const Ne=Math.pow(2,fe.zoom-ae.tileID.overscaledZ);f0(ge,ce,de,le,a.symbolSize,fe,De,X,Ne,be,Ue)}}}(g,p,h,s,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),v),h.paint.get("icon-opacity").constantOr(1)!==0&&tg(p,s,h,g,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),b,A),h.paint.get("text-opacity").constantOr(1)!==0&&tg(p,s,h,g,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),b,A),s.map.showCollisionBoxes&&(ec(p,s,h,g,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),ec(p,s,h,g,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(p,s,h,g){if(p.renderPass!=="translucent")return;const v=h.paint.get("circle-opacity"),b=h.paint.get("circle-stroke-width"),A=h.paint.get("circle-stroke-opacity"),C=h.layout.get("circle-sort-key").constantOr(1)!==void 0;if(v.constantOr(1)===0&&(b.constantOr(1)===0||A.constantOr(1)===0))return;const L=p.context,$=L.gl,U=p.transform,H=p.depthModeForSublayer(0,a.DepthMode.ReadOnly),ne=a.StencilMode.disabled,le=p.colorModeForRenderPass(),fe=U.projection.name==="globe",ce=[a.mercatorXfromLng(U.center.lng),a.mercatorYfromLat(U.center.lat)],de=[];for(let ae=0;ae<g.length;ae++){const ge=g[ae],be=s.getTile(ge),Oe=be.getBucket(h);if(!Oe||Oe.projection.name!==U.projection.name)continue;const Re=Oe.programConfigurations.get(h.id),De=_d(h);fe&&De.push("PROJECTION_GLOBE_VIEW");const Ue=p.useProgram("circle",Re,De),Ne=Oe.layoutVertexBuffer,Ye=Oe.globeExtVertexBuffer,vt=Oe.indexBuffer,We=U.projection.createInversionMatrix(U,ge.canonical),ht={programConfiguration:Re,program:Ue,layoutVertexBuffer:Ne,globeExtVertexBuffer:Ye,indexBuffer:vt,uniformValues:yd(p,ge,be,We,ce,h),tile:be};if(C){const rt=Oe.segments.get();for(const _t of rt)de.push({segments:new a.SegmentVector([_t]),sortKey:_t.sortKey,state:ht})}else de.push({segments:Oe.segments,sortKey:0,state:ht})}C&&de.sort((ae,ge)=>ae.sortKey-ge.sortKey);const X={useDepthForOcclusion:!fe};for(const ae of de){const{programConfiguration:ge,program:be,layoutVertexBuffer:Oe,globeExtVertexBuffer:Re,indexBuffer:De,uniformValues:Ue,tile:Ne}=ae.state,Ye=ae.segments;p.terrain&&p.terrain.setupElevationDraw(Ne,be,X),p.prepareDrawProgram(L,be,Ne.tileID.toUnwrapped()),be.draw(L,$.TRIANGLES,H,ne,le,a.CullFaceMode.disabled,Ue,h.id,Oe,De,Ye,h.paint,U.zoom,ge,[Re])}},heatmap:function(p,s,h,g){if(h.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){const v=p.context,b=v.gl,A=a.StencilMode.disabled,C=new a.ColorMode([b.ONE,b.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(le,fe,ce,de){const X=le.gl,ae=fe.width*de,ge=fe.height*de;le.activeTexture.set(X.TEXTURE1),le.viewport.set([0,0,ae,ge]);let be=ce.heatmapFbo;if(!be||be&&(be.width!==ae||be.height!==ge)){be&&be.destroy();const Oe=X.createTexture();X.bindTexture(X.TEXTURE_2D,Oe),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MAG_FILTER,X.LINEAR),be=ce.heatmapFbo=le.createFramebuffer(ae,ge,!1),function(Re,De,Ue,Ne,Ye,vt){const We=Re.gl;We.texImage2D(We.TEXTURE_2D,0,Re.isWebGL2&&Re.extRenderToTextureHalfFloat?We.RGBA16F:We.RGBA,Ye,vt,0,We.RGBA,Re.extRenderToTextureHalfFloat?Re.isWebGL2?We.HALF_FLOAT:Re.extTextureHalfFloat.HALF_FLOAT_OES:We.UNSIGNED_BYTE,null),Ne.colorAttachment.set(Ue)}(le,0,Oe,be,ae,ge)}else X.bindTexture(X.TEXTURE_2D,be.colorAttachment.get()),le.bindFramebuffer.set(be.framebuffer)})(v,p,h,p.transform.projection.name==="globe"?.5:.25),v.clear({color:a.Color.transparent});const L=p.transform,$=L.projection.name==="globe",U=$?["PROJECTION_GLOBE_VIEW"]:null,H=$?a.CullFaceMode.frontCCW:a.CullFaceMode.disabled,ne=[a.mercatorXfromLng(L.center.lng),a.mercatorYfromLat(L.center.lat)];for(let le=0;le<g.length;le++){const fe=g[le];if(s.hasRenderableParent(fe))continue;const ce=s.getTile(fe),de=ce.getBucket(h);if(!de||de.projection.name!==L.projection.name)continue;const X=de.programConfigurations.get(h.id),ae=p.useProgram("heatmap",X,U),{zoom:ge}=p.transform;p.terrain&&p.terrain.setupElevationDraw(ce,ae),p.prepareDrawProgram(v,ae,fe.toUnwrapped());const be=L.projection.createInversionMatrix(L,fe.canonical);ae.draw(v,b.TRIANGLES,a.DepthMode.disabled,A,C,H,Jm(p,fe,ce,be,ne,ge,h.paint.get("heatmap-intensity")),h.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,h.paint,p.transform.zoom,X,$?[de.globeExtVertexBuffer]:null)}v.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),function(v,b){const A=v.context,C=A.gl,L=b.heatmapFbo;if(!L)return;A.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,L.colorAttachment.get()),A.activeTexture.set(C.TEXTURE1);let $=b.colorRampTexture;$||($=b.colorRampTexture=new a.Texture(A,b.colorRamp,C.RGBA)),$.bind(C.LINEAR,C.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(A,C.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,v.colorModeForRenderPass(),a.CullFaceMode.disabled,((U,H,ne,le)=>({u_image:0,u_color_ramp:1,u_opacity:H.paint.get("heatmap-opacity")}))(0,b),b.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,b.paint,v.transform.zoom)}(p,h))},line:function(p,s,h,g){if(p.renderPass!=="translucent")return;const v=h.paint.get("line-opacity"),b=h.paint.get("line-width");if(v.constantOr(1)===0||b.constantOr(1)===0)return;const A=p.depthModeForSublayer(0,a.DepthMode.ReadOnly),C=p.colorModeForRenderPass(),L=p.terrain&&p.terrain.renderingToTexture?1:a.exported.devicePixelRatio,$=h.paint.get("line-dasharray"),U=$.constantOr(1),H=h.layout.get("line-cap"),ne=h.paint.get("line-pattern"),le=ne.constantOr(1),fe=h.paint.get("line-gradient"),ce=le?"linePattern":"line",de=p.context,X=de.gl,ae=(be=>{const Oe=[];Qu(be)&&Oe.push("RENDER_LINE_DASH"),be.paint.get("line-gradient")&&Oe.push("RENDER_LINE_GRADIENT");const Re=be.paint.get("line-trim-offset");Re[0]===0&&Re[1]===0||Oe.push("RENDER_LINE_TRIM_OFFSET");const De=be.paint.get("line-pattern").constantOr(1),Ue=be.paint.get("line-opacity").constantOr(1)!==1;return!De&&Ue&&Oe.push("RENDER_LINE_ALPHA_DISCARD"),Oe})(h);let ge=ae.includes("RENDER_LINE_ALPHA_DISCARD");p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(ge=!1);for(const be of g){const Oe=s.getTile(be);if(le&&!Oe.patternsLoaded())continue;const Re=Oe.getBucket(h);if(!Re)continue;p.prepareDrawTile();const De=Re.programConfigurations.get(h.id),Ue=p.useProgram(ce,De,ae),Ne=ne.constantOr(null);if(Ne&&Oe.imageAtlas){const ut=Oe.imageAtlas.patternPositions[Ne.toString()];ut&&De.setConstantPatternPositions(ut)}const Ye=$.constantOr(null),vt=H.constantOr(null);if(!le&&Ye&&vt&&Oe.lineAtlas){const ut=Oe.lineAtlas.getDash(Ye,vt);ut&&De.setConstantPatternPositions(ut)}let[We,ht]=h.paint.get("line-trim-offset");(vt==="round"||vt==="square")&&We!==ht&&(We===0&&(We-=1),ht===1&&(ht+=1));const rt=p.terrain?be.projMatrix:null,_t=le?Ju(p,Oe,h,rt,L):c0(p,Oe,h,rt,Re.lineClipsArray.length,L,[We,ht]);if(fe){const ut=Re.gradients[h.id];let bt=ut.texture;if(h.gradientVersion!==ut.version){let pt=256;if(h.stepInterpolant){const Tt=s.getSource().maxzoom,Wt=be.canonical.z===Tt?Math.ceil(1<<p.transform.maxZoom-be.canonical.z):1;pt=a.clamp(a.nextPowerOfTwo(Re.maxLineLength/a.EXTENT*1024*Wt),256,de.maxTextureSize)}ut.gradient=a.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:pt,image:ut.gradient||void 0,clips:Re.lineClipsArray}),ut.texture?ut.texture.update(ut.gradient):ut.texture=new a.Texture(de,ut.gradient,X.RGBA),ut.version=h.gradientVersion,bt=ut.texture}de.activeTexture.set(X.TEXTURE1),bt.bind(h.stepInterpolant?X.NEAREST:X.LINEAR,X.CLAMP_TO_EDGE)}U&&(de.activeTexture.set(X.TEXTURE0),Oe.lineAtlasTexture.bind(X.LINEAR,X.REPEAT),De.updatePaintBuffers()),le&&(de.activeTexture.set(X.TEXTURE0),Oe.imageAtlasTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),De.updatePaintBuffers()),p.prepareDrawProgram(de,Ue,be.toUnwrapped());const Xe=ut=>{Ue.draw(de,X.TRIANGLES,A,ut,C,a.CullFaceMode.disabled,_t,h.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,h.paint,p.transform.zoom,De,[Re.layoutVertexBuffer2])};if(ge){const ut=p.stencilModeForClipping(be).ref;ut===0&&p.terrain&&de.clear({stencil:0});const bt={func:X.EQUAL,mask:255};_t.u_alpha_discard_threshold=.8,Xe(new a.StencilMode(bt,ut,255,X.KEEP,X.KEEP,X.INVERT)),_t.u_alpha_discard_threshold=0,Xe(new a.StencilMode(bt,ut,255,X.KEEP,X.KEEP,X.KEEP))}else Xe(p.stencilModeForClipping(be))}ge&&(p.resetStencilClippingMasks(),p.terrain&&de.clear({stencil:0}))},fill:function(p,s,h,g){const v=h.paint.get("fill-color"),b=h.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const A=p.colorModeForRenderPass(),C=h.paint.get("fill-pattern"),L=p.opaquePassEnabledForLayer()&&!C.constantOr(1)&&v.constantOr(a.Color.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===L){const $=p.depthModeForSublayer(1,p.renderPass==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly);rg(p,s,h,g,$,A,!1)}if(p.renderPass==="translucent"&&h.paint.get("fill-antialias")){const $=p.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,a.DepthMode.ReadOnly);rg(p,s,h,g,$,A,!0)}},"fill-extrusion":function(p,s,h,g){const v=h.paint.get("fill-extrusion-opacity");if(v!==0&&p.renderPass==="translucent"){const b=new a.DepthMode(p.context.gl.LEQUAL,a.DepthMode.ReadWrite,p.depthRangeFor3D);if(v!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))hh(p,s,h,g,b,a.StencilMode.disabled,a.ColorMode.disabled),hh(p,s,h,g,b,p.stencilModeFor3D(),p.colorModeForRenderPass()),p.resetStencilClippingMasks();else{const A=p.colorModeForRenderPass();hh(p,s,h,g,b,a.StencilMode.disabled,A)}}},hillshade:function(p,s,h,g){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent")return;const v=p.context,b=p.depthModeForSublayer(0,a.DepthMode.ReadOnly),A=p.colorModeForRenderPass(),C=p.terrain&&p.terrain.renderingToTexture,[L,$]=p.renderPass!=="translucent"||C?[{},g]:p.stencilConfigForOverlap(g);for(const U of $){const H=s.getTile(U);if(H.needsHillshadePrepare&&p.renderPass==="offscreen")Zm(p,H,h,b,a.StencilMode.disabled,A);else if(p.renderPass==="translucent"){const ne=C&&p.terrain?p.terrain.stencilModeForRTTOverlap(U):L[U.overscaledZ];Wm(p,U,H,h,b,ne,A)}}v.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,s,h,g,v,b){if(p.renderPass!=="translucent"||h.paint.get("raster-opacity")===0||!g.length)return;const A=p.context,C=A.gl,L=s.getSource(),$=p.useProgram("raster"),U=p.colorModeForRenderPass(),H=p.terrain&&p.terrain.renderingToTexture,[ne,le]=L instanceof dr||H?[{},g]:p.stencilConfigForOverlap(g),fe=le[le.length-1].overscaledZ,ce=!p.options.moving;for(const de of le){const X=H?a.DepthMode.disabled:p.depthModeForSublayer(de.overscaledZ-fe,h.paint.get("raster-opacity")===1?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly,C.LESS),ae=de.toUnwrapped(),ge=s.getTile(de);if(H&&(!ge||!ge.hasData()))continue;const be=H?de.projMatrix:p.transform.calculateProjMatrix(ae,ce),Oe=p.terrain&&H?p.terrain.stencilModeForRTTOverlap(de):ne[de.overscaledZ],Re=b?0:h.paint.get("raster-fade-duration");ge.registerFadeDuration(Re);const De=s.findLoadedParent(de,0),Ue=fd(ge,De,s,p.transform,Re);let Ne,Ye;p.terrain&&p.terrain.prepareDrawTile();const vt=h.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;A.activeTexture.set(C.TEXTURE0),ge.texture.bind(vt,C.CLAMP_TO_EDGE),A.activeTexture.set(C.TEXTURE1),De?(De.texture.bind(vt,C.CLAMP_TO_EDGE),Ne=Math.pow(2,De.tileID.overscaledZ-ge.tileID.overscaledZ),Ye=[ge.tileID.canonical.x*Ne%1,ge.tileID.canonical.y*Ne%1]):ge.texture.bind(vt,C.CLAMP_TO_EDGE),ge.texture.useMipmap&&A.extTextureFilterAnisotropic&&p.transform.pitch>20&&C.texParameterf(C.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);const We=bd(be,Ye||[0,0],Ne||1,Ue,h,L instanceof dr?L.perspectiveTransform:[0,0]);if(p.prepareDrawProgram(A,$,ae),L instanceof dr)L.boundsBuffer&&L.boundsSegments&&$.draw(A,C.TRIANGLES,X,a.StencilMode.disabled,U,a.CullFaceMode.disabled,We,h.id,L.boundsBuffer,p.quadTriangleIndexBuffer,L.boundsSegments);else{const{tileBoundsBuffer:ht,tileBoundsIndexBuffer:rt,tileBoundsSegments:_t}=p.getTileBoundsBuffers(ge);$.draw(A,C.TRIANGLES,X,Oe,U,a.CullFaceMode.disabled,We,h.id,ht,rt,_t)}}p.resetStencilClippingMasks()},background:function(p,s,h,g){const v=h.paint.get("background-color"),b=h.paint.get("background-opacity");if(b===0)return;const A=p.context,C=A.gl,L=p.transform,$=L.tileSize,U=h.paint.get("background-pattern");if(p.isPatternMissing(U))return;const H=!U&&v.a===1&&b===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==H)return;const ne=a.StencilMode.disabled,le=p.depthModeForSublayer(0,H==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly),fe=p.colorModeForRenderPass(),ce=p.useProgram(U?"backgroundPattern":"background");let de,X=g;X||(de=p.getBackgroundTiles(),X=Object.values(de).map(ae=>ae.tileID)),U&&(A.activeTexture.set(C.TEXTURE0),p.imageManager.bind(p.context));for(const ae of X){const ge=ae.toUnwrapped(),be=g?ae.projMatrix:p.transform.calculateProjMatrix(ge);p.prepareDrawTile();const Oe=s?s.getTile(ae):de?de[ae.key]:new a.Tile(ae,$,L.zoom,p),Re=U?h0(be,b,p,U,{tileID:ae,tileSize:$}):Ed(be,b,v);p.prepareDrawProgram(A,ce,ge);const{tileBoundsBuffer:De,tileBoundsIndexBuffer:Ue,tileBoundsSegments:Ne}=p.getTileBoundsBuffers(Oe);ce.draw(A,C.TRIANGLES,le,ne,fe,a.CullFaceMode.disabled,Re,h.id,De,Ue,Ne)}},sky:function(p,s,h){const g=p.transform,v=g.projection.name==="mercator"||g.projection.name==="globe"?1:a.smoothstep(7,8,g.zoom),b=h.paint.get("sky-opacity")*v;if(b===0)return;const A=p.context,C=h.paint.get("sky-type"),L=new a.DepthMode(A.gl.LEQUAL,a.DepthMode.ReadOnly,[0,1]),$=p.frameCounter/1e3%1;C==="atmosphere"?p.renderPass==="offscreen"?h.needsSkyboxCapture(p)&&(function(U,H,ne,le){const fe=U.context,ce=fe.gl;let de=H.skyboxFbo;if(!de){de=H.skyboxFbo=fe.createFramebuffer(32,32,!1),H.skyboxGeometry=new dh(fe),H.skyboxTexture=fe.gl.createTexture(),ce.bindTexture(ce.TEXTURE_CUBE_MAP,H.skyboxTexture),ce.texParameteri(ce.TEXTURE_CUBE_MAP,ce.TEXTURE_WRAP_S,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_CUBE_MAP,ce.TEXTURE_WRAP_T,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_CUBE_MAP,ce.TEXTURE_MIN_FILTER,ce.LINEAR),ce.texParameteri(ce.TEXTURE_CUBE_MAP,ce.TEXTURE_MAG_FILTER,ce.LINEAR);for(let be=0;be<6;++be)ce.texImage2D(ce.TEXTURE_CUBE_MAP_POSITIVE_X+be,0,ce.RGBA,32,32,0,ce.RGBA,ce.UNSIGNED_BYTE,null)}fe.bindFramebuffer.set(de.framebuffer),fe.viewport.set([0,0,32,32]);const X=H.getCenter(U,!0),ae=U.useProgram("skyboxCapture"),ge=new Float64Array(16);a.identity(ge),a.rotateY(ge,ge,.5*-Math.PI),Uo(fe,H,ae,ge,X,0),a.identity(ge),a.rotateY(ge,ge,.5*Math.PI),Uo(fe,H,ae,ge,X,1),a.identity(ge),a.rotateX(ge,ge,.5*-Math.PI),Uo(fe,H,ae,ge,X,2),a.identity(ge),a.rotateX(ge,ge,.5*Math.PI),Uo(fe,H,ae,ge,X,3),a.identity(ge),Uo(fe,H,ae,ge,X,4),a.identity(ge),a.rotateY(ge,ge,Math.PI),Uo(fe,H,ae,ge,X,5),fe.viewport.set([0,0,U.width,U.height])}(p,h),h.markSkyboxValid(p)):p.renderPass==="sky"&&function(U,H,ne,le,fe){const ce=U.context,de=ce.gl,X=U.transform,ae=U.useProgram("skybox");ce.activeTexture.set(de.TEXTURE0),de.bindTexture(de.TEXTURE_CUBE_MAP,H.skyboxTexture);const ge=((be,Oe,Re,De,Ue)=>({u_matrix:be,u_sun_direction:Oe,u_cubemap:0,u_opacity:De,u_temporal_offset:Ue}))(X.skyboxMatrix,H.getCenter(U,!1),0,le,fe);U.prepareDrawProgram(ce,ae),ae.draw(ce,de.TRIANGLES,ne,a.StencilMode.disabled,U.colorModeForRenderPass(),a.CullFaceMode.backCW,ge,"skybox",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(p,h,L,b,$):C==="gradient"&&p.renderPass==="sky"&&function(U,H,ne,le,fe){const ce=U.context,de=ce.gl,X=U.transform,ae=U.useProgram("skyboxGradient");H.skyboxGeometry||(H.skyboxGeometry=new dh(ce)),ce.activeTexture.set(de.TEXTURE0);let ge=H.colorRampTexture;ge||(ge=H.colorRampTexture=new a.Texture(ce,H.colorRamp,de.RGBA)),ge.bind(de.LINEAR,de.CLAMP_TO_EDGE);const be=((Oe,Re,De,Ue,Ne)=>({u_matrix:Oe,u_color_ramp:0,u_center_direction:Re,u_radius:a.degToRad(De),u_opacity:Ue,u_temporal_offset:Ne}))(X.skyboxMatrix,H.getCenter(U,!1),H.paint.get("sky-gradient-radius"),le,fe);U.prepareDrawProgram(ce,ae),ae.draw(ce,de.TRIANGLES,ne,a.StencilMode.disabled,U.colorModeForRenderPass(),a.CullFaceMode.backCW,be,"skyboxGradient",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(p,h,L,b,$)},debug:function(p,s,h){for(let g=0;g<h.length;g++)y0(p,s,h[g])},custom:function(p,s,h,g){const v=p.context,b=h.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||p.renderPass==="offscreen")&&h.isLayerDraped()){if(p.renderPass==="offscreen"){const A=b.prerender;if(A){if(p.setCustomLayerDefaults(),v.setColorMode(p.colorModeForRenderPass()),p.transform.projection.name==="globe"){const C=p.transform.pointMerc;A.call(b,v.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),a.globeToMercatorTransition(p.transform.zoom),[C.x,C.y],p.transform.pixelsPerMeterRatio)}else A.call(b,v.gl,p.transform.customLayerMatrix());v.setDirty(),p.setBaseState()}}else if(p.renderPass==="translucent"){if(p.terrain&&p.terrain.renderingToTexture){const C=b.renderToTile;if(C){const L=g[0].canonical,$=new a.MercatorCoordinate(L.x+g[0].wrap*(1<<L.z),L.y,L.z);v.setDepthMode(a.DepthMode.disabled),v.setStencilMode(a.StencilMode.disabled),v.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),C.call(b,v.gl,$),v.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),v.setColorMode(p.colorModeForRenderPass()),v.setStencilMode(a.StencilMode.disabled);const A=b.renderingMode==="3d"?new a.DepthMode(p.context.gl.LEQUAL,a.DepthMode.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,a.DepthMode.ReadOnly);if(v.setDepthMode(A),p.transform.projection.name==="globe"){const C=p.transform.pointMerc;b.render(v.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),a.globeToMercatorTransition(p.transform.zoom),[C.x,C.y],p.transform.pixelsPerMeterRatio)}else b.render(v.gl,p.transform.customLayerMatrix());v.setDirty(),p.setBaseState(),v.bindFramebuffer.set(null)}}else a.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class $l{constructor(s,h,g=!1){this.context=new Ct(s,g),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=a.SourceCache.maxUnderzooming+a.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(s,h){const g=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new pd(this,s));const v=this._terrain;this.transform.elevation=g?v:null,v.update(s,this.transform,h)}_updateFog(s){const h=s.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,v]=h.getFovAdjustedRange(this.transform._fov);if(g>v)return void(this.transform.fogCullDistSq=null);const b=g+.78*(v-g);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(s,h){if(this.width=s*a.exported.devicePixelRatio,this.height=h*a.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._layers[g].resize()}setup(){const s=this.context,h=new a.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(a.EXTENT,0),h.emplaceBack(0,a.EXTENT),h.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=s.createVertexBuffer(h,a.posAttributes.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const g=new a.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(a.EXTENT,0),g.emplaceBack(0,a.EXTENT),g.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=s.createVertexBuffer(g,a.posAttributes.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const v=new a.StructArrayLayout2i4;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(v,a.posAttributes.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const b=new a.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(a.EXTENT,0,a.EXTENT,0),b.emplaceBack(0,a.EXTENT,0,a.EXTENT),b.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.mercatorBoundsBuffer=s.createVertexBuffer(b,a.boundsAttributes.members),this.mercatorBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const A=new a.StructArrayLayout3ui6;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(A);const C=new a.StructArrayLayout1ui2;for(const $ of[0,1,3,2,0])C.emplaceBack($);this.debugIndexBuffer=s.createIndexBuffer(C),this.emptyTexture=new a.Texture(s,new a.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA),this.identityMat=a.create();const L=this.context.gl;this.stencilClearMode=new a.StencilMode({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO),this.loadTimeStamps.push(a.window.performance.now()),this.atmosphereBuffer=new ag(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const s=this.context,h=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(s,h.TRIANGLES,a.DepthMode.disabled,this.stencilClearMode,a.ColorMode.disabled,a.CullFaceMode.disabled,Ku(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,h,g){if(!h||this.currentStencilSource===h.id||!s.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const L of g)if(this._tileClippingMaskIDs[L.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=h.id;const v=this.context,b=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode(a.ColorMode.disabled),v.setDepthMode(a.DepthMode.disabled);const A=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of g){const L=h.getTile(C),$=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:U,tileBoundsIndexBuffer:H,tileBoundsSegments:ne}=this.getTileBoundsBuffers(L);A.draw(v,b.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:b.ALWAYS,mask:0},$,255,b.KEEP,b.KEEP,b.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,Ku(C.projMatrix),"$clipping",U,H,ne)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,h=this.context.gl;return new a.StencilMode({func:h.NOTEQUAL,mask:255},s,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);const h=this.context.gl;return new a.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(s){const h=this.context.gl,g=s.sort((A,C)=>C.overscaledZ-A.overscaledZ),v=g[g.length-1].overscaledZ,b=g[0].overscaledZ-v+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const A={};for(let C=0;C<b;C++)A[C+v]=new a.StencilMode({func:h.GEQUAL,mask:255},C+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=b,[A,g]}return[{[v]:a.StencilMode.disabled},g]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new a.ColorMode([s.CONSTANT_COLOR,s.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?a.ColorMode.unblended:a.ColorMode.alphaBlended}depthModeForSublayer(s,h,g){if(!this.opaquePassEnabledForLayer())return a.DepthMode.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new a.DepthMode(g||this.context.gl.LEQUAL,h,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,h){this.style=s,this.options=h,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const g=this.style.order,v=this.style._sourceCaches;for(const $ in v){const U=v[$];U.used&&U.prepare(this.context)}const b={},A={},C={};for(const $ in v){const U=v[$];b[$]=U.getVisibleCoordinates(),A[$]=b[$].slice().reverse(),C[$]=U.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let $=0;$<g.length;$++)if(this.style._layers[g[$]].is3D()){this.opaquePassCutoff=$;break}if(this.terrain&&(this.terrain.updateTileBinding(C),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.GlobeSharedBuffers(this.context)),!a.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const $ of g){const U=this.style._layers[$],H=s._getLayerSourceCache(U);if(!U.hasOffscreenPass()||U.isHidden(this.transform.zoom))continue;const ne=H?A[H.id]:void 0;(U.type==="custom"||U.isSky()||ne&&ne.length)&&this.renderLayer(this,H,U,ne)}this.depthRangeFor3D=[0,1-(s.order.length+2)*this.numSublayers*this.depthEpsilon];const L=this.terrain;if(L&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&L.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:h.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const $=this.style._layers[g[this.currentLayer]],U=s._getLayerSourceCache($);if($.isSky())continue;const H=U?A[U.id]:void 0;this._renderTileClippingMasks($,U,H),this.renderLayer(this,U,$,H)}if(this.style.fog&&this.transform.projection.supportsFog&&function($,U){const H=$.context,ne=H.gl,le=$.transform,fe=new a.DepthMode(ne.LEQUAL,a.DepthMode.ReadOnly,[0,1]),ce=$.useProgram("globeAtmosphere",null,le.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),de=a.globeToMercatorTransition(le.zoom),X=U.properties.get("color").toArray01(),ae=U.properties.get("high-color").toArray01(),ge=U.properties.get("space-color").toArray01PremultipliedAlpha(),be=a.identity$1([]);a.rotateY$1(be,be,-a.degToRad(le._center.lng)),a.rotateX$1(be,be,a.degToRad(le._center.lat)),a.rotateZ$1(be,be,le.angle),a.rotateX$1(be,be,-le._pitch);const Oe=a.fromQuat(new Float32Array(16),be),Re=a.mapValue(U.properties.get("star-intensity"),0,1,0,.25),De=5e-4,Ue=a.mapValue(U.properties.get("horizon-blend"),0,1,De,.25),Ne=a.globeUseCustomAntiAliasing($,H,le)&&Ue===De?le.worldSize/(2*Math.PI*1.025)-1:le.globeRadius,Ye=$.frameCounter/1e3%1,vt=a.length(le.globeCenterInViewSpace),We=Math.sqrt(Math.pow(vt,2)-Math.pow(Ne,2)),ht=Math.acos(We/vt),rt=((Xe,ut,bt,pt,Tt,Wt,or,jt,Yt,vr,yr,qt,$r,Gr)=>({u_frustum_tl:Xe,u_frustum_tr:ut,u_frustum_br:bt,u_frustum_bl:pt,u_horizon:Tt,u_transition:Wt,u_fadeout_range:or,u_color:jt,u_high_color:Yt,u_space_color:vr,u_star_intensity:yr,u_star_size:5*a.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:qt,u_horizon_angle:$r,u_rotation_matrix:Gr}))(le.frustumCorners.TL,le.frustumCorners.TR,le.frustumCorners.BR,le.frustumCorners.BL,le.frustumCorners.horizon,de,Ue,X,ae,ge,Re,Ye,ht,Oe);$.prepareDrawProgram(H,ce);const _t=$.atmosphereBuffer;_t&&ce.draw(H,ne.TRIANGLES,fe,a.StencilMode.disabled,a.ColorMode.alphaBlended,a.CullFaceMode.backCW,rt,"skybox",_t.vertexBuffer,_t.indexBuffer,_t.segments)}(this,this.style.fog),this.renderPass="sky",(a.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const $=this.style._layers[g[this.currentLayer]],U=s._getLayerSourceCache($);$.isSky()&&this.renderLayer(this,U,$,U?A[U.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;){const $=this.style._layers[g[this.currentLayer]],U=s._getLayerSourceCache($);if($.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped($)){if($.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const H=U?($.type==="symbol"?C:A)[U.id]:void 0;this._renderTileClippingMasks($,U,U?b[U.id]:void 0),this.renderLayer(this,U,$,H),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let $=null;a.values(this.style._layers).forEach(U=>{const H=s._getLayerSourceCache(U);H&&!U.isHidden(this.transform.zoom)&&(!$||$.getSource().maxzoom<H.getSource().maxzoom)&&($=H)}),$&&this.options.showTileBoundaries&&il.debug(this,$,$.getVisibleCoordinates())}this.options.showPadding&&function($){const U=$.transform.padding;ig($,$.transform.height-(U.top||0),3,Nl),ig($,U.bottom||0,3,d0),fh($,U.left||0,3,p0),fh($,$.transform.width-(U.right||0),3,m0);const H=$.transform.centerPoint;(function(ne,le,fe,ce){Ul(ne,le-1,fe-10,2,20,ce),Ul(ne,le-10,fe-1,20,2,ce)})($,H.x,$.transform.height-H.y,g0)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(a.window.performance.now()),this.saveCanvasCopy())}renderLayer(s,h,g,v){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||v&&v.length)&&(this.id=g.id,this.gpuTimingStart(g),(!s.transform.projection.unsupportedLayers||!s.transform.projection.unsupportedLayers.includes(g.type)||s.terrain&&g.type==="custom")&&il[g.type](s,h,g,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let g=this.gpuTimers[s.id];g||(g=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),g.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const s=this.context.extTimerQuery,h=s.createQueryEXT();this.deferredRenderGpuTimeQueries.push(h),s.beginQueryEXT(s.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){const s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){const h={};for(const g in s){const v=s[g],b=this.context.extTimerQuery,A=b.getQueryObjectEXT(v.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(v.query),h[g]=A}return h}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.extTimerQuery;let g=0;for(const v of s)g+=h.getQueryObjectEXT(v,h.QUERY_RESULT_EXT)/1e6,h.deleteQueryEXT(v);return g}translatePosMatrix(s,h,g,v,b){if(!g[0]&&!g[1])return s;const A=b?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(A){const $=Math.sin(A),U=Math.cos(A);g=[g[0]*U-g[1]*$,g[0]*$+g[1]*U]}const C=[b?g[0]:Le(h,g[0],this.transform.zoom),b?g[1]:Le(h,g[1],this.transform.zoom),0],L=new Float32Array(16);return a.translate(L,s,C),L}saveTileTexture(s){const h=this._tileTextures[s.size[0]];h?h.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const h=this._tileTextures[s];return h&&h.length>0?h.pop():null}isPatternMissing(s){return s===null||s!==void 0&&!this.imageManager.getPattern(s.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const s=this.terrain&&this.terrain.renderingToTexture,h=this.terrain&&this.terrain.exaggeration()===0,g=this.style&&this.style.fog,v=[];return this.terrainRenderModeElevated()&&v.push("TERRAIN"),this.transform.projection.name==="globe"&&v.push("GLOBE"),h&&v.push("ZERO_EXAGGERATION"),g&&!s&&g.getOpacity(this.transform.pitch)!==0&&v.push("FOG"),s&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}useProgram(s,h,g){this.cache=this.cache||{};const v=g||[],b=this.currentGlobalDefines().concat(v),A=Cr.cacheKey(ld[s],s,b,h);return this.cache[A]||(this.cache[A]=new Cr(this.context,s,ld[s],h,Td[s],b)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=a.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(s,h,g){if(this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const b=v.getOpacity(this.transform.pitch),A=((C,L,$,U,H,ne,le,fe,ce,de,X)=>{const ae=C.transform,ge=L.properties.get("color").toArray01();ge[3]=U;const be=C.frameCounter/1e3%1;return{u_fog_matrix:$?ae.calculateFogTileMatrix($):C.identityMat,u_fog_range:L.getFovAdjustedRange(ae._fov),u_fog_color:ge,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_temporal_offset:be,u_frustum_tl:H,u_frustum_tr:ne,u_frustum_br:le,u_frustum_bl:fe,u_globe_pos:ce,u_globe_radius:de,u_viewport:X,u_globe_transition:a.globeToMercatorTransition(ae.zoom),u_is_globe:+(ae.projection.name==="globe")}})(this,v,g,b,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.exported.devicePixelRatio,this.transform.height*a.exported.devicePixelRatio]);h.setFogUniformValues(s,A)}}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){const s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){const s=this.context.gl,h=s.createTexture();return s.bindTexture(s.TEXTURE_2D,h),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const s=this.style&&this.style.fog;return!!s&&s.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const s=this._backgroundTiles,h=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const v of g)h[v.key]=s[v.key]||new a.Tile(v,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}}class ph{constructor(s=0,h=0,g=0,v=0){if(isNaN(s)||s<0||isNaN(h)||h<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=h,this.left=g,this.right=v}interpolate(s,h,g){return h.top!=null&&s.top!=null&&(this.top=a.number(s.top,h.top,g)),h.bottom!=null&&s.bottom!=null&&(this.bottom=a.number(s.bottom,h.bottom,g)),h.left!=null&&s.left!=null&&(this.left=a.number(s.left,h.left,g)),h.right!=null&&s.right!=null&&(this.right=a.number(s.right,h.right,g)),this}getCenter(s,h){const g=a.clamp((this.left+s-this.right)/2,0,s),v=a.clamp((this.top+h-this.bottom)/2,0,h);return new a.Point(g,v)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new ph(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function mh(p,s){const h=a.getColumn(p,3);a.fromQuat(p,s),a.setColumn(p,3,h)}function Pr(p,s){const h=a.identity$1([]);return a.rotateZ$1(h,h,-s),a.rotateX$1(h,h,-p),h}function nc(p,s){const h=[p[0],p[1],0],g=[s[0],s[1],0];if(a.length(h)>=1e-15){const A=a.normalize([],h);a.scale$2(g,A,a.dot(g,A)),s[0]=g[0],s[1]=g[1]}const v=a.cross([],s,p);if(a.len(v)<1e-15)return null;const b=Math.atan2(-v[1],v[0]);return Pr(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),b)}class lg{constructor(s,h){this.position=s,this.orientation=h}get position(){return this._position}set position(s){if(s){const h=s instanceof a.MercatorCoordinate?s:new a.MercatorCoordinate(s[0],s[1],s[2]);this._renderWorldCopies&&(h.x=a.wrap(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(s,h){if(this.orientation=null,!this.position)return;const g=this.position,v=this._elevation?this._elevation.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(s)):0,b=a.MercatorCoordinate.fromLngLat(s,v),A=[b.x-g.x,b.y-g.y,b.z-g.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=nc(A,h)}setPitchBearing(s,h){this.orientation=Pr(a.degToRad(s),a.degToRad(-h))}}class gh{constructor(s,h){this._transform=a.identity([]),this.orientation=h,this.position=s}get mercatorPosition(){const s=this.position;return new a.MercatorCoordinate(s[0],s[1],s[2])}get position(){const s=a.getColumn(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var h;s&&a.setColumn(this._transform,3,[(h=s)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||a.identity$1([]),s&&mh(this._transform,this._orientation)}getPitchBearing(){const s=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,h){this._orientation=Pr(s,h),mh(this._transform,this._orientation)}forward(){const s=a.getColumn(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){const s=a.getColumn(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){const s=a.getColumn(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,h){const g=new Float64Array(16);return a.invert(g,this.getWorldToCamera(s,h)),g}getWorldToCameraPosition(s,h,g){const v=this.position;a.scale$2(v,v,-s);const b=new Float64Array(16);return a.fromScaling(b,[g,g,g]),a.translate(b,b,v),b[10]*=h,b}getWorldToCamera(s,h){const g=new Float64Array(16),v=new Float64Array(4),b=this.position;return a.conjugate(v,this._orientation),a.scale$2(b,b,-s),a.fromQuat(g,v),a.translate(g,g,b),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=h,g[9]*=h,g[10]*=h,g[11]*=h,g}getCameraToClipPerspective(s,h,g,v){const b=new Float64Array(16);return a.perspective(b,s,h,g,v),b}getDistanceToElevation(s,h=!1){const g=s===0?0:a.mercatorZfromAltitude(s,h?a.latFromMercatorY(this.position[1]):this.position[1]),v=this.forward();return(g-this.position[2])/v[2]}clone(){return new gh([...this.position],[...this.orientation])}}function jl(p,s){const h=yh(p.projection,p.zoom,p.width,p.height),g=function(b,A,C,L,$){const U=new a.LngLat(C.lng-180*Vs,C.lat),H=new a.LngLat(C.lng+180*Vs,C.lat),ne=b.project(U.lng,U.lat),le=b.project(H.lng,H.lat),fe=-Math.atan2(le.y-ne.y,le.x-ne.x),ce=a.MercatorCoordinate.fromLngLat(C);ce.y=a.clamp(ce.y,-1+Vs,1-Vs);const de=ce.toLngLat(),X=b.project(de.lng,de.lat),ae=a.MercatorCoordinate.fromLngLat(de);ae.x+=Vs;const ge=ae.toLngLat(),be=b.project(ge.lng,ge.lat),Oe=_h(be.x-X.x,be.y-X.y,fe),Re=a.MercatorCoordinate.fromLngLat(de);Re.y+=Vs;const De=Re.toLngLat(),Ue=b.project(De.lng,De.lat),Ne=_h(Ue.x-X.x,Ue.y-X.y,fe),Ye=Math.abs(Oe.x)/Math.abs(Ne.y),vt=a.identity([]);a.rotateZ(vt,vt,-fe*(1-($?0:L)));const We=a.identity([]);return a.scale(We,We,[1,1-(1-Ye)*L,1]),We[4]=-Ne.x/Ne.y*L,a.rotateZ(We,We,fe),a.multiply(We,vt,We),We}(p.projection,0,p.center,h,s),v=ug(p);return a.scale(g,g,[v,v,1]),g}function ug(p){const s=p.projection,h=yh(p.projection,p.zoom,p.width,p.height),g=cg(s,p.center),v=cg(s,a.LngLat.convert(s.center));return Math.pow(2,g*h+(1-h)*v)}function yh(p,s,h,g,v=1/0){const b=p.range;if(!b)return 0;const A=Math.min(v,Math.max(h,g)),C=Math.log(A/1024)/Math.LN2;return a.smoothstep(b[0]+C,b[1]+C,s)}const Vs=1/4e4;function cg(p,s){const h=a.clamp(s.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),g=new a.LngLat(s.lng-180*Vs,h),v=new a.LngLat(s.lng+180*Vs,h),b=p.project(g.lng,h),A=p.project(v.lng,h),C=a.MercatorCoordinate.fromLngLat(g),L=a.MercatorCoordinate.fromLngLat(v),$=A.x-b.x,U=A.y-b.y,H=L.x-C.x,ne=L.y-C.y,le=Math.sqrt((H*H+ne*ne)/($*$+U*U));return Math.log(le)/Math.LN2}function _h(p,s,h){const g=Math.cos(h),v=Math.sin(h);return{x:p*g-s*v,y:p*v+s*g}}class Vl{constructor(s,h,g,v,b,A,C){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=s||0,this._maxZoom=h||22,this._minPitch=g??0,this._maxPitch=v??60,this.setProjection(A),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ph,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new gh,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const s=new Vl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(s,h=!1){const g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(s||g)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return a.pick(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=a.getProjection(this.projectionOptions);const g=!S(h,this.getProjection());return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setMercatorFromTransition(){const s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.getProjection({name:"mercator"});const h=s!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.Point(this.width,this.height)}get bearing(){return a.wrap(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){const h=-s*Math.PI/180;var g;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(g=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g),function(v,b,A){var C=b[0],L=b[1],$=b[2],U=b[3],H=Math.sin(A),ne=Math.cos(A);v[0]=C*ne+$*H,v[1]=L*ne+U*H,v[2]=C*-H+$*ne,v[3]=L*-H+U*ne}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const h=a.clamp(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=a.degToRad(s),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){const h=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const s=this._elevation;this._centerAltitude=s.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=s.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const s=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let v=0,b=0;for(let A=0;A<h.length;A++){const C=new a.Point(h[A][0]*this.width,g+h[A][1]*(this.height-g)),L=s.pointCoordinate(C);if(!L)continue;const $=1/Math.hypot(L[0]-this._camera.position[0],L[1]-this._camera.position[1]);v+=L[3]*$,b+=$}return b===0?NaN:v/b}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const s=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*h,v=this._mercatorZfromZoom(s),b=this._mercatorZfromZoom(this._maxZoom),A=Math.max(v-g,b);this._setZoom(this._zoomFromMercatorZ(A))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude()));let g;g=s.z<this._camera.position[2]?[h.x,h.y,h.z]:[s.x,s.y,s.z];const v=a.length(a.sub([],this._camera.position,g));return a.clamp(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let h=!1;if(s.orientation&&!a.exactEquals(s.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(s.orientation)),s.position){const g=[s.position.x,s.position.y,s.position.z];a.exactEquals$1(g,this._camera.position)||(this._setCameraPosition(g),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const s=this._camera.position,h=new lg;return h.position=new a.MercatorCoordinate(s[0],s[1],s[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(s){if(!a.length$1(s))return!1;a.normalize$1(s,s);const h=a.transformQuat([],[0,0,-1],s),g=a.transformQuat([],[0,-1,0],s);if(g[2]<0)return!1;const v=nc(h,g);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(s){const h=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;s[2]=a.clamp(s[2],v/g,v/h),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,h,g){this._unmodified=!1,this._edgeInsets.interpolate(s,h,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const h=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(s){const h=[new a.UnwrappedTileID(0,s)];if(this.renderWorldCopies){const g=this.pointCoordinate(new a.Point(0,0)),v=this.pointCoordinate(new a.Point(this.width,0)),b=this.pointCoordinate(new a.Point(this.width,this.height)),A=this.pointCoordinate(new a.Point(0,this.height)),C=Math.floor(Math.min(g.x,v.x,b.x,A.x)),L=Math.floor(Math.max(g.x,v.x,b.x,A.x)),$=1;for(let U=C-$;U<=L+$;U++)U!==0&&h.push(new a.UnwrappedTileID(U,s))}return h}coveringTiles(s){let h=this.coveringZoomLevel(s);const g=h,v=this.elevation&&!s.isTerrainDEM,b=this.projection.name==="mercator";if(s.minzoom!==void 0&&h<s.minzoom)return[];s.maxzoom!==void 0&&h>s.maxzoom&&(h=s.maxzoom);const A=this.locationCoordinate(this.center),C=this.center.lat,L=1<<h,$=[L*A.x,L*A.y,0],U=this.projection.name==="globe",H=!U,ne=a.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,H),le=U?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),fe=L*a.mercatorZfromAltitude(1,this.center.lat),ce=this._camera.position[2]/a.mercatorZfromAltitude(1,this.center.lat),de=[L*le.x,L*le.y,ce*(H?1:fe)],X=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),ae=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?h:0,ge=s.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,be=s.isTerrainDEM?-ge:this._elevation?this._elevation.getMinElevationBelowMSL():0,Oe=this.projection.isReprojectedInTileSpace?ug(this):1,Re=Xe=>{const bt=new a.MercatorCoordinate(Xe.x+25e-6,Xe.y,Xe.z),pt=new a.MercatorCoordinate(Xe.x,Xe.y+25e-6,Xe.z),Tt=Xe.toLngLat(),Wt=bt.toLngLat(),or=pt.toLngLat(),jt=this.locationCoordinate(Tt),Yt=this.locationCoordinate(Wt),vr=this.locationCoordinate(or),yr=Math.hypot(Yt.x-jt.x,Yt.y-jt.y),qt=Math.hypot(vr.x-jt.x,vr.y-jt.y);return Math.sqrt(yr*qt)*Oe/25e-6},De=Xe=>{const ut=ge,bt=be;return{aabb:a.tileAABB(this,L,0,0,0,Xe,bt,ut,this.projection),zoom:0,x:0,y:0,minZ:bt,maxZ:ut,wrap:Xe,fullyVisible:!1}},Ue=[];let Ne=[];const Ye=h,vt=s.reparseOverscaled?g:h,We=Xe=>Xe*Xe,ht=We((ce-this._centerAltitude)*fe),rt=Xe=>{if(!this._elevation||!Xe.tileID||!b)return;const ut=this._elevation.getMinMaxForTile(Xe.tileID),bt=Xe.aabb;ut?(bt.min[2]=ut.min,bt.max[2]=ut.max,bt.center[2]=(bt.min[2]+bt.max[2])/2):(Xe.shouldSplit=_t(Xe),Xe.shouldSplit||(bt.min[2]=bt.max[2]=bt.center[2]=this._centerAltitude))},_t=Xe=>{if(Xe.zoom<ae)return!0;if(Xe.zoom===Ye)return!1;if(Xe.shouldSplit!=null)return Xe.shouldSplit;const ut=Xe.aabb.distanceX(de),bt=Xe.aabb.distanceY(de);let pt=ht,Tt=1;if(U){pt=We(Xe.aabb.distanceZ(de));const jt=Math.pow(2,Xe.zoom),Yt=a.latFromMercatorY((Xe.y+1)/jt),vr=a.latFromMercatorY(Xe.y/jt),yr=Math.min(Math.max(C,Yt),vr),qt=a.circumferenceAtLatitude(yr)/a.circumferenceAtLatitude(C);if(Tt=yr===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,qt/this._mercatorScaleRatio),this.zoom<=a.GLOBE_ZOOM_THRESHOLD_MIN&&Xe.zoom===Ye-1&&qt>=.9)return!0}else if(v&&(pt=We(Xe.aabb.distanceZ(de)*fe)),this.projection.isReprojectedInTileSpace&&g<=5){const jt=Math.pow(2,Xe.zoom),Yt=Re(new a.MercatorCoordinate((Xe.x+.5)/jt,(Xe.y+.5)/jt));Tt=Yt>.85?1:Yt}const Wt=ut*ut+bt*bt+pt,or=We((1<<Ye-Xe.zoom)*X*Tt*((jt,Yt)=>{if(Yt*We(.707)<jt)return 1;const vr=Math.sqrt(Yt/jt);return vr/(1.4144271570014144+(Math.pow(1.1,vr-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(pt,ht),Wt));return Wt<or};if(this.renderWorldCopies)for(let Xe=1;Xe<=3;Xe++)Ue.push(De(-Xe)),Ue.push(De(Xe));for(Ue.push(De(0));Ue.length>0;){const Xe=Ue.pop(),ut=Xe.x,bt=Xe.y;let pt=Xe.fullyVisible;if(!pt){const Tt=Xe.aabb.intersects(ne);if(Tt===0)continue;pt=Tt===2}if(Xe.zoom!==Ye&&_t(Xe))for(let Tt=0;Tt<4;Tt++){const Wt=(ut<<1)+Tt%2,or=(bt<<1)+(Tt>>1),jt={aabb:b?Xe.aabb.quadrant(Tt):a.tileAABB(this,L,Xe.zoom+1,Wt,or,Xe.wrap,Xe.minZ,Xe.maxZ,this.projection),zoom:Xe.zoom+1,x:Wt,y:or,wrap:Xe.wrap,fullyVisible:pt,tileID:void 0,shouldSplit:void 0,minZ:Xe.minZ,maxZ:Xe.maxZ};v&&!U&&(jt.tileID=new a.OverscaledTileID(Xe.zoom+1===Ye?vt:Xe.zoom+1,Xe.wrap,Xe.zoom+1,Wt,or),rt(jt)),Ue.push(jt)}else{const Tt=Xe.zoom===Ye?vt:Xe.zoom;if(s.minzoom&&s.minzoom>Tt)continue;const Wt=$[0]-(.5+ut+(Xe.wrap<<Xe.zoom))*(1<<h-Xe.zoom),or=$[1]-.5-bt,jt=Xe.tileID?Xe.tileID:new a.OverscaledTileID(Tt,Xe.wrap,Xe.zoom,ut,bt);Ne.push({tileID:jt,distanceSq:Wt*Wt+or*or})}}if(this.fogCullDistSq){const Xe=this.fogCullDistSq,ut=this.horizonLineFromTop();Ne=Ne.filter(bt=>{const pt=[0,0,0,1],Tt=[a.EXTENT,a.EXTENT,0,1],Wt=this.calculateFogTileMatrix(bt.tileID.toUnwrapped());a.transformMat4$1(pt,pt,Wt),a.transformMat4$1(Tt,Tt,Wt);const or=a.getAABBPointSquareDist(pt,Tt);if(or===0)return!0;let jt=!1;const Yt=this._elevation;if(Yt&&or>Xe&&ut!==0){const vr=this.calculateProjMatrix(bt.tileID.toUnwrapped());let yr;s.isTerrainDEM||(yr=Yt.getMinMaxForTile(bt.tileID)),yr||(yr={min:be,max:ge});const qt=a.furthestTileCorner(this.rotation),$r=[qt[0]*a.EXTENT,qt[1]*a.EXTENT,yr.max];a.transformMat4($r,$r,vr),jt=(1-$r[1])*this.height*.5<ut}return or<Xe||jt})}return Ne.sort((Xe,ut)=>Xe.distanceSq-ut.distanceSq).map(Xe=>Xe.tileID)}resize(s,h){this.width=s,this.height=h,this.pixelsToGLUnits=[2/s,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const h=a.clamp(s.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),g=this.projection.project(s.lng,h);return new a.Point(g.x*this.worldSize,g.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/a.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,h){let g,v;const b=this.centerPoint;if(this.projection.name==="globe"){const C=this.worldSize;g=(h.x-b.x)/C,v=(h.y-b.y)/C}else{const C=this.pointCoordinate(h),L=this.pointCoordinate(b);g=C.x-L.x,v=C.y-L.y}const A=this.locationCoordinate(s);this.setLocation(new a.MercatorCoordinate(A.x-g,A.y-v))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s){return this.projection.locationPoint(this,s)}locationPoint3D(s){return this.projection.locationPoint(this,s,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s){return this.coordinateLocation(this.pointCoordinate3D(s))}locationCoordinate(s,h){const g=h?a.mercatorZfromAltitude(h,s.lat):void 0,v=this.projection.project(s.lng,s.lat);return new a.MercatorCoordinate(v.x,v.y,g)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,h){const g=h??this._centerAltitude,v=[s.x,s.y,0,1],b=[s.x,s.y,1,1];a.transformMat4$1(v,v,this.pixelMatrixInverse),a.transformMat4$1(b,b,this.pixelMatrixInverse);const A=b[3];a.scale$1(v,v,1/v[3]),a.scale$1(b,b,1/A);const C=v[2],L=b[2];return{p0:v,p1:b,t:C===L?0:(g-C)/(L-C)}}screenPointToMercatorRay(s){const h=[s.x,s.y,0,1],g=[s.x,s.y,1,1];return a.transformMat4$1(h,h,this.pixelMatrixInverse),a.transformMat4$1(g,g,this.pixelMatrixInverse),a.scale$1(h,h,1/h[3]),a.scale$1(g,g,1/g[3]),h[2]=a.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,g[2]=a.mercatorZfromAltitude(g[2],this._center.lat)*this.worldSize,a.scale$1(h,h,1/this.worldSize),a.scale$1(g,g,1/this.worldSize),new a.Ray([h[0],h[1],h[2]],a.normalize([],a.sub([],g,h)))}rayIntersectionCoordinate(s){const{p0:h,p1:g,t:v}=s,b=a.mercatorZfromAltitude(h[2],this._center.lat),A=a.mercatorZfromAltitude(g[2],this._center.lat);return new a.MercatorCoordinate(a.number(h[0],g[0],v)/this.worldSize,a.number(h[1],g[1],v)/this.worldSize,a.number(b,A,v))}pointCoordinate(s,h=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,h)}pointCoordinate3D(s){if(!this.elevation)return this.pointCoordinate(s);let h=this.projection.pointCoordinate3D(this,s.x,s.y);if(h)return new a.MercatorCoordinate(h[0],h[1],h[2]);let g=0,v=this.horizonLineFromTop();if(s.y>v)return this.pointCoordinate(s);const b=.02*v,A=s.clone();for(let C=0;C<10&&v-g>b;C++){A.y=a.number(g,v,.66);const L=this.projection.pointCoordinate3D(this,A.x,A.y);L?(v=A.y,h=L):g=A.y}return h?new a.MercatorCoordinate(h[0],h[1],h[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}isPointOnSurface(s){if(s.y<0||s.y>this.height||s.x<0||s.x>this.width)return!1;if(this.elevation||this.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(s);const h=this.pointCoordinate(s);return h.y>=0&&h.y<=1}_coordinatePoint(s,h){const g=h&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,v=[s.x*this.worldSize,s.y*this.worldSize,g+s.toAltitude(),1];return a.transformMat4$1(v,v,this.pixelMatrix),v[3]>0?new a.Point(v[0]/v[3],v[1]/v[3]):new a.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:s,left:h}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,b=this.pointLocation3D(new a.Point(h,s)),A=this.pointLocation3D(new a.Point(v,s)),C=this.pointLocation3D(new a.Point(v,g)),L=this.pointLocation3D(new a.Point(h,g));let $=Math.min(b.lng,A.lng,C.lng,L.lng),U=Math.max(b.lng,A.lng,C.lng,L.lng),H=Math.min(b.lat,A.lat,C.lat,L.lat),ne=Math.max(b.lat,A.lat,C.lat,L.lat);const le=Math.pow(2,-this.zoom)/16*270,fe=this.projection.name==="globe"?1:4,ce=(de,X,ae,ge,be)=>{const Oe=(de+ae)/2,Re=(X+ge)/2,De=new a.Point(Oe,Re),{lng:Ue,lat:Ne}=this.pointLocation3D(De),Ye=Math.max(0,$-Ue,H-Ne,Ue-U,Ne-ne);$=Math.min($,Ue),U=Math.max(U,Ue),H=Math.min(H,Ne),ne=Math.max(ne,Ne),(be<fe||Ye>le)&&(ce(de,X,Oe,Re,be+1),ce(Oe,Re,ae,ge,be+1))};if(ce(h,s,v,s,1),ce(v,s,v,g,1),ce(v,g,h,g,1),ce(h,g,h,s,1),this.projection.name==="globe"){const[de,X]=a.polesInViewport(this);de?(ne=90,U=180,$=-180):X&&(H=-90,U=180,$=-180)}return new a.LngLatBounds(new a.LngLat($,H),new a.LngLat(U,ne))}_getBoundsRectangular(s,h){const{top:g,left:v}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,A=this.width-this._edgeInsets.right,C=new a.Point(v,g),L=new a.Point(A,g),$=new a.Point(A,b),U=new a.Point(v,b);let H=this.pointCoordinate(C,s),ne=this.pointCoordinate(L,s);const le=this.pointCoordinate($,h),fe=this.pointCoordinate(U,h),ce=(de,X)=>(X.y-de.y)/(X.x-de.x);return H.y>1&&ne.y>=0?H=new a.MercatorCoordinate((1-fe.y)/ce(fe,H)+fe.x,1):H.y<0&&ne.y<=1&&(H=new a.MercatorCoordinate(-fe.y/ce(fe,H)+fe.x,0)),ne.y>1&&H.y>=0?ne=new a.MercatorCoordinate((1-le.y)/ce(le,ne)+le.x,1):ne.y<0&&H.y<=1&&(ne=new a.MercatorCoordinate(-le.y/ce(le,ne)+le.x,0)),new a.LngLatBounds().extend(this.coordinateLocation(H)).extend(this.coordinateLocation(ne)).extend(this.coordinateLocation(fe)).extend(this.coordinateLocation(le))}_getBoundsRectangularTerrain(){const s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);const h=s.visibleDemTiles.reduce((g,v)=>{if(v.dem){const b=v.dem.tree;g.min=Math.min(g.min,b.minimums[0]),g.max=Math.max(g.max,b.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*s.exaggeration(),h.max*s.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,g=this.height/2-h*(1-this._horizonShift);return s?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-a.MAX_MERCATOR_LATITUDE,this.maxLat=a.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=a.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=a.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=a.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,h){return this.projection.createTileMatrix(this,h,s)}calculateDistanceTileData(s){const h=s.key,g=this._distanceTileDataCache;if(g[h])return g[h];const v=s.canonical,b=1/this.height,A=this.cameraWorldSize,C=A/this.zoomScale(v.z),L=(v.x+Math.pow(2,v.z)*s.wrap)*C,$=v.y*C,U=this.point;U.x*=A/this.worldSize,U.y*=A/this.worldSize;const H=this.angle,ne=Math.sin(-H),le=-Math.cos(-H);return g[h]={bearing:[ne,le],center:[(U.x-L)*b,(U.y-$)*b],scale:C/a.EXTENT*b},g[h]}calculateFogTileMatrix(s){const h=s.key,g=this._fogTileMatrixCache;if(g[h])return g[h];const v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return a.multiply(v,this.worldToFogMatrix,v),g[h]=new Float32Array(v),g[h]}calculateProjMatrix(s,h=!1){const g=s.key,v=h?this._alignedProjMatrixCache:this._projMatrixCache;if(v[g])return v[g];const b=this.calculatePosMatrix(s,this.worldSize);return a.multiply(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.alignedProjMatrix:this.projMatrix,b),v[g]=new Float32Array(b),v[g]}calculatePixelsToTileUnitsMatrix(s){const h=s.tileID.key,g=this._pixelsToTileUnitsCache;if(g[h])return g[h];const v=function(b,A){const{scale:C}=b.tileTransform,L=C*a.EXTENT/(b.tileSize*Math.pow(2,A.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return $=new Float32Array(4),ne=(U=A.inverseAdjustmentMatrix)[1],le=U[2],fe=U[3],de=(H=[L,L])[1],$[0]=U[0]*(ce=H[0]),$[1]=ne*ce,$[2]=le*de,$[3]=fe*de,$;var $,U,H,ne,le,fe,ce,de}(s,this);return g[h]=v,g[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const s=1/this.worldSize,h=a.fromScaling([],[s,s,s]);return a.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const s=this._elevation;this._updateCameraState();const h=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(h),v=this._camera.forward(),b=a.mercatorZfromAltitude(1,this._center.lat);g[2]/=b,v[2]/=b,a.normalize(v,v);const A=s.raycast(g,v,s.exaggeration());if(A){const C=a.scaleAndAdd([],g,v,A),L=new a.MercatorCoordinate(C[0],C[1],a.mercatorZfromAltitude(C[2],a.latFromMercatorY(C[1]))),$=(L.z+a.length([L.x-g[0],L.y-g[1],L.z-g[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ($),this._centerAltitude=L.toAltitude(),this._center=this.coordinateLocation(L),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;const h=this._elevation,g=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(g),b=h.getAtPointOrZero(new a.MercatorCoordinate(...v)),A=this.pixelsPerMeter/this.worldSize*b,C=this._minimumHeightOverTerrain(),L=v[2]-A;if(L<=C)if(L<0||s){const $=this.locationCoordinate(this._center,this._centerAltitude),U=[v[0],v[1],$.z-v[2]],H=a.length(U);U[2]-=(C-L)/this._pixelsPerMercatorPixel;const ne=a.length(U);if(ne===0)return;a.scale$2(U,U,H/ne*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],$.z*this._pixelsPerMercatorPixel-U[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){const ne=this.center;return ne.lat=a.clamp(ne.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&(ne.lng=a.clamp(ne.lng,this.minLng,this.maxLng)),this.center=ne,void(this._constraining=!1)}const h=this._unmodified,{x:g,y:v}=this.point;let b=0,A=g,C=v;const L=this.width/2,$=this.height/2,U=this.worldMinY*this.scale,H=this.worldMaxY*this.scale;if(v-$<U&&(C=U+$),v+$>H&&(C=H-$),H-U<this.height&&(b=Math.max(b,this.height/(H-U)),C=(H+U)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const ne=this.worldMinX*this.scale,le=this.worldMaxX*this.scale,fe=this.worldSize/2-(ne+le)/2;A=(g+fe+this.worldSize)%this.worldSize-fe,A-L<ne&&(A=ne+L),A+L>le&&(A=le-L),le-ne<this.width&&(b=Math.max(b,this.width/(le-ne)),A=(le+ne)/2)}A===g&&C===v||(this.center=this.unproject(new a.Point(A,C))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,h=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.mercatorZfromAltitude(1,this.center.lat)/a.mercatorZfromAltitude(1,a.GLOBE_SCALE_MATCH_LATITUDE));const g=yh(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this.projection.zAxisUnit==="meters"?h:1,b=this._camera.getWorldToCamera(this.worldSize,v),A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);A[8]=2*-s.x/this.width,A[9]=2*s.y/this.height;let C=a.mul([],A,b);if(this.projection.isReprojectedInTileSpace){const Re=this.locationCoordinate(this.center),De=a.identity([]);a.translate(De,De,[Re.x*this.worldSize,Re.y*this.worldSize,0]),a.multiply(De,De,jl(this)),a.translate(De,De,[-Re.x*this.worldSize,-Re.y*this.worldSize,0]),a.multiply(C,C,De),this.inverseAdjustmentMatrix=function(Ue){const Ne=jl(Ue,!0);return he([],[Ne[0],Ne[1],Ne[4],Ne[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=a.scale([],C,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=C,this.invProjMatrix=a.invert(new Float64Array(16),this.projMatrix);const L=a.invert([],A);this.frustumCorners=a.FrustumCorners.fromInvProjectionMatrix(L,this.horizonLineFromTop(),this.height);const $=new Float32Array(16);a.identity($),a.scale($,$,[1,-1,1]),a.rotateX($,$,this._pitch),a.rotateZ($,$,this.angle);const U=a.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),H=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;U[8]=2*-s.x/this.width,U[9]=2*(s.y+H)/this.height,this.skyboxMatrix=a.multiply($,U,$);const ne=this.point,le=ne.x,fe=ne.y,ce=this.width%2/2,de=this.height%2/2,X=Math.cos(this.angle),ae=Math.sin(this.angle),ge=le-Math.round(le)+X*ce+ae*de,be=fe-Math.round(fe)+X*de+ae*ce,Oe=new Float64Array(C);if(a.translate(Oe,Oe,[ge>.5?ge-1:ge,be>.5?be-1:be,0]),this.alignedProjMatrix=Oe,C=a.create(),a.scale(C,C,[this.width/2,-this.height/2,1]),a.translate(C,C,[1,-1,0]),this.labelPlaneMatrix=C,C=a.create(),a.scale(C,C,[1,-1,1]),a.translate(C,C,[-1,-1,0]),a.scale(C,C,[2/this.width,2/this.height,1]),this.glCoordMatrix=C,this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},C=a.invert(new Float64Array(16),this.pixelMatrix),!C)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=C,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.calculateGlobeMatrix(this);const Re=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.transformMat4(Re,Re,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=C;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const s=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,g=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,b=[s,s,h];a.scale$2(b,b,v),a.scale$2(g,g,-1),a.multiply$2(g,g,b);const A=a.create();a.translate(A,A,g),a.scale(A,A,b),this.mercatorFogMatrix=A,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,h,v)}_computeCameraPosition(s){const h=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),v=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-s/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-g[0]*b,v.y/this.worldSize-g[1]*b,s/this.worldSize*this._centerAltitude-g[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],v=s[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(b=Math.min((h-g)/v,1)),this._camera.position=a.scaleAndAdd([],this._camera.position,s,b),this._updateStateFromCamera()}_updateStateFromCamera(){const s=this._camera.position,h=this._camera.forward(),{pitch:g,bearing:v}=this._camera.getPitchBearing(),b=a.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,A=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.degToRad(this._maxPitch)),C=Math.max((s[2]-b)/Math.cos(g),A),L=this._zoomFromMercatorZ(C);a.scaleAndAdd(s,s,h,C),this._pitch=a.clamp(g,a.degToRad(this.minPitch),a.degToRad(this.maxPitch)),this.angle=a.wrap(v,-Math.PI,Math.PI),this._setZoom(a.clamp(L,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.MercatorCoordinate(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){const s=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(s*this.tileSize))}zoomFromMercatorZAdjusted(s){let h=0,g=a.GLOBE_ZOOM_THRESHOLD_MAX,v=0,b=1/0;for(;g-h>1e-6&&g>h;){const A=h+.5*(g-h),C=this.tileSize*Math.pow(2,A),L=this.getCameraToCenterDistance(this.projection,A,C),$=this.scaleZoom(L/(s*this.tileSize)),U=Math.abs(A-$);U<b&&(b=U,v=A),A<$?h=A:g=A}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,h){const g=Math.min(s.x,h.x),v=Math.max(s.x,h.x),b=Math.min(s.y,h.y),A=Math.max(s.y,h.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const C=[new a.Point(g,b),new a.Point(v,A),new a.Point(g,A),new a.Point(v,b)],L=this.renderWorldCopies?-3:0,$=this.renderWorldCopies?4:1;for(const U of C){const H=this.pointRayIntersection(U);if(H.t<0)return!0;const ne=this.rayIntersectionCoordinate(H);if(ne.x<L||ne.y<0||ne.x>$||ne.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.Point(0,0),new a.Point(this.width,this.height))}zoomDeltaToMovement(s,h){const g=a.length(a.sub([],this._camera.position,s)),v=this._zoomFromMercatorZ(g)+h;return g-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){const s=function([h,g,v],b){const A=[h,g,v,1];a.transformMat4$1(A,A,b);const C=A[3]=Math.max(A[3],1e-6);return A[0]/=C,A[1]/=C,A[2]/=C,A}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.Point(s[0],s[1])}{const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.Point(0,s))}}getCameraToCenterDistance(s,h=this.zoom,g=this.worldSize){const v=yh(s,h,this.width,this.height,1024),b=s.pixelSpaceConversion(this.center.lat,g,v);return .5/Math.tan(.5*this._fov)*this.height*b}getWorldToCameraMatrix(){const s=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&a.multiply(s,s,this.globeMatrix),s}}function Gl(p,s){let h=!1,g=null;const v=()=>{g=null,h&&(p(),g=setTimeout(v,s),h=!1)};return()=>(h=!0,g||v(),g)}class Cd{constructor(s){this._hashName=s&&encodeURIComponent(s),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Gl(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,a.window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),a.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const s=this._map;if(!s)return"";const h=ic(s);if(this._hashName){const g=this._hashName;let v=!1;const b=a.window.location.hash.slice(1).split("&").map(A=>{const C=A.split("=")[0];return C===g?(v=!0,`${C}=${h}`):A}).filter(A=>A);return v||b.push(`${g}=${h}`),`#${b.join("&")}`}return`#${h}`}_getCurrentHash(){const s=a.window.location.hash.replace("#","");if(this._hashName){let h;return s.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(h=g)}),(h&&h[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._map;if(!s)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(g=>isNaN(g))){const g=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(h[3]||0):s.getBearing();return s.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:g,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){const s=a.window.location.href.replace(/(#.+)?$/,this.getHashString());a.window.history.replaceState(a.window.history.state,null,s)}}function ic(p,s){const h=p.getCenter(),g=Math.round(100*p.getZoom())/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,v),A=Math.round(h.lng*b)/b,C=Math.round(h.lat*b)/b,L=p.getBearing(),$=p.getPitch();let U=s?`/${A}/${C}/${g}`:`${g}/${C}/${A}`;return(L||$)&&(U+="/"+Math.round(10*L)/10),$&&(U+=`/${Math.round($)}`),U}const oc={linearity:.3,easing:a.bezier(0,0,.3,1)},vh=a.extend({deceleration:2500,maxSpeed:1400},oc),xh=a.extend({deceleration:20,maxSpeed:1400},oc),Nt=a.extend({deceleration:1e3,maxSpeed:360},oc),ss=a.extend({deceleration:1e3,maxSpeed:90},oc);class hg{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,h=a.exported.now();for(;s.length>0&&h-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const h={zoom:0,bearing:0,pitch:0,pan:new a.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)h.zoom+=b.zoomDelta||0,h.bearing+=b.bearingDelta||0,h.pitch+=b.pitchDelta||0,b.panDelta&&h.pan._add(b.panDelta),b.around&&(h.around=b.around),b.pinchAround&&(h.pinchAround=b.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(h.pan.mag()){const b=ac(h.pan.mag(),g,a.extend({},vh,s||{}));v.offset=h.pan.mult(b.amount/h.pan.mag()),v.center=this._map.transform.center,sc(v,b)}if(h.zoom){const b=ac(h.zoom,g,xh);v.zoom=this._map.transform.zoom+b.amount,sc(v,b)}if(h.bearing){const b=ac(h.bearing,g,Nt);v.bearing=this._map.transform.bearing+a.clamp(b.amount,-179,179),sc(v,b)}if(h.pitch){const b=ac(h.pitch,g,ss);v.pitch=this._map.transform.pitch+b.amount,sc(v,b)}if(v.zoom||v.bearing){const b=h.pinchAround===void 0?h.around:h.pinchAround;v.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function sc(p,s){(!p.duration||p.duration<s.duration)&&(p.duration=s.duration,p.easing=s.easing)}function ac(p,s,h){const{maxSpeed:g,linearity:v,deceleration:b}=h,A=a.clamp(p*v/(s/1e3),-g,g),C=Math.abs(A)/(b*v);return{easing:h.easing,duration:1e3*C,amount:A*(C/2)}}class pi extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g,v={}){const b=se(h.getCanvasContainer(),g),A=h.unproject(b);super(s,a.extend({point:b,lngLat:A,originalEvent:g},v)),this._defaultPrevented=!1,this.target=h}}class lc extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g){const v=s==="touchend"?g.changedTouches:g.touches,b=ue(h.getCanvasContainer(),v),A=b.map(L=>h.unproject(L)),C=b.reduce((L,$,U,H)=>L.add($.div(H.length)),new a.Point(0,0));super(s,{points:b,point:C,lngLats:A,lngLat:h.unproject(C),originalEvent:g}),this._defaultPrevented=!1}}class bh extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g){super(s,{originalEvent:g}),this._defaultPrevented=!1}}class Id{constructor(s,h){this._map=s,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new bh(s.type,this._map,s))}mousedown(s,h){return this._mousedownPos=h,this._firePreventable(new pi(s.type,this._map,s))}mouseup(s){this._map.fire(new pi(s.type,this._map,s))}preclick(s){const h=a.extend({},s);h.type="preclick",this._map.fire(new pi(h.type,this._map,h))}click(s,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(s),this._map.fire(new pi(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new pi(s.type,this._map,s))}mouseover(s){this._map.fire(new pi(s.type,this._map,s))}mouseout(s){this._map.fire(new pi(s.type,this._map,s))}touchstart(s){return this._firePreventable(new lc(s.type,this._map,s))}touchmove(s){this._map.fire(new lc(s.type,this._map,s))}touchend(s){this._map.fire(new lc(s.type,this._map,s))}touchcancel(s){this._map.fire(new lc(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wh{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new pi(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new pi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new pi(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fg{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,h){this.isEnabled()&&s.shiftKey&&s.button===0&&(k(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(s,h){if(!this._active)return;const g=h,v=this._startPos,b=this._lastPos;if(!v||!b||b.equals(g)||!this._box&&g.dist(v)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=M("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const A=Math.min(v.x,g.x),C=Math.max(v.x,g.x),L=Math.min(v.y,g.y),$=Math.max(v.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${A}px,${L}px)`,this._box.style.width=C-A+"px",this._box.style.height=$-L+"px")})}mouseupWindow(s,h){if(!this._active)return;const g=this._startPos,v=h;if(g&&s.button===0){if(this.reset(),ee(),g.x!==v.x||g.y!==v.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:s})),{cameraAnimation:b=>b.fitScreenCoordinates(g,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),z(),delete this._startPos,delete this._lastPos}_fireEvent(s,h){return this._map.fire(new a.Event(s,{originalEvent:h}))}}function Eh(p,s){const h={};for(let g=0;g<p.length;g++)h[p[g].identifier]=s[g];return h}class ql{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,h,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=s.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){const b=new a.Point(0,0);for(const A of v)b._add(A);return b.div(v.length)}(h),this.touches=Eh(g,h)))}touchmove(s,h,g){if(this.aborted||!this.centroid)return;const v=Eh(g,h);for(const b in this.touches){const A=v[b];(!A||A.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(s,h,g){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Md{constructor(s){this.singleTap=new ql(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,h,g){this.singleTap.touchstart(s,h,g)}touchmove(s,h,g){this.singleTap.touchmove(s,h,g)}touchend(s,h,g){const v=this.singleTap.touchend(s,h,g);if(v){const b=s.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(v)<30;if(b&&A||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class _0{constructor(){this._zoomIn=new Md({numTouches:1,numTaps:2}),this._zoomOut=new Md({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,h,g){this._zoomIn.touchstart(s,h,g),this._zoomOut.touchstart(s,h,g)}touchmove(s,h,g){this._zoomIn.touchmove(s,h,g),this._zoomOut.touchmove(s,h,g)}touchend(s,h,g){const v=this._zoomIn.touchend(s,h,g),b=this._zoomOut.touchend(s,h,g);return v?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()+1,around:A.unproject(v)},{originalEvent:s})}):b?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()-1,around:A.unproject(b)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const dg={0:1,2:2};class Wl{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,h){return!1}_move(s,h){return{}}mousedown(s,h){if(this._lastPoint)return;const g=Te(s);this._correctButton(s,g)&&(this._lastPoint=h,this._eventButton=g)}mousemoveWindow(s,h){const g=this._lastPoint;if(g){if(s.preventDefault(),this._eventButton!=null&&function(v,b){const A=dg[b];return v.buttons===void 0||(v.buttons&A)!==A}(s,this._eventButton))this.reset();else if(this._moved||!(h.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(g,h)}}mouseupWindow(s){this._lastPoint&&Te(s)===this._eventButton&&(this._moved&&ee(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pd extends Wl{mousedown(s,h){super.mousedown(s,h),this._lastPoint&&(this._active=!0)}_correctButton(s,h){return h===0&&!s.ctrlKey}_move(s,h){return{around:h,panDelta:h.sub(s)}}}class kd extends Wl{_correctButton(s,h){return h===0&&s.ctrlKey||h===2}_move(s,h){const g=.8*(h.x-s.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(s){s.preventDefault()}}class Ld extends Wl{_correctButton(s,h){return h===0&&s.ctrlKey||h===2}_move(s,h){const g=-.5*(h.y-s.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(s){s.preventDefault()}}class Th{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),a.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.Point(0,0)}touchstart(s,h,g){return this._calculateTransform(s,h,g)}touchmove(s,h,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!a.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,h,g)}}touchend(s,h,g){this._calculateTransform(s,h,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,h,g){g.length>0&&(this._active=!0);const v=Eh(g,h),b=new a.Point(0,0),A=new a.Point(0,0);let C=0;for(const $ in v){const U=v[$],H=this._touches[$];H&&(b._add(U),A._add(U.sub(H)),C++,v[$]=U)}if(this._touches=v,C<this._minTouches||!A.mag())return;const L=A.div(C);return this._sum._add(L),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(C),panDelta:L}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=M("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class uc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,h,g){return{}}touchstart(s,h,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([h[0],h[1]]))}touchmove(s,h,g){const v=this._firstTwoTouches;if(!v)return;s.preventDefault();const[b,A]=v,C=cc(g,h,b),L=cc(g,h,A);if(!C||!L)return;const $=this._aroundCenter?null:C.add(L).div(2);return this._move([C,L],$,s)}touchend(s,h,g){if(!this._firstTwoTouches)return;const[v,b]=this._firstTwoTouches,A=cc(g,h,v),C=cc(g,h,b);A&&C||(this._active&&ee(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function cc(p,s,h){for(let g=0;g<p.length;g++)if(p[g].identifier===h)return s[g]}function Od(p,s){return Math.log(p/s)/Math.LN2}class pg extends uc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,h){const g=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Od(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Od(this._distance,g),pinchAround:h}}}function Dd(p,s){return 180*p.angleWith(s)/Math.PI}class mg extends uc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,h){const g=this._vector;if(this._vector=s[0].sub(s[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Dd(this._vector,g),pinchAround:h}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const h=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;const v=Dd(s,g);return Math.abs(v)<h}}function xa(p){return Math.abs(p.y)>Math.abs(p.x)}class gg extends uc{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,xa(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,h,g){const v=this._lastPoints;if(!v)return;const b=s[0].sub(v[0]),A=s[1].sub(v[1]);return this._map._cooperativeGestures&&!a.isFullscreen()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(b,A,g.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(b.y+A.y)/2*-.5})}gestureBeginsVertically(s,h,g){if(this._valid!==void 0)return this._valid;const v=s.mag()>=2,b=h.mag()>=2;if(!v&&!b)return;if(!v||!b)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;const A=s.y>0==h.y>0;return xa(s)&&xa(h)&&A}}const yg={panStep:100,bearingStep:15,pitchStep:10};class v0{constructor(){const s=yg;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let h=0,g=0,v=0,b=0,A=0;switch(s.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:s.shiftKey?g=-1:(s.preventDefault(),b=-1);break;case 39:s.shiftKey?g=1:(s.preventDefault(),b=1);break;case 38:s.shiftKey?v=1:(s.preventDefault(),A=-1);break;case 40:s.shiftKey?v=-1:(s.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:C=>{const L=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:_g,zoom:h?Math.round(L)+h*(s.shiftKey?2:1):L,bearing:C.getBearing()+g*this._bearingStep,pitch:C.getPitch()+v*this._pitchStep,offset:[-b*this._panStep,-A*this._panStep],center:C.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function _g(p){return p*(2-p)}const Rd=4.000244140625;class vg{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||a.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=s.deltaMode===a.window.WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const g=a.exported.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,h!==0&&h%Rd==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(v*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),s.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=s,this._delta-=h,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=se(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;this._type==="wheel"&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>Rd?this._wheelZoomRate:this._defaultZoomRate;let $=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&$!==0&&($=1/$);const U=h(),H=Math.pow(2,U),ne=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):H;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(ne*$))),this._type==="wheel"&&(this._startZoom=U,this._easing=this._smoothOutEasing(200)),this._delta=0}const g=typeof this._targetZoom=="number"?this._targetZoom:h(),v=this._startZoom,b=this._easing;let A,C=!1;if(this._type==="wheel"&&v&&b){const L=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),$=b(L);A=a.number(v,g,$),L<1?this._frameId||(this._frameId=!0):C=!0}else A=g,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!C,zoomDelta:A-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let h=a.ease;if(this._prevEase){const g=this._prevEase,v=(a.exported.now()-g.start)/g.duration,b=g.easing(v+.01)-g.easing(v),A=.27/Math.sqrt(b*b+1e-4)*.01,C=Math.sqrt(.0729-A*A);h=a.bezier(A,C,.25,1)}return this._prevEase={start:a.exported.now(),duration:s,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=M("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(a.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class xg{constructor(s,h){this._clickZoom=s,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ri{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,h){return s.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(s.shiftKey?-1:1),around:g.unproject(h)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class x0{constructor(){this._tap=new Md({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,h,g){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=h[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(s,h,g))}touchmove(s,h,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const v=h[0],b=v.y-this._swipePoint.y;return this._swipePoint=v,s.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(s,h,g)}touchend(s,h,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(s,h,g)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bg{constructor(s,h,g){this._el=s,this._mousePan=h,this._touchPan=g}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class b0{constructor(s,h,g){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=h,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class w0{constructor(s,h,g,v){this._el=s,this._touchZoom=h,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const $o=p=>p.zoom||p.drag||p.pitch||p.rotate;class wg extends a.Event{}class E0{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,h){const g=a.sub([],h,s);this.radius=a.length(g[2]<0?a.div([],g,this.constants):[g[0],g[1],0])}projectRay(s){a.div(s,s,this.constants),a.normalize(s,s),a.mul$1(s,s,this.constants);const h=a.scale$2([],s,this.radius);if(h[2]>0){const g=a.scale$2([],[0,0,1],a.dot(h,[0,0,1])),v=a.scale$2([],a.normalize([],[h[0],h[1],0]),this.radius),b=a.add([],h,a.scale$2([],a.sub([],a.add([],v,g),h),2));h[0]=b[0],h[1]=b[1]}return h}}function as(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class bs{constructor(s,h){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new hg(s),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new E0,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),a.bindAll(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[a.window.document,"mousemove",{capture:!0}],[a.window.document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[a.window,"blur",void 0]];for(const[v,b,A]of this._listeners)v.addEventListener(b,v===a.window.document?this.handleWindowEvent:this.handleEvent,A)}destroy(){for(const[s,h,g]of this._listeners)s.removeEventListener(h,s===a.window.document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(s){const h=this._map,g=h.getCanvasContainer();this._add("mapEvent",new Id(h,s));const v=h.boxZoom=new fg(h,s);this._add("boxZoom",v);const b=new _0,A=new Ri;h.doubleClickZoom=new xg(A,b),this._add("tapZoom",b),this._add("clickZoom",A);const C=new x0;this._add("tapDragZoom",C);const L=h.touchPitch=new gg(h);this._add("touchPitch",L);const $=new kd(s),U=new Ld(s);h.dragRotate=new b0(s,$,U),this._add("mouseRotate",$,["mousePitch"]),this._add("mousePitch",U,["mouseRotate"]);const H=new Pd(s),ne=new Th(h,s);h.dragPan=new bg(g,H,ne),this._add("mousePan",H),this._add("touchPan",ne,["touchZoom","touchRotate"]);const le=new mg,fe=new pg;h.touchZoomRotate=new w0(g,fe,le,C),this._add("touchRotate",le,["touchPan","touchZoom"]),this._add("touchZoom",fe,["touchPan","touchRotate"]),this._add("blockableMapEvent",new wh(h));const ce=h.scrollZoom=new vg(h,this);this._add("scrollZoom",ce,["mousePan"]);const de=h.keyboard=new v0;this._add("keyboard",de);for(const X of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[X]&&h[X].enable(s[X])}_add(s,h,g){this._handlers.push({handlerName:s,handler:h,allowed:g}),this._handlersById[s]=h}stop(s){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!$o(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,h,g){for(const v in s)if(v!==g&&(!h||h.indexOf(v)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const h=[];for(const g of s)this._el.contains(g.target)&&h.push(g);return h}handleEvent(s,h){this._updatingCamera=!0;const g=s.type==="renderFrame",v=g?void 0:s,b={needsRenderFrame:!1},A={},C={},L=s.touches?this._getMapTouches(s.touches):void 0,$=L?ue(this._el,L):g?void 0:se(this._el,s);for(const{handlerName:ne,handler:le,allowed:fe}of this._handlers){if(!le.isEnabled())continue;let ce;this._blockedByActive(C,fe,ne)?le.reset():le[h||s.type]&&(ce=le[h||s.type](s,$,L),this.mergeHandlerResult(b,A,ce,ne,v),ce&&ce.needsRenderFrame&&this._triggerRenderFrame()),(ce||le.isActive())&&(C[ne]=le)}const U={};for(const ne in this._previousActiveHandlers)C[ne]||(U[ne]=v);this._previousActiveHandlers=C,(Object.keys(U).length||as(b))&&(this._changes.push([b,A,U]),this._triggerRenderFrame()),(Object.keys(C).length||as(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=b;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))}mergeHandlerResult(s,h,g,v,b){if(!g)return;a.extend(s,g);const A={handlerName:v,originalEvent:g.originalEvent||b};g.zoomDelta!==void 0&&(h.zoom=A),g.panDelta!==void 0&&(h.drag=A),g.pitchDelta!==void 0&&(h.pitch=A),g.bearingDelta!==void 0&&(h.rotate=A)}_applyChanges(){const s={},h={},g={};for(const[v,b,A]of this._changes)v.panDelta&&(s.panDelta=(s.panDelta||new a.Point(0,0))._add(v.panDelta)),v.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(s.around=v.around),v.aroundCoord!==void 0&&(s.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(s.pinchAround=v.pinchAround),v.noInertia&&(s.noInertia=v.noInertia),a.extend(h,b),a.extend(g,A);this._updateMapTransform(s,h,g),this._changes=[]}_updateMapTransform(s,h,g){const v=this._map,b=v.transform,A=ae=>[ae.x,ae.y,ae.z];if((ae=>{const ge=this._eventsInProgress.drag;return ge&&!this._handlersById[ge.handlerName].isActive()})()&&!as(s)){const ae=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",ae!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&v._stop(!0),!as(s))return void this._fireEvents(h,g,!0);let{panDelta:C,zoomDelta:L,bearingDelta:$,pitchDelta:U,around:H,aroundCoord:ne,pinchAround:le}=s;b._isCameraConstrained&&(L>0&&(L=0),b._isCameraConstrained=!1),le!==void 0&&(H=le),(L||(ae=>h[ae]&&!this._eventsInProgress[ae])("drag"))&&H&&(this._dragOrigin=A(b.pointCoordinate3D(H)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",v._stop(!0),H=H||v.transform.centerPoint,$&&(b.bearing+=$),U&&(b.pitch+=U),b._updateCameraState();const fe=[0,0,0];if(C)if(b.projection.name==="mercator"){const ae=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(H).dir),ge=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(H.sub(C)).dir);fe[0]=ge[0]-ae[0],fe[1]=ge[1]-ae[1]}else{const ae=b.pointCoordinate(H);if(b.projection.name==="globe"){C=C.rotate(-b.angle);const ge=b._pixelsPerMercatorPixel/b.worldSize;fe[0]=-C.x*a.mercatorScale(a.latFromMercatorY(ae.y))*ge,fe[1]=-C.y*a.mercatorScale(b.center.lat)*ge}else{const ge=b.pointCoordinate(H.sub(C));ae&&ge&&(fe[0]=ge.x-ae.x,fe[1]=ge.y-ae.y)}}const ce=b.zoom,de=[0,0,0];if(L){const ae=A(ne||b.pointCoordinate3D(H)),ge={dir:a.normalize([],a.sub([],ae,b._camera.position))};if(ge.dir[2]<0){const be=b.zoomDeltaToMovement(ae,L);a.scale$2(de,ge.dir,be)}}const X=a.add(fe,fe,de);b._translateCameraConstrained(X),L&&Math.abs(b.zoom-ce)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(h,g,!0)}_fireEvents(s,h,g){const v=$o(this._eventsInProgress),b=$o(s),A={};for(const U in s){const{originalEvent:H}=s[U];this._eventsInProgress[U]||(A[`${U}start`]=H),this._eventsInProgress[U]=s[U]}!v&&b&&this._fireEvent("movestart",b.originalEvent);for(const U in A)this._fireEvent(U,A[U]);b&&this._fireEvent("move",b.originalEvent);for(const U in s){const{originalEvent:H}=s[U];this._fireEvent(U,H)}const C={};let L;for(const U in this._eventsInProgress){const{handlerName:H,originalEvent:ne}=this._eventsInProgress[U];this._handlersById[H].isActive()||(delete this._eventsInProgress[U],L=h[H]||ne,C[`${U}end`]=L)}for(const U in C)this._fireEvent(U,C[U]);const $=$o(this._eventsInProgress);if(g&&(v||b)&&!$){this._updatingCamera=!0;const U=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=ne=>ne!==0&&-this._bearingSnap<ne&&ne<this._bearingSnap;U?(H(U.bearing||this._map.getBearing())&&(U.bearing=0),this._map.easeTo(U,{originalEvent:L})):(this._map.fire(new a.Event("moveend",{originalEvent:L})),H(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,h){this._map.fire(new a.Event(s,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{this._frameId=void 0,this.handleEvent(new wg("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const ol="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Sh extends a.Evented{constructor(s,h){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=h.respectPrefersReducedMotion!==!1,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(s,h){return this.jumpTo({center:s},h)}panBy(s,h,g){return s=a.Point.convert(s).mult(-1),this.panTo(this.transform.center,a.extend({offset:s},h),g)}panTo(s,h,g){return this.easeTo(a.extend({center:s},h),g)}getZoom(){return this.transform.zoom}setZoom(s,h){return this.jumpTo({zoom:s},h),this}zoomTo(s,h,g){return this.easeTo(a.extend({zoom:s},h),g)}zoomIn(s,h){return this.zoomTo(this.getZoom()+1,s,h),this}zoomOut(s,h){return this.zoomTo(this.getZoom()-1,s,h),this}getBearing(){return this.transform.bearing}setBearing(s,h){return this.jumpTo({bearing:s},h),this}getPadding(){return this.transform.padding}setPadding(s,h){return this.jumpTo({padding:s},h),this}rotateTo(s,h,g){return this.easeTo(a.extend({bearing:s},h),g)}resetNorth(s,h){return this.rotateTo(0,a.extend({duration:1e3},s),h),this}resetNorthPitch(s,h){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},s),h),this}snapToNorth(s,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,h):this}getPitch(){return this.transform.pitch}setPitch(s,h){return this.jumpTo({pitch:s},h),this}cameraForBounds(s,h){s=a.LngLatBounds.convert(s);const g=h&&h.bearing||0,v=h&&h.pitch||0,b=s.getNorthWest(),A=s.getSouthEast();return this._cameraForBounds(this.transform,b,A,g,v,h)}_extendCameraOptions(s){const h={top:0,bottom:0,right:0,left:0};if(typeof(s=a.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=="number"){const g=s.padding;s.padding={top:g,bottom:g,right:g,left:g}}return s.padding=a.extend(h,s.padding),s}_minimumAABBFrustumDistance(s,h){const g=h.max[0]-h.min[0],v=h.max[1]-h.min[1];return g/v>s.aspect?g/(2*Math.tan(.5*s.fovX)*s.aspect):v/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,h,g,v,b,A){const C=s.clone(),L=this._extendCameraOptions(A);C.bearing=v,C.pitch=b;const $=a.LngLat.convert(h),U=a.LngLat.convert(g),H=.5*($.lat+U.lat),ne=.5*($.lng+U.lng),le=a.latLngToECEF(H,ne),fe=a.normalize([],le),ce=a.normalize([],a.cross([],fe,[0,1,0])),de=a.cross([],ce,fe),X=[ce[0],ce[1],ce[2],0,de[0],de[1],de[2],0,fe[0],fe[1],fe[2],0,0,0,0,1],ae=[le,a.latLngToECEF($.lat,$.lng),a.latLngToECEF(U.lat,$.lng),a.latLngToECEF(U.lat,U.lng),a.latLngToECEF($.lat,U.lng),a.latLngToECEF(H,$.lng),a.latLngToECEF(H,U.lng),a.latLngToECEF($.lat,ne),a.latLngToECEF(U.lat,ne)];let ge=a.Aabb.fromPoints(ae.map(pt=>[a.dot(ce,pt),a.dot(de,pt),a.dot(fe,pt)]));const be=a.transformMat4([],ge.center,X);a.squaredLength(be)===0&&a.set(be,0,0,1),a.normalize(be,be),a.scale$2(be,be,a.GLOBE_RADIUS),C.center=a.ecefToLatLng(be);const Oe=C.getWorldToCameraMatrix(),Re=a.invert(new Float64Array(16),Oe);ge=a.Aabb.applyTransform(ge,a.multiply([],Oe,X)),a.transformMat4(be,be,Oe);const De=.5*(ge.max[2]-ge.min[2]),Ue=this._minimumAABBFrustumDistance(C,ge),Ne=a.scale$2([],[0,0,1],De),Ye=a.add(Ne,be,Ne),vt=Ue+(C.pitch===0?0:a.distance(be,Ye)),We=C.globeCenterInViewSpace,ht=a.sub([],be,[We[0],We[1],We[2]]);a.normalize(ht,ht),a.scale$2(ht,ht,vt);const rt=a.add([],be,ht);a.transformMat4(rt,rt,Re);const _t=a.earthRadius/a.GLOBE_RADIUS,Xe=a.length(rt),ut=a.mercatorZfromAltitude(Math.max(Xe*_t-a.earthRadius,Number.EPSILON),0),bt=Math.min(C.zoomFromMercatorZAdjusted(ut),L.maxZoom);return bt>.5*(a.GLOBE_ZOOM_THRESHOLD_MIN+a.GLOBE_ZOOM_THRESHOLD_MAX)?(C.setProjection({name:"mercator"}),C.zoom=bt,this._cameraForBounds(C,h,g,v,b,A)):{center:C.center,zoom:bt,bearing:v,pitch:b}}queryTerrainElevation(s,h){const g=this.transform.elevation;return g?(h=a.extend({},{exaggerated:!0},h),g.getAtPoint(a.MercatorCoordinate.fromLngLat(s),null,h.exaggerated)):null}_cameraForBounds(s,h,g,v,b,A){if(s.projection.name==="globe")return this._cameraForBoundsOnGlobe(s,h,g,v,b,A);const C=s.clone(),L=this._extendCameraOptions(A),$=C.padding;C.bearing=v,C.pitch=b;const U=a.LngLat.convert(h),H=a.LngLat.convert(g),ne=new a.LngLat(U.lng,H.lat),le=new a.LngLat(H.lng,U.lat),fe=C.project(U),ce=C.project(H),de=this.queryTerrainElevation(U),X=this.queryTerrainElevation(H),ae=this.queryTerrainElevation(ne),ge=this.queryTerrainElevation(le),be=[[fe.x,fe.y,Math.min(de||0,X||0,ae||0,ge||0)],[ce.x,ce.y,Math.max(de||0,X||0,ae||0,ge||0)]];let Oe=a.Aabb.fromPoints(be);const Re=C.getWorldToCameraMatrix(),De=a.invert(new Float64Array(16),Re);Oe=a.Aabb.applyTransform(Oe,Re);const Ue=a.sub([],Oe.max,Oe.min),Ne=$.left||0,Ye=$.right||0,vt=$.bottom||0,We=$.top||0,{left:ht,right:rt,top:_t,bottom:Xe}=L.padding,ut=.5*(Ne+Ye),bt=.5*(We+vt),pt=Math.min(C.scaleZoom(C.scale*Math.min((C.width-(Ne+Ye+ht+rt))/Ue[0],(C.height-(vt+We+Xe+_t))/Ue[1])),L.maxZoom),Tt=C.scale/C.zoomScale(pt);Oe=new a.Aabb([Oe.min[0]-(ht+ut)*Tt,Oe.min[1]-(Xe+bt)*Tt,Oe.min[2]],[Oe.max[0]+(rt+ut)*Tt,Oe.max[1]+(_t+bt)*Tt,Oe.max[2]]);const Wt=.5*Ue[2],or=this._minimumAABBFrustumDistance(C,Oe),jt=[0,0,1,0];a.transformMat4$1(jt,jt,Re),a.normalize$2(jt,jt);const Yt=a.scale$2([],jt,or+Wt),vr=a.add([],Oe.center,Yt),yr=(typeof L.offset.x=="number"&&typeof L.offset.y=="number"?new a.Point(L.offset.x,L.offset.y):a.Point.convert(L.offset)).rotate(-a.degToRad(v));Oe.center[0]-=yr.x*Tt,Oe.center[1]+=yr.y*Tt,a.transformMat4(Oe.center,Oe.center,De),a.transformMat4(vr,vr,De);const qt=[Oe.center[0],Oe.center[1],vr[2]*C.pixelsPerMeter];a.scale$2(qt,qt,1/C.worldSize);const $r=a.lngFromMercatorX(qt[0]),Gr=a.latFromMercatorY(qt[1]),qr=Math.min(C._zoomFromMercatorZ(qt[2]),L.maxZoom),Wr=new a.LngLat($r,Gr);return C.mercatorFromTransition&&qr<.5*(a.GLOBE_ZOOM_THRESHOLD_MIN+a.GLOBE_ZOOM_THRESHOLD_MAX)?(C.setProjection({name:"globe"}),C.zoom=qr,this._cameraForBounds(C,h,g,v,b,A)):{center:Wr,zoom:qr,bearing:v,pitch:b}}fitBounds(s,h,g){const v=this.cameraForBounds(s,h);return this._fitInternal(v,h,g)}fitScreenCoordinates(s,h,g,v,b){const A=a.Point.convert(s),C=a.Point.convert(h),L=new a.Point(Math.min(A.x,C.x),Math.min(A.y,C.y)),$=new a.Point(Math.max(A.x,C.x),Math.max(A.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(A,C))return this;const U=this.transform.pointLocation3D(L),H=this.transform.pointLocation3D($),ne=this.transform.pointLocation3D(new a.Point(L.x,$.y)),le=this.transform.pointLocation3D(new a.Point($.x,L.y)),fe=[Math.min(U.lng,H.lng,ne.lng,le.lng),Math.min(U.lat,H.lat,ne.lat,le.lat)],ce=[Math.max(U.lng,H.lng,ne.lng,le.lng),Math.max(U.lat,H.lat,ne.lat,le.lat)],de=v&&v.pitch?v.pitch:this.getPitch(),X=this._cameraForBounds(this.transform,fe,ce,g,de,v);return this._fitInternal(X,v,b)}_fitInternal(s,h,g){return s?(delete(h=a.extend(s,h)).padding,h.linear?this.easeTo(h,g):this.flyTo(h,g)):this}jumpTo(s,h){this.stop();const g=s.preloadOnly?this.transform.clone():this.transform;let v=!1,b=!1,A=!1;return"zoom"in s&&g.zoom!==+s.zoom&&(v=!0,g.zoom=+s.zoom),s.center!==void 0&&(g.center=a.LngLat.convert(s.center)),"bearing"in s&&g.bearing!==+s.bearing&&(b=!0,g.bearing=+s.bearing),"pitch"in s&&g.pitch!==+s.pitch&&(A=!0,g.pitch=+s.pitch),s.padding==null||g.isPaddingEqual(s.padding)||(g.padding=s.padding),s.preloadOnly?(this._preloadTiles(g),this):(this.fire(new a.Event("movestart",h)).fire(new a.Event("move",h)),v&&this.fire(new a.Event("zoomstart",h)).fire(new a.Event("zoom",h)).fire(new a.Event("zoomend",h)),b&&this.fire(new a.Event("rotatestart",h)).fire(new a.Event("rotate",h)).fire(new a.Event("rotateend",h)),A&&this.fire(new a.Event("pitchstart",h)).fire(new a.Event("pitch",h)).fire(new a.Event("pitchend",h)),this.fire(new a.Event("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.warnOnce(ol),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,h){const g=this.transform;if(!g.projection.supportsFreeCamera)return a.warnOnce(ol),this;this.stop();const v=g.zoom,b=g.pitch,A=g.bearing;g.setFreeCameraOptions(s);const C=v!==g.zoom,L=b!==g.pitch,$=A!==g.bearing;return this.fire(new a.Event("movestart",h)).fire(new a.Event("move",h)),C&&this.fire(new a.Event("zoomstart",h)).fire(new a.Event("zoom",h)).fire(new a.Event("zoomend",h)),$&&this.fire(new a.Event("rotatestart",h)).fire(new a.Event("rotate",h)).fire(new a.Event("rotateend",h)),L&&this.fire(new a.Event("pitchstart",h)).fire(new a.Event("pitch",h)).fire(new a.Event("pitchend",h)),this.fire(new a.Event("moveend",h)),this}easeTo(s,h){this._stop(!1,s.easeId),((s=a.extend({offset:[0,0],duration:500,easing:a.ease},s)).animate===!1||this._prefersReducedMotion(s))&&(s.duration=0);const g=this.transform,v=this.getZoom(),b=this.getBearing(),A=this.getPitch(),C=this.getPadding(),L="zoom"in s?+s.zoom:v,$="bearing"in s?this._normalizeBearing(s.bearing,b):b,U="pitch"in s?+s.pitch:A,H="padding"in s?s.padding:g.padding,ne=a.Point.convert(s.offset);let le,fe,ce;if(g.projection.name==="globe"){const Ne=a.MercatorCoordinate.fromLngLat(g.center),Ye=ne.rotate(-g.angle);Ne.x+=Ye.x/g.worldSize,Ne.y+=Ye.y/g.worldSize;const vt=Ne.toLngLat(),We=a.LngLat.convert(s.center||vt);this._normalizeCenter(We),le=g.centerPoint.add(Ye),fe=new a.Point(Ne.x,Ne.y).mult(g.worldSize),ce=new a.Point(a.mercatorXfromLng(We.lng),a.mercatorYfromLat(We.lat)).mult(g.worldSize).sub(fe)}else{le=g.centerPoint.add(ne);const Ne=g.pointLocation(le),Ye=a.LngLat.convert(s.center||Ne);this._normalizeCenter(Ye),fe=g.project(Ne),ce=g.project(Ye).sub(fe)}const de=g.zoomScale(L-v);let X,ae;s.around&&(X=a.LngLat.convert(s.around),ae=g.locationPoint(X));const ge=this._zooming||L!==v,be=this._rotating||b!==$,Oe=this._pitching||U!==A,Re=!g.isPaddingEqual(H),De=Ne=>Ye=>{if(ge&&(Ne.zoom=a.number(v,L,Ye)),be&&(Ne.bearing=a.number(b,$,Ye)),Oe&&(Ne.pitch=a.number(A,U,Ye)),Re&&(Ne.interpolatePadding(C,H,Ye),le=Ne.centerPoint.add(ne)),X)Ne.setLocationAtPoint(X,ae);else{const vt=Ne.zoomScale(Ne.zoom-v),We=L>v?Math.min(2,de):Math.max(.5,de),ht=Math.pow(We,1-Ye),rt=Ne.unproject(fe.add(ce.mult(Ye*ht)).mult(vt));Ne.setLocationAtPoint(Ne.renderWorldCopies?rt.wrap():rt,le)}return s.preloadOnly||this._fireMoveEvents(h),Ne};if(s.preloadOnly){const Ne=this._emulate(De,s.duration,g);return this._preloadTiles(Ne),this}const Ue={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ge,this._rotating=be,this._pitching=Oe,this._padding=Re,this._easeId=s.easeId,this._prepareEase(h,s.noMoveStart,Ue),this._ease(De(g),Ne=>{g.recenterOnTerrain(),this._afterEase(h,Ne)},s),this}_prepareEase(s,h,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||g.moving||this.fire(new a.Event("movestart",s)),this._zooming&&!g.zooming&&this.fire(new a.Event("zoomstart",s)),this._rotating&&!g.rotating&&this.fire(new a.Event("rotatestart",s)),this._pitching&&!g.pitching&&this.fire(new a.Event("pitchstart",s))}_fireMoveEvents(s){this.fire(new a.Event("move",s)),this._zooming&&this.fire(new a.Event("zoom",s)),this._rotating&&this.fire(new a.Event("rotate",s)),this._pitching&&this.fire(new a.Event("pitch",s))}_afterEase(s,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,v=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new a.Event("zoomend",s)),v&&this.fire(new a.Event("rotateend",s)),b&&this.fire(new a.Event("pitchend",s)),this.fire(new a.Event("moveend",s))}flyTo(s,h){if(this._prefersReducedMotion(s)){const pt=a.pick(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(pt,h)}this.stop(),s=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},s);const g=this.transform,v=this.getZoom(),b=this.getBearing(),A=this.getPitch(),C=this.getPadding(),L="zoom"in s?a.clamp(+s.zoom,g.minZoom,g.maxZoom):v,$="bearing"in s?this._normalizeBearing(s.bearing,b):b,U="pitch"in s?+s.pitch:A,H="padding"in s?s.padding:g.padding,ne=g.zoomScale(L-v),le=a.Point.convert(s.offset);let fe=g.centerPoint.add(le);const ce=g.pointLocation(fe),de=a.LngLat.convert(s.center||ce);this._normalizeCenter(de);const X=g.project(ce),ae=g.project(de).sub(X);let ge=s.curve;const be=Math.max(g.width,g.height),Oe=be/ne,Re=ae.mag();if("minZoom"in s){const pt=a.clamp(Math.min(s.minZoom,v,L),g.minZoom,g.maxZoom),Tt=be/g.zoomScale(pt-v);ge=Math.sqrt(Tt/Re*2)}const De=ge*ge;function Ue(pt){const Tt=(Oe*Oe-be*be+(pt?-1:1)*De*De*Re*Re)/(2*(pt?Oe:be)*De*Re);return Math.log(Math.sqrt(Tt*Tt+1)-Tt)}function Ne(pt){return(Math.exp(pt)-Math.exp(-pt))/2}function Ye(pt){return(Math.exp(pt)+Math.exp(-pt))/2}const vt=Ue(0);let We=function(pt){return Ye(vt)/Ye(vt+ge*pt)},ht=function(pt){return be*((Ye(vt)*(Ne(Tt=vt+ge*pt)/Ye(Tt))-Ne(vt))/De)/Re;var Tt},rt=(Ue(1)-vt)/ge;if(Math.abs(Re)<1e-6||!isFinite(rt)){if(Math.abs(be-Oe)<1e-6)return this.easeTo(s,h);const pt=Oe<be?-1:1;rt=Math.abs(Math.log(Oe/be))/ge,ht=function(){return 0},We=function(Tt){return Math.exp(pt*ge*Tt)}}s.duration="duration"in s?+s.duration:1e3*rt/("screenSpeed"in s?+s.screenSpeed/ge:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);const _t=b!==$,Xe=U!==A,ut=!g.isPaddingEqual(H),bt=pt=>Tt=>{const Wt=Tt*rt,or=1/We(Wt);pt.zoom=Tt===1?L:v+pt.scaleZoom(or),_t&&(pt.bearing=a.number(b,$,Tt)),Xe&&(pt.pitch=a.number(A,U,Tt)),ut&&(pt.interpolatePadding(C,H,Tt),fe=pt.centerPoint.add(le));const jt=Tt===1?de:pt.unproject(X.add(ae.mult(ht(Wt))).mult(or));return pt.setLocationAtPoint(pt.renderWorldCopies?jt.wrap():jt,fe),pt._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(h),pt};if(s.preloadOnly){const pt=this._emulate(bt,s.duration,g);return this._preloadTiles(pt),this}return this._zooming=!0,this._rotating=_t,this._pitching=Xe,this._padding=ut,this._prepareEase(h,!1),this._ease(bt(g),()=>this._afterEase(h),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,h)}if(!s){const g=this.handlers;g&&g.stop(!1)}return this}_ease(s,h,g){g.animate===!1||g.duration===0?(s(1),h()):(this._easeStart=a.exported.now(),this._easeOptions=g,this._onEaseFrame=s,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,h){s=a.wrap(s,-180,180);const g=Math.abs(s-h);return Math.abs(s-360-h)<g&&(s-=360),Math.abs(s+360-h)<g&&(s+=360),s}_normalizeCenter(s){const h=this.transform;if(!h.renderWorldCopies||h.maxBounds)return;const g=s.lng-h.center.lng;s.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(s){return this._respectPrefersReducedMotion&&a.exported.prefersReducedMotion&&!(s&&s.essential)}_emulate(s,h,g){const v=Math.ceil(15*h/1e3),b=[],A=s(g.clone());for(let C=0;C<=v;C++){const L=A(C/v);b.push(L.clone())}return b}}class Ut{constructor(s={}){this.options=s,a.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){const h=this.options&&this.options.compact;return this._map=s,this._container=M("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=M("button","mapboxgl-ctrl-attrib-button",this._container),M("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=M("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(s,h){const g=this._map._getUIString(`AttributionControl.${h}`);s.setAttribute("aria-label",g),s.removeAttribute("title"),s.firstElementChild&&s.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.config.ACCESS_TOKEN}];if(s){const g=h.reduce((v,b,A)=>(b.value&&(v+=`${b.key}=${b.value}${A<h.length-1?"&":""}`),v),"?");s.href=`${a.config.FEEDBACK_URL}/${g}#${ic(this._map,!0)}`,s.rel="noopener nofollow",this._setElementTitle(s,"MapFeedback")}}_updateData(s){!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const h=this._map.style._sourceCaches;for(const v in h){const b=h[v];if(b.used){const A=b.getSource();A.attribution&&s.indexOf(A.attribution)<0&&s.push(A.attribution)}}s.sort((v,b)=>v.length-b.length),s=s.filter((v,b)=>{for(let A=b+1;A<s.length;A++)if(s[A].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));const g=s.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,s.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class zd{constructor(){a.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=M("div","mapboxgl-ctrl");const h=M("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&s.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const s=this._map.style._sourceCaches;if(Object.entries(s).length===0)return!0;for(const h in s){const g=s[h].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const s=this._container.children;if(s.length){const h=s[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class Fd{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const h=++this._id;return this._queue.push({callback:s,id:h,cancelled:!1}),h}remove(s){const h=this._currentlyRunning,g=h?this._queue.concat(h):this._queue;for(const v of g)if(v.id===s)return void(v.cancelled=!0)}run(s=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const g of h)if(!g.cancelled&&(g.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Zl(p,s,h){if(p=new a.LngLat(p.lng,p.lat),s){const g=new a.LngLat(p.lng-360,p.lat),v=new a.LngLat(p.lng+360,p.lat),b=360*Math.ceil(Math.abs(p.lng-h.center.lng)/360),A=h.locationPoint(p).distSqr(s),C=s.x<0||s.y<0||s.x>h.width||s.y>h.height;h.locationPoint(g).distSqr(s)<A&&(C||Math.abs(g.lng-h.center.lng)<b)?p=g:h.locationPoint(v).distSqr(s)<A&&(C||Math.abs(v.lng-h.center.lng)<b)&&(p=v)}for(;Math.abs(p.lng-h.center.lng)>180;){const g=h.locationPoint(p);if(g.x>=0&&g.y>=0&&g.x<=h.width&&g.y<=h.height)break;p.lng>h.center.lng?p.lng-=360:p.lng+=360}return p}const sl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Bt extends a.Evented{constructor(s,h){if(super(),(s instanceof a.window.HTMLElement||h)&&(s=a.extend({element:s},h)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=s&&s.occludedOpacity||.2,s&&s.element)this._element=s.element,this._offset=a.Point.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=M("div");const v=41,b=27,A=N("svg",{display:"block",height:v*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${v}`},this._element),C=N("radialGradient",{id:"shadowGradient"},N("defs",{},A));N("stop",{offset:"10%","stop-opacity":.4},C),N("stop",{offset:"100%","stop-opacity":.05},C),N("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},A),N("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},A),N("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},A),N("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},A),this._offset=a.Point.convert(s&&s.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const g=this._element.classList;for(const v in sl)g.remove(`mapboxgl-marker-anchor-${v}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){const s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=a.LngLat.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,s._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){const h=s.code,g=s.charCode||s.keyCode;h!=="Space"&&h!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(s){const h=s.originalEvent.target,g=this._element;this._popup&&(h===g||g.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const s=this._map,h=this._pos;if(!s||!h)return!1;const g=s.unproject(h),v=s.getFreeCameraOptions();if(!v.position)return!1;const b=v.position.toLngLat();return b.distanceTo(g)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const s=this._map;if(!s)return;const h=this._pos;if(!h||h.x<0||h.x>s.transform.width||h.y<0||h.y>s.transform.height)return void this._clearFadeTimer();const g=s.unproject(h);let v;s._showingGlobe()&&a.isLngLatBehindGlobe(s.transform,this._lngLat)?v=0:(v=1-s._queryFogOpacity(g),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const s=this._pos;if(!s||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${s.x}px,${s.y}px)
            ${sl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){const s=this._pos,h=this._map,g=this.getPitchAlignment();if(!h||!s||g!=="map")return"";if(!h._showingGlobe()){const L=h.getPitch();return L?`rotateX(${L}deg)`:""}const v=a.radToDeg(a.globeTiltAtLngLat(h.transform,this._lngLat)),b=s.sub(a.globeCenterToScreenPoint(h.transform)),A=Math.abs(b.x)+Math.abs(b.y);if(A===0)return"";const C=v/A;return`rotateX(${-b.y*C}deg) rotateY(${b.x*C}deg)`}_calculateZTransform(){const s=this._pos,h=this._map;if(!h||!s)return"";let g=0;const v=this.getRotationAlignment();if(v==="map")if(h._showingGlobe()){const b=h.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),A=h.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(b);g=a.radToDeg(Math.atan2(A.y,A.x))-90}else g=-h.getBearing();else if(v==="horizon"){const b=a.smoothstep(4,6,h.getZoom()),A=a.globeCenterToScreenPoint(h.transform);A.y+=b*h.transform.height;const C=s.sub(A),L=a.radToDeg(Math.atan2(C.y,C.x));g=(L>90?L-270:L+90)*(1-b)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(s){a.window.cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=Zl(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),s===!0?this._updateFrameId=a.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(s){return this._offset=a.Point.convert(s),this._update(),this}_onMove(s){const h=this._map;if(!h)return;const g=this._pointerdownPos,v=this._positionDelta;if(g&&v){if(!this._isDragging){const b=this._clickTolerance||h._clickTolerance;if(s.point.dist(g)<b)return;this._isDragging=!0}this._pos=s.point.sub(v),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(s){const h=this._map,g=this._pos;h&&g&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(g),this._pointerdownPos=s.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;const h=this._map;return h&&(s?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Bd={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},T0=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Eg(p=new a.Point(0,0),s="bottom"){if(typeof p=="number"){const h=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(s){case"top":return new a.Point(0,p);case"top-left":return new a.Point(h,h);case"top-right":return new a.Point(-h,h);case"bottom":return new a.Point(0,-p);case"bottom-left":return new a.Point(h,-h);case"bottom-right":return new a.Point(-h,-h);case"left":return new a.Point(p,0);case"right":return new a.Point(-p,0)}return new a.Point(0,0)}return p instanceof a.Point||Array.isArray(p)?a.Point.convert(p):a.Point.convert(p[s]||[0,0])}class Nd{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;const h=a.easeCubicInOut((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,h,g){this._start=this.getValue(h),this._end=s,this._startTime=h,this._endTime=h+g}}const Tg={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Sg={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},S0={showCompass:!0,showZoom:!0,visualizePitch:!1};class A0{constructor(s,h,g=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new kd({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,g&&(this.mousePitch=new Ld({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(s,h){this.mouseRotate.mousedown(s,h),this.mousePitch&&this.mousePitch.mousedown(s,h),k()}move(s,h){const g=this.map,v=this.mouseRotate.mousemoveWindow(s,h),b=v&&v.bearingDelta;if(b&&g.setBearing(g.getBearing()+b),this.mousePitch){const A=this.mousePitch.mousemoveWindow(s,h),C=A&&A.pitchDelta;C&&g.setPitch(g.getPitch()+C)}}off(){const s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart,{passive:!1}),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){z(),a.window.removeEventListener("mousemove",this.mousemove),a.window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(a.extend({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),se(this.element,s)),a.window.addEventListener("mousemove",this.mousemove),a.window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,se(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ue(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=ue(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Ud={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},$d={maxWidth:100,unit:"metric"},jd={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Hl={version:a.version,supported:D,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends Sh{constructor(p){if(a.LivePerformanceUtils.mark(a.PerformanceMarkers.create),(p=a.extend({},Sg,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&a.isSafariWithAntialiasingBug(a.window)&&(p.antialias=!1,a.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Vl(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._useWebGL2=p.useWebGL2,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._optimizeForTerrain=p.optimizeForTerrain,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new Fd,this._domRenderTaskQueue=new Fd,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.uniqueId(),this._locale=a.extend({},Tg,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Nd(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new a.RequestManager(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,typeof p.container=="string"){if(this._container=a.window.document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof a.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&a.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),a.window!==void 0&&(a.window.addEventListener("online",this._onWindowOnline,!1),a.window.addEventListener("resize",this._onWindowResize,!1),a.window.addEventListener("orientationchange",this._onWindowResize,!1),a.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new bs(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this._hash=p.hash&&new Cd(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,a.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),p.attributionControl&&this.addControl(new Ut({customAttribution:p.customAttribution})),this._logoControl=new zd,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new a.Event(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new a.Event(`${s.dataType}dataloading`,s))})}_getMapId(){return this._mapId}addControl(p,s){if(s===void 0&&(s=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=p.onAdd(this);this._controls.push(p);const g=this._controlPositions[s];return s.indexOf("bottom")!==-1?g.insertBefore(h,g.firstChild):g.appendChild(h),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(p);return s>-1&&this._controls.splice(s,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const s=!this._moving;return s&&this.fire(new a.Event("movestart",p)).fire(new a.Event("move",p)),this.fire(new a.Event("resize",p)),s&&this.fire(new a.Event("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(a.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return p==="auto"?a.window.navigator.language:Array.isArray(p)?p.length===0?void 0:p.map(s=>s==="auto"?a.window.navigator.language:s):p}setLanguage(p){const s=this._parseLanguage(p);if(!this.style||s===this._language)return this;this._language=s,this.style._reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(p){return this._lazyInitEmptyStyle(),p?typeof p=="string"&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const p=this.transform,s=p.projection.name;let h;s==="globe"&&p.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?(p.setMercatorFromTransition(),h=!0):s==="mercator"&&p.zoom<a.GLOBE_ZOOM_THRESHOLD_MAX&&(p.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(p,s){return this._updateProjection(p||s||{name:"mercator"})}_updateProjection(p){let s;if(s=p.name==="globe"&&this.transform.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate(),s){this.painter.clearBackgroundTiles();for(const h in this.style._sourceCaches)this.style._sourceCaches[h].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(p){return this.transform.locationPoint3D(a.LngLat.convert(p))}unproject(p){return this.transform.pointLocation3D(a.Point.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,s,h){if(p==="mouseenter"||p==="mouseover"){let g=!1;const v=A=>{const C=s.filter($=>this.getLayer($)),L=C.length?this.queryRenderedFeatures(A.point,{layers:C}):[];L.length?g||(g=!0,h.call(this,new pi(p,this,A.originalEvent,{features:L}))):g=!1},b=()=>{g=!1};return{layers:new Set(s),listener:h,delegates:{mousemove:v,mouseout:b}}}if(p==="mouseleave"||p==="mouseout"){let g=!1;const v=A=>{const C=s.filter(L=>this.getLayer(L));(C.length?this.queryRenderedFeatures(A.point,{layers:C}):[]).length?g=!0:g&&(g=!1,h.call(this,new pi(p,this,A.originalEvent)))},b=A=>{g&&(g=!1,h.call(this,new pi(p,this,A.originalEvent)))};return{layers:new Set(s),listener:h,delegates:{mousemove:v,mouseout:b}}}{const g=v=>{const b=s.filter(C=>this.getLayer(C)),A=b.length?this.queryRenderedFeatures(v.point,{layers:b}):[];A.length&&(v.features=A,h.call(this,v),delete v.features)};return{layers:new Set(s),listener:h,delegates:{[p]:g}}}}on(p,s,h){if(h===void 0)return super.on(p,s);Array.isArray(s)||(s=[s]);const g=this._createDelegatedListener(p,s,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(g);for(const v in g.delegates)this.on(v,g.delegates[v]);return this}once(p,s,h){if(h===void 0)return super.once(p,s);Array.isArray(s)||(s=[s]);const g=this._createDelegatedListener(p,s,h);for(const v in g.delegates)this.once(v,g.delegates[v]);return this}off(p,s,h){if(h===void 0)return super.off(p,s);s=new Set(Array.isArray(s)?s:[s]);const g=(b,A)=>{if(b.size!==A.size)return!1;for(const C of b)if(!A.has(C))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[p]:void 0;return v&&(b=>{for(let A=0;A<b.length;A++){const C=b[A];if(C.listener===h&&g(C.layers,s)){for(const L in C.delegates)this.off(L,C.delegates[L]);return b.splice(A,1),this}}})(v),this}queryRenderedFeatures(p,s){return this.style?(s!==void 0||p===void 0||p instanceof a.Point||Array.isArray(p)||(s=p,p=void 0),this.style.queryRenderedFeatures(p=p||[[0,0],[this.transform.width,this.transform.height]],s=s||{},this.transform)):[]}querySourceFeatures(p,s){return this.style.querySourceFeatures(p,s)}isPointOnSurface(p){const{name:s}=this.transform.projection;return s!=="globe"&&s!=="mercator"&&a.warnOnce(`${s} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(a.Point.convert(p))}setStyle(p,s){return(s=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&s.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(p,s))}_getUIString(p){const s=this._locale[p];if(s==null)throw new Error(`Missing UI string '${p}'`);return s}_updateStyle(p,s){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p&&(this.style=new Br(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Br(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,s){if(typeof p=="string"){const h=this._requestManager.normalizeStyleURL(p),g=this._requestManager.transformRequest(h,a.ResourceType.Style);a.getJSON(g,(v,b)=>{v?this.fire(new a.ErrorEvent(v)):b&&this._updateDiff(b,s)})}else typeof p=="object"&&this._updateDiff(p,s)}_updateDiff(p,s){try{this.style.setState(p)&&this._update(!0)}catch(h){a.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(p,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.warnOnce("There is no style added to the map."),!1)}addSource(p,s){return this._lazyInitEmptyStyle(),this.style.addSource(p,s),this._update(!0)}isSourceLoaded(p){return!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){const p=this.style&&this.style._sourceCaches;for(const s in p){const h=p[s]._tiles;for(const g in h){const v=h[g];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}addSourceType(p,s,h){this._lazyInitEmptyStyle(),this.style.addSourceType(p,s,h)}removeSource(p){return this.style.removeSource(p),this._updateTerrain(),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,s,{pixelRatio:h=1,sdf:g=!1,stretchX:v,stretchY:b,content:A}={}){if(this._lazyInitEmptyStyle(),s instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&s instanceof a.window.ImageBitmap){const{width:C,height:L,data:$}=a.exported.getImageData(s);this.style.addImage(p,{data:new a.RGBAImage({width:C,height:L},$),pixelRatio:h,stretchX:v,stretchY:b,content:A,sdf:g,version:0})}else if(s.width===void 0||s.height===void 0)this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:L}=s,$=s;this.style.addImage(p,{data:new a.RGBAImage({width:C,height:L},new Uint8Array($.data)),pixelRatio:h,stretchX:v,stretchY:b,content:A,sdf:g,version:0,userImage:$}),$.onAdd&&$.onAdd(this,p)}}updateImage(p,s){const h=this.style.getImage(p);if(!h)return void this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=s instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&s instanceof a.window.ImageBitmap?a.exported.getImageData(s):s,{width:v,height:b}=g;v!==void 0&&b!==void 0?v===h.data.width&&b===h.data.height?(h.data.replace(g.data,!(s instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&s instanceof a.window.ImageBitmap)),this.style.updateImage(p,h)):this.fire(new a.ErrorEvent(new Error(`The width and height of the updated image (${v}, ${b})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`))):this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,s){a.getImage(this._requestManager.transformRequest(p,a.ResourceType.Image),(h,g)=>{s(h,g instanceof a.window.HTMLImageElement?a.exported.getImageData(g):g)})}listImages(){return this.style.listImages()}addLayer(p,s){return this._lazyInitEmptyStyle(),this.style.addLayer(p,s),this._update(!0)}moveLayer(p,s){return this.style.moveLayer(p,s),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,s,h){return this.style.setLayerZoomRange(p,s,h),this._update(!0)}setFilter(p,s,h={}){return this.style.setFilter(p,s,h),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,s,h,g={}){return this.style.setPaintProperty(p,s,h,g),this._update(!0)}getPaintProperty(p,s){return this.style.getPaintProperty(p,s)}setLayoutProperty(p,s,h,g={}){return this.style.setLayoutProperty(p,s,h,g),this._update(!0)}getLayoutProperty(p,s){return this.style.getLayoutProperty(p,s)}setLight(p,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,s),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.LngLat.convert(p),this.transform):0}setFeatureState(p,s){return this.style.setFeatureState(p,s),this._update()}removeFeatureState(p,s){return this.style.removeFeatureState(p,s),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300;let h,g,v,b=this._container;for(;b&&(!g||!v);){const A=a.window.getComputedStyle(b).transform;A&&A!=="none"&&(h=A.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(g=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(v=h[3])),b=b.parentElement}this._containerWidth=g?Math.abs(p/g):p,this._containerHeight=v?Math.abs(s/v):s}_detectMissingCSS(){a.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=M("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const s=this._canvasContainer=M("div","mapboxgl-canvas-container",p);this._interactive&&s.classList.add("mapboxgl-interactive"),this._canvas=M("canvas","mapboxgl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=M("div","mapboxgl-control-container",p),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{g[v]=M("div",`mapboxgl-ctrl-${v}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,s){const h=a.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(p),this._canvas.height=h*Math.ceil(s),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${s}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const s=this._markers.indexOf(p);s!==-1&&this._markers.splice(s,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){const s=this._popups.indexOf(p);s!==-1&&this._popups.splice(s,1)}_setupPainter(){const p=a.extend({},D.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._useWebGL2&&this._canvas.getContext("webgl2",p),h=s||this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);h?(this._useWebGL2&&!s&&a.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),a.storeAuthState(h,!0),this.painter=new $l(h,this.transform,!!s),this.on("data",g=>{g.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.exported$1.testSupport(h)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let s;const h=this.painter.context.extTimerQuery,g=a.exported.now();if(this.listens("gpu-timing-frame")&&(s=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],a.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],a.window.performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const C=this.transform.zoom,L=this.transform.pitch,$=a.exported.now(),U=new a.EvaluationParameters(C,{now:$,fadeDuration:v,pitch:L,transition:this.style.getTransition()});this.style.update(U)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(g),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(g),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new a.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){const C=a.exported.now()-g;h.endQueryEXT(h.TIME_ELAPSED_EXT,s),setTimeout(()=>{const L=h.getQueryObjectEXT(s,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(s),this.fire(new a.Event("gpu-timing-frame",{cpuTime:C,gpuTime:L})),a.window.performance.mark("frame-gpu",{startTime:g,detail:{gpuTime:L}})},50)}if(this.listens("gpu-timing-layer")){const C=this.painter.collectGpuTimers();setTimeout(()=>{const L=this.painter.queryGpuTimers(C);this.fire(new a.Event("gpu-timing-layer",{layerTimes:L}))},50)}if(this.listens("gpu-timing-deferred-render")){const C=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const L=this.painter.queryGpuTimeDeferredRender(C);this.fire(new a.Event("gpu-timing-deferred-render",{gpuTime:L}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(A||this._repaint)this.triggerRepaint();else{const C=!this.isMoving()&&this.loaded();if(C&&(b=this._updateAverageElevation(g,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),C&&(this.fire(new a.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const L=this._calculateSpeedIndex();this.fire(new a.Event("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,a.LivePerformanceUtils.mark(a.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&a.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(const s of this._markers)p&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(const s of this._popups)!p||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(p,s=!1){const h=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);if((s||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const g=this.transform.averageElevation;let v=this.transform.sampleAverageElevation(),b=!1;this.transform.elevation&&(b=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=p;const A=Math.abs(g-v);if(A>1){if(this._isInitialLoad||b)return this._averageElevation.jumpTo(v),h(v);this._averageElevation.easeTo(v,p,300)}else if(A>1e-4)return this._averageElevation.jumpTo(v),h(v)}return!!this._averageElevation.isEasing(p)&&h(this._averageElevation.getValue(p))}_authenticate(){a.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===a.AUTH_ERR_MSG||p.status===401)){const s=this.painter.context.gl;a.storeAuthState(s,!1),this._logoControl instanceof zd&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());const h=this.painter.context.gl,g=h.createFramebuffer();function v(b){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,b,0);const A=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,A),A}return h.bindFramebuffer(h.FRAMEBUFFER,g),this._canvasPixelComparison(v(p),s.canvasCopies.map(v),s.timeStamps)}_canvasPixelComparison(p,s,h){let g=h[1]-h[0];const v=p.length/4;for(let b=0;b<s.length;b++){const A=s[b];let C=0;for(let L=0;L<A.length;L+=4)A[L]===p[L]&&A[L+1]===p[L+1]&&A[L+2]===p[L+2]&&A[L+3]===p[L+3]&&(C+=1);g+=(h[b+2]-h[b+1])*(1-C/v)}return g}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),a.window!==void 0&&(a.window.removeEventListener("resize",this._onWindowResize,!1),a.window.removeEventListener("orientationchange",this._onWindowResize,!1),a.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.removeEventListener("online",this._onWindowOnline,!1),a.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),a.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=a.exported.frame(s=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(s)}))}_preloadTiles(p){const s=this.style?Object.values(this.style._sourceCaches):[];return a.asyncAll(s,(h,g)=>h._preloadTiles(p,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){a.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,p&&this._update())}_setCacheLimits(p,s){a.setCacheLimits(p,s)}get version(){return a.version}},NavigationControl:class{constructor(p){this.options=a.extend({},S0,p),this._container=M("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>{this._map&&this._map.zoomIn({},{originalEvent:s})}),M("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>{this._map&&this._map.zoomOut({},{originalEvent:s})}),M("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:s}):h.resetNorth({},{originalEvent:s}))}),this._compassIcon=M("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const s=p.getZoom(),h=s===p.getMaxZoom(),g=s===p.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=s)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new A0(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,s){const h=M("button",p,this._container);return h.type="button",h.addEventListener("click",s),h}_setButtonTitle(p,s){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${s}`);p.setAttribute("aria-label",h),p.firstElementChild&&p.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends a.Evented{constructor(p){super(),this.options=a.extend({geolocation:a.window.navigator.geolocation},Ud,p),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Gl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=M("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){const s=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,p(h)};this._supportsGeolocation!==void 0?p(this._supportsGeolocation):a.window.navigator.permissions!==void 0?a.window.navigator.permissions.query({name:"geolocation"}).then(h=>s(h.state!=="denied")).catch(()=>s()):s()}_isOutOfMapMaxBounds(p){const s=this._map.getMaxBounds(),h=p.coords;return!!s&&(h.longitude<s.getWest()||h.longitude>s.getEast()||h.latitude<s.getSouth()||h.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",p)),this._finish()}}_updateCamera(p){const s=new a.LngLat(p.coords.longitude,p.coords.latitude),h=p.coords.accuracy,g=this._map.getBearing(),v=a.extend({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(h),v,{geolocateSource:!0})}_updateMarker(p){if(p){const s=new a.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,s=a.mercatorZfromAltitude(1,p._center.lat)*p.worldSize,h=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=M("button","mapboxgl-ctrl-geolocate",this._container),M("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=M("div","mapboxgl-user-location"),this._dotElement.appendChild(M("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(M("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Bt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=M("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Bt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{a.window.addEventListener("ondeviceorientationabsolute"in a.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};a.window.DeviceMotionEvent!==void 0&&typeof a.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(s=>{s==="granted"&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),a.window.removeEventListener("deviceorientation",this._onDeviceOrientation),a.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ut,ScaleControl:class{constructor(p){this.options=a.extend({},$d,p),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),a.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,s=this._map,h=s._containerHeight/2,g=s._containerWidth/2-p/2,v=s.unproject([g,h]),b=s.unproject([g+p,h]),A=v.distanceTo(b);if(this.options.unit==="imperial"){const C=3.2808*A;C>5280?this._setScale(p,C/5280,"mile"):this._setScale(p,C,"foot")}else this.options.unit==="nautical"?this._setScale(p,A/1852,"nautical-mile"):A>=1e3?this._setScale(p,A/1e3,"kilometer"):this._setScale(p,A,"meter")}_setScale(p,s,h){this._map._requestDomTask(()=>{const g=function(b){const A=Math.pow(10,`${Math.floor(b)}`.length-1);let C=b/A;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(L){const $=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*$)/$}(C),A*C}(s),v=g/s;this._container.innerHTML=this._isNumberFormatSupported&&h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(g):`${g}&nbsp;${jd[h]}`,this._container.style.width=p*v+"px"})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=M("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof a.window.HTMLElement?this._container=p.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in a.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in a.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=M("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,a.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!a.window.document.fullscreenEnabled&&!a.window.document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=M("button","mapboxgl-ctrl-fullscreen",this._controlContainer);M("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),a.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(a.window.document.fullscreenElement||a.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?a.window.document.exitFullscreen?a.window.document.exitFullscreen():a.window.document.webkitCancelFullScreen&&a.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.Evented{constructor(p){super(),this.options=a.extend(Object.create(Bd),p),a.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=a.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update();const s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(a.window.document.createTextNode(p))}setHTML(p){const s=a.window.document.createDocumentFragment(),h=a.window.document.createElement("body");let g;for(h.innerHTML=p;g=h.firstChild,g;)s.appendChild(g);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=M("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(p),this.options.closeButton){const h=this._closeButton=M("button","mapboxgl-popup-close-button",s);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let s;return this._classList.delete(p)?s=!1:(this._classList.add(p),s=!0),this._updateClassList(),s}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const s=this._map,h=this._container,g=this._pos;if(!s||!h||!g)return"bottom";const v=h.offsetWidth,b=h.offsetHeight,A=g.x<v/2,C=g.x>s.transform.width-v/2;if(g.y+p<b)return A?"top-left":C?"top-right":"top";if(g.y>s.transform.height-b){if(A)return"bottom-left";if(C)return"bottom-right"}return A?"left":C?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),p.className=s.join(" ")}_update(p){const s=this._map,h=this._content;if(!s||!this._lngLat&&!this._trackPointer||!h)return;let g=this._container;if(g||(g=this._container=M("div","mapboxgl-popup",s.getContainer()),this._tip=M("div","mapboxgl-popup-tip",g),g.appendChild(h)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Zl(this._lngLat,this._pos,s.transform)),!this._trackPointer||p){const v=this._pos=this._trackPointer&&p?p:s.project(this._lngLat),b=Eg(this.options.offset),A=this._anchor=this._getAnchor(b.y),C=Eg(this.options.offset,A),L=v.add(C).round();s._requestDomTask(()=>{this._container&&A&&(this._container.style.transform=`${sl[A]} translate(${L.x}px,${L.y}px)`)})}if(!this._marker&&s._showingGlobe()){const v=a.isLngLatBehindGlobe(s.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(T0);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:Bt,Style:Br,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.Point,MercatorCoordinate:a.MercatorCoordinate,FreeCameraOptions:lg,Evented:a.Evented,config:a.config,prewarm:function(){ga().acquire(ri)},clearPrewarmedResources:function(){const p=Ei;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(ri),Ei=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return a.config.ACCESS_TOKEN},set accessToken(p){a.config.ACCESS_TOKEN=p},get baseApiUrl(){return a.config.API_URL},set baseApiUrl(p){a.config.API_URL=p},get workerCount(){return ni.workerCount},set workerCount(p){ni.workerCount=p},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){a.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){a.clearTileCache(p)},workerUrl:"",workerClass:null,setNow:a.exported.setNow,restoreNow:a.exported.restoreNow};return Hl});var w=d;return w})})(gR);var zj=gR.exports;const tm=Pu(zj),Xo={CANVAS:"mapboxgl-canvas",CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},Ps={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},Un={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},Ko={POLYGON:"polygon",LINE:"line_string",POINT:"point"},rr={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},Ur={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select"},Lo={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Nm={MOVE:"move",CHANGE_PROPERTIES:"change_properties",CHANGE_COORDINATES:"change_coordinates"},yo={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},Vi={ACTIVE:"true",INACTIVE:"false"},_R=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Fj=-90,tE=-85,Bj=90,rE=85,Nj=-270,Uj=270,vR=Object.freeze(Object.defineProperty({__proto__:null,LAT_MAX:Bj,LAT_MIN:Fj,LAT_RENDERED_MAX:rE,LAT_RENDERED_MIN:tE,LNG_MAX:Uj,LNG_MIN:Nj,activeStates:Vi,classes:Xo,cursors:Un,events:Lo,geojsonTypes:rr,interactions:_R,meta:yo,modes:Ur,sources:Ps,types:Ko,updateActions:Nm},Symbol.toStringTag,{value:"Module"}));function Mv(e){return function(t){const n=t.featureTarget;return!n||!n.properties?!1:n.properties.meta===e}}function xR(e){return!e.originalEvent||!e.originalEvent.shiftKey?!1:e.originalEvent.button===0}function Kc(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===Vi.ACTIVE&&e.featureTarget.properties.meta===yo.FEATURE}function GT(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===Vi.INACTIVE&&e.featureTarget.properties.meta===yo.FEATURE}function Pv(e){return e.featureTarget===void 0}function qT(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.meta===yo.FEATURE}function Um(e){const t=e.featureTarget;return!t||!t.properties?!1:t.properties.meta===yo.VERTEX}function j_(e){return e.originalEvent?e.originalEvent.shiftKey===!0:!1}function kv(e){return e.key==="Escape"||e.keyCode===27}function Lv(e){return e.key==="Enter"||e.keyCode===13}function nE(e){return e.key==="Backspace"||e.keyCode===8}function iE(e){return e.key==="Delete"||e.keyCode===46}function bR(e){return e.key==="1"||e.keyCode===49}function wR(e){return e.key==="2"||e.keyCode===50}function ER(e){return e.key==="3"||e.keyCode===51}function TR(e){const t=e.key||String.fromCharCode(e.keyCode);return t>="0"&&t<="9"}function $j(){return!0}const jj=Object.freeze(Object.defineProperty({__proto__:null,isActiveFeature:Kc,isBackspaceKey:nE,isDeleteKey:iE,isDigit1Key:bR,isDigit2Key:wR,isDigit3Key:ER,isDigitKey:TR,isEnterKey:Lv,isEscapeKey:kv,isFeature:qT,isInactiveFeature:GT,isOfMetaType:Mv,isShiftDown:j_,isShiftMousedown:xR,isTrue:$j,isVertex:Um,noTarget:Pv},Symbol.toStringTag,{value:"Module"}));var Ov={},Dv={};Dv.RADIUS=6378137;Dv.FLATTENING=1/298.257223563;Dv.POLAR_RADIUS=63567523142e-4;var fP=Dv;Ov.geometry=SR;Ov.ring=oE;function SR(e){var t=0,n;switch(e.type){case"Polygon":return dP(e.coordinates);case"MultiPolygon":for(n=0;n<e.coordinates.length;n++)t+=dP(e.coordinates[n]);return t;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<e.geometries.length;n++)t+=SR(e.geometries[n]);return t}}function dP(e){var t=0;if(e&&e.length>0){t+=Math.abs(oE(e[0]));for(var n=1;n<e.length;n++)t-=Math.abs(oE(e[n]))}return t}function oE(e){var t,n,l,c,d,_,w,a=0,S=e.length;if(S>2){for(w=0;w<S;w++)w===S-2?(c=S-2,d=S-1,_=0):w===S-1?(c=S-1,d=0,_=1):(c=w,d=w+1,_=w+2),t=e[c],n=e[d],l=e[_],a+=(v1(l[0])-v1(t[0]))*Math.sin(v1(n[1]));a=a*fP.RADIUS*fP.RADIUS/2}return a}function v1(e){return e*Math.PI/180}const pP={Point:0,LineString:1,MultiLineString:1,Polygon:2};function Vj(e,t){const n=pP[e.geometry.type]-pP[t.geometry.type];return n===0&&e.geometry.type===rr.POLYGON?e.area-t.area:n}function AR(e){return e.map(t=>(t.geometry.type===rr.POLYGON&&(t.area=Ov.geometry({type:rr.FEATURE,property:{},geometry:t.geometry})),t)).sort(Vj).map(t=>(delete t.area,t))}function CR(e,t=0){return[[e.point.x-t,e.point.y-t],[e.point.x+t,e.point.y+t]]}function Os(e){if(this._items={},this._nums={},this._length=e?e.length:0,!!e)for(let t=0,n=e.length;t<n;t++)this.add(e[t]),e[t]!==void 0&&(typeof e[t]=="string"?this._items[e[t]]=t:this._nums[e[t]]=t)}Os.prototype.add=function(e){return this.has(e)?this:(this._length++,typeof e=="string"?this._items[e]=this._length:this._nums[e]=this._length,this)};Os.prototype.delete=function(e){return this.has(e)===!1?this:(this._length--,delete this._items[e],delete this._nums[e],this)};Os.prototype.has=function(e){return typeof e!="string"&&typeof e!="number"?!1:this._items[e]!==void 0||this._nums[e]!==void 0};Os.prototype.values=function(){const e=[];return Object.keys(this._items).forEach(t=>{e.push({k:t,v:this._items[t]})}),Object.keys(this._nums).forEach(t=>{e.push({k:JSON.parse(t),v:this._nums[t]})}),e.sort((t,n)=>t.v-n.v).map(t=>t.k)};Os.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};const Gj=[yo.FEATURE,yo.MIDPOINT,yo.VERTEX],jf={click:qj,touch:Wj};function qj(e,t,n){return IR(e,t,n,n.options.clickBuffer)}function Wj(e,t,n){return IR(e,t,n,n.options.touchBuffer)}function IR(e,t,n,l){if(n.map===null)return[];const c=e?CR(e,l):t,d={};n.options.styles&&(d.layers=n.options.styles.map(S=>S.id).filter(S=>n.map.getLayer(S)!=null));const _=n.map.queryRenderedFeatures(c,d).filter(S=>Gj.indexOf(S.properties.meta)!==-1),w=new Os,a=[];return _.forEach(S=>{const D=S.properties.id;w.has(D)||(w.add(D),a.push(S))}),AR(a)}function s_(e,t){const n=jf.click(e,null,t),l={mouse:Un.NONE};return n[0]&&(l.mouse=n[0].properties.active===Vi.ACTIVE?Un.MOVE:Un.POINTER,l.feature=n[0].properties.meta),t.events.currentModeName().indexOf("draw")!==-1&&(l.mouse=Un.ADD),t.ui.queueMapClasses(l),t.ui.updateMapClasses(),n[0]}function WT(e,t){const n=e.x-t.x,l=e.y-t.y;return Math.sqrt(n*n+l*l)}const Zj=4,Hj=12,Xj=500;function sE(e,t,n={}){const l=n.fineTolerance!=null?n.fineTolerance:Zj,c=n.grossTolerance!=null?n.grossTolerance:Hj,d=n.interval!=null?n.interval:Xj;e.point=e.point||t.point,e.time=e.time||t.time;const _=WT(e.point,t.point);return _<l||_<c&&t.time-e.time<d}const Kj=25,Yj=250;function aE(e,t,n={}){const l=n.tolerance!=null?n.tolerance:Kj,c=n.interval!=null?n.interval:Yj;return e.point=e.point||t.point,e.time=e.time||t.time,WT(e.point,t.point)<l&&t.time-e.time<c}const lE=function(e,t){const n={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},l={on(d,_,w){if(n[d]===void 0)throw new Error(`Invalid event type: ${d}`);n[d].push({selector:_,fn:w})},render(d){t.store.featureChanged(d)}},c=function(d,_){const w=n[d];let a=w.length;for(;a--;){const S=w[a];if(S.selector(_)){S.fn.call(l,_)||t.store.render(),t.ui.updateMapClasses();break}}};return e.start.call(l),{render:e.render,stop(){e.stop&&e.stop()},trash(){e.trash&&(e.trash(),t.store.render())},combineFeatures(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures(){e.uncombineFeatures&&e.uncombineFeatures()},drag(d){c("drag",d)},click(d){c("click",d)},mousemove(d){c("mousemove",d)},mousedown(d){c("mousedown",d)},mouseup(d){c("mouseup",d)},mouseout(d){c("mouseout",d)},keydown(d){c("keydown",d)},keyup(d){c("keyup",d)},touchstart(d){c("touchstart",d)},touchmove(d){c("touchmove",d)},touchend(d){c("touchend",d)},tap(d){c("tap",d)}}};let Jj=(e,t=21)=>(n=t)=>{let l="",c=n|0;for(;c--;)l+=e[Math.random()*e.length|0];return l};const Qj=Jj("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",32);function ZT(){return Qj()}const zo=function(e,t){this.ctx=e,this.properties=t.properties||{},this.coordinates=t.geometry.coordinates,this.id=t.id||ZT(),this.type=t.geometry.type};zo.prototype.changed=function(){this.ctx.store.featureChanged(this.id)};zo.prototype.incomingCoords=function(e){this.setCoordinates(e)};zo.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};zo.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))};zo.prototype.setProperty=function(e,t){this.properties[e]=t};zo.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:rr.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))};zo.prototype.internal=function(e){const t={id:this.id,meta:yo.FEATURE,"meta:type":this.type,active:Vi.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(const n in this.properties)t[`user_${n}`]=this.properties[n];return{type:rr.FEATURE,properties:t,geometry:{coordinates:this.getCoordinates(),type:this.type}}};const Ru=function(e,t){zo.call(this,e,t)};Ru.prototype=Object.create(zo.prototype);Ru.prototype.isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"};Ru.prototype.updateCoordinate=function(e,t,n){arguments.length===3?this.coordinates=[t,n]:this.coordinates=[e,t],this.changed()};Ru.prototype.getCoordinate=function(){return this.getCoordinates()};const qa=function(e,t){zo.call(this,e,t)};qa.prototype=Object.create(zo.prototype);qa.prototype.isValid=function(){return this.coordinates.length>1};qa.prototype.addCoordinate=function(e,t,n){this.changed();const l=parseInt(e,10);this.coordinates.splice(l,0,[t,n])};qa.prototype.getCoordinate=function(e){const t=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[t]))};qa.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)};qa.prototype.updateCoordinate=function(e,t,n){const l=parseInt(e,10);this.coordinates[l]=[t,n],this.changed()};const _s=function(e,t){zo.call(this,e,t),this.coordinates=this.coordinates.map(n=>n.slice(0,-1))};_s.prototype=Object.create(zo.prototype);_s.prototype.isValid=function(){return this.coordinates.length===0?!1:this.coordinates.every(e=>e.length>2)};_s.prototype.incomingCoords=function(e){this.coordinates=e.map(t=>t.slice(0,-1)),this.changed()};_s.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};_s.prototype.addCoordinate=function(e,t,n){this.changed();const l=e.split(".").map(d=>parseInt(d,10));this.coordinates[l[0]].splice(l[1],0,[t,n])};_s.prototype.removeCoordinate=function(e){this.changed();const t=e.split(".").map(l=>parseInt(l,10)),n=this.coordinates[t[0]];n&&(n.splice(t[1],1),n.length<3&&this.coordinates.splice(t[0],1))};_s.prototype.getCoordinate=function(e){const t=e.split(".").map(l=>parseInt(l,10)),n=this.coordinates[t[0]];return JSON.parse(JSON.stringify(n[t[1]]))};_s.prototype.getCoordinates=function(){return this.coordinates.map(e=>e.concat([e[0]]))};_s.prototype.updateCoordinate=function(e,t,n){this.changed();const l=e.split("."),c=parseInt(l[0],10),d=parseInt(l[1],10);this.coordinates[c]===void 0&&(this.coordinates[c]=[]),this.coordinates[c][d]=[t,n]};const eV={MultiPoint:Ru,MultiLineString:qa,MultiPolygon:_s},Rv=(e,t,n,l,c)=>{const d=n.split("."),_=parseInt(d[0],10),w=d[1]?d.slice(1).join("."):null;return e[_][t](w,l,c)},Po=function(e,t){if(zo.call(this,e,t),delete this.coordinates,this.model=eV[t.geometry.type],this.model===void 0)throw new TypeError(`${t.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(t.geometry.coordinates)};Po.prototype=Object.create(zo.prototype);Po.prototype._coordinatesToFeatures=function(e){const t=this.model.bind(this);return e.map(n=>new t(this.ctx,{id:ZT(),type:rr.FEATURE,properties:{},geometry:{coordinates:n,type:this.type.replace("Multi","")}}))};Po.prototype.isValid=function(){return this.features.every(e=>e.isValid())};Po.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()};Po.prototype.getCoordinate=function(e){return Rv(this.features,"getCoordinate",e)};Po.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(e=>e.type===rr.POLYGON?e.getCoordinates():e.coordinates)))};Po.prototype.updateCoordinate=function(e,t,n){Rv(this.features,"updateCoordinate",e,t,n),this.changed()};Po.prototype.addCoordinate=function(e,t,n){Rv(this.features,"addCoordinate",e,t,n),this.changed()};Po.prototype.removeCoordinate=function(e){Rv(this.features,"removeCoordinate",e),this.changed()};Po.prototype.getFeatures=function(){return this.features};function Ar(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}Ar.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)};Ar.prototype.setSelectedCoordinates=function(e){this._ctx.store.setSelectedCoordinates(e),e.reduce((t,n)=>(t[n.feature_id]===void 0&&(t[n.feature_id]=!0,this._ctx.store.get(n.feature_id).changed()),t),{})};Ar.prototype.getSelected=function(){return this._ctx.store.getSelected()};Ar.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()};Ar.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)};Ar.prototype.getFeature=function(e){return this._ctx.store.get(e)};Ar.prototype.select=function(e){return this._ctx.store.select(e)};Ar.prototype.deselect=function(e){return this._ctx.store.deselect(e)};Ar.prototype.deleteFeature=function(e,t={}){return this._ctx.store.delete(e,t)};Ar.prototype.addFeature=function(e,t={}){return this._ctx.store.add(e,t)};Ar.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()};Ar.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()};Ar.prototype.setActionableState=function(e={}){const t={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(t)};Ar.prototype.changeMode=function(e,t={},n={}){return this._ctx.events.changeMode(e,t,n)};Ar.prototype.fire=function(e,t){return this._ctx.events.fire(e,t)};Ar.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)};Ar.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)};Ar.prototype.featuresAt=function(e,t,n="click"){if(n!=="click"&&n!=="touch")throw new Error("invalid buffer type");return jf[n](e,t,this._ctx)};Ar.prototype.newFeature=function(e){const t=e.geometry.type;return t===rr.POINT?new Ru(this._ctx,e):t===rr.LINE_STRING?new qa(this._ctx,e):t===rr.POLYGON?new _s(this._ctx,e):new Po(this._ctx,e)};Ar.prototype.isInstanceOf=function(e,t){if(e===rr.POINT)return t instanceof Ru;if(e===rr.LINE_STRING)return t instanceof qa;if(e===rr.POLYGON)return t instanceof _s;if(e==="MultiFeature")return t instanceof Po;throw new Error(`Unknown feature class: ${e}`)};Ar.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)};Ar.prototype.onSetup=function(){};Ar.prototype.onDrag=function(){};Ar.prototype.onClick=function(){};Ar.prototype.onMouseMove=function(){};Ar.prototype.onMouseDown=function(){};Ar.prototype.onMouseUp=function(){};Ar.prototype.onMouseOut=function(){};Ar.prototype.onKeyUp=function(){};Ar.prototype.onKeyDown=function(){};Ar.prototype.onTouchStart=function(){};Ar.prototype.onTouchMove=function(){};Ar.prototype.onTouchEnd=function(){};Ar.prototype.onTap=function(){};Ar.prototype.onStop=function(){};Ar.prototype.onTrash=function(){};Ar.prototype.onCombineFeature=function(){};Ar.prototype.onUncombineFeature=function(){};Ar.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};const MR={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},tV=Object.keys(MR);function rV(e){const t=Object.keys(e);return function(n,l={}){let c={};const d=t.reduce((w,a)=>(w[a]=e[a],w),new Ar(n));function _(w){return a=>d[w](c,a)}return{start(){c=d.onSetup(l),tV.forEach(w=>{const a=MR[w];let S=()=>!1;e[a]&&(S=()=>!0),this.on(w,S,_(a))})},stop(){d.onStop(c)},trash(){d.onTrash(c)},combineFeatures(){d.onCombineFeatures(c)},uncombineFeatures(){d.onUncombineFeatures(c)},render(w,a){d.toDisplayFeatures(c,w,a)}}}}function nV(e){const t=Object.keys(e.options.modes).reduce((I,M)=>(I[M]=rV(e.options.modes[M]),I),{});let n={},l={};const c={};let d=null,_=null;c.drag=function(I,M){M({point:I.point,time:new Date().getTime()})?(e.ui.queueMapClasses({mouse:Un.DRAG}),_.drag(I)):I.originalEvent.stopPropagation()},c.mousedrag=function(I){c.drag(I,M=>!sE(n,M))},c.touchdrag=function(I){c.drag(I,M=>!aE(l,M))},c.mousemove=function(I){if((I.originalEvent.buttons!==void 0?I.originalEvent.buttons:I.originalEvent.which)===1)return c.mousedrag(I);const N=s_(I,e);I.featureTarget=N,_.mousemove(I)},c.mousedown=function(I){n={time:new Date().getTime(),point:I.point};const M=s_(I,e);I.featureTarget=M,_.mousedown(I)},c.mouseup=function(I){const M=s_(I,e);I.featureTarget=M,sE(n,{point:I.point,time:new Date().getTime()})?_.click(I):_.mouseup(I)},c.mouseout=function(I){_.mouseout(I)},c.touchstart=function(I){if(!e.options.touchEnabled)return;l={time:new Date().getTime(),point:I.point};const M=jf.touch(I,null,e)[0];I.featureTarget=M,_.touchstart(I)},c.touchmove=function(I){if(e.options.touchEnabled)return _.touchmove(I),c.touchdrag(I)},c.touchend=function(I){if(I.originalEvent.preventDefault(),!e.options.touchEnabled)return;const M=jf.touch(I,null,e)[0];I.featureTarget=M,aE(l,{time:new Date().getTime(),point:I.point})?_.tap(I):_.touchend(I)};const w=I=>{const M=nE(I),N=iE(I),j=TR(I);return!(M||N||j)};c.keydown=function(I){(I.srcElement||I.target).classList.contains(Xo.CANVAS)&&((nE(I)||iE(I))&&e.options.controls.trash?(I.preventDefault(),_.trash()):w(I)?_.keydown(I):bR(I)&&e.options.controls.point?a(Ur.DRAW_POINT):wR(I)&&e.options.controls.line_string?a(Ur.DRAW_LINE_STRING):ER(I)&&e.options.controls.polygon&&a(Ur.DRAW_POLYGON))},c.keyup=function(I){w(I)&&_.keyup(I)},c.zoomend=function(){e.store.changeZoom()},c.data=function(I){if(I.dataType==="style"){const{setup:M,map:N,options:j,store:W}=e;j.styles.some(k=>N.getLayer(k.id))||(M.addLayers(),W.setDirty(),W.render())}};function a(I,M,N={}){_.stop();const j=t[I];if(j===void 0)throw new Error(`${I} is not valid`);d=I;const W=j(e,M);_=lE(W,e),N.silent||e.map.fire(Lo.MODE_CHANGE,{mode:I}),e.store.setDirty(),e.store.render()}const S={trash:!1,combineFeatures:!1,uncombineFeatures:!1};function D(I){let M=!1;Object.keys(I).forEach(N=>{if(S[N]===void 0)throw new Error("Invalid action type");S[N]!==I[N]&&(M=!0),S[N]=I[N]}),M&&e.map.fire(Lo.ACTIONABLE,{actions:S})}return{start(){d=e.options.defaultMode,_=lE(t[d](e),e)},changeMode:a,actionable:D,currentModeName(){return d},currentModeRender(I,M){return _.render(I,M)},fire(I,M){e.map&&e.map.fire(I,M)},addEventListeners(){e.map.on("mousemove",c.mousemove),e.map.on("mousedown",c.mousedown),e.map.on("mouseup",c.mouseup),e.map.on("data",c.data),e.map.on("touchmove",c.touchmove),e.map.on("touchstart",c.touchstart),e.map.on("touchend",c.touchend),e.container.addEventListener("mouseout",c.mouseout),e.options.keybindings&&(e.container.addEventListener("keydown",c.keydown),e.container.addEventListener("keyup",c.keyup))},removeEventListeners(){e.map.off("mousemove",c.mousemove),e.map.off("mousedown",c.mousedown),e.map.off("mouseup",c.mouseup),e.map.off("data",c.data),e.map.off("touchmove",c.touchmove),e.map.off("touchstart",c.touchstart),e.map.off("touchend",c.touchend),e.container.removeEventListener("mouseout",c.mouseout),e.options.keybindings&&(e.container.removeEventListener("keydown",c.keydown),e.container.removeEventListener("keyup",c.keyup))},trash(I){_.trash(I)},combineFeatures(){_.combineFeatures()},uncombineFeatures(){_.uncombineFeatures()},getMode(){return d}}}function $m(e){return[].concat(e).filter(t=>t!==void 0)}function iV(){const e=this;if(!(e.ctx.map&&e.ctx.map.getSource(Ps.HOT)!==void 0))return a();const n=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:n});let l=[],c=[];e.isDirty?c=e.getAllIds():(l=e.getChangedIds().filter(S=>e.get(S)!==void 0),c=e.sources.hot.filter(S=>S.properties.id&&l.indexOf(S.properties.id)===-1&&e.get(S.properties.id)!==void 0).map(S=>S.properties.id)),e.sources.hot=[];const d=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter(S=>{const D=S.properties.id||S.properties.parent;return l.indexOf(D)===-1});const _=d!==e.sources.cold.length||c.length>0;l.forEach(S=>w(S,"hot")),c.forEach(S=>w(S,"cold"));function w(S,D){const I=e.get(S).internal(n);e.ctx.events.currentModeRender(I,M=>{M.properties.mode=n,e.sources[D].push(M)})}_&&e.ctx.map.getSource(Ps.COLD).setData({type:rr.FEATURE_COLLECTION,features:e.sources.cold}),e.ctx.map.getSource(Ps.HOT).setData({type:rr.FEATURE_COLLECTION,features:e.sources.hot}),a();function a(){e.isDirty=!1,e.clearChangedIds()}}function Cn(e){this._features={},this._featureIds=new Os,this._selectedFeatureIds=new Os,this._selectedCoordinates=[],this._changedFeatureIds=new Os,this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]};let t;this.render=()=>{t||(t=requestAnimationFrame(()=>{t=null,iV.call(this),this._emitSelectionChange&&(this.ctx.events.fire(Lo.SELECTION_CHANGE,{features:this.getSelected().map(n=>n.toGeoJSON()),points:this.getSelectedCoordinates().map(n=>({type:rr.FEATURE,properties:{},geometry:{type:rr.POINT,coordinates:n.coordinates}}))}),this._emitSelectionChange=!1),this.ctx.events.fire(Lo.RENDER,{})}))},this.isDirty=!1}Cn.prototype.createRenderBatch=function(){const e=this.render;let t=0;return this.render=function(){t++},()=>{this.render=e,t>0&&this.render()}};Cn.prototype.setDirty=function(){return this.isDirty=!0,this};Cn.prototype.featureCreated=function(e,t={}){if(this._changedFeatureIds.add(e),(t.silent!=null?t.silent:this.ctx.options.suppressAPIEvents)!==!0){const l=this.get(e);this.ctx.events.fire(Lo.CREATE,{features:[l.toGeoJSON()]})}return this};Cn.prototype.featureChanged=function(e,t={}){return this._changedFeatureIds.add(e),(t.silent!=null?t.silent:this.ctx.options.suppressAPIEvents)!==!0&&this.ctx.events.fire(Lo.UPDATE,{action:t.action?t.action:Nm.CHANGE_COORDINATES,features:[this.get(e).toGeoJSON()]}),this};Cn.prototype.getChangedIds=function(){return this._changedFeatureIds.values()};Cn.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this};Cn.prototype.getAllIds=function(){return this._featureIds.values()};Cn.prototype.add=function(e,t={}){return this._features[e.id]=e,this._featureIds.add(e.id),this.featureCreated(e.id,{silent:t.silent}),this};Cn.prototype.delete=function(e,t={}){const n=[];return $m(e).forEach(l=>{this._featureIds.has(l)&&(this._featureIds.delete(l),this._selectedFeatureIds.delete(l),t.silent||n.indexOf(this._features[l])===-1&&n.push(this._features[l].toGeoJSON()),delete this._features[l],this.isDirty=!0)}),n.length&&this.ctx.events.fire(Lo.DELETE,{features:n}),PR(this,t),this};Cn.prototype.get=function(e){return this._features[e]};Cn.prototype.getAll=function(){return Object.keys(this._features).map(e=>this._features[e])};Cn.prototype.select=function(e,t={}){return $m(e).forEach(n=>{this._selectedFeatureIds.has(n)||(this._selectedFeatureIds.add(n),this._changedFeatureIds.add(n),t.silent||(this._emitSelectionChange=!0))}),this};Cn.prototype.deselect=function(e,t={}){return $m(e).forEach(n=>{this._selectedFeatureIds.has(n)&&(this._selectedFeatureIds.delete(n),this._changedFeatureIds.add(n),t.silent||(this._emitSelectionChange=!0))}),PR(this,t),this};Cn.prototype.clearSelected=function(e={}){return this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this};Cn.prototype.setSelected=function(e,t={}){return e=$m(e),this.deselect(this._selectedFeatureIds.values().filter(n=>e.indexOf(n)===-1),{silent:t.silent}),this.select(e.filter(n=>!this._selectedFeatureIds.has(n)),{silent:t.silent}),this};Cn.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this};Cn.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this};Cn.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()};Cn.prototype.getSelected=function(){return this.getSelectedIds().map(e=>this.get(e))};Cn.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(t=>({coordinates:this.get(t.feature_id).getCoordinate(t.coord_path)}))};Cn.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)};Cn.prototype.setFeatureProperty=function(e,t,n,l={}){this.get(e).setProperty(t,n),this.featureChanged(e,{silent:l.silent,action:Nm.CHANGE_PROPERTIES})};function PR(e,t={}){const n=e._selectedCoordinates.filter(l=>e._selectedFeatureIds.has(l.feature_id));e._selectedCoordinates.length!==n.length&&!t.silent&&(e._emitSelectionChange=!0),e._selectedCoordinates=n}Cn.prototype.storeMapConfig=function(){_R.forEach(e=>{this.ctx.map[e]&&(this._mapInitialConfig[e]=this.ctx.map[e].isEnabled())})};Cn.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(e=>{this._mapInitialConfig[e]?this.ctx.map[e].enable():this.ctx.map[e].disable()})};Cn.prototype.getInitialConfigValue=function(e){return this._mapInitialConfig[e]!==void 0?this._mapInitialConfig[e]:!0};const oV=["mode","feature","mouse"];function sV(e){const t={};let n=null,l={mode:null,feature:null,mouse:null},c={mode:null,feature:null,mouse:null};function d(){_({mode:null,feature:null,mouse:null}),w()}function _(M){c=Object.assign(c,M)}function w(){if(!e.container)return;const M=[],N=[];oV.forEach(j=>{c[j]!==l[j]&&(M.push(`${j}-${l[j]}`),c[j]!==null&&N.push(`${j}-${c[j]}`))}),M.length>0&&e.container.classList.remove(...M),N.length>0&&e.container.classList.add(...N),l=Object.assign(l,c)}function a(M,N={}){const j=document.createElement("button");return j.className=`${Xo.CONTROL_BUTTON} ${N.className}`,j.setAttribute("title",N.title),N.container.appendChild(j),j.addEventListener("click",W=>{if(W.preventDefault(),W.stopPropagation(),W.target===n){S(),N.onDeactivate();return}D(M),N.onActivate()},!0),j}function S(){n&&(n.classList.remove(Xo.ACTIVE_BUTTON),n=null)}function D(M){S();const N=t[M];N&&N&&M!=="trash"&&(N.classList.add(Xo.ACTIVE_BUTTON),n=N)}function R(){const M=e.options.controls,N=document.createElement("div");return N.className=`${Xo.CONTROL_GROUP} ${Xo.CONTROL_BASE}`,M&&(M[Ko.POINT]&&(t[Ko.POINT]=a(Ko.POINT,{container:N,className:Xo.CONTROL_BUTTON_POINT,title:`Marker tool ${e.options.keybindings?"(1)":""}`,onActivate:()=>e.events.changeMode(Ur.DRAW_POINT),onDeactivate:()=>e.events.trash()})),M[Ko.LINE]&&(t[Ko.LINE]=a(Ko.LINE,{container:N,className:Xo.CONTROL_BUTTON_LINE,title:`LineString tool ${e.options.keybindings?"(2)":""}`,onActivate:()=>e.events.changeMode(Ur.DRAW_LINE_STRING),onDeactivate:()=>e.events.trash()})),M[Ko.POLYGON]&&(t[Ko.POLYGON]=a(Ko.POLYGON,{container:N,className:Xo.CONTROL_BUTTON_POLYGON,title:`Polygon tool ${e.options.keybindings?"(3)":""}`,onActivate:()=>e.events.changeMode(Ur.DRAW_POLYGON),onDeactivate:()=>e.events.trash()})),M.trash&&(t.trash=a("trash",{container:N,className:Xo.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{e.events.trash()}})),M.combine_features&&(t.combine_features=a("combineFeatures",{container:N,className:Xo.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{e.events.combineFeatures()}})),M.uncombine_features&&(t.uncombine_features=a("uncombineFeatures",{container:N,className:Xo.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{e.events.uncombineFeatures()}}))),N}function I(){Object.keys(t).forEach(M=>{const N=t[M];N.parentNode&&N.parentNode.removeChild(N),delete t[M]})}return{setActiveButton:D,queueMapClasses:_,updateMapClasses:w,clearMapClasses:d,addButtons:R,removeButtons:I}}function aV(e){let t=null,n=null;const l={onRemove(){return e.map.off("load",l.connect),clearInterval(n),l.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.boxZoomInitial&&e.map.boxZoom.enable(),e.map=null,e.container=null,e.store=null,t&&t.parentNode&&t.parentNode.removeChild(t),t=null,this},connect(){e.map.off("load",l.connect),clearInterval(n),l.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd(c){if(e.map=c,e.events=nV(e),e.ui=sV(e),e.container=c.getContainer(),e.store=new Cn(e),t=e.ui.addButtons(),e.options.boxSelect){e.boxZoomInitial=c.boxZoom.isEnabled(),c.boxZoom.disable();const d=c.dragPan.isEnabled();c.dragPan.disable(),c.dragPan.enable(),d||c.dragPan.disable()}return c.loaded()?l.connect():(c.on("load",l.connect),n=setInterval(()=>{c.loaded()&&l.connect()},16)),e.events.start(),t},addLayers(){e.map.addSource(Ps.COLD,{data:{type:rr.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(Ps.HOT,{data:{type:rr.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach(c=>{e.map.addLayer(c)}),e.store.setDirty(!0),e.store.render()},removeLayers(){e.options.styles.forEach(c=>{e.map.getLayer(c.id)&&e.map.removeLayer(c.id)}),e.map.getSource(Ps.COLD)&&e.map.removeSource(Ps.COLD),e.map.getSource(Ps.HOT)&&e.map.removeSource(Ps.HOT)}};return e.setup=l,l}const x1="#3bb2d0",Op="#fbb03b",mP="#fff",kR=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],Op,x1],"fill-opacity":.1}},{id:"gl-draw-lines",type:"line",filter:["any",["==","$type","LineString"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","active"],"true"],Op,x1],"line-dasharray":["case",["==",["get","active"],"true"],[.2,2],[2,0]],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":mP}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],Op,x1]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":mP}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":Op}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":Op}}];function mu(e,t){this.x=e,this.y=t}mu.prototype={clone(){return new mu(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,t){return this.clone()._rotateAround(e,t)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult(e){const t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const t=Math.cos(e),n=Math.sin(e),l=t*this.x-n*this.y,c=n*this.x+t*this.y;return this.x=l,this.y=c,this},_rotateAround(e,t){const n=Math.cos(e),l=Math.sin(e),c=t.x+n*(this.x-t.x)-l*(this.y-t.y),d=t.y+l*(this.x-t.x)+n*(this.y-t.y);return this.x=c,this.y=d,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:mu};mu.convert=function(e){if(e instanceof mu)return e;if(Array.isArray(e))return new mu(+e[0],+e[1]);if(e.x!==void 0&&e.y!==void 0)return new mu(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};function HT(e,t){const n=t.getBoundingClientRect();return new mu(e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0))}function Vf(e,t,n,l){return{type:rr.FEATURE,properties:{meta:yo.VERTEX,parent:e,coord_path:n,active:l?Vi.ACTIVE:Vi.INACTIVE},geometry:{type:rr.POINT,coordinates:t}}}function lV(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function LR(e,t,n){if(e!==null)for(var l,c,d,_,w,a,S,D=0,R=0,I,M=e.type,N=M==="FeatureCollection",j=M==="Feature",W=N?e.features.length:1,B=0;B<W;B++){S=N?e.features[B].geometry:j?e.geometry:e,I=S?S.type==="GeometryCollection":!1,w=I?S.geometries.length:1;for(var k=0;k<w;k++){var z=0,Z=0;if(_=I?S.geometries[k]:S,_!==null){a=_.coordinates;var ee=_.type;switch(D=0,ee){case null:break;case"Point":if(t(a,R,B,z,Z)===!1)return!1;R++,z++;break;case"LineString":case"MultiPoint":for(l=0;l<a.length;l++){if(t(a[l],R,B,z,Z)===!1)return!1;R++,ee==="MultiPoint"&&z++}ee==="LineString"&&z++;break;case"Polygon":case"MultiLineString":for(l=0;l<a.length;l++){for(c=0;c<a[l].length-D;c++){if(t(a[l][c],R,B,z,Z)===!1)return!1;R++}ee==="MultiLineString"&&z++,ee==="Polygon"&&Z++}ee==="Polygon"&&z++;break;case"MultiPolygon":for(l=0;l<a.length;l++){for(Z=0,c=0;c<a[l].length;c++){for(d=0;d<a[l][c].length-D;d++){if(t(a[l][c][d],R,B,z,Z)===!1)return!1;R++}Z++}z++}break;case"GeometryCollection":for(l=0;l<_.geometries.length;l++)if(LR(_.geometries[l],t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function uV(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return OR(e);case"FeatureCollection":return cV(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return XT(e);default:throw new Error("unknown GeoJSON type")}}function OR(e){const t={type:"Feature"};return Object.keys(e).forEach(n=>{switch(n){case"type":case"properties":case"geometry":return;default:t[n]=e[n]}}),t.properties=DR(e.properties),e.geometry==null?t.geometry=null:t.geometry=XT(e.geometry),t}function DR(e){const t={};return e&&Object.keys(e).forEach(n=>{const l=e[n];typeof l=="object"?l===null?t[n]=null:Array.isArray(l)?t[n]=l.map(c=>c):t[n]=DR(l):t[n]=l}),t}function cV(e){const t={type:"FeatureCollection"};return Object.keys(e).forEach(n=>{switch(n){case"type":case"features":return;default:t[n]=e[n]}}),t.features=e.features.map(n=>OR(n)),t}function XT(e){const t={type:e.type};return e.bbox&&(t.bbox=e.bbox),e.type==="GeometryCollection"?(t.geometries=e.geometries.map(n=>XT(n)),t):(t.coordinates=RR(e.coordinates),t)}function RR(e){const t=e;return typeof t[0]!="object"?t.slice():t.map(n=>RR(n))}function gP(e,t={}){return zR(e,"mercator",t)}function hV(e,t={}){return zR(e,"wgs84",t)}function zR(e,t,n={}){n=n||{};var l=n.mutate;if(!e)throw new Error("geojson is required");return Array.isArray(e)&&lV(e[0])?e=t==="mercator"?yP(e):_P(e):(l!==!0&&(e=uV(e)),LR(e,function(c){var d=t==="mercator"?yP(c):_P(c);c[0]=d[0],c[1]=d[1]})),e}function yP(e){var t=Math.PI/180,n=6378137,l=20037508342789244e-9,c=Math.abs(e[0])<=180?e[0]:e[0]-fV(e[0])*360,d=[n*c*t,n*Math.log(Math.tan(Math.PI*.25+.5*e[1]*t))];return d[0]>l&&(d[0]=l),d[0]<-l&&(d[0]=-l),d[1]>l&&(d[1]=l),d[1]<-l&&(d[1]=-l),d}function _P(e){var t=180/Math.PI,n=6378137;return[e[0]*t/n,(Math.PI*.5-2*Math.atan(Math.exp(-e[1]/n)))*t]}function fV(e){return e<0?-1:e>0?1:0}function FR(e,t,n){const l=t.geometry.coordinates,c=n.geometry.coordinates;if(l[1]>rE||l[1]<tE||c[1]>rE||c[1]<tE)return null;const d=gP(l),_=gP(c),w=R=>Number(R.toFixed(8)),a=(R,I)=>(R+I)/2,S=hV([a(d[0],_[0]),a(d[1],_[1])]),D=[w(S[0]),w(S[1])];return{type:rr.FEATURE,properties:{meta:yo.MIDPOINT,parent:e,lng:D[0],lat:D[1],coord_path:n.properties.coord_path},geometry:{type:rr.POINT,coordinates:D}}}function zv(e,t={},n=null){const{type:l,coordinates:c}=e.geometry,d=e.properties&&e.properties.id;let _=[];l===rr.POINT?_.push(Vf(d,c,n,a(n))):l===rr.POLYGON?c.forEach((D,R)=>{w(D,n!==null?`${n}.${R}`:String(R))}):l===rr.LINE_STRING?w(c,n):l.indexOf(rr.MULTI_PREFIX)===0&&S();function w(D,R){let I="",M=null;D.forEach((N,j)=>{const W=R!=null?`${R}.${j}`:String(j),B=Vf(d,N,W,a(W));if(t.midpoints&&M){const z=FR(d,M,B);z&&_.push(z)}M=B;const k=JSON.stringify(N);I!==k&&_.push(B),j===0&&(I=k)})}function a(D){return t.selectedPaths?t.selectedPaths.indexOf(D)!==-1:!1}function S(){const D=l.replace(rr.MULTI_PREFIX,"");c.forEach((R,I)=>{const M={type:rr.FEATURE,properties:e.properties,geometry:{type:D,coordinates:R}};_=_.concat(zv(M,t,I))})}return _}const aa={enable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||!e._ctx||!e._ctx.store||!e._ctx.store.getInitialConfigValue||e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||e.map.doubleClickZoom.disable()},0)}},{LAT_MIN:My,LAT_MAX:Py,LAT_RENDERED_MIN:vP,LAT_RENDERED_MAX:xP,LNG_MIN:bP,LNG_MAX:wP}=vR;function dV(e){const t={Point:0,LineString:1,Polygon:2,MultiPoint:1,MultiLineString:2,MultiPolygon:3}[e.geometry.type],n=[e.geometry.coordinates].flat(t),l=n.map(w=>w[0]),c=n.map(w=>w[1]),d=w=>Math.min.apply(null,w),_=w=>Math.max.apply(null,w);return[d(l),d(c),_(l),_(c)]}function KT(e,t){let n=My,l=Py,c=My,d=Py,_=wP,w=bP;e.forEach(S=>{const D=dV(S),R=D[1],I=D[3],M=D[0],N=D[2];R>n&&(n=R),I<l&&(l=I),I>c&&(c=I),R<d&&(d=R),M<_&&(_=M),N>w&&(w=N)});const a=t;return n+a.lat>xP&&(a.lat=xP-n),c+a.lat>Py&&(a.lat=Py-c),l+a.lat<vP&&(a.lat=vP-l),d+a.lat<My&&(a.lat=My-d),_+a.lng<=bP&&(a.lng+=Math.ceil(Math.abs(a.lng)/360)*360),w+a.lng>=wP&&(a.lng-=Math.ceil(Math.abs(a.lng)/360)*360),a}function YT(e,t){const n=KT(e.map(l=>l.toGeoJSON()),t);e.forEach(l=>{const c=l.getCoordinates(),d=S=>{const D={lng:S[0]+n.lng,lat:S[1]+n.lat};return[D.lng,D.lat]},_=S=>S.map(D=>d(D)),w=S=>S.map(D=>_(D));let a;l.type===rr.POINT?a=d(c):l.type===rr.LINE_STRING||l.type===rr.MULTI_POINT?a=c.map(d):l.type===rr.POLYGON||l.type===rr.MULTI_LINE_STRING?a=c.map(_):l.type===rr.MULTI_POLYGON&&(a=c.map(w)),l.incomingCoords(a)})}const gn={};gn.onSetup=function(e){const t={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initialDragPanState:this.map.dragPan.isEnabled(),initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(t.initiallySelectedFeatureIds.filter(n=>this.getFeature(n)!==void 0)),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),t};gn.fireUpdate=function(){this.fire(Lo.UPDATE,{action:Nm.MOVE,features:this.getSelected().map(e=>e.toGeoJSON())})};gn.fireActionable=function(){const e=this.getSelected(),t=e.filter(d=>this.isInstanceOf("MultiFeature",d));let n=!1;if(e.length>1){n=!0;const d=e[0].type.replace("Multi","");e.forEach(_=>{_.type.replace("Multi","")!==d&&(n=!1)})}const l=t.length>0,c=e.length>0;this.setActionableState({combineFeatures:n,uncombineFeatures:l,trash:c})};gn.getUniqueIds=function(e){return e.length?e.map(n=>n.properties.id).filter(n=>n!==void 0).reduce((n,l)=>(n.add(l),n),new Os).values():[]};gn.stopExtendedInteractions=function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),(e.canDragMove||e.canBoxSelect)&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1};gn.onStop=function(){aa.enable(this)};gn.onMouseMove=function(e,t){return qT(t)&&e.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(e),!0};gn.onMouseOut=function(e){return e.dragMoving?this.fireUpdate():!0};gn.onTap=gn.onClick=function(e,t){if(Pv(t))return this.clickAnywhere(e,t);if(Mv(yo.VERTEX)(t))return this.clickOnVertex(e,t);if(qT(t))return this.clickOnFeature(e,t)};gn.clickAnywhere=function(e){const t=this.getSelectedIds();t.length&&(this.clearSelectedFeatures(),t.forEach(n=>this.doRender(n))),aa.enable(this),this.stopExtendedInteractions(e)};gn.clickOnVertex=function(e,t){this.changeMode(Ur.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat}),this.updateUIClasses({mouse:Un.MOVE})};gn.startOnActiveFeature=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(t.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=t.lngLat};gn.clickOnFeature=function(e,t){aa.disable(this),this.stopExtendedInteractions(e);const n=j_(t),l=this.getSelectedIds(),c=t.featureTarget.properties.id,d=this.isSelected(c);if(!n&&d&&this.getFeature(c).type!==rr.POINT)return this.changeMode(Ur.DIRECT_SELECT,{featureId:c});d&&n?(this.deselect(c),this.updateUIClasses({mouse:Un.POINTER}),l.length===1&&aa.enable(this)):!d&&n?(this.select(c),this.updateUIClasses({mouse:Un.MOVE})):!d&&!n&&(l.forEach(_=>this.doRender(_)),this.setSelected(c),this.updateUIClasses({mouse:Un.MOVE})),this.doRender(c)};gn.onMouseDown=function(e,t){if(e.initialDragPanState=this.map.dragPan.isEnabled(),Kc(t))return this.startOnActiveFeature(e,t);if(this.drawConfig.boxSelect&&xR(t))return this.startBoxSelect(e,t)};gn.startBoxSelect=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=HT(t.originalEvent,this.map.getContainer()),e.canBoxSelect=!0};gn.onTouchStart=function(e,t){if(Kc(t))return this.startOnActiveFeature(e,t)};gn.onDrag=function(e,t){if(e.canDragMove)return this.dragMove(e,t);if(this.drawConfig.boxSelect&&e.canBoxSelect)return this.whileBoxSelect(e,t)};gn.whileBoxSelect=function(e,t){e.boxSelecting=!0,this.updateUIClasses({mouse:Un.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(Xo.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));const n=HT(t.originalEvent,this.map.getContainer()),l=Math.min(e.boxSelectStartLocation.x,n.x),c=Math.max(e.boxSelectStartLocation.x,n.x),d=Math.min(e.boxSelectStartLocation.y,n.y),_=Math.max(e.boxSelectStartLocation.y,n.y),w=`translate(${l}px, ${d}px)`;e.boxSelectElement.style.transform=w,e.boxSelectElement.style.WebkitTransform=w,e.boxSelectElement.style.width=`${c-l}px`,e.boxSelectElement.style.height=`${_-d}px`};gn.dragMove=function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();const n={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};YT(this.getSelected(),n),e.dragMoveLocation=t.lngLat};gn.onTouchEnd=gn.onMouseUp=function(e,t){if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){const n=[e.boxSelectStartLocation,HT(t.originalEvent,this.map.getContainer())],l=this.featuresAt(null,n,"click"),c=this.getUniqueIds(l).filter(d=>!this.isSelected(d));c.length&&(this.select(c),c.forEach(d=>this.doRender(d)),this.updateUIClasses({mouse:Un.MOVE}))}this.stopExtendedInteractions(e)};gn.toDisplayFeatures=function(e,t,n){t.properties.active=this.isSelected(t.properties.id)?Vi.ACTIVE:Vi.INACTIVE,n(t),this.fireActionable(),!(t.properties.active!==Vi.ACTIVE||t.geometry.type===rr.POINT)&&zv(t).forEach(n)};gn.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()};gn.onCombineFeatures=function(){const e=this.getSelected();if(e.length===0||e.length<2)return;const t=[],n=[],l=e[0].type.replace("Multi","");for(let c=0;c<e.length;c++){const d=e[c];if(d.type.replace("Multi","")!==l)return;d.type.includes("Multi")?d.getCoordinates().forEach(_=>{t.push(_)}):t.push(d.getCoordinates()),n.push(d.toGeoJSON())}if(n.length>1){const c=this.newFeature({type:rr.FEATURE,properties:n[0].properties,geometry:{type:`Multi${l}`,coordinates:t}});this.addFeature(c),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([c.id]),this.fire(Lo.COMBINE_FEATURES,{createdFeatures:[c.toGeoJSON()],deletedFeatures:n})}this.fireActionable()};gn.onUncombineFeatures=function(){const e=this.getSelected();if(e.length===0)return;const t=[],n=[];for(let l=0;l<e.length;l++){const c=e[l];this.isInstanceOf("MultiFeature",c)&&(c.getFeatures().forEach(d=>{this.addFeature(d),d.properties=c.properties,t.push(d.toGeoJSON()),this.select([d.id])}),this.deleteFeature(c.id,{silent:!0}),n.push(c.toGeoJSON()))}t.length>1&&this.fire(Lo.UNCOMBINE_FEATURES,{createdFeatures:t,deletedFeatures:n}),this.fireActionable()};const BR=Mv(yo.VERTEX),NR=Mv(yo.MIDPOINT),yn={};yn.fireUpdate=function(){this.fire(Lo.UPDATE,{action:Nm.CHANGE_COORDINATES,features:this.getSelected().map(e=>e.toGeoJSON())})};yn.fireActionable=function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})};yn.startDragging=function(e,t){e.initialDragPanState==null&&(e.initialDragPanState=this.map.dragPan.isEnabled()),this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=t.lngLat};yn.stopDragging=function(e){e.canDragMove&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.initialDragPanState=null,e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null};yn.onVertex=function(e,t){this.startDragging(e,t);const n=t.featureTarget.properties,l=e.selectedCoordPaths.indexOf(n.coord_path);!j_(t)&&l===-1?e.selectedCoordPaths=[n.coord_path]:j_(t)&&l===-1&&e.selectedCoordPaths.push(n.coord_path);const c=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(c)};yn.onMidpoint=function(e,t){this.startDragging(e,t);const n=t.featureTarget.properties;e.feature.addCoordinate(n.coord_path,n.lng,n.lat),this.fireUpdate(),e.selectedCoordPaths=[n.coord_path]};yn.pathsToCoordinates=function(e,t){return t.map(n=>({feature_id:e,coord_path:n}))};yn.onFeature=function(e,t){e.selectedCoordPaths.length===0?this.startDragging(e,t):this.stopDragging(e)};yn.dragFeature=function(e,t,n){YT(this.getSelected(),n),e.dragMoveLocation=t.lngLat};yn.dragVertex=function(e,t,n){const l=e.selectedCoordPaths.map(_=>e.feature.getCoordinate(_)),c=l.map(_=>({type:rr.FEATURE,properties:{},geometry:{type:rr.POINT,coordinates:_}})),d=KT(c,n);for(let _=0;_<l.length;_++){const w=l[_];e.feature.updateCoordinate(e.selectedCoordPaths[_],w[0]+d.lng,w[1]+d.lat)}};yn.clickNoTarget=function(){this.changeMode(Ur.SIMPLE_SELECT)};yn.clickInactive=function(){this.changeMode(Ur.SIMPLE_SELECT)};yn.clickActiveFeature=function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()};yn.onSetup=function(e){const t=e.featureId,n=this.getFeature(t);if(!n)throw new Error("You must provide a featureId to enter direct_select mode");if(n.type===rr.POINT)throw new TypeError("direct_select mode doesn't handle point features");const l={featureId:t,feature:n,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(t,l.selectedCoordPaths)),this.setSelected(t),aa.disable(this),this.setActionableState({trash:!0}),l};yn.onStop=function(){aa.enable(this),this.clearSelectedCoordinates()};yn.toDisplayFeatures=function(e,t,n){e.featureId===t.properties.id?(t.properties.active=Vi.ACTIVE,n(t),zv(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(n)):(t.properties.active=Vi.INACTIVE,n(t)),this.fireActionable(e)};yn.onTrash=function(e){e.selectedCoordPaths.sort((t,n)=>n.localeCompare(t,"en",{numeric:!0})).forEach(t=>e.feature.removeCoordinate(t)),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),e.feature.isValid()===!1&&(this.deleteFeature([e.featureId]),this.changeMode(Ur.SIMPLE_SELECT,{}))};yn.onMouseMove=function(e,t){const n=Kc(t),l=BR(t),c=NR(t),d=e.selectedCoordPaths.length===0;return n&&d?this.updateUIClasses({mouse:Un.MOVE}):l&&!d?this.updateUIClasses({mouse:Un.MOVE}):this.updateUIClasses({mouse:Un.NONE}),(l||n||c)&&e.dragMoving&&this.fireUpdate(),this.stopDragging(e),!0};yn.onMouseOut=function(e){return e.dragMoving&&this.fireUpdate(),!0};yn.onTouchStart=yn.onMouseDown=function(e,t){if(BR(t))return this.onVertex(e,t);if(Kc(t))return this.onFeature(e,t);if(NR(t))return this.onMidpoint(e,t)};yn.onDrag=function(e,t){if(e.canDragMove!==!0)return;e.dragMoving=!0,t.originalEvent.stopPropagation();const n={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,t,n):this.dragFeature(e,t,n),e.dragMoveLocation=t.lngLat};yn.onClick=function(e,t){if(Pv(t))return this.clickNoTarget(e,t);if(Kc(t))return this.clickActiveFeature(e,t);if(GT(t))return this.clickInactive(e,t);this.stopDragging(e)};yn.onTap=function(e,t){if(Pv(t))return this.clickNoTarget(e,t);if(Kc(t))return this.clickActiveFeature(e,t);if(GT(t))return this.clickInactive(e,t)};yn.onTouchEnd=yn.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};const $a={};$a.onSetup=function(){const e=this.newFeature({type:rr.FEATURE,properties:{},geometry:{type:rr.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:Un.ADD}),this.activateUIButton(Ko.POINT),this.setActionableState({trash:!0}),{point:e}};$a.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(Ur.SIMPLE_SELECT)};$a.onTap=$a.onClick=function(e,t){this.updateUIClasses({mouse:Un.MOVE}),e.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat),this.fire(Lo.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(Ur.SIMPLE_SELECT,{featureIds:[e.point.id]})};$a.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})};$a.toDisplayFeatures=function(e,t,n){const l=t.properties.id===e.point.id;if(t.properties.active=l?Vi.ACTIVE:Vi.INACTIVE,!l)return n(t)};$a.onTrash=$a.stopDrawingAndRemove;$a.onKeyUp=function(e,t){if(kv(t)||Lv(t))return this.stopDrawingAndRemove(e,t)};function V_(e,t){return e.lngLat?e.lngLat.lng===t[0]&&e.lngLat.lat===t[1]:!1}const la={};la.onSetup=function(){const e=this.newFeature({type:rr.FEATURE,properties:{},geometry:{type:rr.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),aa.disable(this),this.updateUIClasses({mouse:Un.ADD}),this.activateUIButton(Ko.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}};la.clickAnywhere=function(e,t){if(e.currentVertexPosition>0&&V_(t,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(Ur.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:Un.ADD}),e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat)};la.clickOnVertex=function(e){return this.changeMode(Ur.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};la.onMouseMove=function(e,t){e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),Um(t)&&this.updateUIClasses({mouse:Un.POINTER})};la.onTap=la.onClick=function(e,t){return Um(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)};la.onKeyUp=function(e,t){kv(t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(Ur.SIMPLE_SELECT)):Lv(t)&&this.changeMode(Ur.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};la.onStop=function(e){this.updateUIClasses({mouse:Un.NONE}),aa.enable(this),this.activateUIButton(),this.getFeature(e.polygon.id)!==void 0&&(e.polygon.removeCoordinate(`0.${e.currentVertexPosition}`),e.polygon.isValid()?this.fire(Lo.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(Ur.SIMPLE_SELECT,{},{silent:!0})))};la.toDisplayFeatures=function(e,t,n){const l=t.properties.id===e.polygon.id;if(t.properties.active=l?Vi.ACTIVE:Vi.INACTIVE,!l)return n(t);if(t.geometry.coordinates.length===0)return;const c=t.geometry.coordinates[0].length;if(!(c<3)){if(t.properties.meta=yo.FEATURE,n(Vf(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),c>3){const d=t.geometry.coordinates[0].length-3;n(Vf(e.polygon.id,t.geometry.coordinates[0][d],`0.${d}`,!1))}if(c<=4){const d=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(n({type:rr.FEATURE,properties:t.properties,geometry:{coordinates:d,type:rr.LINE_STRING}}),c===3)return}return n(t)}};la.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(Ur.SIMPLE_SELECT)};const ua={};ua.onSetup=function(e){e=e||{};const t=e.featureId;let n,l,c="forward";if(t){if(n=this.getFeature(t),!n)throw new Error("Could not find a feature with the provided featureId");let d=e.from;if(d&&d.type==="Feature"&&d.geometry&&d.geometry.type==="Point"&&(d=d.geometry),d&&d.type==="Point"&&d.coordinates&&d.coordinates.length===2&&(d=d.coordinates),!d||!Array.isArray(d))throw new Error("Please use the `from` property to indicate which point to continue the line from");const _=n.coordinates.length-1;if(n.coordinates[_][0]===d[0]&&n.coordinates[_][1]===d[1])l=_+1,n.addCoordinate(l,...n.coordinates[_]);else if(n.coordinates[0][0]===d[0]&&n.coordinates[0][1]===d[1])c="backwards",l=0,n.addCoordinate(l,...n.coordinates[0]);else throw new Error("`from` should match the point at either the start or the end of the provided LineString")}else n=this.newFeature({type:rr.FEATURE,properties:{},geometry:{type:rr.LINE_STRING,coordinates:[]}}),l=0,this.addFeature(n);return this.clearSelectedFeatures(),aa.disable(this),this.updateUIClasses({mouse:Un.ADD}),this.activateUIButton(Ko.LINE),this.setActionableState({trash:!0}),{line:n,currentVertexPosition:l,direction:c}};ua.clickAnywhere=function(e,t){if(e.currentVertexPosition>0&&V_(t,e.line.coordinates[e.currentVertexPosition-1])||e.direction==="backwards"&&V_(t,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(Ur.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:Un.ADD}),e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.direction==="forward"?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)};ua.clickOnVertex=function(e){return this.changeMode(Ur.SIMPLE_SELECT,{featureIds:[e.line.id]})};ua.onMouseMove=function(e,t){e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),Um(t)&&this.updateUIClasses({mouse:Un.POINTER})};ua.onTap=ua.onClick=function(e,t){if(Um(t))return this.clickOnVertex(e,t);this.clickAnywhere(e,t)};ua.onKeyUp=function(e,t){Lv(t)?this.changeMode(Ur.SIMPLE_SELECT,{featureIds:[e.line.id]}):kv(t)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(Ur.SIMPLE_SELECT))};ua.onStop=function(e){aa.enable(this),this.activateUIButton(),this.getFeature(e.line.id)!==void 0&&(e.line.removeCoordinate(`${e.currentVertexPosition}`),e.line.isValid()?this.fire(Lo.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(Ur.SIMPLE_SELECT,{},{silent:!0})))};ua.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(Ur.SIMPLE_SELECT)};ua.toDisplayFeatures=function(e,t,n){const l=t.properties.id===e.line.id;if(t.properties.active=l?Vi.ACTIVE:Vi.INACTIVE,!l)return n(t);t.geometry.coordinates.length<2||(t.properties.meta=yo.FEATURE,n(Vf(e.line.id,t.geometry.coordinates[e.direction==="forward"?t.geometry.coordinates.length-2:1],`${e.direction==="forward"?t.geometry.coordinates.length-2:1}`,!1)),n(t))};const UR={simple_select:gn,direct_select:yn,draw_point:$a,draw_polygon:la,draw_line_string:ua},pV={defaultMode:Ur.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:kR,modes:UR,controls:{},userProperties:!1,suppressAPIEvents:!0},mV={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},gV={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function EP(e,t){return e.map(n=>n.source?n:Object.assign({},n,{id:`${n.id}.${t}`,source:t==="hot"?Ps.HOT:Ps.COLD}))}function yV(e={}){let t=Object.assign({},e);return e.controls||(t.controls={}),e.displayControlsDefault===!1?t.controls=Object.assign({},gV,e.controls):t.controls=Object.assign({},mV,e.controls),t=Object.assign({},pV,t),t.styles=EP(t.styles,"cold").concat(EP(t.styles,"hot")),t}var _V=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var l,c,d;if(Array.isArray(t)){if(l=t.length,l!=n.length)return!1;for(c=l;c--!==0;)if(!e(t[c],n[c]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(d=Object.keys(t),l=d.length,l!==Object.keys(n).length)return!1;for(c=l;c--!==0;)if(!Object.prototype.hasOwnProperty.call(n,d[c]))return!1;for(c=l;c--!==0;){var _=d[c];if(!e(t[_],n[_]))return!1}return!0}return t!==t&&n!==n};const TP=Pu(_V);var JT=xV,vV={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function xV(e){if(!e||!e.type)return null;var t=vV[e.type];if(!t)return null;if(t==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]};if(t==="feature")return{type:"FeatureCollection",features:[e]};if(t==="featurecollection")return e}const bV=Pu(JT);function $R(e,t){return e.length!==t.length?!1:JSON.stringify(e.map(n=>n).sort())===JSON.stringify(t.map(n=>n).sort())}const wV={Polygon:_s,LineString:qa,Point:Ru,MultiPolygon:Po,MultiLineString:Po,MultiPoint:Po};function EV(e,t){t.modes=Ur;const n=e.options.suppressAPIEvents!==void 0?!!e.options.suppressAPIEvents:!0;return t.getFeatureIdsAt=function(l){return jf.click({point:l},null,e).map(d=>d.properties.id)},t.getSelectedIds=function(){return e.store.getSelectedIds()},t.getSelected=function(){return{type:rr.FEATURE_COLLECTION,features:e.store.getSelectedIds().map(l=>e.store.get(l)).map(l=>l.toGeoJSON())}},t.getSelectedPoints=function(){return{type:rr.FEATURE_COLLECTION,features:e.store.getSelectedCoordinates().map(l=>({type:rr.FEATURE,properties:{},geometry:{type:rr.POINT,coordinates:l.coordinates}}))}},t.set=function(l){if(l.type===void 0||l.type!==rr.FEATURE_COLLECTION||!Array.isArray(l.features))throw new Error("Invalid FeatureCollection");const c=e.store.createRenderBatch();let d=e.store.getAllIds().slice();const _=t.add(l),w=new Os(_);return d=d.filter(a=>!w.has(a)),d.length&&t.delete(d),c(),_},t.add=function(l){const d=JSON.parse(JSON.stringify(bV(l))).features.map(_=>{if(_.id=_.id||ZT(),_.geometry===null)throw new Error("Invalid geometry: null");if(e.store.get(_.id)===void 0||e.store.get(_.id).type!==_.geometry.type){const w=wV[_.geometry.type];if(w===void 0)throw new Error(`Invalid geometry type: ${_.geometry.type}.`);const a=new w(e,_);e.store.add(a,{silent:n})}else{const w=e.store.get(_.id),a=w.properties;w.properties=_.properties,TP(a,_.properties)||e.store.featureChanged(w.id,{silent:n}),TP(w.getCoordinates(),_.geometry.coordinates)||w.incomingCoords(_.geometry.coordinates)}return _.id});return e.store.render(),d},t.get=function(l){const c=e.store.get(l);if(c)return c.toGeoJSON()},t.getAll=function(){return{type:rr.FEATURE_COLLECTION,features:e.store.getAll().map(l=>l.toGeoJSON())}},t.delete=function(l){return e.store.delete(l,{silent:n}),t.getMode()===Ur.DIRECT_SELECT&&!e.store.getSelectedIds().length?e.events.changeMode(Ur.SIMPLE_SELECT,void 0,{silent:n}):e.store.render(),t},t.deleteAll=function(){return e.store.delete(e.store.getAllIds(),{silent:n}),t.getMode()===Ur.DIRECT_SELECT?e.events.changeMode(Ur.SIMPLE_SELECT,void 0,{silent:n}):e.store.render(),t},t.changeMode=function(l,c={}){return l===Ur.SIMPLE_SELECT&&t.getMode()===Ur.SIMPLE_SELECT?($R(c.featureIds||[],e.store.getSelectedIds())||(e.store.setSelected(c.featureIds,{silent:n}),e.store.render()),t):(l===Ur.DIRECT_SELECT&&t.getMode()===Ur.DIRECT_SELECT&&c.featureId===e.store.getSelectedIds()[0]||e.events.changeMode(l,c,{silent:n}),t)},t.getMode=function(){return e.events.getMode()},t.trash=function(){return e.events.trash({silent:n}),t},t.combineFeatures=function(){return e.events.combineFeatures({silent:n}),t},t.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:n}),t},t.setFeatureProperty=function(l,c,d){return e.store.setFeatureProperty(l,c,d,{silent:n}),t},t}const TV=Object.freeze(Object.defineProperty({__proto__:null,CommonSelectors:jj,ModeHandler:lE,StringSet:Os,constrainFeatureMovement:KT,createMidPoint:FR,createSupplementaryPoints:zv,createVertex:Vf,doubleClickZoom:aa,euclideanDistance:WT,featuresAt:jf,getFeatureAtAndSetCursors:s_,isClick:sE,isEventAtCoordinates:V_,isTap:aE,mapEventToBoundingBox:CR,moveFeatures:YT,sortFeatures:AR,stringSetsAreEqual:$R,theme:kR,toDenseArray:$m},Symbol.toStringTag,{value:"Module"})),SV=function(e,t){e=yV(e);const n={options:e};t=EV(n,t),n.api=t;const l=aV(n);return t.onAdd=l.onAdd,t.onRemove=l.onRemove,t.types=Ko,t.options=e,t};function Sm(e){SV(e,this)}Sm.modes=UR;Sm.constants=vR;Sm.lib=TV;var Ll=CV,AV=Object.prototype.hasOwnProperty;function CV(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var l in n)AV.call(n,l)&&(e[l]=n[l])}return e}var jR={exports:{}};(function(e,t){(function(){var n={};e.exports=n,n.simpleFilter=function(l,c){return c.filter(function(d){return n.test(l,d)})},n.test=function(l,c){return n.match(l,c)!==null},n.match=function(l,c,d){d=d||{};var _=0,w=[],a=c.length,S=0,D=0,R=d.pre||"",I=d.post||"",M=d.caseSensitive&&c||c.toLowerCase(),N;l=d.caseSensitive&&l||l.toLowerCase();for(var j=0;j<a;j++)N=c[j],M[j]===l[_]?(N=R+N+I,_+=1,D+=1+D):D=0,S+=D,w[w.length]=N;return _===l.length?(S=M===l?1/0:S,{rendered:w.join(""),score:S}):null},n.filter=function(l,c,d){return!c||c.length===0?[]:typeof l!="string"?c:(d=d||{},c.reduce(function(_,w,a,S){var D=w;d.extract&&(D=d.extract(w));var R=n.match(l,D,d);return R!=null&&(_[_.length]={string:R.rendered,score:R.score,index:a,original:w}),_},[]).sort(function(_,w){var a=w.score-_.score;return a||_.index-w.index}))}})()})(jR);var IV=jR.exports,rs=function(e){return this.component=e,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,e.el.parentNode.insertBefore(this.wrapper,e.el.nextSibling),this};rs.prototype.show=function(){this.element.style.display="block"};rs.prototype.hide=function(){this.element.style.display="none"};rs.prototype.add=function(e){this.items.push(e)};rs.prototype.clear=function(){this.items=[],this.active=0};rs.prototype.isEmpty=function(){return!this.items.length};rs.prototype.isVisible=function(){return this.element.style.display==="block"};rs.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var e=0;e<this.items.length;e++)this.drawItem(this.items[e],this.active===e);this.show()};rs.prototype.drawItem=function(e,t){var n=document.createElement("li"),l=document.createElement("a");t&&(n.className+=" active"),l.innerHTML=e.string,n.appendChild(l),this.element.appendChild(n),n.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),n.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,e)}).bind(this))};rs.prototype.handleMouseUp=function(e){this.selectingListItem=!1,this.component.value(e.original),this.clear(),this.draw()};rs.prototype.move=function(e){this.active=e,this.draw()};rs.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};rs.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};rs.prototype.drawError=function(e){var t=document.createElement("li");t.innerHTML=e,this.element.appendChild(t),this.show()};var MV=rs,PV=Ll,kV=IV,LV=MV,vo=function(e,t,n){return n=n||{},this.options=PV({minLength:2,limit:5,filter:!0,hideOnBlur:!0},n),this.el=e,this.data=t||[],this.list=new LV(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(l){this.handleKeyUp(l.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(l){this.handleKeyDown(l)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(l){this.handlePaste(l)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};vo.prototype.handleKeyUp=function(e){e===40||e===38||e===27||e===13||e===9||this.handleInputChange(this.el.value)};vo.prototype.handleKeyDown=function(e){switch(e.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&e.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};vo.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};vo.prototype.handlePaste=function(e){if(e.clipboardData)this.handleInputChange(e.clipboardData.getData("Text"));else{var t=this;setTimeout(function(){t.handleInputChange(e.target.value)},100)}};vo.prototype.handleInputChange=function(e){if(this.query=this.normalize(e),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(t){for(var n=0;n<t.length&&(this.list.add(t[n]),n!==this.options.limit-1);n++);this.list.draw()}).bind(this))};vo.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};vo.prototype.update=function(e){this.data=e,this.handleKeyUp()};vo.prototype.clear=function(){this.data=[],this.list.clear()};vo.prototype.normalize=function(e){return e=e.toLowerCase(),e};vo.prototype.match=function(e,t){return e.indexOf(t)>-1};vo.prototype.value=function(e){if(this.selected=e,this.el.value=this.getItemValue(e),document.createEvent){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!1),this.el.dispatchEvent(t)}else this.el.fireEvent("onchange")};vo.prototype.getCandidates=function(e){var t={pre:"<strong>",post:"</strong>",extract:(function(l){return this.getItemValue(l)}).bind(this)},n;this.options.filter?(n=kV.filter(this.query,this.data,t),n=n.map((function(l){return{original:l.original,string:this.render(l.original,l.string)}}).bind(this))):n=this.data.map((function(l){var c=this.render(l);return{original:l,string:c}}).bind(this)),e(n)};vo.prototype.getItemValue=function(e){return e};vo.prototype.render=function(e,t){if(t)return t;for(var n=e.original?this.getItemValue(e.original):this.getItemValue(e),l=this.normalize(n),c=l.lastIndexOf(this.query);c>-1;){var d=c+this.query.length;n=n.slice(0,c)+"<strong>"+n.slice(c,d)+"</strong>"+n.slice(d),c=l.slice(0,c).lastIndexOf(this.query)}return n};vo.prototype.renderError=function(e){this.list.drawError(e)};var OV=vo,VR=OV,DV=VR;typeof window<"u"&&(window.Suggestions=VR);var RV="Expected a function",SP=NaN,zV="[object Symbol]",FV=/^\s+|\s+$/g,BV=/^[-+]0x[0-9a-f]+$/i,NV=/^0b[01]+$/i,UV=/^0o[0-7]+$/i,$V=parseInt,jV=typeof window=="object"&&window&&window.Object===Object&&window,VV=typeof self=="object"&&self&&self.Object===Object&&self,GV=jV||VV||Function("return this")(),qV=Object.prototype,WV=qV.toString,ZV=Math.max,HV=Math.min,b1=function(){return GV.Date.now()};function XV(e,t,n){var l,c,d,_,w,a,S=0,D=!1,R=!1,I=!0;if(typeof e!="function")throw new TypeError(RV);t=AP(t)||0,uE(n)&&(D=!!n.leading,R="maxWait"in n,d=R?ZV(AP(n.maxWait)||0,t):d,I="trailing"in n?!!n.trailing:I);function M(se){var ue=l,Te=c;return l=c=void 0,S=se,_=e.apply(Te,ue),_}function N(se){return S=se,w=setTimeout(B,t),D?M(se):_}function j(se){var ue=se-a,Te=se-S,Q=t-ue;return R?HV(Q,d-Te):Q}function W(se){var ue=se-a,Te=se-S;return a===void 0||ue>=t||ue<0||R&&Te>=d}function B(){var se=b1();if(W(se))return k(se);w=setTimeout(B,j(se))}function k(se){return w=void 0,I&&l?M(se):(l=c=void 0,_)}function z(){w!==void 0&&clearTimeout(w),S=0,l=a=c=w=void 0}function Z(){return w===void 0?_:k(b1())}function ee(){var se=b1(),ue=W(se);if(l=arguments,c=this,a=se,ue){if(w===void 0)return N(a);if(R)return w=setTimeout(B,t),M(a)}return w===void 0&&(w=setTimeout(B,t)),_}return ee.cancel=z,ee.flush=Z,ee}function uE(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function KV(e){return!!e&&typeof e=="object"}function YV(e){return typeof e=="symbol"||KV(e)&&WV.call(e)==zV}function AP(e){if(typeof e=="number")return e;if(YV(e))return SP;if(uE(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=uE(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(FV,"");var n=NV.test(e);return n||UV.test(e)?$V(e.slice(2),n?2:8):BV.test(e)?SP:+e}var JV=XV,QT={exports:{}},Mf=typeof Reflect=="object"?Reflect:null,CP=Mf&&typeof Mf.apply=="function"?Mf.apply:function(t,n,l){return Function.prototype.apply.call(t,n,l)},a_;Mf&&typeof Mf.ownKeys=="function"?a_=Mf.ownKeys:Object.getOwnPropertySymbols?a_=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:a_=function(t){return Object.getOwnPropertyNames(t)};function QV(e){console&&console.warn&&console.warn(e)}var GR=Number.isNaN||function(t){return t!==t};function pn(){pn.init.call(this)}QT.exports=pn;QT.exports.once=nG;pn.EventEmitter=pn;pn.prototype._events=void 0;pn.prototype._eventsCount=0;pn.prototype._maxListeners=void 0;var IP=10;function Fv(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(pn,"defaultMaxListeners",{enumerable:!0,get:function(){return IP},set:function(e){if(typeof e!="number"||e<0||GR(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");IP=e}});pn.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};pn.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||GR(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function qR(e){return e._maxListeners===void 0?pn.defaultMaxListeners:e._maxListeners}pn.prototype.getMaxListeners=function(){return qR(this)};pn.prototype.emit=function(t){for(var n=[],l=1;l<arguments.length;l++)n.push(arguments[l]);var c=t==="error",d=this._events;if(d!==void 0)c=c&&d.error===void 0;else if(!c)return!1;if(c){var _;if(n.length>0&&(_=n[0]),_ instanceof Error)throw _;var w=new Error("Unhandled error."+(_?" ("+_.message+")":""));throw w.context=_,w}var a=d[t];if(a===void 0)return!1;if(typeof a=="function")CP(a,this,n);else for(var S=a.length,D=KR(a,S),l=0;l<S;++l)CP(D[l],this,n);return!0};function WR(e,t,n,l){var c,d,_;if(Fv(n),d=e._events,d===void 0?(d=e._events=Object.create(null),e._eventsCount=0):(d.newListener!==void 0&&(e.emit("newListener",t,n.listener?n.listener:n),d=e._events),_=d[t]),_===void 0)_=d[t]=n,++e._eventsCount;else if(typeof _=="function"?_=d[t]=l?[n,_]:[_,n]:l?_.unshift(n):_.push(n),c=qR(e),c>0&&_.length>c&&!_.warned){_.warned=!0;var w=new Error("Possible EventEmitter memory leak detected. "+_.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");w.name="MaxListenersExceededWarning",w.emitter=e,w.type=t,w.count=_.length,QV(w)}return e}pn.prototype.addListener=function(t,n){return WR(this,t,n,!1)};pn.prototype.on=pn.prototype.addListener;pn.prototype.prependListener=function(t,n){return WR(this,t,n,!0)};function eG(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ZR(e,t,n){var l={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},c=eG.bind(l);return c.listener=n,l.wrapFn=c,c}pn.prototype.once=function(t,n){return Fv(n),this.on(t,ZR(this,t,n)),this};pn.prototype.prependOnceListener=function(t,n){return Fv(n),this.prependListener(t,ZR(this,t,n)),this};pn.prototype.removeListener=function(t,n){var l,c,d,_,w;if(Fv(n),c=this._events,c===void 0)return this;if(l=c[t],l===void 0)return this;if(l===n||l.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete c[t],c.removeListener&&this.emit("removeListener",t,l.listener||n));else if(typeof l!="function"){for(d=-1,_=l.length-1;_>=0;_--)if(l[_]===n||l[_].listener===n){w=l[_].listener,d=_;break}if(d<0)return this;d===0?l.shift():tG(l,d),l.length===1&&(c[t]=l[0]),c.removeListener!==void 0&&this.emit("removeListener",t,w||n)}return this};pn.prototype.off=pn.prototype.removeListener;pn.prototype.removeAllListeners=function(t){var n,l,c;if(l=this._events,l===void 0)return this;if(l.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):l[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete l[t]),this;if(arguments.length===0){var d=Object.keys(l),_;for(c=0;c<d.length;++c)_=d[c],_!=="removeListener"&&this.removeAllListeners(_);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=l[t],typeof n=="function")this.removeListener(t,n);else if(n!==void 0)for(c=n.length-1;c>=0;c--)this.removeListener(t,n[c]);return this};function HR(e,t,n){var l=e._events;if(l===void 0)return[];var c=l[t];return c===void 0?[]:typeof c=="function"?n?[c.listener||c]:[c]:n?rG(c):KR(c,c.length)}pn.prototype.listeners=function(t){return HR(this,t,!0)};pn.prototype.rawListeners=function(t){return HR(this,t,!1)};pn.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):XR.call(e,t)};pn.prototype.listenerCount=XR;function XR(e){var t=this._events;if(t!==void 0){var n=t[e];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}pn.prototype.eventNames=function(){return this._eventsCount>0?a_(this._events):[]};function KR(e,t){for(var n=new Array(t),l=0;l<t;++l)n[l]=e[l];return n}function tG(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function rG(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function nG(e,t){return new Promise(function(n,l){function c(_){e.removeListener(t,d),l(_)}function d(){typeof e.removeListener=="function"&&e.removeListener("error",c),n([].slice.call(arguments))}YR(e,t,d,{once:!0}),t!=="error"&&iG(e,c,{once:!0})})}function iG(e,t,n){typeof e.on=="function"&&YR(e,"error",t,n)}function YR(e,t,n,l){if(typeof e.on=="function")l.once?e.once(t,n):e.on(t,n);else if(typeof e.addEventListener=="function")e.addEventListener(t,function c(d){l.once&&e.removeEventListener(t,c),n(d)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var oG=QT.exports,sG={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function aG(e){var t=e.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return t?{key:t[1],value:t[2]}:null}function lG(e){var t=e.match(/<?([^>]*)>(.*)/);if(!t)return null;var n=t[1],l=t[2].split(";"),c=null,d=l.reduce(function(_,w){var a=aG(w);return a?a.key==="rel"?(c||(c=a.value),_):(_[a.key]=a.value,_):_},{});return c?{url:n,rel:c,params:d}:null}function uG(e){return e?e.split(/,\s*</).reduce(function(t,n){var l=lG(n);if(!l)return t;var c=l.rel.split(/\s+/);return c.forEach(function(d){t[d]||(t[d]={url:l.url,params:l.params})}),t},{}):{}}var cG=uG,hG=cG;function eS(e,t){this.request=e,this.headers=t.headers,this.rawBody=t.body,this.statusCode=t.statusCode;try{this.body=JSON.parse(t.body||"{}")}catch{this.body=t.body}this.links=hG(this.headers.link)}eS.prototype.hasNextPage=function(){return!!this.links.next};eS.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var fG=eS,Bv={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},MP=Bv;function dG(e){var t=e.type||MP.ERROR_HTTP,n;if(e.body)try{n=JSON.parse(e.body)}catch{n=e.body}else n=null;var l=e.message||null;l||(typeof n=="string"?l=n:n&&typeof n.message=="string"?l=n.message:t===MP.ERROR_REQUEST_ABORTED&&(l="Request aborted")),this.message=l,this.type=t,this.statusCode=e.statusCode||null,this.request=e.request,this.body=n}var pG=dG;function mG(e){var t=e.indexOf(":"),n=e.substring(0,t).trim().toLowerCase(),l=e.substring(t+1).trim();return{name:n,value:l}}function gG(e){var t={};return e&&e.trim().split(/[\r|\n]+/).forEach(function(n){var l=mG(n);t[l.name]=l.value}),t}var yG=gG,_G=fG,PP=pG,w1=Bv,vG=yG,G_={};function xG(e){var t=G_[e.id];t&&(t.abort(),delete G_[e.id])}function bG(e,t){return new _G(e,{body:t.response,headers:vG(t.getAllResponseHeaders()),statusCode:t.status})}function kP(e){var t=e.total,n=e.loaded,l=100*n/t;return{total:t,transferred:n,percent:l}}function wG(e,t){return new Promise(function(n,l){t.onprogress=function(_){e.emitter.emit(w1.EVENT_PROGRESS_DOWNLOAD,kP(_))};var c=e.file;c&&(t.upload.onprogress=function(_){e.emitter.emit(w1.EVENT_PROGRESS_UPLOAD,kP(_))}),t.onerror=function(_){l(_)},t.onabort=function(){var _=new PP({request:e,type:w1.ERROR_REQUEST_ABORTED});l(_)},t.onload=function(){if(delete G_[e.id],t.status<200||t.status>=400){var _=new PP({request:e,body:t.response,statusCode:t.status});l(_);return}n(t)};var d=e.body;typeof d=="string"?t.send(d):d?t.send(JSON.stringify(d)):c?t.send(c):t.send(),G_[e.id]=t}).then(function(n){return bG(e,n)})}function EG(e,t){var n=e.url(t),l=new window.XMLHttpRequest;return l.open(e.method,n),Object.keys(e.headers).forEach(function(c){l.setRequestHeader(c,e.headers[c])}),l}function TG(e){return Promise.resolve().then(function(){var t=EG(e,e.client.accessToken);return wG(e,t)})}var SG={browserAbort:xG,browserSend:TG},q_={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */q_.exports;(function(e,t){(function(n){var l=t,c=e&&e.exports==l&&e,d=typeof window=="object"&&window;(d.global===d||d.window===d)&&(n=d);var _=function(N){this.message=N};_.prototype=new Error,_.prototype.name="InvalidCharacterError";var w=function(N){throw new _(N)},a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",S=/[\t\n\f\r ]/g,D=function(N){N=String(N).replace(S,"");var j=N.length;j%4==0&&(N=N.replace(/==?$/,""),j=N.length),(j%4==1||/[^+a-zA-Z0-9/]/.test(N))&&w("Invalid character: the string to be decoded is not correctly encoded.");for(var W=0,B,k,z="",Z=-1;++Z<j;)k=a.indexOf(N.charAt(Z)),B=W%4?B*64+k:k,W++%4&&(z+=String.fromCharCode(255&B>>(-2*W&6)));return z},R=function(N){N=String(N),/[^\0-\xFF]/.test(N)&&w("The string to be encoded contains characters outside of the Latin1 range.");for(var j=N.length%3,W="",B=-1,k,z,Z,ee,se=N.length-j;++B<se;)k=N.charCodeAt(B)<<16,z=N.charCodeAt(++B)<<8,Z=N.charCodeAt(++B),ee=k+z+Z,W+=a.charAt(ee>>18&63)+a.charAt(ee>>12&63)+a.charAt(ee>>6&63)+a.charAt(ee&63);return j==2?(k=N.charCodeAt(B)<<8,z=N.charCodeAt(++B),ee=k+z,W+=a.charAt(ee>>10)+a.charAt(ee>>4&63)+a.charAt(ee<<2&63)+"="):j==1&&(ee=N.charCodeAt(B),W+=a.charAt(ee>>2)+a.charAt(ee<<4&63)+"=="),W},I={encode:R,decode:D,version:"0.1.0"};if(l&&!l.nodeType)if(c)c.exports=I;else for(var M in I)I.hasOwnProperty(M)&&(l[M]=I[M]);else n.base64=I})(Am)})(q_,q_.exports);var AG=q_.exports,CG=AG,E1={};function IG(e){if(E1[e])return E1[e];var t=e.split("."),n=t[0],l=t[1];if(!l)throw new Error("Invalid token");var c=MG(l),d={usage:n,user:c.u};return Ac(c,"a")&&(d.authorization=c.a),Ac(c,"exp")&&(d.expires=c.exp*1e3),Ac(c,"iat")&&(d.created=c.iat*1e3),Ac(c,"scopes")&&(d.scopes=c.scopes),Ac(c,"client")&&(d.client=c.client),Ac(c,"ll")&&(d.lastLogin=c.ll),Ac(c,"iu")&&(d.impersonator=c.iu),E1[e]=d,d}function MG(e){try{return JSON.parse(CG.decode(e))}catch{throw new Error("Invalid token")}}function Ac(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var JR=IG,QR={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,n="~";function l(){}Object.create&&(l.prototype=Object.create(null),new l().__proto__||(n=!1));function c(a,S,D){this.fn=a,this.context=S,this.once=D||!1}function d(a,S,D,R,I){if(typeof D!="function")throw new TypeError("The listener must be a function");var M=new c(D,R||a,I),N=n?n+S:S;return a._events[N]?a._events[N].fn?a._events[N]=[a._events[N],M]:a._events[N].push(M):(a._events[N]=M,a._eventsCount++),a}function _(a,S){--a._eventsCount===0?a._events=new l:delete a._events[S]}function w(){this._events=new l,this._eventsCount=0}w.prototype.eventNames=function(){var S=[],D,R;if(this._eventsCount===0)return S;for(R in D=this._events)t.call(D,R)&&S.push(n?R.slice(1):R);return Object.getOwnPropertySymbols?S.concat(Object.getOwnPropertySymbols(D)):S},w.prototype.listeners=function(S){var D=n?n+S:S,R=this._events[D];if(!R)return[];if(R.fn)return[R.fn];for(var I=0,M=R.length,N=new Array(M);I<M;I++)N[I]=R[I].fn;return N},w.prototype.listenerCount=function(S){var D=n?n+S:S,R=this._events[D];return R?R.fn?1:R.length:0},w.prototype.emit=function(S,D,R,I,M,N){var j=n?n+S:S;if(!this._events[j])return!1;var W=this._events[j],B=arguments.length,k,z;if(W.fn){switch(W.once&&this.removeListener(S,W.fn,void 0,!0),B){case 1:return W.fn.call(W.context),!0;case 2:return W.fn.call(W.context,D),!0;case 3:return W.fn.call(W.context,D,R),!0;case 4:return W.fn.call(W.context,D,R,I),!0;case 5:return W.fn.call(W.context,D,R,I,M),!0;case 6:return W.fn.call(W.context,D,R,I,M,N),!0}for(z=1,k=new Array(B-1);z<B;z++)k[z-1]=arguments[z];W.fn.apply(W.context,k)}else{var Z=W.length,ee;for(z=0;z<Z;z++)switch(W[z].once&&this.removeListener(S,W[z].fn,void 0,!0),B){case 1:W[z].fn.call(W[z].context);break;case 2:W[z].fn.call(W[z].context,D);break;case 3:W[z].fn.call(W[z].context,D,R);break;case 4:W[z].fn.call(W[z].context,D,R,I);break;default:if(!k)for(ee=1,k=new Array(B-1);ee<B;ee++)k[ee-1]=arguments[ee];W[z].fn.apply(W[z].context,k)}}return!0},w.prototype.on=function(S,D,R){return d(this,S,D,R,!1)},w.prototype.once=function(S,D,R){return d(this,S,D,R,!0)},w.prototype.removeListener=function(S,D,R,I){var M=n?n+S:S;if(!this._events[M])return this;if(!D)return _(this,M),this;var N=this._events[M];if(N.fn)N.fn===D&&(!I||N.once)&&(!R||N.context===R)&&_(this,M);else{for(var j=0,W=[],B=N.length;j<B;j++)(N[j].fn!==D||I&&!N[j].once||R&&N[j].context!==R)&&W.push(N[j]);W.length?this._events[M]=W.length===1?W[0]:W:_(this,M)}return this},w.prototype.removeAllListeners=function(S){var D;return S?(D=n?n+S:S,this._events[D]&&_(this,D)):(this._events=new l,this._eventsCount=0),this},w.prototype.off=w.prototype.removeListener,w.prototype.addListener=w.prototype.on,w.prefixed=n,w.EventEmitter=w,e.exports=w})(QR);var PG=QR.exports;function kG(e){return e.map(encodeURIComponent).join(",")}function ez(e){return Array.isArray(e)?kG(e):encodeURIComponent(String(e))}function tz(e,t,n){if(n===!1||n===null)return e;var l=/\?/.test(e)?"&":"?",c=encodeURIComponent(t);return n!==void 0&&n!==""&&n!==!0&&(c+="="+ez(n)),""+e+l+c}function LG(e,t){if(!t)return e;var n=e;return Object.keys(t).forEach(function(l){var c=t[l];c!==void 0&&(Array.isArray(c)&&(c=c.filter(function(d){return d!=null}).join(",")),n=tz(n,l,c))}),n}function OG(e,t){if(!t||e.slice(0,4)==="http")return e;var n=e[0]==="/"?"":"/";return""+t.replace(/\/$/,"")+n+e}function DG(e,t){return t?e.replace(/\/:([a-zA-Z0-9]+)/g,function(n,l){var c=t[l];if(c===void 0)throw new Error("Unspecified route parameter "+l);var d=ez(c);return"/"+d}):e}var RG={appendQueryObject:LG,appendQueryParam:tz,prependOrigin:OG,interpolateRouteParams:DG},zG=JR,tS=Ll,FG=PG,ky=RG,LP=Bv,BG=1;function Iu(e,t){if(!e)throw new Error("MapiRequest requires a client");if(!t||!t.path||!t.method)throw new Error("MapiRequest requires an options object with path and method properties");var n={};t.body&&(n["content-type"]="application/json");var l=tS(n,t.headers),c=Object.keys(l).reduce(function(d,_){return d[_.toLowerCase()]=l[_],d},{});this.id=BG++,this._options=t,this.emitter=new FG,this.client=e,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=t.path,this.method=t.method,this.origin=t.origin||e.origin,this.query=t.query||{},this.params=t.params||{},this.body=t.body||null,this.file=t.file||null,this.encoding=t.encoding||"utf8",this.sendFileAs=t.sendFileAs||null,this.headers=c}Iu.prototype.url=function(t){var n=ky.prependOrigin(this.path,this.origin);n=ky.appendQueryObject(n,this.query);var l=this.params,c=t??this.client.accessToken;if(c){n=ky.appendQueryParam(n,"access_token",c);var d=zG(c).user;l=tS({ownerId:d},l)}return n=ky.interpolateRouteParams(n,l),n};Iu.prototype.send=function(){var t=this;if(t.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return t.sent=!0,t.client.sendRequest(t).then(function(n){return t.response=n,t.emitter.emit(LP.EVENT_RESPONSE,n),n},function(n){throw t.error=n,t.emitter.emit(LP.EVENT_ERROR,n),n})};Iu.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};Iu.prototype.eachPage=function(t){var n=this;function l(_){function w(){delete n._nextPageRequest;var a=_.nextPage();a&&(n._nextPageRequest=a,d(a))}t(null,_,w)}function c(_){t(_,null,function(){})}function d(_){_.send().then(l,c)}d(this)};Iu.prototype.clone=function(){return this._extend()};Iu.prototype._extend=function(t){var n=tS(this._options,t);return new Iu(this.client,n)};var NG=Iu,UG=JR,$G=NG,jG=Bv;function rz(e){if(!e||!e.accessToken)throw new Error("Cannot create a client without an access token");UG(e.accessToken),this.accessToken=e.accessToken,this.origin=e.origin||jG.API_ORIGIN}rz.prototype.createRequest=function(t){return new $G(this,t)};var nz=rz,iz=SG,oz=nz;function Gf(e){oz.call(this,e)}Gf.prototype=Object.create(oz.prototype);Gf.prototype.constructor=Gf;Gf.prototype.sendRequest=iz.browserSend;Gf.prototype.abortRequest=iz.browserAbort;function VG(e){return new Gf(e)}var sz=VG,GG=sz,qG=GG,WG=Object.prototype.toString,ZG=function(e){var t;return WG.call(e)==="[object Object]"&&(t=Object.getPrototypeOf(e),t===null||t===Object.getPrototypeOf({}))},HG=ZG,XG=Ll,az="value",T1=`
  `,Sn={};Sn.assert=function(e,t){return t=t||{},function(n){var l=Mu(e,n);if(l){var c=rS(l,t);throw t.apiName&&(c=t.apiName+": "+c),new Error(c)}}};Sn.shape=function(t){var n=QG(t);return function(c){var d=Mu(Sn.plainObject,c);if(d)return d;for(var _,w,a=[],S=0;S<n.length;S++)_=n[S].key,w=n[S].value,d=Mu(w,c[_]),d&&a.push([_].concat(d));return a.length<2?a[0]:function(D){a=a.map(function(M){var N=M[0],j=rS(M,D).split(`
`).join(T1);return"- "+N+": "+j});var R=D.path.join("."),I=R===az?"":" of "+R;return"The following properties"+I+" have invalid values:"+T1+a.join(T1)}}};Sn.strictShape=function(t){var n=Sn.shape(t);return function(c){var d=n(c);if(d)return d;var _=Object.keys(c).reduce(function(w,a){return t[a]===void 0&&w.push(a),w},[]);if(_.length!==0)return function(){return"The following keys are invalid: "+_.join(", ")}}};Sn.arrayOf=function(t){return lz(t)};Sn.tuple=function(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return lz(t)};function lz(e){var t=Array.isArray(e),n=function(l){return t?e[l]:e};return function(c){var d=Mu(Sn.plainArray,c);if(d)return d;if(t&&c.length!==e.length)return"an array with "+e.length+" items";for(var _=0;_<c.length;_++)if(d=Mu(n(_),c[_]),d)return[_].concat(d)}}Sn.required=function(t){function n(l){return l==null?function(c){return uz(c,cz(c.path)?"cannot be undefined/null.":"is required.")}:t.apply(this,arguments)}return n.__required=!0,n};Sn.oneOfType=function(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(l){var c=t.map(function(d){return Mu(d,l)}).filter(Boolean);if(c.length===t.length)return c.every(function(d){return d.length===1&&typeof d[0]=="string"})?KG(c.map(function(d){return d[0]})):c.reduce(function(d,_){return _.length>d.length?_:d})}};Sn.equal=function(t){return function(l){if(l!==t)return JSON.stringify(t)}};Sn.oneOf=function(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),n=t.map(function(l){return Sn.equal(l)});return Sn.oneOfType.apply(this,n)};Sn.range=function(t){var n=t[0],l=t[1];return function(d){var _=Mu(Sn.number,d);if(_||d<n||d>l)return"number between "+n+" & "+l+" (inclusive)"}};Sn.any=function(){};Sn.boolean=function(t){if(typeof t!="boolean")return"boolean"};Sn.number=function(t){if(typeof t!="number")return"number"};Sn.plainArray=function(t){if(!Array.isArray(t))return"array"};Sn.plainObject=function(t){if(!HG(t))return"object"};Sn.string=function(t){if(typeof t!="string")return"string"};Sn.func=function(t){if(typeof t!="function")return"function"};function Mu(e,t){if(!(t==null&&!e.hasOwnProperty("__required"))){var n=e(t);if(n)return Array.isArray(n)?n:[n]}}function rS(e,t){var n=e.length,l=e[n-1],c=e.slice(0,n-1);return c.length===0&&(c=[az]),t=XG(t,{path:c}),typeof l=="function"?l(t):uz(t,YG(l))}function KG(e){return e.length<2?e[0]:e.length===2?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e.slice(-1)}function YG(e){return"must be "+JG(e)+"."}function JG(e){return/^an? /.test(e)?e:/^[aeiou]/i.test(e)?"an "+e:/^[a-z]/i.test(e)?"a "+e:e}function uz(e,t){var n=cz(e.path),l=e.path.join(".")+" "+t,c=n?"Item at position ":"";return c+l}function cz(e){return typeof e[e.length-1]=="number"||typeof e[0]=="number"}function QG(e){return Object.keys(e||{}).map(function(t){return{key:t,value:e[t]}})}Sn.validate=Mu;Sn.processMessage=rS;var eq=Sn,tq=Ll,Pf=eq;function rq(e){if(typeof window<"u")return e instanceof window.Blob||e instanceof window.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof e=="string"||e.pipe!==void 0))return"Filename or Readable stream"}function nq(e,t){return Pf.assert(Pf.strictShape(e),t)}function iq(e){var t="date";if(typeof e=="boolean")return t;try{var n=new Date(e);if(n.getTime&&isNaN(n.getTime()))return t}catch{return t}}function oq(e){return Pf.tuple(Pf.number,Pf.number)(e)}var sq=tq(Pf,{file:rq,date:iq,coordinates:oq,assertShape:nq});function aq(e,t){var n=function(l,c){return t.indexOf(l)!==-1&&c!==void 0};return typeof t=="function"&&(n=t),Object.keys(e).filter(function(l){return n(l,e[l])}).reduce(function(l,c){return l[c]=e[c],l},{})}var lq=aq;function uq(e,t){return Object.keys(e).reduce(function(n,l){return n[l]=t(l,e[l]),n},{})}var cq=uq,hq=cq;function fq(e){return hq(e,function(t,n){return typeof n=="boolean"?JSON.stringify(n):n})}var dq=fq,pq=nz,mq=sz;function gq(e){return function(t){var n;pq.prototype.isPrototypeOf(t)?n=t:n=mq(t);var l=Object.create(e);return l.client=n,l}}var yq=gq,hz=Ll,Rr=sq,W_=lq,fz=dq,_q=yq,nS={},dz=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];nS.forwardGeocode=function(e){Rr.assertShape({query:Rr.required(Rr.string),mode:Rr.oneOf("mapbox.places","mapbox.places-permanent"),countries:Rr.arrayOf(Rr.string),proximity:Rr.oneOf(Rr.coordinates,"ip"),types:Rr.arrayOf(Rr.oneOf(dz)),autocomplete:Rr.boolean,bbox:Rr.arrayOf(Rr.number),limit:Rr.number,language:Rr.arrayOf(Rr.string),routing:Rr.boolean,fuzzyMatch:Rr.boolean,worldview:Rr.string,session_token:Rr.string})(e),e.mode=e.mode||"mapbox.places";var t=fz(hz({country:e.countries},W_(e,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:W_(e,["mode","query"]),query:t})};nS.reverseGeocode=function(e){Rr.assertShape({query:Rr.required(Rr.coordinates),mode:Rr.oneOf("mapbox.places","mapbox.places-permanent"),countries:Rr.arrayOf(Rr.string),types:Rr.arrayOf(Rr.oneOf(dz)),bbox:Rr.arrayOf(Rr.number),limit:Rr.number,language:Rr.arrayOf(Rr.string),reverseMode:Rr.oneOf("distance","score"),routing:Rr.boolean,worldview:Rr.string,session_token:Rr.string})(e),e.mode=e.mode||"mapbox.places";var t=fz(hz({country:e.countries},W_(e,["country","types","bbox","limit","language","reverseMode","routing","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:W_(e,["mode","query"]),query:t})};var vq=_q(nS);let xq="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",pz=e=>crypto.getRandomValues(new Uint8Array(e)),mz=(e,t,n)=>{let l=(2<<Math.log(e.length-1)/Math.LN2)-1,c=-~(1.6*l*t/e.length);return(d=t)=>{let _="";for(;;){let w=n(c),a=c|0;for(;a--;)if(_+=e[w[a]&l]||"",_.length===d)return _}}},bq=(e,t=21)=>mz(e,t,pz),wq=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,n)=>(n&=63,n<36?t+=n.toString(36):n<62?t+=(n-26).toString(36).toUpperCase():n>62?t+="-":t+="_",t),"");const Eq=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet:bq,customRandom:mz,nanoid:wq,random:pz,urlAlphabet:xq},Symbol.toStringTag,{value:"Module"})),Tq=Cm(Eq);var Sq=Tq.nanoid;function gz(e){this.origin=e.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=e.accessToken,this.version="0.3.0",this.pluginSessionID=this.generateSessionID(),this.sessionIncrementer=0,this.userAgent=this.getUserAgent(),this.options=e,this.send=this.send.bind(this),this.countries=e.countries?e.countries.split(","):null,this.types=e.types?e.types.split(","):null,this.bbox=e.bbox?e.bbox:null,this.language=e.language?e.language.split(","):null,this.limit=e.limit?+e.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(e),this.eventQueue=new Array,this.flushInterval=e.flushInterval||1e3,this.maxQueueSize=e.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}gz.prototype={select:function(e,t){var n=this.getEventPayload("search.select",t,{selectedFeature:e});if(n&&!(n.resultIndex===this.lastSentIndex&&n.queryString===this.lastSentInput||n.resultIndex==-1))return this.lastSentIndex=n.resultIndex,this.lastSentInput=n.queryString,this.push(n)},start:function(e){var t=this.getEventPayload("search.start",e);if(t)return this.push(t)},keyevent:function(e,t){if(e.key&&!(e.metaKey||[9,27,37,39,13,38,40].indexOf(e.keyCode)!==-1)){var n=this.getEventPayload("search.keystroke",t,{key:e.key});if(n)return this.push(n)}},send:function(e,t){if(!this.enableEventLogging)return t?t():void 0;var n=this.getRequestOptions(e);this.request(n,(function(l){if(l)return this.handleError(l,t);if(t)return t()}).bind(this))},getRequestOptions:function(e){Array.isArray(e)||(e=[e]);var t={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return t},getEventPayload:function(e,t,n={}){if(e==="search.select"&&!n.selectedFeature||e==="search.keystroke"&&!n.key)return null;var l;if(!t.options.proximity)l=null;else if(typeof t.options.proximity=="object")l=[t.options.proximity.longitude,t.options.proximity.latitude];else if(t.options.proximity==="ip"){var c=t._headers?t._headers["ip-proximity"]:null;c&&typeof c=="string"?l=c.split(",").map(parseFloat):l=[999,999]}else l=t.options.proximity;var d=t._map?t._map.getZoom():void 0,_={event:e,version:this.getEventSchemaVersion(e),created:+new Date,sessionIdentifier:this.getSessionId(),country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:t.options.autocomplete,fuzzyMatch:t.options.fuzzyMatch,proximity:l,limit:t.options.limit,routing:t.options.routing,worldview:t.options.worldview,mapZoom:d,keyboardLocale:this.locale};if(e==="search.select"?_.queryString=t.inputString:e!="search.select"&&t._inputEl?_.queryString=t._inputEl.value:_.queryString=t.inputString,["search.keystroke","search.select"].includes(e)&&(_.path="geocoding/v5/mapbox.places"),e==="search.keystroke"&&n.key)_.lastAction=n.key;else if(e==="search.select"&&n.selectedFeature){var w=n.selectedFeature,a=this.getSelectedIndex(w,t);if(_.resultIndex=a,_.resultPlaceName=w.place_name,_.resultId=w.id,w.properties&&(_.resultMapboxId=w.properties.mapbox_id),t._typeahead){var S=t._typeahead.data;S&&S.length>0&&(_.suggestionIds=this.getSuggestionIds(S),_.suggestionNames=this.getSuggestionNames(S),_.suggestionTypes=this.getSuggestionTypes(S),_.suggestionSources=this.getSuggestionSources(S))}}return this.validatePayload(_)?_:null},request:function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(this.readyState==4)return this.status==204?t(null):t(this.statusText)},n.open(e.method,e.host+"/"+e.path,!0);for(var l in e.headers){var c=e.headers[l];n.setRequestHeader(l,c)}n.send(e.body)},handleError:function(e,t){if(t)return t(e)},generateSessionID:function(){return Sq()},getSessionId:function(){return this.pluginSessionID+"."+this.sessionIncrementer},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(e,t){if(t._typeahead){var n=t._typeahead.data,l=e.id,c=n.map(function(_){return _.id}),d=c.indexOf(l);return d}},getSuggestionIds:function(e){return e.map(function(t){return t.properties?t.properties.mapbox_id||"":t.id||""})},getSuggestionNames:function(e){return e.map(function(t){return t.place_name||""})},getSuggestionTypes:function(e){return e.map(function(t){return t.place_type&&Array.isArray(t.place_type)&&t.place_type[0]||""})},getSuggestionSources:function(e){return e.map(function(t){return t._source||""})},getEventSchemaVersion:function(e){return["search.keystroke","search.select"].includes(e)?"2.2":"2.0"},validatePayload:function(e){if(!e||!e.event)return!1;var t=["event","created","sessionIdentifier","queryString"],n=["event","created","sessionIdentifier","queryString","lastAction"],l=["event","created","sessionIdentifier","queryString","resultIndex","path","suggestionIds"],c=e.event;return c==="search.start"?this.objectHasRequiredProps(e,t):c==="search.keystroke"?this.objectHasRequiredProps(e,n):c==="search.select"?this.objectHasRequiredProps(e,l):!0},objectHasRequiredProps:function(e,t){return t.every(function(n){return n==="queryString"?typeof e[n]=="string"&&e[n].length>0:e[n]!==void 0})},shouldEnableLogging:function(e){return!(e.enableEventLogging===!1||e.origin&&e.origin!=="https://api.mapbox.com")},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(e,t){this.eventQueue.push(e),(this.eventQueue.length>=this.maxQueueSize||t)&&this.flush()},remove:function(){this.flush()}};var Aq=gz,Cq={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"",ja:"",lv:"Meklt",pt:"Procurar",sr:"",zh:"",cs:"Vyhledvn",hu:"Keress",ka:"",nb:"Ske",sk:"Vyhadvanie",th:"",fi:"Hae",is:"Leita",ko:"",pl:"Szukaj",sl:"Iskanje",fa:"",ru:""},Iq={placeholder:Cq},yz={exports:{}};(function(e){(function(t,n,l){e.exports?e.exports=l():t[n]=l()})(Am,"subtag",function(){var t="",n=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function l(a){return a.match(n)||[]}function c(a){return l(a).filter(function(S,D){return S&&D})}function d(a){return a=l(a),{language:a[1]||t,extlang:a[2]||t,script:a[3]||t,region:a[4]||t}}function _(a,S,D){Object.defineProperty(a,S,{value:D,enumerable:!0})}function w(a,S,D){function R(I){return l(I)[a]||t}_(R,"pattern",S),_(d,D,R)}return w(1,/^[a-zA-Z]{2,3}$/,"language"),w(2,/^[a-zA-Z]{3}$/,"extlang"),w(3,/^[a-zA-Z]{4}$/,"script"),w(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),_(d,"split",c),d})})(yz);var Mq=yz.exports;function _z(){}_z.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const e={enableHighAccuracy:!0};return new Promise(function(t,n){window.navigator.geolocation.getCurrentPosition(t,n,e)})}};var Pq=_z;function kq(e,t){const n=vz(e),l=["address","street","place","country"];var c;if(typeof t=="function")return t(n);const d=l.indexOf(t);return d===-1?c=l:c=l.slice(d),c.reduce(function(_,w){return n[w]?(_!==""&&(_=_+", "),_+n[w]):_},"")}function vz(e){const t=e.address||"",n=e.text||"",l=e.place_name||"",d={address:l.split(",")[0],houseNumber:t,street:n,placeName:l};return e.context.forEach(function(_){const w=_.id.split(".")[0];d[w]=_.text}),d}const Lq=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var Oq={transformFeatureToGeolocationText:kq,getAddressInfo:vz,REVERSE_GEOCODE_COORD_RGX:Lq},Dq=DV,Rq=JV,Pc=Ll,zq=oG.EventEmitter,OP=sG,S1=qG,A1=vq,Fq=Aq,Bq=Iq,Nq=Mq,Uq=Pq,DP=Oq;const au={FORWARD:0,LOCAL:1,REVERSE:2};function $q(){var e=document.createElement("div");return e.className="mapboxgl-ctrl-geocoder--powered-by",e.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',e}function xz(e){this._eventEmitter=new zq,this.options=Pc({},this.options,e),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new Uq}function jq(e){return e?String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):""}xz.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",useBrowserFocus:!1,getItemValue:function(e){return e.place_name},render:function(e){var t=jq(e.place_name).split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+t[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+t.splice(1,t.length).join(",")+"</div></div>"}},_headers:{},addTo:function(e){function t(n,l){if(!document.body.contains(l))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const c=n.onAdd();l.appendChild(c)}if(e._controlContainer)e.addControl(this);else if(e instanceof HTMLElement)t(this,e);else if(typeof e=="string"){const n=document.querySelectorAll(e);if(n.length===0)throw new Error("Element ",e,"not found.");if(n.length>1)throw new Error("Geocoder can only be added to a single html element");t(this,n[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(e){if(e&&typeof e!="string"&&(this._map=e),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=A1(S1({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new Fq(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this),this._onSuggestionItemFocus=this._onSuggestionItemFocus.bind(this),this._onSuggestionItemKeyDown=this._onSuggestionItemKeydown.bind(this);var t=this.container=document.createElement("div");t.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var n=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",Rq(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(I){this.eventManager.keyevent(I,this)}).bind(this));var l=document.createElement("div");l.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var c=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(c),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),l.appendChild(this._clearEl),l.appendChild(this._loadingEl),t.appendChild(n),t.appendChild(this._inputEl),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var d=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(d),l.appendChild(this._geolocateEl),this._showGeolocateButton()}var _=this._typeahead=new Dq(this._inputEl,[],{hideOnBlur:!this.options.useBrowserFocus,filter:!1,minLength:this.options.minLength,limit:this.options.limit});t.insertBefore(l,_.list.wrapper),this.setRenderFunction(this.options.render),_.getItemValue=this.options.getItemValue;const w=this._typeahead.handleKeyDown.bind(this._typeahead),a=this._typeahead.handleKeyUp.bind(this._typeahead);this._typeahead.handleKeyUp,this.options.useBrowserFocus&&(this._typeahead.handleKeyDown=(function(I){if(!(I.keyCode===9&&!_.list.isEmpty())){if(I.keyCode===40){this._typeahead.list.active=0,this._typeahead.list.element.querySelectorAll("li").forEach(function(M){M.classList.remove("active")}),this._typeahead.list.element.querySelectorAll("li")[0].classList.add("active"),this._typeahead.list.element.querySelectorAll("li")[0].focus();return}else if(I.keyCode===38){this._typeahead.list.active=_.list.items.length-1,this._typeahead.list.element.querySelectorAll("li").forEach(function(M){M.classList.remove("active")}),this._typeahead.list.element.querySelectorAll("li")[this._typeahead.list.active].classList.add("active"),this._typeahead.list.element.querySelectorAll("li")[this._typeahead.list.active].focus();return}w(I)}}).bind(this),this._typeahead.handleKeyUp=function(I){if(I&&I.keyCode===16){I.preventDefault();return}a(I)});var S=_.list.draw,D=this._footerNode=$q(),R=this;return _.list.draw=function(){R.options.useBrowserFocus&&_.list.element.querySelectorAll("li").forEach(function(I){I.removeEventListener("focus",R._onSuggestionItemFocus),I.removeEventListener("keydown",R._onSuggestionItemKeyDown)}),S.call(this),R.options.useBrowserFocus&&_.list.element.querySelectorAll("li").forEach((function(I,M){M===0&&I.focus(),I.setAttribute("data-index",M),I.tabIndex=0,I.addEventListener("focus",this._onSuggestionItemFocus),I.addEventListener("keydown",this._onSuggestionItemKeyDown)}).bind(R)),D.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),D.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(D)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),t},_onSuggestionItemKeydown(e){const t=e.keyCode;if(t!==9){if(t===13){e.preventDefault();const n=this._typeahead.list.element.querySelector(".active");if(n){const l=n.getAttribute("data-index"),c=this._typeahead.list.items[l];c&&(this._typeahead.value(c.original),this._typeahead.list.hide())}}else if(t===38||t===40){const n=this._typeahead.list.element.querySelectorAll("li");if(n.length>0){if(t===38)if(this._typeahead.list.active>0)e.preventDefault(),this._typeahead.list.active--;else{this._typeahead.el.focus();return}else if(t===40)if(e.preventDefault(),this._typeahead.list.active<n.length-1)this._typeahead.list.active++;else return;n.forEach(function(c){c.classList.remove("active")});const l=n[this._typeahead.list.active];l&&(l.classList.add("active"),l.focus())}}}},_onSuggestionItemFocus(e){this._typeahead.list.active=e.target.getAttribute("data-index"),this._typeahead.list.element.querySelectorAll("li").forEach(function(t){t.classList.remove("active")}),e.target.classList.add("active")},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(e){this._hideLoadingIcon();const t={geometry:{type:"Point",coordinates:[e.coords.longitude,e.coords.latitude]}};this._handleMarker(t),this._fly(t),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(t),this._showClearButton(),this.fresh=!1;const n={limit:1,language:[this.options.language],query:t.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const l=t.geometry.coordinates[0]+","+t.geometry.coordinates[1];this._setInputValue(l),this._eventEmitter.emit("result",{result:t})}else this.geocoderService.reverseGeocode(n).send().then((function(l){const c=l.body.features[0];if(c){const d=DP.transformFeatureToGeolocationText(c,this.options.addressAccuracy);this._setInputValue(d),c.user_coordinates=t.geometry.coordinates,this._eventEmitter.emit("result",{result:c})}else this._eventEmitter.emit("result",{result:{user_coordinates:t.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(e){e.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+e),n.setAttribute("viewBox","0 0 18 18"),n.setAttribute("xml:space","preserve"),n.setAttribute("width",18),n.setAttribute("height",18),n.innerHTML=t,n},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(e){this._inputEl.value=e,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(e){var t=(e.clipboardData||window.clipboardData).getData("text");t.length>=this.options.minLength&&this._geocode(t)},_onKeyDown:function(e){var t=27,n=9;if(e.keyCode===t&&this.options.clearAndBlurOnEsc)return this._clear(e),this._inputEl.blur();var l=e.target&&e.target.shadowRoot?e.target.shadowRoot.activeElement:e.target,c=l?l.value:"";if(!c)return this.fresh=!0,e.keyCode!==n&&this.clear(e),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(e.metaKey||[n,t,37,39,13,38,40].indexOf(e.keyCode)!==-1)&&l.value.length>=this.options.minLength&&this._geocode(l.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(e){this.options.clearOnBlur&&this._clearOnBlur(e),this.options.collapsed&&this._collapse()},_onChange:function(){var e=this._typeahead.selected;e&&JSON.stringify(e)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(e),this.options.marker&&this._mapboxgl&&this._handleMarker(e),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(e),this._eventEmitter.emit("result",{result:e}),this.eventManager.select(e,this))},_fly:function(e){var t;if(e.properties&&OP[e.properties.short_code])t=Pc({},this.options.flyTo),this._map&&this._map.fitBounds(OP[e.properties.short_code].bbox,t);else if(e.bbox){var n=e.bbox;t=Pc({},this.options.flyTo),this._map&&this._map.fitBounds([[n[0],n[1]],[n[2],n[3]]],t)}else{var l={zoom:this.options.zoom};t=Pc({},l,this.options.flyTo),e.center?t.center=e.center:e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&(t.center=e.geometry.coordinates),this._map&&this._map.flyTo(t)}},_requestType:function(e,t){var n;return e.localGeocoderOnly?n=au.LOCAL:e.reverseGeocode&&DP.REVERSE_GEOCODE_COORD_RGX.test(t)?n=au.REVERSE:n=au.FORWARD,n},_setupConfig:function(e,t){const n=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],l=/[\s,]+/;var c=this,d=n.reduce(function(w,a){if(c.options[a]===void 0||c.options[a]===null)return w;["countries","types","language"].indexOf(a)>-1?w[a]=c.options[a].split(l):w[a]=c.options[a];const S=typeof c.options[a].longitude=="number"&&typeof c.options[a].latitude=="number";if(a==="proximity"&&S){const D=c.options[a].longitude,R=c.options[a].latitude;w[a]=[D,R]}return w},{});switch(e){case au.REVERSE:{var _=t.split(l).map(function(w){return parseFloat(w,10)});c.options.flipCoordinates||_.reverse(),d.types&&d.types[0],d=Pc(d,{query:_,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(w){w in d&&delete d[w]})}break;case au.FORWARD:{const w=t.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(w)&&(t=t.replace(/,/g," ")),d=Pc(d,{query:t})}break}return d.session_token=this.eventManager.getSessionId(),d},_geocode:function(e){this.inputString=e,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:e});const t=this._requestType(this.options,e),n=this._setupConfig(t,e);var l;switch(t){case au.LOCAL:l=Promise.resolve();break;case au.FORWARD:l=this.geocoderService.forwardGeocode(n).send();break;case au.REVERSE:l=this.geocoderService.reverseGeocode(n).send();break}var c=this.options.localGeocoder?this.options.localGeocoder(e)||[]:[],d=[],_=null;return l.catch((function(w){_=w}).bind(this)).then((function(w){this._hideLoadingIcon();var a={};return w?w.statusCode=="200"&&(a=w.body,a.request=w.request,a.headers=w.headers,this._headers=w.headers):a={type:"FeatureCollection",features:[]},a.config=n,this.fresh&&(this.eventManager.start(this),this.fresh=!1),a.features&&a.features.length&&a.features.map(function(S){S._source="mapbox"}),a.features=a.features?c.concat(a.features):c,this.options.externalGeocoder?(d=this.options.externalGeocoder(e,a.features)||Promise.resolve([]),d.then(function(S){return a.features=a.features?S.concat(a.features):S,a},function(){return a})):a}).bind(this)).then((function(w){if(_)throw _;this.options.filter&&w.features.length&&(w.features=w.features.filter(this.options.filter)),w.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",w),this._typeahead.update(w.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",w))}).bind(this)).catch((function(w){this._hideLoadingIcon(),this._hideAttribution(),c.length&&this.options.localGeocoder||d.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(c)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:c}),this._eventEmitter.emit("error",{error:w})}).bind(this)),l},_clear:function(e){e&&e.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this.eventManager.sessionIncrementer++,this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(e){this._clear(e),this._inputEl.focus(),this.options.useBrowserFocus&&this._typeahead.list.hide()},_clearOnBlur:function(e){var t=this;e.relatedTarget&&t._clear(e)},_onQueryResult:function(e){var t=e.body;if(t.features.length){var n=t.features[0];this._typeahead.selected=n,this._inputEl.value=n.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var e=this._map.getCenter().wrap();this.setProximity({longitude:e.lng,latitude:e.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(e){return this._geocode(e).then(this._onQueryResult),this},_renderError:function(){var e="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(e)},_renderLocationError:function(){var e="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(e)},_renderNoResults:function(){var e="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(e)},_renderUserDeniedGeolocationError:function(){var e="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(e)},_renderMessage:function(e){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(e)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var e=this.options.language.split(",")[0],t=Nq.language(e),n=Bq.placeholder[t];if(n)return n}return"Search"},setInput:function(e,t){return t===void 0&&(t=!1),this._inputEl.value=e,this._typeahead.selected=null,this._typeahead.clear(),e.length>=this.options.minLength&&(t?this._geocode(e):this._onChange()),this},setProximity:function(e,t=!0){return this.options.proximity=e,t&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(e){return e&&typeof e=="function"&&(this._typeahead.render=e),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(e){var t=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=e||this.options.language||t,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(e){return this.options.zoom=e,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(e){return this.options.flyTo=e,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(e){return this.options.placeholder=e||this._getPlaceholderText(),this._inputEl.placeholder=this.options.placeholder,this._inputEl.setAttribute("aria-label",this.options.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(e){return this.options.bbox=e,this},getCountries:function(){return this.options.countries},setCountries:function(e){return this.options.countries=e,this},getTypes:function(){return this.options.types},setTypes:function(e){return this.options.types=e,this},getMinLength:function(){return this.options.minLength},setMinLength:function(e){return this.options.minLength=e,this._typeahead&&(this._typeahead.options.minLength=e),this},getLimit:function(){return this.options.limit},setLimit:function(e){return this.options.limit=e,this._typeahead&&(this._typeahead.options.limit=e),this},getFilter:function(){return this.options.filter},setFilter:function(e){return this.options.filter=e,this},setOrigin:function(e){return this.options.origin=e,this.geocoderService=A1(S1({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(e){return this.options.accessToken=e,this.geocoderService=A1(S1({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(e){return this.options.autocomplete=e,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(e){return this.options.fuzzyMatch=e,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(e){return this.options.routing=e,this},getRouting:function(){return this.options.routing},setWorldview:function(e){return this.options.worldview=e,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(e){if(this._map){this._removeMarker();var t={color:"#4668F2"},n=Pc({},t,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(n),e.center?this.mapMarker.setLngLat(e.center).addTo(this._map):e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&this.mapMarker.setLngLat(e.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(e,t){return this._eventEmitter.on(e,t),this},off:function(e,t){return this._eventEmitter.removeListener(e,t),this.eventManager.remove(),this}};var Vq=xz;const bz=Pu(Vq);var iS={exports:{}};const Gq=function(e,t){const n={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},l={on:function(d,_,w){if(n[d]===void 0)throw new Error(`Invalid event type: ${d}`);n[d].push({selector:_,fn:w})},render:function(d){t.store.featureChanged(d)}},c=function(d,_){const w=n[d];let a=w.length;for(;a--;){const S=w[a];if(S.selector(_)){S.fn.call(l,_),t.store.render(),t.ui.updateMapClasses();break}}};return e.start.call(l),{render:e.render,stop:function(){e.stop&&e.stop()},trash:function(){e.trash&&(e.trash(),t.store.render())},combineFeatures:function(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures:function(){e.uncombineFeatures&&e.uncombineFeatures()},drag:function(d){c("drag",d)},click:function(d){c("click",d)},mousemove:function(d){c("mousemove",d)},mousedown:function(d){c("mousedown",d)},mouseup:function(d){c("mouseup",d)},mouseout:function(d){c("mouseout",d)},keydown:function(d){c("keydown",d)},keyup:function(d){c("keyup",d)},touchstart:function(d){c("touchstart",d)},touchmove:function(d){c("touchmove",d)},touchend:function(d){c("touchend",d)},tap:function(d){c("tap",d)}}};var qq=Gq,cn={classes:{CONTROL_BASE:"mapboxgl-ctrl",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},sources:{HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},cursors:{ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},types:{POLYGON:"polygon",LINE:"line_string",POINT:"point"},geojsonTypes:{FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},modes:{DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},events:{CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},updateActions:{MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},meta:{FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},activeStates:{ACTIVE:"true",INACTIVE:"false"},interactions:["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],LAT_MIN:-90,LAT_RENDERED_MIN:-85,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270};const Wq=Ov,cE=cn,RP={Point:0,LineString:1,Polygon:2};function Zq(e,t){const n=RP[e.geometry.type]-RP[t.geometry.type];return n===0&&e.geometry.type===cE.geojsonTypes.POLYGON?e.area-t.area:n}function Hq(e){return e.map(t=>(t.geometry.type===cE.geojsonTypes.POLYGON&&(t.area=Wq.geometry({type:cE.geojsonTypes.FEATURE,property:{},geometry:t.geometry})),t)).sort(Zq).map(t=>(delete t.area,t))}var Xq=Hq;function Kq(e,t=0){return[[e.point.x-t,e.point.y-t],[e.point.x+t,e.point.y+t]]}var Yq=Kq;function Yf(e){if(this._items={},this._nums={},this._length=e?e.length:0,!!e)for(let t=0,n=e.length;t<n;t++)this.add(e[t]),e[t]!==void 0&&(typeof e[t]=="string"?this._items[e[t]]=t:this._nums[e[t]]=t)}Yf.prototype.add=function(e){return this.has(e)?this:(this._length++,typeof e=="string"?this._items[e]=this._length:this._nums[e]=this._length,this)};Yf.prototype.delete=function(e){return this.has(e)===!1?this:(this._length--,delete this._items[e],delete this._nums[e],this)};Yf.prototype.has=function(e){return typeof e!="string"&&typeof e!="number"?!1:this._items[e]!==void 0||this._nums[e]!==void 0};Yf.prototype.values=function(){const e=[];return Object.keys(this._items).forEach(t=>{e.push({k:t,v:this._items[t]})}),Object.keys(this._nums).forEach(t=>{e.push({k:JSON.parse(t),v:this._nums[t]})}),e.sort((t,n)=>t.v-n.v).map(t=>t.k)};Yf.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var Nv=Yf;const Jq=Xq,Qq=Yq,C1=cn,e7=Nv,t7=[C1.meta.FEATURE,C1.meta.MIDPOINT,C1.meta.VERTEX];var Uv={click:r7,touch:n7};function r7(e,t,n){return wz(e,t,n,n.options.clickBuffer)}function n7(e,t,n){return wz(e,t,n,n.options.touchBuffer)}function wz(e,t,n,l){if(n.map===null)return[];const c=e?Qq(e,l):t,d={};n.options.styles&&(d.layers=n.options.styles.map(S=>S.id));const _=n.map.queryRenderedFeatures(c,d).filter(S=>t7.indexOf(S.properties.meta)!==-1),w=new e7,a=[];return _.forEach(S=>{const D=S.properties.id;w.has(D)||(w.add(D),a.push(S))}),Jq(a)}const i7=Uv,Dp=cn;var o7=function(t,n){const l=i7.click(t,null,n),c={mouse:Dp.cursors.NONE};return l[0]&&(c.mouse=l[0].properties.active===Dp.activeStates.ACTIVE?Dp.cursors.MOVE:Dp.cursors.POINTER,c.feature=l[0].properties.meta),n.events.currentModeName().indexOf("draw")!==-1&&(c.mouse=Dp.cursors.ADD),n.ui.queueMapClasses(c),n.ui.updateMapClasses(),l[0]},Ez=function(e,t){const n=e.x-t.x,l=e.y-t.y;return Math.sqrt(n*n+l*l)};const s7=Ez,a7=4,l7=12,u7=500;var c7=function(t,n,l={}){const c=l.fineTolerance!=null?l.fineTolerance:a7,d=l.grossTolerance!=null?l.grossTolerance:l7,_=l.interval!=null?l.interval:u7;t.point=t.point||n.point,t.time=t.time||n.time;const w=s7(t.point,n.point);return w<c||w<d&&n.time-t.time<_};const h7=Ez,f7=25,d7=250;var p7=function(t,n,l={}){const c=l.tolerance!=null?l.tolerance:f7,d=l.interval!=null?l.interval:d7;return t.point=t.point||n.point,t.time=t.time||n.time,h7(t.point,n.point)<c&&n.time-t.time<d},Tz={exports:{}},Sz={exports:{}},Az={exports:{}},hE=Az.exports=function(e,t){if(t||(t=16),e===void 0&&(e=128),e<=0)return"0";for(var n=Math.log(Math.pow(2,e))/Math.log(t),l=2;n===1/0;l*=2)n=Math.log(Math.pow(2,e/l))/Math.log(t)*l;for(var c=n-Math.floor(n),d="",l=0;l<Math.floor(n);l++){var _=Math.floor(Math.random()*t).toString(t);d=_+d}if(c){var w=Math.pow(t,c),_=Math.floor(Math.random()*w).toString(t);d=_+d}var a=parseInt(d,t);return a!==1/0&&a>=Math.pow(2,e)?hE(e,t):d};hE.rack=function(e,t,n){var l=function(d){var _=0;do{if(_++>10)if(n)e+=n;else throw new Error("too many ID collisions, use more bits");var w=hE(e,t)}while(Object.hasOwnProperty.call(c,w));return c[w]=d,w},c=l.hats={};return l.get=function(d){return l.hats[d]},l.set=function(d,_){return l.hats[d]=_,l},l.bits=e||128,l.base=t||16,l};var oS=Az.exports;const m7=oS,l_=cn,zu=function(e,t){this.ctx=e,this.properties=t.properties||{},this.coordinates=t.geometry.coordinates,this.id=t.id||m7(),this.type=t.geometry.type};zu.prototype.changed=function(){this.ctx.store.featureChanged(this.id)};zu.prototype.incomingCoords=function(e){this.setCoordinates(e)};zu.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};zu.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))};zu.prototype.setProperty=function(e,t){this.properties[e]=t};zu.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:l_.geojsonTypes.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))};zu.prototype.internal=function(e){const t={id:this.id,meta:l_.meta.FEATURE,"meta:type":this.type,active:l_.activeStates.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(const n in this.properties)t[`user_${n}`]=this.properties[n];return{type:l_.geojsonTypes.FEATURE,properties:t,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var $v=zu;const Cz=$v,jm=function(e,t){Cz.call(this,e,t)};jm.prototype=Object.create(Cz.prototype);jm.prototype.isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"};jm.prototype.updateCoordinate=function(e,t,n){arguments.length===3?this.coordinates=[t,n]:this.coordinates=[e,t],this.changed()};jm.prototype.getCoordinate=function(){return this.getCoordinates()};var sS=jm;const Iz=$v,Yc=function(e,t){Iz.call(this,e,t)};Yc.prototype=Object.create(Iz.prototype);Yc.prototype.isValid=function(){return this.coordinates.length>1};Yc.prototype.addCoordinate=function(e,t,n){this.changed();const l=parseInt(e,10);this.coordinates.splice(l,0,[t,n])};Yc.prototype.getCoordinate=function(e){const t=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[t]))};Yc.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)};Yc.prototype.updateCoordinate=function(e,t,n){const l=parseInt(e,10);this.coordinates[l]=[t,n],this.changed()};var aS=Yc;const Mz=$v,Wa=function(e,t){Mz.call(this,e,t),this.coordinates=this.coordinates.map(n=>n.slice(0,-1))};Wa.prototype=Object.create(Mz.prototype);Wa.prototype.isValid=function(){return this.coordinates.length===0?!1:this.coordinates.every(e=>e.length>2)};Wa.prototype.incomingCoords=function(e){this.coordinates=e.map(t=>t.slice(0,-1)),this.changed()};Wa.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};Wa.prototype.addCoordinate=function(e,t,n){this.changed();const l=e.split(".").map(d=>parseInt(d,10));this.coordinates[l[0]].splice(l[1],0,[t,n])};Wa.prototype.removeCoordinate=function(e){this.changed();const t=e.split(".").map(l=>parseInt(l,10)),n=this.coordinates[t[0]];n&&(n.splice(t[1],1),n.length<3&&this.coordinates.splice(t[0],1))};Wa.prototype.getCoordinate=function(e){const t=e.split(".").map(l=>parseInt(l,10)),n=this.coordinates[t[0]];return JSON.parse(JSON.stringify(n[t[1]]))};Wa.prototype.getCoordinates=function(){return this.coordinates.map(e=>e.concat([e[0]]))};Wa.prototype.updateCoordinate=function(e,t,n){this.changed();const l=e.split("."),c=parseInt(l[0],10),d=parseInt(l[1],10);this.coordinates[c]===void 0&&(this.coordinates[c]=[]),this.coordinates[c][d]=[t,n]};var lS=Wa;const Pz=$v,kz=cn,g7=oS,y7={MultiPoint:sS,MultiLineString:aS,MultiPolygon:lS},jv=(e,t,n,l,c)=>{const d=n.split("."),_=parseInt(d[0],10),w=d[1]?d.slice(1).join("."):null;return e[_][t](w,l,c)},ma=function(e,t){if(Pz.call(this,e,t),delete this.coordinates,this.model=y7[t.geometry.type],this.model===void 0)throw new TypeError(`${t.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(t.geometry.coordinates)};ma.prototype=Object.create(Pz.prototype);ma.prototype._coordinatesToFeatures=function(e){const t=this.model.bind(this);return e.map(n=>new t(this.ctx,{id:g7(),type:kz.geojsonTypes.FEATURE,properties:{},geometry:{coordinates:n,type:this.type.replace("Multi","")}}))};ma.prototype.isValid=function(){return this.features.every(e=>e.isValid())};ma.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()};ma.prototype.getCoordinate=function(e){return jv(this.features,"getCoordinate",e)};ma.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(e=>e.type===kz.geojsonTypes.POLYGON?e.getCoordinates():e.coordinates)))};ma.prototype.updateCoordinate=function(e,t,n){jv(this.features,"updateCoordinate",e,t,n),this.changed()};ma.prototype.addCoordinate=function(e,t,n){jv(this.features,"addCoordinate",e,t,n),this.changed()};ma.prototype.removeCoordinate=function(e){jv(this.features,"removeCoordinate",e),this.changed()};ma.prototype.getFeatures=function(){return this.features};var u_=ma;const kf=cn,_7=Uv,Lz=sS,Oz=aS,Dz=lS,Rz=u_,xi=Sz.exports=function(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e};xi.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)};xi.prototype.setSelectedCoordinates=function(e){this._ctx.store.setSelectedCoordinates(e),e.reduce((t,n)=>(t[n.feature_id]===void 0&&(t[n.feature_id]=!0,this._ctx.store.get(n.feature_id).changed()),t),{})};xi.prototype.getSelected=function(){return this._ctx.store.getSelected()};xi.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()};xi.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)};xi.prototype.getFeature=function(e){return this._ctx.store.get(e)};xi.prototype.select=function(e){return this._ctx.store.select(e)};xi.prototype.deselect=function(e){return this._ctx.store.deselect(e)};xi.prototype.deleteFeature=function(e,t={}){return this._ctx.store.delete(e,t)};xi.prototype.addFeature=function(e){return this._ctx.store.add(e)};xi.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()};xi.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()};xi.prototype.setActionableState=function(e={}){const t={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(t)};xi.prototype.changeMode=function(e,t={},n={}){return this._ctx.events.changeMode(e,t,n)};xi.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)};xi.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)};xi.prototype.featuresAt=function(e,t,n="click"){if(n!=="click"&&n!=="touch")throw new Error("invalid buffer type");return _7[n](e,t,this._ctx)};xi.prototype.newFeature=function(e){const t=e.geometry.type;return t===kf.geojsonTypes.POINT?new Lz(this._ctx,e):t===kf.geojsonTypes.LINE_STRING?new Oz(this._ctx,e):t===kf.geojsonTypes.POLYGON?new Dz(this._ctx,e):new Rz(this._ctx,e)};xi.prototype.isInstanceOf=function(e,t){if(e===kf.geojsonTypes.POINT)return t instanceof Lz;if(e===kf.geojsonTypes.LINE_STRING)return t instanceof Oz;if(e===kf.geojsonTypes.POLYGON)return t instanceof Dz;if(e==="MultiFeature")return t instanceof Rz;throw new Error(`Unknown feature class: ${e}`)};xi.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)};var v7=Sz.exports;const Gi=Tz.exports=v7;Gi.prototype.onSetup=function(){};Gi.prototype.onDrag=function(){};Gi.prototype.onClick=function(){};Gi.prototype.onMouseMove=function(){};Gi.prototype.onMouseDown=function(){};Gi.prototype.onMouseUp=function(){};Gi.prototype.onMouseOut=function(){};Gi.prototype.onKeyUp=function(){};Gi.prototype.onKeyDown=function(){};Gi.prototype.onTouchStart=function(){};Gi.prototype.onTouchMove=function(){};Gi.prototype.onTouchEnd=function(){};Gi.prototype.onTap=function(){};Gi.prototype.onStop=function(){};Gi.prototype.onTrash=function(){};Gi.prototype.onCombineFeature=function(){};Gi.prototype.onUncombineFeature=function(){};Gi.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var x7=Tz.exports;const b7=x7,zz={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},w7=Object.keys(zz);var E7=function(e){const t=Object.keys(e);return function(n,l={}){let c={};const d=t.reduce((w,a)=>(w[a]=e[a],w),new b7(n));function _(w){return function(a){d[w](c,a)}}return{start:function(){c=d.onSetup(l),w7.forEach(w=>{const a=zz[w];let S=()=>!1;e[a]&&(S=()=>!0),this.on(w,S,_(a))})},stop:function(){d.onStop(c)},trash:function(){d.onTrash(c)},combineFeatures:function(){d.onCombineFeatures(c)},uncombineFeatures:function(){d.onUncombineFeatures(c)},render:function(w,a){d.toDisplayFeatures(c,w,a)}}}};const zP=qq,I1=o7,FP=Uv,BP=c7,NP=p7,Qh=cn,T7=E7;var S7=function(e){const t=Object.keys(e.options.modes).reduce((I,M)=>(I[M]=T7(e.options.modes[M]),I),{});let n={},l={};const c={};let d=null,_=null;c.drag=function(I,M){M({point:I.point,time:new Date().getTime()})?(e.ui.queueMapClasses({mouse:Qh.cursors.DRAG}),_.drag(I)):I.originalEvent.stopPropagation()},c.mousedrag=function(I){c.drag(I,M=>!BP(n,M))},c.touchdrag=function(I){c.drag(I,M=>!NP(l,M))},c.mousemove=function(I){if((I.originalEvent.buttons!==void 0?I.originalEvent.buttons:I.originalEvent.which)===1)return c.mousedrag(I);const N=I1(I,e);I.featureTarget=N,_.mousemove(I)},c.mousedown=function(I){n={time:new Date().getTime(),point:I.point};const M=I1(I,e);I.featureTarget=M,_.mousedown(I)},c.mouseup=function(I){const M=I1(I,e);I.featureTarget=M,BP(n,{point:I.point,time:new Date().getTime()})?_.click(I):_.mouseup(I)},c.mouseout=function(I){_.mouseout(I)},c.touchstart=function(I){if(I.originalEvent.preventDefault(),!e.options.touchEnabled)return;l={time:new Date().getTime(),point:I.point};const M=FP.touch(I,null,e)[0];I.featureTarget=M,_.touchstart(I)},c.touchmove=function(I){if(I.originalEvent.preventDefault(),!!e.options.touchEnabled)return _.touchmove(I),c.touchdrag(I)},c.touchend=function(I){if(I.originalEvent.preventDefault(),!e.options.touchEnabled)return;const M=FP.touch(I,null,e)[0];I.featureTarget=M,NP(l,{time:new Date().getTime(),point:I.point})?_.tap(I):_.touchend(I)};const w=I=>!(I===8||I===46||I>=48&&I<=57);c.keydown=function(I){(I.srcElement||I.target).classList[0]==="mapboxgl-canvas"&&((I.keyCode===8||I.keyCode===46)&&e.options.controls.trash?(I.preventDefault(),_.trash()):w(I.keyCode)?_.keydown(I):I.keyCode===49&&e.options.controls.point?a(Qh.modes.DRAW_POINT):I.keyCode===50&&e.options.controls.line_string?a(Qh.modes.DRAW_LINE_STRING):I.keyCode===51&&e.options.controls.polygon&&a(Qh.modes.DRAW_POLYGON))},c.keyup=function(I){w(I.keyCode)&&_.keyup(I)},c.zoomend=function(){e.store.changeZoom()},c.data=function(I){if(I.dataType==="style"){const{setup:M,map:N,options:j,store:W}=e;j.styles.some(k=>N.getLayer(k.id))||(M.addLayers(),W.setDirty(),W.render())}};function a(I,M,N={}){_.stop();const j=t[I];if(j===void 0)throw new Error(`${I} is not valid`);d=I;const W=j(e,M);_=zP(W,e),N.silent||e.map.fire(Qh.events.MODE_CHANGE,{mode:I}),e.store.setDirty(),e.store.render()}const S={trash:!1,combineFeatures:!1,uncombineFeatures:!1};function D(I){let M=!1;Object.keys(I).forEach(N=>{if(S[N]===void 0)throw new Error("Invalid action type");S[N]!==I[N]&&(M=!0),S[N]=I[N]}),M&&e.map.fire(Qh.events.ACTIONABLE,{actions:S})}return{start:function(){d=e.options.defaultMode,_=zP(t[d](e),e)},changeMode:a,actionable:D,currentModeName:function(){return d},currentModeRender:function(I,M){return _.render(I,M)},fire:function(I,M){c[I]&&c[I](M)},addEventListeners:function(){e.map.on("mousemove",c.mousemove),e.map.on("mousedown",c.mousedown),e.map.on("mouseup",c.mouseup),e.map.on("data",c.data),e.map.on("touchmove",c.touchmove),e.map.on("touchstart",c.touchstart),e.map.on("touchend",c.touchend),e.container.addEventListener("mouseout",c.mouseout),e.options.keybindings&&(e.container.addEventListener("keydown",c.keydown),e.container.addEventListener("keyup",c.keyup))},removeEventListeners:function(){e.map.off("mousemove",c.mousemove),e.map.off("mousedown",c.mousedown),e.map.off("mouseup",c.mouseup),e.map.off("data",c.data),e.map.off("touchmove",c.touchmove),e.map.off("touchstart",c.touchstart),e.map.off("touchend",c.touchend),e.container.removeEventListener("mouseout",c.mouseout),e.options.keybindings&&(e.container.removeEventListener("keydown",c.keydown),e.container.removeEventListener("keyup",c.keyup))},trash:function(I){_.trash(I)},combineFeatures:function(){_.combineFeatures()},uncombineFeatures:function(){_.uncombineFeatures()},getMode:function(){return d}}},Fz={exports:{}};function A7(e,t,n){let l,c;function d(){l=!1,c&&(_.apply(n,c),c=!1)}function _(){l?c=arguments:(l=!0,e.apply(n,arguments),setTimeout(d,t))}return _}var C7=A7;function I7(e){return[].concat(e).filter(t=>t!==void 0)}var M7=I7;const La=cn;var P7=function(){const t=this;if(!(t.ctx.map&&t.ctx.map.getSource(La.sources.HOT)!==void 0))return S();const l=t.ctx.events.currentModeName();t.ctx.ui.queueMapClasses({mode:l});let c=[],d=[];t.isDirty?d=t.getAllIds():(c=t.getChangedIds().filter(D=>t.get(D)!==void 0),d=t.sources.hot.filter(D=>D.properties.id&&c.indexOf(D.properties.id)===-1&&t.get(D.properties.id)!==void 0).map(D=>D.properties.id)),t.sources.hot=[];const _=t.sources.cold.length;t.sources.cold=t.isDirty?[]:t.sources.cold.filter(D=>{const R=D.properties.id||D.properties.parent;return c.indexOf(R)===-1});const w=_!==t.sources.cold.length||d.length>0;c.forEach(D=>a(D,"hot")),d.forEach(D=>a(D,"cold"));function a(D,R){const M=t.get(D).internal(l);t.ctx.events.currentModeRender(M,N=>{t.sources[R].push(N)})}if(w&&t.ctx.map.getSource(La.sources.COLD).setData({type:La.geojsonTypes.FEATURE_COLLECTION,features:t.sources.cold}),t.ctx.map.getSource(La.sources.HOT).setData({type:La.geojsonTypes.FEATURE_COLLECTION,features:t.sources.hot}),t._emitSelectionChange&&(t.ctx.map.fire(La.events.SELECTION_CHANGE,{features:t.getSelected().map(D=>D.toGeoJSON()),points:t.getSelectedCoordinates().map(D=>({type:La.geojsonTypes.FEATURE,properties:{},geometry:{type:La.geojsonTypes.POINT,coordinates:D.coordinates}}))}),t._emitSelectionChange=!1),t._deletedFeaturesToEmit.length){const D=t._deletedFeaturesToEmit.map(R=>R.toGeoJSON());t._deletedFeaturesToEmit=[],t.ctx.map.fire(La.events.DELETE,{features:D})}S(),t.ctx.map.fire(La.events.RENDER,{});function S(){t.isDirty=!1,t.clearChangedIds()}};const k7=C7,Vv=M7,M1=Nv,L7=P7,O7=cn.interactions,$n=Fz.exports=function(e){this._features={},this._featureIds=new M1,this._selectedFeatureIds=new M1,this._selectedCoordinates=[],this._changedFeatureIds=new M1,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]},this.render=k7(L7,16,this),this.isDirty=!1};$n.prototype.createRenderBatch=function(){const e=this.render;let t=0;return this.render=function(){t++},()=>{this.render=e,t>0&&this.render()}};$n.prototype.setDirty=function(){return this.isDirty=!0,this};$n.prototype.featureChanged=function(e){return this._changedFeatureIds.add(e),this};$n.prototype.getChangedIds=function(){return this._changedFeatureIds.values()};$n.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this};$n.prototype.getAllIds=function(){return this._featureIds.values()};$n.prototype.add=function(e){return this.featureChanged(e.id),this._features[e.id]=e,this._featureIds.add(e.id),this};$n.prototype.delete=function(e,t={}){return Vv(e).forEach(n=>{this._featureIds.has(n)&&(this._featureIds.delete(n),this._selectedFeatureIds.delete(n),t.silent||this._deletedFeaturesToEmit.indexOf(this._features[n])===-1&&this._deletedFeaturesToEmit.push(this._features[n]),delete this._features[n],this.isDirty=!0)}),Bz.call(this,t),this};$n.prototype.get=function(e){return this._features[e]};$n.prototype.getAll=function(){return Object.keys(this._features).map(e=>this._features[e])};$n.prototype.select=function(e,t={}){return Vv(e).forEach(n=>{this._selectedFeatureIds.has(n)||(this._selectedFeatureIds.add(n),this._changedFeatureIds.add(n),t.silent||(this._emitSelectionChange=!0))}),this};$n.prototype.deselect=function(e,t={}){return Vv(e).forEach(n=>{this._selectedFeatureIds.has(n)&&(this._selectedFeatureIds.delete(n),this._changedFeatureIds.add(n),t.silent||(this._emitSelectionChange=!0))}),Bz.call(this,t),this};$n.prototype.clearSelected=function(e={}){return this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this};$n.prototype.setSelected=function(e,t={}){return e=Vv(e),this.deselect(this._selectedFeatureIds.values().filter(n=>e.indexOf(n)===-1),{silent:t.silent}),this.select(e.filter(n=>!this._selectedFeatureIds.has(n)),{silent:t.silent}),this};$n.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this};$n.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this};$n.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()};$n.prototype.getSelected=function(){return this._selectedFeatureIds.values().map(e=>this.get(e))};$n.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(t=>({coordinates:this.get(t.feature_id).getCoordinate(t.coord_path)}))};$n.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)};$n.prototype.setFeatureProperty=function(e,t,n){this.get(e).setProperty(t,n),this.featureChanged(e)};function Bz(e){const t=this._selectedCoordinates.filter(n=>this._selectedFeatureIds.has(n.feature_id));this._selectedCoordinates.length!==t.length&&!e.silent&&(this._emitSelectionChange=!0),this._selectedCoordinates=t}$n.prototype.storeMapConfig=function(){O7.forEach(e=>{this.ctx.map[e]&&(this._mapInitialConfig[e]=this.ctx.map[e].isEnabled())})};$n.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(e=>{this._mapInitialConfig[e]?this.ctx.map[e].enable():this.ctx.map[e].disable()})};$n.prototype.getInitialConfigValue=function(e){return this._mapInitialConfig[e]!==void 0?this._mapInitialConfig[e]:!0};var D7=Fz.exports;const UP=Ll,Yn=cn,R7=["mode","feature","mouse"];var z7=function(e){const t={};let n=null,l={mode:null,feature:null,mouse:null},c={mode:null,feature:null,mouse:null};function d(){_({mode:null,feature:null,mouse:null}),w()}function _(M){c=UP(c,M)}function w(){if(!e.container)return;const M=[],N=[];R7.forEach(j=>{c[j]!==l[j]&&(M.push(`${j}-${l[j]}`),c[j]!==null&&N.push(`${j}-${c[j]}`))}),M.length>0&&e.container.classList.remove.apply(e.container.classList,M),N.length>0&&e.container.classList.add.apply(e.container.classList,N),l=UP(l,c)}function a(M,N={}){const j=document.createElement("button");return j.className=`${Yn.classes.CONTROL_BUTTON} ${N.className}`,j.setAttribute("title",N.title),N.container.appendChild(j),j.addEventListener("click",W=>{if(W.preventDefault(),W.stopPropagation(),W.target===n){S();return}D(M),N.onActivate()},!0),j}function S(){n&&(n.classList.remove(Yn.classes.ACTIVE_BUTTON),n=null)}function D(M){S();const N=t[M];N&&N&&M!=="trash"&&(N.classList.add(Yn.classes.ACTIVE_BUTTON),n=N)}function R(){const M=e.options.controls,N=document.createElement("div");return N.className=`${Yn.classes.CONTROL_GROUP} ${Yn.classes.CONTROL_BASE}`,M&&(M[Yn.types.LINE]&&(t[Yn.types.LINE]=a(Yn.types.LINE,{container:N,className:Yn.classes.CONTROL_BUTTON_LINE,title:`LineString tool ${e.options.keybindings?"(l)":""}`,onActivate:()=>e.events.changeMode(Yn.modes.DRAW_LINE_STRING)})),M[Yn.types.POLYGON]&&(t[Yn.types.POLYGON]=a(Yn.types.POLYGON,{container:N,className:Yn.classes.CONTROL_BUTTON_POLYGON,title:`Polygon tool ${e.options.keybindings?"(p)":""}`,onActivate:()=>e.events.changeMode(Yn.modes.DRAW_POLYGON)})),M[Yn.types.POINT]&&(t[Yn.types.POINT]=a(Yn.types.POINT,{container:N,className:Yn.classes.CONTROL_BUTTON_POINT,title:`Marker tool ${e.options.keybindings?"(m)":""}`,onActivate:()=>e.events.changeMode(Yn.modes.DRAW_POINT)})),M.trash&&(t.trash=a("trash",{container:N,className:Yn.classes.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{e.events.trash()}})),M.combine_features&&(t.combine_features=a("combineFeatures",{container:N,className:Yn.classes.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{e.events.combineFeatures()}})),M.uncombine_features&&(t.uncombine_features=a("uncombineFeatures",{container:N,className:Yn.classes.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{e.events.uncombineFeatures()}}))),N}function I(){Object.keys(t).forEach(M=>{const N=t[M];N.parentNode&&N.parentNode.removeChild(N),delete t[M]})}return{setActiveButton:D,queueMapClasses:_,updateMapClasses:w,clearMapClasses:d,addButtons:R,removeButtons:I}};const F7=S7,B7=D7,N7=z7,lu=cn,U7=Ll;var $7=function(e){let t=null,n=null;const l={onRemove:function(){return e.map.off("load",l.connect),clearInterval(n),l.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.map=null,e.container=null,e.store=null,t&&t.parentNode&&t.parentNode.removeChild(t),t=null,this},connect:function(){e.map.off("load",l.connect),clearInterval(n),l.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd:function(c){{const d=c.fire;c.fire=function(_,w){let a=arguments;return d.length===1&&arguments.length!==1&&(a=[U7({},{type:_},w)]),d.apply(c,a)}}return e.map=c,e.events=F7(e),e.ui=N7(e),e.container=c.getContainer(),e.store=new B7(e),t=e.ui.addButtons(),e.options.boxSelect&&(c.boxZoom.disable(),c.dragPan.disable(),c.dragPan.enable()),c.loaded()?l.connect():(c.on("load",l.connect),n=setInterval(()=>{c.loaded()&&l.connect()},16)),e.events.start(),t},addLayers:function(){e.map.addSource(lu.sources.COLD,{data:{type:lu.geojsonTypes.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(lu.sources.HOT,{data:{type:lu.geojsonTypes.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach(c=>{e.map.addLayer(c)}),e.store.setDirty(!0),e.store.render()},removeLayers:function(){e.options.styles.forEach(c=>{e.map.getLayer(c.id)&&e.map.removeLayer(c.id)}),e.map.getSource(lu.sources.COLD)&&e.map.removeSource(lu.sources.COLD),e.map.getSource(lu.sources.HOT)&&e.map.removeSource(lu.sources.HOT)}};return e.setup=l,l},j7=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];const ef=cn;var Jf={isOfMetaType:function(e){return function(t){const n=t.featureTarget;return!n||!n.properties?!1:n.properties.meta===e}},isShiftMousedown:function(e){return!e.originalEvent||!e.originalEvent.shiftKey?!1:e.originalEvent.button===0},isActiveFeature:function(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===ef.activeStates.ACTIVE&&e.featureTarget.properties.meta===ef.meta.FEATURE},isInactiveFeature:function(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===ef.activeStates.INACTIVE&&e.featureTarget.properties.meta===ef.meta.FEATURE},noTarget:function(e){return e.featureTarget===void 0},isFeature:function(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.meta===ef.meta.FEATURE},isVertex:function(e){const t=e.featureTarget;return!t||!t.properties?!1:t.properties.meta===ef.meta.VERTEX},isShiftDown:function(e){return e.originalEvent?e.originalEvent.shiftKey===!0:!1},isEscapeKey:function(e){return e.keyCode===27},isEnterKey:function(e){return e.keyCode===13},true:function(){return!0}},V7=Lf;function Lf(e,t){this.x=e,this.y=t}Lf.prototype={clone:function(){return new Lf(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),l=t*this.x-n*this.y,c=n*this.x+t*this.y;return this.x=l,this.y=c,this},_rotateAround:function(e,t){var n=Math.cos(e),l=Math.sin(e),c=t.x+n*(this.x-t.x)-l*(this.y-t.y),d=t.y+l*(this.x-t.x)+n*(this.y-t.y);return this.x=c,this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}};Lf.convert=function(e){return e instanceof Lf?e:Array.isArray(e)?new Lf(e[0],e[1]):e};const G7=V7;function q7(e,t){const n=t.getBoundingClientRect();return new G7(e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0))}var W7=q7;const Rp=cn;var Gv=function(e,t,n,l){return{type:Rp.geojsonTypes.FEATURE,properties:{meta:Rp.meta.VERTEX,parent:e,coord_path:n,active:l?Rp.activeStates.ACTIVE:Rp.activeStates.INACTIVE},geometry:{type:Rp.geojsonTypes.POINT,coordinates:t}}};const Cc=cn;var Z7=function(e,t,n,l){const c=t.geometry.coordinates,d=n.geometry.coordinates;if(c[1]>Cc.LAT_RENDERED_MAX||c[1]<Cc.LAT_RENDERED_MIN||d[1]>Cc.LAT_RENDERED_MAX||d[1]<Cc.LAT_RENDERED_MIN)return null;const _=l.project([c[0],c[1]]),w=l.project([d[0],d[1]]),a=l.unproject([(_.x+w.x)/2,(_.y+w.y)/2]);return{type:Cc.geojsonTypes.FEATURE,properties:{meta:Cc.meta.MIDPOINT,parent:e,lng:a.lng,lat:a.lat,coord_path:n.properties.coord_path},geometry:{type:Cc.geojsonTypes.POINT,coordinates:[a.lng,a.lat]}}};const $P=Gv,H7=Z7,tf=cn;function Nz(e,t={},n=null){const{type:l,coordinates:c}=e.geometry,d=e.properties&&e.properties.id;let _=[];l===tf.geojsonTypes.POINT?_.push($P(d,c,n,a(n))):l===tf.geojsonTypes.POLYGON?c.forEach((D,R)=>{w(D,n!==null?`${n}.${R}`:String(R))}):l===tf.geojsonTypes.LINE_STRING?w(c,n):l.indexOf(tf.geojsonTypes.MULTI_PREFIX)===0&&S();function w(D,R){let I="",M=null;D.forEach((N,j)=>{const W=R!=null?`${R}.${j}`:String(j),B=$P(d,N,W,a(W));if(t.midpoints&&M){const z=H7(d,M,B,t.map);z&&_.push(z)}M=B;const k=JSON.stringify(N);I!==k&&_.push(B),j===0&&(I=k)})}function a(D){return t.selectedPaths?t.selectedPaths.indexOf(D)!==-1:!1}function S(){const D=l.replace(tf.geojsonTypes.MULTI_PREFIX,"");c.forEach((R,I)=>{const M={type:tf.geojsonTypes.FEATURE,properties:e.properties,geometry:{type:D,coordinates:R}};_=_.concat(Nz(M,t,I))})}return _}var qv=Nz,Qf={enable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||!e._ctx||!e._ctx.store||!e._ctx.store.getInitialConfigValue||e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||e.map.doubleClickZoom.disable()},0)}},Wv={exports:{}},X7=function e(t){switch(t&&t.type||null){case"FeatureCollection":return t.features=t.features.reduce(function(n,l){return n.concat(e(l))},[]),t;case"Feature":return t.geometry?e(t.geometry).map(function(n){var l={type:"Feature",properties:JSON.parse(JSON.stringify(t.properties)),geometry:n};return t.id!==void 0&&(l.id=t.id),l}):t;case"MultiPoint":return t.coordinates.map(function(n){return{type:"Point",coordinates:n}});case"MultiPolygon":return t.coordinates.map(function(n){return{type:"Polygon",coordinates:n}});case"MultiLineString":return t.coordinates.map(function(n){return{type:"LineString",coordinates:n}});case"GeometryCollection":return t.geometries.map(e).reduce(function(n,l){return n.concat(l)},[]);case"Point":case"Polygon":case"LineString":return[t]}},K7=function(t){return n(t);function n(l){return Array.isArray(l)&&l.length&&typeof l[0]=="number"?[l]:l.reduce(function(c,d){return Array.isArray(d)&&Array.isArray(d[0])?c.concat(n(d)):(c.push(d),c)},[])}},Y7=JT,J7=X7,Q7=K7,e9=function(e){if(!e)return[];var t=J7(Y7(e)),n=[];return t.features.forEach(function(l){l.geometry&&(n=n.concat(Q7(l.geometry.coordinates)))}),n},Uz=Function.prototype.toString,vf=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,fE,c_;if(typeof vf=="function"&&typeof Object.defineProperty=="function")try{fE=Object.defineProperty({},"length",{get:function(){throw c_}}),c_={},vf(function(){throw 42},null,fE)}catch(e){e!==c_&&(vf=null)}else vf=null;var t9=/^\s*class\b/,dE=function(t){try{var n=Uz.call(t);return t9.test(n)}catch{return!1}},P1=function(t){try{return dE(t)?!1:(Uz.call(t),!0)}catch{return!1}},h_=Object.prototype.toString,r9="[object Object]",n9="[object Function]",i9="[object GeneratorFunction]",o9="[object HTMLAllCollection]",s9="[object HTML document.all class]",a9="[object HTMLCollection]",l9=typeof Symbol=="function"&&!!Symbol.toStringTag,u9=!(0 in[,]),pE=function(){return!1};if(typeof document=="object"){var c9=document.all;h_.call(c9)===h_.call(document.all)&&(pE=function(t){if((u9||!t)&&(typeof t>"u"||typeof t=="object"))try{var n=h_.call(t);return(n===o9||n===s9||n===a9||n===r9)&&t("")==null}catch{}return!1})}var Zv=vf?function(t){if(pE(t))return!0;if(!t||typeof t!="function"&&typeof t!="object")return!1;try{vf(t,null,fE)}catch(n){if(n!==c_)return!1}return!dE(t)&&P1(t)}:function(t){if(pE(t))return!0;if(!t||typeof t!="function"&&typeof t!="object")return!1;if(l9)return P1(t);if(dE(t))return!1;var n=h_.call(t);return n!==n9&&n!==i9&&!/^\[object HTML/.test(n)?!1:P1(t)},h9=Zv,f9=Object.prototype.toString,$z=Object.prototype.hasOwnProperty,d9=function(t,n,l){for(var c=0,d=t.length;c<d;c++)$z.call(t,c)&&(l==null?n(t[c],c,t):n.call(l,t[c],c,t))},p9=function(t,n,l){for(var c=0,d=t.length;c<d;c++)l==null?n(t.charAt(c),c,t):n.call(l,t.charAt(c),c,t)},m9=function(t,n,l){for(var c in t)$z.call(t,c)&&(l==null?n(t[c],c,t):n.call(l,t[c],c,t))};function g9(e){return f9.call(e)==="[object Array]"}var uS=function(t,n,l){if(!h9(n))throw new TypeError("iterator must be a function");var c;arguments.length>=3&&(c=l),g9(t)?d9(t,n,c):typeof t=="string"?p9(t,n,c):m9(t,n,c)},jz=["Float16Array","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],k1=jz,y9=typeof globalThis>"u"?window:globalThis,Vm=function(){for(var t=[],n=0;n<k1.length;n++)typeof y9[k1[n]]=="function"&&(t[t.length]=k1[n]);return t},Z_=uS,_9=Vm,jP=Du,cS=sn,f_=Pl,Ly=Xc,v9=cS("Object.prototype.toString"),Vz=Ml(),VP=typeof globalThis>"u"?window:globalThis,mE=_9(),hS=cS("String.prototype.slice"),x9=cS("Array.prototype.indexOf",!0)||function(t,n){for(var l=0;l<t.length;l+=1)if(t[l]===n)return l;return-1},H_={__proto__:null};Vz&&f_&&Ly?Z_(mE,function(e){var t=new VP[e];if(Symbol.toStringTag in t&&Ly){var n=Ly(t),l=f_(n,Symbol.toStringTag);if(!l&&n){var c=Ly(n);l=f_(c,Symbol.toStringTag)}H_["$"+e]=jP(l.get)}}):Z_(mE,function(e){var t=new VP[e],n=t.slice||t.set;n&&(H_["$"+e]=jP(n))});var b9=function(t){var n=!1;return Z_(H_,function(l,c){if(!n)try{"$"+l(t)===c&&(n=hS(c,1))}catch{}}),n},w9=function(t){var n=!1;return Z_(H_,function(l,c){if(!n)try{l(t),n=hS(c,1)}catch{}}),n},ed=function(t){if(!t||typeof t!="object")return!1;if(!Vz){var n=hS(v9(t),8,-1);return x9(mE,n)>-1?n:n!=="Object"?!1:w9(t)}return f_?b9(t):null};const E9={},T9=Object.freeze(Object.defineProperty({__proto__:null,default:E9},Symbol.toStringTag,{value:"Module"})),gE=Cm(T9);var fS=typeof Map=="function"&&Map.prototype,L1=Object.getOwnPropertyDescriptor&&fS?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,X_=fS&&L1&&typeof L1.get=="function"?L1.get:null,GP=fS&&Map.prototype.forEach,dS=typeof Set=="function"&&Set.prototype,O1=Object.getOwnPropertyDescriptor&&dS?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,K_=dS&&O1&&typeof O1.get=="function"?O1.get:null,qP=dS&&Set.prototype.forEach,S9=typeof WeakMap=="function"&&WeakMap.prototype,rm=S9?WeakMap.prototype.has:null,A9=typeof WeakSet=="function"&&WeakSet.prototype,nm=A9?WeakSet.prototype.has:null,C9=typeof WeakRef=="function"&&WeakRef.prototype,WP=C9?WeakRef.prototype.deref:null,I9=Boolean.prototype.valueOf,M9=Object.prototype.toString,P9=Function.prototype.toString,k9=String.prototype.match,pS=String.prototype.slice,gu=String.prototype.replace,L9=String.prototype.toUpperCase,ZP=String.prototype.toLowerCase,Gz=RegExp.prototype.test,HP=Array.prototype.concat,Da=Array.prototype.join,O9=Array.prototype.slice,XP=Math.floor,yE=typeof BigInt=="function"?BigInt.prototype.valueOf:null,D1=Object.getOwnPropertySymbols,_E=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,qf=typeof Symbol=="function"&&typeof Symbol.iterator=="object",im=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===qf||!0)?Symbol.toStringTag:null,qz=Object.prototype.propertyIsEnumerable,KP=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function YP(e,t){if(e===1/0||e===-1/0||e!==e||e&&e>-1e3&&e<1e3||Gz.call(/e/,t))return t;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof e=="number"){var l=e<0?-XP(-e):XP(e);if(l!==e){var c=String(l),d=pS.call(t,c.length+1);return gu.call(c,n,"$&_")+"."+gu.call(gu.call(d,/([0-9]{3})/g,"$&_"),/_$/,"")}}return gu.call(t,n,"$&_")}var vE=gE,JP=vE.custom,QP=Hz(JP)?JP:null,Wz={__proto__:null,double:'"',single:"'"},D9={__proto__:null,double:/(["\\])/g,single:/(['\\])/g},R9=function e(t,n,l,c){var d=n||{};if(vl(d,"quoteStyle")&&!vl(Wz,d.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(vl(d,"maxStringLength")&&(typeof d.maxStringLength=="number"?d.maxStringLength<0&&d.maxStringLength!==1/0:d.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var _=vl(d,"customInspect")?d.customInspect:!0;if(typeof _!="boolean"&&_!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(vl(d,"indent")&&d.indent!==null&&d.indent!=="	"&&!(parseInt(d.indent,10)===d.indent&&d.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(vl(d,"numericSeparator")&&typeof d.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var w=d.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return Kz(t,d);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var a=String(t);return w?YP(t,a):a}if(typeof t=="bigint"){var S=String(t)+"n";return w?YP(t,S):S}var D=typeof d.depth>"u"?5:d.depth;if(typeof l>"u"&&(l=0),l>=D&&D>0&&typeof t=="object")return xE(t)?"[Array]":"[Object]";var R=Q9(d,l);if(typeof c>"u")c=[];else if(Xz(c,t)>=0)return"[Circular]";function I(ie,q,Ke){if(q&&(c=O9.call(c),c.push(q)),Ke){var Mt={depth:d.depth};return vl(d,"quoteStyle")&&(Mt.quoteStyle=d.quoteStyle),e(ie,Mt,l+1,c)}return e(ie,d,l+1,c)}if(typeof t=="function"&&!ek(t)){var M=G9(t),N=Oy(t,I);return"[Function"+(M?": "+M:" (anonymous)")+"]"+(N.length>0?" { "+Da.call(N,", ")+" }":"")}if(Hz(t)){var j=qf?gu.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):_E.call(t);return typeof t=="object"&&!qf?zp(j):j}if(K9(t)){for(var W="<"+ZP.call(String(t.nodeName)),B=t.attributes||[],k=0;k<B.length;k++)W+=" "+B[k].name+"="+Zz(z9(B[k].value),"double",d);return W+=">",t.childNodes&&t.childNodes.length&&(W+="..."),W+="</"+ZP.call(String(t.nodeName))+">",W}if(xE(t)){if(t.length===0)return"[]";var z=Oy(t,I);return R&&!J9(z)?"["+bE(z,R)+"]":"[ "+Da.call(z,", ")+" ]"}if(B9(t)){var Z=Oy(t,I);return!("cause"in Error.prototype)&&"cause"in t&&!qz.call(t,"cause")?"{ ["+String(t)+"] "+Da.call(HP.call("[cause]: "+I(t.cause),Z),", ")+" }":Z.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+Da.call(Z,", ")+" }"}if(typeof t=="object"&&_){if(QP&&typeof t[QP]=="function"&&vE)return vE(t,{depth:D-l});if(_!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(q9(t)){var ee=[];return GP&&GP.call(t,function(ie,q){ee.push(I(q,t,!0)+" => "+I(ie,t))}),tk("Map",X_.call(t),ee,R)}if(H9(t)){var se=[];return qP&&qP.call(t,function(ie){se.push(I(ie,t))}),tk("Set",K_.call(t),se,R)}if(W9(t))return R1("WeakMap");if(X9(t))return R1("WeakSet");if(Z9(t))return R1("WeakRef");if(U9(t))return zp(I(Number(t)));if(j9(t))return zp(I(yE.call(t)));if($9(t))return zp(I9.call(t));if(N9(t))return zp(I(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(typeof globalThis<"u"&&t===globalThis||typeof window<"u"&&t===window)return"{ [object globalThis] }";if(!F9(t)&&!ek(t)){var ue=Oy(t,I),Te=KP?KP(t)===Object.prototype:t instanceof Object||t.constructor===Object,Q=t instanceof Object?"":"null prototype",he=!Te&&im&&Object(t)===t&&im in t?pS.call(Fu(t),8,-1):Q?"Object":"",ye=Te||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",J=ye+(he||Q?"["+Da.call(HP.call([],he||[],Q||[]),": ")+"] ":"");return ue.length===0?J+"{}":R?J+"{"+bE(ue,R)+"}":J+"{ "+Da.call(ue,", ")+" }"}return String(t)};function Zz(e,t,n){var l=n.quoteStyle||t,c=Wz[l];return c+e+c}function z9(e){return gu.call(String(e),/"/g,"&quot;")}function Jc(e){return!im||!(typeof e=="object"&&(im in e||typeof e[im]<"u"))}function xE(e){return Fu(e)==="[object Array]"&&Jc(e)}function F9(e){return Fu(e)==="[object Date]"&&Jc(e)}function ek(e){return Fu(e)==="[object RegExp]"&&Jc(e)}function B9(e){return Fu(e)==="[object Error]"&&Jc(e)}function N9(e){return Fu(e)==="[object String]"&&Jc(e)}function U9(e){return Fu(e)==="[object Number]"&&Jc(e)}function $9(e){return Fu(e)==="[object Boolean]"&&Jc(e)}function Hz(e){if(qf)return e&&typeof e=="object"&&e instanceof Symbol;if(typeof e=="symbol")return!0;if(!e||typeof e!="object"||!_E)return!1;try{return _E.call(e),!0}catch{}return!1}function j9(e){if(!e||typeof e!="object"||!yE)return!1;try{return yE.call(e),!0}catch{}return!1}var V9=Object.prototype.hasOwnProperty||function(e){return e in this};function vl(e,t){return V9.call(e,t)}function Fu(e){return M9.call(e)}function G9(e){if(e.name)return e.name;var t=k9.call(P9.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}function Xz(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,l=e.length;n<l;n++)if(e[n]===t)return n;return-1}function q9(e){if(!X_||!e||typeof e!="object")return!1;try{X_.call(e);try{K_.call(e)}catch{return!0}return e instanceof Map}catch{}return!1}function W9(e){if(!rm||!e||typeof e!="object")return!1;try{rm.call(e,rm);try{nm.call(e,nm)}catch{return!0}return e instanceof WeakMap}catch{}return!1}function Z9(e){if(!WP||!e||typeof e!="object")return!1;try{return WP.call(e),!0}catch{}return!1}function H9(e){if(!K_||!e||typeof e!="object")return!1;try{K_.call(e);try{X_.call(e)}catch{return!0}return e instanceof Set}catch{}return!1}function X9(e){if(!nm||!e||typeof e!="object")return!1;try{nm.call(e,nm);try{rm.call(e,rm)}catch{return!0}return e instanceof WeakSet}catch{}return!1}function K9(e){return!e||typeof e!="object"?!1:typeof HTMLElement<"u"&&e instanceof HTMLElement?!0:typeof e.nodeName=="string"&&typeof e.getAttribute=="function"}function Kz(e,t){if(e.length>t.maxStringLength){var n=e.length-t.maxStringLength,l="... "+n+" more character"+(n>1?"s":"");return Kz(pS.call(e,0,t.maxStringLength),t)+l}var c=D9[t.quoteStyle||"single"];c.lastIndex=0;var d=gu.call(gu.call(e,c,"\\$1"),/[\x00-\x1f]/g,Y9);return Zz(d,"single",t)}function Y9(e){var t=e.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return n?"\\"+n:"\\x"+(t<16?"0":"")+L9.call(t.toString(16))}function zp(e){return"Object("+e+")"}function R1(e){return e+" { ? }"}function tk(e,t,n,l){var c=l?bE(n,l):Da.call(n,", ");return e+" ("+t+") {"+c+"}"}function J9(e){for(var t=0;t<e.length;t++)if(Xz(e[t],`
`)>=0)return!1;return!0}function Q9(e,t){var n;if(e.indent==="	")n="	";else if(typeof e.indent=="number"&&e.indent>0)n=Da.call(Array(e.indent+1)," ");else return null;return{base:n,prev:Da.call(Array(t+1),n)}}function bE(e,t){if(e.length===0)return"";var n=`
`+t.prev+t.base;return n+Da.call(e,","+n)+`
`+t.prev}function Oy(e,t){var n=xE(e),l=[];if(n){l.length=e.length;for(var c=0;c<e.length;c++)l[c]=vl(e,c)?t(e[c],e):""}var d=typeof D1=="function"?D1(e):[],_;if(qf){_={};for(var w=0;w<d.length;w++)_["$"+d[w]]=d[w]}for(var a in e)vl(e,a)&&(n&&String(Number(a))===a&&a<e.length||qf&&_["$"+a]instanceof Symbol||(Gz.call(/[^\w$]/,a)?l.push(t(a,e)+": "+t(e[a],e)):l.push(a+": "+t(e[a],e))));if(typeof D1=="function")for(var S=0;S<d.length;S++)qz.call(e,d[S])&&l.push("["+t(d[S])+"]: "+t(e[d[S]],e));return l}var Hv=function(t){return typeof t=="string"||typeof t=="symbol"},Bu=function(t){return!!t&&(typeof t=="function"||typeof t=="object")},rk=Tr,eW=R9,tW=Hv,rW=Bu,nW=function(t,n){if(!rW(t))throw new rk("Assertion failed: Type(O) is not Object");if(!tW(n))throw new rk("Assertion failed: P is not a Property Key, got "+eW(n));return t[n]},iW=Hc,Ol=function(t){return(typeof t=="number"||typeof t=="bigint")&&!iW(t)&&t!==1/0&&t!==-1/0},oW=Cv,sW=Wc,aW=Hc,lW=Ol,Xv=function(t){if(typeof t!="number"||aW(t)||!lW(t))return!1;var n=oW(t);return sW(n)===n},uW=Du,Yz=sn,cW=On,wE=cW("%ArrayBuffer%",!0),d_=Yz("ArrayBuffer.prototype.byteLength",!0),hW=Yz("Object.prototype.toString"),nk=!!wE&&!d_&&new wE(0).slice,ik=!!nk&&uW(nk),td=d_||ik?function(t){if(!t||typeof t!="object")return!1;try{return d_?d_(t):ik(t,0),!0}catch{return!1}}:wE?function(t){return hW(t)==="[object ArrayBuffer]"}:function(t){return!1},fW=sn,ok=fW("ArrayBuffer.prototype.byteLength",!0),dW=td,Jz=function(t){return dW(t)?ok?ok(t):t.byteLength:NaN},pW=sn,sk=pW("SharedArrayBuffer.prototype.byteLength",!0),Gm=sk?function(t){if(!t||typeof t!="object")return!1;try{return sk(t),!0}catch{return!1}}:function(t){return!1},mW=Tr,gW=Jz,yW=Vm(),_W=sn,vW=td,xW=Gm,bW=_W("SharedArrayBuffer.prototype.byteLength",!0),rd=function(t){var n=xW(t);if(!vW(t)&&!n)throw new mW("Assertion failed: `arrayBuffer` must be an Object with an [[ArrayBufferData]] internal slot");if((n?bW:gW)(t)===0)try{new window[yW[0]](t)}catch(l){return!!l&&l.name==="TypeError"}return!1},z1,ak;function Qz(){if(ak)return z1;ak=1;var e=Tr,t=kl,n=Bu,l=Hv;return z1=function(d,_){if(!n(d))throw new e("Assertion failed: `O` must be an Object");if(!l(_))throw new e("Assertion failed: `P` must be a Property Key");return t(d,_)},z1}var wW=On,eF=wW("%Array%"),EW=!eF.isArray&&sn("Object.prototype.toString"),tF=eF.isArray||function(t){return EW(t)==="[object Array]"},mS=tF,F1,lk;function rF(){return lk||(lk=1,F1=function(t){return t==="BIGUINT64"||t==="BIGINT64"}),F1}var B1,uk;function TW(){return uk||(uk=1,B1=function(t){return t==="UINT8"||t==="UINT8C"||t==="UINT16"||t==="UINT32"||t==="BIGUINT64"}),B1}var N1,ck;function SW(){if(ck)return N1;ck=1;var e=Zc;return N1=function(n){var l=n[3]&128?-1:1,c=(n[3]&127)<<1|n[2]>>7,d=(n[2]&127)<<16|n[1]<<8|n[0];return c===0&&d===0?l===1?0:-0:c===255&&d===0?l===1?1/0:-1/0:c===255&&d!==0?NaN:(c-=127,c===-127?l*d*e(2,-149):l*(1+d*e(2,-23))*e(2,c))},N1}var U1,hk;function AW(){if(hk)return U1;hk=1;var e=Zc;return U1=function(n){var l=n[7]&128?-1:1,c=(n[7]&127)<<4|(n[6]&240)>>4,d=(n[6]&15)*281474976710656+n[5]*1099511627776+n[4]*4294967296+n[3]*16777216+n[2]*65536+n[1]*256+n[0];return c===0&&d===0?l*0:c===2047&&d!==0?NaN:c===2047&&d===0?l*(1/0):(c-=1023,c===-1023?l*d*5e-324:l*(1+d/4503599627370496)*e(2,c))},U1}var $1,fk;function CW(){if(fk)return $1;fk=1;var e=On,t=Zc,n=e("%Number%"),l=e("%BigInt%",!0);return $1=function(d,_,w,a){for(var S=a?l:n,D=S(0),R=0;R<d.length;R++)D+=S(d[R]*t(2,8*R));if(!w){var I=_*8;d[_-1]&128&&(D-=S(t(2,I)))}return D},$1}var j1,dk;function IW(){return dk||(dk=1,j1=function(t,n){for(var l=0;l<t.length;l+=1)if(!n(t[l],l,t))return!1;return!0}),j1}var V1,pk;function MW(){return pk||(pk=1,V1=function(t){return typeof t=="number"&&t>=0&&t<=255&&(t|0)===t}),V1}var nd={__proto__:null,name:{__proto__:null,$Int8Array:"INT8",$Uint8Array:"UINT8",$Uint8ClampedArray:"UINT8C",$Int16Array:"INT16",$Uint16Array:"UINT16",$Int32Array:"INT32",$Uint32Array:"UINT32",$BigInt64Array:"BIGINT64",$BigUint64Array:"BIGUINT64",$Float32Array:"FLOAT32",$Float64Array:"FLOAT64"},size:{__proto__:null,$INT8:1,$UINT8:1,$UINT8C:1,$INT16:2,$UINT16:2,$INT32:4,$UINT32:4,$BIGINT64:8,$BIGUINT64:8,$FLOAT32:4,$FLOAT64:8},choices:'"INT8", "UINT8", "UINT8C", "INT16", "UINT16", "INT32", "UINT32", "BIGINT64", "BIGUINT64", "FLOAT32", or "FLOAT64"'},G1,mk;function PW(){if(mk)return G1;mk=1;var e=On,t=sn,n=RT,l=pa,c=Tr,d=e("%BigInt%",!0),_=Qz(),w=mS,a=rF(),S=TW(),D=SW(),R=AW(),I=CW(),M=IW(),N=MW(),j=t("Array.prototype.reverse"),W=t("Array.prototype.slice"),B=nd;return G1=function(z,Z,ee){if(!_(B.size,"$"+z))throw new c("Assertion failed: `type` must be a TypedArray element type");if(!w(Z)||!M(Z,N))throw new c("Assertion failed: `rawBytes` must be an Array of bytes");if(typeof ee!="boolean")throw new c("Assertion failed: `isLittleEndian` must be a Boolean");var se=B.size["$"+z];if(Z.length!==se)throw new n("Assertion failed: `rawBytes` must have a length of "+se+" for type "+z);var ue=a(z);if(ue&&!d)throw new l("this environment does not support BigInts");return Z=W(Z,0,se),ee||j(Z),z==="FLOAT32"?D(Z):z==="FLOAT64"?R(Z):I(Z,se,S(z),ue)},G1}var q1,gk;function kW(){if(gk)return q1;gk=1;var e={}.toString;return q1=Array.isArray||function(t){return e.call(t)=="[object Array]"},q1}var W1,yk;function LW(){if(yk)return W1;yk=1;var e=On,t=e("%Array.prototype.concat%"),n=Du,l=sn,c=l("Array.prototype.slice"),d=OT(),_=d&&Symbol.isConcatSpreadable,w=[],a=_?n.apply(t,w):null,S=_?kW():null;return W1=_?function(R){for(var I=0;I<arguments.length;I+=1){var M=arguments[I];if(M&&typeof M=="object"&&typeof M[_]=="boolean"){w[_]||(w[_]=!0);var N=S(M)?c(M):[M];N[_]=!0,arguments[I]=N}}return a(arguments)}:n(t,w),W1}var OW=ed,id=function(t){return!!OW(t)},DW=Tr,RW=sn,zW=RW("TypedArray.prototype.buffer",!0),FW=id,qm=zW||function(t){if(!FW(t))throw new DW("Not a Typed Array");return t.buffer},Z1,_k;function nF(){if(_k)return Z1;_k=1;var e=On,t=e("%Uint8Array%",!0),n=e("%Uint32Array%",!0),l=qm,c=n&&new n([305419896]),d=c&&new t(l(c));return Z1=d?d[0]===120?"little":d[0]===18?"big":d[0]===52?"mixed":"unknown":"indeterminate",Z1}var BW=On,NW=pa,gl=Tr,UW=sn,$W=Xv,jW=BW("%Uint8Array%",!0),H1=UW("Array.prototype.slice"),VW=rd,GW=PW(),qW=td,WW=Gm,vk=LW(),Dy=nd,ZW=nF(),HW=function(t,n,l,c,d){var _=WW(t);if(!qW(t)&&!_)throw new gl("Assertion failed: `arrayBuffer` must be an ArrayBuffer or a SharedArrayBuffer");if(!$W(n))throw new gl("Assertion failed: `byteIndex` must be an integer");if(typeof l!="string"||typeof Dy.size["$"+l]!="number")throw new gl("Assertion failed: `type` must be one of "+Dy.choices);if(typeof c!="boolean")throw new gl("Assertion failed: `isTypedArray` must be a boolean");if(d!=="SEQ-CST"&&d!=="UNORDERED")throw new gl("Assertion failed: `order` must be either `SEQ-CST` or `UNORDERED`");if(arguments.length>5&&typeof arguments[5]!="boolean")throw new gl("Assertion failed: `isLittleEndian` must be a boolean, if present");if(VW(t))throw new gl("Assertion failed: `arrayBuffer` is detached");if(n<0)throw new gl("Assertion failed: `byteIndex` must be non-negative");var w=Dy.size["$"+l];if(!w)throw new gl("Assertion failed: `type` must be one of "+Dy.choices);var a;if(_)throw new NW("SharedArrayBuffer is not supported by this implementation");a=H1(new jW(t,n),0,w);var S=arguments.length>5?arguments[5]:ZW==="little",D=S?H1(vk([0,0,0,0,0,0,0,0],a),-w):H1(vk(a,[0,0,0,0,0,0,0,0]),0,w);return GW(l,D,S)},xk=Hc,iF=function(t,n){return t===n?t===0?1/t===1/n:!0:xk(t)&&xk(n)},Ry=Tr,XW=Bu,KW=Hv,bk=iF,wk=function(){try{return delete[].length,!0}catch{return!1}}(),YW=function(t,n,l,c){if(!XW(t))throw new Ry("Assertion failed: `O` must be an Object");if(!KW(n))throw new Ry("Assertion failed: `P` must be a Property Key");if(typeof c!="boolean")throw new Ry("Assertion failed: `Throw` must be a Boolean");if(c){if(t[n]=l,wk&&!bk(t[n],l))throw new Ry("Attempted to assign to readonly property.");return!0}try{return t[n]=l,wk?bk(t[n],l):!0}catch{return!1}},X1,Ek;function JW(){if(Ek)return X1;Ek=1;var e=On,t=e("%BigInt%",!0),n=Tr,l=pa;return X1=function(d){if(typeof d!="string")throw new n("`argument` must be a string");if(!t)throw new l("BigInts are not supported in this environment");try{return t(d)}catch{return}},X1}var K1,Tk;function QW(){return Tk||(Tk=1,K1=function(t){return t===null||typeof t!="function"&&typeof t!="object"}),K1}var zy={exports:{}},Y1,Sk;function Kv(){if(Sk)return Y1;Sk=1;var e=sn,t=aR,n=e("RegExp.prototype.exec"),l=Tr;return Y1=function(d){if(!t(d))throw new l("`regex` must be a RegExp");return function(w){return n(d,w)!==null}},Y1}var Ak;function oF(){if(Ak)return zy.exports;Ak=1;var e=sn,t=e("Object.prototype.toString"),n=ZD()(),l=Kv();if(n){var c=e("Symbol.prototype.toString"),d=l(/^Symbol\(.*\)$/),_=function(a){return typeof a.valueOf()!="symbol"?!1:d(c(a))};zy.exports=function(a){if(typeof a=="symbol")return!0;if(!a||typeof a!="object"||t(a)!=="[object Symbol]")return!1;try{return _(a)}catch{return!1}}}else zy.exports=function(a){return!1};return zy.exports}var J1,Ck;function eZ(){if(Ck)return J1;Ck=1;var e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol",t=QW(),n=Zv,l=cR,c=oF(),d=function(a,S){if(typeof a>"u"||a===null)throw new TypeError("Cannot call method on "+a);if(typeof S!="string"||S!=="number"&&S!=="string")throw new TypeError('hint must be "string" or "number"');var D=S==="string"?["toString","valueOf"]:["valueOf","toString"],R,I,M;for(M=0;M<D.length;++M)if(R=a[D[M]],n(R)&&(I=R.call(a),t(I)))return I;throw new TypeError("No default value")},_=function(a,S){var D=a[S];if(D!==null&&typeof D<"u"){if(!n(D))throw new TypeError(D+" returned for property "+String(S)+" of object "+a+" is not a function");return D}};return J1=function(a){if(t(a))return a;var S="default";arguments.length>1&&(arguments[1]===String?S="string":arguments[1]===Number&&(S="number"));var D;if(e&&(Symbol.toPrimitive?D=_(a,Symbol.toPrimitive):c(a)&&(D=Symbol.prototype.valueOf)),typeof D<"u"){var R=D.call(a,S);if(t(R))return R;throw new TypeError("unable to convert exotic object to primitive")}return S==="default"&&(l(a)||c(a))&&(S="string"),d(a,S==="default"?"number":S)},J1}var Q1,Ik;function sF(){if(Ik)return Q1;Ik=1;var e=eZ();return Q1=function(n){return arguments.length>1?e(n,arguments[1]):e(n)},Q1}var eb,Mk;function aF(){if(Mk)return eb;Mk=1;var e=On,t=e("%BigInt%",!0),n=e("%Number%"),l=Tr,c=pa,d=JW(),_=sF();return eb=function(a){if(!t)throw new c("BigInts are not supported in this environment");var S=_(a,n);if(S==null)throw new l("Cannot convert null or undefined to a BigInt");if(typeof S=="boolean")return t(S?1:0);if(typeof S=="number")throw new l("Cannot convert a Number value to a BigInt");if(typeof S=="string"){var D=d(S);if(typeof D>"u")throw new l("Failed to parse String to BigInt");return D}if(typeof S=="symbol")throw new l("Cannot convert a Symbol value to a BigInt");if(typeof S!="bigint")throw new c("Assertion failed: unknown primitive type");return S},eb}var tb,Pk;function lF(){if(Pk)return tb;Pk=1;var e=On,t=e("%BigInt%",!0),n=RT,l=Tr,c=t&&t(0);return tb=function(_,w){if(typeof _!="bigint"||typeof w!="bigint")throw new l("Assertion failed: `n` and `d` arguments must be BigInts");if(w===c)throw new n("Division by zero");return _===c?c:_%w},tb}var rb,kk;function uF(){return kk||(kk=1,rb=function(t,n,l){var c=t(n,l);return c>=0?c:c+l}),rb}var nb,Lk;function tZ(){if(Lk)return nb;Lk=1;var e=On,t=e("%BigInt%",!0),n=Zc,l=aF(),c=lF(),d=uF(),_=t&&BigInt(n(2,32))*BigInt(n(2,31)),w=t&&BigInt(n(2,32))*BigInt(n(2,32));return nb=function(S){var D=l(S),R=d(c,D,w);return R>=_?R-w:R},nb}var ib,Ok;function rZ(){if(Ok)return ib;Ok=1;var e=On,t=e("%BigInt%",!0),n=Zc,l=aF(),c=lF(),d=uF(),_=t&&BigInt(n(2,32))*BigInt(n(2,32));return ib=function(a){var S=l(a),D=d(c,S,_);return D},ib}var ob,Dk;function nZ(){if(Dk)return ob;Dk=1;var e=Wc;return ob=function(n,l){var c=n%l;return e(c>=0?c:c+l)},ob}var sb,Rk;function iZ(){return Rk||(Rk=1,sb=nZ()),sb}var ab,zk;function od(){if(zk)return ab;zk=1;var e=iZ();return ab=function(n,l){return e(n,l)},ab}var lb,Fk;function oZ(){return Fk||(Fk=1,lb=function(t){return t===null||typeof t!="function"&&typeof t!="object"}),lb}var ub,Bk;function cF(){if(Bk)return ub;Bk=1;var e=Tr;return ub=function(n){if(n==null)throw new e(arguments.length>0&&arguments[1]||"Cannot call method on "+n);return n},ub}var sZ=On,aZ=sZ("%String%"),lZ=Tr,hF=function(t){if(typeof t=="symbol")throw new lZ("Cannot convert a Symbol value to a string");return aZ(t)},cb,Nk;function fF(){if(Nk)return cb;Nk=1;var e=cF(),t=hF,n=sn,l=n("String.prototype.replace"),c=/^\s$/.test(""),d=c?/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+/:/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+/,_=c?/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+$/:/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+$/;return cb=function(){var a=t(e(this));return l(l(a,d,""),_,"")},cb}var hb,Uk;function dF(){if(Uk)return hb;Uk=1;var e=fF(),t="",n="";return hb=function(){return String.prototype.trim&&t.trim()===t&&n.trim()===n&&("_"+n).trim()==="_"+n&&(n+"_").trim()===n+"_"?String.prototype.trim:e},hb}var fb,$k;function uZ(){if($k)return fb;$k=1;var e=Iv(),t=$T,n=dF();return fb=function(){var c=n();return String.prototype.trim!==c&&(e?t(String.prototype,"trim",c,!0):t(String.prototype,"trim",c)),c},fb}var db,jk;function cZ(){if(jk)return db;jk=1;var e=Du,t=Bm,n=cF(),l=fF(),c=dF(),d=uZ(),_=e(c()),w=function(S){return n(S),_(S)};return t(w,{getPolyfill:c,implementation:l,shim:d}),db=w,db}var pb,Vk;function hZ(){if(Vk)return pb;Vk=1;var e=On,t=e("%RegExp%"),n=Tr,l=e("%parseInt%"),c=sn,d=Kv(),_=c("String.prototype.slice"),w=d(/^0b[01]+$/i),a=d(/^0o[0-7]+$/i),S=d(/^[-+]0x[0-9a-f]+$/i),D=["","",""].join(""),R=new t("["+D+"]","g"),I=d(R),M=cZ();return pb=function N(j){if(typeof j!="string")throw new n("Assertion failed: `argument` is not a String");if(w(j))return+l(_(j,2),2);if(a(j))return+l(_(j,2),8);if(I(j)||S(j))return NaN;var W=M(j);return W!==j?N(W):+j},pb}var fZ=On,Gk=Tr,dZ=fZ("%Number%"),pZ=oZ(),mZ=sF(),gZ=hZ(),Nu=function(t){var n=pZ(t)?t:mZ(t,dZ);if(typeof n=="symbol")throw new Gk("Cannot convert a Symbol value to a number");if(typeof n=="bigint")throw new Gk("Conversion from 'BigInt' to 'number' is not allowed.");return typeof n=="string"?gZ(n):+n},yZ=Wc,gS=function(t){return typeof t=="bigint"?t:yZ(t)},qk=gS,_Z=Tr,Qc=function(t){if(typeof t!="number"&&typeof t!="bigint")throw new _Z("argument must be a Number or a BigInt");var n=t<0?-qk(-t):qk(t);return n===0?0:n},mb,Wk;function vZ(){if(Wk)return mb;Wk=1;var e=od(),t=Nu,n=Qc,l=Ol,c=65536;return mb=function(_){var w=t(_);if(!l(w)||w===0)return 0;var a=n(w),S=e(a,c);return S>=32768?S-c:S},mb}var gb,Zk;function xZ(){if(Zk)return gb;Zk=1;var e=od(),t=Nu,n=Qc,l=Ol,c=2147483648,d=4294967296;return gb=function(w){var a=t(w);if(!l(a)||a===0)return 0;var S=n(a),D=e(S,d),R=D>=c?D-d:D;return R===0?0:R},gb}var yb,Hk;function bZ(){if(Hk)return yb;Hk=1;var e=od(),t=Nu,n=Qc,l=Ol;return yb=function(d){var _=t(d);if(!l(_)||_===0)return 0;var w=n(_),a=e(w,256);return a>=128?a-256:a},yb}var _b,Xk;function wZ(){if(Xk)return _b;Xk=1;var e=od(),t=Nu,n=Qc,l=Ol,c=65536;return _b=function(_){var w=t(_);if(!l(w)||w===0)return 0;var a=n(w),S=e(a,c);return S===0?0:S},_b}var vb,Kk;function EZ(){if(Kk)return vb;Kk=1;var e=od(),t=Nu,n=Qc,l=Ol,c=4294967296;return vb=function(_){var w=t(_);if(!l(w)||w===0)return 0;var a=n(w),S=e(a,c);return S===0?0:S},vb}var xb,Yk;function TZ(){if(Yk)return xb;Yk=1;var e=Ol,t=od(),n=Nu,l=Qc;return xb=function(d){var _=n(d);if(!e(_)||_===0)return 0;var w=l(_),a=t(w,256);return a},xb}var bb,Jk;function SZ(){if(Jk)return bb;Jk=1;var e=Tr,t=zT,n=FT;return bb=function(c,d,_){if(typeof c!="number"||typeof d!="number"||typeof _!="number"||!(d<=_))throw new e("Assertion failed: all three arguments must be MVs, and `lower` must be `<= upper`");return n(t(d,c),_)},bb}var wb,Qk;function AZ(){if(Qk)return wb;Qk=1;var e=SZ(),t=Nu,n=gS,l=Hc;return wb=function(d){var _=t(d);if(l(_))return 0;var w=e(_,0,255),a=n(w);return w<a+.5?a:w>a+.5?a+1:a%2===0?a:a+1},wb}var Eb,eL;function pF(){return eL||(eL=1,Eb=function(t){return t===0&&1/t===-1/0}),Eb}var Tb,tL;function CZ(){if(tL)return Tb;tL=1;var e=Cv,t=Wc,n=Zc,l=Ol,c=Hc,d=pF(),_=34028234663852886e22;return Tb=function(a,S){if(c(a))return S?[0,0,192,127]:[127,192,0,0];var D;if(a===0)return D=d(a)?128:0,S?[0,0,0,D]:[D,0,0,0];if(e(a)>_||!l(a))return D=a<0?255:127,S?[0,0,128,D]:[D,128,0,0];var R=a<0?1:0;a=e(a);for(var I=0;a>=2;)I+=1,a/=2;for(;a<1;)I-=1,a*=2;var M=a-1;M*=n(2,23)+.5,M=t(M),I+=127,I<<=23;var N=R<<31|I|M,j=N&255;N>>=8;var W=N&255;N>>=8;var B=N&255;N>>=8;var k=N&255;return S?[j,W,B,k]:[k,B,W,j]},Tb}var Sb,rL;function IZ(){if(rL)return Sb;rL=1;var e=1075,t=54;return Sb=function(l){var c="";if(l===0)return c;for(var d=e,_,w=0;w<e;w+=1)if(_=l*2,_>=1?(l=_-1,c+="1",d===e&&(d=w)):(l=_,c+="0"),_===1||w-d>t)return c;return c},Sb}var Ab,nL;function MZ(){if(nL)return Ab;nL=1;var e=Wc;return Ab=function(n){for(var l="",c;n>0;)c=n/2,n=e(c),c===n?l="0"+l:l="1"+l;return l},Ab}var Cb,iL;function PZ(){if(iL)return Cb;iL=1;var e=On,t=e("%parseInt%"),n=Cv,l=Wc,c=pF(),d=sn,_=d("String.prototype.indexOf"),w=d("String.prototype.slice"),a=IZ(),S=MZ(),D=1023,R="11111111111",I="00000000000",M=I+I+I+I+"0000000";return Cb=function(j,W){var B=j<0||c(j)?"1":"0",k,z;if(isNaN(j))k=R,z="1"+M;else if(!isFinite(j))k=R,z="0"+M;else if(j===0)k=I,z="0"+M;else{j=n(j);var Z=l(j),ee=S(Z),se=a(j-Z),ue;if(ee)k=ee.length-1;else{var Te=_(se,"1");Te>-1&&(ue=Te+1),k=-ue}z=ee+se,k<0?(k<=-D&&(ue=D-1),z=w(z,ue)):z=w(z,1),k=w(I+S(k+D),-11),z=w(z+M+"0",0,52)}for(var Q=B+k+z,he=[],ye=0;ye<8;ye++){var J=W?8-ye-1:ye;he[J]=t(w(Q,ye*8,(ye+1)*8),2)}return he},Cb}var Ib,oL;function kZ(){if(oL)return Ib;oL=1;var e=On,t=e("%Number%"),n=e("%BigInt%",!0);return Ib=function(c,d,_){var w=typeof c=="bigint"?n:t;c<0&&(c>>>=0);for(var a=[],S=0;S<d;S++)a[_?S:d-1-S]=t(c&w(255)),c>>=w(8);return a},Ib}var Mb,sL;function LZ(){if(sL)return Mb;sL=1;var e=Tr,t=Qz(),n=tZ(),l=rZ(),c=vZ(),d=xZ(),_=bZ(),w=wZ(),a=EZ(),S=TZ(),D=AZ(),R=CZ(),I=PZ(),M=kZ(),N=nd,j={__proto__:null,$INT8:_,$UINT8:S,$UINT8C:D,$INT16:c,$UINT16:w,$INT32:d,$UINT32:a,$BIGINT64:n,$BIGUINT64:l};return Mb=function(B,k,z){if(typeof B!="string"||!t(N.size,"$"+B))throw new e("Assertion failed: `type` must be a TypedArray element type");if(typeof k!="number"&&typeof k!="bigint")throw new e("Assertion failed: `value` must be a Number or a BigInt");if(typeof z!="boolean")throw new e("Assertion failed: `isLittleEndian` must be a Boolean");if(B==="FLOAT32")return R(k,z);if(B==="FLOAT64")return I(k,z);var Z=N.size["$"+B],ee=j["$"+B],se=ee(k);return M(se,Z,z)},Mb}var Pb,aL;function OZ(){return aL||(aL=1,Pb=function(t,n){for(var l=0;l<t.length;l+=1)n(t[l],l,t)}),Pb}var DZ=On,RZ=pa,yl=Tr,zZ=Xv,FZ=DZ("%Uint8Array%",!0),BZ=rF(),NZ=rd,UZ=LZ(),$Z=td,jZ=Gm,VZ=kl,kb=nd,GZ=nF(),qZ=OZ(),WZ=function(t,n,l,c,d,_){var w=jZ(t);if(!$Z(t)&&!w)throw new yl("Assertion failed: `arrayBuffer` must be an ArrayBuffer or a SharedArrayBuffer");if(!zZ(n)||n<0)throw new yl("Assertion failed: `byteIndex` must be a non-negative integer");if(typeof l!="string"||!VZ(kb.size,"$"+l))throw new yl("Assertion failed: `type` must be one of "+kb.choices);if(typeof c!="number"&&typeof c!="bigint")throw new yl("Assertion failed: `value` must be a Number or a BigInt");if(typeof d!="boolean")throw new yl("Assertion failed: `isTypedArray` must be a boolean");if(_!=="SEQ-CST"&&_!=="UNORDERED"&&_!=="INIT")throw new yl('Assertion failed: `order` must be `"SEQ-CST"`, `"UNORDERED"`, or `"INIT"`');if(arguments.length>6&&typeof arguments[6]!="boolean")throw new yl("Assertion failed: `isLittleEndian` must be a boolean, if present");if(NZ(t))throw new yl("Assertion failed: ArrayBuffer is detached");if(BZ(l)?typeof c!="bigint":typeof c!="number")throw new yl("Assertion failed: `value` must be a BigInt if type is ~BIGINT64~ or ~BIGUINT64~, otherwise a Number");var a=kb.size["$"+l],S=arguments.length>6?arguments[6]:GZ==="little",D=UZ(l,c,S);if(w)throw new RZ("SharedArrayBuffer is not supported by this implementation");var R=new FZ(t,n,a);qZ(D,function(I,M){R[M]=I})},ZZ=Nu,HZ=Qc,XZ=Hc,KZ=Ol,YZ=function(t){var n=ZZ(t);return XZ(n)||n===0?0:KZ(n)?HZ(n):n},JZ=pa,QZ=Tr,eH=Xv,tH=ed,lL=nd,yS=function(t){var n=tH(t);if(!n)throw new QZ("Assertion failed: `O` must be a TypedArray");var l=lL.size["$"+lL.name["$"+n]];if(!eH(l)||l<0)throw new JZ("Assertion failed: Unknown TypedArray type `"+n+"`");return l},rH=pa,nH=Tr,iH=ed,oH=nd,sH=function(t){var n=iH(t);if(!n)throw new nH("Assertion failed: `O` must be a TypedArray");var l=oH.name["$"+n];if(typeof l!="string")throw new rH("Assertion failed: Unknown TypedArray type `"+n+"`");return l},EE={exports:{}},aH=On,Lb,uL;function _S(){if(uL)return Lb;uL=1;var e=Tr,t=kl,n={__proto__:null,"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Get]]":!0,"[[Set]]":!0,"[[Value]]":!0,"[[Writable]]":!0};return Lb=function(c){if(!c||typeof c!="object")return!1;for(var d in c)if(t(c,d)&&!n[d])return!1;var _=t(c,"[[Value]]")||t(c,"[[Writable]]"),w=t(c,"[[Get]]")||t(c,"[[Set]]");if(_&&w)throw new e("Property Descriptors may not be both accessor and data descriptors");return!0},Lb}var Ob,cL;function lH(){if(cL)return Ob;cL=1;var e=Iv,t=Dm,n=e.hasArrayLengthDefineBug(),l=n&&tF,c=sn,d=c("Object.prototype.propertyIsEnumerable");return Ob=function(w,a,S,D,R,I){if(!t){if(!w(I)||!I["[[Configurable]]"]||!I["[[Writable]]"]||R in D&&d(D,R)!==!!I["[[Enumerable]]"])return!1;var M=I["[[Value]]"];return D[R]=M,a(D[R],M)}return n&&R==="length"&&"[[Value]]"in I&&l(D)&&D.length!==I["[[Value]]"]?(D.length=I["[[Value]]"],D.length===I["[[Value]]"]):(t(D,R,S(I)),!0)},Ob}var Db,hL;function uH(){return hL||(hL=1,Db=function(t){if(typeof t>"u")return t;var n={};return"[[Value]]"in t&&(n.value=t["[[Value]]"]),"[[Writable]]"in t&&(n.writable=!!t["[[Writable]]"]),"[[Get]]"in t&&(n.get=t["[[Get]]"]),"[[Set]]"in t&&(n.set=t["[[Set]]"]),"[[Enumerable]]"in t&&(n.enumerable=!!t["[[Enumerable]]"]),"[[Configurable]]"in t&&(n.configurable=!!t["[[Configurable]]"]),n}),Db}var Rb,fL;function cH(){if(fL)return Rb;fL=1;var e=Tr,t=_S(),n=uH();return Rb=function(c){if(typeof c<"u"&&!t(c))throw new e("Assertion failed: `Desc` must be a Property Descriptor");return n(c)},Rb}var zb,dL;function hH(){if(dL)return zb;dL=1;var e=Tr,t=kl,n=_S();return zb=function(c){if(typeof c>"u")return!1;if(!n(c))throw new e("Assertion failed: `Desc` must be a Property Descriptor");return!(!t(c,"[[Value]]")&&!t(c,"[[Writable]]"))},zb}var mF=Zv,Fb,pL;function fH(){return pL||(pL=1,Fb=function(t){return!!t}),Fb}var Bb,mL;function dH(){if(mL)return Bb;mL=1;var e=kl,t=Tr,n=Bu,l=mF,c=fH();return Bb=function(_){if(!n(_))throw new t("ToPropertyDescriptor requires an object");var w={};if(e(_,"enumerable")&&(w["[[Enumerable]]"]=c(_.enumerable)),e(_,"configurable")&&(w["[[Configurable]]"]=c(_.configurable)),e(_,"value")&&(w["[[Value]]"]=_.value),e(_,"writable")&&(w["[[Writable]]"]=c(_.writable)),e(_,"get")){var a=_.get;if(typeof a<"u"&&!l(a))throw new t("getter must be a function");w["[[Get]]"]=a}if(e(_,"set")){var S=_.set;if(typeof S<"u"&&!l(S))throw new t("setter must be a function");w["[[Set]]"]=S}if((e(w,"[[Get]]")||e(w,"[[Set]]"))&&(e(w,"[[Value]]")||e(w,"[[Writable]]")))throw new t("Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");return w},Bb}var Nb,gL;function pH(){if(gL)return Nb;gL=1;var e=Tr,t=Bu,n=_S(),l=lH(),c=cH(),d=hH(),_=Hv,w=iF,a=dH();return Nb=function(D,R,I){if(!t(D))throw new e("Assertion failed: Type(O) is not Object");if(!_(R))throw new e("Assertion failed: P is not a Property Key");var M=n(I)?I:a(I);if(!n(M))throw new e("Assertion failed: Desc is not a valid Property Descriptor");return l(d,w,c,D,R,M)},Nb}var mH=aH,yL=mH("%Reflect.construct%",!0),Y_=pH();try{Y_({},"",{"[[Get]]":function(){}})}catch{Y_=null}if(Y_&&yL){var _L={},vL={};Y_(vL,"length",{"[[Get]]":function(){throw _L},"[[Enumerable]]":!0}),EE.exports=function(t){try{yL(t,vL)}catch(n){return n===_L}}}else EE.exports=function(t){return typeof t=="function"&&!!t.prototype};var gF=EE.exports,gH=On,xL=gH("%Symbol.species%",!0),Ub=Tr,bL=Bu,yH=gF,_H=function(t,n){if(!bL(t))throw new Ub("Assertion failed: Type(O) is not Object");var l=t.constructor;if(typeof l>"u")return n;if(!bL(l))throw new Ub("O.constructor is not an Object");var c=xL?l[xL]:void 0;if(c==null)return n;if(yH(c))return c;throw new Ub("no constructor found")},vH=Tr,yF=sn,wL=yF("%ArrayBuffer.prototype.resizable%",!0),EL=yF("%SharedArrayBuffer.prototype.growable%",!0),xH=td,bH=Gm,_F=function(t){var n=xH(t),l=bH(t);if(!n&&!l)throw new vH("Assertion failed: `arrayBuffer` must be an ArrayBuffer or SharedArrayBuffer");return n&&wL?!wL(t):l&&EL?!EL(t):!0},wH=Xv,TL=kl,EH=id,TH=wH,vF=function(t){return!!t&&typeof t=="object"&&TL(t,"[[Object]]")&&TL(t,"[[CachedBufferByteLength]]")&&(TH(t["[[CachedBufferByteLength]]"])&&t["[[CachedBufferByteLength]]"]>=0||t["[[CachedBufferByteLength]]"]==="DETACHED")&&EH(t["[[Object]]"])},SH=Bu,xF=sn,AH=xF("String.prototype.valueOf"),CH=function(t){try{return AH(t),!0}catch{return!1}},IH=xF("Object.prototype.toString"),MH="[object String]",PH=Ml(),kH=function(t){return typeof t=="string"?!0:!t||typeof t!="object"?!1:PH?CH(t):IH(t)===MH},bF=sn,LH=bF("Number.prototype.toString"),OH=function(t){try{return LH(t),!0}catch{return!1}},DH=bF("Object.prototype.toString"),RH="[object Number]",zH=Ml(),FH=function(t){return typeof t=="number"?!0:!t||typeof t!="object"?!1:zH?OH(t):DH(t)===RH},wF=sn,BH=wF("Boolean.prototype.toString"),NH=wF("Object.prototype.toString"),UH=function(t){try{return BH(t),!0}catch{return!1}},$H="[object Boolean]",jH=Ml(),VH=function(t){return typeof t=="boolean"?!0:t===null||typeof t!="object"?!1:jH?UH(t):NH(t)===$H},TE={exports:{}},SL=typeof BigInt<"u"&&BigInt,GH=function(){return typeof SL=="function"&&typeof BigInt=="function"&&typeof SL(42)=="bigint"&&typeof BigInt(42)=="bigint"},qH=GH();if(qH){var WH=BigInt.prototype.valueOf,ZH=function(t){try{return WH.call(t),!0}catch{}return!1};TE.exports=function(t){return t===null||typeof t>"u"||typeof t=="boolean"||typeof t=="string"||typeof t=="number"||typeof t=="symbol"||typeof t=="function"?!1:typeof t=="bigint"?!0:ZH(t)}}else TE.exports=function(t){return!1};var HH=TE.exports,XH=kH,KH=FH,YH=VH,JH=oF(),QH=HH,eX=function(t){if(t==null||typeof t!="object"&&typeof t!="function")return null;if(XH(t))return"String";if(KH(t))return"Number";if(YH(t))return"Boolean";if(JH(t))return"Symbol";if(QH(t))return"BigInt"},vS=typeof Map=="function"&&Map.prototype?Map:null,tX=typeof Set=="function"&&Set.prototype?Set:null,J_;vS||(J_=function(t){return!1});var EF=vS?Map.prototype.has:null,AL=tX?Set.prototype.has:null;!J_&&!EF&&(J_=function(t){return!1});var rX=J_||function(t){if(!t||typeof t!="object")return!1;try{if(EF.call(t),AL)try{AL.call(t)}catch{return!0}return t instanceof vS}catch{}return!1},nX=typeof Map=="function"&&Map.prototype?Map:null,xS=typeof Set=="function"&&Set.prototype?Set:null,Q_;xS||(Q_=function(t){return!1});var CL=nX?Map.prototype.has:null,TF=xS?Set.prototype.has:null;!Q_&&!TF&&(Q_=function(t){return!1});var iX=Q_||function(t){if(!t||typeof t!="object")return!1;try{if(TF.call(t),CL)try{CL.call(t)}catch{return!0}return t instanceof xS}catch{}return!1},ev=typeof WeakMap=="function"&&WeakMap.prototype?WeakMap:null,IL=typeof WeakSet=="function"&&WeakSet.prototype?WeakSet:null,tv;ev||(tv=function(t){return!1});var SE=ev?ev.prototype.has:null,$b=IL?IL.prototype.has:null;!tv&&!SE&&(tv=function(t){return!1});var oX=tv||function(t){if(!t||typeof t!="object")return!1;try{if(SE.call(t,SE),$b)try{$b.call(t,$b)}catch{return!0}return t instanceof ev}catch{}return!1},AE={exports:{}},sX=On,SF=sn,aX=sX("%WeakSet%",!0),jb=SF("WeakSet.prototype.has",!0);if(jb){var Vb=SF("WeakMap.prototype.has",!0);AE.exports=function(t){if(!t||typeof t!="object")return!1;try{if(jb(t,jb),Vb)try{Vb(t,Vb)}catch{return!0}return t instanceof aX}catch{}return!1}}else AE.exports=function(t){return!1};var lX=AE.exports,uX=rX,cX=iX,hX=oX,fX=lX,dX=function(t){if(t&&typeof t=="object"){if(uX(t))return"Map";if(cX(t))return"Set";if(hX(t))return"WeakMap";if(fX(t))return"WeakSet"}return!1},pX={}.toString,mX=Array.isArray||function(e){return pX.call(e)=="[object Array]"},gX=sn,yX=gX("WeakRef.prototype.deref",!0),_X=typeof WeakRef>"u"?function(t){return!1}:function(t){if(!t||typeof t!="object")return!1;try{return yX(t),!0}catch{return!1}},vX=sn,ML=vX("FinalizationRegistry.prototype.register",!0),xX=ML?function(t){if(!t||typeof t!="object")return!1;try{return ML(t,{},null),!0}catch{return!1}}:function(t){return!1},AF=Zv,bX=kl,wX=lR(),bS=sn,CF=bS("Function.prototype.toString"),IF=bS("String.prototype.match"),Gb=bS("Object.prototype.toString"),EX=/^class /,TX=function(t){if(AF(t)||typeof t!="function")return!1;try{var n=IF(CF(t),EX);return!!n}catch{}return!1},SX=/\s*function\s+([^(\s]*)\s*/,AX=!(0 in[,]),CX="[object Object]",IX="[object HTMLAllCollection]",MX=Function.prototype,MF=function(){return!1};if(typeof document=="object"){var PX=document.all;Gb(PX)===Gb(document.all)&&(MF=function(t){if((AX||!t)&&(typeof t>"u"||typeof t=="object"))try{var n=Gb(t);return(n===IX||n===CX)&&t("")==null}catch{}return!1})}var PF=function(){if(MF(this)||!TX(this)&&!AF(this))throw new TypeError("Function.prototype.name sham getter called on non-function");if(wX&&bX(this,"name"))return this.name;if(this===MX)return"";var t=CF(this),n=IF(t,SX),l=n&&n[1];return l},kX=PF,kF=function(){return kX},LX=Bm.supportsDescriptors,OX=lR(),DX=kF,PL=Object.defineProperty,RX=TypeError,zX=function(){var t=DX();if(OX)return t;if(!LX)throw new RX("Shimming Function.prototype.name support requires ES5 property descriptor support.");var n=Function.prototype;return PL(n,"name",{configurable:!0,enumerable:!1,get:function(){var l=t.call(this);return this!==n&&PL(this,"name",{configurable:!0,enumerable:!1,value:l,writable:!1}),l}}),t},FX=Bm,BX=Du,LF=PF,NX=kF,UX=zX,OF=BX(LF);FX(OF,{getPolyfill:NX,implementation:LF,shim:UX});var $X=OF,qb,kL;function jX(){if(kL)return qb;kL=1;const e=(function*(){}).constructor;return qb=()=>e,qb}var DF=sn,VX=Kv(),GX=VX(/^\s*(?:function)?\*/),qX=Ml(),LL=Xc,WX=DF("Object.prototype.toString"),ZX=DF("Function.prototype.toString"),HX=jX(),XX=function(t){if(typeof t!="function")return!1;if(GX(ZX(t)))return!0;if(!qX){var n=WX(t);return n==="[object GeneratorFunction]"}if(!LL)return!1;var l=HX();return l&&LL(t)===l.prototype},Wb,OL;function KX(){if(OL)return Wb;OL=1;const e=(async function(){}).constructor;return Wb=()=>e,Wb}var RF=sn,YX=Kv(),JX=RF("Object.prototype.toString"),QX=RF("Function.prototype.toString"),eK=YX(/^\s*async(?:\s+function(?:\s+|\()|\s*\()/),tK=Ml(),DL=Xc,rK=KX(),nK=function(t){if(typeof t!="function")return!1;if(eK(QX(t)))return!0;if(!tK){var n=JX(t);return n==="[object AsyncFunction]"}if(!DL)return!1;var l=rK();return l&&l.prototype===DL(t)},iK=eX,oK=dX,sK=ed,aK=mX,lK=cR,uK=aR,cK=_X,hK=xX,fK=$X,dK=XX,pK=nK,mK=sn,gK=Ml(),Zb=gK&&Symbol.toStringTag,yK=Object,RL=mK("Promise.prototype.then",!0),_K=function(t){if(!t||typeof t!="object"||!RL)return!1;try{return RL(t,null,function(){}),!0}catch{}return!1},zL=function(t){return!!t&&t!=="BigInt"&&t!=="Boolean"&&t!=="Null"&&t!=="Number"&&t!=="String"&&t!=="Symbol"&&t!=="Undefined"&&t!=="Math"&&t!=="JSON"&&t!=="Reflect"&&t!=="Atomics"&&t!=="Map"&&t!=="Set"&&t!=="WeakMap"&&t!=="WeakSet"&&t!=="BigInt64Array"&&t!=="BigUint64Array"&&t!=="Float32Array"&&t!=="Float64Array"&&t!=="Int16Array"&&t!=="Int32Array"&&t!=="Int8Array"&&t!=="Uint16Array"&&t!=="Uint32Array"&&t!=="Uint8Array"&&t!=="Uint8ClampedArray"&&t!=="Array"&&t!=="Date"&&t!=="FinalizationRegistry"&&t!=="Promise"&&t!=="RegExp"&&t!=="WeakRef"&&t!=="Function"&&t!=="GeneratorFunction"&&t!=="AsyncFunction"},vK=function(t){if(t==null)return t;var n=iK(yK(t))||oK(t)||sK(t);if(n)return n;if(aK(t))return"Array";if(lK(t))return"Date";if(uK(t))return"RegExp";if(cK(t))return"WeakRef";if(hK(t))return"FinalizationRegistry";if(typeof t=="function")return dK(t)?"GeneratorFunction":pK(t)?"AsyncFunction":"Function";if(_K(t))return"Promise";if(Zb&&Zb in t){var l=t[Zb];if(zL(l))return l}if(typeof t.constructor=="function"){var c=fK(t.constructor);if(zL(c))return c}return"Object"},xK=On,bK=mF,wK=SH,EK=vK,TK=Tr,FL=Xc,SK=DT,AK=function(t){if(!wK(t))throw new TK("Reflect.getPrototypeOf called on non-object");if(FL)return FL(t);var n=EK(t);if(n){var l=xK("%"+n+".prototype%",!0);if(l)return l}return bK(t.constructor)?t.constructor.prototype:t instanceof Object?SK.prototype:null},CK=AK,BL=Xc,zF=function(){return typeof Reflect=="object"&&Reflect&&Reflect.getPrototypeOf?Reflect.getPrototypeOf:BL?function(n){return BL(n)}:CK},FF=uS,IK=Du,MK=zF(),PK=Vm(),CE={__proto__:null},Fy=Pl,NL=Object.defineProperty;if(Fy){var kK=function(e){return e.byteOffset};FF(PK,function(e){if(typeof window[e]=="function"||typeof window[e]=="object"){var t=window[e].prototype,n=Fy(t,"byteOffset");if(!n){var l=MK(t);n=Fy(l,"byteOffset")}if(n&&n.get)CE[e]=IK(n.get);else if(NL){var c=new window[e](2);n=Fy(c,"byteOffset"),n&&n.configurable&&NL(c,"length",{value:3}),c.length===2&&(CE[e]=kK)}}})}var LK=function(t){var n;return FF(CE,function(l){if(typeof n!="number")try{var c=l(t);typeof c=="number"&&(n=c)}catch{}}),n},OK=id,wS=function(t){return OK(t)?LK(t):!1},DK=Du,BF=uS,By=Pl,RK=id,zK=jz,FK=zF(),IE={__proto__:null},UL=Object.defineProperty;if(By){var BK=function(e){return e.length};BF(zK,function(e){var t=window[e];if(typeof t=="function"||typeof t=="object"){var n=t.prototype,l=By(n,"length");if(!l){var c=FK(n);l=By(c,"length")}if(l&&l.get)IE["$"+e]=DK(l.get);else if(UL){var d=new window[e](2);l=By(d,"length"),l&&l.configurable&&UL(d,"length",{value:3}),d.length===2&&(IE["$"+e]=BK)}}})}var NK=function(t){var n;return BF(IE,function(l){if(typeof n!="number")try{var c=l(t);typeof c=="number"&&(n=c)}catch{}}),n},NF=function(t){return RK(t)?NK(t):!1},$L=Tr,UK=rd,$K=_F,jK=yS,VK=vF,jL=qm,GK=wS,qK=NF,ES=function(t){if(!VK(t))throw new $L("Assertion failed: `taRecord` must be a TypedArray With Buffer Witness Record");var n=t["[[Object]]"],l=t["[[CachedBufferByteLength]]"];if(UK(jL(n))&&l!=="DETACHED")throw new $L("Assertion failed: typed array is detached only if the byte length is ~DETACHED~");if(l==="DETACHED")return!0;var c=GK(n),d=$K(jL(n)),_,w=d?qK(n):"AUTO";if(w==="AUTO")_=l;else{var a=jK(n);_=c+w*a}return c>l||_>l},Ny=Tr,WK=gS,ZK=_F,HK=ES,XK=yS,KK=vF,YK=qm,JK=wS,QK=NF,eY=function(t){if(!KK(t))throw new Ny("Assertion failed: `taRecord` must be a TypedArray With Buffer Witness Record");if(HK(t))throw new Ny("Assertion failed: `taRecord` is out of bounds");var n=t["[[Object]]"],l=ZK(YK(n)),c=l?QK(n):"AUTO";if(c!=="AUTO")return c;if(l)throw new Ny("Assertion failed: array buffer is not fixed length");var d=JK(n),_=XK(n),w=t["[[CachedBufferByteLength]]"];if(w==="DETACHED")throw new Ny("Assertion failed: typed array is detached");return WK((w-d)/_)},Hb=Tr,tY=rd,rY=td,nY=Gm,iY=Jz,oY=sn,sY=oY("SharedArrayBuffer.prototype.byteLength",!0),aY=function(t,n){var l=nY(t);if(!rY(t)&&!l)throw new Hb("Assertion failed: `arrayBuffer` must be an ArrayBuffer or a SharedArrayBuffer");if(n!=="SEQ-CST"&&n!=="UNORDERED")throw new Hb("Assertion failed: `order` must be ~SEQ-CST~ or ~UNORDERED~");if(tY(t))throw new Hb("Assertion failed: `arrayBuffer` must not be detached");return l?sY(t):iY(t)},VL=Tr,lY=aY,uY=rd,cY=id,hY=qm,fY=function(t,n){if(!cY(t))throw new VL("Assertion failed: `obj` must be a Typed Array");if(n!=="SEQ-CST"&&n!=="UNORDERED")throw new VL("Assertion failed: `order` must be ~SEQ-CST~ or ~UNORDERED~");var l=hY(t),c=uY(l)?"DETACHED":lY(l,n);return{"[[Object]]":t,"[[CachedBufferByteLength]]":c}},Uy=Tr,dY=Bu,pY=ES,mY=fY,gY=id,UF=function(t,n){if(n!=="SEQ-CST"&&n!=="UNORDERED")throw new Uy("Assertion failed: `order` must be ~SEQ-CST~ or ~UNORDERED~");if(!dY(t))throw new Uy("Assertion failed: `O` must be an Object");if(!gY(t))throw new Uy("Assertion failed: `O` must be a Typed Array");var l=mY(t,n);if(pY(l))throw new Uy("`O` must be in-bounds and backed by a non-detached buffer");return l},yY=pa,$y=Tr,_Y=mS,vY=gF,xY=ES,bY=eY,wY=UF,EY=Vm(),TY=function(t,n){if(!vY(t))throw new $y("Assertion failed: `constructor` must be a constructor");if(!_Y(n))throw new $y("Assertion failed: `argumentList` must be a List");if(EY.length===0)throw new yY("Assertion failed: Typed Arrays are not supported in this environment");var l;n.length===0?l=new t:n.length===1?l=new t(n[0]):n.length===2?l=new t(n[0],n[1]):l=new t(n[0],n[1],n[2]);var c=wY(l,"SEQ-CST");if(n.length===1&&typeof n[0]=="number"){if(xY(c))throw new $y("new Typed Array is out of bounds");var d=bY(c);if(d<n[0])throw new $y("`argumentList[0]` must be <= `newTypedArray.length`")}return l},Cs=On,SY={__proto__:null,$Int8Array:Cs("%Int8Array%",!0),$Uint8Array:Cs("%Uint8Array%",!0),$Uint8ClampedArray:Cs("%Uint8ClampedArray%",!0),$Int16Array:Cs("%Int16Array%",!0),$Uint16Array:Cs("%Uint16Array%",!0),$Int32Array:Cs("%Int32Array%",!0),$Uint32Array:Cs("%Uint32Array%",!0),$BigInt64Array:Cs("%BigInt64Array%",!0),$BigUint64Array:Cs("%BigUint64Array%",!0),$Float16Array:Cs("%Float16Array%",!0),$Float32Array:Cs("%Float32Array%",!0),$Float64Array:Cs("%Float64Array%",!0)},AY=function(t){return SY["$"+t]},GL=pa,qL=Tr,CY=ed,IY=Vm(),MY=mS,PY=_H,kY=TY,LY=AY,OY=function(t,n){if(IY.length===0)throw new GL("Assertion failed: Typed Arrays are not supported in this environment");var l=CY(t);if(!l)throw new qL("Assertion failed: exemplar must be a TypedArray");if(!MY(n))throw new qL("Assertion failed: `argumentList` must be a List");var c=LY(l);if(typeof c!="function")throw new GL("Assertion failed: `constructor` of `exemplar` ("+l+") must exist. Please report this!");var d=PY(t,c);return kY(d,n)},DY=Tr,RY=nW,zY=HW,FY=rd,Xb=zT,WL=FT,BY=YW,NY=WZ,ZL=YZ,HL=hF,UY=yS,XL=sH,$Y=OY,jY=UF,Kb=qm,KL=wS,$F=function(t,n){var l=this;jY(l,"SEQ-CST");var c=l.length,d=ZL(t),_;d===-1/0?_=0:d<0?_=Xb(c+d,0):_=WL(d,c);var w=typeof n>"u"?c:ZL(n),a;w===-1/0?a=0:w<0?a=Xb(c+w,0):a=WL(w,c);var S=Xb(a-_,0),D=$Y(l,[S]);if(S>0){if(FY(Kb(l)))throw new DY("Cannot use a Typed Array with an underlying ArrayBuffer that is detached");var R=XL(l),I=XL(D);if(R===I)for(var M=Kb(l),N=Kb(D),j=UY(l),W=KL(l),B=_*j+W,k=KL(D),z=k+S*j;k<z;){var Z=zY(M,B,"UINT8",!0,"UNORDERED");NY(N,k,"UINT8",Z,!0,"UNORDERED"),B+=1,k+=1}else for(var ee=0;_<a;){var se=HL(_),ue=RY(l,se);BY(D,HL(ee),ue,!0),_+=1,ee+=1}}return D},VY=$F,jF=function(){return typeof Uint8Array=="function"&&Uint8Array.prototype.slice||VY},GY=Bm,qY=Xc,WY=jF,ZY=function(){if(typeof Uint8Array=="function"){var t=WY(),n=qY(Uint8Array.prototype);GY(n,{slice:t},{slice:function(){return n.slice!==t}})}return t},HY=Bm,XY=Du,KY=$F,VF=jF,YY=ZY,GF=XY(VF());HY(GF,{getPolyfill:VF,implementation:KY,shim:YY});var JY=GF,qF=ed,WF=JY,YL=Pl;function sd(e){return Object.prototype.toString.call(e)}function QY(e){return sd(e)==="[object Date]"}function eJ(e){return sd(e)==="[object RegExp]"}function tJ(e){return sd(e)==="[object Error]"}function rJ(e){return sd(e)==="[object Boolean]"}function nJ(e){return sd(e)==="[object Number]"}function iJ(e){return sd(e)==="[object String]"}var ZF=Array.isArray||function(t){return Object.prototype.toString.call(t)==="[object Array]"};function Yv(e,t){if(e.forEach)return e.forEach(t);for(var n=0;n<e.length;n++)t(e[n],n,e)}var Jv=Object.keys||function(t){var n=[];for(var l in t)n[n.length]=l;return n},oJ=Object.prototype.propertyIsEnumerable,JL=Object.getOwnPropertySymbols;function Qv(e){var t=Jv(e);if(JL)for(var n=JL(e),l=0;l<n.length;l++)oJ.call(e,n[l])&&(t[t.length]=n[l]);return t}var e0=Object.prototype.hasOwnProperty||function(e,t){return t in e};function sJ(e,t){if(typeof YL!="function")return!0;var n=YL(e,t);return!n||!n.writable}function HF(e,t){if(typeof e=="object"&&e!==null){var n;if(ZF(e))n=[];else if(QY(e))n=new Date(e.getTime?e.getTime():e);else if(eJ(e))n=new RegExp(e);else if(tJ(e))n={message:e.message};else if(rJ(e)||nJ(e)||iJ(e))n=Object(e);else{var l=qF(e);if(l)return WF(e);if(Object.create&&Object.getPrototypeOf)n=Object.create(Object.getPrototypeOf(e));else if(e.constructor===Object)n={};else{var c=e.constructor&&e.constructor.prototype||e.__proto__||{},d=function(){};d.prototype=c,n=new d}}var _=t.includeSymbols?Qv:Jv;return Yv(_(e),function(w){n[w]=e[w]}),n}return e}var TS={__proto__:null};function XF(e,t){var n=[],l=[],c=!0,d=arguments.length>2?arguments[2]:TS,_=d.includeSymbols?Qv:Jv,w=!!d.immutable;return function a(S){var D=w?HF(S,d):S,R={__proto__:null},I=!0,M={node:D,node_:S,path:[].concat(n),parent:l[l.length-1],parents:l,key:n[n.length-1],removedKeys:{__proto__:null},isRoot:n.length===0,level:n.length,circular:null,update:function(W,B){M.isRoot||(M.parent.node[M.key]=W),M.node=W,B&&(I=!1)},delete:function(W){delete M.parent.node[M.key],M.parent.removedKeys[M.key]=!0,W&&(I=!1)},remove:function(W){ZF(M.parent.node)?(M.parent.node.splice(M.key,1),M.parent.removedKeys[M.key]=!0,W&&(I=!1)):M.delete(W)},keys:null,before:function(W){R.before=W},after:function(W){R.after=W},pre:function(W){R.pre=W},post:function(W){R.post=W},stop:function(){c=!1},block:function(){I=!1}};if(!c)return M;function N(){if(typeof M.node=="object"&&M.node!==null){(!M.keys||M.node_!==M.node)&&(M.keys=_(M.node)),M.isLeaf=M.keys.length===0;for(var W=0;W<l.length;W++)if(l[W].node_===S){M.circular=l[W];break}}else M.isLeaf=!0,M.keys=null;M.notLeaf=!M.isLeaf,M.notRoot=!M.isRoot}N();var j=t.call(M,M.node);return j!==void 0&&M.update&&M.update(j),R.before&&R.before.call(M,M.node),I&&(typeof M.node=="object"&&M.node!==null&&!M.circular&&(l[l.length]=M,N(),Yv(M.keys,function(W,B){var k=B-1 in M.removedKeys;k&&(W=M.keys[B-1]),n[n.length]=W,R.pre&&R.pre.call(M,M.node[W],W);var z=a(M.node[W]);w&&e0.call(M.node,W)&&!sJ(M.node,W)&&!k&&(M.node[W]=z.node),z.isLast=B===M.keys.length-1,z.isFirst=B===0,R.post&&R.post.call(M,z),n.pop()}),l.pop()),R.after&&R.after.call(M,M.node)),M}(e).node}function zs(e){this.options=arguments.length>1?arguments[1]:TS,this.value=e}zs.prototype.get=function(e){for(var t=this.value,n=0;t&&n<e.length;n++){var l=e[n];if(!e0.call(t,l)||!this.options.includeSymbols&&typeof l=="symbol")return;t=t[l]}return t};zs.prototype.has=function(e){var t=this.value;if(!t&&e.length>0)return!1;for(var n=0;t&&n<e.length;n++){var l=e[n];if(!e0.call(t,l)||!this.options.includeSymbols&&typeof l=="symbol")return!1;t=t[l]}return!0};zs.prototype.set=function(e,t){for(var n=this.value,l=0;l<e.length-1;l++){var c=e[l];e0.call(n,c)||(n[c]={}),n=n[c]}return n[e[l]]=t,t};zs.prototype.map=function(e){return XF(this.value,e,{__proto__:null,immutable:!0,includeSymbols:!!this.options.includeSymbols})};zs.prototype.forEach=function(e){return this.value=XF(this.value,e,this.options),this.value};zs.prototype.reduce=function(e,t){var n=arguments.length===1,l=n?this.value:t;return this.forEach(function(c){(!this.isRoot||!n)&&(l=e.call(this,l,c))}),l};zs.prototype.paths=function(){var e=[];return this.forEach(function(){e[e.length]=this.path}),e};zs.prototype.nodes=function(){var e=[];return this.forEach(function(){e[e.length]=this.node}),e};zs.prototype.clone=function(){var e=[],t=[],n=this.options;return qF(this.value)?WF(this.value):function l(c){for(var d=0;d<e.length;d++)if(e[d]===c)return t[d];if(typeof c=="object"&&c!==null){var _=HF(c,n);e[e.length]=c,t[t.length]=_;var w=n.includeSymbols?Qv:Jv;return Yv(w(c),function(a){_[a]=l(c[a])}),e.pop(),t.pop(),_}return c}(this.value)};function KF(e){var t=arguments.length>1?arguments[1]:TS;return new zs(e,t)}Yv(Qv(zs.prototype),function(e){KF[e]=function(t){var n=[].slice.call(arguments,1),l=new zs(t);return l[e].apply(l,n)}});var aJ=KF,lJ=Oo;function Oo(e){if(!(this instanceof Oo))return new Oo(e);this._bbox=e||[1/0,1/0,-1/0,-1/0],this._valid=!!e}Oo.prototype.include=function(e){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],e[0]),this._bbox[1]=Math.min(this._bbox[1],e[1]),this._bbox[2]=Math.max(this._bbox[2],e[0]),this._bbox[3]=Math.max(this._bbox[3],e[1]),this};Oo.prototype.equals=function(e){var t;return e instanceof Oo?t=e.bbox():t=e,this._bbox[0]==t[0]&&this._bbox[1]==t[1]&&this._bbox[2]==t[2]&&this._bbox[3]==t[3]};Oo.prototype.center=function(e){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null};Oo.prototype.union=function(e){this._valid=!0;var t;return e instanceof Oo?t=e.bbox():t=e,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[2]),this._bbox[3]=Math.max(this._bbox[3],t[3]),this};Oo.prototype.bbox=function(){return this._valid?this._bbox:null};Oo.prototype.contains=function(e){if(!e)return this._fastContains();if(!this._valid)return null;var t=e[0],n=e[1];return this._bbox[0]<=t&&this._bbox[1]<=n&&this._bbox[2]>=t&&this._bbox[3]>=n};Oo.prototype.intersect=function(e){if(!this._valid)return null;var t;return e instanceof Oo?t=e.bbox():t=e,!(this._bbox[0]>t[2]||this._bbox[2]<t[0]||this._bbox[3]<t[1]||this._bbox[1]>t[3])};Oo.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var e="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",e)};Oo.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var uJ=e9,cJ=aJ,hJ=lJ,YF={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},fJ=Object.keys(YF);Wv.exports=function(e){return SS(e).bbox()};Wv.exports.polygon=function(e){return SS(e).polygon()};Wv.exports.bboxify=function(e){return cJ(e).map(function(t){if(t){var n=fJ.some(function(l){return t[l]?YF[l].indexOf(t.type)!==-1:!1});n&&(t.bbox=SS(t).bbox(),this.update(t))}})};function SS(e){for(var t=hJ(),n=uJ(e),l=0;l<n.length;l++)t.include(n[l]);return t}var dJ=Wv.exports;const pJ=dJ,mJ=cn,{LAT_MIN:jy,LAT_MAX:Vy,LAT_RENDERED_MIN:QL,LAT_RENDERED_MAX:e3,LNG_MIN:t3,LNG_MAX:r3}=mJ;var AS=function(e,t){let n=jy,l=Vy,c=jy,d=Vy,_=r3,w=t3;e.forEach(S=>{const D=pJ(S),R=D[1],I=D[3],M=D[0],N=D[2];R>n&&(n=R),I<l&&(l=I),I>c&&(c=I),R<d&&(d=R),M<_&&(_=M),N>w&&(w=N)});const a=t;return n+a.lat>e3&&(a.lat=e3-n),c+a.lat>Vy&&(a.lat=Vy-c),l+a.lat<QL&&(a.lat=QL-l),d+a.lat<jy&&(a.lat=jy-d),_+a.lng<=t3&&(a.lng+=Math.ceil(Math.abs(a.lng)/360)*360),w+a.lng>=r3&&(a.lng-=Math.ceil(Math.abs(a.lng)/360)*360),a};const gJ=AS,rf=cn;var t0=function(e,t){const n=gJ(e.map(l=>l.toGeoJSON()),t);e.forEach(l=>{const c=l.getCoordinates(),d=S=>{const D={lng:S[0]+n.lng,lat:S[1]+n.lat};return[D.lng,D.lat]},_=S=>S.map(D=>d(D)),w=S=>S.map(D=>_(D));let a;l.type===rf.geojsonTypes.POINT?a=d(c):l.type===rf.geojsonTypes.LINE_STRING||l.type===rf.geojsonTypes.MULTI_POINT?a=c.map(d):l.type===rf.geojsonTypes.POLYGON||l.type===rf.geojsonTypes.MULTI_LINE_STRING?a=c.map(_):l.type===rf.geojsonTypes.MULTI_POLYGON&&(a=c.map(w)),l.incomingCoords(a)})};const Bc=Jf,CS=W7,yJ=qv,_J=Nv,rv=Qf,vJ=t0,vi=cn,An={};An.onSetup=function(e){const t={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoveing:!1,canDragMove:!1,initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(t.initiallySelectedFeatureIds.filter(n=>this.getFeature(n)!==void 0)),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),t};An.fireUpdate=function(){this.map.fire(vi.events.UPDATE,{action:vi.updateActions.MOVE,features:this.getSelected().map(e=>e.toGeoJSON())})};An.fireActionable=function(){const e=this.getSelected(),t=e.filter(d=>this.isInstanceOf("MultiFeature",d));let n=!1;if(e.length>1){n=!0;const d=e[0].type.replace("Multi","");e.forEach(_=>{_.type.replace("Multi","")!==d&&(n=!1)})}const l=t.length>0,c=e.length>0;this.setActionableState({combineFeatures:n,uncombineFeatures:l,trash:c})};An.getUniqueIds=function(e){return e.length?e.map(n=>n.properties.id).filter(n=>n!==void 0).reduce((n,l)=>(n.add(l),n),new _J).values():[]};An.stopExtendedInteractions=function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1};An.onStop=function(){rv.enable(this)};An.onMouseMove=function(e){return this.stopExtendedInteractions(e)};An.onMouseOut=function(e){if(e.dragMoving)return this.fireUpdate()};An.onTap=An.onClick=function(e,t){if(Bc.noTarget(t))return this.clickAnywhere(e,t);if(Bc.isOfMetaType(vi.meta.VERTEX)(t))return this.clickOnVertex(e,t);if(Bc.isFeature(t))return this.clickOnFeature(e,t)};An.clickAnywhere=function(e){const t=this.getSelectedIds();t.length&&(this.clearSelectedFeatures(),t.forEach(n=>this.doRender(n))),rv.enable(this),this.stopExtendedInteractions(e)};An.clickOnVertex=function(e,t){this.changeMode(vi.modes.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat}),this.updateUIClasses({mouse:vi.cursors.MOVE})};An.startOnActiveFeature=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(t.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=t.lngLat};An.clickOnFeature=function(e,t){rv.disable(this),this.stopExtendedInteractions(e);const n=Bc.isShiftDown(t),l=this.getSelectedIds(),c=t.featureTarget.properties.id,d=this.isSelected(c);if(!n&&d&&this.getFeature(c).type!==vi.geojsonTypes.POINT)return this.changeMode(vi.modes.DIRECT_SELECT,{featureId:c});d&&n?(this.deselect(c),this.updateUIClasses({mouse:vi.cursors.POINTER}),l.length===1&&rv.enable(this)):!d&&n?(this.select(c),this.updateUIClasses({mouse:vi.cursors.MOVE})):!d&&!n&&(l.forEach(_=>this.doRender(_)),this.setSelected(c),this.updateUIClasses({mouse:vi.cursors.MOVE})),this.doRender(c)};An.onMouseDown=function(e,t){if(Bc.isActiveFeature(t))return this.startOnActiveFeature(e,t);if(this.drawConfig.boxSelect&&Bc.isShiftMousedown(t))return this.startBoxSelect(e,t)};An.startBoxSelect=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=CS(t.originalEvent,this.map.getContainer()),e.canBoxSelect=!0};An.onTouchStart=function(e,t){if(Bc.isActiveFeature(t))return this.startOnActiveFeature(e,t)};An.onDrag=function(e,t){if(e.canDragMove)return this.dragMove(e,t);if(this.drawConfig.boxSelect&&e.canBoxSelect)return this.whileBoxSelect(e,t)};An.whileBoxSelect=function(e,t){e.boxSelecting=!0,this.updateUIClasses({mouse:vi.cursors.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(vi.classes.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));const n=CS(t.originalEvent,this.map.getContainer()),l=Math.min(e.boxSelectStartLocation.x,n.x),c=Math.max(e.boxSelectStartLocation.x,n.x),d=Math.min(e.boxSelectStartLocation.y,n.y),_=Math.max(e.boxSelectStartLocation.y,n.y),w=`translate(${l}px, ${d}px)`;e.boxSelectElement.style.transform=w,e.boxSelectElement.style.WebkitTransform=w,e.boxSelectElement.style.width=`${c-l}px`,e.boxSelectElement.style.height=`${_-d}px`};An.dragMove=function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();const n={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};vJ(this.getSelected(),n),e.dragMoveLocation=t.lngLat};An.onMouseUp=function(e,t){if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){const n=[e.boxSelectStartLocation,CS(t.originalEvent,this.map.getContainer())],l=this.featuresAt(null,n,"click"),c=this.getUniqueIds(l).filter(d=>!this.isSelected(d));c.length&&(this.select(c),c.forEach(d=>this.doRender(d)),this.updateUIClasses({mouse:vi.cursors.MOVE}))}this.stopExtendedInteractions(e)};An.toDisplayFeatures=function(e,t,n){t.properties.active=this.isSelected(t.properties.id)?vi.activeStates.ACTIVE:vi.activeStates.INACTIVE,n(t),this.fireActionable(),!(t.properties.active!==vi.activeStates.ACTIVE||t.geometry.type===vi.geojsonTypes.POINT)&&yJ(t).forEach(n)};An.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()};An.onCombineFeatures=function(){const e=this.getSelected();if(e.length===0||e.length<2)return;const t=[],n=[],l=e[0].type.replace("Multi","");for(let c=0;c<e.length;c++){const d=e[c];if(d.type.replace("Multi","")!==l)return;d.type.includes("Multi")?d.getCoordinates().forEach(_=>{t.push(_)}):t.push(d.getCoordinates()),n.push(d.toGeoJSON())}if(n.length>1){const c=this.newFeature({type:vi.geojsonTypes.FEATURE,properties:n[0].properties,geometry:{type:`Multi${l}`,coordinates:t}});this.addFeature(c),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([c.id]),this.map.fire(vi.events.COMBINE_FEATURES,{createdFeatures:[c.toGeoJSON()],deletedFeatures:n})}this.fireActionable()};An.onUncombineFeatures=function(){const e=this.getSelected();if(e.length===0)return;const t=[],n=[];for(let l=0;l<e.length;l++){const c=e[l];this.isInstanceOf("MultiFeature",c)&&(c.getFeatures().forEach(d=>{this.addFeature(d),d.properties=c.properties,t.push(d.toGeoJSON()),this.select([d.id])}),this.deleteFeature(c.id,{silent:!0}),n.push(c.toGeoJSON()))}t.length>1&&this.map.fire(vi.events.UNCOMBINE_FEATURES,{createdFeatures:t,deletedFeatures:n}),this.fireActionable()};var xJ=An;const{noTarget:JF,isOfMetaType:QF,isInactiveFeature:eB,isShiftDown:n3}=Jf,bJ=qv,wJ=AS,tB=Qf,ko=cn,r0=Jf,EJ=t0,rB=QF(ko.meta.VERTEX),TJ=QF(ko.meta.MIDPOINT),_n={};_n.fireUpdate=function(){this.map.fire(ko.events.UPDATE,{action:ko.updateActions.CHANGE_COORDINATES,features:this.getSelected().map(e=>e.toGeoJSON())})};_n.fireActionable=function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})};_n.startDragging=function(e,t){this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=t.lngLat};_n.stopDragging=function(e){this.map.dragPan.enable(),e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null};_n.onVertex=function(e,t){this.startDragging(e,t);const n=t.featureTarget.properties,l=e.selectedCoordPaths.indexOf(n.coord_path);!n3(t)&&l===-1?e.selectedCoordPaths=[n.coord_path]:n3(t)&&l===-1&&e.selectedCoordPaths.push(n.coord_path);const c=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(c)};_n.onMidpoint=function(e,t){this.startDragging(e,t);const n=t.featureTarget.properties;e.feature.addCoordinate(n.coord_path,n.lng,n.lat),this.fireUpdate(),e.selectedCoordPaths=[n.coord_path]};_n.pathsToCoordinates=function(e,t){return t.map(n=>({feature_id:e,coord_path:n}))};_n.onFeature=function(e,t){e.selectedCoordPaths.length===0?this.startDragging(e,t):this.stopDragging(e)};_n.dragFeature=function(e,t,n){EJ(this.getSelected(),n),e.dragMoveLocation=t.lngLat};_n.dragVertex=function(e,t,n){const l=e.selectedCoordPaths.map(_=>e.feature.getCoordinate(_)),c=l.map(_=>({type:ko.geojsonTypes.FEATURE,properties:{},geometry:{type:ko.geojsonTypes.POINT,coordinates:_}})),d=wJ(c,n);for(let _=0;_<l.length;_++){const w=l[_];e.feature.updateCoordinate(e.selectedCoordPaths[_],w[0]+d.lng,w[1]+d.lat)}};_n.clickNoTarget=function(){this.changeMode(ko.modes.SIMPLE_SELECT)};_n.clickInactive=function(){this.changeMode(ko.modes.SIMPLE_SELECT)};_n.clickActiveFeature=function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()};_n.onSetup=function(e){const t=e.featureId,n=this.getFeature(t);if(!n)throw new Error("You must provide a featureId to enter direct_select mode");if(n.type===ko.geojsonTypes.POINT)throw new TypeError("direct_select mode doesn't handle point features");const l={featureId:t,feature:n,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(t,l.selectedCoordPaths)),this.setSelected(t),tB.disable(this),this.setActionableState({trash:!0}),l};_n.onStop=function(){tB.enable(this),this.clearSelectedCoordinates()};_n.toDisplayFeatures=function(e,t,n){e.featureId===t.properties.id?(t.properties.active=ko.activeStates.ACTIVE,n(t),bJ(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(n)):(t.properties.active=ko.activeStates.INACTIVE,n(t)),this.fireActionable(e)};_n.onTrash=function(e){e.selectedCoordPaths.sort().reverse().forEach(t=>e.feature.removeCoordinate(t)),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),e.feature.isValid()===!1&&(this.deleteFeature([e.featureId]),this.changeMode(ko.modes.SIMPLE_SELECT,{}))};_n.onMouseMove=function(e,t){const n=r0.isActiveFeature(t),l=rB(t),c=e.selectedCoordPaths.length===0;n&&c?this.updateUIClasses({mouse:ko.cursors.MOVE}):l&&!c?this.updateUIClasses({mouse:ko.cursors.MOVE}):this.updateUIClasses({mouse:ko.cursors.NONE}),this.stopDragging(e)};_n.onMouseOut=function(e){e.dragMoving&&this.fireUpdate()};_n.onTouchStart=_n.onMouseDown=function(e,t){if(rB(t))return this.onVertex(e,t);if(r0.isActiveFeature(t))return this.onFeature(e,t);if(TJ(t))return this.onMidpoint(e,t)};_n.onDrag=function(e,t){if(e.canDragMove!==!0)return;e.dragMoving=!0,t.originalEvent.stopPropagation();const n={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,t,n):this.dragFeature(e,t,n),e.dragMoveLocation=t.lngLat};_n.onClick=function(e,t){if(JF(t))return this.clickNoTarget(e,t);if(r0.isActiveFeature(t))return this.clickActiveFeature(e,t);if(eB(t))return this.clickInactive(e,t);this.stopDragging(e)};_n.onTap=function(e,t){if(JF(t))return this.clickNoTarget(e,t);if(r0.isActiveFeature(t))return this.clickActiveFeature(e,t);if(eB(t))return this.clickInactive(e,t)};_n.onTouchEnd=_n.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};var SJ=_n;const i3=Jf,Fa=cn,ja={};ja.onSetup=function(){const e=this.newFeature({type:Fa.geojsonTypes.FEATURE,properties:{},geometry:{type:Fa.geojsonTypes.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:Fa.cursors.ADD}),this.activateUIButton(Fa.types.POINT),this.setActionableState({trash:!0}),{point:e}};ja.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(Fa.modes.SIMPLE_SELECT)};ja.onTap=ja.onClick=function(e,t){this.updateUIClasses({mouse:Fa.cursors.MOVE}),e.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat),this.map.fire(Fa.events.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(Fa.modes.SIMPLE_SELECT,{featureIds:[e.point.id]})};ja.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})};ja.toDisplayFeatures=function(e,t,n){const l=t.properties.id===e.point.id;if(t.properties.active=l?Fa.activeStates.ACTIVE:Fa.activeStates.INACTIVE,!l)return n(t)};ja.onTrash=ja.stopDrawingAndRemove;ja.onKeyUp=function(e,t){if(i3.isEscapeKey(t)||i3.isEnterKey(t))return this.stopDrawingAndRemove(e,t)};var AJ=ja;function CJ(e,t){return e.lngLat?e.lngLat.lng===t[0]&&e.lngLat.lat===t[1]:!1}var nB=CJ;const nv=Jf,iB=Qf,Pi=cn,IJ=nB,o3=Gv,ca={};ca.onSetup=function(){const e=this.newFeature({type:Pi.geojsonTypes.FEATURE,properties:{},geometry:{type:Pi.geojsonTypes.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),iB.disable(this),this.updateUIClasses({mouse:Pi.cursors.ADD}),this.activateUIButton(Pi.types.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}};ca.clickAnywhere=function(e,t){if(e.currentVertexPosition>0&&IJ(t,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(Pi.modes.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:Pi.cursors.ADD}),e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat)};ca.clickOnVertex=function(e){return this.changeMode(Pi.modes.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};ca.onMouseMove=function(e,t){e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),nv.isVertex(t)&&this.updateUIClasses({mouse:Pi.cursors.POINTER})};ca.onTap=ca.onClick=function(e,t){return nv.isVertex(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)};ca.onKeyUp=function(e,t){nv.isEscapeKey(t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(Pi.modes.SIMPLE_SELECT)):nv.isEnterKey(t)&&this.changeMode(Pi.modes.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};ca.onStop=function(e){this.updateUIClasses({mouse:Pi.cursors.NONE}),iB.enable(this),this.activateUIButton(),this.getFeature(e.polygon.id)!==void 0&&(e.polygon.removeCoordinate(`0.${e.currentVertexPosition}`),e.polygon.isValid()?this.map.fire(Pi.events.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(Pi.modes.SIMPLE_SELECT,{},{silent:!0})))};ca.toDisplayFeatures=function(e,t,n){const l=t.properties.id===e.polygon.id;if(t.properties.active=l?Pi.activeStates.ACTIVE:Pi.activeStates.INACTIVE,!l)return n(t);if(t.geometry.coordinates.length===0)return;const c=t.geometry.coordinates[0].length;if(!(c<3)){if(t.properties.meta=Pi.meta.FEATURE,n(o3(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),c>3){const d=t.geometry.coordinates[0].length-3;n(o3(e.polygon.id,t.geometry.coordinates[0][d],`0.${d}`,!1))}if(c<=4){const d=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(n({type:Pi.geojsonTypes.FEATURE,properties:t.properties,geometry:{coordinates:d,type:Pi.geojsonTypes.LINE_STRING}}),c===3)return}return n(t)}};ca.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(Pi.modes.SIMPLE_SELECT)};var MJ=ca;const iv=Jf,s3=nB,oB=Qf,go=cn,PJ=Gv,ha={};ha.onSetup=function(e){e=e||{};const t=e.featureId;let n,l,c="forward";if(t){if(n=this.getFeature(t),!n)throw new Error("Could not find a feature with the provided featureId");let d=e.from;if(d&&d.type==="Feature"&&d.geometry&&d.geometry.type==="Point"&&(d=d.geometry),d&&d.type==="Point"&&d.coordinates&&d.coordinates.length===2&&(d=d.coordinates),!d||!Array.isArray(d))throw new Error("Please use the `from` property to indicate which point to continue the line from");const _=n.coordinates.length-1;if(n.coordinates[_][0]===d[0]&&n.coordinates[_][1]===d[1])l=_+1,n.addCoordinate(l,...n.coordinates[_]);else if(n.coordinates[0][0]===d[0]&&n.coordinates[0][1]===d[1])c="backwards",l=0,n.addCoordinate(l,...n.coordinates[0]);else throw new Error("`from` should match the point at either the start or the end of the provided LineString")}else n=this.newFeature({type:go.geojsonTypes.FEATURE,properties:{},geometry:{type:go.geojsonTypes.LINE_STRING,coordinates:[]}}),l=0,this.addFeature(n);return this.clearSelectedFeatures(),oB.disable(this),this.updateUIClasses({mouse:go.cursors.ADD}),this.activateUIButton(go.types.LINE),this.setActionableState({trash:!0}),{line:n,currentVertexPosition:l,direction:c}};ha.clickAnywhere=function(e,t){if(e.currentVertexPosition>0&&s3(t,e.line.coordinates[e.currentVertexPosition-1])||e.direction==="backwards"&&s3(t,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(go.modes.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:go.cursors.ADD}),e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.direction==="forward"?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)};ha.clickOnVertex=function(e){return this.changeMode(go.modes.SIMPLE_SELECT,{featureIds:[e.line.id]})};ha.onMouseMove=function(e,t){e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),iv.isVertex(t)&&this.updateUIClasses({mouse:go.cursors.POINTER})};ha.onTap=ha.onClick=function(e,t){if(iv.isVertex(t))return this.clickOnVertex(e,t);this.clickAnywhere(e,t)};ha.onKeyUp=function(e,t){iv.isEnterKey(t)?this.changeMode(go.modes.SIMPLE_SELECT,{featureIds:[e.line.id]}):iv.isEscapeKey(t)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(go.modes.SIMPLE_SELECT))};ha.onStop=function(e){oB.enable(this),this.activateUIButton(),this.getFeature(e.line.id)!==void 0&&(e.line.removeCoordinate(`${e.currentVertexPosition}`),e.line.isValid()?this.map.fire(go.events.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(go.modes.SIMPLE_SELECT,{},{silent:!0})))};ha.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(go.modes.SIMPLE_SELECT)};ha.toDisplayFeatures=function(e,t,n){const l=t.properties.id===e.line.id;if(t.properties.active=l?go.activeStates.ACTIVE:go.activeStates.INACTIVE,!l)return n(t);t.geometry.coordinates.length<2||(t.properties.meta=go.meta.FEATURE,n(PJ(e.line.id,t.geometry.coordinates[e.direction==="forward"?t.geometry.coordinates.length-2:1],`${e.direction==="forward"?t.geometry.coordinates.length-2:1}`,!1)),n(t))};var kJ=ha,sB={simple_select:xJ,direct_select:SJ,draw_point:AJ,draw_polygon:MJ,draw_line_string:kJ};const $p=Ll,ME=cn,LJ={defaultMode:ME.modes.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:j7,modes:sB,controls:{},userProperties:!1},OJ={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},DJ={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function a3(e,t){return e.map(n=>n.source?n:$p(n,{id:`${n.id}.${t}`,source:t==="hot"?ME.sources.HOT:ME.sources.COLD}))}var RJ=function(e={}){let t=$p(e);return e.controls||(t.controls={}),e.displayControlsDefault===!1?t.controls=$p(DJ,e.controls):t.controls=$p(OJ,e.controls),t=$p(LJ,t),t.styles=a3(t.styles,"cold").concat(a3(t.styles,"hot")),t},ov={exports:{}};ov.exports;(function(e,t){var n=200,l="__lodash_hash_undefined__",c=1,d=2,_=9007199254740991,w="[object Arguments]",a="[object Array]",S="[object AsyncFunction]",D="[object Boolean]",R="[object Date]",I="[object Error]",M="[object Function]",N="[object GeneratorFunction]",j="[object Map]",W="[object Number]",B="[object Null]",k="[object Object]",z="[object Promise]",Z="[object Proxy]",ee="[object RegExp]",se="[object Set]",ue="[object String]",Te="[object Symbol]",Q="[object Undefined]",he="[object WeakMap]",ye="[object ArrayBuffer]",J="[object DataView]",ie="[object Float32Array]",q="[object Float64Array]",Ke="[object Int8Array]",Mt="[object Int16Array]",ct="[object Int32Array]",He="[object Uint8Array]",_e="[object Uint8ClampedArray]",qe="[object Uint16Array]",Pe="[object Uint32Array]",Le=/[\\^$.*+?()[\]{}|]/g,Pt=/^\[object .+?Constructor\]$/,lt=/^(?:0|[1-9]\d*)$/,at={};at[ie]=at[q]=at[Ke]=at[Mt]=at[ct]=at[He]=at[_e]=at[qe]=at[Pe]=!0,at[w]=at[a]=at[ye]=at[D]=at[J]=at[R]=at[I]=at[M]=at[j]=at[W]=at[k]=at[ee]=at[se]=at[ue]=at[he]=!1;var Jt=typeof window=="object"&&window&&window.Object===Object&&window,Er=typeof self=="object"&&self&&self.Object===Object&&self,Kt=Jt||Er||Function("return this")(),xr=t&&!t.nodeType&&t,Ir=xr&&!0&&e&&!e.nodeType&&e,jr=Ir&&Ir.exports===xr,tr=jr&&Jt.process,jn=function(){try{return tr&&tr.binding&&tr.binding("util")}catch{}}(),Y=jn&&jn.isTypedArray;function mt(ve,je){for(var Et=-1,Gt=ve==null?0:ve.length,Fr=0,pr=[];++Et<Gt;){var bn=ve[Et];je(bn,Et,ve)&&(pr[Fr++]=bn)}return pr}function et(ve,je){for(var Et=-1,Gt=je.length,Fr=ve.length;++Et<Gt;)ve[Fr+Et]=je[Et];return ve}function Ce(ve,je){for(var Et=-1,Gt=ve==null?0:ve.length;++Et<Gt;)if(je(ve[Et],Et,ve))return!0;return!1}function we(ve,je){for(var Et=-1,Gt=Array(ve);++Et<ve;)Gt[Et]=je(Et);return Gt}function $e(ve){return function(je){return ve(je)}}function gt(ve,je){return ve.has(je)}function St(ve,je){return ve==null?void 0:ve[je]}function tt(ve){var je=-1,Et=Array(ve.size);return ve.forEach(function(Gt,Fr){Et[++je]=[Fr,Gt]}),Et}function Lt(ve,je){return function(Et){return ve(je(Et))}}function $t(ve){var je=-1,Et=Array(ve.size);return ve.forEach(function(Gt){Et[++je]=Gt}),Et}var Ot=Array.prototype,Qt=Function.prototype,Mr=Object.prototype,sr=Kt["__core-js_shared__"],vn=Qt.toString,Dn=Mr.hasOwnProperty,Vn=function(){var ve=/[^.]+$/.exec(sr&&sr.keys&&sr.keys.IE_PROTO||"");return ve?"Symbol(src)_1."+ve:""}(),qi=Mr.toString,Jr=RegExp("^"+vn.call(Dn).replace(Le,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Wi=jr?Kt.Buffer:void 0,wi=Kt.Symbol,ti=Kt.Uint8Array,xo=Mr.propertyIsEnumerable,vs=Ot.splice,eo=wi?wi.toStringTag:void 0,Ee=Object.getOwnPropertySymbols,te=Wi?Wi.isBuffer:void 0,re=Lt(Object.keys,Object),xe=ai(Kt,"DataView"),Ie=ai(Kt,"Map"),Fe=ai(Kt,"Promise"),Ge=ai(Kt,"Set"),Ve=ai(Kt,"WeakMap"),ze=ai(Object,"create"),Qe=bo(xe),Ct=bo(Ie),kt=bo(Fe),wt=bo(Ge),ar=bo(Ve),dr=wi?wi.prototype:void 0,nr=dr?dr.valueOf:void 0;function ir(ve){var je=-1,Et=ve==null?0:ve.length;for(this.clear();++je<Et;){var Gt=ve[je];this.set(Gt[0],Gt[1])}}function br(){this.__data__=ze?ze(null):{},this.size=0}function an(ve){var je=this.has(ve)&&delete this.__data__[ve];return this.size-=je?1:0,je}function In(ve){var je=this.__data__;if(ze){var Et=je[ve];return Et===l?void 0:Et}return Dn.call(je,ve)?je[ve]:void 0}function hi(ve){var je=this.__data__;return ze?je[ve]!==void 0:Dn.call(je,ve)}function Rn(ve,je){var Et=this.__data__;return this.size+=this.has(ve)?0:1,Et[ve]=ze&&je===void 0?l:je,this}ir.prototype.clear=br,ir.prototype.delete=an,ir.prototype.get=In,ir.prototype.has=hi,ir.prototype.set=Rn;function ri(ve){var je=-1,Et=ve==null?0:ve.length;for(this.clear();++je<Et;){var Gt=ve[je];this.set(Gt[0],Gt[1])}}function ni(){this.__data__=[],this.size=0}function Ei(ve){var je=this.__data__,Et=Xa(je,ve);if(Et<0)return!1;var Gt=je.length-1;return Et==Gt?je.pop():vs.call(je,Et,1),--this.size,!0}function ga(ve){var je=this.__data__,Et=Xa(je,ve);return Et<0?void 0:je[Et][1]}function ad(ve){return Xa(this.__data__,ve)>-1}function eh(ve,je){var Et=this.__data__,Gt=Xa(Et,ve);return Gt<0?(++this.size,Et.push([ve,je])):Et[Gt][1]=je,this}ri.prototype.clear=ni,ri.prototype.delete=Ei,ri.prototype.get=ga,ri.prototype.has=ad,ri.prototype.set=eh;function wr(ve){var je=-1,Et=ve==null?0:ve.length;for(this.clear();++je<Et;){var Gt=ve[je];this.set(Gt[0],Gt[1])}}function Uu(){this.size=0,this.__data__={hash:new ir,map:new(Ie||ri),string:new ir}}function Za(ve){var je=No(this,ve).delete(ve);return this.size-=je?1:0,je}function $u(ve){return No(this,ve).get(ve)}function Dl(ve){return No(this,ve).has(ve)}function Fo(ve,je){var Et=No(this,ve),Gt=Et.size;return Et.set(ve,je),this.size+=Et.size==Gt?0:1,this}wr.prototype.clear=Uu,wr.prototype.delete=Za,wr.prototype.get=$u,wr.prototype.has=Dl,wr.prototype.set=Fo;function to(ve){var je=-1,Et=ve==null?0:ve.length;for(this.__data__=new wr;++je<Et;)this.add(ve[je])}function ju(ve){return this.__data__.set(ve,l),this}function Vu(ve){return this.__data__.has(ve)}to.prototype.add=to.prototype.push=ju,to.prototype.has=Vu;function Oi(ve){var je=this.__data__=new ri(ve);this.size=je.size}function ns(){this.__data__=new ri,this.size=0}function Ha(ve){var je=this.__data__,Et=je.delete(ve);return this.size=je.size,Et}function ot(ve){return this.__data__.get(ve)}function is(ve){return this.__data__.has(ve)}function Mn(ve,je){var Et=this.__data__;if(Et instanceof ri){var Gt=Et.__data__;if(!Ie||Gt.length<n-1)return Gt.push([ve,je]),this.size=++Et.size,this;Et=this.__data__=new wr(Gt)}return Et.set(ve,je),this.size=Et.size,this}Oi.prototype.clear=ns,Oi.prototype.delete=Ha,Oi.prototype.get=ot,Oi.prototype.has=is,Oi.prototype.set=Mn;function ii(ve,je){var Et=li(ve),Gt=!Et&&_a(ve),Fr=!Et&&!Gt&&el(ve),pr=!Et&&!Gt&&!Fr&&hn(ve),bn=Et||Gt||Fr||pr,zn=bn?we(ve.length,String):[],wn=zn.length;for(var Br in ve)Dn.call(ve,Br)&&!(bn&&(Br=="length"||Fr&&(Br=="offset"||Br=="parent")||pr&&(Br=="buffer"||Br=="byteLength"||Br=="byteOffset")||Ka(Br,wn)))&&zn.push(Br);return zn}function Xa(ve,je){for(var Et=ve.length;Et--;)if(Qa(ve[Et][0],je))return Et;return-1}function Bo(ve,je,Et){var Gt=je(ve);return li(ve)?Gt:et(Gt,Et(ve))}function Fs(ve){return ve==null?ve===void 0?Q:B:eo&&eo in Object(ve)?nn(ve):Ja(ve)}function Gu(ve){return os(ve)&&Fs(ve)==w}function Bs(ve,je,Et,Gt,Fr){return ve===je?!0:ve==null||je==null||!os(ve)&&!os(je)?ve!==ve&&je!==je:zt(ve,je,Et,Gt,Bs,Fr)}function zt(ve,je,Et,Gt,Fr,pr){var bn=li(ve),zn=li(je),wn=bn?a:fi(ve),Br=zn?a:fi(je);wn=wn==w?k:wn,Br=Br==w?k:Br;var Si=wn==k,ui=Br==k,fn=wn==Br;if(fn&&el(ve)){if(!el(je))return!1;bn=!0,Si=!1}if(fn&&!Si)return pr||(pr=new Oi),bn||hn(ve)?ro(ve,je,Et,Gt,Fr,pr):gr(ve,je,wn,Et,Gt,Fr,pr);if(!(Et&c)){var di=Si&&Dn.call(ve,"__wrapped__"),Fn=ui&&Dn.call(je,"__wrapped__");if(di||Fn){var wo=di?ve.value():ve,Di=Fn?je.value():je;return pr||(pr=new Oi),Fr(wo,Di,Et,Gt,pr)}}return fn?(pr||(pr=new Oi),Hi(ve,je,Et,Gt,Fr,pr)):!1}function _r(ve){if(!Zu(ve)||qu(ve))return!1;var je=Ti(ve)?Jr:Pt;return je.test(bo(ve))}function mr(ve){return os(ve)&&Xi(ve.length)&&!!at[Fs(ve)]}function Zi(ve){if(!rh(ve))return re(ve);var je=[];for(var Et in Object(ve))Dn.call(ve,Et)&&Et!="constructor"&&je.push(Et);return je}function ro(ve,je,Et,Gt,Fr,pr){var bn=Et&c,zn=ve.length,wn=je.length;if(zn!=wn&&!(bn&&wn>zn))return!1;var Br=pr.get(ve);if(Br&&pr.get(je))return Br==je;var Si=-1,ui=!0,fn=Et&d?new to:void 0;for(pr.set(ve,je),pr.set(je,ve);++Si<zn;){var di=ve[Si],Fn=je[Si];if(Gt)var wo=bn?Gt(Fn,di,Si,je,ve,pr):Gt(di,Fn,Si,ve,je,pr);if(wo!==void 0){if(wo)continue;ui=!1;break}if(fn){if(!Ce(je,function(Di,Eo){if(!gt(fn,Eo)&&(di===Di||Fr(di,Di,Et,Gt,pr)))return fn.push(Eo)})){ui=!1;break}}else if(!(di===Fn||Fr(di,Fn,Et,Gt,pr))){ui=!1;break}}return pr.delete(ve),pr.delete(je),ui}function gr(ve,je,Et,Gt,Fr,pr,bn){switch(Et){case J:if(ve.byteLength!=je.byteLength||ve.byteOffset!=je.byteOffset)return!1;ve=ve.buffer,je=je.buffer;case ye:return!(ve.byteLength!=je.byteLength||!pr(new ti(ve),new ti(je)));case D:case R:case W:return Qa(+ve,+je);case I:return ve.name==je.name&&ve.message==je.message;case ee:case ue:return ve==je+"";case j:var zn=tt;case se:var wn=Gt&c;if(zn||(zn=$t),ve.size!=je.size&&!wn)return!1;var Br=bn.get(ve);if(Br)return Br==je;Gt|=d,bn.set(ve,je);var Si=ro(zn(ve),zn(je),Gt,Fr,pr,bn);return bn.delete(ve),Si;case Te:if(nr)return nr.call(ve)==nr.call(je)}return!1}function Hi(ve,je,Et,Gt,Fr,pr){var bn=Et&c,zn=ya(ve),wn=zn.length,Br=ya(je),Si=Br.length;if(wn!=Si&&!bn)return!1;for(var ui=wn;ui--;){var fn=zn[ui];if(!(bn?fn in je:Dn.call(je,fn)))return!1}var di=pr.get(ve);if(di&&pr.get(je))return di==je;var Fn=!0;pr.set(ve,je),pr.set(je,ve);for(var wo=bn;++ui<wn;){fn=zn[ui];var Di=ve[fn],Eo=je[fn];if(Gt)var Xu=bn?Gt(Eo,Di,fn,je,ve,pr):Gt(Di,Eo,fn,ve,je,pr);if(!(Xu===void 0?Di===Eo||Fr(Di,Eo,Et,Gt,pr):Xu)){Fn=!1;break}wo||(wo=fn=="constructor")}if(Fn&&!wo){var Us=ve.constructor,va=je.constructor;Us!=va&&"constructor"in ve&&"constructor"in je&&!(typeof Us=="function"&&Us instanceof Us&&typeof va=="function"&&va instanceof va)&&(Fn=!1)}return pr.delete(ve),pr.delete(je),Fn}function ya(ve){return Bo(ve,tl,th)}function No(ve,je){var Et=ve.__data__;return Ya(je)?Et[typeof je=="string"?"string":"hash"]:Et.map}function ai(ve,je){var Et=St(ve,je);return _r(Et)?Et:void 0}function nn(ve){var je=Dn.call(ve,eo),Et=ve[eo];try{ve[eo]=void 0;var Gt=!0}catch{}var Fr=qi.call(ve);return Gt&&(je?ve[eo]=Et:delete ve[eo]),Fr}var th=Ee?function(ve){return ve==null?[]:(ve=Object(ve),mt(Ee(ve),function(je){return xo.call(ve,je)}))}:Hu,fi=Fs;(xe&&fi(new xe(new ArrayBuffer(1)))!=J||Ie&&fi(new Ie)!=j||Fe&&fi(Fe.resolve())!=z||Ge&&fi(new Ge)!=se||Ve&&fi(new Ve)!=he)&&(fi=function(ve){var je=Fs(ve),Et=je==k?ve.constructor:void 0,Gt=Et?bo(Et):"";if(Gt)switch(Gt){case Qe:return J;case Ct:return j;case kt:return z;case wt:return se;case ar:return he}return je});function Ka(ve,je){return je=je??_,!!je&&(typeof ve=="number"||lt.test(ve))&&ve>-1&&ve%1==0&&ve<je}function Ya(ve){var je=typeof ve;return je=="string"||je=="number"||je=="symbol"||je=="boolean"?ve!=="__proto__":ve===null}function qu(ve){return!!Vn&&Vn in ve}function rh(ve){var je=ve&&ve.constructor,Et=typeof je=="function"&&je.prototype||Mr;return ve===Et}function Ja(ve){return qi.call(ve)}function bo(ve){if(ve!=null){try{return vn.call(ve)}catch{}try{return ve+""}catch{}}return""}function Qa(ve,je){return ve===je||ve!==ve&&je!==je}var _a=Gu(function(){return arguments}())?Gu:function(ve){return os(ve)&&Dn.call(ve,"callee")&&!xo.call(ve,"callee")},li=Array.isArray;function xn(ve){return ve!=null&&Xi(ve.length)&&!Ti(ve)}var el=te||Ns;function Wu(ve,je){return Bs(ve,je)}function Ti(ve){if(!Zu(ve))return!1;var je=Fs(ve);return je==M||je==N||je==S||je==Z}function Xi(ve){return typeof ve=="number"&&ve>-1&&ve%1==0&&ve<=_}function Zu(ve){var je=typeof ve;return ve!=null&&(je=="object"||je=="function")}function os(ve){return ve!=null&&typeof ve=="object"}var hn=Y?$e(Y):mr;function tl(ve){return xn(ve)?ii(ve):Zi(ve)}function Hu(){return[]}function Ns(){return!1}e.exports=Wu})(ov,ov.exports);var zJ=ov.exports,FJ=function(e,t){return e.length!==t.length?!1:JSON.stringify(e.map(n=>n).sort())===JSON.stringify(t.map(n=>n).sort())},aB={};function jp(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var PE={exports:{}};(function(e,t){var n=function(){var l=function(B,k,z,Z){for(z=z||{},Z=B.length;Z--;z[B[Z]]=k);return z},c=[1,12],d=[1,13],_=[1,9],w=[1,10],a=[1,11],S=[1,14],D=[1,15],R=[14,18,22,24],I=[18,22],M=[22,24],N={trace:function(){},yy:{},symbols_:{error:2,JSONString:3,STRING:4,JSONNumber:5,NUMBER:6,JSONNullLiteral:7,NULL:8,JSONBooleanLiteral:9,TRUE:10,FALSE:11,JSONText:12,JSONValue:13,EOF:14,JSONObject:15,JSONArray:16,"{":17,"}":18,JSONMemberList:19,JSONMember:20,":":21,",":22,"[":23,"]":24,JSONElementList:25,$accept:0,$end:1},terminals_:{2:"error",4:"STRING",6:"NUMBER",8:"NULL",10:"TRUE",11:"FALSE",14:"EOF",17:"{",18:"}",21:":",22:",",23:"[",24:"]"},productions_:[0,[3,1],[5,1],[7,1],[9,1],[9,1],[12,2],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[15,2],[15,3],[20,3],[19,1],[19,3],[16,2],[16,3],[25,1],[25,3]],performAction:function(k,z,Z,ee,se,ue,Te){var Q=ue.length-1;switch(se){case 1:this.$=k.replace(/\\(\\|")/g,"$1").replace(/\\n/g,`
`).replace(/\\r/g,"\r").replace(/\\t/g,"	").replace(/\\v/g,"\v").replace(/\\f/g,"\f").replace(/\\b/g,"\b");break;case 2:this.$=Number(k);break;case 3:this.$=null;break;case 4:this.$=!0;break;case 5:this.$=!1;break;case 6:return this.$=ue[Q-1];case 13:this.$={},Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 14:case 19:this.$=ue[Q-1],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 15:this.$=[ue[Q-2],ue[Q]];break;case 16:this.$={},this.$[ue[Q][0]]=ue[Q][1];break;case 17:this.$=ue[Q-2],ue[Q-2][ue[Q][0]]!==void 0&&(this.$.__duplicateProperties__||Object.defineProperty(this.$,"__duplicateProperties__",{value:[],enumerable:!1}),this.$.__duplicateProperties__.push(ue[Q][0])),ue[Q-2][ue[Q][0]]=ue[Q][1];break;case 18:this.$=[],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 20:this.$=[ue[Q]];break;case 21:this.$=ue[Q-2],ue[Q-2].push(ue[Q]);break}},table:[{3:5,4:c,5:6,6:d,7:3,8:_,9:4,10:w,11:a,12:1,13:2,15:7,16:8,17:S,23:D},{1:[3]},{14:[1,16]},l(R,[2,7]),l(R,[2,8]),l(R,[2,9]),l(R,[2,10]),l(R,[2,11]),l(R,[2,12]),l(R,[2,3]),l(R,[2,4]),l(R,[2,5]),l([14,18,21,22,24],[2,1]),l(R,[2,2]),{3:20,4:c,18:[1,17],19:18,20:19},{3:5,4:c,5:6,6:d,7:3,8:_,9:4,10:w,11:a,13:23,15:7,16:8,17:S,23:D,24:[1,21],25:22},{1:[2,6]},l(R,[2,13]),{18:[1,24],22:[1,25]},l(I,[2,16]),{21:[1,26]},l(R,[2,18]),{22:[1,28],24:[1,27]},l(M,[2,20]),l(R,[2,14]),{3:20,4:c,20:29},{3:5,4:c,5:6,6:d,7:3,8:_,9:4,10:w,11:a,13:30,15:7,16:8,17:S,23:D},l(R,[2,19]),{3:5,4:c,5:6,6:d,7:3,8:_,9:4,10:w,11:a,13:31,15:7,16:8,17:S,23:D},l(I,[2,17]),l(I,[2,15]),l(M,[2,21])],defaultActions:{16:[2,6]},parseError:function(k,z){if(z.recoverable)this.trace(k);else{let ee=function(se,ue){this.message=se,this.hash=ue};var Z=ee;throw ee.prototype=Error,new ee(k,z)}},parse:function(k){var z=this,Z=[0],ee=[null],se=[],ue=this.table,Te="",Q=0,he=0,ye=2,J=1,ie=se.slice.call(arguments,1),q=Object.create(this.lexer),Ke={yy:{}};for(var Mt in this.yy)Object.prototype.hasOwnProperty.call(this.yy,Mt)&&(Ke.yy[Mt]=this.yy[Mt]);q.setInput(k,Ke.yy),Ke.yy.lexer=q,Ke.yy.parser=this,typeof q.yylloc>"u"&&(q.yylloc={});var ct=q.yylloc;se.push(ct);var He=q.options&&q.options.ranges;typeof Ke.yy.parseError=="function"?this.parseError=Ke.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var _e=function(){var Ir;return Ir=q.lex()||J,typeof Ir!="number"&&(Ir=z.symbols_[Ir]||Ir),Ir},qe,Pe,Le,Pt,lt={},at,Jt,Er,Kt;;){if(Pe=Z[Z.length-1],this.defaultActions[Pe]?Le=this.defaultActions[Pe]:((qe===null||typeof qe>"u")&&(qe=_e()),Le=ue[Pe]&&ue[Pe][qe]),typeof Le>"u"||!Le.length||!Le[0]){var xr="";Kt=[];for(at in ue[Pe])this.terminals_[at]&&at>ye&&Kt.push("'"+this.terminals_[at]+"'");q.showPosition?xr="Parse error on line "+(Q+1)+`:
`+q.showPosition()+`
Expecting `+Kt.join(", ")+", got '"+(this.terminals_[qe]||qe)+"'":xr="Parse error on line "+(Q+1)+": Unexpected "+(qe==J?"end of input":"'"+(this.terminals_[qe]||qe)+"'"),this.parseError(xr,{text:q.match,token:this.terminals_[qe]||qe,line:q.yylineno,loc:ct,expected:Kt})}if(Le[0]instanceof Array&&Le.length>1)throw new Error("Parse Error: multiple actions possible at state: "+Pe+", token: "+qe);switch(Le[0]){case 1:Z.push(qe),ee.push(q.yytext),se.push(q.yylloc),Z.push(Le[1]),qe=null,he=q.yyleng,Te=q.yytext,Q=q.yylineno,ct=q.yylloc;break;case 2:if(Jt=this.productions_[Le[1]][1],lt.$=ee[ee.length-Jt],lt._$={first_line:se[se.length-(Jt||1)].first_line,last_line:se[se.length-1].last_line,first_column:se[se.length-(Jt||1)].first_column,last_column:se[se.length-1].last_column},He&&(lt._$.range=[se[se.length-(Jt||1)].range[0],se[se.length-1].range[1]]),Pt=this.performAction.apply(lt,[Te,he,Q,Ke.yy,Le[1],ee,se].concat(ie)),typeof Pt<"u")return Pt;Jt&&(Z=Z.slice(0,-1*Jt*2),ee=ee.slice(0,-1*Jt),se=se.slice(0,-1*Jt)),Z.push(this.productions_[Le[1]][0]),ee.push(lt.$),se.push(lt._$),Er=ue[Z[Z.length-2]][Z[Z.length-1]],Z.push(Er);break;case 3:return!0}}return!0}},j=function(){var B={EOF:1,parseError:function(z,Z){if(this.yy.parser)this.yy.parser.parseError(z,Z);else throw new Error(z)},setInput:function(k,z){return this.yy=z||this.yy||{},this._input=k,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var k=this._input[0];this.yytext+=k,this.yyleng++,this.offset++,this.match+=k,this.matched+=k;var z=k.match(/(?:\r\n?|\n).*/g);return z?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),k},unput:function(k){var z=k.length,Z=k.split(/(?:\r\n?|\n)/g);this._input=k+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-z),this.offset-=z;var ee=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),Z.length-1&&(this.yylineno-=Z.length-1);var se=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:Z?(Z.length===ee.length?this.yylloc.first_column:0)+ee[ee.length-Z.length].length-Z[0].length:this.yylloc.first_column-z},this.options.ranges&&(this.yylloc.range=[se[0],se[0]+this.yyleng-z]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(k){this.unput(this.match.slice(k))},pastInput:function(){var k=this.matched.substr(0,this.matched.length-this.match.length);return(k.length>20?"...":"")+k.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var k=this.match;return k.length<20&&(k+=this._input.substr(0,20-k.length)),(k.substr(0,20)+(k.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var k=this.pastInput(),z=new Array(k.length+1).join("-");return k+this.upcomingInput()+`
`+z+"^"},test_match:function(k,z){var Z,ee,se;if(this.options.backtrack_lexer&&(se={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(se.yylloc.range=this.yylloc.range.slice(0))),ee=k[0].match(/(?:\r\n?|\n).*/g),ee&&(this.yylineno+=ee.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:ee?ee[ee.length-1].length-ee[ee.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+k[0].length},this.yytext+=k[0],this.match+=k[0],this.matches=k,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(k[0].length),this.matched+=k[0],Z=this.performAction.call(this,this.yy,this,z,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),Z)return Z;if(this._backtrack){for(var ue in se)this[ue]=se[ue];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var k,z,Z,ee;this._more||(this.yytext="",this.match="");for(var se=this._currentRules(),ue=0;ue<se.length;ue++)if(Z=this._input.match(this.rules[se[ue]]),Z&&(!z||Z[0].length>z[0].length)){if(z=Z,ee=ue,this.options.backtrack_lexer){if(k=this.test_match(Z,se[ue]),k!==!1)return k;if(this._backtrack){z=!1;continue}else return!1}else if(!this.options.flex)break}return z?(k=this.test_match(z,se[ee]),k!==!1?k:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var z=this.next();return z||this.lex()},begin:function(z){this.conditionStack.push(z)},popState:function(){var z=this.conditionStack.length-1;return z>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(z){return z=this.conditionStack.length-1-Math.abs(z||0),z>=0?this.conditionStack[z]:"INITIAL"},pushState:function(z){this.begin(z)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(z,Z,ee,se){switch(ee){case 0:break;case 1:return 6;case 2:return Z.yytext=Z.yytext.substr(1,Z.yyleng-2),4;case 3:return 17;case 4:return 18;case 5:return 23;case 6:return 24;case 7:return 22;case 8:return 21;case 9:return 10;case 10:return 11;case 11:return 8;case 12:return 14;case 13:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\.[0-9]+)?([eE][-+]?[0-9]+)?\b)/,/^(?:"(?:\\[\\"bfnrt\/]|\\u[a-fA-F0-9]{4}|[^\\\0-\x09\x0a-\x1f"])*")/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?::)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}};return B}();N.lexer=j;function W(){this.yy={}}return W.prototype=N,N.Parser=W,new W}();typeof jp<"u"&&(t.parser=n,t.Parser=n.Parser,t.parse=function(){return n.parse.apply(n,arguments)},t.main=function(c){c[1]||(console.log("Usage: "+c[0]+" FILE"),process.exit(1));var d=gE.readFileSync(gE.normalize(c[1]),"utf8");return t.parser.parse(d)},require.main===e&&t.main(process.argv.slice(1)))})(PE,PE.exports);var BJ=PE.exports,lB={};function Yb(e){return e*Math.PI/180}function l3(e){var t=0;if(e.length>2)for(var n,l,c=0;c<e.length-1;c++)n=e[c],l=e[c+1],t+=Yb(l[0]-n[0])*(2+Math.sin(Yb(n[1]))+Math.sin(Yb(l[1])));return t>=0}function u3(e){if(e&&e.length>0){if(l3(e[0]))return!1;var t=e.slice(1,e.length);if(!t.every(l3))return!1}return!0}function NJ(e){if(e.type==="Polygon")return u3(e.coordinates);if(e.type==="MultiPolygon")return e.coordinates.every(u3)}var UJ=function(t,n){NJ(t)||n.push({message:"Polygons and MultiPolygons should follow the right-hand rule",level:"message",line:t.__line__})},c3=UJ;function $J(e,t){var n=[],l=0,c=10,d=6;function _(Q){if((!t||t.noDuplicateMembers!==!1)&&Q.__duplicateProperties__&&n.push({message:"An object contained duplicate members, making parsing ambigous: "+Q.__duplicateProperties__.join(", "),line:Q.__line__}),!a(Q,"type","string"))if(ue[Q.type])Q&&ue[Q.type](Q);else{var he=Te[Q.type.toLowerCase()];he!==void 0?n.push({message:"Expected "+he+" but got "+Q.type+" (case sensitive)",line:Q.__line__}):n.push({message:"The type "+Q.type+" is unknown",line:Q.__line__})}}function w(Q,he){return Q.every(function(ye){return ye!==null&&typeof ye===he})}function a(Q,he,ye){if(typeof Q[he]>"u")return n.push({message:'"'+he+'" member required',line:Q.__line__});if(ye==="array"){if(!Array.isArray(Q[he]))return n.push({message:'"'+he+'" member should be an array, but is an '+typeof Q[he]+" instead",line:Q.__line__})}else{if(ye==="object"&&Q[he]&&Q[he].constructor!==Object)return n.push({message:'"'+he+'" member should be '+ye+", but is an "+Q[he].constructor.name+" instead",line:Q.__line__});if(ye&&typeof Q[he]!==ye)return n.push({message:'"'+he+'" member should be '+ye+", but is an "+typeof Q[he]+" instead",line:Q.__line__})}}function S(Q){if(I(Q),M(Q),Q.properties!==void 0&&n.push({message:'FeatureCollection object cannot contain a "properties" member',line:Q.__line__}),Q.coordinates!==void 0&&n.push({message:'FeatureCollection object cannot contain a "coordinates" member',line:Q.__line__}),!a(Q,"features","array")){if(!w(Q.features,"object"))return n.push({message:"Every feature must be an object",line:Q.__line__});Q.features.forEach(se)}}function D(Q,he){if(!Array.isArray(Q))return n.push({message:"position should be an array, is a "+typeof Q+" instead",line:Q.__line__||he});if(Q.length<2)return n.push({message:"position must have 2 or more elements",line:Q.__line__||he});if(Q.length>3)return n.push({message:"position should not have more than 3 elements",level:"message",line:Q.__line__||he});if(!w(Q,"number"))return n.push({message:"each element in a position must be a number",line:Q.__line__||he});if(t&&t.precisionWarning){if(l===c)return l+=1,n.push({message:"truncated warnings: we've encountered coordinate precision warning "+c+" times, no more warnings will be reported",level:"message",line:Q.__line__||he});l<c&&Q.forEach(function(ye){var J=0,ie=String(ye).split(".")[1];if(ie!==void 0&&(J=ie.length),J>d)return l+=1,n.push({message:"precision of coordinates should be reduced",level:"message",line:Q.__line__||he})})}}function R(Q,he,ye,J){if(J===void 0&&Q.__line__!==void 0&&(J=Q.__line__),ye===0)return D(Q,J);if(ye===1&&he){if(he==="LinearRing"){if(!Array.isArray(Q[Q.length-1]))return n.push({message:"a number was found where a coordinate array should have been found: this needs to be nested more deeply",line:J}),!0;if(Q.length<4&&n.push({message:"a LinearRing of coordinates needs to have four or more positions",line:J}),Q.length&&(Q[Q.length-1].length!==Q[0].length||!Q[Q.length-1].every(function(q,Ke){return Q[0][Ke]===q})))return n.push({message:"the first and last positions in a LinearRing of coordinates must be the same",line:J}),!0}else if(he==="Line"&&Q.length<2)return n.push({message:"a line needs to have two or more coordinates to be valid",line:J})}if(!Array.isArray(Q))n.push({message:"a number was found where a coordinate array should have been found: this needs to be nested more deeply",line:J});else{var ie=Q.map(function(q){return R(q,he,ye-1,q.__line__||J)});return ie.some(function(q){return q})}}function I(Q){if(Q.crs){var he="urn:ogc:def:crs:OGC:1.3:CRS84";typeof Q.crs=="object"&&Q.crs.properties&&Q.crs.properties.name===he?n.push({message:"old-style crs member is not recommended, this object is equivalent to the default and should be removed",line:Q.__line__}):n.push({message:"old-style crs member is not recommended",line:Q.__line__})}}function M(Q){if(Q.bbox){if(Array.isArray(Q.bbox))return w(Q.bbox,"number")||n.push({message:"each element in a bbox member must be a number",line:Q.bbox.__line__}),Q.bbox.length===4||Q.bbox.length===6||n.push({message:"bbox must contain 4 elements (for 2D) or 6 elements (for 3D)",line:Q.bbox.__line__}),n.length;n.push({message:"bbox member must be an array of numbers, but is a "+typeof Q.bbox,line:Q.__line__})}}function N(Q){Q.properties!==void 0&&n.push({message:'geometry object cannot contain a "properties" member',line:Q.__line__}),Q.geometry!==void 0&&n.push({message:'geometry object cannot contain a "geometry" member',line:Q.__line__}),Q.features!==void 0&&n.push({message:'geometry object cannot contain a "features" member',line:Q.__line__})}function j(Q){I(Q),M(Q),N(Q),a(Q,"coordinates","array")||D(Q.coordinates)}function W(Q){I(Q),M(Q),a(Q,"coordinates","array")||R(Q.coordinates,"LinearRing",2)||c3(Q,n)}function B(Q){I(Q),M(Q),a(Q,"coordinates","array")||R(Q.coordinates,"LinearRing",3)||c3(Q,n)}function k(Q){I(Q),M(Q),a(Q,"coordinates","array")||R(Q.coordinates,"Line",1)}function z(Q){I(Q),M(Q),a(Q,"coordinates","array")||R(Q.coordinates,"Line",2)}function Z(Q){I(Q),M(Q),a(Q,"coordinates","array")||R(Q.coordinates,"",1)}function ee(Q){I(Q),M(Q),a(Q,"geometries","array")||(w(Q.geometries,"object")||n.push({message:"The geometries array in a GeometryCollection must contain only geometry objects",line:Q.__line__}),Q.geometries.length===1&&n.push({message:"GeometryCollection with a single geometry should be avoided in favor of single part or a single object of multi-part type",line:Q.geometries.__line__}),Q.geometries.forEach(function(he){he&&(he.type==="GeometryCollection"&&n.push({message:"GeometryCollection should avoid nested geometry collections",line:Q.geometries.__line__}),_(he))}))}function se(Q){I(Q),M(Q),Q.id!==void 0&&typeof Q.id!="string"&&typeof Q.id!="number"&&n.push({message:'Feature "id" member must have a string or number value',line:Q.__line__}),Q.features!==void 0&&n.push({message:'Feature object cannot contain a "features" member',line:Q.__line__}),Q.coordinates!==void 0&&n.push({message:'Feature object cannot contain a "coordinates" member',line:Q.__line__}),Q.type!=="Feature"&&n.push({message:"GeoJSON features must have a type=feature member",line:Q.__line__}),a(Q,"properties","object"),a(Q,"geometry","object")||Q.geometry&&_(Q.geometry)}var ue={Point:j,Feature:se,MultiPoint:Z,LineString:k,MultiLineString:z,FeatureCollection:S,GeometryCollection:ee,Polygon:W,MultiPolygon:B},Te=Object.keys(ue).reduce(function(Q,he){return Q[he.toLowerCase()]=he,Q},{});return typeof e!="object"||e===null||e===void 0?(n.push({message:"The root of a GeoJSON object must be an object.",line:0}),n):(_(e),n.forEach(function(Q){({}).hasOwnProperty.call(Q,"line")&&Q.line===void 0&&delete Q.line}),n)}lB.hint=$J;var jJ=BJ,VJ=lB;function GJ(e,t){var n,l=[];if(typeof e=="object")n=e;else if(typeof e=="string")try{n=jJ.parse(e)}catch(_){var c=_.message.match(/line (\d+)/),d=parseInt(c[1],10);return[{line:d-1,message:_.message,error:_}]}else return[{message:"Expected string or object as input",line:0}];return l=l.concat(VJ.hint(n,t)),l}aB.hint=GJ;const qJ=zJ,WJ=JT,ZJ=oS,HJ=Uv,XJ=FJ,KJ=aB,So=cn,YJ=Nv,JJ={Polygon:lS,LineString:aS,Point:sS,MultiPolygon:u_,MultiLineString:u_,MultiPoint:u_};var QJ=function(e,t){return t.modes=So.modes,t.getFeatureIdsAt=function(n){return HJ.click({point:n},null,e).map(c=>c.properties.id)},t.getSelectedIds=function(){return e.store.getSelectedIds()},t.getSelected=function(){return{type:So.geojsonTypes.FEATURE_COLLECTION,features:e.store.getSelectedIds().map(n=>e.store.get(n)).map(n=>n.toGeoJSON())}},t.getSelectedPoints=function(){return{type:So.geojsonTypes.FEATURE_COLLECTION,features:e.store.getSelectedCoordinates().map(n=>({type:So.geojsonTypes.FEATURE,properties:{},geometry:{type:So.geojsonTypes.POINT,coordinates:n.coordinates}}))}},t.set=function(n){if(n.type===void 0||n.type!==So.geojsonTypes.FEATURE_COLLECTION||!Array.isArray(n.features))throw new Error("Invalid FeatureCollection");const l=e.store.createRenderBatch();let c=e.store.getAllIds().slice();const d=t.add(n),_=new YJ(d);return c=c.filter(w=>!_.has(w)),c.length&&t.delete(c),l(),d},t.add=function(n){const l=KJ.hint(n,{precisionWarning:!1}).filter(_=>_.level!=="message");if(l.length)throw new Error(l[0].message);const d=JSON.parse(JSON.stringify(WJ(n))).features.map(_=>{if(_.id=_.id||ZJ(),_.geometry===null)throw new Error("Invalid geometry: null");if(e.store.get(_.id)===void 0||e.store.get(_.id).type!==_.geometry.type){const w=JJ[_.geometry.type];if(w===void 0)throw new Error(`Invalid geometry type: ${_.geometry.type}.`);const a=new w(e,_);e.store.add(a)}else{const w=e.store.get(_.id);w.properties=_.properties,qJ(w.getCoordinates(),_.geometry.coordinates)||w.incomingCoords(_.geometry.coordinates)}return _.id});return e.store.render(),d},t.get=function(n){const l=e.store.get(n);if(l)return l.toGeoJSON()},t.getAll=function(){return{type:So.geojsonTypes.FEATURE_COLLECTION,features:e.store.getAll().map(n=>n.toGeoJSON())}},t.delete=function(n){return e.store.delete(n,{silent:!0}),t.getMode()===So.modes.DIRECT_SELECT&&!e.store.getSelectedIds().length?e.events.changeMode(So.modes.SIMPLE_SELECT,void 0,{silent:!0}):e.store.render(),t},t.deleteAll=function(){return e.store.delete(e.store.getAllIds(),{silent:!0}),t.getMode()===So.modes.DIRECT_SELECT?e.events.changeMode(So.modes.SIMPLE_SELECT,void 0,{silent:!0}):e.store.render(),t},t.changeMode=function(n,l={}){return n===So.modes.SIMPLE_SELECT&&t.getMode()===So.modes.SIMPLE_SELECT?(XJ(l.featureIds||[],e.store.getSelectedIds())||(e.store.setSelected(l.featureIds,{silent:!0}),e.store.render()),t):(n===So.modes.DIRECT_SELECT&&t.getMode()===So.modes.DIRECT_SELECT&&l.featureId===e.store.getSelectedIds()[0]||e.events.changeMode(n,l,{silent:!0}),t)},t.getMode=function(){return e.events.getMode()},t.trash=function(){return e.events.trash({silent:!0}),t},t.combineFeatures=function(){return e.events.combineFeatures({silent:!0}),t},t.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:!0}),t},t.setFeatureProperty=function(n,l,c){return e.store.setFeatureProperty(n,l,c),t},t};const eQ=$7,tQ=RJ,rQ=QJ,nQ=cn,iQ=function(e,t){e=tQ(e);const n={options:e};t=rQ(n,t),n.api=t;const l=eQ(n);return t.onAdd=l.onAdd,t.onRemove=l.onRemove,t.types=nQ.types,t.options=e,t};iS.exports=function(e){iQ(e,this)};iS.exports.modes=sB;var n0=iS.exports;const IS=Cm(KU),oQ=n0,Vp=cn,sQ=Qf,aQ=IS.default,uB={...oQ.modes.draw_polygon},lQ=2;uB.onSetup=function(e){const t=this.newFeature({type:Vp.geojsonTypes.FEATURE,properties:{isCircle:!0,center:[]},geometry:{type:Vp.geojsonTypes.POLYGON,coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),sQ.disable(this),this.updateUIClasses({mouse:Vp.cursors.ADD}),this.activateUIButton(Vp.types.POLYGON),this.setActionableState({trash:!0}),{initialRadiusInKm:e.initialRadiusInKm||lQ,polygon:t,currentVertexPosition:0}};uB.clickAnywhere=function(e,t){if(e.currentVertexPosition===0){e.currentVertexPosition++;const n=[t.lngLat.lng,t.lngLat.lat],l=aQ(n,e.initialRadiusInKm);e.polygon.incomingCoords(l.geometry.coordinates),e.polygon.properties.center=n,e.polygon.properties.radiusInKm=e.initialRadiusInKm}return this.changeMode(Vp.modes.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};var uQ={enable(e){setTimeout(()=>{!e.map||!e.map.dragPan||!e._ctx||!e._ctx.store||!e._ctx.store.getInitialConfigValue||e._ctx.store.getInitialConfigValue("dragPan")&&e.map.dragPan.enable()},0)},disable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||e.map.dragPan.disable()},0)}};const cB=Cm(jU);var MS={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.earthRadius=63710088e-1,e.factors={centimeters:e.earthRadius*100,centimetres:e.earthRadius*100,degrees:e.earthRadius/111325,feet:e.earthRadius*3.28084,inches:e.earthRadius*39.37,kilometers:e.earthRadius/1e3,kilometres:e.earthRadius/1e3,meters:e.earthRadius,metres:e.earthRadius,miles:e.earthRadius/1609.344,millimeters:e.earthRadius*1e3,millimetres:e.earthRadius*1e3,nauticalmiles:e.earthRadius/1852,radians:1,yards:e.earthRadius*1.0936},e.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/e.earthRadius,yards:1.0936133},e.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function t(ye,J,ie){ie===void 0&&(ie={});var q={type:"Feature"};return(ie.id===0||ie.id)&&(q.id=ie.id),ie.bbox&&(q.bbox=ie.bbox),q.properties=J||{},q.geometry=ye,q}e.feature=t;function n(ye,J,ie){switch(ye){case"Point":return l(J).geometry;case"LineString":return w(J).geometry;case"Polygon":return d(J).geometry;case"MultiPoint":return R(J).geometry;case"MultiLineString":return D(J).geometry;case"MultiPolygon":return I(J).geometry;default:throw new Error(ye+" is invalid")}}e.geometry=n;function l(ye,J,ie){if(ie===void 0&&(ie={}),!ye)throw new Error("coordinates is required");if(!Array.isArray(ye))throw new Error("coordinates must be an Array");if(ye.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ue(ye[0])||!ue(ye[1]))throw new Error("coordinates must contain numbers");var q={type:"Point",coordinates:ye};return t(q,J,ie)}e.point=l;function c(ye,J,ie){return ie===void 0&&(ie={}),S(ye.map(function(q){return l(q,J)}),ie)}e.points=c;function d(ye,J,ie){ie===void 0&&(ie={});for(var q=0,Ke=ye;q<Ke.length;q++){var Mt=Ke[q];if(Mt.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var ct=0;ct<Mt[Mt.length-1].length;ct++)if(Mt[Mt.length-1][ct]!==Mt[0][ct])throw new Error("First and last Position are not equivalent.")}var He={type:"Polygon",coordinates:ye};return t(He,J,ie)}e.polygon=d;function _(ye,J,ie){return ie===void 0&&(ie={}),S(ye.map(function(q){return d(q,J)}),ie)}e.polygons=_;function w(ye,J,ie){if(ie===void 0&&(ie={}),ye.length<2)throw new Error("coordinates must be an array of two or more positions");var q={type:"LineString",coordinates:ye};return t(q,J,ie)}e.lineString=w;function a(ye,J,ie){return ie===void 0&&(ie={}),S(ye.map(function(q){return w(q,J)}),ie)}e.lineStrings=a;function S(ye,J){J===void 0&&(J={});var ie={type:"FeatureCollection"};return J.id&&(ie.id=J.id),J.bbox&&(ie.bbox=J.bbox),ie.features=ye,ie}e.featureCollection=S;function D(ye,J,ie){ie===void 0&&(ie={});var q={type:"MultiLineString",coordinates:ye};return t(q,J,ie)}e.multiLineString=D;function R(ye,J,ie){ie===void 0&&(ie={});var q={type:"MultiPoint",coordinates:ye};return t(q,J,ie)}e.multiPoint=R;function I(ye,J,ie){ie===void 0&&(ie={});var q={type:"MultiPolygon",coordinates:ye};return t(q,J,ie)}e.multiPolygon=I;function M(ye,J,ie){ie===void 0&&(ie={});var q={type:"GeometryCollection",geometries:ye};return t(q,J,ie)}e.geometryCollection=M;function N(ye,J){if(J===void 0&&(J=0),J&&!(J>=0))throw new Error("precision must be a positive number");var ie=Math.pow(10,J||0);return Math.round(ye*ie)/ie}e.round=N;function j(ye,J){J===void 0&&(J="kilometers");var ie=e.factors[J];if(!ie)throw new Error(J+" units is invalid");return ye*ie}e.radiansToLength=j;function W(ye,J){J===void 0&&(J="kilometers");var ie=e.factors[J];if(!ie)throw new Error(J+" units is invalid");return ye/ie}e.lengthToRadians=W;function B(ye,J){return z(W(ye,J))}e.lengthToDegrees=B;function k(ye){var J=ye%360;return J<0&&(J+=360),J}e.bearingToAzimuth=k;function z(ye){var J=ye%(2*Math.PI);return J*180/Math.PI}e.radiansToDegrees=z;function Z(ye){var J=ye%360;return J*Math.PI/180}e.degreesToRadians=Z;function ee(ye,J,ie){if(J===void 0&&(J="kilometers"),ie===void 0&&(ie="kilometers"),!(ye>=0))throw new Error("length must be a positive number");return j(W(ye,J),ie)}e.convertLength=ee;function se(ye,J,ie){if(J===void 0&&(J="meters"),ie===void 0&&(ie="kilometers"),!(ye>=0))throw new Error("area must be a positive number");var q=e.areaFactors[J];if(!q)throw new Error("invalid original units");var Ke=e.areaFactors[ie];if(!Ke)throw new Error("invalid final units");return ye/q*Ke}e.convertArea=se;function ue(ye){return!isNaN(ye)&&ye!==null&&!Array.isArray(ye)}e.isNumber=ue;function Te(ye){return!!ye&&ye.constructor===Object}e.isObject=Te;function Q(ye){if(!ye)throw new Error("bbox is required");if(!Array.isArray(ye))throw new Error("bbox must be an Array");if(ye.length!==4&&ye.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");ye.forEach(function(J){if(!ue(J))throw new Error("bbox must only contain numbers")})}e.validateBBox=Q;function he(ye){if(!ye)throw new Error("id is required");if(["string","number"].indexOf(typeof ye)===-1)throw new Error("id must be a number or a string")}e.validateId=he})(MS);const cQ=n0,Dc=cn,hQ=Qf,hB=uQ,fQ=IS.default,dQ=cB.default,h3=MS,fa={...cQ.modes.draw_polygon};fa.onSetup=function(e){const t=this.newFeature({type:Dc.geojsonTypes.FEATURE,properties:{isCircle:!0,center:[]},geometry:{type:Dc.geojsonTypes.POLYGON,coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),hQ.disable(this),hB.disable(this),this.updateUIClasses({mouse:Dc.cursors.ADD}),this.activateUIButton(Dc.types.POLYGON),this.setActionableState({trash:!0}),{polygon:t,currentVertexPosition:0}};fa.onMouseDown=fa.onTouchStart=function(e,t){e.polygon.properties.center.length===0&&(e.polygon.properties.center=[t.lngLat.lng,t.lngLat.lat])};fa.onDrag=fa.onMouseMove=function(e,t){const n=e.polygon.properties.center;if(n.length>0){const l=dQ(h3.point(n),h3.point([t.lngLat.lng,t.lngLat.lat]),{units:"kilometers"}),c=fQ(n,l);e.polygon.incomingCoords(c.geometry.coordinates),e.polygon.properties.radiusInKm=l}};fa.onMouseUp=fa.onTouchEnd=function(e,t){return hB.enable(this),this.changeMode(Dc.modes.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};fa.onClick=fa.onTap=function(e,t){e.polygon.properties.center=[]};fa.toDisplayFeatures=function(e,t,n){const l=t.properties.id===e.polygon.id;return t.properties.active=l?Dc.activeStates.ACTIVE:Dc.activeStates.INACTIVE,n(t)};var pQ=fa;const mQ=Gv;function gQ(e){const{properties:t,geometry:n}=e;if(!t.user_isCircle)return null;const l=[],c=n.coordinates[0].slice(0,-1);for(let d=0;d<c.length;d+=Math.round(c.length/4))l.push(mQ(t.id,c[d],`0.${d}`,!1));return l}var fB=gQ;const yQ=n0,_Q=qv,vQ=t0,sv=cn,xQ=AS,bQ=cB.default,f3=MS,wQ=IS.default,EQ=fB,i0=yQ.modes.direct_select;i0.dragFeature=function(e,t,n){vQ(this.getSelected(),n),this.getSelected().filter(l=>l.properties.isCircle).map(l=>l.properties.center).forEach(l=>{l[0]+=n.lng,l[1]+=n.lat}),e.dragMoveLocation=t.lngLat};i0.dragVertex=function(e,t,n){if(e.feature.properties.isCircle){const l=e.feature.properties.center,c=[t.lngLat.lng,t.lngLat.lat],d=bQ(f3.point(l),f3.point(c),{units:"kilometers"}),_=wQ(l,d);e.feature.incomingCoords(_.geometry.coordinates),e.feature.properties.radiusInKm=d}else{const l=e.selectedCoordPaths.map(_=>e.feature.getCoordinate(_)),c=l.map(_=>({type:sv.geojsonTypes.FEATURE,properties:{},geometry:{type:sv.geojsonTypes.POINT,coordinates:_}})),d=xQ(c,n);for(let _=0;_<l.length;_++){const w=l[_];e.feature.updateCoordinate(e.selectedCoordPaths[_],w[0]+d.lng,w[1]+d.lat)}}};i0.toDisplayFeatures=function(e,t,n){e.featureId===t.properties.id?(t.properties.active=sv.activeStates.ACTIVE,n(t),(t.properties.user_isCircle?EQ(t):_Q(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths})).forEach(n)):(t.properties.active=sv.activeStates.INACTIVE,n(t)),this.fireActionable(e)};var TQ=i0;const SQ=n0,AQ=qv,CQ=t0,Gy=cn,IQ=fB,PS=SQ.modes.simple_select;PS.dragMove=function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();const n={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};CQ(this.getSelected(),n),this.getSelected().filter(l=>l.properties.isCircle).map(l=>l.properties.center).forEach(l=>{l[0]+=n.lng,l[1]+=n.lat}),e.dragMoveLocation=t.lngLat};PS.toDisplayFeatures=function(e,t,n){if(t.properties.active=this.isSelected(t.properties.id)?Gy.activeStates.ACTIVE:Gy.activeStates.INACTIVE,n(t),this.fireActionable(),t.properties.active!==Gy.activeStates.ACTIVE||t.geometry.type===Gy.geojsonTypes.POINT)return;(t.properties.user_isCircle?IQ(t):AQ(t)).forEach(n)};var MQ=PS;const PQ=pQ,kQ=TQ,LQ=MQ,OQ={},d3=e=>{let t;const n=new Set,l=(D,R)=>{const I=typeof D=="function"?D(t):D;if(!Object.is(I,t)){const M=t;t=R??(typeof I!="object"||I===null)?I:Object.assign({},t,I),n.forEach(N=>N(t,M))}},c=()=>t,a={setState:l,getState:c,getInitialState:()=>S,subscribe:D=>(n.add(D),()=>n.delete(D)),destroy:()=>{(OQ?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},S=t=e(l,c,a);return a},DQ=e=>e?d3(e):d3;var dB={exports:{}},pB={},mB={exports:{}},gB={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wf=Sr;function RQ(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var zQ=typeof Object.is=="function"?Object.is:RQ,FQ=Wf.useState,BQ=Wf.useEffect,NQ=Wf.useLayoutEffect,UQ=Wf.useDebugValue;function $Q(e,t){var n=t(),l=FQ({inst:{value:n,getSnapshot:t}}),c=l[0].inst,d=l[1];return NQ(function(){c.value=n,c.getSnapshot=t,Jb(c)&&d({inst:c})},[e,n,t]),BQ(function(){return Jb(c)&&d({inst:c}),e(function(){Jb(c)&&d({inst:c})})},[e]),UQ(n),n}function Jb(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!zQ(e,n)}catch{return!0}}function jQ(e,t){return t()}var VQ=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?jQ:$Q;gB.useSyncExternalStore=Wf.useSyncExternalStore!==void 0?Wf.useSyncExternalStore:VQ;mB.exports=gB;var GQ=mB.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var o0=Sr,qQ=GQ;function WQ(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var ZQ=typeof Object.is=="function"?Object.is:WQ,HQ=qQ.useSyncExternalStore,XQ=o0.useRef,KQ=o0.useEffect,YQ=o0.useMemo,JQ=o0.useDebugValue;pB.useSyncExternalStoreWithSelector=function(e,t,n,l,c){var d=XQ(null);if(d.current===null){var _={hasValue:!1,value:null};d.current=_}else _=d.current;d=YQ(function(){function a(M){if(!S){if(S=!0,D=M,M=l(M),c!==void 0&&_.hasValue){var N=_.value;if(c(N,M))return R=N}return R=M}if(N=R,ZQ(D,M))return N;var j=l(M);return c!==void 0&&c(N,j)?(D=M,N):(D=M,R=j)}var S=!1,D,R,I=n===void 0?null:n;return[function(){return a(t())},I===null?void 0:function(){return a(I())}]},[t,n,l,c]);var w=HQ(e,d[0],d[1]);return KQ(function(){_.hasValue=!0,_.value=w},[w]),JQ(w),w};dB.exports=pB;var QQ=dB.exports;const e2=Pu(QQ),yB={},{useDebugValue:t2}=FE,{useSyncExternalStoreWithSelector:r2}=e2;let p3=!1;const n2=e=>e;function i2(e,t=n2,n){(yB?"production":void 0)!=="production"&&n&&!p3&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),p3=!0);const l=r2(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return t2(l),l}const m3=e=>{(yB?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t=typeof e=="function"?DQ(e):e,n=(l,c)=>i2(t,l,c);return Object.assign(n,t),n},o2=e=>e?m3(e):m3,s2=.85,g3=120,a2={"mini-4-pro":{name:"DJI Mini 4 Pro",hfov:82.1,photoInterval:5.5,maxFlightTime:31},"mini-5-pro":{name:"DJI Mini 5 Pro",hfov:82.1,photoInterval:5.5,maxFlightTime:40},"mavic-4-pro":{name:"DJI Mavic 4 Pro",hfov:84,photoInterval:5.5,maxFlightTime:40},custom:{name:"Custom",hfov:null,photoInterval:5.5,maxFlightTime:null}},xf=e=>{const t=l2(e);return a2[t]||null},l2=e=>({dji_mini_4_pro:"mini-4-pro",dji_mini_5_pro:"mini-5-pro",dji_mavic_4_pro:"mavic-4-pro",custom:"custom"})[e]||e,u2=(e,t,n,l)=>{if(!e||!t||!l)return null;const c=2*t*Math.tan(l*Math.PI/360),d=c*(3/4),_=c/2,w=d/2,a=Math.sqrt(_*_+w*w),S=Math.atan2(_,w)*180/Math.PI,D=180-S,R=180+S,I=360-S,M=po([e.lng,e.lat]),N=za(M,a/1e3,n+S,{units:"kilometers"}),j=za(M,a/1e3,n+D,{units:"kilometers"}),W=za(M,a/1e3,n+R,{units:"kilometers"}),B=za(M,a/1e3,n+I,{units:"kilometers"}),k=[[N.geometry.coordinates,j.geometry.coordinates,W.geometry.coordinates,B.geometry.coordinates,N.geometry.coordinates]];return Dj(k,{altitude:t,heading:n,hfov:l})},_B=(e,t)=>{const n=po([e.lng,e.lat]),l=po([t.lng,t.lat]);return $i(n,l,{units:"meters"})},vB=(e,t)=>{if(!e||e.length<2||!t||t<=0)return{maxSpeed:0,minDistance:0};const n=[];for(let d=0;d<e.length-1;d++){const _=_B(e[d],e[d+1]);n.push(_)}const l=Math.min(...n),c=l/t;return{maxSpeed:Math.max(0,c),minDistance:l}},c2=(e,t)=>{if(!t||t<=0)return g3;const l=e/t+g3;return Math.round(l)},h2=(e,t)=>{if(!t||t<=0)return"safe";const n=t*60,l=n*s2;return e>=n?"critical":e>=l?"warning":"safe"},Ii=o2((e,t)=>({waypoints:[],selectedIds:[],mapRef:null,currentMissionFilename:null,calculatedMaxSpeed:0,minSegmentDistance:0,past:[],future:[],settings:{altitude:60,speed:10,gimbalPitch:-90,customFOV:82.1,showFootprints:!1,footprintColor:"#22c55e",sideOverlap:70,frontOverlap:80,pathType:"grid",angle:0,autoDirection:!1,generateEveryPoint:!1,reversePath:!1,waypointAction:"none",photoInterval:2,selectedDrone:"dji_mini_5_pro",straightenLegs:!1,units:"metric",orbitRadius:50,missionEndAction:"goHome"},setWaypoints:n=>e(l=>({waypoints:n,past:[...l.past,l.waypoints],future:[]})),addWaypoint:n=>e(l=>{let c=l.settings.speed,d=0;if(l.waypoints.length>0){const a=l.waypoints[l.waypoints.length-1];c=Math.round((a.speed||l.settings.speed)*10)/10,d=a.heading||0}const _={id:crypto.randomUUID(),...n,altitude:l.settings.altitude,speed:c,gimbalPitch:l.settings.gimbalPitch,heading:d},w=[...l.waypoints];if(w.length>0){const a=w.length-1,S=w[a],D=Math.round(Cu([S.lng,S.lat],[_.lng,_.lat]));w[a]={...S,heading:D},_.heading=D}return{waypoints:[...w,_],past:[...l.past,l.waypoints],future:[]}}),updateSettings:n=>e(l=>({settings:{...l.settings,...n}})),selectWaypoint:(n,l)=>e(c=>({selectedIds:l?c.selectedIds.includes(n)?c.selectedIds.filter(d=>d!==n):[...c.selectedIds,n]:[n]})),setSelectedIds:n=>e({selectedIds:n}),clearSelection:()=>e({selectedIds:[]}),updateSelectedWaypoints:n=>{const{waypoints:l,selectedIds:c,past:d}=t(),_=l.map(w=>c.includes(w.id)?{...w,...n}:w);e({waypoints:_,past:[...d,l],future:[]})},updateWaypoint:(n,l)=>{const{waypoints:c,past:d}=t(),_=c.map(w=>w.id===n?{...w,...l}:w);e({waypoints:_,past:[...d,c],future:[]})},deleteSelectedWaypoints:()=>{const{waypoints:n,selectedIds:l,past:c}=t(),d=n.filter(_=>!l.includes(_.id));e({waypoints:d,selectedIds:[],past:[...c,n],future:[]})},undo:()=>{const{past:n,future:l,waypoints:c}=t();if(n.length===0)return;const d=n[n.length-1],_=n.slice(0,n.length-1);e({waypoints:d,past:_,future:[c,...l]})},redo:()=>{const{past:n,future:l,waypoints:c}=t();if(l.length===0)return;const d=l[0],_=l.slice(1);e({waypoints:d,past:[...n,c],future:_})},setMapRef:n=>e({mapRef:n}),fitMapToWaypoints:()=>{const{mapRef:n,waypoints:l}=t();if(!n||!l||l.length===0)return;const c=new tm.LngLatBounds;l.forEach(d=>{c.extend([d.lng,d.lat])}),n.fitBounds(c,{padding:{top:100,bottom:100,left:200,right:350},maxZoom:16,duration:3e3})},setMissionFilename:n=>e({currentMissionFilename:n}),clearMissionFilename:()=>e({currentMissionFilename:null}),calculateMissionMetrics:()=>{const{waypoints:n,settings:l}=t(),c=xf(l.selectedDrone),d=(c==null?void 0:c.photoInterval)||5.5,{maxSpeed:_,minDistance:w}=vB(n,d);e({calculatedMaxSpeed:_,minSegmentDistance:w})},getTotalDistance:()=>{const{waypoints:n}=t();if(n.length<2)return 0;let l=0;for(let c=0;c<n.length-1;c++)l+=_B(n[c],n[c+1]);return l},getMissionTime:()=>{const{calculatedMaxSpeed:n}=t(),l=t().getTotalDistance();return c2(l,n)},getFlightWarningLevel:()=>{const{settings:n}=t(),l=t().getMissionTime(),c=xf(n.selectedDrone),d=(c==null?void 0:c.maxFlightTime)||null;return h2(l,d)},resetTrigger:0,resetMission:()=>e(n=>({waypoints:[],selectedIds:[],past:[],future:[],currentMissionFilename:null,calculatedMaxSpeed:0,minSegmentDistance:0,resetTrigger:n.resetTrigger+1}))})),f2={onSetup:function(e){const t=this.newFeature({type:"Feature",properties:{isRectangle:!0},geometry:{type:"Polygon",coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),this.updateUIClasses({mouse:"add"}),this.activateUIButton("polygon"),this.setActionableState({trash:!0}),this.map&&this.map.dragPan&&this.map.dragPan.disable(),{polygon:t,startPoint:null}},onStop:function(e){this.updateUIClasses({mouse:"none"}),this.activateUIButton(),this.setActionableState({trash:!0}),this.map&&this.map.dragPan&&this.map.dragPan.enable()},onMouseDown:function(e,t){t.originalEvent&&(t.originalEvent.preventDefault(),t.originalEvent.stopPropagation()),e.startPoint=[t.lngLat.lng,t.lngLat.lat],this.updateFeature(e,t)},onDrag:function(e,t){e.startPoint&&this.updateFeature(e,t)},onMouseUp:function(e,t){e.startPoint&&(this.updateFeature(e,t),this.map.fire("draw.create",{features:[e.polygon.toGeoJSON()]}),this.changeMode("simple_select",{featureIds:[e.polygon.id]}))},updateFeature:function(e,t){const n=e.startPoint,l=[t.lngLat.lng,t.lngLat.lat],c=Math.min(n[0],l[0]),d=Math.max(n[0],l[0]),_=Math.min(n[1],l[1]),w=Math.max(n[1],l[1]),a=[[c,w],[d,w],[d,_],[c,_],[c,w]];e.polygon.incomingCoords([a])},toDisplayFeatures:function(e,t,n){const l=t.properties.id===e.polygon.id;if(t.properties.active=l?"true":"false",!l)return n(t);t.geometry.coordinates.length!==0&&n(t)},onTrash:function(e){this.deleteFeature(e.polygon.id,{silent:!0}),this.changeMode("simple_select")}};var d2={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const p2=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),bi=(e,t)=>{const n=Sr.forwardRef(({color:l="currentColor",size:c=24,strokeWidth:d=2,absoluteStrokeWidth:_,children:w,...a},S)=>Sr.createElement("svg",{ref:S,...d2,width:c,height:c,stroke:l,strokeWidth:_?Number(d)*24/Number(c):d,className:`lucide lucide-${p2(e)}`,...a},[...t.map(([D,R])=>Sr.createElement(D,R)),...(Array.isArray(w)?w:[w])||[]]));return n.displayName=`${e}`,n},m2=bi("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),g2=bi("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),y2=bi("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),_2=bi("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),v2=bi("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),x2=bi("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),b2=bi("Hexagon",[["path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z",key:"yt0hxn"}]]),w2=bi("Map",[["polygon",{points:"3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21",key:"ok2ie8"}],["line",{x1:"9",x2:"9",y1:"3",y2:"18",key:"w34qz5"}],["line",{x1:"15",x2:"15",y1:"6",y2:"21",key:"volv9a"}]]),E2=bi("MousePointer2",[["path",{d:"m4 4 7.07 17 2.51-7.39L21 11.07z",key:"1vqm48"}]]),T2=bi("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),S2=bi("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),A2=bi("Redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]),C2=bi("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),xB=bi("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),I2=bi("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),kS=bi("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),M2=bi("Undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]),P2=bi("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),k2=bi("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),bB=bi("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function L2({currentMode:e,onModeChange:t,onDelete:n,canDelete:l}){const c=[{id:"simple_select",icon:E2,title:"Select (Pointer)"},{id:"add_waypoint",icon:S2,title:"Add Waypoint"},{id:"draw_rectangle",icon:I2,title:"Draw Square"},{id:"draw_polygon",icon:b2,title:"Draw Polygon"},{id:"drag_circle",icon:v2,title:"Draw Circle"}];return Be.jsxs("div",{className:"absolute top-4 left-4 flex flex-col gap-2 bg-white rounded-md shadow-md p-1 z-10",children:[c.map(d=>{const _=d.icon,w=e===d.id||d.id==="simple_select"&&e==="direct_select";return Be.jsx("button",{onClick:()=>{console.log("Switching to mode:",d.id),t(d.id)},className:`p-2 rounded hover:bg-gray-100 flex items-center justify-center ${w?"text-blue-600 bg-blue-50":"text-gray-700"}`,title:d.title,children:Be.jsx(_,{size:20})},d.id)}),Be.jsx("div",{className:"h-px bg-gray-200 my-1"}),Be.jsx("button",{onClick:n,disabled:!l,className:`p-2 rounded flex items-center justify-center ${l?"text-red-600 hover:bg-red-50 cursor-pointer":"text-gray-300 cursor-not-allowed"}`,title:"Delete Selected",children:Be.jsx(kS,{size:20})})]})}tm.accessToken="pk.eyJ1Ijoid2F5Z2VuIiwiYSI6ImNtaThyMXF2czBmZ3QybXBvbW1hazFpamcifQ.P0D5plS_fpnx3qheQytxfQ";const O2="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(`
<svg width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
  <path d="M20 0 L35 20 A 15 15 0 0 1 5 20 Z" fill="#3b82f6" stroke="white" stroke-width="2"/>
</svg>
`),D2="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(`
<svg width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
  <path d="M20 0 L35 20 A 15 15 0 0 1 5 20 Z" fill="#ef4444" stroke="white" stroke-width="2"/>
</svg>
`),R2=[{id:"gl-draw-line",type:"line",filter:["all",["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3b82f6","line-width":2}},{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3b82f6","fill-outline-color":"#3b82f6","fill-opacity":.2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3b82f6","line-width":2}},{id:"gl-draw-point-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":6,"circle-color":"#fff"}},{id:"gl-draw-point",type:"circle",filter:["all",["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":4,"circle-color":"#3b82f6"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","$type","Polygon"],["==","mode","static"]],paint:{"fill-color":"#000","fill-outline-color":"#000","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","$type","Polygon"],["==","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#000","line-width":2}}];function z2({onPolygonDrawn:e}){const t=Sr.useRef(null),n=Sr.useRef(null),l=Sr.useRef(null),{waypoints:c,selectedIds:d,selectWaypoint:_,setSelectedIds:w,resetTrigger:a,settings:S,updateWaypoint:D,addWaypoint:R,setMapRef:I}=Ii(),M=Sr.useRef(null),[N,j]=Sr.useState("simple_select"),W=Sr.useRef(N);Sr.useEffect(()=>{W.current=N},[N]),Sr.useEffect(()=>{a>0&&l.current&&(l.current.deleteAll(),e(null))},[a,e]);const[B,k]=Sr.useState(null),[z,Z]=Sr.useState(!1),ee=Sr.useRef(null);Sr.useEffect(()=>{if(!l.current||!n.current)return;const Te=l.current.getSelectedIds();if(Te.length===0)return;const Q=l.current.get(Te[0]);if(!Q||Q.geometry.type!=="Polygon")return;const he=Cf(Q),ye=$i(he,po(Q.geometry.coordinates[0][0]),{units:"meters"});if(Math.abs(ye-S.orbitRadius)>1){const J=Zw(he.geometry.coordinates,S.orbitRadius,{steps:64,units:"meters"});J.id=Q.id,J.properties={...Q.properties,isCircle:!0},l.current.add(J),e(J)}},[S.orbitRadius]);const se=Te=>{if(!Te||Te.geometry.type!=="Polygon")return;const Q=Cf(Te),he=$i(Q,po(Te.geometry.coordinates[0][0]),{units:"meters"});Math.abs(he-S.orbitRadius)>1&&Ii.getState().updateSettings({orbitRadius:Math.round(he)})};Sr.useEffect(()=>{if(n.current)return;n.current=new tm.Map({container:t.current,style:"mapbox://styles/mapbox/satellite-streets-v12",center:[-98,39],zoom:4,boxZoom:!1});const Te=new bz({accessToken:tm.accessToken,mapboxgl:tm,marker:!1,collapsed:!0});n.current.addControl(Te,"top-right"),I(n.current),l.current=new Sm({userProperties:!0,displayControlsDefault:!1,controls:{point:!1,line:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1},styles:R2,modes:{...Sm.modes,drag_circle:PQ,draw_rectangle:f2,direct_select:kQ,simple_select:LQ}}),n.current.addControl(l.current),window.mapboxDraw=l.current,n.current.on("draw.create",He=>{const _e=He.features[0];l.current.getMode()==="drag_circle"&&(l.current.setFeatureProperty(_e.id,"isCircle",!0),_e.properties.isCircle=!0,Ii.getState().updateSettings({pathType:"orbit",spacing:10})),l.current.getMode();const qe=Cf(_e);if($i(qe,po(_e.geometry.coordinates[0][0]),{units:"meters"})>500){const Le=Zw(qe.geometry.coordinates,50,{steps:64,units:"meters"});Le.id=_e.id,Le.properties={..._e.properties,isCircle:!0},l.current.add(Le),Ii.getState().updateSettings({orbitRadius:50}),e(Le)}else se(_e),e(_e);setTimeout(()=>{l.current.changeMode("simple_select",{featureIds:[_e.id]})},100)}),n.current.on("draw.update",He=>{const _e=He.features[0];se(_e),e(_e)}),n.current.on("draw.selectionchange",He=>{He.features.length>0?(se(He.features[0]),e(He.features[0]),Z(!0)):(e(null),Z(!1))}),n.current.on("draw.delete",()=>e(null)),n.current.on("click",He=>{if(He.originalEvent._isDrag)return;if(W.current==="add_waypoint"){const{lng:qe,lat:Pe}=He.lngLat;R({lng:qe,lat:Pe});return}const _e=n.current.queryRenderedFeatures(He.point,{layers:["waypoints-symbol"]});if(_e.length){const qe=_e[0].properties.id;_(qe,He.originalEvent.shiftKey)}else n.current.queryRenderedFeatures(He.point,{layers:["gl-draw-polygon-fill-static.cold","gl-draw-polygon-fill.hot"]}).length===0&&w([])});const Q=He=>{if(!ee.current)return;const _e=ee.current,qe=He.point,Pe=Math.min(_e.x,qe.x),Le=Math.max(_e.x,qe.x),Pt=Math.min(_e.y,qe.y),lt=Math.max(_e.y,qe.y);k({left:Pe,top:Pt,width:Le-Pe,height:lt-Pt})},he=He=>{if(!ee.current)return;const _e=ee.current,qe=He.point;if(Math.abs(_e.x-qe.x)<5&&Math.abs(_e.y-qe.y)<5){ee.current=null,k(null),n.current.dragPan.enable(),n.current.off("mousemove",Q),n.current.off("mouseup",he);return}const Pe=[_e,qe],Pt=n.current.queryRenderedFeatures(Pe,{layers:["waypoints-symbol"]}).map(lt=>lt.properties.id);Pt.length>0&&w(Pt),ee.current=null,k(null),n.current.dragPan.enable(),He.originalEvent._isDrag=!0,setTimeout(()=>{He.originalEvent&&delete He.originalEvent._isDrag},100),n.current.off("mousemove",Q),n.current.off("mouseup",he)};n.current.on("mousedown",He=>{He.originalEvent.shiftKey&&(He.preventDefault(),n.current.dragPan.disable(),ee.current=He.point,n.current.on("mousemove",Q),n.current.on("mouseup",he))});const ye=()=>{M.current||(n.current.getCanvas().style.cursor="pointer")},J=()=>{M.current||(n.current.getCanvas().style.cursor="")},ie=He=>{if(l.current.getMode()!=="simple_select"&&l.current.getMode()!=="direct_select"||He.originalEvent.shiftKey||!He.originalEvent.altKey)return;He.preventDefault();const _e=He.features[0];_e&&(n.current.dragPan.disable(),n.current.getCanvas().style.cursor="grabbing",M.current={id:_e.properties.id,initialLngLat:_e.geometry.coordinates},n.current.on("mousemove",q),n.current.on("mouseup",Ke))},q=He=>{if(!M.current)return;const{lng:_e,lat:qe}=He.lngLat,Pe=n.current.getSource("waypoints"),Le=n.current.getSource("mission-path"),Pt=Ii.getState().waypoints,lt=Ii.getState().selectedIds,at=Pt.map((Jt,Er)=>{const Kt=Jt.id===M.current.id;return{type:"Feature",properties:{id:Jt.id,index:Er+1,selected:lt.includes(Jt.id),heading:Jt.heading||0},geometry:{type:"Point",coordinates:Kt?[_e,qe]:[Jt.lng,Jt.lat]}}});if(Pe&&Pe.setData({type:"FeatureCollection",features:at}),Le){const Jt=at.map(Er=>Er.geometry.coordinates);Le.setData({type:"Feature",geometry:{type:"LineString",coordinates:Jt}})}},Ke=He=>{if(!M.current)return;const{lng:_e,lat:qe}=He.lngLat,{id:Pe}=M.current;Ii.getState().updateWaypoint(Pe,{lng:_e,lat:qe}),M.current=null,n.current.dragPan.enable(),n.current.getCanvas().style.cursor="",He.originalEvent._isDrag=!0,n.current.off("mousemove",q),n.current.off("mouseup",Ke)};n.current.on("mouseenter","waypoints-symbol",ye),n.current.on("mouseleave","waypoints-symbol",J),n.current.on("mousedown","waypoints-symbol",ie);const Mt=He=>{const _e=He.detail;if(!_e||!l.current)return;l.current.deleteAll(),l.current.add(_e),e(_e);const qe=Uf(_e);n.current.fitBounds(qe,{padding:50})};window.addEventListener("waygen:restore-polygon",Mt),n.current.on("load",()=>{const He=n.current.getStyle().layers;let _e=null;for(const Pt of He)if(Pt.id.startsWith("gl-draw-")){_e=Pt.id;break}n.current.addSource("mission-path",{type:"geojson",data:{type:"Feature",geometry:{type:"LineString",coordinates:[]}}}),n.current.addLayer({id:"mission-path-line",type:"line",source:"mission-path",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#3b82f6","line-width":3,"line-opacity":.8}},_e),n.current.addSource("footprints",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),n.current.addLayer({id:"footprints-fill",type:"fill",source:"footprints",paint:{"fill-color":["get","color"],"fill-opacity":.15,"fill-outline-color":"rgba(0,0,0,0)"}},_e),n.current.addLayer({id:"footprints-outline",type:"line",source:"footprints",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":["get","color"],"line-width":1,"line-opacity":.6}},_e),n.current.addSource("waypoints",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),n.current.addLayer({id:"waypoints-symbol",type:"symbol",source:"waypoints",layout:{"icon-image":["case",["get","selected"],"teardrop-selected","teardrop"],"icon-size":["interpolate",["linear"],["zoom"],10,.5,15,.75,20,1],"icon-anchor":"center","icon-allow-overlap":!0,"icon-rotate":["get","heading"],"icon-rotation-alignment":"map","text-field":["to-string",["get","index"]],"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":["interpolate",["linear"],["zoom"],10,9,15,11,20,13],"text-offset":[0,0],"text-anchor":"center","text-allow-overlap":!0,"text-rotation-alignment":"viewport"},paint:{"text-color":"#ffffff","text-halo-color":"#000000","text-halo-width":.5}});const qe=(Pt,lt)=>{const at=new Image;at.src=lt,at.onload=()=>{n.current.hasImage(Pt)||n.current.addImage(Pt,at)}};qe("teardrop",O2),qe("teardrop-selected",D2);const Pe=Ii.getState().waypoints,Le=Ii.getState().selectedIds;if(Pe.length>0){const Pt=Pe.map((at,Jt)=>({type:"Feature",properties:{id:at.id,index:Jt+1,selected:Le.includes(at.id),heading:at.heading||0},geometry:{type:"Point",coordinates:[at.lng,at.lat]}}));n.current.getSource("waypoints").setData({type:"FeatureCollection",features:Pt});const lt=Pe.map(at=>[at.lng,at.lat]);n.current.getSource("mission-path").setData({type:"Feature",geometry:{type:"LineString",coordinates:lt}})}});const ct=He=>{j(He.mode),He.mode==="drag_circle"||He.mode==="draw_rectangle"?n.current.dragPan.disable():n.current.dragPan.enable()};return n.current.on("draw.modechange",ct),()=>{window.removeEventListener("waygen:restore-polygon",Mt)}},[]),Sr.useEffect(()=>{!n.current||!n.current.getLayer("waypoints-symbol")||(n.current.setLayoutProperty("waypoints-symbol","text-offset",[0,0]),n.current.setLayoutProperty("waypoints-symbol","text-anchor","center"),n.current.setLayoutProperty("waypoints-symbol","icon-anchor","center"),n.current.setLayoutProperty("waypoints-symbol","text-rotation-alignment","viewport"))},[]),Sr.useEffect(()=>{if(!n.current)return;const Te=n.current.getSource("waypoints"),Q=n.current.getSource("mission-path");if(Te){const he=c.map((ye,J)=>({type:"Feature",properties:{id:ye.id,index:J+1,selected:d.includes(ye.id),heading:ye.heading||0},geometry:{type:"Point",coordinates:[ye.lng,ye.lat]}}));Te.setData({type:"FeatureCollection",features:he})}if(Q){const he=c.map(ye=>[ye.lng,ye.lat]);Q.setData({type:"Feature",geometry:{type:"LineString",coordinates:he}})}},[c,d]),Sr.useEffect(()=>{if(!n.current||!n.current.getSource("footprints"))return;if(!S.showFootprints){n.current.getSource("footprints").setData({type:"FeatureCollection",features:[]});return}const Te=c.map((Q,he)=>{const ye=Q.heading||0;return{...u2({lng:Q.lng,lat:Q.lat},S.altitude,ye,S.customFOV),properties:{index:he+1,color:S.footprintColor}}}).filter(Q=>Q!==null);n.current.getSource("footprints").setData({type:"FeatureCollection",features:Te})},[c,S.showFootprints,S.altitude,S.customFOV,S.footprintColor]),Sr.useEffect(()=>{S.orbitRadius>500&&Ii.getState().updateSettings({orbitRadius:50})},[]);const ue=()=>{l.current&&(l.current.trash(),e(null),Z(!1))};return Be.jsxs("div",{className:`relative w-full h-full ${N==="drag_circle"||N==="draw_rectangle"||N==="add_waypoint"?"force-crosshair":""}`,children:[Be.jsx("style",{children:`
        .force-crosshair .mapboxgl-canvas-container {
          cursor: crosshair !important;
        }
        .force-crosshair .mapboxgl-canvas {
          cursor: crosshair !important;
        }
      `}),Be.jsx("div",{ref:t,className:"w-full h-full"}),B&&Be.jsx("div",{style:{position:"absolute",left:B.left,top:B.top,width:B.width,height:B.height,border:"2px solid #3b82f6",backgroundColor:"rgba(59, 130, 246, 0.2)",pointerEvents:"none",zIndex:20}}),Be.jsx(L2,{currentMode:N,onModeChange:Te=>{var Q,he;Te!=="add_waypoint"?(Q=l.current)==null||Q.changeMode(Te):(he=l.current)==null||he.changeMode("simple_select"),j(Te),n.current&&(Te==="drag_circle"||Te==="draw_rectangle"?n.current.dragPan.disable():n.current.dragPan.enable())},onDelete:ue,canDelete:z})]})}function F2(e,t){const{altitude:n,speed:l,gimbalPitch:c,spacing:d,straightenLegs:_,waypointAction:w}=t,a=Cf(e);a.geometry.coordinates;const S=e.geometry.coordinates[0];let D=0;S.forEach(j=>{D+=$i(a,po(j),{units:"meters"})});const R=D/S.length,I=2*Math.PI*R,M=Math.max(3,Math.round(I/d)),N=[];for(let j=0;j<M;j++){const W=j/M*360,B=za(a,R/1e3,W,{units:"kilometers"}),k=Math.round(Cu(B,a));N.push({id:crypto.randomUUID(),lng:B.geometry.coordinates[0],lat:B.geometry.coordinates[1],altitude:Number(n),speed:Math.round(Number(l)*10)/10,gimbalPitch:Number(c),heading:k,straightenLegs:_,action:w})}if(N.length>0){const j=N[0];N.push({...j,id:crypto.randomUUID()})}return N}function y3(e,t){if(t.pathType==="orbit")return F2(e,t);const{altitude:n,sideOverlap:l,frontOverlap:c,angle:d,gimbalPitch:_,autoDirection:w,generateEveryPoint:a,reversePath:S,speed:D,straightenLegs:R,waypointAction:I}=t,M=t.customFOV||82.1,N=Math.tan(M/2*(Math.PI/180)),j=n*N*2,B=j*(1-l/100)/111111,k=Cf(e);let z=d;if(w){let J=0,ie=0;const q=e.geometry.coordinates[0];for(let Ke=0;Ke<q.length-1;Ke++){const Mt=po(q[Ke]),ct=po(q[Ke+1]),He=$i(Mt,ct);He>J&&(J=He,ie=Cu(Mt,ct))}z=ie}const Z=-z,ee=uP(e,Z,{pivot:k}),se=Uf(ee),ue=[];let Te=se[1]+B/2;for(;Te<=se[3]+B/10;){const J=cP([[se[0]-.1,Te],[se[2]+.1,Te]]),ie=F$(J,ee),q=Ke=>{const Mt=Ke.geometry.coordinates;return Array.isArray(Mt[0][0])?TM(Mt[0][0],Mt[0][Mt[0].length-1]):TM(Mt[0],Mt[Mt.length-1])};if(ie.features.length===0){const Ke=q(J);xM(Ke,ee)&&ue.push(J.geometry.coordinates)}else ie.features.forEach(Ke=>{const Mt=q(Ke);xM(Mt,ee)&&ue.push(Ke.geometry.coordinates)});Te+=B}let Q=[];if(ue.forEach((J,ie)=>{let q=ie%2===1?J.reverse():J;if(a){const Ke=po(q[0]),Mt=po(q[1]),ct=$i(Ke,Mt,{units:"meters"}),_e=j*(3/4)*(1-c/100),qe=Math.max(1,_e),Pe=Math.floor(ct/qe);if(Pe>=1){const Le=cP(q),Pt=[];for(let lt=0;lt<=Pe;lt++){RM(Le,lt*qe/1e3,{units:"kilometers"});const at=RM(Le,lt*qe,{units:"meters"});Pt.push(at.geometry.coordinates)}q=Pt}}q.forEach(Ke=>{Q.push({id:crypto.randomUUID(),lng:Ke[0],lat:Ke[1],altitude:Number(n),speed:Math.round(Number(D)*10)/10,gimbalPitch:Number(_),heading:0,straightenLegs:R,action:I})})}),Q.length===0)return[];const he=Oj(Q.map(J=>[J.lng,J.lat]));uP(he,z,{pivot:k}).features.forEach((J,ie)=>{Q[ie].lng=J.geometry.coordinates[0],Q[ie].lat=J.geometry.coordinates[1]}),S&&Q.reverse();for(let J=0;J<Q.length;J++)if(J<Q.length-1){const ie=po([Q[J].lng,Q[J].lat]),q=po([Q[J+1].lng,Q[J+1].lat]);Q[J].heading=Math.round(Cu(ie,q))}else J>0&&(Q[J].heading=Q[J-1].heading);return Q}var wB={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(e,t){(function(n){e.exports=n()})(function(){return function n(l,c,d){function _(S,D){if(!c[S]){if(!l[S]){var R=typeof jp=="function"&&jp;if(!D&&R)return R(S,!0);if(w)return w(S,!0);var I=new Error("Cannot find module '"+S+"'");throw I.code="MODULE_NOT_FOUND",I}var M=c[S]={exports:{}};l[S][0].call(M.exports,function(N){var j=l[S][1][N];return _(j||N)},M,M.exports,n,l,c,d)}return c[S].exports}for(var w=typeof jp=="function"&&jp,a=0;a<d.length;a++)_(d[a]);return _}({1:[function(n,l,c){var d=n("./utils"),_=n("./support"),w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";c.encode=function(a){for(var S,D,R,I,M,N,j,W=[],B=0,k=a.length,z=k,Z=d.getTypeOf(a)!=="string";B<a.length;)z=k-B,R=Z?(S=a[B++],D=B<k?a[B++]:0,B<k?a[B++]:0):(S=a.charCodeAt(B++),D=B<k?a.charCodeAt(B++):0,B<k?a.charCodeAt(B++):0),I=S>>2,M=(3&S)<<4|D>>4,N=1<z?(15&D)<<2|R>>6:64,j=2<z?63&R:64,W.push(w.charAt(I)+w.charAt(M)+w.charAt(N)+w.charAt(j));return W.join("")},c.decode=function(a){var S,D,R,I,M,N,j=0,W=0,B="data:";if(a.substr(0,B.length)===B)throw new Error("Invalid base64 input, it looks like a data url.");var k,z=3*(a=a.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(a.charAt(a.length-1)===w.charAt(64)&&z--,a.charAt(a.length-2)===w.charAt(64)&&z--,z%1!=0)throw new Error("Invalid base64 input, bad content length.");for(k=_.uint8array?new Uint8Array(0|z):new Array(0|z);j<a.length;)S=w.indexOf(a.charAt(j++))<<2|(I=w.indexOf(a.charAt(j++)))>>4,D=(15&I)<<4|(M=w.indexOf(a.charAt(j++)))>>2,R=(3&M)<<6|(N=w.indexOf(a.charAt(j++))),k[W++]=S,M!==64&&(k[W++]=D),N!==64&&(k[W++]=R);return k}},{"./support":30,"./utils":32}],2:[function(n,l,c){var d=n("./external"),_=n("./stream/DataWorker"),w=n("./stream/Crc32Probe"),a=n("./stream/DataLengthProbe");function S(D,R,I,M,N){this.compressedSize=D,this.uncompressedSize=R,this.crc32=I,this.compression=M,this.compressedContent=N}S.prototype={getContentWorker:function(){var D=new _(d.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),R=this;return D.on("end",function(){if(this.streamInfo.data_length!==R.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),D},getCompressedWorker:function(){return new _(d.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},S.createWorkerFrom=function(D,R,I){return D.pipe(new w).pipe(new a("uncompressedSize")).pipe(R.compressWorker(I)).pipe(new a("compressedSize")).withStreamInfo("compression",R)},l.exports=S},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,l,c){var d=n("./stream/GenericWorker");c.STORE={magic:"\0\0",compressWorker:function(){return new d("STORE compression")},uncompressWorker:function(){return new d("STORE decompression")}},c.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,l,c){var d=n("./utils"),_=function(){for(var w,a=[],S=0;S<256;S++){w=S;for(var D=0;D<8;D++)w=1&w?3988292384^w>>>1:w>>>1;a[S]=w}return a}();l.exports=function(w,a){return w!==void 0&&w.length?d.getTypeOf(w)!=="string"?function(S,D,R,I){var M=_,N=I+R;S^=-1;for(var j=I;j<N;j++)S=S>>>8^M[255&(S^D[j])];return-1^S}(0|a,w,w.length,0):function(S,D,R,I){var M=_,N=I+R;S^=-1;for(var j=I;j<N;j++)S=S>>>8^M[255&(S^D.charCodeAt(j))];return-1^S}(0|a,w,w.length,0):0}},{"./utils":32}],5:[function(n,l,c){c.base64=!1,c.binary=!1,c.dir=!1,c.createFolders=!0,c.date=null,c.compression=null,c.compressionOptions=null,c.comment=null,c.unixPermissions=null,c.dosPermissions=null},{}],6:[function(n,l,c){var d=null;d=typeof Promise<"u"?Promise:n("lie"),l.exports={Promise:d}},{lie:37}],7:[function(n,l,c){var d=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",_=n("pako"),w=n("./utils"),a=n("./stream/GenericWorker"),S=d?"uint8array":"array";function D(R,I){a.call(this,"FlateWorker/"+R),this._pako=null,this._pakoAction=R,this._pakoOptions=I,this.meta={}}c.magic="\b\0",w.inherits(D,a),D.prototype.processChunk=function(R){this.meta=R.meta,this._pako===null&&this._createPako(),this._pako.push(w.transformTo(S,R.data),!1)},D.prototype.flush=function(){a.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},D.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},D.prototype._createPako=function(){this._pako=new _[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var R=this;this._pako.onData=function(I){R.push({data:I,meta:R.meta})}},c.compressWorker=function(R){return new D("Deflate",R)},c.uncompressWorker=function(){return new D("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,l,c){function d(M,N){var j,W="";for(j=0;j<N;j++)W+=String.fromCharCode(255&M),M>>>=8;return W}function _(M,N,j,W,B,k){var z,Z,ee=M.file,se=M.compression,ue=k!==S.utf8encode,Te=w.transformTo("string",k(ee.name)),Q=w.transformTo("string",S.utf8encode(ee.name)),he=ee.comment,ye=w.transformTo("string",k(he)),J=w.transformTo("string",S.utf8encode(he)),ie=Q.length!==ee.name.length,q=J.length!==he.length,Ke="",Mt="",ct="",He=ee.dir,_e=ee.date,qe={crc32:0,compressedSize:0,uncompressedSize:0};N&&!j||(qe.crc32=M.crc32,qe.compressedSize=M.compressedSize,qe.uncompressedSize=M.uncompressedSize);var Pe=0;N&&(Pe|=8),ue||!ie&&!q||(Pe|=2048);var Le=0,Pt=0;He&&(Le|=16),B==="UNIX"?(Pt=798,Le|=function(at,Jt){var Er=at;return at||(Er=Jt?16893:33204),(65535&Er)<<16}(ee.unixPermissions,He)):(Pt=20,Le|=function(at){return 63&(at||0)}(ee.dosPermissions)),z=_e.getUTCHours(),z<<=6,z|=_e.getUTCMinutes(),z<<=5,z|=_e.getUTCSeconds()/2,Z=_e.getUTCFullYear()-1980,Z<<=4,Z|=_e.getUTCMonth()+1,Z<<=5,Z|=_e.getUTCDate(),ie&&(Mt=d(1,1)+d(D(Te),4)+Q,Ke+="up"+d(Mt.length,2)+Mt),q&&(ct=d(1,1)+d(D(ye),4)+J,Ke+="uc"+d(ct.length,2)+ct);var lt="";return lt+=`
\0`,lt+=d(Pe,2),lt+=se.magic,lt+=d(z,2),lt+=d(Z,2),lt+=d(qe.crc32,4),lt+=d(qe.compressedSize,4),lt+=d(qe.uncompressedSize,4),lt+=d(Te.length,2),lt+=d(Ke.length,2),{fileRecord:R.LOCAL_FILE_HEADER+lt+Te+Ke,dirRecord:R.CENTRAL_FILE_HEADER+d(Pt,2)+lt+d(ye.length,2)+"\0\0\0\0"+d(Le,4)+d(W,4)+Te+Ke+ye}}var w=n("../utils"),a=n("../stream/GenericWorker"),S=n("../utf8"),D=n("../crc32"),R=n("../signature");function I(M,N,j,W){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=N,this.zipPlatform=j,this.encodeFileName=W,this.streamFiles=M,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}w.inherits(I,a),I.prototype.push=function(M){var N=M.meta.percent||0,j=this.entriesCount,W=this._sources.length;this.accumulate?this.contentBuffer.push(M):(this.bytesWritten+=M.data.length,a.prototype.push.call(this,{data:M.data,meta:{currentFile:this.currentFile,percent:j?(N+100*(j-W-1))/j:100}}))},I.prototype.openedSource=function(M){this.currentSourceOffset=this.bytesWritten,this.currentFile=M.file.name;var N=this.streamFiles&&!M.file.dir;if(N){var j=_(M,N,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:j.fileRecord,meta:{percent:0}})}else this.accumulate=!0},I.prototype.closedSource=function(M){this.accumulate=!1;var N=this.streamFiles&&!M.file.dir,j=_(M,N,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(j.dirRecord),N)this.push({data:function(W){return R.DATA_DESCRIPTOR+d(W.crc32,4)+d(W.compressedSize,4)+d(W.uncompressedSize,4)}(M),meta:{percent:100}});else for(this.push({data:j.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},I.prototype.flush=function(){for(var M=this.bytesWritten,N=0;N<this.dirRecords.length;N++)this.push({data:this.dirRecords[N],meta:{percent:100}});var j=this.bytesWritten-M,W=function(B,k,z,Z,ee){var se=w.transformTo("string",ee(Z));return R.CENTRAL_DIRECTORY_END+"\0\0\0\0"+d(B,2)+d(B,2)+d(k,4)+d(z,4)+d(se.length,2)+se}(this.dirRecords.length,j,M,this.zipComment,this.encodeFileName);this.push({data:W,meta:{percent:100}})},I.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},I.prototype.registerPrevious=function(M){this._sources.push(M);var N=this;return M.on("data",function(j){N.processChunk(j)}),M.on("end",function(){N.closedSource(N.previous.streamInfo),N._sources.length?N.prepareNextSource():N.end()}),M.on("error",function(j){N.error(j)}),this},I.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},I.prototype.error=function(M){var N=this._sources;if(!a.prototype.error.call(this,M))return!1;for(var j=0;j<N.length;j++)try{N[j].error(M)}catch{}return!0},I.prototype.lock=function(){a.prototype.lock.call(this);for(var M=this._sources,N=0;N<M.length;N++)M[N].lock()},l.exports=I},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,l,c){var d=n("../compressions"),_=n("./ZipFileWorker");c.generateWorker=function(w,a,S){var D=new _(a.streamFiles,S,a.platform,a.encodeFileName),R=0;try{w.forEach(function(I,M){R++;var N=function(k,z){var Z=k||z,ee=d[Z];if(!ee)throw new Error(Z+" is not a valid compression method !");return ee}(M.options.compression,a.compression),j=M.options.compressionOptions||a.compressionOptions||{},W=M.dir,B=M.date;M._compressWorker(N,j).withStreamInfo("file",{name:I,dir:W,date:B,comment:M.comment||"",unixPermissions:M.unixPermissions,dosPermissions:M.dosPermissions}).pipe(D)}),D.entriesCount=R}catch(I){D.error(I)}return D}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,l,c){function d(){if(!(this instanceof d))return new d;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var _=new d;for(var w in this)typeof this[w]!="function"&&(_[w]=this[w]);return _}}(d.prototype=n("./object")).loadAsync=n("./load"),d.support=n("./support"),d.defaults=n("./defaults"),d.version="3.10.1",d.loadAsync=function(_,w){return new d().loadAsync(_,w)},d.external=n("./external"),l.exports=d},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,l,c){var d=n("./utils"),_=n("./external"),w=n("./utf8"),a=n("./zipEntries"),S=n("./stream/Crc32Probe"),D=n("./nodejsUtils");function R(I){return new _.Promise(function(M,N){var j=I.decompressed.getContentWorker().pipe(new S);j.on("error",function(W){N(W)}).on("end",function(){j.streamInfo.crc32!==I.decompressed.crc32?N(new Error("Corrupted zip : CRC32 mismatch")):M()}).resume()})}l.exports=function(I,M){var N=this;return M=d.extend(M||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:w.utf8decode}),D.isNode&&D.isStream(I)?_.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):d.prepareContent("the loaded zip file",I,!0,M.optimizedBinaryString,M.base64).then(function(j){var W=new a(M);return W.load(j),W}).then(function(j){var W=[_.Promise.resolve(j)],B=j.files;if(M.checkCRC32)for(var k=0;k<B.length;k++)W.push(R(B[k]));return _.Promise.all(W)}).then(function(j){for(var W=j.shift(),B=W.files,k=0;k<B.length;k++){var z=B[k],Z=z.fileNameStr,ee=d.resolve(z.fileNameStr);N.file(ee,z.decompressed,{binary:!0,optimizedBinaryString:!0,date:z.date,dir:z.dir,comment:z.fileCommentStr.length?z.fileCommentStr:null,unixPermissions:z.unixPermissions,dosPermissions:z.dosPermissions,createFolders:M.createFolders}),z.dir||(N.file(ee).unsafeOriginalName=Z)}return W.zipComment.length&&(N.comment=W.zipComment),N})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,l,c){var d=n("../utils"),_=n("../stream/GenericWorker");function w(a,S){_.call(this,"Nodejs stream input adapter for "+a),this._upstreamEnded=!1,this._bindStream(S)}d.inherits(w,_),w.prototype._bindStream=function(a){var S=this;(this._stream=a).pause(),a.on("data",function(D){S.push({data:D,meta:{percent:0}})}).on("error",function(D){S.isPaused?this.generatedError=D:S.error(D)}).on("end",function(){S.isPaused?S._upstreamEnded=!0:S.end()})},w.prototype.pause=function(){return!!_.prototype.pause.call(this)&&(this._stream.pause(),!0)},w.prototype.resume=function(){return!!_.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},l.exports=w},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,l,c){var d=n("readable-stream").Readable;function _(w,a,S){d.call(this,a),this._helper=w;var D=this;w.on("data",function(R,I){D.push(R)||D._helper.pause(),S&&S(I)}).on("error",function(R){D.emit("error",R)}).on("end",function(){D.push(null)})}n("../utils").inherits(_,d),_.prototype._read=function(){this._helper.resume()},l.exports=_},{"../utils":32,"readable-stream":16}],14:[function(n,l,c){l.exports={isNode:typeof Buffer<"u",newBufferFrom:function(d,_){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(d,_);if(typeof d=="number")throw new Error('The "data" argument must not be a number');return new Buffer(d,_)},allocBuffer:function(d){if(Buffer.alloc)return Buffer.alloc(d);var _=new Buffer(d);return _.fill(0),_},isBuffer:function(d){return Buffer.isBuffer(d)},isStream:function(d){return d&&typeof d.on=="function"&&typeof d.pause=="function"&&typeof d.resume=="function"}}},{}],15:[function(n,l,c){function d(ee,se,ue){var Te,Q=w.getTypeOf(se),he=w.extend(ue||{},D);he.date=he.date||new Date,he.compression!==null&&(he.compression=he.compression.toUpperCase()),typeof he.unixPermissions=="string"&&(he.unixPermissions=parseInt(he.unixPermissions,8)),he.unixPermissions&&16384&he.unixPermissions&&(he.dir=!0),he.dosPermissions&&16&he.dosPermissions&&(he.dir=!0),he.dir&&(ee=B(ee)),he.createFolders&&(Te=W(ee))&&k.call(this,Te,!0);var ye=Q==="string"&&he.binary===!1&&he.base64===!1;ue&&ue.binary!==void 0||(he.binary=!ye),(se instanceof R&&se.uncompressedSize===0||he.dir||!se||se.length===0)&&(he.base64=!1,he.binary=!0,se="",he.compression="STORE",Q="string");var J=null;J=se instanceof R||se instanceof a?se:N.isNode&&N.isStream(se)?new j(ee,se):w.prepareContent(ee,se,he.binary,he.optimizedBinaryString,he.base64);var ie=new I(ee,J,he);this.files[ee]=ie}var _=n("./utf8"),w=n("./utils"),a=n("./stream/GenericWorker"),S=n("./stream/StreamHelper"),D=n("./defaults"),R=n("./compressedObject"),I=n("./zipObject"),M=n("./generate"),N=n("./nodejsUtils"),j=n("./nodejs/NodejsStreamInputAdapter"),W=function(ee){ee.slice(-1)==="/"&&(ee=ee.substring(0,ee.length-1));var se=ee.lastIndexOf("/");return 0<se?ee.substring(0,se):""},B=function(ee){return ee.slice(-1)!=="/"&&(ee+="/"),ee},k=function(ee,se){return se=se!==void 0?se:D.createFolders,ee=B(ee),this.files[ee]||d.call(this,ee,null,{dir:!0,createFolders:se}),this.files[ee]};function z(ee){return Object.prototype.toString.call(ee)==="[object RegExp]"}var Z={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(ee){var se,ue,Te;for(se in this.files)Te=this.files[se],(ue=se.slice(this.root.length,se.length))&&se.slice(0,this.root.length)===this.root&&ee(ue,Te)},filter:function(ee){var se=[];return this.forEach(function(ue,Te){ee(ue,Te)&&se.push(Te)}),se},file:function(ee,se,ue){if(arguments.length!==1)return ee=this.root+ee,d.call(this,ee,se,ue),this;if(z(ee)){var Te=ee;return this.filter(function(he,ye){return!ye.dir&&Te.test(he)})}var Q=this.files[this.root+ee];return Q&&!Q.dir?Q:null},folder:function(ee){if(!ee)return this;if(z(ee))return this.filter(function(Q,he){return he.dir&&ee.test(Q)});var se=this.root+ee,ue=k.call(this,se),Te=this.clone();return Te.root=ue.name,Te},remove:function(ee){ee=this.root+ee;var se=this.files[ee];if(se||(ee.slice(-1)!=="/"&&(ee+="/"),se=this.files[ee]),se&&!se.dir)delete this.files[ee];else for(var ue=this.filter(function(Q,he){return he.name.slice(0,ee.length)===ee}),Te=0;Te<ue.length;Te++)delete this.files[ue[Te].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(ee){var se,ue={};try{if((ue=w.extend(ee||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:_.utf8encode})).type=ue.type.toLowerCase(),ue.compression=ue.compression.toUpperCase(),ue.type==="binarystring"&&(ue.type="string"),!ue.type)throw new Error("No output type specified.");w.checkSupport(ue.type),ue.platform!=="darwin"&&ue.platform!=="freebsd"&&ue.platform!=="linux"&&ue.platform!=="sunos"||(ue.platform="UNIX"),ue.platform==="win32"&&(ue.platform="DOS");var Te=ue.comment||this.comment||"";se=M.generateWorker(this,ue,Te)}catch(Q){(se=new a("error")).error(Q)}return new S(se,ue.type||"string",ue.mimeType)},generateAsync:function(ee,se){return this.generateInternalStream(ee).accumulate(se)},generateNodeStream:function(ee,se){return(ee=ee||{}).type||(ee.type="nodebuffer"),this.generateInternalStream(ee).toNodejsStream(se)}};l.exports=Z},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,l,c){l.exports=n("stream")},{stream:void 0}],17:[function(n,l,c){var d=n("./DataReader");function _(w){d.call(this,w);for(var a=0;a<this.data.length;a++)w[a]=255&w[a]}n("../utils").inherits(_,d),_.prototype.byteAt=function(w){return this.data[this.zero+w]},_.prototype.lastIndexOfSignature=function(w){for(var a=w.charCodeAt(0),S=w.charCodeAt(1),D=w.charCodeAt(2),R=w.charCodeAt(3),I=this.length-4;0<=I;--I)if(this.data[I]===a&&this.data[I+1]===S&&this.data[I+2]===D&&this.data[I+3]===R)return I-this.zero;return-1},_.prototype.readAndCheckSignature=function(w){var a=w.charCodeAt(0),S=w.charCodeAt(1),D=w.charCodeAt(2),R=w.charCodeAt(3),I=this.readData(4);return a===I[0]&&S===I[1]&&D===I[2]&&R===I[3]},_.prototype.readData=function(w){if(this.checkOffset(w),w===0)return[];var a=this.data.slice(this.zero+this.index,this.zero+this.index+w);return this.index+=w,a},l.exports=_},{"../utils":32,"./DataReader":18}],18:[function(n,l,c){var d=n("../utils");function _(w){this.data=w,this.length=w.length,this.index=0,this.zero=0}_.prototype={checkOffset:function(w){this.checkIndex(this.index+w)},checkIndex:function(w){if(this.length<this.zero+w||w<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+w+"). Corrupted zip ?")},setIndex:function(w){this.checkIndex(w),this.index=w},skip:function(w){this.setIndex(this.index+w)},byteAt:function(){},readInt:function(w){var a,S=0;for(this.checkOffset(w),a=this.index+w-1;a>=this.index;a--)S=(S<<8)+this.byteAt(a);return this.index+=w,S},readString:function(w){return d.transformTo("string",this.readData(w))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var w=this.readInt(4);return new Date(Date.UTC(1980+(w>>25&127),(w>>21&15)-1,w>>16&31,w>>11&31,w>>5&63,(31&w)<<1))}},l.exports=_},{"../utils":32}],19:[function(n,l,c){var d=n("./Uint8ArrayReader");function _(w){d.call(this,w)}n("../utils").inherits(_,d),_.prototype.readData=function(w){this.checkOffset(w);var a=this.data.slice(this.zero+this.index,this.zero+this.index+w);return this.index+=w,a},l.exports=_},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,l,c){var d=n("./DataReader");function _(w){d.call(this,w)}n("../utils").inherits(_,d),_.prototype.byteAt=function(w){return this.data.charCodeAt(this.zero+w)},_.prototype.lastIndexOfSignature=function(w){return this.data.lastIndexOf(w)-this.zero},_.prototype.readAndCheckSignature=function(w){return w===this.readData(4)},_.prototype.readData=function(w){this.checkOffset(w);var a=this.data.slice(this.zero+this.index,this.zero+this.index+w);return this.index+=w,a},l.exports=_},{"../utils":32,"./DataReader":18}],21:[function(n,l,c){var d=n("./ArrayReader");function _(w){d.call(this,w)}n("../utils").inherits(_,d),_.prototype.readData=function(w){if(this.checkOffset(w),w===0)return new Uint8Array(0);var a=this.data.subarray(this.zero+this.index,this.zero+this.index+w);return this.index+=w,a},l.exports=_},{"../utils":32,"./ArrayReader":17}],22:[function(n,l,c){var d=n("../utils"),_=n("../support"),w=n("./ArrayReader"),a=n("./StringReader"),S=n("./NodeBufferReader"),D=n("./Uint8ArrayReader");l.exports=function(R){var I=d.getTypeOf(R);return d.checkSupport(I),I!=="string"||_.uint8array?I==="nodebuffer"?new S(R):_.uint8array?new D(d.transformTo("uint8array",R)):new w(d.transformTo("array",R)):new a(R)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,l,c){c.LOCAL_FILE_HEADER="PK",c.CENTRAL_FILE_HEADER="PK",c.CENTRAL_DIRECTORY_END="PK",c.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",c.ZIP64_CENTRAL_DIRECTORY_END="PK",c.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,l,c){var d=n("./GenericWorker"),_=n("../utils");function w(a){d.call(this,"ConvertWorker to "+a),this.destType=a}_.inherits(w,d),w.prototype.processChunk=function(a){this.push({data:_.transformTo(this.destType,a.data),meta:a.meta})},l.exports=w},{"../utils":32,"./GenericWorker":28}],25:[function(n,l,c){var d=n("./GenericWorker"),_=n("../crc32");function w(){d.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(w,d),w.prototype.processChunk=function(a){this.streamInfo.crc32=_(a.data,this.streamInfo.crc32||0),this.push(a)},l.exports=w},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,l,c){var d=n("../utils"),_=n("./GenericWorker");function w(a){_.call(this,"DataLengthProbe for "+a),this.propName=a,this.withStreamInfo(a,0)}d.inherits(w,_),w.prototype.processChunk=function(a){if(a){var S=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=S+a.data.length}_.prototype.processChunk.call(this,a)},l.exports=w},{"../utils":32,"./GenericWorker":28}],27:[function(n,l,c){var d=n("../utils"),_=n("./GenericWorker");function w(a){_.call(this,"DataWorker");var S=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,a.then(function(D){S.dataIsReady=!0,S.data=D,S.max=D&&D.length||0,S.type=d.getTypeOf(D),S.isPaused||S._tickAndRepeat()},function(D){S.error(D)})}d.inherits(w,_),w.prototype.cleanUp=function(){_.prototype.cleanUp.call(this),this.data=null},w.prototype.resume=function(){return!!_.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,d.delay(this._tickAndRepeat,[],this)),!0)},w.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(d.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},w.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=null,S=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":a=this.data.substring(this.index,S);break;case"uint8array":a=this.data.subarray(this.index,S);break;case"array":case"nodebuffer":a=this.data.slice(this.index,S)}return this.index=S,this.push({data:a,meta:{percent:this.max?this.index/this.max*100:0}})},l.exports=w},{"../utils":32,"./GenericWorker":28}],28:[function(n,l,c){function d(_){this.name=_||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}d.prototype={push:function(_){this.emit("data",_)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(_){this.emit("error",_)}return!0},error:function(_){return!this.isFinished&&(this.isPaused?this.generatedError=_:(this.isFinished=!0,this.emit("error",_),this.previous&&this.previous.error(_),this.cleanUp()),!0)},on:function(_,w){return this._listeners[_].push(w),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(_,w){if(this._listeners[_])for(var a=0;a<this._listeners[_].length;a++)this._listeners[_][a].call(this,w)},pipe:function(_){return _.registerPrevious(this)},registerPrevious:function(_){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=_.streamInfo,this.mergeStreamInfo(),this.previous=_;var w=this;return _.on("data",function(a){w.processChunk(a)}),_.on("end",function(){w.end()}),_.on("error",function(a){w.error(a)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var _=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),_=!0),this.previous&&this.previous.resume(),!_},flush:function(){},processChunk:function(_){this.push(_)},withStreamInfo:function(_,w){return this.extraStreamInfo[_]=w,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var _ in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,_)&&(this.streamInfo[_]=this.extraStreamInfo[_])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var _="Worker "+this.name;return this.previous?this.previous+" -> "+_:_}},l.exports=d},{}],29:[function(n,l,c){var d=n("../utils"),_=n("./ConvertWorker"),w=n("./GenericWorker"),a=n("../base64"),S=n("../support"),D=n("../external"),R=null;if(S.nodestream)try{R=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function I(N,j){return new D.Promise(function(W,B){var k=[],z=N._internalType,Z=N._outputType,ee=N._mimeType;N.on("data",function(se,ue){k.push(se),j&&j(ue)}).on("error",function(se){k=[],B(se)}).on("end",function(){try{var se=function(ue,Te,Q){switch(ue){case"blob":return d.newBlob(d.transformTo("arraybuffer",Te),Q);case"base64":return a.encode(Te);default:return d.transformTo(ue,Te)}}(Z,function(ue,Te){var Q,he=0,ye=null,J=0;for(Q=0;Q<Te.length;Q++)J+=Te[Q].length;switch(ue){case"string":return Te.join("");case"array":return Array.prototype.concat.apply([],Te);case"uint8array":for(ye=new Uint8Array(J),Q=0;Q<Te.length;Q++)ye.set(Te[Q],he),he+=Te[Q].length;return ye;case"nodebuffer":return Buffer.concat(Te);default:throw new Error("concat : unsupported type '"+ue+"'")}}(z,k),ee);W(se)}catch(ue){B(ue)}k=[]}).resume()})}function M(N,j,W){var B=j;switch(j){case"blob":case"arraybuffer":B="uint8array";break;case"base64":B="string"}try{this._internalType=B,this._outputType=j,this._mimeType=W,d.checkSupport(B),this._worker=N.pipe(new _(B)),N.lock()}catch(k){this._worker=new w("error"),this._worker.error(k)}}M.prototype={accumulate:function(N){return I(this,N)},on:function(N,j){var W=this;return N==="data"?this._worker.on(N,function(B){j.call(W,B.data,B.meta)}):this._worker.on(N,function(){d.delay(j,arguments,W)}),this},resume:function(){return d.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(N){if(d.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new R(this,{objectMode:this._outputType!=="nodebuffer"},N)}},l.exports=M},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,l,c){if(c.base64=!0,c.array=!0,c.string=!0,c.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",c.nodebuffer=typeof Buffer<"u",c.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")c.blob=!1;else{var d=new ArrayBuffer(0);try{c.blob=new Blob([d],{type:"application/zip"}).size===0}catch{try{var _=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);_.append(d),c.blob=_.getBlob("application/zip").size===0}catch{c.blob=!1}}}try{c.nodestream=!!n("readable-stream").Readable}catch{c.nodestream=!1}},{"readable-stream":16}],31:[function(n,l,c){for(var d=n("./utils"),_=n("./support"),w=n("./nodejsUtils"),a=n("./stream/GenericWorker"),S=new Array(256),D=0;D<256;D++)S[D]=252<=D?6:248<=D?5:240<=D?4:224<=D?3:192<=D?2:1;S[254]=S[254]=1;function R(){a.call(this,"utf-8 decode"),this.leftOver=null}function I(){a.call(this,"utf-8 encode")}c.utf8encode=function(M){return _.nodebuffer?w.newBufferFrom(M,"utf-8"):function(N){var j,W,B,k,z,Z=N.length,ee=0;for(k=0;k<Z;k++)(64512&(W=N.charCodeAt(k)))==55296&&k+1<Z&&(64512&(B=N.charCodeAt(k+1)))==56320&&(W=65536+(W-55296<<10)+(B-56320),k++),ee+=W<128?1:W<2048?2:W<65536?3:4;for(j=_.uint8array?new Uint8Array(ee):new Array(ee),k=z=0;z<ee;k++)(64512&(W=N.charCodeAt(k)))==55296&&k+1<Z&&(64512&(B=N.charCodeAt(k+1)))==56320&&(W=65536+(W-55296<<10)+(B-56320),k++),W<128?j[z++]=W:(W<2048?j[z++]=192|W>>>6:(W<65536?j[z++]=224|W>>>12:(j[z++]=240|W>>>18,j[z++]=128|W>>>12&63),j[z++]=128|W>>>6&63),j[z++]=128|63&W);return j}(M)},c.utf8decode=function(M){return _.nodebuffer?d.transformTo("nodebuffer",M).toString("utf-8"):function(N){var j,W,B,k,z=N.length,Z=new Array(2*z);for(j=W=0;j<z;)if((B=N[j++])<128)Z[W++]=B;else if(4<(k=S[B]))Z[W++]=65533,j+=k-1;else{for(B&=k===2?31:k===3?15:7;1<k&&j<z;)B=B<<6|63&N[j++],k--;1<k?Z[W++]=65533:B<65536?Z[W++]=B:(B-=65536,Z[W++]=55296|B>>10&1023,Z[W++]=56320|1023&B)}return Z.length!==W&&(Z.subarray?Z=Z.subarray(0,W):Z.length=W),d.applyFromCharCode(Z)}(M=d.transformTo(_.uint8array?"uint8array":"array",M))},d.inherits(R,a),R.prototype.processChunk=function(M){var N=d.transformTo(_.uint8array?"uint8array":"array",M.data);if(this.leftOver&&this.leftOver.length){if(_.uint8array){var j=N;(N=new Uint8Array(j.length+this.leftOver.length)).set(this.leftOver,0),N.set(j,this.leftOver.length)}else N=this.leftOver.concat(N);this.leftOver=null}var W=function(k,z){var Z;for((z=z||k.length)>k.length&&(z=k.length),Z=z-1;0<=Z&&(192&k[Z])==128;)Z--;return Z<0||Z===0?z:Z+S[k[Z]]>z?Z:z}(N),B=N;W!==N.length&&(_.uint8array?(B=N.subarray(0,W),this.leftOver=N.subarray(W,N.length)):(B=N.slice(0,W),this.leftOver=N.slice(W,N.length))),this.push({data:c.utf8decode(B),meta:M.meta})},R.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:c.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},c.Utf8DecodeWorker=R,d.inherits(I,a),I.prototype.processChunk=function(M){this.push({data:c.utf8encode(M.data),meta:M.meta})},c.Utf8EncodeWorker=I},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,l,c){var d=n("./support"),_=n("./base64"),w=n("./nodejsUtils"),a=n("./external");function S(j){return j}function D(j,W){for(var B=0;B<j.length;++B)W[B]=255&j.charCodeAt(B);return W}n("setimmediate"),c.newBlob=function(j,W){c.checkSupport("blob");try{return new Blob([j],{type:W})}catch{try{var B=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return B.append(j),B.getBlob(W)}catch{throw new Error("Bug : can't construct the Blob.")}}};var R={stringifyByChunk:function(j,W,B){var k=[],z=0,Z=j.length;if(Z<=B)return String.fromCharCode.apply(null,j);for(;z<Z;)W==="array"||W==="nodebuffer"?k.push(String.fromCharCode.apply(null,j.slice(z,Math.min(z+B,Z)))):k.push(String.fromCharCode.apply(null,j.subarray(z,Math.min(z+B,Z)))),z+=B;return k.join("")},stringifyByChar:function(j){for(var W="",B=0;B<j.length;B++)W+=String.fromCharCode(j[B]);return W},applyCanBeUsed:{uint8array:function(){try{return d.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return d.nodebuffer&&String.fromCharCode.apply(null,w.allocBuffer(1)).length===1}catch{return!1}}()}};function I(j){var W=65536,B=c.getTypeOf(j),k=!0;if(B==="uint8array"?k=R.applyCanBeUsed.uint8array:B==="nodebuffer"&&(k=R.applyCanBeUsed.nodebuffer),k)for(;1<W;)try{return R.stringifyByChunk(j,B,W)}catch{W=Math.floor(W/2)}return R.stringifyByChar(j)}function M(j,W){for(var B=0;B<j.length;B++)W[B]=j[B];return W}c.applyFromCharCode=I;var N={};N.string={string:S,array:function(j){return D(j,new Array(j.length))},arraybuffer:function(j){return N.string.uint8array(j).buffer},uint8array:function(j){return D(j,new Uint8Array(j.length))},nodebuffer:function(j){return D(j,w.allocBuffer(j.length))}},N.array={string:I,array:S,arraybuffer:function(j){return new Uint8Array(j).buffer},uint8array:function(j){return new Uint8Array(j)},nodebuffer:function(j){return w.newBufferFrom(j)}},N.arraybuffer={string:function(j){return I(new Uint8Array(j))},array:function(j){return M(new Uint8Array(j),new Array(j.byteLength))},arraybuffer:S,uint8array:function(j){return new Uint8Array(j)},nodebuffer:function(j){return w.newBufferFrom(new Uint8Array(j))}},N.uint8array={string:I,array:function(j){return M(j,new Array(j.length))},arraybuffer:function(j){return j.buffer},uint8array:S,nodebuffer:function(j){return w.newBufferFrom(j)}},N.nodebuffer={string:I,array:function(j){return M(j,new Array(j.length))},arraybuffer:function(j){return N.nodebuffer.uint8array(j).buffer},uint8array:function(j){return M(j,new Uint8Array(j.length))},nodebuffer:S},c.transformTo=function(j,W){if(W=W||"",!j)return W;c.checkSupport(j);var B=c.getTypeOf(W);return N[B][j](W)},c.resolve=function(j){for(var W=j.split("/"),B=[],k=0;k<W.length;k++){var z=W[k];z==="."||z===""&&k!==0&&k!==W.length-1||(z===".."?B.pop():B.push(z))}return B.join("/")},c.getTypeOf=function(j){return typeof j=="string"?"string":Object.prototype.toString.call(j)==="[object Array]"?"array":d.nodebuffer&&w.isBuffer(j)?"nodebuffer":d.uint8array&&j instanceof Uint8Array?"uint8array":d.arraybuffer&&j instanceof ArrayBuffer?"arraybuffer":void 0},c.checkSupport=function(j){if(!d[j.toLowerCase()])throw new Error(j+" is not supported by this platform")},c.MAX_VALUE_16BITS=65535,c.MAX_VALUE_32BITS=-1,c.pretty=function(j){var W,B,k="";for(B=0;B<(j||"").length;B++)k+="\\x"+((W=j.charCodeAt(B))<16?"0":"")+W.toString(16).toUpperCase();return k},c.delay=function(j,W,B){setImmediate(function(){j.apply(B||null,W||[])})},c.inherits=function(j,W){function B(){}B.prototype=W.prototype,j.prototype=new B},c.extend=function(){var j,W,B={};for(j=0;j<arguments.length;j++)for(W in arguments[j])Object.prototype.hasOwnProperty.call(arguments[j],W)&&B[W]===void 0&&(B[W]=arguments[j][W]);return B},c.prepareContent=function(j,W,B,k,z){return a.Promise.resolve(W).then(function(Z){return d.blob&&(Z instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(Z))!==-1)&&typeof FileReader<"u"?new a.Promise(function(ee,se){var ue=new FileReader;ue.onload=function(Te){ee(Te.target.result)},ue.onerror=function(Te){se(Te.target.error)},ue.readAsArrayBuffer(Z)}):Z}).then(function(Z){var ee=c.getTypeOf(Z);return ee?(ee==="arraybuffer"?Z=c.transformTo("uint8array",Z):ee==="string"&&(z?Z=_.decode(Z):B&&k!==!0&&(Z=function(se){return D(se,d.uint8array?new Uint8Array(se.length):new Array(se.length))}(Z))),Z):a.Promise.reject(new Error("Can't read the data of '"+j+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,l,c){var d=n("./reader/readerFor"),_=n("./utils"),w=n("./signature"),a=n("./zipEntry"),S=n("./support");function D(R){this.files=[],this.loadOptions=R}D.prototype={checkSignature:function(R){if(!this.reader.readAndCheckSignature(R)){this.reader.index-=4;var I=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+_.pretty(I)+", expected "+_.pretty(R)+")")}},isSignature:function(R,I){var M=this.reader.index;this.reader.setIndex(R);var N=this.reader.readString(4)===I;return this.reader.setIndex(M),N},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var R=this.reader.readData(this.zipCommentLength),I=S.uint8array?"uint8array":"array",M=_.transformTo(I,R);this.zipComment=this.loadOptions.decodeFileName(M)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var R,I,M,N=this.zip64EndOfCentralSize-44;0<N;)R=this.reader.readInt(2),I=this.reader.readInt(4),M=this.reader.readData(I),this.zip64ExtensibleData[R]={id:R,length:I,value:M}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var R,I;for(R=0;R<this.files.length;R++)I=this.files[R],this.reader.setIndex(I.localHeaderOffset),this.checkSignature(w.LOCAL_FILE_HEADER),I.readLocalPart(this.reader),I.handleUTF8(),I.processAttributes()},readCentralDir:function(){var R;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(w.CENTRAL_FILE_HEADER);)(R=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(R);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var R=this.reader.lastIndexOfSignature(w.CENTRAL_DIRECTORY_END);if(R<0)throw this.isSignature(0,w.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(R);var I=R;if(this.checkSignature(w.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===_.MAX_VALUE_16BITS||this.diskWithCentralDirStart===_.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===_.MAX_VALUE_16BITS||this.centralDirRecords===_.MAX_VALUE_16BITS||this.centralDirSize===_.MAX_VALUE_32BITS||this.centralDirOffset===_.MAX_VALUE_32BITS){if(this.zip64=!0,(R=this.reader.lastIndexOfSignature(w.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(R),this.checkSignature(w.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,w.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(w.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(w.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var M=this.centralDirOffset+this.centralDirSize;this.zip64&&(M+=20,M+=12+this.zip64EndOfCentralSize);var N=I-M;if(0<N)this.isSignature(I,w.CENTRAL_FILE_HEADER)||(this.reader.zero=N);else if(N<0)throw new Error("Corrupted zip: missing "+Math.abs(N)+" bytes.")},prepareReader:function(R){this.reader=d(R)},load:function(R){this.prepareReader(R),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},l.exports=D},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,l,c){var d=n("./reader/readerFor"),_=n("./utils"),w=n("./compressedObject"),a=n("./crc32"),S=n("./utf8"),D=n("./compressions"),R=n("./support");function I(M,N){this.options=M,this.loadOptions=N}I.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(M){var N,j;if(M.skip(22),this.fileNameLength=M.readInt(2),j=M.readInt(2),this.fileName=M.readData(this.fileNameLength),M.skip(j),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((N=function(W){for(var B in D)if(Object.prototype.hasOwnProperty.call(D,B)&&D[B].magic===W)return D[B];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+_.pretty(this.compressionMethod)+" unknown (inner file : "+_.transformTo("string",this.fileName)+")");this.decompressed=new w(this.compressedSize,this.uncompressedSize,this.crc32,N,M.readData(this.compressedSize))},readCentralPart:function(M){this.versionMadeBy=M.readInt(2),M.skip(2),this.bitFlag=M.readInt(2),this.compressionMethod=M.readString(2),this.date=M.readDate(),this.crc32=M.readInt(4),this.compressedSize=M.readInt(4),this.uncompressedSize=M.readInt(4);var N=M.readInt(2);if(this.extraFieldsLength=M.readInt(2),this.fileCommentLength=M.readInt(2),this.diskNumberStart=M.readInt(2),this.internalFileAttributes=M.readInt(2),this.externalFileAttributes=M.readInt(4),this.localHeaderOffset=M.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");M.skip(N),this.readExtraFields(M),this.parseZIP64ExtraField(M),this.fileComment=M.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var M=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),M==0&&(this.dosPermissions=63&this.externalFileAttributes),M==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var M=d(this.extraFields[1].value);this.uncompressedSize===_.MAX_VALUE_32BITS&&(this.uncompressedSize=M.readInt(8)),this.compressedSize===_.MAX_VALUE_32BITS&&(this.compressedSize=M.readInt(8)),this.localHeaderOffset===_.MAX_VALUE_32BITS&&(this.localHeaderOffset=M.readInt(8)),this.diskNumberStart===_.MAX_VALUE_32BITS&&(this.diskNumberStart=M.readInt(4))}},readExtraFields:function(M){var N,j,W,B=M.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});M.index+4<B;)N=M.readInt(2),j=M.readInt(2),W=M.readData(j),this.extraFields[N]={id:N,length:j,value:W};M.setIndex(B)},handleUTF8:function(){var M=R.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=S.utf8decode(this.fileName),this.fileCommentStr=S.utf8decode(this.fileComment);else{var N=this.findExtraFieldUnicodePath();if(N!==null)this.fileNameStr=N;else{var j=_.transformTo(M,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(j)}var W=this.findExtraFieldUnicodeComment();if(W!==null)this.fileCommentStr=W;else{var B=_.transformTo(M,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(B)}}},findExtraFieldUnicodePath:function(){var M=this.extraFields[28789];if(M){var N=d(M.value);return N.readInt(1)!==1||a(this.fileName)!==N.readInt(4)?null:S.utf8decode(N.readData(M.length-5))}return null},findExtraFieldUnicodeComment:function(){var M=this.extraFields[25461];if(M){var N=d(M.value);return N.readInt(1)!==1||a(this.fileComment)!==N.readInt(4)?null:S.utf8decode(N.readData(M.length-5))}return null}},l.exports=I},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,l,c){function d(N,j,W){this.name=N,this.dir=W.dir,this.date=W.date,this.comment=W.comment,this.unixPermissions=W.unixPermissions,this.dosPermissions=W.dosPermissions,this._data=j,this._dataBinary=W.binary,this.options={compression:W.compression,compressionOptions:W.compressionOptions}}var _=n("./stream/StreamHelper"),w=n("./stream/DataWorker"),a=n("./utf8"),S=n("./compressedObject"),D=n("./stream/GenericWorker");d.prototype={internalStream:function(N){var j=null,W="string";try{if(!N)throw new Error("No output type specified.");var B=(W=N.toLowerCase())==="string"||W==="text";W!=="binarystring"&&W!=="text"||(W="string"),j=this._decompressWorker();var k=!this._dataBinary;k&&!B&&(j=j.pipe(new a.Utf8EncodeWorker)),!k&&B&&(j=j.pipe(new a.Utf8DecodeWorker))}catch(z){(j=new D("error")).error(z)}return new _(j,W,"")},async:function(N,j){return this.internalStream(N).accumulate(j)},nodeStream:function(N,j){return this.internalStream(N||"nodebuffer").toNodejsStream(j)},_compressWorker:function(N,j){if(this._data instanceof S&&this._data.compression.magic===N.magic)return this._data.getCompressedWorker();var W=this._decompressWorker();return this._dataBinary||(W=W.pipe(new a.Utf8EncodeWorker)),S.createWorkerFrom(W,N,j)},_decompressWorker:function(){return this._data instanceof S?this._data.getContentWorker():this._data instanceof D?this._data:new w(this._data)}};for(var R=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],I=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},M=0;M<R.length;M++)d.prototype[R[M]]=I;l.exports=d},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,l,c){(function(d){var _,w,a=d.MutationObserver||d.WebKitMutationObserver;if(a){var S=0,D=new a(N),R=d.document.createTextNode("");D.observe(R,{characterData:!0}),_=function(){R.data=S=++S%2}}else if(d.setImmediate||d.MessageChannel===void 0)_="document"in d&&"onreadystatechange"in d.document.createElement("script")?function(){var j=d.document.createElement("script");j.onreadystatechange=function(){N(),j.onreadystatechange=null,j.parentNode.removeChild(j),j=null},d.document.documentElement.appendChild(j)}:function(){setTimeout(N,0)};else{var I=new d.MessageChannel;I.port1.onmessage=N,_=function(){I.port2.postMessage(0)}}var M=[];function N(){var j,W;w=!0;for(var B=M.length;B;){for(W=M,M=[],j=-1;++j<B;)W[j]();B=M.length}w=!1}l.exports=function(j){M.push(j)!==1||w||_()}}).call(this,typeof window<"u"?window:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,l,c){var d=n("immediate");function _(){}var w={},a=["REJECTED"],S=["FULFILLED"],D=["PENDING"];function R(B){if(typeof B!="function")throw new TypeError("resolver must be a function");this.state=D,this.queue=[],this.outcome=void 0,B!==_&&j(this,B)}function I(B,k,z){this.promise=B,typeof k=="function"&&(this.onFulfilled=k,this.callFulfilled=this.otherCallFulfilled),typeof z=="function"&&(this.onRejected=z,this.callRejected=this.otherCallRejected)}function M(B,k,z){d(function(){var Z;try{Z=k(z)}catch(ee){return w.reject(B,ee)}Z===B?w.reject(B,new TypeError("Cannot resolve promise with itself")):w.resolve(B,Z)})}function N(B){var k=B&&B.then;if(B&&(typeof B=="object"||typeof B=="function")&&typeof k=="function")return function(){k.apply(B,arguments)}}function j(B,k){var z=!1;function Z(ue){z||(z=!0,w.reject(B,ue))}function ee(ue){z||(z=!0,w.resolve(B,ue))}var se=W(function(){k(ee,Z)});se.status==="error"&&Z(se.value)}function W(B,k){var z={};try{z.value=B(k),z.status="success"}catch(Z){z.status="error",z.value=Z}return z}(l.exports=R).prototype.finally=function(B){if(typeof B!="function")return this;var k=this.constructor;return this.then(function(z){return k.resolve(B()).then(function(){return z})},function(z){return k.resolve(B()).then(function(){throw z})})},R.prototype.catch=function(B){return this.then(null,B)},R.prototype.then=function(B,k){if(typeof B!="function"&&this.state===S||typeof k!="function"&&this.state===a)return this;var z=new this.constructor(_);return this.state!==D?M(z,this.state===S?B:k,this.outcome):this.queue.push(new I(z,B,k)),z},I.prototype.callFulfilled=function(B){w.resolve(this.promise,B)},I.prototype.otherCallFulfilled=function(B){M(this.promise,this.onFulfilled,B)},I.prototype.callRejected=function(B){w.reject(this.promise,B)},I.prototype.otherCallRejected=function(B){M(this.promise,this.onRejected,B)},w.resolve=function(B,k){var z=W(N,k);if(z.status==="error")return w.reject(B,z.value);var Z=z.value;if(Z)j(B,Z);else{B.state=S,B.outcome=k;for(var ee=-1,se=B.queue.length;++ee<se;)B.queue[ee].callFulfilled(k)}return B},w.reject=function(B,k){B.state=a,B.outcome=k;for(var z=-1,Z=B.queue.length;++z<Z;)B.queue[z].callRejected(k);return B},R.resolve=function(B){return B instanceof this?B:w.resolve(new this(_),B)},R.reject=function(B){var k=new this(_);return w.reject(k,B)},R.all=function(B){var k=this;if(Object.prototype.toString.call(B)!=="[object Array]")return this.reject(new TypeError("must be an array"));var z=B.length,Z=!1;if(!z)return this.resolve([]);for(var ee=new Array(z),se=0,ue=-1,Te=new this(_);++ue<z;)Q(B[ue],ue);return Te;function Q(he,ye){k.resolve(he).then(function(J){ee[ye]=J,++se!==z||Z||(Z=!0,w.resolve(Te,ee))},function(J){Z||(Z=!0,w.reject(Te,J))})}},R.race=function(B){var k=this;if(Object.prototype.toString.call(B)!=="[object Array]")return this.reject(new TypeError("must be an array"));var z=B.length,Z=!1;if(!z)return this.resolve([]);for(var ee=-1,se=new this(_);++ee<z;)ue=B[ee],k.resolve(ue).then(function(Te){Z||(Z=!0,w.resolve(se,Te))},function(Te){Z||(Z=!0,w.reject(se,Te))});var ue;return se}},{immediate:36}],38:[function(n,l,c){var d={};(0,n("./lib/utils/common").assign)(d,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),l.exports=d},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,l,c){var d=n("./zlib/deflate"),_=n("./utils/common"),w=n("./utils/strings"),a=n("./zlib/messages"),S=n("./zlib/zstream"),D=Object.prototype.toString,R=0,I=-1,M=0,N=8;function j(B){if(!(this instanceof j))return new j(B);this.options=_.assign({level:I,method:N,chunkSize:16384,windowBits:15,memLevel:8,strategy:M,to:""},B||{});var k=this.options;k.raw&&0<k.windowBits?k.windowBits=-k.windowBits:k.gzip&&0<k.windowBits&&k.windowBits<16&&(k.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new S,this.strm.avail_out=0;var z=d.deflateInit2(this.strm,k.level,k.method,k.windowBits,k.memLevel,k.strategy);if(z!==R)throw new Error(a[z]);if(k.header&&d.deflateSetHeader(this.strm,k.header),k.dictionary){var Z;if(Z=typeof k.dictionary=="string"?w.string2buf(k.dictionary):D.call(k.dictionary)==="[object ArrayBuffer]"?new Uint8Array(k.dictionary):k.dictionary,(z=d.deflateSetDictionary(this.strm,Z))!==R)throw new Error(a[z]);this._dict_set=!0}}function W(B,k){var z=new j(k);if(z.push(B,!0),z.err)throw z.msg||a[z.err];return z.result}j.prototype.push=function(B,k){var z,Z,ee=this.strm,se=this.options.chunkSize;if(this.ended)return!1;Z=k===~~k?k:k===!0?4:0,typeof B=="string"?ee.input=w.string2buf(B):D.call(B)==="[object ArrayBuffer]"?ee.input=new Uint8Array(B):ee.input=B,ee.next_in=0,ee.avail_in=ee.input.length;do{if(ee.avail_out===0&&(ee.output=new _.Buf8(se),ee.next_out=0,ee.avail_out=se),(z=d.deflate(ee,Z))!==1&&z!==R)return this.onEnd(z),!(this.ended=!0);ee.avail_out!==0&&(ee.avail_in!==0||Z!==4&&Z!==2)||(this.options.to==="string"?this.onData(w.buf2binstring(_.shrinkBuf(ee.output,ee.next_out))):this.onData(_.shrinkBuf(ee.output,ee.next_out)))}while((0<ee.avail_in||ee.avail_out===0)&&z!==1);return Z===4?(z=d.deflateEnd(this.strm),this.onEnd(z),this.ended=!0,z===R):Z!==2||(this.onEnd(R),!(ee.avail_out=0))},j.prototype.onData=function(B){this.chunks.push(B)},j.prototype.onEnd=function(B){B===R&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=_.flattenChunks(this.chunks)),this.chunks=[],this.err=B,this.msg=this.strm.msg},c.Deflate=j,c.deflate=W,c.deflateRaw=function(B,k){return(k=k||{}).raw=!0,W(B,k)},c.gzip=function(B,k){return(k=k||{}).gzip=!0,W(B,k)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,l,c){var d=n("./zlib/inflate"),_=n("./utils/common"),w=n("./utils/strings"),a=n("./zlib/constants"),S=n("./zlib/messages"),D=n("./zlib/zstream"),R=n("./zlib/gzheader"),I=Object.prototype.toString;function M(j){if(!(this instanceof M))return new M(j);this.options=_.assign({chunkSize:16384,windowBits:0,to:""},j||{});var W=this.options;W.raw&&0<=W.windowBits&&W.windowBits<16&&(W.windowBits=-W.windowBits,W.windowBits===0&&(W.windowBits=-15)),!(0<=W.windowBits&&W.windowBits<16)||j&&j.windowBits||(W.windowBits+=32),15<W.windowBits&&W.windowBits<48&&!(15&W.windowBits)&&(W.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new D,this.strm.avail_out=0;var B=d.inflateInit2(this.strm,W.windowBits);if(B!==a.Z_OK)throw new Error(S[B]);this.header=new R,d.inflateGetHeader(this.strm,this.header)}function N(j,W){var B=new M(W);if(B.push(j,!0),B.err)throw B.msg||S[B.err];return B.result}M.prototype.push=function(j,W){var B,k,z,Z,ee,se,ue=this.strm,Te=this.options.chunkSize,Q=this.options.dictionary,he=!1;if(this.ended)return!1;k=W===~~W?W:W===!0?a.Z_FINISH:a.Z_NO_FLUSH,typeof j=="string"?ue.input=w.binstring2buf(j):I.call(j)==="[object ArrayBuffer]"?ue.input=new Uint8Array(j):ue.input=j,ue.next_in=0,ue.avail_in=ue.input.length;do{if(ue.avail_out===0&&(ue.output=new _.Buf8(Te),ue.next_out=0,ue.avail_out=Te),(B=d.inflate(ue,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&Q&&(se=typeof Q=="string"?w.string2buf(Q):I.call(Q)==="[object ArrayBuffer]"?new Uint8Array(Q):Q,B=d.inflateSetDictionary(this.strm,se)),B===a.Z_BUF_ERROR&&he===!0&&(B=a.Z_OK,he=!1),B!==a.Z_STREAM_END&&B!==a.Z_OK)return this.onEnd(B),!(this.ended=!0);ue.next_out&&(ue.avail_out!==0&&B!==a.Z_STREAM_END&&(ue.avail_in!==0||k!==a.Z_FINISH&&k!==a.Z_SYNC_FLUSH)||(this.options.to==="string"?(z=w.utf8border(ue.output,ue.next_out),Z=ue.next_out-z,ee=w.buf2string(ue.output,z),ue.next_out=Z,ue.avail_out=Te-Z,Z&&_.arraySet(ue.output,ue.output,z,Z,0),this.onData(ee)):this.onData(_.shrinkBuf(ue.output,ue.next_out)))),ue.avail_in===0&&ue.avail_out===0&&(he=!0)}while((0<ue.avail_in||ue.avail_out===0)&&B!==a.Z_STREAM_END);return B===a.Z_STREAM_END&&(k=a.Z_FINISH),k===a.Z_FINISH?(B=d.inflateEnd(this.strm),this.onEnd(B),this.ended=!0,B===a.Z_OK):k!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(ue.avail_out=0))},M.prototype.onData=function(j){this.chunks.push(j)},M.prototype.onEnd=function(j){j===a.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=_.flattenChunks(this.chunks)),this.chunks=[],this.err=j,this.msg=this.strm.msg},c.Inflate=M,c.inflate=N,c.inflateRaw=function(j,W){return(W=W||{}).raw=!0,N(j,W)},c.ungzip=N},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,l,c){var d=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";c.assign=function(a){for(var S=Array.prototype.slice.call(arguments,1);S.length;){var D=S.shift();if(D){if(typeof D!="object")throw new TypeError(D+"must be non-object");for(var R in D)D.hasOwnProperty(R)&&(a[R]=D[R])}}return a},c.shrinkBuf=function(a,S){return a.length===S?a:a.subarray?a.subarray(0,S):(a.length=S,a)};var _={arraySet:function(a,S,D,R,I){if(S.subarray&&a.subarray)a.set(S.subarray(D,D+R),I);else for(var M=0;M<R;M++)a[I+M]=S[D+M]},flattenChunks:function(a){var S,D,R,I,M,N;for(S=R=0,D=a.length;S<D;S++)R+=a[S].length;for(N=new Uint8Array(R),S=I=0,D=a.length;S<D;S++)M=a[S],N.set(M,I),I+=M.length;return N}},w={arraySet:function(a,S,D,R,I){for(var M=0;M<R;M++)a[I+M]=S[D+M]},flattenChunks:function(a){return[].concat.apply([],a)}};c.setTyped=function(a){a?(c.Buf8=Uint8Array,c.Buf16=Uint16Array,c.Buf32=Int32Array,c.assign(c,_)):(c.Buf8=Array,c.Buf16=Array,c.Buf32=Array,c.assign(c,w))},c.setTyped(d)},{}],42:[function(n,l,c){var d=n("./common"),_=!0,w=!0;try{String.fromCharCode.apply(null,[0])}catch{_=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{w=!1}for(var a=new d.Buf8(256),S=0;S<256;S++)a[S]=252<=S?6:248<=S?5:240<=S?4:224<=S?3:192<=S?2:1;function D(R,I){if(I<65537&&(R.subarray&&w||!R.subarray&&_))return String.fromCharCode.apply(null,d.shrinkBuf(R,I));for(var M="",N=0;N<I;N++)M+=String.fromCharCode(R[N]);return M}a[254]=a[254]=1,c.string2buf=function(R){var I,M,N,j,W,B=R.length,k=0;for(j=0;j<B;j++)(64512&(M=R.charCodeAt(j)))==55296&&j+1<B&&(64512&(N=R.charCodeAt(j+1)))==56320&&(M=65536+(M-55296<<10)+(N-56320),j++),k+=M<128?1:M<2048?2:M<65536?3:4;for(I=new d.Buf8(k),j=W=0;W<k;j++)(64512&(M=R.charCodeAt(j)))==55296&&j+1<B&&(64512&(N=R.charCodeAt(j+1)))==56320&&(M=65536+(M-55296<<10)+(N-56320),j++),M<128?I[W++]=M:(M<2048?I[W++]=192|M>>>6:(M<65536?I[W++]=224|M>>>12:(I[W++]=240|M>>>18,I[W++]=128|M>>>12&63),I[W++]=128|M>>>6&63),I[W++]=128|63&M);return I},c.buf2binstring=function(R){return D(R,R.length)},c.binstring2buf=function(R){for(var I=new d.Buf8(R.length),M=0,N=I.length;M<N;M++)I[M]=R.charCodeAt(M);return I},c.buf2string=function(R,I){var M,N,j,W,B=I||R.length,k=new Array(2*B);for(M=N=0;M<B;)if((j=R[M++])<128)k[N++]=j;else if(4<(W=a[j]))k[N++]=65533,M+=W-1;else{for(j&=W===2?31:W===3?15:7;1<W&&M<B;)j=j<<6|63&R[M++],W--;1<W?k[N++]=65533:j<65536?k[N++]=j:(j-=65536,k[N++]=55296|j>>10&1023,k[N++]=56320|1023&j)}return D(k,N)},c.utf8border=function(R,I){var M;for((I=I||R.length)>R.length&&(I=R.length),M=I-1;0<=M&&(192&R[M])==128;)M--;return M<0||M===0?I:M+a[R[M]]>I?M:I}},{"./common":41}],43:[function(n,l,c){l.exports=function(d,_,w,a){for(var S=65535&d|0,D=d>>>16&65535|0,R=0;w!==0;){for(w-=R=2e3<w?2e3:w;D=D+(S=S+_[a++]|0)|0,--R;);S%=65521,D%=65521}return S|D<<16|0}},{}],44:[function(n,l,c){l.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,l,c){var d=function(){for(var _,w=[],a=0;a<256;a++){_=a;for(var S=0;S<8;S++)_=1&_?3988292384^_>>>1:_>>>1;w[a]=_}return w}();l.exports=function(_,w,a,S){var D=d,R=S+a;_^=-1;for(var I=S;I<R;I++)_=_>>>8^D[255&(_^w[I])];return-1^_}},{}],46:[function(n,l,c){var d,_=n("../utils/common"),w=n("./trees"),a=n("./adler32"),S=n("./crc32"),D=n("./messages"),R=0,I=4,M=0,N=-2,j=-1,W=4,B=2,k=8,z=9,Z=286,ee=30,se=19,ue=2*Z+1,Te=15,Q=3,he=258,ye=he+Q+1,J=42,ie=113,q=1,Ke=2,Mt=3,ct=4;function He(Y,mt){return Y.msg=D[mt],mt}function _e(Y){return(Y<<1)-(4<Y?9:0)}function qe(Y){for(var mt=Y.length;0<=--mt;)Y[mt]=0}function Pe(Y){var mt=Y.state,et=mt.pending;et>Y.avail_out&&(et=Y.avail_out),et!==0&&(_.arraySet(Y.output,mt.pending_buf,mt.pending_out,et,Y.next_out),Y.next_out+=et,mt.pending_out+=et,Y.total_out+=et,Y.avail_out-=et,mt.pending-=et,mt.pending===0&&(mt.pending_out=0))}function Le(Y,mt){w._tr_flush_block(Y,0<=Y.block_start?Y.block_start:-1,Y.strstart-Y.block_start,mt),Y.block_start=Y.strstart,Pe(Y.strm)}function Pt(Y,mt){Y.pending_buf[Y.pending++]=mt}function lt(Y,mt){Y.pending_buf[Y.pending++]=mt>>>8&255,Y.pending_buf[Y.pending++]=255&mt}function at(Y,mt){var et,Ce,we=Y.max_chain_length,$e=Y.strstart,gt=Y.prev_length,St=Y.nice_match,tt=Y.strstart>Y.w_size-ye?Y.strstart-(Y.w_size-ye):0,Lt=Y.window,$t=Y.w_mask,Ot=Y.prev,Qt=Y.strstart+he,Mr=Lt[$e+gt-1],sr=Lt[$e+gt];Y.prev_length>=Y.good_match&&(we>>=2),St>Y.lookahead&&(St=Y.lookahead);do if(Lt[(et=mt)+gt]===sr&&Lt[et+gt-1]===Mr&&Lt[et]===Lt[$e]&&Lt[++et]===Lt[$e+1]){$e+=2,et++;do;while(Lt[++$e]===Lt[++et]&&Lt[++$e]===Lt[++et]&&Lt[++$e]===Lt[++et]&&Lt[++$e]===Lt[++et]&&Lt[++$e]===Lt[++et]&&Lt[++$e]===Lt[++et]&&Lt[++$e]===Lt[++et]&&Lt[++$e]===Lt[++et]&&$e<Qt);if(Ce=he-(Qt-$e),$e=Qt-he,gt<Ce){if(Y.match_start=mt,St<=(gt=Ce))break;Mr=Lt[$e+gt-1],sr=Lt[$e+gt]}}while((mt=Ot[mt&$t])>tt&&--we!=0);return gt<=Y.lookahead?gt:Y.lookahead}function Jt(Y){var mt,et,Ce,we,$e,gt,St,tt,Lt,$t,Ot=Y.w_size;do{if(we=Y.window_size-Y.lookahead-Y.strstart,Y.strstart>=Ot+(Ot-ye)){for(_.arraySet(Y.window,Y.window,Ot,Ot,0),Y.match_start-=Ot,Y.strstart-=Ot,Y.block_start-=Ot,mt=et=Y.hash_size;Ce=Y.head[--mt],Y.head[mt]=Ot<=Ce?Ce-Ot:0,--et;);for(mt=et=Ot;Ce=Y.prev[--mt],Y.prev[mt]=Ot<=Ce?Ce-Ot:0,--et;);we+=Ot}if(Y.strm.avail_in===0)break;if(gt=Y.strm,St=Y.window,tt=Y.strstart+Y.lookahead,Lt=we,$t=void 0,$t=gt.avail_in,Lt<$t&&($t=Lt),et=$t===0?0:(gt.avail_in-=$t,_.arraySet(St,gt.input,gt.next_in,$t,tt),gt.state.wrap===1?gt.adler=a(gt.adler,St,$t,tt):gt.state.wrap===2&&(gt.adler=S(gt.adler,St,$t,tt)),gt.next_in+=$t,gt.total_in+=$t,$t),Y.lookahead+=et,Y.lookahead+Y.insert>=Q)for($e=Y.strstart-Y.insert,Y.ins_h=Y.window[$e],Y.ins_h=(Y.ins_h<<Y.hash_shift^Y.window[$e+1])&Y.hash_mask;Y.insert&&(Y.ins_h=(Y.ins_h<<Y.hash_shift^Y.window[$e+Q-1])&Y.hash_mask,Y.prev[$e&Y.w_mask]=Y.head[Y.ins_h],Y.head[Y.ins_h]=$e,$e++,Y.insert--,!(Y.lookahead+Y.insert<Q)););}while(Y.lookahead<ye&&Y.strm.avail_in!==0)}function Er(Y,mt){for(var et,Ce;;){if(Y.lookahead<ye){if(Jt(Y),Y.lookahead<ye&&mt===R)return q;if(Y.lookahead===0)break}if(et=0,Y.lookahead>=Q&&(Y.ins_h=(Y.ins_h<<Y.hash_shift^Y.window[Y.strstart+Q-1])&Y.hash_mask,et=Y.prev[Y.strstart&Y.w_mask]=Y.head[Y.ins_h],Y.head[Y.ins_h]=Y.strstart),et!==0&&Y.strstart-et<=Y.w_size-ye&&(Y.match_length=at(Y,et)),Y.match_length>=Q)if(Ce=w._tr_tally(Y,Y.strstart-Y.match_start,Y.match_length-Q),Y.lookahead-=Y.match_length,Y.match_length<=Y.max_lazy_match&&Y.lookahead>=Q){for(Y.match_length--;Y.strstart++,Y.ins_h=(Y.ins_h<<Y.hash_shift^Y.window[Y.strstart+Q-1])&Y.hash_mask,et=Y.prev[Y.strstart&Y.w_mask]=Y.head[Y.ins_h],Y.head[Y.ins_h]=Y.strstart,--Y.match_length!=0;);Y.strstart++}else Y.strstart+=Y.match_length,Y.match_length=0,Y.ins_h=Y.window[Y.strstart],Y.ins_h=(Y.ins_h<<Y.hash_shift^Y.window[Y.strstart+1])&Y.hash_mask;else Ce=w._tr_tally(Y,0,Y.window[Y.strstart]),Y.lookahead--,Y.strstart++;if(Ce&&(Le(Y,!1),Y.strm.avail_out===0))return q}return Y.insert=Y.strstart<Q-1?Y.strstart:Q-1,mt===I?(Le(Y,!0),Y.strm.avail_out===0?Mt:ct):Y.last_lit&&(Le(Y,!1),Y.strm.avail_out===0)?q:Ke}function Kt(Y,mt){for(var et,Ce,we;;){if(Y.lookahead<ye){if(Jt(Y),Y.lookahead<ye&&mt===R)return q;if(Y.lookahead===0)break}if(et=0,Y.lookahead>=Q&&(Y.ins_h=(Y.ins_h<<Y.hash_shift^Y.window[Y.strstart+Q-1])&Y.hash_mask,et=Y.prev[Y.strstart&Y.w_mask]=Y.head[Y.ins_h],Y.head[Y.ins_h]=Y.strstart),Y.prev_length=Y.match_length,Y.prev_match=Y.match_start,Y.match_length=Q-1,et!==0&&Y.prev_length<Y.max_lazy_match&&Y.strstart-et<=Y.w_size-ye&&(Y.match_length=at(Y,et),Y.match_length<=5&&(Y.strategy===1||Y.match_length===Q&&4096<Y.strstart-Y.match_start)&&(Y.match_length=Q-1)),Y.prev_length>=Q&&Y.match_length<=Y.prev_length){for(we=Y.strstart+Y.lookahead-Q,Ce=w._tr_tally(Y,Y.strstart-1-Y.prev_match,Y.prev_length-Q),Y.lookahead-=Y.prev_length-1,Y.prev_length-=2;++Y.strstart<=we&&(Y.ins_h=(Y.ins_h<<Y.hash_shift^Y.window[Y.strstart+Q-1])&Y.hash_mask,et=Y.prev[Y.strstart&Y.w_mask]=Y.head[Y.ins_h],Y.head[Y.ins_h]=Y.strstart),--Y.prev_length!=0;);if(Y.match_available=0,Y.match_length=Q-1,Y.strstart++,Ce&&(Le(Y,!1),Y.strm.avail_out===0))return q}else if(Y.match_available){if((Ce=w._tr_tally(Y,0,Y.window[Y.strstart-1]))&&Le(Y,!1),Y.strstart++,Y.lookahead--,Y.strm.avail_out===0)return q}else Y.match_available=1,Y.strstart++,Y.lookahead--}return Y.match_available&&(Ce=w._tr_tally(Y,0,Y.window[Y.strstart-1]),Y.match_available=0),Y.insert=Y.strstart<Q-1?Y.strstart:Q-1,mt===I?(Le(Y,!0),Y.strm.avail_out===0?Mt:ct):Y.last_lit&&(Le(Y,!1),Y.strm.avail_out===0)?q:Ke}function xr(Y,mt,et,Ce,we){this.good_length=Y,this.max_lazy=mt,this.nice_length=et,this.max_chain=Ce,this.func=we}function Ir(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=k,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new _.Buf16(2*ue),this.dyn_dtree=new _.Buf16(2*(2*ee+1)),this.bl_tree=new _.Buf16(2*(2*se+1)),qe(this.dyn_ltree),qe(this.dyn_dtree),qe(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new _.Buf16(Te+1),this.heap=new _.Buf16(2*Z+1),qe(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new _.Buf16(2*Z+1),qe(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function jr(Y){var mt;return Y&&Y.state?(Y.total_in=Y.total_out=0,Y.data_type=B,(mt=Y.state).pending=0,mt.pending_out=0,mt.wrap<0&&(mt.wrap=-mt.wrap),mt.status=mt.wrap?J:ie,Y.adler=mt.wrap===2?0:1,mt.last_flush=R,w._tr_init(mt),M):He(Y,N)}function tr(Y){var mt=jr(Y);return mt===M&&function(et){et.window_size=2*et.w_size,qe(et.head),et.max_lazy_match=d[et.level].max_lazy,et.good_match=d[et.level].good_length,et.nice_match=d[et.level].nice_length,et.max_chain_length=d[et.level].max_chain,et.strstart=0,et.block_start=0,et.lookahead=0,et.insert=0,et.match_length=et.prev_length=Q-1,et.match_available=0,et.ins_h=0}(Y.state),mt}function jn(Y,mt,et,Ce,we,$e){if(!Y)return N;var gt=1;if(mt===j&&(mt=6),Ce<0?(gt=0,Ce=-Ce):15<Ce&&(gt=2,Ce-=16),we<1||z<we||et!==k||Ce<8||15<Ce||mt<0||9<mt||$e<0||W<$e)return He(Y,N);Ce===8&&(Ce=9);var St=new Ir;return(Y.state=St).strm=Y,St.wrap=gt,St.gzhead=null,St.w_bits=Ce,St.w_size=1<<St.w_bits,St.w_mask=St.w_size-1,St.hash_bits=we+7,St.hash_size=1<<St.hash_bits,St.hash_mask=St.hash_size-1,St.hash_shift=~~((St.hash_bits+Q-1)/Q),St.window=new _.Buf8(2*St.w_size),St.head=new _.Buf16(St.hash_size),St.prev=new _.Buf16(St.w_size),St.lit_bufsize=1<<we+6,St.pending_buf_size=4*St.lit_bufsize,St.pending_buf=new _.Buf8(St.pending_buf_size),St.d_buf=1*St.lit_bufsize,St.l_buf=3*St.lit_bufsize,St.level=mt,St.strategy=$e,St.method=et,tr(Y)}d=[new xr(0,0,0,0,function(Y,mt){var et=65535;for(et>Y.pending_buf_size-5&&(et=Y.pending_buf_size-5);;){if(Y.lookahead<=1){if(Jt(Y),Y.lookahead===0&&mt===R)return q;if(Y.lookahead===0)break}Y.strstart+=Y.lookahead,Y.lookahead=0;var Ce=Y.block_start+et;if((Y.strstart===0||Y.strstart>=Ce)&&(Y.lookahead=Y.strstart-Ce,Y.strstart=Ce,Le(Y,!1),Y.strm.avail_out===0)||Y.strstart-Y.block_start>=Y.w_size-ye&&(Le(Y,!1),Y.strm.avail_out===0))return q}return Y.insert=0,mt===I?(Le(Y,!0),Y.strm.avail_out===0?Mt:ct):(Y.strstart>Y.block_start&&(Le(Y,!1),Y.strm.avail_out),q)}),new xr(4,4,8,4,Er),new xr(4,5,16,8,Er),new xr(4,6,32,32,Er),new xr(4,4,16,16,Kt),new xr(8,16,32,32,Kt),new xr(8,16,128,128,Kt),new xr(8,32,128,256,Kt),new xr(32,128,258,1024,Kt),new xr(32,258,258,4096,Kt)],c.deflateInit=function(Y,mt){return jn(Y,mt,k,15,8,0)},c.deflateInit2=jn,c.deflateReset=tr,c.deflateResetKeep=jr,c.deflateSetHeader=function(Y,mt){return Y&&Y.state?Y.state.wrap!==2?N:(Y.state.gzhead=mt,M):N},c.deflate=function(Y,mt){var et,Ce,we,$e;if(!Y||!Y.state||5<mt||mt<0)return Y?He(Y,N):N;if(Ce=Y.state,!Y.output||!Y.input&&Y.avail_in!==0||Ce.status===666&&mt!==I)return He(Y,Y.avail_out===0?-5:N);if(Ce.strm=Y,et=Ce.last_flush,Ce.last_flush=mt,Ce.status===J)if(Ce.wrap===2)Y.adler=0,Pt(Ce,31),Pt(Ce,139),Pt(Ce,8),Ce.gzhead?(Pt(Ce,(Ce.gzhead.text?1:0)+(Ce.gzhead.hcrc?2:0)+(Ce.gzhead.extra?4:0)+(Ce.gzhead.name?8:0)+(Ce.gzhead.comment?16:0)),Pt(Ce,255&Ce.gzhead.time),Pt(Ce,Ce.gzhead.time>>8&255),Pt(Ce,Ce.gzhead.time>>16&255),Pt(Ce,Ce.gzhead.time>>24&255),Pt(Ce,Ce.level===9?2:2<=Ce.strategy||Ce.level<2?4:0),Pt(Ce,255&Ce.gzhead.os),Ce.gzhead.extra&&Ce.gzhead.extra.length&&(Pt(Ce,255&Ce.gzhead.extra.length),Pt(Ce,Ce.gzhead.extra.length>>8&255)),Ce.gzhead.hcrc&&(Y.adler=S(Y.adler,Ce.pending_buf,Ce.pending,0)),Ce.gzindex=0,Ce.status=69):(Pt(Ce,0),Pt(Ce,0),Pt(Ce,0),Pt(Ce,0),Pt(Ce,0),Pt(Ce,Ce.level===9?2:2<=Ce.strategy||Ce.level<2?4:0),Pt(Ce,3),Ce.status=ie);else{var gt=k+(Ce.w_bits-8<<4)<<8;gt|=(2<=Ce.strategy||Ce.level<2?0:Ce.level<6?1:Ce.level===6?2:3)<<6,Ce.strstart!==0&&(gt|=32),gt+=31-gt%31,Ce.status=ie,lt(Ce,gt),Ce.strstart!==0&&(lt(Ce,Y.adler>>>16),lt(Ce,65535&Y.adler)),Y.adler=1}if(Ce.status===69)if(Ce.gzhead.extra){for(we=Ce.pending;Ce.gzindex<(65535&Ce.gzhead.extra.length)&&(Ce.pending!==Ce.pending_buf_size||(Ce.gzhead.hcrc&&Ce.pending>we&&(Y.adler=S(Y.adler,Ce.pending_buf,Ce.pending-we,we)),Pe(Y),we=Ce.pending,Ce.pending!==Ce.pending_buf_size));)Pt(Ce,255&Ce.gzhead.extra[Ce.gzindex]),Ce.gzindex++;Ce.gzhead.hcrc&&Ce.pending>we&&(Y.adler=S(Y.adler,Ce.pending_buf,Ce.pending-we,we)),Ce.gzindex===Ce.gzhead.extra.length&&(Ce.gzindex=0,Ce.status=73)}else Ce.status=73;if(Ce.status===73)if(Ce.gzhead.name){we=Ce.pending;do{if(Ce.pending===Ce.pending_buf_size&&(Ce.gzhead.hcrc&&Ce.pending>we&&(Y.adler=S(Y.adler,Ce.pending_buf,Ce.pending-we,we)),Pe(Y),we=Ce.pending,Ce.pending===Ce.pending_buf_size)){$e=1;break}$e=Ce.gzindex<Ce.gzhead.name.length?255&Ce.gzhead.name.charCodeAt(Ce.gzindex++):0,Pt(Ce,$e)}while($e!==0);Ce.gzhead.hcrc&&Ce.pending>we&&(Y.adler=S(Y.adler,Ce.pending_buf,Ce.pending-we,we)),$e===0&&(Ce.gzindex=0,Ce.status=91)}else Ce.status=91;if(Ce.status===91)if(Ce.gzhead.comment){we=Ce.pending;do{if(Ce.pending===Ce.pending_buf_size&&(Ce.gzhead.hcrc&&Ce.pending>we&&(Y.adler=S(Y.adler,Ce.pending_buf,Ce.pending-we,we)),Pe(Y),we=Ce.pending,Ce.pending===Ce.pending_buf_size)){$e=1;break}$e=Ce.gzindex<Ce.gzhead.comment.length?255&Ce.gzhead.comment.charCodeAt(Ce.gzindex++):0,Pt(Ce,$e)}while($e!==0);Ce.gzhead.hcrc&&Ce.pending>we&&(Y.adler=S(Y.adler,Ce.pending_buf,Ce.pending-we,we)),$e===0&&(Ce.status=103)}else Ce.status=103;if(Ce.status===103&&(Ce.gzhead.hcrc?(Ce.pending+2>Ce.pending_buf_size&&Pe(Y),Ce.pending+2<=Ce.pending_buf_size&&(Pt(Ce,255&Y.adler),Pt(Ce,Y.adler>>8&255),Y.adler=0,Ce.status=ie)):Ce.status=ie),Ce.pending!==0){if(Pe(Y),Y.avail_out===0)return Ce.last_flush=-1,M}else if(Y.avail_in===0&&_e(mt)<=_e(et)&&mt!==I)return He(Y,-5);if(Ce.status===666&&Y.avail_in!==0)return He(Y,-5);if(Y.avail_in!==0||Ce.lookahead!==0||mt!==R&&Ce.status!==666){var St=Ce.strategy===2?function(tt,Lt){for(var $t;;){if(tt.lookahead===0&&(Jt(tt),tt.lookahead===0)){if(Lt===R)return q;break}if(tt.match_length=0,$t=w._tr_tally(tt,0,tt.window[tt.strstart]),tt.lookahead--,tt.strstart++,$t&&(Le(tt,!1),tt.strm.avail_out===0))return q}return tt.insert=0,Lt===I?(Le(tt,!0),tt.strm.avail_out===0?Mt:ct):tt.last_lit&&(Le(tt,!1),tt.strm.avail_out===0)?q:Ke}(Ce,mt):Ce.strategy===3?function(tt,Lt){for(var $t,Ot,Qt,Mr,sr=tt.window;;){if(tt.lookahead<=he){if(Jt(tt),tt.lookahead<=he&&Lt===R)return q;if(tt.lookahead===0)break}if(tt.match_length=0,tt.lookahead>=Q&&0<tt.strstart&&(Ot=sr[Qt=tt.strstart-1])===sr[++Qt]&&Ot===sr[++Qt]&&Ot===sr[++Qt]){Mr=tt.strstart+he;do;while(Ot===sr[++Qt]&&Ot===sr[++Qt]&&Ot===sr[++Qt]&&Ot===sr[++Qt]&&Ot===sr[++Qt]&&Ot===sr[++Qt]&&Ot===sr[++Qt]&&Ot===sr[++Qt]&&Qt<Mr);tt.match_length=he-(Mr-Qt),tt.match_length>tt.lookahead&&(tt.match_length=tt.lookahead)}if(tt.match_length>=Q?($t=w._tr_tally(tt,1,tt.match_length-Q),tt.lookahead-=tt.match_length,tt.strstart+=tt.match_length,tt.match_length=0):($t=w._tr_tally(tt,0,tt.window[tt.strstart]),tt.lookahead--,tt.strstart++),$t&&(Le(tt,!1),tt.strm.avail_out===0))return q}return tt.insert=0,Lt===I?(Le(tt,!0),tt.strm.avail_out===0?Mt:ct):tt.last_lit&&(Le(tt,!1),tt.strm.avail_out===0)?q:Ke}(Ce,mt):d[Ce.level].func(Ce,mt);if(St!==Mt&&St!==ct||(Ce.status=666),St===q||St===Mt)return Y.avail_out===0&&(Ce.last_flush=-1),M;if(St===Ke&&(mt===1?w._tr_align(Ce):mt!==5&&(w._tr_stored_block(Ce,0,0,!1),mt===3&&(qe(Ce.head),Ce.lookahead===0&&(Ce.strstart=0,Ce.block_start=0,Ce.insert=0))),Pe(Y),Y.avail_out===0))return Ce.last_flush=-1,M}return mt!==I?M:Ce.wrap<=0?1:(Ce.wrap===2?(Pt(Ce,255&Y.adler),Pt(Ce,Y.adler>>8&255),Pt(Ce,Y.adler>>16&255),Pt(Ce,Y.adler>>24&255),Pt(Ce,255&Y.total_in),Pt(Ce,Y.total_in>>8&255),Pt(Ce,Y.total_in>>16&255),Pt(Ce,Y.total_in>>24&255)):(lt(Ce,Y.adler>>>16),lt(Ce,65535&Y.adler)),Pe(Y),0<Ce.wrap&&(Ce.wrap=-Ce.wrap),Ce.pending!==0?M:1)},c.deflateEnd=function(Y){var mt;return Y&&Y.state?(mt=Y.state.status)!==J&&mt!==69&&mt!==73&&mt!==91&&mt!==103&&mt!==ie&&mt!==666?He(Y,N):(Y.state=null,mt===ie?He(Y,-3):M):N},c.deflateSetDictionary=function(Y,mt){var et,Ce,we,$e,gt,St,tt,Lt,$t=mt.length;if(!Y||!Y.state||($e=(et=Y.state).wrap)===2||$e===1&&et.status!==J||et.lookahead)return N;for($e===1&&(Y.adler=a(Y.adler,mt,$t,0)),et.wrap=0,$t>=et.w_size&&($e===0&&(qe(et.head),et.strstart=0,et.block_start=0,et.insert=0),Lt=new _.Buf8(et.w_size),_.arraySet(Lt,mt,$t-et.w_size,et.w_size,0),mt=Lt,$t=et.w_size),gt=Y.avail_in,St=Y.next_in,tt=Y.input,Y.avail_in=$t,Y.next_in=0,Y.input=mt,Jt(et);et.lookahead>=Q;){for(Ce=et.strstart,we=et.lookahead-(Q-1);et.ins_h=(et.ins_h<<et.hash_shift^et.window[Ce+Q-1])&et.hash_mask,et.prev[Ce&et.w_mask]=et.head[et.ins_h],et.head[et.ins_h]=Ce,Ce++,--we;);et.strstart=Ce,et.lookahead=Q-1,Jt(et)}return et.strstart+=et.lookahead,et.block_start=et.strstart,et.insert=et.lookahead,et.lookahead=0,et.match_length=et.prev_length=Q-1,et.match_available=0,Y.next_in=St,Y.input=tt,Y.avail_in=gt,et.wrap=$e,M},c.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,l,c){l.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,l,c){l.exports=function(d,_){var w,a,S,D,R,I,M,N,j,W,B,k,z,Z,ee,se,ue,Te,Q,he,ye,J,ie,q,Ke;w=d.state,a=d.next_in,q=d.input,S=a+(d.avail_in-5),D=d.next_out,Ke=d.output,R=D-(_-d.avail_out),I=D+(d.avail_out-257),M=w.dmax,N=w.wsize,j=w.whave,W=w.wnext,B=w.window,k=w.hold,z=w.bits,Z=w.lencode,ee=w.distcode,se=(1<<w.lenbits)-1,ue=(1<<w.distbits)-1;e:do{z<15&&(k+=q[a++]<<z,z+=8,k+=q[a++]<<z,z+=8),Te=Z[k&se];t:for(;;){if(k>>>=Q=Te>>>24,z-=Q,(Q=Te>>>16&255)===0)Ke[D++]=65535&Te;else{if(!(16&Q)){if(!(64&Q)){Te=Z[(65535&Te)+(k&(1<<Q)-1)];continue t}if(32&Q){w.mode=12;break e}d.msg="invalid literal/length code",w.mode=30;break e}he=65535&Te,(Q&=15)&&(z<Q&&(k+=q[a++]<<z,z+=8),he+=k&(1<<Q)-1,k>>>=Q,z-=Q),z<15&&(k+=q[a++]<<z,z+=8,k+=q[a++]<<z,z+=8),Te=ee[k&ue];r:for(;;){if(k>>>=Q=Te>>>24,z-=Q,!(16&(Q=Te>>>16&255))){if(!(64&Q)){Te=ee[(65535&Te)+(k&(1<<Q)-1)];continue r}d.msg="invalid distance code",w.mode=30;break e}if(ye=65535&Te,z<(Q&=15)&&(k+=q[a++]<<z,(z+=8)<Q&&(k+=q[a++]<<z,z+=8)),M<(ye+=k&(1<<Q)-1)){d.msg="invalid distance too far back",w.mode=30;break e}if(k>>>=Q,z-=Q,(Q=D-R)<ye){if(j<(Q=ye-Q)&&w.sane){d.msg="invalid distance too far back",w.mode=30;break e}if(ie=B,(J=0)===W){if(J+=N-Q,Q<he){for(he-=Q;Ke[D++]=B[J++],--Q;);J=D-ye,ie=Ke}}else if(W<Q){if(J+=N+W-Q,(Q-=W)<he){for(he-=Q;Ke[D++]=B[J++],--Q;);if(J=0,W<he){for(he-=Q=W;Ke[D++]=B[J++],--Q;);J=D-ye,ie=Ke}}}else if(J+=W-Q,Q<he){for(he-=Q;Ke[D++]=B[J++],--Q;);J=D-ye,ie=Ke}for(;2<he;)Ke[D++]=ie[J++],Ke[D++]=ie[J++],Ke[D++]=ie[J++],he-=3;he&&(Ke[D++]=ie[J++],1<he&&(Ke[D++]=ie[J++]))}else{for(J=D-ye;Ke[D++]=Ke[J++],Ke[D++]=Ke[J++],Ke[D++]=Ke[J++],2<(he-=3););he&&(Ke[D++]=Ke[J++],1<he&&(Ke[D++]=Ke[J++]))}break}}break}}while(a<S&&D<I);a-=he=z>>3,k&=(1<<(z-=he<<3))-1,d.next_in=a,d.next_out=D,d.avail_in=a<S?S-a+5:5-(a-S),d.avail_out=D<I?I-D+257:257-(D-I),w.hold=k,w.bits=z}},{}],49:[function(n,l,c){var d=n("../utils/common"),_=n("./adler32"),w=n("./crc32"),a=n("./inffast"),S=n("./inftrees"),D=1,R=2,I=0,M=-2,N=1,j=852,W=592;function B(J){return(J>>>24&255)+(J>>>8&65280)+((65280&J)<<8)+((255&J)<<24)}function k(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new d.Buf16(320),this.work=new d.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function z(J){var ie;return J&&J.state?(ie=J.state,J.total_in=J.total_out=ie.total=0,J.msg="",ie.wrap&&(J.adler=1&ie.wrap),ie.mode=N,ie.last=0,ie.havedict=0,ie.dmax=32768,ie.head=null,ie.hold=0,ie.bits=0,ie.lencode=ie.lendyn=new d.Buf32(j),ie.distcode=ie.distdyn=new d.Buf32(W),ie.sane=1,ie.back=-1,I):M}function Z(J){var ie;return J&&J.state?((ie=J.state).wsize=0,ie.whave=0,ie.wnext=0,z(J)):M}function ee(J,ie){var q,Ke;return J&&J.state?(Ke=J.state,ie<0?(q=0,ie=-ie):(q=1+(ie>>4),ie<48&&(ie&=15)),ie&&(ie<8||15<ie)?M:(Ke.window!==null&&Ke.wbits!==ie&&(Ke.window=null),Ke.wrap=q,Ke.wbits=ie,Z(J))):M}function se(J,ie){var q,Ke;return J?(Ke=new k,(J.state=Ke).window=null,(q=ee(J,ie))!==I&&(J.state=null),q):M}var ue,Te,Q=!0;function he(J){if(Q){var ie;for(ue=new d.Buf32(512),Te=new d.Buf32(32),ie=0;ie<144;)J.lens[ie++]=8;for(;ie<256;)J.lens[ie++]=9;for(;ie<280;)J.lens[ie++]=7;for(;ie<288;)J.lens[ie++]=8;for(S(D,J.lens,0,288,ue,0,J.work,{bits:9}),ie=0;ie<32;)J.lens[ie++]=5;S(R,J.lens,0,32,Te,0,J.work,{bits:5}),Q=!1}J.lencode=ue,J.lenbits=9,J.distcode=Te,J.distbits=5}function ye(J,ie,q,Ke){var Mt,ct=J.state;return ct.window===null&&(ct.wsize=1<<ct.wbits,ct.wnext=0,ct.whave=0,ct.window=new d.Buf8(ct.wsize)),Ke>=ct.wsize?(d.arraySet(ct.window,ie,q-ct.wsize,ct.wsize,0),ct.wnext=0,ct.whave=ct.wsize):(Ke<(Mt=ct.wsize-ct.wnext)&&(Mt=Ke),d.arraySet(ct.window,ie,q-Ke,Mt,ct.wnext),(Ke-=Mt)?(d.arraySet(ct.window,ie,q-Ke,Ke,0),ct.wnext=Ke,ct.whave=ct.wsize):(ct.wnext+=Mt,ct.wnext===ct.wsize&&(ct.wnext=0),ct.whave<ct.wsize&&(ct.whave+=Mt))),0}c.inflateReset=Z,c.inflateReset2=ee,c.inflateResetKeep=z,c.inflateInit=function(J){return se(J,15)},c.inflateInit2=se,c.inflate=function(J,ie){var q,Ke,Mt,ct,He,_e,qe,Pe,Le,Pt,lt,at,Jt,Er,Kt,xr,Ir,jr,tr,jn,Y,mt,et,Ce,we=0,$e=new d.Buf8(4),gt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!J||!J.state||!J.output||!J.input&&J.avail_in!==0)return M;(q=J.state).mode===12&&(q.mode=13),He=J.next_out,Mt=J.output,qe=J.avail_out,ct=J.next_in,Ke=J.input,_e=J.avail_in,Pe=q.hold,Le=q.bits,Pt=_e,lt=qe,mt=I;e:for(;;)switch(q.mode){case N:if(q.wrap===0){q.mode=13;break}for(;Le<16;){if(_e===0)break e;_e--,Pe+=Ke[ct++]<<Le,Le+=8}if(2&q.wrap&&Pe===35615){$e[q.check=0]=255&Pe,$e[1]=Pe>>>8&255,q.check=w(q.check,$e,2,0),Le=Pe=0,q.mode=2;break}if(q.flags=0,q.head&&(q.head.done=!1),!(1&q.wrap)||(((255&Pe)<<8)+(Pe>>8))%31){J.msg="incorrect header check",q.mode=30;break}if((15&Pe)!=8){J.msg="unknown compression method",q.mode=30;break}if(Le-=4,Y=8+(15&(Pe>>>=4)),q.wbits===0)q.wbits=Y;else if(Y>q.wbits){J.msg="invalid window size",q.mode=30;break}q.dmax=1<<Y,J.adler=q.check=1,q.mode=512&Pe?10:12,Le=Pe=0;break;case 2:for(;Le<16;){if(_e===0)break e;_e--,Pe+=Ke[ct++]<<Le,Le+=8}if(q.flags=Pe,(255&q.flags)!=8){J.msg="unknown compression method",q.mode=30;break}if(57344&q.flags){J.msg="unknown header flags set",q.mode=30;break}q.head&&(q.head.text=Pe>>8&1),512&q.flags&&($e[0]=255&Pe,$e[1]=Pe>>>8&255,q.check=w(q.check,$e,2,0)),Le=Pe=0,q.mode=3;case 3:for(;Le<32;){if(_e===0)break e;_e--,Pe+=Ke[ct++]<<Le,Le+=8}q.head&&(q.head.time=Pe),512&q.flags&&($e[0]=255&Pe,$e[1]=Pe>>>8&255,$e[2]=Pe>>>16&255,$e[3]=Pe>>>24&255,q.check=w(q.check,$e,4,0)),Le=Pe=0,q.mode=4;case 4:for(;Le<16;){if(_e===0)break e;_e--,Pe+=Ke[ct++]<<Le,Le+=8}q.head&&(q.head.xflags=255&Pe,q.head.os=Pe>>8),512&q.flags&&($e[0]=255&Pe,$e[1]=Pe>>>8&255,q.check=w(q.check,$e,2,0)),Le=Pe=0,q.mode=5;case 5:if(1024&q.flags){for(;Le<16;){if(_e===0)break e;_e--,Pe+=Ke[ct++]<<Le,Le+=8}q.length=Pe,q.head&&(q.head.extra_len=Pe),512&q.flags&&($e[0]=255&Pe,$e[1]=Pe>>>8&255,q.check=w(q.check,$e,2,0)),Le=Pe=0}else q.head&&(q.head.extra=null);q.mode=6;case 6:if(1024&q.flags&&(_e<(at=q.length)&&(at=_e),at&&(q.head&&(Y=q.head.extra_len-q.length,q.head.extra||(q.head.extra=new Array(q.head.extra_len)),d.arraySet(q.head.extra,Ke,ct,at,Y)),512&q.flags&&(q.check=w(q.check,Ke,at,ct)),_e-=at,ct+=at,q.length-=at),q.length))break e;q.length=0,q.mode=7;case 7:if(2048&q.flags){if(_e===0)break e;for(at=0;Y=Ke[ct+at++],q.head&&Y&&q.length<65536&&(q.head.name+=String.fromCharCode(Y)),Y&&at<_e;);if(512&q.flags&&(q.check=w(q.check,Ke,at,ct)),_e-=at,ct+=at,Y)break e}else q.head&&(q.head.name=null);q.length=0,q.mode=8;case 8:if(4096&q.flags){if(_e===0)break e;for(at=0;Y=Ke[ct+at++],q.head&&Y&&q.length<65536&&(q.head.comment+=String.fromCharCode(Y)),Y&&at<_e;);if(512&q.flags&&(q.check=w(q.check,Ke,at,ct)),_e-=at,ct+=at,Y)break e}else q.head&&(q.head.comment=null);q.mode=9;case 9:if(512&q.flags){for(;Le<16;){if(_e===0)break e;_e--,Pe+=Ke[ct++]<<Le,Le+=8}if(Pe!==(65535&q.check)){J.msg="header crc mismatch",q.mode=30;break}Le=Pe=0}q.head&&(q.head.hcrc=q.flags>>9&1,q.head.done=!0),J.adler=q.check=0,q.mode=12;break;case 10:for(;Le<32;){if(_e===0)break e;_e--,Pe+=Ke[ct++]<<Le,Le+=8}J.adler=q.check=B(Pe),Le=Pe=0,q.mode=11;case 11:if(q.havedict===0)return J.next_out=He,J.avail_out=qe,J.next_in=ct,J.avail_in=_e,q.hold=Pe,q.bits=Le,2;J.adler=q.check=1,q.mode=12;case 12:if(ie===5||ie===6)break e;case 13:if(q.last){Pe>>>=7&Le,Le-=7&Le,q.mode=27;break}for(;Le<3;){if(_e===0)break e;_e--,Pe+=Ke[ct++]<<Le,Le+=8}switch(q.last=1&Pe,Le-=1,3&(Pe>>>=1)){case 0:q.mode=14;break;case 1:if(he(q),q.mode=20,ie!==6)break;Pe>>>=2,Le-=2;break e;case 2:q.mode=17;break;case 3:J.msg="invalid block type",q.mode=30}Pe>>>=2,Le-=2;break;case 14:for(Pe>>>=7&Le,Le-=7&Le;Le<32;){if(_e===0)break e;_e--,Pe+=Ke[ct++]<<Le,Le+=8}if((65535&Pe)!=(Pe>>>16^65535)){J.msg="invalid stored block lengths",q.mode=30;break}if(q.length=65535&Pe,Le=Pe=0,q.mode=15,ie===6)break e;case 15:q.mode=16;case 16:if(at=q.length){if(_e<at&&(at=_e),qe<at&&(at=qe),at===0)break e;d.arraySet(Mt,Ke,ct,at,He),_e-=at,ct+=at,qe-=at,He+=at,q.length-=at;break}q.mode=12;break;case 17:for(;Le<14;){if(_e===0)break e;_e--,Pe+=Ke[ct++]<<Le,Le+=8}if(q.nlen=257+(31&Pe),Pe>>>=5,Le-=5,q.ndist=1+(31&Pe),Pe>>>=5,Le-=5,q.ncode=4+(15&Pe),Pe>>>=4,Le-=4,286<q.nlen||30<q.ndist){J.msg="too many length or distance symbols",q.mode=30;break}q.have=0,q.mode=18;case 18:for(;q.have<q.ncode;){for(;Le<3;){if(_e===0)break e;_e--,Pe+=Ke[ct++]<<Le,Le+=8}q.lens[gt[q.have++]]=7&Pe,Pe>>>=3,Le-=3}for(;q.have<19;)q.lens[gt[q.have++]]=0;if(q.lencode=q.lendyn,q.lenbits=7,et={bits:q.lenbits},mt=S(0,q.lens,0,19,q.lencode,0,q.work,et),q.lenbits=et.bits,mt){J.msg="invalid code lengths set",q.mode=30;break}q.have=0,q.mode=19;case 19:for(;q.have<q.nlen+q.ndist;){for(;xr=(we=q.lencode[Pe&(1<<q.lenbits)-1])>>>16&255,Ir=65535&we,!((Kt=we>>>24)<=Le);){if(_e===0)break e;_e--,Pe+=Ke[ct++]<<Le,Le+=8}if(Ir<16)Pe>>>=Kt,Le-=Kt,q.lens[q.have++]=Ir;else{if(Ir===16){for(Ce=Kt+2;Le<Ce;){if(_e===0)break e;_e--,Pe+=Ke[ct++]<<Le,Le+=8}if(Pe>>>=Kt,Le-=Kt,q.have===0){J.msg="invalid bit length repeat",q.mode=30;break}Y=q.lens[q.have-1],at=3+(3&Pe),Pe>>>=2,Le-=2}else if(Ir===17){for(Ce=Kt+3;Le<Ce;){if(_e===0)break e;_e--,Pe+=Ke[ct++]<<Le,Le+=8}Le-=Kt,Y=0,at=3+(7&(Pe>>>=Kt)),Pe>>>=3,Le-=3}else{for(Ce=Kt+7;Le<Ce;){if(_e===0)break e;_e--,Pe+=Ke[ct++]<<Le,Le+=8}Le-=Kt,Y=0,at=11+(127&(Pe>>>=Kt)),Pe>>>=7,Le-=7}if(q.have+at>q.nlen+q.ndist){J.msg="invalid bit length repeat",q.mode=30;break}for(;at--;)q.lens[q.have++]=Y}}if(q.mode===30)break;if(q.lens[256]===0){J.msg="invalid code -- missing end-of-block",q.mode=30;break}if(q.lenbits=9,et={bits:q.lenbits},mt=S(D,q.lens,0,q.nlen,q.lencode,0,q.work,et),q.lenbits=et.bits,mt){J.msg="invalid literal/lengths set",q.mode=30;break}if(q.distbits=6,q.distcode=q.distdyn,et={bits:q.distbits},mt=S(R,q.lens,q.nlen,q.ndist,q.distcode,0,q.work,et),q.distbits=et.bits,mt){J.msg="invalid distances set",q.mode=30;break}if(q.mode=20,ie===6)break e;case 20:q.mode=21;case 21:if(6<=_e&&258<=qe){J.next_out=He,J.avail_out=qe,J.next_in=ct,J.avail_in=_e,q.hold=Pe,q.bits=Le,a(J,lt),He=J.next_out,Mt=J.output,qe=J.avail_out,ct=J.next_in,Ke=J.input,_e=J.avail_in,Pe=q.hold,Le=q.bits,q.mode===12&&(q.back=-1);break}for(q.back=0;xr=(we=q.lencode[Pe&(1<<q.lenbits)-1])>>>16&255,Ir=65535&we,!((Kt=we>>>24)<=Le);){if(_e===0)break e;_e--,Pe+=Ke[ct++]<<Le,Le+=8}if(xr&&!(240&xr)){for(jr=Kt,tr=xr,jn=Ir;xr=(we=q.lencode[jn+((Pe&(1<<jr+tr)-1)>>jr)])>>>16&255,Ir=65535&we,!(jr+(Kt=we>>>24)<=Le);){if(_e===0)break e;_e--,Pe+=Ke[ct++]<<Le,Le+=8}Pe>>>=jr,Le-=jr,q.back+=jr}if(Pe>>>=Kt,Le-=Kt,q.back+=Kt,q.length=Ir,xr===0){q.mode=26;break}if(32&xr){q.back=-1,q.mode=12;break}if(64&xr){J.msg="invalid literal/length code",q.mode=30;break}q.extra=15&xr,q.mode=22;case 22:if(q.extra){for(Ce=q.extra;Le<Ce;){if(_e===0)break e;_e--,Pe+=Ke[ct++]<<Le,Le+=8}q.length+=Pe&(1<<q.extra)-1,Pe>>>=q.extra,Le-=q.extra,q.back+=q.extra}q.was=q.length,q.mode=23;case 23:for(;xr=(we=q.distcode[Pe&(1<<q.distbits)-1])>>>16&255,Ir=65535&we,!((Kt=we>>>24)<=Le);){if(_e===0)break e;_e--,Pe+=Ke[ct++]<<Le,Le+=8}if(!(240&xr)){for(jr=Kt,tr=xr,jn=Ir;xr=(we=q.distcode[jn+((Pe&(1<<jr+tr)-1)>>jr)])>>>16&255,Ir=65535&we,!(jr+(Kt=we>>>24)<=Le);){if(_e===0)break e;_e--,Pe+=Ke[ct++]<<Le,Le+=8}Pe>>>=jr,Le-=jr,q.back+=jr}if(Pe>>>=Kt,Le-=Kt,q.back+=Kt,64&xr){J.msg="invalid distance code",q.mode=30;break}q.offset=Ir,q.extra=15&xr,q.mode=24;case 24:if(q.extra){for(Ce=q.extra;Le<Ce;){if(_e===0)break e;_e--,Pe+=Ke[ct++]<<Le,Le+=8}q.offset+=Pe&(1<<q.extra)-1,Pe>>>=q.extra,Le-=q.extra,q.back+=q.extra}if(q.offset>q.dmax){J.msg="invalid distance too far back",q.mode=30;break}q.mode=25;case 25:if(qe===0)break e;if(at=lt-qe,q.offset>at){if((at=q.offset-at)>q.whave&&q.sane){J.msg="invalid distance too far back",q.mode=30;break}Jt=at>q.wnext?(at-=q.wnext,q.wsize-at):q.wnext-at,at>q.length&&(at=q.length),Er=q.window}else Er=Mt,Jt=He-q.offset,at=q.length;for(qe<at&&(at=qe),qe-=at,q.length-=at;Mt[He++]=Er[Jt++],--at;);q.length===0&&(q.mode=21);break;case 26:if(qe===0)break e;Mt[He++]=q.length,qe--,q.mode=21;break;case 27:if(q.wrap){for(;Le<32;){if(_e===0)break e;_e--,Pe|=Ke[ct++]<<Le,Le+=8}if(lt-=qe,J.total_out+=lt,q.total+=lt,lt&&(J.adler=q.check=q.flags?w(q.check,Mt,lt,He-lt):_(q.check,Mt,lt,He-lt)),lt=qe,(q.flags?Pe:B(Pe))!==q.check){J.msg="incorrect data check",q.mode=30;break}Le=Pe=0}q.mode=28;case 28:if(q.wrap&&q.flags){for(;Le<32;){if(_e===0)break e;_e--,Pe+=Ke[ct++]<<Le,Le+=8}if(Pe!==(4294967295&q.total)){J.msg="incorrect length check",q.mode=30;break}Le=Pe=0}q.mode=29;case 29:mt=1;break e;case 30:mt=-3;break e;case 31:return-4;case 32:default:return M}return J.next_out=He,J.avail_out=qe,J.next_in=ct,J.avail_in=_e,q.hold=Pe,q.bits=Le,(q.wsize||lt!==J.avail_out&&q.mode<30&&(q.mode<27||ie!==4))&&ye(J,J.output,J.next_out,lt-J.avail_out)?(q.mode=31,-4):(Pt-=J.avail_in,lt-=J.avail_out,J.total_in+=Pt,J.total_out+=lt,q.total+=lt,q.wrap&&lt&&(J.adler=q.check=q.flags?w(q.check,Mt,lt,J.next_out-lt):_(q.check,Mt,lt,J.next_out-lt)),J.data_type=q.bits+(q.last?64:0)+(q.mode===12?128:0)+(q.mode===20||q.mode===15?256:0),(Pt==0&&lt===0||ie===4)&&mt===I&&(mt=-5),mt)},c.inflateEnd=function(J){if(!J||!J.state)return M;var ie=J.state;return ie.window&&(ie.window=null),J.state=null,I},c.inflateGetHeader=function(J,ie){var q;return J&&J.state&&2&(q=J.state).wrap?((q.head=ie).done=!1,I):M},c.inflateSetDictionary=function(J,ie){var q,Ke=ie.length;return J&&J.state?(q=J.state).wrap!==0&&q.mode!==11?M:q.mode===11&&_(1,ie,Ke,0)!==q.check?-3:ye(J,ie,Ke,Ke)?(q.mode=31,-4):(q.havedict=1,I):M},c.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,l,c){var d=n("../utils/common"),_=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],w=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],S=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];l.exports=function(D,R,I,M,N,j,W,B){var k,z,Z,ee,se,ue,Te,Q,he,ye=B.bits,J=0,ie=0,q=0,Ke=0,Mt=0,ct=0,He=0,_e=0,qe=0,Pe=0,Le=null,Pt=0,lt=new d.Buf16(16),at=new d.Buf16(16),Jt=null,Er=0;for(J=0;J<=15;J++)lt[J]=0;for(ie=0;ie<M;ie++)lt[R[I+ie]]++;for(Mt=ye,Ke=15;1<=Ke&&lt[Ke]===0;Ke--);if(Ke<Mt&&(Mt=Ke),Ke===0)return N[j++]=20971520,N[j++]=20971520,B.bits=1,0;for(q=1;q<Ke&&lt[q]===0;q++);for(Mt<q&&(Mt=q),J=_e=1;J<=15;J++)if(_e<<=1,(_e-=lt[J])<0)return-1;if(0<_e&&(D===0||Ke!==1))return-1;for(at[1]=0,J=1;J<15;J++)at[J+1]=at[J]+lt[J];for(ie=0;ie<M;ie++)R[I+ie]!==0&&(W[at[R[I+ie]]++]=ie);if(ue=D===0?(Le=Jt=W,19):D===1?(Le=_,Pt-=257,Jt=w,Er-=257,256):(Le=a,Jt=S,-1),J=q,se=j,He=ie=Pe=0,Z=-1,ee=(qe=1<<(ct=Mt))-1,D===1&&852<qe||D===2&&592<qe)return 1;for(;;){for(Te=J-He,he=W[ie]<ue?(Q=0,W[ie]):W[ie]>ue?(Q=Jt[Er+W[ie]],Le[Pt+W[ie]]):(Q=96,0),k=1<<J-He,q=z=1<<ct;N[se+(Pe>>He)+(z-=k)]=Te<<24|Q<<16|he|0,z!==0;);for(k=1<<J-1;Pe&k;)k>>=1;if(k!==0?(Pe&=k-1,Pe+=k):Pe=0,ie++,--lt[J]==0){if(J===Ke)break;J=R[I+W[ie]]}if(Mt<J&&(Pe&ee)!==Z){for(He===0&&(He=Mt),se+=q,_e=1<<(ct=J-He);ct+He<Ke&&!((_e-=lt[ct+He])<=0);)ct++,_e<<=1;if(qe+=1<<ct,D===1&&852<qe||D===2&&592<qe)return 1;N[Z=Pe&ee]=Mt<<24|ct<<16|se-j|0}}return Pe!==0&&(N[se+Pe]=J-He<<24|64<<16|0),B.bits=Mt,0}},{"../utils/common":41}],51:[function(n,l,c){l.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,l,c){var d=n("../utils/common"),_=0,w=1;function a(we){for(var $e=we.length;0<=--$e;)we[$e]=0}var S=0,D=29,R=256,I=R+1+D,M=30,N=19,j=2*I+1,W=15,B=16,k=7,z=256,Z=16,ee=17,se=18,ue=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Te=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Q=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],he=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ye=new Array(2*(I+2));a(ye);var J=new Array(2*M);a(J);var ie=new Array(512);a(ie);var q=new Array(256);a(q);var Ke=new Array(D);a(Ke);var Mt,ct,He,_e=new Array(M);function qe(we,$e,gt,St,tt){this.static_tree=we,this.extra_bits=$e,this.extra_base=gt,this.elems=St,this.max_length=tt,this.has_stree=we&&we.length}function Pe(we,$e){this.dyn_tree=we,this.max_code=0,this.stat_desc=$e}function Le(we){return we<256?ie[we]:ie[256+(we>>>7)]}function Pt(we,$e){we.pending_buf[we.pending++]=255&$e,we.pending_buf[we.pending++]=$e>>>8&255}function lt(we,$e,gt){we.bi_valid>B-gt?(we.bi_buf|=$e<<we.bi_valid&65535,Pt(we,we.bi_buf),we.bi_buf=$e>>B-we.bi_valid,we.bi_valid+=gt-B):(we.bi_buf|=$e<<we.bi_valid&65535,we.bi_valid+=gt)}function at(we,$e,gt){lt(we,gt[2*$e],gt[2*$e+1])}function Jt(we,$e){for(var gt=0;gt|=1&we,we>>>=1,gt<<=1,0<--$e;);return gt>>>1}function Er(we,$e,gt){var St,tt,Lt=new Array(W+1),$t=0;for(St=1;St<=W;St++)Lt[St]=$t=$t+gt[St-1]<<1;for(tt=0;tt<=$e;tt++){var Ot=we[2*tt+1];Ot!==0&&(we[2*tt]=Jt(Lt[Ot]++,Ot))}}function Kt(we){var $e;for($e=0;$e<I;$e++)we.dyn_ltree[2*$e]=0;for($e=0;$e<M;$e++)we.dyn_dtree[2*$e]=0;for($e=0;$e<N;$e++)we.bl_tree[2*$e]=0;we.dyn_ltree[2*z]=1,we.opt_len=we.static_len=0,we.last_lit=we.matches=0}function xr(we){8<we.bi_valid?Pt(we,we.bi_buf):0<we.bi_valid&&(we.pending_buf[we.pending++]=we.bi_buf),we.bi_buf=0,we.bi_valid=0}function Ir(we,$e,gt,St){var tt=2*$e,Lt=2*gt;return we[tt]<we[Lt]||we[tt]===we[Lt]&&St[$e]<=St[gt]}function jr(we,$e,gt){for(var St=we.heap[gt],tt=gt<<1;tt<=we.heap_len&&(tt<we.heap_len&&Ir($e,we.heap[tt+1],we.heap[tt],we.depth)&&tt++,!Ir($e,St,we.heap[tt],we.depth));)we.heap[gt]=we.heap[tt],gt=tt,tt<<=1;we.heap[gt]=St}function tr(we,$e,gt){var St,tt,Lt,$t,Ot=0;if(we.last_lit!==0)for(;St=we.pending_buf[we.d_buf+2*Ot]<<8|we.pending_buf[we.d_buf+2*Ot+1],tt=we.pending_buf[we.l_buf+Ot],Ot++,St===0?at(we,tt,$e):(at(we,(Lt=q[tt])+R+1,$e),($t=ue[Lt])!==0&&lt(we,tt-=Ke[Lt],$t),at(we,Lt=Le(--St),gt),($t=Te[Lt])!==0&&lt(we,St-=_e[Lt],$t)),Ot<we.last_lit;);at(we,z,$e)}function jn(we,$e){var gt,St,tt,Lt=$e.dyn_tree,$t=$e.stat_desc.static_tree,Ot=$e.stat_desc.has_stree,Qt=$e.stat_desc.elems,Mr=-1;for(we.heap_len=0,we.heap_max=j,gt=0;gt<Qt;gt++)Lt[2*gt]!==0?(we.heap[++we.heap_len]=Mr=gt,we.depth[gt]=0):Lt[2*gt+1]=0;for(;we.heap_len<2;)Lt[2*(tt=we.heap[++we.heap_len]=Mr<2?++Mr:0)]=1,we.depth[tt]=0,we.opt_len--,Ot&&(we.static_len-=$t[2*tt+1]);for($e.max_code=Mr,gt=we.heap_len>>1;1<=gt;gt--)jr(we,Lt,gt);for(tt=Qt;gt=we.heap[1],we.heap[1]=we.heap[we.heap_len--],jr(we,Lt,1),St=we.heap[1],we.heap[--we.heap_max]=gt,we.heap[--we.heap_max]=St,Lt[2*tt]=Lt[2*gt]+Lt[2*St],we.depth[tt]=(we.depth[gt]>=we.depth[St]?we.depth[gt]:we.depth[St])+1,Lt[2*gt+1]=Lt[2*St+1]=tt,we.heap[1]=tt++,jr(we,Lt,1),2<=we.heap_len;);we.heap[--we.heap_max]=we.heap[1],function(sr,vn){var Dn,Vn,qi,Jr,Wi,wi,ti=vn.dyn_tree,xo=vn.max_code,vs=vn.stat_desc.static_tree,eo=vn.stat_desc.has_stree,Ee=vn.stat_desc.extra_bits,te=vn.stat_desc.extra_base,re=vn.stat_desc.max_length,xe=0;for(Jr=0;Jr<=W;Jr++)sr.bl_count[Jr]=0;for(ti[2*sr.heap[sr.heap_max]+1]=0,Dn=sr.heap_max+1;Dn<j;Dn++)re<(Jr=ti[2*ti[2*(Vn=sr.heap[Dn])+1]+1]+1)&&(Jr=re,xe++),ti[2*Vn+1]=Jr,xo<Vn||(sr.bl_count[Jr]++,Wi=0,te<=Vn&&(Wi=Ee[Vn-te]),wi=ti[2*Vn],sr.opt_len+=wi*(Jr+Wi),eo&&(sr.static_len+=wi*(vs[2*Vn+1]+Wi)));if(xe!==0){do{for(Jr=re-1;sr.bl_count[Jr]===0;)Jr--;sr.bl_count[Jr]--,sr.bl_count[Jr+1]+=2,sr.bl_count[re]--,xe-=2}while(0<xe);for(Jr=re;Jr!==0;Jr--)for(Vn=sr.bl_count[Jr];Vn!==0;)xo<(qi=sr.heap[--Dn])||(ti[2*qi+1]!==Jr&&(sr.opt_len+=(Jr-ti[2*qi+1])*ti[2*qi],ti[2*qi+1]=Jr),Vn--)}}(we,$e),Er(Lt,Mr,we.bl_count)}function Y(we,$e,gt){var St,tt,Lt=-1,$t=$e[1],Ot=0,Qt=7,Mr=4;for($t===0&&(Qt=138,Mr=3),$e[2*(gt+1)+1]=65535,St=0;St<=gt;St++)tt=$t,$t=$e[2*(St+1)+1],++Ot<Qt&&tt===$t||(Ot<Mr?we.bl_tree[2*tt]+=Ot:tt!==0?(tt!==Lt&&we.bl_tree[2*tt]++,we.bl_tree[2*Z]++):Ot<=10?we.bl_tree[2*ee]++:we.bl_tree[2*se]++,Lt=tt,Mr=(Ot=0)===$t?(Qt=138,3):tt===$t?(Qt=6,3):(Qt=7,4))}function mt(we,$e,gt){var St,tt,Lt=-1,$t=$e[1],Ot=0,Qt=7,Mr=4;for($t===0&&(Qt=138,Mr=3),St=0;St<=gt;St++)if(tt=$t,$t=$e[2*(St+1)+1],!(++Ot<Qt&&tt===$t)){if(Ot<Mr)for(;at(we,tt,we.bl_tree),--Ot!=0;);else tt!==0?(tt!==Lt&&(at(we,tt,we.bl_tree),Ot--),at(we,Z,we.bl_tree),lt(we,Ot-3,2)):Ot<=10?(at(we,ee,we.bl_tree),lt(we,Ot-3,3)):(at(we,se,we.bl_tree),lt(we,Ot-11,7));Lt=tt,Mr=(Ot=0)===$t?(Qt=138,3):tt===$t?(Qt=6,3):(Qt=7,4)}}a(_e);var et=!1;function Ce(we,$e,gt,St){lt(we,(S<<1)+(St?1:0),3),function(tt,Lt,$t,Ot){xr(tt),Pt(tt,$t),Pt(tt,~$t),d.arraySet(tt.pending_buf,tt.window,Lt,$t,tt.pending),tt.pending+=$t}(we,$e,gt)}c._tr_init=function(we){et||(function(){var $e,gt,St,tt,Lt,$t=new Array(W+1);for(tt=St=0;tt<D-1;tt++)for(Ke[tt]=St,$e=0;$e<1<<ue[tt];$e++)q[St++]=tt;for(q[St-1]=tt,tt=Lt=0;tt<16;tt++)for(_e[tt]=Lt,$e=0;$e<1<<Te[tt];$e++)ie[Lt++]=tt;for(Lt>>=7;tt<M;tt++)for(_e[tt]=Lt<<7,$e=0;$e<1<<Te[tt]-7;$e++)ie[256+Lt++]=tt;for(gt=0;gt<=W;gt++)$t[gt]=0;for($e=0;$e<=143;)ye[2*$e+1]=8,$e++,$t[8]++;for(;$e<=255;)ye[2*$e+1]=9,$e++,$t[9]++;for(;$e<=279;)ye[2*$e+1]=7,$e++,$t[7]++;for(;$e<=287;)ye[2*$e+1]=8,$e++,$t[8]++;for(Er(ye,I+1,$t),$e=0;$e<M;$e++)J[2*$e+1]=5,J[2*$e]=Jt($e,5);Mt=new qe(ye,ue,R+1,I,W),ct=new qe(J,Te,0,M,W),He=new qe(new Array(0),Q,0,N,k)}(),et=!0),we.l_desc=new Pe(we.dyn_ltree,Mt),we.d_desc=new Pe(we.dyn_dtree,ct),we.bl_desc=new Pe(we.bl_tree,He),we.bi_buf=0,we.bi_valid=0,Kt(we)},c._tr_stored_block=Ce,c._tr_flush_block=function(we,$e,gt,St){var tt,Lt,$t=0;0<we.level?(we.strm.data_type===2&&(we.strm.data_type=function(Ot){var Qt,Mr=4093624447;for(Qt=0;Qt<=31;Qt++,Mr>>>=1)if(1&Mr&&Ot.dyn_ltree[2*Qt]!==0)return _;if(Ot.dyn_ltree[18]!==0||Ot.dyn_ltree[20]!==0||Ot.dyn_ltree[26]!==0)return w;for(Qt=32;Qt<R;Qt++)if(Ot.dyn_ltree[2*Qt]!==0)return w;return _}(we)),jn(we,we.l_desc),jn(we,we.d_desc),$t=function(Ot){var Qt;for(Y(Ot,Ot.dyn_ltree,Ot.l_desc.max_code),Y(Ot,Ot.dyn_dtree,Ot.d_desc.max_code),jn(Ot,Ot.bl_desc),Qt=N-1;3<=Qt&&Ot.bl_tree[2*he[Qt]+1]===0;Qt--);return Ot.opt_len+=3*(Qt+1)+5+5+4,Qt}(we),tt=we.opt_len+3+7>>>3,(Lt=we.static_len+3+7>>>3)<=tt&&(tt=Lt)):tt=Lt=gt+5,gt+4<=tt&&$e!==-1?Ce(we,$e,gt,St):we.strategy===4||Lt===tt?(lt(we,2+(St?1:0),3),tr(we,ye,J)):(lt(we,4+(St?1:0),3),function(Ot,Qt,Mr,sr){var vn;for(lt(Ot,Qt-257,5),lt(Ot,Mr-1,5),lt(Ot,sr-4,4),vn=0;vn<sr;vn++)lt(Ot,Ot.bl_tree[2*he[vn]+1],3);mt(Ot,Ot.dyn_ltree,Qt-1),mt(Ot,Ot.dyn_dtree,Mr-1)}(we,we.l_desc.max_code+1,we.d_desc.max_code+1,$t+1),tr(we,we.dyn_ltree,we.dyn_dtree)),Kt(we),St&&xr(we)},c._tr_tally=function(we,$e,gt){return we.pending_buf[we.d_buf+2*we.last_lit]=$e>>>8&255,we.pending_buf[we.d_buf+2*we.last_lit+1]=255&$e,we.pending_buf[we.l_buf+we.last_lit]=255&gt,we.last_lit++,$e===0?we.dyn_ltree[2*gt]++:(we.matches++,$e--,we.dyn_ltree[2*(q[gt]+R+1)]++,we.dyn_dtree[2*Le($e)]++),we.last_lit===we.lit_bufsize-1},c._tr_align=function(we){lt(we,2,3),at(we,z,ye),function($e){$e.bi_valid===16?(Pt($e,$e.bi_buf),$e.bi_buf=0,$e.bi_valid=0):8<=$e.bi_valid&&($e.pending_buf[$e.pending++]=255&$e.bi_buf,$e.bi_buf>>=8,$e.bi_valid-=8)}(we)}},{"../utils/common":41}],53:[function(n,l,c){l.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,l,c){(function(d){(function(_,w){if(!_.setImmediate){var a,S,D,R,I=1,M={},N=!1,j=_.document,W=Object.getPrototypeOf&&Object.getPrototypeOf(_);W=W&&W.setTimeout?W:_,a={}.toString.call(_.process)==="[object process]"?function(Z){process.nextTick(function(){k(Z)})}:function(){if(_.postMessage&&!_.importScripts){var Z=!0,ee=_.onmessage;return _.onmessage=function(){Z=!1},_.postMessage("","*"),_.onmessage=ee,Z}}()?(R="setImmediate$"+Math.random()+"$",_.addEventListener?_.addEventListener("message",z,!1):_.attachEvent("onmessage",z),function(Z){_.postMessage(R+Z,"*")}):_.MessageChannel?((D=new MessageChannel).port1.onmessage=function(Z){k(Z.data)},function(Z){D.port2.postMessage(Z)}):j&&"onreadystatechange"in j.createElement("script")?(S=j.documentElement,function(Z){var ee=j.createElement("script");ee.onreadystatechange=function(){k(Z),ee.onreadystatechange=null,S.removeChild(ee),ee=null},S.appendChild(ee)}):function(Z){setTimeout(k,0,Z)},W.setImmediate=function(Z){typeof Z!="function"&&(Z=new Function(""+Z));for(var ee=new Array(arguments.length-1),se=0;se<ee.length;se++)ee[se]=arguments[se+1];var ue={callback:Z,args:ee};return M[I]=ue,a(I),I++},W.clearImmediate=B}function B(Z){delete M[Z]}function k(Z){if(N)setTimeout(k,0,Z);else{var ee=M[Z];if(ee){N=!0;try{(function(se){var ue=se.callback,Te=se.args;switch(Te.length){case 0:ue();break;case 1:ue(Te[0]);break;case 2:ue(Te[0],Te[1]);break;case 3:ue(Te[0],Te[1],Te[2]);break;default:ue.apply(w,Te)}})(ee)}finally{B(Z),N=!1}}}}function z(Z){Z.source===_&&typeof Z.data=="string"&&Z.data.indexOf(R)===0&&k(+Z.data.slice(R.length))}})(typeof self>"u"?d===void 0?this:d:self)}).call(this,typeof window<"u"?window:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(wB);var B2=wB.exports;const EB=Pu(B2);var TB={exports:{}};(function(e,t){(function(n,l){l()})(Am,function(){function n(S,D){return typeof D>"u"?D={autoBom:!1}:typeof D!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),D={autoBom:!D}),D.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(S.type)?new Blob(["\uFEFF",S],{type:S.type}):S}function l(S,D,R){var I=new XMLHttpRequest;I.open("GET",S),I.responseType="blob",I.onload=function(){a(I.response,D,R)},I.onerror=function(){console.error("could not download file")},I.send()}function c(S){var D=new XMLHttpRequest;D.open("HEAD",S,!1);try{D.send()}catch{}return 200<=D.status&&299>=D.status}function d(S){try{S.dispatchEvent(new MouseEvent("click"))}catch{var D=document.createEvent("MouseEvents");D.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),S.dispatchEvent(D)}}var _=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof window=="object"&&window.global===window?window:void 0,w=_.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),a=_.saveAs||(typeof window!="object"||window!==_?function(){}:"download"in HTMLAnchorElement.prototype&&!w?function(S,D,R){var I=_.URL||_.webkitURL,M=document.createElement("a");D=D||S.name||"download",M.download=D,M.rel="noopener",typeof S=="string"?(M.href=S,M.origin===location.origin?d(M):c(M.href)?l(S,D,R):d(M,M.target="_blank")):(M.href=I.createObjectURL(S),setTimeout(function(){I.revokeObjectURL(M.href)},4e4),setTimeout(function(){d(M)},0))}:"msSaveOrOpenBlob"in navigator?function(S,D,R){if(D=D||S.name||"download",typeof S!="string")navigator.msSaveOrOpenBlob(n(S,R),D);else if(c(S))l(S,D,R);else{var I=document.createElement("a");I.href=S,I.target="_blank",setTimeout(function(){d(I)})}}:function(S,D,R,I){if(I=I||open("","_blank"),I&&(I.document.title=I.document.body.innerText="downloading..."),typeof S=="string")return l(S,D,R);var M=S.type==="application/octet-stream",N=/constructor/i.test(_.HTMLElement)||_.safari,j=/CriOS\/[\d]+/.test(navigator.userAgent);if((j||M&&N||w)&&typeof FileReader<"u"){var W=new FileReader;W.onloadend=function(){var z=W.result;z=j?z:z.replace(/^data:[^;]*;/,"data:attachment/file;"),I?I.location.href=z:location=z,I=null},W.readAsDataURL(S)}else{var B=_.URL||_.webkitURL,k=B.createObjectURL(S);I?I.location=k:location.href=k,I=null,setTimeout(function(){B.revokeObjectURL(k)},4e4)}});_.saveAs=a.saveAs=a,e.exports=a})})(TB);var N2=TB.exports;const U2=async(e,t,n="MiniMission",l=null)=>{const c=new EB,d=Date.now(),{speed:_,straightenLegs:w,waypointAction:a,gimbalPitch:S,missionEndAction:D}=t,R=`<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://www.opengis.net/kml/2.2" xmlns:wpml="http://www.dji.com/wpmz/1.0.2">
  <Document>
    <wpml:createTime>${d}</wpml:createTime>
    <wpml:updateTime>${d}</wpml:updateTime>
    <wpml:missionConfig>
      <wpml:flyToWaylineMode>safely</wpml:flyToWaylineMode>
      <wpml:finishAction>${D}</wpml:finishAction>
      <wpml:exitOnRCLost>executeLostAction</wpml:exitOnRCLost>
      <wpml:executeRCLostAction>hover</wpml:executeRCLostAction>
      <wpml:globalTransitionalSpeed>${_}</wpml:globalTransitionalSpeed>
      <wpml:droneInfo>
        <wpml:droneEnumValue>68</wpml:droneEnumValue>
        <wpml:droneSubEnumValue>0</wpml:droneSubEnumValue>
      </wpml:droneInfo>
    </wpml:missionConfig>
    <wpml:templateId>0</wpml:templateId>
  </Document>
</kml>`;let I="";e.forEach((W,B)=>{const k=B===0,z=B===e.length-1,Z=B+1,ee=W.straightenLegs!==void 0?W.straightenLegs:w,se=W.action!==void 0?W.action:a,ue=W.gimbalPitch!==void 0?W.gimbalPitch:S,Te=W.speed!==void 0?W.speed:_;let Q="",he=0;const ye=B>0?e[B-1]:null,J=ye?ye.gimbalPitch!==void 0?ye.gimbalPitch:S:null;(k||J!==null&&ue!==J)&&(Q+=`
        <wpml:action>
          <wpml:actionId>${he++}</wpml:actionId>
          <wpml:actionActuatorFunc>gimbalRotate</wpml:actionActuatorFunc>
          <wpml:actionActuatorFuncParam>
            <wpml:gimbalHeadingYawBase>aircraft</wpml:gimbalHeadingYawBase>
            <wpml:gimbalRotateMode>absoluteAngle</wpml:gimbalRotateMode>
            <wpml:gimbalPitchRotateEnable>1</wpml:gimbalPitchRotateEnable>
            <wpml:gimbalPitchRotateAngle>${ue}</wpml:gimbalPitchRotateAngle>
            <wpml:gimbalRollRotateEnable>0</wpml:gimbalRollRotateEnable>
            <wpml:gimbalYawRotateEnable>0</wpml:gimbalYawRotateEnable>
            <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
          </wpml:actionActuatorFuncParam>
        </wpml:action>`),se==="photo"?Q+=`
        <wpml:action>
          <wpml:actionId>${he++}</wpml:actionId>
          <wpml:actionActuatorFunc>takePhoto</wpml:actionActuatorFunc>
          <wpml:actionActuatorFuncParam>
            <wpml:fileSuffix>point${B}</wpml:fileSuffix>
            <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
          </wpml:actionActuatorFuncParam>
        </wpml:action>`:se==="record_start"?Q+=`
          <wpml:action>
            <wpml:actionId>${he++}</wpml:actionId>
            <wpml:actionActuatorFunc>startRecord</wpml:actionActuatorFunc>
            <wpml:actionActuatorFuncParam>
              <wpml:fileSuffix>mission</wpml:fileSuffix>
              <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
            </wpml:actionActuatorFuncParam>
          </wpml:action>`:se==="record_stop"?Q+=`
          <wpml:action>
            <wpml:actionId>${he++}</wpml:actionId>
            <wpml:actionActuatorFunc>stopRecord</wpml:actionActuatorFunc>
            <wpml:actionActuatorFuncParam>
              <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
            </wpml:actionActuatorFuncParam>
          </wpml:action>`:se==="record"&&(k?Q+=`
            <wpml:action>
              <wpml:actionId>${he++}</wpml:actionId>
              <wpml:actionActuatorFunc>startRecord</wpml:actionActuatorFunc>
              <wpml:actionActuatorFuncParam>
                <wpml:fileSuffix>mission</wpml:fileSuffix>
                <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
              </wpml:actionActuatorFuncParam>
            </wpml:action>`:z&&(Q+=`
            <wpml:action>
              <wpml:actionId>${he++}</wpml:actionId>
              <wpml:actionActuatorFunc>stopRecord</wpml:actionActuatorFunc>
              <wpml:actionActuatorFuncParam>
                <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
              </wpml:actionActuatorFuncParam>
            </wpml:action>`));const ie=he>0?`
      <wpml:actionGroup>
        <wpml:actionGroupId>${Z}</wpml:actionGroupId>
        <wpml:actionGroupStartIndex>${B}</wpml:actionGroupStartIndex>
        <wpml:actionGroupEndIndex>${B}</wpml:actionGroupEndIndex>
        <wpml:actionGroupMode>sequence</wpml:actionGroupMode>
        <wpml:actionTrigger>
          <wpml:actionTriggerType>reachPoint</wpml:actionTriggerType>
        </wpml:actionTrigger>
        ${Q}
      </wpml:actionGroup>`:"";I+=`
    <Placemark>
      <Point><coordinates>${W.lng},${W.lat},0</coordinates></Point>
      <wpml:index>${B}</wpml:index>
      <wpml:executeHeight>${W.altitude}</wpml:executeHeight>
      <wpml:waypointSpeed>${Te}</wpml:waypointSpeed>
      <wpml:waypointHeadingParam>
        <wpml:waypointHeadingMode>smoothTransition</wpml:waypointHeadingMode>
        <wpml:waypointHeadingAngle>${W.heading}</wpml:waypointHeadingAngle>
        <wpml:waypointHeadingAngleEnable>0</wpml:waypointHeadingAngleEnable>
        <wpml:waypointHeadingPathMode>followBadArc</wpml:waypointHeadingPathMode>
      </wpml:waypointHeadingParam>
      <wpml:useStraightLine>${ee?1:0}</wpml:useStraightLine>
      ${ie}
    </Placemark>`});const M=`<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://www.opengis.net/kml/2.2" xmlns:wpml="http://www.dji.com/wpmz/1.0.2">
  <Document>
    <wpml:missionConfig>
      <wpml:flyToWaylineMode>safely</wpml:flyToWaylineMode>
      <wpml:finishAction>${D}</wpml:finishAction>
      <wpml:exitOnRCLost>executeLostAction</wpml:exitOnRCLost>
      <wpml:executeRCLostAction>hover</wpml:executeRCLostAction>
      <wpml:globalTransitionalSpeed>${_}</wpml:globalTransitionalSpeed>
      <wpml:droneInfo>
        <wpml:droneEnumValue>68</wpml:droneEnumValue>
        <wpml:droneSubEnumValue>0</wpml:droneSubEnumValue>
      </wpml:droneInfo>
    </wpml:missionConfig>
    <Folder>
      <wpml:templateId>0</wpml:templateId>
      <wpml:executeHeightMode>relativeToStartPoint</wpml:executeHeightMode>
      <wpml:waylineId>0</wpml:waylineId>
      <wpml:autoFlightSpeed>${_}</wpml:autoFlightSpeed>
      ${I}
    </Folder>
  </Document>
</kml>`,N=c.folder("wpmz");N.file("template.kml",R),N.file("waylines.wpml",M),l&&N.file("waygen_session.json",JSON.stringify(l,null,2));const j=await c.generateAsync({type:"blob"});N2.saveAs(j,`${n}.kmz`)};function Va(e,t){return Array.from(e.getElementsByTagName(t))}function av(e){return e[0]==="#"?e:`#${e}`}function $2(e,t,n){return Array.from(e.getElementsByTagNameNS(n,t))}function ms(e){return e==null||e.normalize(),e&&e.textContent||""}function Ga(e,t,n){const l=e.getElementsByTagName(t);return l.length?l[0]:null}function da(e,t,n){const l={};if(!e)return l;const c=e.getElementsByTagName(t),d=c.length?c[0]:null;return d&&n?n(d,l):l}function Zf(e,t,n){const l=ms(Ga(e,t));return l&&n?n(l)||{}:{}}function sf(e,t,n){const l=parseFloat(ms(Ga(e,t)));if(!isNaN(l))return n&&n(l),l}function SB(e,t){const n={};for(const l of t)Zf(e,l,c=>{n[l]=c});return n}function AB(e){return(e==null?void 0:e.nodeType)===1}function CB(e,t){const n={},l=t=="stroke"||t==="fill"?t:t+"-color";return e[0]==="#"&&(e=e.substring(1)),e.length===6||e.length===3?n[l]="#"+e:e.length===8&&(n[t+"-opacity"]=parseInt(e.substring(0,2),16)/255,n[l]="#"+e.substring(6,8)+e.substring(4,6)+e.substring(2,4)),n}function lv(e,t,n){const l={};return sf(e,t,c=>{l[n]=c}),l}function LS(e,t){return da(e,"color",n=>CB(ms(n),t))}function IB(e){return da(e,"Icon",(t,n)=>(Zf(t,"href",l=>{n.icon=l}),n))}function j2(e){return da(e,"IconStyle",t=>Object.assign(LS(t,"icon"),lv(t,"scale","icon-scale"),lv(t,"heading","icon-heading"),da(t,"hotSpot",n=>{const l=parseFloat(n.getAttribute("x")||""),c=parseFloat(n.getAttribute("y")||""),d=n.getAttribute("xunits")||"",_=n.getAttribute("yunits")||"";return!isNaN(l)&&!isNaN(c)?{"icon-offset":[l,c],"icon-offset-units":[d,_]}:{}}),IB(t)))}function V2(e){return da(e,"LabelStyle",t=>Object.assign(LS(t,"label"),lv(t,"scale","label-scale")))}function G2(e){return da(e,"LineStyle",t=>Object.assign(LS(t,"stroke"),lv(t,"width","stroke-width")))}function q2(e){return da(e,"PolyStyle",(t,n)=>Object.assign(n,da(t,"color",l=>CB(ms(l),"fill")),Zf(t,"fill",l=>{if(l==="0")return{"fill-opacity":0}}),Zf(t,"outline",l=>{if(l==="0")return{"stroke-opacity":0}})))}function OS(e){return Object.assign({},q2(e),G2(e),V2(e),j2(e))}const nf=e=>Number(e),kE={string:e=>e,int:nf,uint:nf,short:nf,ushort:nf,float:nf,double:nf,bool:e=>!!e};function MB(e,t){return da(e,"ExtendedData",(n,l)=>{for(const c of Va(n,"Data"))l[c.getAttribute("name")||""]=ms(Ga(c,"value"));for(const c of Va(n,"SimpleData")){const d=c.getAttribute("name")||"",_=t[d]||kE.string;l[d]=_(ms(c))}return l})}function PB(e){const t=Ga(e,"description");for(const n of Array.from((t==null?void 0:t.childNodes)||[]))if(n.nodeType===4)return{description:{"@type":"html",value:ms(n)}};return{}}function kB(e){return da(e,"TimeSpan",t=>({timespan:{begin:ms(Ga(t,"begin")),end:ms(Ga(t,"end"))}}))}function LB(e){return da(e,"TimeStamp",t=>({timestamp:ms(Ga(t,"when"))}))}function OB(e,t){return Zf(e,"styleUrl",n=>(n=av(n),t[n]?Object.assign({styleUrl:n},t[n]):{styleUrl:n}))}const W2=/\s*/g,Z2=/^\s*|\s*$/g,H2=/\s+/;function DB(e){return e.replace(W2,"").split(",").map(parseFloat).filter(t=>!isNaN(t)).slice(0,3)}function LE(e){return e.replace(Z2,"").split(H2).map(DB).filter(t=>t.length>=2)}function X2(e){let t=Va(e,"coord");t.length===0&&(t=$2(e,"coord","*"));const n=t.map(l=>ms(l).split(" ").map(parseFloat));return n.length===0?null:{geometry:n.length>2?{type:"LineString",coordinates:n}:{type:"Point",coordinates:n[0]},times:Va(e,"when").map(l=>ms(l))}}function RB(e){if(e.length===0)return e;const t=e[0],n=e[e.length-1];let l=!0;for(let c=0;c<Math.max(t.length,n.length);c++)if(t[c]!==n[c]){l=!1;break}return l?e:e.concat([e[0]])}function p_(e){return ms(Ga(e,"coordinates"))}function zB(e){let t=[],n=[];for(let l=0;l<e.childNodes.length;l++){const c=e.childNodes.item(l);if(AB(c))switch(c.tagName){case"MultiGeometry":case"MultiTrack":case"gx:MultiTrack":{const d=zB(c);t=t.concat(d.geometries),n=n.concat(d.coordTimes);break}case"Point":{const d=DB(p_(c));d.length>=2&&t.push({type:"Point",coordinates:d});break}case"LinearRing":case"LineString":{const d=LE(p_(c));d.length>=2&&t.push({type:"LineString",coordinates:d});break}case"Polygon":{const d=[];for(const _ of Va(c,"LinearRing")){const w=RB(LE(p_(_)));w.length>=4&&d.push(w)}d.length&&t.push({type:"Polygon",coordinates:d});break}case"Track":case"gx:Track":{const d=X2(c);if(!d)break;const{times:_,geometry:w}=d;t.push(w),_.length&&n.push(_);break}}}return{geometries:t,coordTimes:n}}function K2(e){return e.length===0?null:e.length===1?e[0]:{type:"GeometryCollection",geometries:e}}function Y2(e,t,n,l){var S;const{coordTimes:c,geometries:d}=zB(e),_=K2(d);if(!_&&l.skipNullGeometry)return null;const w={type:"Feature",geometry:_,properties:Object.assign(SB(e,["name","address","visibility","open","phoneNumber","description"]),PB(e),OB(e,t),OS(e),MB(e,n),kB(e),LB(e),c.length?{coordinateProperties:{times:c.length===1?c[0]:c}}:{})};((S=w.properties)==null?void 0:S.visibility)!==void 0&&(w.properties.visibility=w.properties.visibility!=="0");const a=e.getAttribute("id");return a!==null&&a!==""&&(w.id=a),w}function J2(e){return Ga(e,"gx:LatLonQuad")?{geometry:{type:"Polygon",coordinates:[RB(LE(p_(e)))]}}:tee(e)}const Q2=Math.PI/180;function eee(e,t,n){const l=[(e[0]+e[2])/2,(e[1]+e[3])/2];return[t[0].map(c=>{const d=c[1]-l[1],_=c[0]-l[0],w=Math.sqrt(Math.pow(d,2)+Math.pow(_,2)),a=Math.atan2(d,_)+n*Q2;return[l[0]+Math.cos(a)*w,l[1]+Math.sin(a)*w]})]}function tee(e){const t=Ga(e,"LatLonBox");if(t){const n=sf(t,"north"),l=sf(t,"west"),c=sf(t,"east"),d=sf(t,"south"),_=sf(t,"rotation");if(typeof n=="number"&&typeof d=="number"&&typeof l=="number"&&typeof c=="number"){const w=[l,d,c,n];let a=[[[l,n],[c,n],[c,d],[l,d],[l,n]]];return typeof _=="number"&&(a=eee(w,a,_)),{bbox:w,geometry:{type:"Polygon",coordinates:a}}}}return null}function ree(e,t,n,l){var a;const c=J2(e),d=(c==null?void 0:c.geometry)||null;if(!d&&l.skipNullGeometry)return null;const _={type:"Feature",geometry:d,properties:Object.assign({"@geometry-type":"groundoverlay"},SB(e,["name","address","visibility","open","phoneNumber","description"]),PB(e),OB(e,t),OS(e),IB(e),MB(e,n),kB(e),LB(e))};c!=null&&c.bbox&&(_.bbox=c.bbox),((a=_.properties)==null?void 0:a.visibility)!==void 0&&(_.properties.visibility=_.properties.visibility!=="0");const w=e.getAttribute("id");return w!==null&&w!==""&&(_.id=w),_}function nee(e){let t=e.getAttribute("id");const n=e.parentNode;return!t&&AB(n)&&n.localName==="CascadingStyle"&&(t=n.getAttribute("kml:id")||n.getAttribute("id")),av(t||"")}function iee(e){const t={};for(const n of Va(e,"Style"))t[nee(n)]=OS(n);for(const n of Va(e,"StyleMap")){const l=av(n.getAttribute("id")||"");Zf(n,"styleUrl",c=>{c=av(c),t[c]&&(t[l]=t[c])})}return t}function oee(e){const t={};for(const n of Va(e,"SimpleField"))t[n.getAttribute("name")||""]=kE[n.getAttribute("type")||""]||kE.string;return t}function*see(e,t={skipNullGeometry:!1}){const n=iee(e),l=oee(e);for(const c of Va(e,"Placemark")){const d=Y2(c,n,l,t);d&&(yield d)}for(const c of Va(e,"GroundOverlay")){const d=ree(c,n,l,t);d&&(yield d)}}function _3(e,t={skipNullGeometry:!1}){return{type:"FeatureCollection",features:Array.from(see(e,t))}}const aee=async e=>{if(e.name.toLowerCase().endsWith(".kml")){const t=await e.text(),n=new DOMParser().parseFromString(t,"text/xml");return{geojson:_3(n),sessionData:null}}if(e.name.toLowerCase().endsWith(".kmz"))try{const t=await EB.loadAsync(e);let n=Object.keys(t.files).find(l=>l.toLowerCase().endsWith("waylines.wpml"));if(n||(n=Object.keys(t.files).find(l=>l.toLowerCase().endsWith(".kml"))),n){const l=await t.file(n).async("text"),c=new DOMParser().parseFromString(l,"text/xml"),d=_3(c),_=Array.from(c.getElementsByTagName("Placemark")),w=(R,I)=>{let M=R.getElementsByTagName("wpml:"+I);if(M.length>0||(M=R.getElementsByTagName(I),M.length>0))return M[0].textContent;const N=R.getElementsByTagName("*");for(let j=0;j<N.length;j++)if(N[j].localName===I)return N[j].textContent;return null},a=d.features.length===_.length;if(d.features.forEach((R,I)=>{if(R.geometry.type==="Point"){let M=null;if(a)M=_[I];else{const[N,j]=R.geometry.coordinates;M=_.find(W=>{var se;const B=W.getElementsByTagName("Point")[0];if(!B)return!1;const z=(((se=B.getElementsByTagName("coordinates")[0])==null?void 0:se.textContent)||"").trim().split(",");if(z.length<2)return!1;const Z=Number(z[0]),ee=Number(z[1]);return Math.abs(Z-N)<1e-4&&Math.abs(ee-j)<1e-4})}if(M){let N=w(M,"waypointHeading");N===null&&(N=w(M,"waypointHeadingAngle"));const j=w(M,"waypointSpeed");let W=w(M,"ellipsoidHeight");W===null&&(W=w(M,"height")),W===null&&(W=w(M,"executeHeight"));const B=w(M,"gimbalPitchAngle");N!==null&&(R.properties.heading=Number(N)),j!==null&&(R.properties.speed=Number(j)),W!==null&&(R.properties.altitude=Number(W)),B!==null&&(R.properties.gimbalPitch=Number(B))}}}),!d||!d.features||d.features.length===0)throw new Error("No features found in KML/WPML file.");let S=null;const D=t.file("wpmz/waygen_session.json");if(D)try{const R=await D.async("text");S=JSON.parse(R)}catch(R){console.warn("Failed to parse session data:",R)}return{geojson:d,sessionData:S}}else throw new Error("No valid KML or WPML file found inside KMZ.")}catch(t){throw console.error("KMZ Parse Error:",t),new Error("Failed to unzip or parse KMZ.")}throw new Error("Unsupported file format. Please use .kml or .kmz")};function lee({isOpen:e,onClose:t,onDownload:n,defaultFilename:l,defaultMissionEndAction:c}){const[d,_]=Sr.useState(""),[w,a]=Sr.useState("goHome"),[S,D]=Sr.useState("");Sr.useEffect(()=>{e&&(_(l),a(c),D(""))},[e,l,c]);const R=j=>j.replace(/[^a-zA-Z0-9_-]/g,"_").substring(0,100).trim(),I=j=>{const W=R(j.target.value);_(W),D(W.length===0?"Filename cannot be empty":"")},M=()=>{if(!d||d.length===0){D("Filename cannot be empty");return}n({filename:d,missionEndAction:w}),t()},N=j=>{j.key==="Escape"?t():j.key==="Enter"&&!S&&d&&M()};return e?Be.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t,children:Be.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-96 max-w-full mx-4",onClick:j=>j.stopPropagation(),onKeyDown:N,children:[Be.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[Be.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"Export Mission"}),Be.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:Be.jsx(bB,{size:20})})]}),Be.jsxs("div",{className:"p-4 space-y-4",children:[Be.jsxs("div",{children:[Be.jsx("label",{className:"text-sm font-bold text-gray-700 mb-2 block",children:"Mission End Action"}),Be.jsxs("select",{value:w,onChange:j=>a(j.target.value),className:"w-full border rounded p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none",children:[Be.jsx("option",{value:"goHome",children:"Return to Home"}),Be.jsx("option",{value:"autoLand",children:"Hover"})]}),Be.jsx("p",{className:"text-xs text-gray-500 mt-1",children:w==="goHome"?"Drone will return to launch point after mission":"Drone will hover at final waypoint"})]}),Be.jsxs("div",{children:[Be.jsx("label",{className:"text-sm font-bold text-gray-700 mb-2 block",children:"File Name"}),Be.jsxs("div",{className:"flex items-center gap-2",children:[Be.jsx("input",{type:"text",value:d,onChange:I,className:`flex-1 border rounded p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none ${S?"border-red-500":""}`,placeholder:"Enter filename",autoFocus:!0}),Be.jsx("span",{className:"text-sm text-gray-500 font-medium",children:".kmz"})]}),S&&Be.jsx("p",{className:"text-xs text-red-500 mt-1",children:S}),Be.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Allowed: letters, numbers, hyphens, underscores"})]})]}),Be.jsxs("div",{className:"flex items-center justify-end gap-2 p-4 border-t bg-gray-50",children:[Be.jsx("button",{onClick:t,className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 font-medium transition-colors",children:"Cancel"}),Be.jsx("button",{onClick:M,disabled:!!S||!d,className:"px-4 py-2 bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-medium rounded text-sm transition-colors",children:"Download"})]})]})}):null}function uee({isOpen:e,onClose:t,warningLevel:n,missionTime:l,droneName:c,maxFlightTime:d}){if(!e)return null;const _=n==="critical",a=_?k2:m2,S=_?"text-red-500":"text-yellow-500",D=_?"bg-red-50":"bg-yellow-50",R=_?"border-red-200":"border-yellow-200",I=_?`Mission time (${l}) exceeds the ${c} maximum flight duration (~${d} minutes).`:`Mission time (${l}) is approaching the ${c} maximum flight duration (~${d} minutes).`;return Be.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t,children:Be.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-96 max-w-full mx-4",onClick:M=>M.stopPropagation(),children:[Be.jsxs("div",{className:`flex items-center justify-between p-4 border-b ${R} ${D}`,children:[Be.jsxs("div",{className:"flex items-center gap-2",children:[Be.jsx(a,{size:24,className:S}),Be.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"Flight Duration Warning"})]}),Be.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:Be.jsx(bB,{size:20})})]}),Be.jsxs("div",{className:"p-4 space-y-4",children:[Be.jsx("p",{className:"text-sm text-gray-700",children:I}),Be.jsxs("div",{className:`p-3 rounded border ${R} ${D}`,children:[Be.jsx("p",{className:"text-sm font-bold text-gray-700 mb-2",children:"Consider:"}),Be.jsxs("ul",{className:"text-sm text-gray-600 space-y-1.5 list-disc list-inside",children:[Be.jsx("li",{children:"Reducing waypoint coverage area"}),Be.jsx("li",{children:"Increasing spacing/overlap settings"}),Be.jsx("li",{children:"Splitting into multiple missions"})]})]}),Be.jsx("p",{className:"text-xs text-gray-500 italic",children:"You can proceed, but ensure sufficient battery for the mission."})]}),Be.jsx("div",{className:"flex items-center justify-end gap-2 p-4 border-t bg-gray-50",children:Be.jsx("button",{onClick:t,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded text-sm transition-colors",children:"OK, Got It"})})]})})}const FB=3.28084,om=(e,t)=>t==="metric"?e:Number((e*FB).toFixed(2)),uv=(e,t)=>t==="metric"?e:e/FB;function cee({selectedWaypoints:e,selectedIds:t,settings:n,onUpdate:l,onDelete:c}){const[d,_]=Sr.useState({}),[w,a]=Sr.useState(!1);Sr.useEffect(()=>{if(e.length===0)return;const I=e[0],M=Z=>Z.straightenLegs!==void 0?Z.straightenLegs.toString():n.straightenLegs?"true":"false",N=Z=>Z.action?Z.action:n.waypointAction==="photo"?"photo":"none",j=M(I),W=N(I),B=Z=>e.every(ee=>ee[Z]===I[Z]),k=(Z,ee)=>e.every(se=>Z(se)===ee),z={lat:t.length===1?I.lat:"",lng:t.length===1?I.lng:"",altitude:B("altitude")?om(I.altitude,n.units):"",speed:B("speed")?om(I.speed,n.units):"",gimbalPitch:B("gimbalPitch")?I.gimbalPitch:"",heading:B("heading")?I.heading:"",straightenLegs:k(M,j)?j:"mixed",action:k(N,W)?W:"mixed"};_(z),a(!1)},[t,e,n]);const S=(I,M)=>{_(N=>({...N,[I]:M})),a(!0)},D=()=>{const I={};t.length===1&&(I.lat=Number(d.lat),I.lng=Number(d.lng)),d.altitude!==""&&(I.altitude=uv(Number(d.altitude),n.units)),d.speed!==""&&(I.speed=uv(Number(d.speed),n.units)),d.gimbalPitch!==""&&(I.gimbalPitch=Number(d.gimbalPitch)),d.heading!==""&&(I.heading=Number(d.heading)),d.straightenLegs!=="mixed"&&(I.straightenLegs=d.straightenLegs==="true"),d.action!=="mixed"&&(I.action=d.action),l(I),a(!1)},R=t.length===1;return Be.jsxs("div",{className:"p-4 bg-gray-50 h-full border-l w-80 flex flex-col shadow-xl z-10 overflow-y-auto",children:[Be.jsxs("h2",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[Be.jsx(xB,{size:20})," Edit Selected (",t.length,")"]}),R&&Be.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-4",children:[Be.jsxs("div",{children:[Be.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Lat"}),Be.jsx("input",{type:"number",className:"border p-2 rounded w-full text-xs",value:d.lat,onChange:I=>S("lat",I.target.value)})]}),Be.jsxs("div",{children:[Be.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Lng"}),Be.jsx("input",{type:"number",className:"border p-2 rounded w-full text-xs",value:d.lng,onChange:I=>S("lng",I.target.value)})]})]}),Be.jsxs("label",{className:"text-xs font-bold text-gray-500",children:["Altitude (",n.units==="metric"?"m":"ft",")"]}),Be.jsx("input",{type:"number",className:"border p-2 rounded w-full mb-4",placeholder:d.altitude===""?"Mixed":"",value:d.altitude,onChange:I=>S("altitude",I.target.value)}),Be.jsxs("label",{className:"text-xs font-bold text-gray-500",children:["Speed (",n.units==="metric"?"m/s":"ft/s",")"]}),Be.jsx("input",{type:"number",className:"border p-2 rounded w-full mb-4",placeholder:d.speed===""?"Mixed":"",value:d.speed,onChange:I=>S("speed",I.target.value)}),Be.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Gimbal Pitch ()"}),Be.jsx("input",{type:"number",className:"border p-2 rounded w-full mb-4",placeholder:d.gimbalPitch===""?"Mixed":"",value:d.gimbalPitch,onChange:I=>S("gimbalPitch",I.target.value)}),Be.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Heading ()"}),Be.jsx("input",{type:"number",className:"border p-2 rounded w-full mb-4",placeholder:d.heading===""?"Mixed":"",value:d.heading,onChange:I=>S("heading",I.target.value)}),Be.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Turn Mode"}),Be.jsxs("select",{className:"border p-2 rounded w-full mb-4 text-sm bg-white",value:d.straightenLegs,onChange:I=>S("straightenLegs",I.target.value),children:[Be.jsx("option",{value:"mixed",disabled:!0,hidden:!0,children:"Mixed"}),Be.jsx("option",{value:"false",children:"Curved (Continuous)"}),Be.jsx("option",{value:"true",children:"Straight (Stop & Turn)"})]}),Be.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Action"}),Be.jsxs("select",{className:"border p-2 rounded w-full mb-4 text-sm bg-white",value:d.action,onChange:I=>S("action",I.target.value),children:[Be.jsx("option",{value:"mixed",disabled:!0,hidden:!0,children:"Mixed"}),Be.jsx("option",{value:"none",children:"None"}),Be.jsx("option",{value:"photo",children:"Take Photo"}),Be.jsx("option",{value:"record_start",children:"Start Recording"}),Be.jsx("option",{value:"record_stop",children:"Stop Recording"})]}),Be.jsxs("div",{className:"mt-auto flex flex-col gap-2 pt-4",children:[Be.jsxs("button",{onClick:D,disabled:!w,className:`w-full p-3 rounded-lg shadow-md flex items-center justify-center gap-2 transition-all font-bold text-white ${w?"bg-blue-600 hover:bg-blue-700":"bg-gray-400 cursor-not-allowed"}`,children:[Be.jsx(C2,{size:18})," Update Point(s)"]}),Be.jsxs("button",{onClick:c,className:"w-full bg-red-100 hover:bg-red-200 text-red-600 p-2 rounded flex items-center justify-center gap-2 transition-colors font-medium",children:[Be.jsx(kS,{size:16})," Delete Selected"]})]})]})}const Qb=({title:e,icon:t,children:n,defaultOpen:l=!1})=>{const[c,d]=Sr.useState(l);return Be.jsxs("div",{className:"border-b border-gray-100 last:border-0",children:[Be.jsxs("button",{onClick:()=>d(!c),className:"w-full flex items-center justify-between p-3 hover:bg-gray-50 transition-colors",children:[Be.jsxs("div",{className:"flex items-center gap-2 font-semibold text-gray-700",children:[Be.jsx(t,{size:18,className:"text-blue-600"}),e]}),c?Be.jsx(_2,{size:16,className:"text-gray-400"}):Be.jsx(y2,{size:16,className:"text-gray-400"})]}),c&&Be.jsx("div",{className:"p-3 pt-0 space-y-4 animate-in slide-in-from-top-2 duration-200",children:n})]})};function hee({currentPolygon:e,setCurrentPolygon:t}){var Mt,ct,He;const{waypoints:n,selectedIds:l,settings:c,setWaypoints:d,updateSelectedWaypoints:_,deleteSelectedWaypoints:w,undo:a,redo:S,updateSettings:D,resetMission:R,fitMapToWaypoints:I,currentMissionFilename:M,setMissionFilename:N,calculatedMaxSpeed:j,minSegmentDistance:W}=Ii(),[B,k]=Sr.useState(!1),[z,Z]=Sr.useState(!1),[ee,se]=Sr.useState({warning:!1,critical:!1}),ue=()=>{confirm("Are you sure you want to reset the mission? This will clear all waypoints and shapes.")&&(R(),t(null))},Te=()=>{if(!e)return alert("Draw a shape first!");const _e=y3(e,c),qe=xf(c.selectedDrone),Pe=(qe==null?void 0:qe.photoInterval)||5.5,{maxSpeed:Le}=vB(_e,Pe),Pt={...c,speed:Le>0?Le:c.speed},lt=y3(e,Pt);d(lt),setTimeout(()=>{Ii.getState().calculateMissionMetrics()},50)},Q=async _e=>{const qe=_e.target.files[0];if(qe)try{const{geojson:Pe,sessionData:Le}=await aee(qe),Pt=[];if(Pe.features.forEach(lt=>{lt.geometry.type==="Point"&&Pt.push({id:crypto.randomUUID(),lng:lt.geometry.coordinates[0],lat:lt.geometry.coordinates[1],altitude:lt.properties.altitude!==void 0?lt.properties.altitude:c.altitude,speed:lt.properties.speed!==void 0?lt.properties.speed:c.speed,gimbalPitch:lt.properties.gimbalPitch!==void 0?lt.properties.gimbalPitch:c.gimbalPitch,heading:lt.properties.heading!==void 0?lt.properties.heading:0})}),Pt.length>0){d(Pt),Le?(Le.settings&&D(Le.settings),Le.polygon&&t&&(t(Le.polygon),window.dispatchEvent(new CustomEvent("waygen:restore-polygon",{detail:Le.polygon}))),alert(`Imported ${Pt.length} waypoints and restored session!`)):alert(`Imported ${Pt.length} waypoints!`);const lt=qe.name.replace(/\.(kmz|kml)$/i,"");N(lt),setTimeout(()=>{I(),Ii.getState().calculateMissionMetrics()},100)}else alert("No waypoints found in file.")}catch(Pe){console.error(Pe),alert("Failed to parse file. Ensure it is a valid KML/KMZ.")}},he=()=>M||`waygen_${new Date().toISOString().replace(/[-:]/g,"").replace(/\..+/,"").replace("T","_").substring(0,15)}`,ye=()=>{k(!0)},J=({filename:_e,missionEndAction:qe})=>{D({missionEndAction:qe}),U2(n,c,_e,{settings:c,polygon:e})},ie=_e=>{if(_e.length<2)return 0;let qe=0;for(let Pe=0;Pe<_e.length-1;Pe++){const Le=po([_e[Pe].lng,_e[Pe].lat]),Pt=po([_e[Pe+1].lng,_e[Pe+1].lat]);qe+=$i(Le,Pt,{units:"meters"})}return qe},q=_e=>{const qe=Math.floor(_e/60),Pe=_e%60;return`${qe}:${Pe.toString().padStart(2,"0")}`},Ke=(_e,qe)=>{if(qe==="metric")return _e>=1e3?`${(_e/1e3).toFixed(2)} km`:`${Math.round(_e)} m`;{const Pe=_e*3.28084;return Pe>=5280?`${(Pe/5280).toFixed(2)} mi`:`${Math.round(Pe)} ft`}};if(l.length>0){const _e=n.filter(qe=>l.includes(qe.id));return Be.jsx(cee,{selectedWaypoints:_e,selectedIds:l,settings:c,onUpdate:_,onDelete:w})}return Be.jsxs("div",{className:"bg-white h-full border-l w-80 flex flex-col shadow-xl z-10 flex-shrink-0",children:[Be.jsxs("div",{className:"p-4 border-b flex justify-between items-center bg-gray-50",children:[Be.jsxs("div",{children:[Be.jsx("h1",{className:"font-bold text-xl text-gray-800",children:"Waygen"}),M&&Be.jsx("div",{className:"text-sm text-gray-500 truncate max-w-[200px]",title:M,children:M})]}),Be.jsxs("div",{className:"flex gap-1",children:[Be.jsx("button",{onClick:ue,className:"p-2 hover:bg-red-100 hover:text-red-600 rounded-full shadow-sm border transition-all",title:"Reset Mission",children:Be.jsx(kS,{size:16})}),Be.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1 self-center"}),Be.jsx("button",{onClick:a,className:"p-2 hover:bg-white rounded-full shadow-sm border transition-all",children:Be.jsx(M2,{size:16})}),Be.jsx("button",{onClick:S,className:"p-2 hover:bg-white rounded-full shadow-sm border transition-all",children:Be.jsx(A2,{size:16})})]})]}),Be.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[Be.jsx("div",{className:"p-3",children:Be.jsxs("label",{className:"flex items-center justify-center gap-2 w-full p-2 bg-blue-50 text-blue-700 rounded-lg border border-blue-100 hover:bg-blue-100 transition-colors cursor-pointer font-medium text-sm",children:[Be.jsx(P2,{size:16})," Import KML/KMZ",Be.jsx("input",{type:"file",onChange:Q,className:"hidden",accept:".kml,.kmz"})]})}),Be.jsxs(Qb,{title:"Basics",icon:xB,defaultOpen:!0,children:[Be.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[Be.jsxs("div",{children:[Be.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Units"}),Be.jsxs("select",{value:c.units,onChange:_e=>D({units:_e.target.value}),className:"w-full border rounded p-1.5 text-sm bg-gray-50 focus:ring-2 focus:ring-blue-500 outline-none",children:[Be.jsx("option",{value:"metric",children:"Metric (m)"}),Be.jsx("option",{value:"imperial",children:"Imperial (ft)"})]})]}),Be.jsxs("div",{children:[Be.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Altitude (",c.units==="metric"?"m":"ft",")"]}),Be.jsx("input",{type:"number",value:om(c.altitude,c.units),onChange:_e=>D({altitude:uv(Number(_e.target.value),c.units)}),className:"w-full border rounded p-1.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none"})]})]}),Be.jsxs("div",{className:"mt-4 border-t pt-3",children:[Be.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Drone Model (FOV)"}),Be.jsxs("select",{value:c.selectedDrone,onChange:_e=>{const qe=_e.target.value;let Pe=82.1;qe==="dji_mini_5_pro"&&(Pe=84),qe==="dji_mavic_4_pro"&&(Pe=72),qe==="custom"&&(Pe=c.customFOV),D({selectedDrone:qe,customFOV:Pe})},className:"w-full border rounded p-1.5 text-sm bg-gray-50 focus:ring-2 focus:ring-blue-500 outline-none",children:[Be.jsx("option",{value:"dji_mini_4_pro",children:"DJI Mini 4 Pro (82.1)"}),Be.jsx("option",{value:"dji_mini_5_pro",children:"DJI Mini 5 Pro (84)"}),Be.jsx("option",{value:"dji_mavic_4_pro",children:"DJI Mavic 4 Pro (72)"}),Be.jsx("option",{value:"custom",children:"Custom"})]})]}),Be.jsxs("div",{className:"mt-2",children:[Be.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Photo Interval"}),Be.jsxs("div",{className:"text-sm text-gray-700 bg-gray-50 border rounded p-1.5",children:[((Mt=xf(c.selectedDrone))==null?void 0:Mt.photoInterval)||5.5," seconds"]})]}),c.selectedDrone==="custom"&&Be.jsxs("div",{className:"mt-2",children:[Be.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Custom HFOV ()"}),Be.jsx("input",{type:"number",value:c.customFOV,onChange:_e=>D({customFOV:Number(_e.target.value)}),className:"w-full border rounded p-1.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none"})]})]}),Be.jsxs(Qb,{title:"Coverage",icon:w2,defaultOpen:!0,children:[Be.jsxs("div",{className:"mb-3",children:[Be.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Path Type"}),Be.jsxs("div",{className:"flex bg-gray-100 p-1 rounded-lg",children:[Be.jsx("button",{onClick:()=>D({pathType:"grid"}),className:`flex-1 py-1 text-xs font-bold rounded-md transition-all ${c.pathType==="grid"?"bg-white shadow text-blue-600":"text-gray-500 hover:text-gray-700"}`,children:"Grid"}),Be.jsx("button",{onClick:()=>D({pathType:"orbit",spacing:10}),className:`flex-1 py-1 text-xs font-bold rounded-md transition-all ${c.pathType==="orbit"?"bg-white shadow text-blue-600":"text-gray-500 hover:text-gray-700"}`,children:"Orbit"})]})]}),c.pathType==="grid"?Be.jsxs(Be.Fragment,{children:[Be.jsxs("div",{children:[Be.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Side Overlap ",c.sideOverlap,"%"]}),Be.jsx("input",{type:"range",min:"0",max:"90",value:c.sideOverlap,onChange:_e=>D({sideOverlap:Number(_e.target.value)}),className:"w-full accent-blue-600"})]}),Be.jsxs("div",{children:[Be.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Front Overlap ",c.frontOverlap,"%"]}),Be.jsx("input",{type:"range",min:"0",max:"90",value:c.frontOverlap,onChange:_e=>D({frontOverlap:Number(_e.target.value)}),className:"w-full accent-blue-600"})]}),Be.jsxs("div",{className:"flex items-center justify-between mt-2",children:[Be.jsx("label",{className:"text-sm text-gray-700",children:"Auto Path Angle"}),Be.jsx("input",{type:"checkbox",checked:c.autoDirection,onChange:_e=>D({autoDirection:_e.target.checked}),className:"accent-blue-600 w-4 h-4"})]}),Be.jsxs("div",{className:`mt-2 transition-opacity ${c.autoDirection?"opacity-50":"opacity-100"}`,children:[Be.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Path Angle ",c.angle,""]}),Be.jsx("input",{type:"range",min:"0",max:"360",value:c.angle,onChange:_e=>D({angle:Number(_e.target.value)}),disabled:c.autoDirection,className:`w-full ${c.autoDirection?"accent-gray-400 cursor-not-allowed":"accent-blue-600"}`})]})]}):Be.jsx("div",{className:"space-y-3",children:Be.jsxs("div",{children:[Be.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Spacing (",c.units==="metric"?"m":"ft",")"]}),Be.jsx("input",{type:"number",min:"1",value:om(c.spacing,c.units),onChange:_e=>D({spacing:uv(Number(_e.target.value),c.units)}),className:"w-full border rounded p-1.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none"}),Be.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Distance between waypoints along the perimeter."})]})}),Be.jsxs("div",{className:"flex items-center justify-between mt-2",children:[Be.jsx("label",{className:"text-sm text-gray-700",children:"Reverse Path"}),Be.jsx("input",{type:"checkbox",checked:c.reversePath,onChange:_e=>D({reversePath:_e.target.checked}),className:"accent-blue-600 w-4 h-4"})]}),Be.jsxs("div",{className:"flex items-center justify-between mt-3",children:[Be.jsx("label",{className:"text-sm text-gray-700",children:"Straighten Legs"}),Be.jsx("input",{type:"checkbox",checked:c.straightenLegs,onChange:_e=>D({straightenLegs:_e.target.checked}),className:"accent-blue-600 w-4 h-4"})]}),Be.jsxs("div",{className:"flex items-center justify-between mt-3",children:[Be.jsx("label",{className:"text-sm text-gray-700",children:"Generate Every Point"}),Be.jsx("input",{type:"checkbox",checked:c.generateEveryPoint,onChange:_e=>D({generateEveryPoint:_e.target.checked}),className:"accent-blue-600 w-4 h-4"})]})]}),Be.jsxs(Qb,{title:"Camera",icon:g2,defaultOpen:!0,children:[Be.jsxs("div",{children:[Be.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Gimbal Pitch ",c.gimbalPitch,""]}),Be.jsx("input",{type:"range",min:"-90",max:"0",value:c.gimbalPitch,onChange:_e=>D({gimbalPitch:Number(_e.target.value)}),className:"w-full accent-blue-600"})]}),Be.jsxs("div",{className:"mt-2",children:[Be.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Action per Waypoint"}),Be.jsxs("select",{value:c.waypointAction,onChange:_e=>D({waypointAction:_e.target.value}),className:"w-full border rounded p-1.5 text-sm bg-gray-50 focus:ring-2 focus:ring-blue-500 outline-none",children:[Be.jsx("option",{value:"none",children:"No Action"}),Be.jsx("option",{value:"photo",children:"Take Photo"}),Be.jsx("option",{value:"record",children:"Start/Stop Recording"})]})]}),Be.jsxs("div",{className:"flex items-center justify-between mt-3",children:[Be.jsxs("div",{className:"flex items-center gap-2",children:[Be.jsx("label",{className:"text-sm text-gray-700",children:"Show Footprints"}),c.showFootprints&&Be.jsx("input",{type:"color",value:c.footprintColor,onChange:_e=>D({footprintColor:_e.target.value}),className:"w-4 h-4 rounded border border-gray-300 cursor-pointer",title:"Choose footprint color"})]}),Be.jsx("input",{type:"checkbox",checked:c.showFootprints,onChange:_e=>D({showFootprints:_e.target.checked}),className:"accent-blue-600 w-4 h-4"})]})]})]}),Be.jsxs("div",{className:"p-4 border-t bg-gray-50",children:[Be.jsxs("button",{onClick:Te,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold p-3 rounded-lg shadow-md mb-3 flex items-center justify-center gap-2 transition-all transform active:scale-95",children:[Be.jsx(T2,{size:18})," Generate Path"]}),Be.jsxs("div",{className:"flex flex-col gap-2",children:[Be.jsxs("div",{className:"bg-white border rounded p-2 text-center",children:[Be.jsx("div",{className:"text-xs text-gray-400 font-bold uppercase",children:"Waypoints"}),Be.jsx("div",{className:"font-bold text-gray-700",children:n.length})]}),Be.jsxs("div",{className:"bg-white border rounded p-2 text-center",children:[Be.jsx("div",{className:"text-xs text-gray-400 font-bold uppercase",children:"Distance"}),Be.jsx("div",{className:"font-bold text-gray-700",children:n.length>=2?Ke(ie(n),c.units):c.units==="metric"?"0 m":"0 ft"})]}),Be.jsxs("div",{className:"bg-white border rounded p-2 text-center",children:[Be.jsx("div",{className:"text-xs text-gray-400 font-bold uppercase",children:"Max Speed"}),Be.jsx("div",{className:"font-bold text-gray-700",title:`Based on ${Math.round(W)}m minimum segment`,children:n.length>=2&&j>0?`${om(j,c.units).toFixed(1)} ${c.units==="metric"?"m/s":"ft/s"}`:c.units==="metric"?"0 m/s":"0 ft/s"})]}),Be.jsxs("div",{className:`bg-white border rounded p-2 text-center ${(()=>{const _e=Ii.getState().getFlightWarningLevel();return _e==="critical"?"border-red-500 bg-red-50":_e==="warning"?"border-yellow-500 bg-yellow-50":""})()}`,children:[Be.jsx("div",{className:"text-xs text-gray-400 font-bold uppercase",children:"Est. Time"}),Be.jsx("div",{className:`font-bold ${(()=>{const _e=Ii.getState().getFlightWarningLevel();return _e==="critical"?"text-red-600":_e==="warning"?"text-yellow-700":"text-gray-700"})()}`,children:n.length>=2&&j>0?(()=>{const _e=Ii.getState().getMissionTime(),qe=Ii.getState().getFlightWarningLevel(),Pe=q(_e),Le=qe==="critical"?" ":qe==="warning"?" ":"";return qe!=="safe"&&!ee[qe]&&setTimeout(()=>{Z(!0),se(Pt=>({...Pt,[qe]:!0}))},500),Be.jsxs("span",{title:`${_e}s total`,children:[Pe,Le]})})():"0:00"})]})]}),Be.jsxs("button",{onClick:ye,disabled:n.length===0,className:"w-full mt-3 bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold p-3 rounded-lg shadow-md flex items-center justify-center gap-2 transition-all",children:[Be.jsx(x2,{size:18})," Download KMZ"]})]}),Be.jsx(lee,{isOpen:B,onClose:()=>k(!1),onDownload:J,defaultFilename:he(),defaultMissionEndAction:c.missionEndAction}),Be.jsx(uee,{isOpen:z,onClose:()=>Z(!1),warningLevel:Ii.getState().getFlightWarningLevel(),missionTime:n.length>=2?q(Ii.getState().getMissionTime()):"0:00",droneName:((ct=xf(c.selectedDrone))==null?void 0:ct.name)||"Unknown Drone",maxFlightTime:((He=xf(c.selectedDrone))==null?void 0:He.maxFlightTime)||0})]})}function fee({map:e}){const t=Sr.useRef(null);return Sr.useEffect(()=>{if(!e||!t.current||document.querySelector(".mapboxgl-ctrl-geocoder"))return;const n=new bz({accessToken:mapboxgl.accessToken,mapboxgl,marker:!1,collapsed:!0});t.current.appendChild(n.onAdd(e))},[e]),Be.jsx("div",{ref:t,className:"absolute top-4 right-4 z-10"})}function dee(){const[e,t]=Sr.useState(null),[n,l]=Sr.useState(!0);return FE.useEffect(()=>{const c=setTimeout(()=>l(!1),1e3);return()=>clearTimeout(c)},[]),n?Be.jsx("div",{className:"flex h-screen w-screen items-center justify-center bg-gray-50",children:Be.jsx("div",{className:"text-2xl font-bold text-blue-600 animate-pulse",children:"Waygen Loading..."})}):Be.jsxs("div",{className:"flex h-screen w-screen overflow-hidden",children:[Be.jsxs("div",{className:"relative flex-grow",children:[Be.jsx(fee,{}),Be.jsx(z2,{onPolygonDrawn:t})]}),Be.jsx(hee,{currentPolygon:e,setCurrentPolygon:t})]})}ew.createRoot(document.getElementById("root")).render(Be.jsx(FE.StrictMode,{children:Be.jsx(dee,{})}));
