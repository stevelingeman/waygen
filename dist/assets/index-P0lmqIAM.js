const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SearchBar-digllvNs.js","assets/vendor-DRMOV0oM.js","assets/mapbox-C3udIXGP.js","assets/turf-D8sFHwPo.js","assets/utils-P9aiU5u9.js","assets/mapbox-gl-geocoder-BCYwfNyN.css","assets/MapContainer-NRjVbHyG.js","assets/MapContainer-jpWXR4Z0.css"])))=>i.map(i=>d[i]);
import{r as C,a as tt,c as nt,X as De,b as st,A as ot,S as Fe,d as it,T as Le,U as at,R as rt,e as lt,M as ct,C as dt,P as ut,D as mt,f as pt,g as gt,h as le}from"./vendor-DRMOV0oM.js";import{p as W,d as ee,a as ht,b as te,c as oe,e as Ie,t as ve,f as ft,l as je,g as xt,h as Ne,i as Se,j as bt,m as Pe}from"./turf-D8sFHwPo.js";import{J as Ce,F as wt}from"./utils-P9aiU5u9.js";import"./mapbox-C3udIXGP.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function o(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(t){if(t.ep)return;t.ep=!0;const a=o(t);fetch(t.href,a)}})();var Oe={exports:{}},ce={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yt=C,vt=Symbol.for("react.element"),jt=Symbol.for("react.fragment"),Nt=Object.prototype.hasOwnProperty,St=yt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Pt={key:!0,ref:!0,__self:!0,__source:!0};function Re(e,n,o){var i,t={},a=null,r=null;o!==void 0&&(a=""+o),n.key!==void 0&&(a=""+n.key),n.ref!==void 0&&(r=n.ref);for(i in n)Nt.call(n,i)&&!Pt.hasOwnProperty(i)&&(t[i]=n[i]);if(e&&e.defaultProps)for(i in n=e.defaultProps,n)t[i]===void 0&&(t[i]=n[i]);return{$$typeof:vt,type:e,key:a,ref:r,props:t,_owner:St.current}}ce.Fragment=jt;ce.jsx=Re;ce.jsxs=Re;Oe.exports=ce;var s=Oe.exports,pe={},Me=tt;pe.createRoot=Me.createRoot,pe.hydrateRoot=Me.hydrateRoot;const Mt="modulepreload",Tt=function(e){return"/"+e},Te={},$e=function(n,o,i){let t=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),c=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));t=Promise.allSettled(o.map(u=>{if(u=Tt(u),u in Te)return;Te[u]=!0;const m=u.endsWith(".css"),p=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${p}`))return;const h=document.createElement("link");if(h.rel=m?"stylesheet":Mt,m||(h.as="script"),h.crossOrigin="",h.href=u,c&&h.setAttribute("nonce",c),document.head.appendChild(h),m)return new Promise((d,g)=>{h.addEventListener("load",d),h.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${u}`)))})}))}function a(r){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=r,window.dispatchEvent(c),!c.defaultPrevented)throw r}return t.then(r=>{for(const c of r||[])c.status==="rejected"&&a(c.reason);return n().catch(a)})},kt=.85,Et=5.5,ke=0,Z={"mini-4-pro":{name:"DJI Mini 4 Pro",hfov:82.1,photoInterval:5.5,maxFlightTime:31},"mini-5-pro":{name:"DJI Mini 5 Pro",hfov:84,photoInterval:5.5,maxFlightTime:40,isDefault:!0},"mavic-4-pro":{name:"DJI Mavic 4 Pro",hfov:72,photoInterval:5.5,maxFlightTime:40},custom:{name:"Custom",hfov:null,photoInterval:5.5,maxFlightTime:null}},At=()=>Object.keys(Z).find(e=>Z[e].isDefault)||Object.keys(Z)[0],ne=e=>{const n=fe(e);return Z[n]||null},Dt=()=>Object.keys(Z),fe=e=>({dji_mini_4_pro:"mini-4-pro",dji_mini_5_pro:"mini-5-pro",dji_mavic_4_pro:"mavic-4-pro",custom:"custom"})[e]||e,hn=(e,n,o,i)=>{if(!e||!n||!i)return null;const t=2*n*Math.tan(i*Math.PI/360),a=t*(3/4),r=t/2,c=a/2,u=Math.sqrt(r*r+c*c),m=Math.atan2(r,c)*180/Math.PI,p=180-m,h=180+m,d=360-m,g=W([e.lng,e.lat]),j=ee(g,u/1e3,o+m,{units:"kilometers"}),x=ee(g,u/1e3,o+p,{units:"kilometers"}),v=ee(g,u/1e3,o+h,{units:"kilometers"}),N=ee(g,u/1e3,o+d,{units:"kilometers"}),F=[[j.geometry.coordinates,x.geometry.coordinates,v.geometry.coordinates,N.geometry.coordinates,j.geometry.coordinates]];return ht(F,{altitude:n,heading:o,hfov:i})},_e=(e,n)=>{const o=W([e.lng,e.lat]),i=W([n.lng,n.lat]);return te(o,i,{units:"meters"})},We=(e,n)=>{if(!e||e.length<2||!n||n<=0)return{maxSpeed:0,minDistance:0};const o=[];for(let a=0;a<e.length-1;a++){const r=_e(e[a],e[a+1]);o.push(r)}const i=Math.min(...o),t=i/n;return{maxSpeed:Math.max(0,t),minDistance:i}},Ft=(e,n)=>{if(!n||n<=0)return ke;const i=e/n+ke;return Math.round(i)},Lt=(e,n)=>{if(!n||n<=0)return"safe";const o=n*60,i=o*kt;return e>=o?"critical":e>=i?"warning":"safe"};function de(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const n=Math.random()*16|0;return(e==="x"?n:n&3|8).toString(16)})}const K=nt((e,n)=>({waypoints:[],selectedIds:[],mapRef:null,currentMissionFilename:null,calculatedMaxSpeed:0,minSegmentDistance:0,past:[],future:[],settings:(()=>{const o=At(),i=fe(o),t=Z[i];return{altitude:60,speed:10,gimbalPitch:-90,customFOV:(t==null?void 0:t.hfov)||82.1,showFootprints:!1,footprintColor:"#22c55e",sideOverlap:80,frontOverlap:80,pathType:"grid",angle:0,autoDirection:!1,generateEveryPoint:!1,reversePath:!1,waypointAction:"none",photoInterval:(t==null?void 0:t.photoInterval)||Et,selectedDrone:o,straightenLegs:!1,units:"metric",orbitRadius:50,startAngle:0,direction:"counter-clockwise",numberOfOrbits:1,missionEndAction:"goHome"}})(),setWaypoints:o=>e(i=>({waypoints:o,past:[...i.past,i.waypoints],future:[]})),addWaypoint:o=>e(i=>{let t=i.settings.speed,a=0;if(i.waypoints.length>0){const u=i.waypoints[i.waypoints.length-1];t=Math.round((u.speed||i.settings.speed)*10)/10,a=u.heading||0}const r={id:de(),...o,altitude:i.settings.altitude,speed:t,gimbalPitch:i.settings.gimbalPitch,heading:a},c=[...i.waypoints];if(c.length>0){const u=c.length-1,m=c[u],p=Math.round(oe([m.lng,m.lat],[r.lng,r.lat]));c[u]={...m,heading:p},r.heading=p}return{waypoints:[...c,r],past:[...i.past,i.waypoints],future:[]}}),updateSettings:o=>e(i=>({settings:{...i.settings,...o}})),selectWaypoint:(o,i)=>e(t=>({selectedIds:i?t.selectedIds.includes(o)?t.selectedIds.filter(a=>a!==o):[...t.selectedIds,o]:[o]})),setSelectedIds:o=>e({selectedIds:o}),clearSelection:()=>e({selectedIds:[]}),updateSelectedWaypoints:o=>{const{waypoints:i,selectedIds:t,past:a}=n(),r=i.map(c=>t.includes(c.id)?{...c,...o}:c);e({waypoints:r,past:[...a,i],future:[]})},updateWaypoint:(o,i)=>{const{waypoints:t,past:a}=n(),r=t.map(c=>c.id===o?{...c,...i}:c);e({waypoints:r,past:[...a,t],future:[]})},deleteSelectedWaypoints:()=>{const{waypoints:o,selectedIds:i,past:t}=n(),a=o.filter(r=>!i.includes(r.id));e({waypoints:a,selectedIds:[],past:[...t,o],future:[]})},moveWaypoints:(o,i,t)=>{const{waypoints:a,past:r}=n(),c=a.map(u=>o.includes(u.id)?{...u,lng:u.lng+i,lat:u.lat+t}:u);e({waypoints:c,past:[...r,a],future:[]})},undo:()=>{const{past:o,future:i,waypoints:t}=n();if(o.length===0)return;const a=o[o.length-1],r=o.slice(0,o.length-1);e({waypoints:a,past:r,future:[t,...i]})},redo:()=>{const{past:o,future:i,waypoints:t}=n();if(i.length===0)return;const a=i[0],r=i.slice(1);e({waypoints:a,past:[...o,t],future:r})},setMapRef:o=>e({mapRef:o}),fitMapToWaypoints:()=>{const{mapRef:o,waypoints:i}=n();if(!o||!i||i.length===0)return;let t=i[0].lng,a=i[0].lng,r=i[0].lat,c=i[0].lat;i.forEach(m=>{m.lng<t&&(t=m.lng),m.lng>a&&(a=m.lng),m.lat<r&&(r=m.lat),m.lat>c&&(c=m.lat)});const u=[[t,r],[a,c]];o.fitBounds(u,{padding:{top:100,bottom:100,left:200,right:350},maxZoom:16,duration:3e3})},setMissionFilename:o=>e({currentMissionFilename:o}),clearMissionFilename:()=>e({currentMissionFilename:null}),calculateMissionMetrics:()=>{const{waypoints:o,settings:i}=n(),t=i.photoInterval,{maxSpeed:a,minDistance:r}=We(o,t);e({calculatedMaxSpeed:a,minSegmentDistance:r})},getTotalDistance:()=>{const{waypoints:o}=n();if(o.length<2)return 0;let i=0;for(let t=0;t<o.length-1;t++)i+=_e(o[t],o[t+1]);return i},getMissionTime:()=>{const{calculatedMaxSpeed:o}=n(),i=n().getTotalDistance();return Ft(i,o)},getFlightWarningLevel:()=>{const{settings:o}=n(),i=n().getMissionTime(),t=ne(o.selectedDrone),a=(t==null?void 0:t.maxFlightTime)||null;return Lt(i,a)},resetTrigger:0,resetMission:()=>e(o=>({waypoints:[],selectedIds:[],past:[],future:[],currentMissionFilename:null,calculatedMaxSpeed:0,minSegmentDistance:0,resetTrigger:o.resetTrigger+1}))}));function It(e,n){const{altitude:o,speed:i,gimbalPitch:t,spacing:a,straightenLegs:r,waypointAction:c,startAngle:u,direction:m,numberOfOrbits:p}=n,h=Ie(e);h.geometry.coordinates;const d=e.geometry.coordinates[0];let g=0;d.forEach(M=>{g+=te(h,W(M),{units:"meters"})});const j=g/d.length,x=Math.max(.1,p),v=2*Math.PI*j,N=Math.max(3,Math.round(v/a)),F=Math.round(N*x),L=[],P=(90-u+360)%360,I=360*x;for(let M=0;M<=F;M++){let H=M/F*I,_;m==="clockwise"?_=(P-H+360*100)%360:_=(P+H+360)%360;const b=ee(h,j/1e3,_,{units:"kilometers"}),R=Math.round(oe(b,h));L.push({id:de(),lng:b.geometry.coordinates[0],lat:b.geometry.coordinates[1],altitude:Number(o),speed:Math.round(Number(i)*10)/10,gimbalPitch:Number(t),heading:R,straightenLegs:r,action:c})}return L}function Ee(e,n){if(n.pathType==="orbit")return It(e,n);const{altitude:o,sideOverlap:i,frontOverlap:t,angle:a,gimbalPitch:r,autoDirection:c,generateEveryPoint:u,reversePath:m,speed:p,straightenLegs:h,waypointAction:d}=n,g=n.customFOV||82.1,j=Math.tan(g/2*(Math.PI/180)),x=o*j*2,N=x*(1-i/100)/111111,F=Ie(e);let L=a;if(c){let f=0,O=0;const D=e.geometry.coordinates[0];for(let T=0;T<D.length-1;T++){const k=W(D[T]),U=W(D[T+1]),l=te(k,U);l>f&&(f=l,O=oe(k,U))}L=O}const P=-L,I=ve(e,P,{pivot:F}),M=ft(I),H=[];let _=M[1]+N/2;for(;_<=M[3]+N/10;){const f=je([[M[0]-.1,_],[M[2]+.1,_]]),O=xt(f,I),D=T=>{const k=T.geometry.coordinates;return Array.isArray(k[0][0])?Pe(k[0][0],k[0][k[0].length-1]):Pe(k[0],k[k.length-1])};if(O.features.length===0){const T=D(f);Ne(T,I)&&H.push(f.geometry.coordinates)}else O.features.forEach(T=>{const k=D(T);Ne(k,I)&&H.push(T.geometry.coordinates)});_+=N}let b=[];if(H.forEach((f,O)=>{let D=O%2===1?f.reverse():f;if(u){const T=W(D[0]),k=W(D[1]),U=te(T,k,{units:"meters"}),w=x*(3/4)*(1-t/100),y=Math.max(1,w),S=Math.floor(U/y);if(S>=1){const E=je(D),A=[];for(let G=0;G<=S;G++){Se(E,G*y/1e3,{units:"kilometers"});const ue=Se(E,G*y,{units:"meters"});A.push(ue.geometry.coordinates)}D=A}}D.forEach((T,k)=>{const U=k===D.length-1;b.push({id:de(),lng:T[0],lat:T[1],altitude:Number(o),speed:Math.round(Number(p)*10)/10,gimbalPitch:Number(r),heading:0,straightenLegs:h,action:d,_isRowEnd:U,_isRowStart:k===0})})}),b.length===0)return[];const R=bt(b.map(f=>[f.lng,f.lat]));ve(R,L,{pivot:F}).features.forEach((f,O)=>{b[O].lng=f.geometry.coordinates[0],b[O].lat=f.geometry.coordinates[1]}),m&&b.reverse();for(let f=0;f<b.length;f++){if((m?b[f]._isRowStart:b[f]._isRowEnd)&&f>0)b[f].heading=b[f-1].heading;else if(f<b.length-1){const D=W([b[f].lng,b[f].lat]),T=W([b[f+1].lng,b[f+1].lat]);b[f].heading=Math.round(oe(D,T))}else f>0&&(b[f].heading=b[f-1].heading);delete b[f]._isRowEnd,delete b[f]._isRowStart}return b}const Ct=async(e,n,o="MiniMission",i=null)=>{const t=new Ce,a=Date.now(),{speed:r,straightenLegs:c,waypointAction:u,gimbalPitch:m,missionEndAction:p}=n,h=`<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://www.opengis.net/kml/2.2" xmlns:wpml="http://www.dji.com/wpmz/1.0.2">
  <Document>
    <wpml:createTime>${a}</wpml:createTime>
    <wpml:updateTime>${a}</wpml:updateTime>
    <wpml:missionConfig>
      <wpml:flyToWaylineMode>safely</wpml:flyToWaylineMode>
      <wpml:finishAction>${p}</wpml:finishAction>
      <wpml:exitOnRCLost>executeLostAction</wpml:exitOnRCLost>
      <wpml:executeRCLostAction>hover</wpml:executeRCLostAction>
      <wpml:globalTransitionalSpeed>${r}</wpml:globalTransitionalSpeed>
      <wpml:droneInfo>
        <wpml:droneEnumValue>68</wpml:droneEnumValue>
        <wpml:droneSubEnumValue>0</wpml:droneSubEnumValue>
      </wpml:droneInfo>
    </wpml:missionConfig>
    <wpml:templateId>0</wpml:templateId>
  </Document>
</kml>`;let d="";e.forEach((v,N)=>{const F=N===0,L=N===e.length-1,P=N+1,I=v.straightenLegs!==void 0?v.straightenLegs:c,M=v.action!==void 0?v.action:u,H=v.gimbalPitch!==void 0?v.gimbalPitch:m,_=v.speed!==void 0?v.speed:r;let b="",R=0;const q=N>0?e[N-1]:null,f=q?q.gimbalPitch!==void 0?q.gimbalPitch:m:null;(F||f!==null&&H!==f)&&(b+=`
        <wpml:action>
          <wpml:actionId>${R++}</wpml:actionId>
          <wpml:actionActuatorFunc>gimbalRotate</wpml:actionActuatorFunc>
          <wpml:actionActuatorFuncParam>
            <wpml:gimbalHeadingYawBase>aircraft</wpml:gimbalHeadingYawBase>
            <wpml:gimbalRotateMode>absoluteAngle</wpml:gimbalRotateMode>
            <wpml:gimbalPitchRotateEnable>1</wpml:gimbalPitchRotateEnable>
            <wpml:gimbalPitchRotateAngle>${H}</wpml:gimbalPitchRotateAngle>
            <wpml:gimbalRollRotateEnable>0</wpml:gimbalRollRotateEnable>
            <wpml:gimbalYawRotateEnable>0</wpml:gimbalYawRotateEnable>
            <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
          </wpml:actionActuatorFuncParam>
        </wpml:action>`),M==="photo"?b+=`
        <wpml:action>
          <wpml:actionId>${R++}</wpml:actionId>
          <wpml:actionActuatorFunc>takePhoto</wpml:actionActuatorFunc>
          <wpml:actionActuatorFuncParam>
            <wpml:fileSuffix>point${N}</wpml:fileSuffix>
            <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
          </wpml:actionActuatorFuncParam>
        </wpml:action>`:M==="record_start"?b+=`
          <wpml:action>
            <wpml:actionId>${R++}</wpml:actionId>
            <wpml:actionActuatorFunc>startRecord</wpml:actionActuatorFunc>
            <wpml:actionActuatorFuncParam>
              <wpml:fileSuffix>mission</wpml:fileSuffix>
              <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
            </wpml:actionActuatorFuncParam>
          </wpml:action>`:M==="record_stop"?b+=`
          <wpml:action>
            <wpml:actionId>${R++}</wpml:actionId>
            <wpml:actionActuatorFunc>stopRecord</wpml:actionActuatorFunc>
            <wpml:actionActuatorFuncParam>
              <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
            </wpml:actionActuatorFuncParam>
          </wpml:action>`:M==="record"&&(F?b+=`
            <wpml:action>
              <wpml:actionId>${R++}</wpml:actionId>
              <wpml:actionActuatorFunc>startRecord</wpml:actionActuatorFunc>
              <wpml:actionActuatorFuncParam>
                <wpml:fileSuffix>mission</wpml:fileSuffix>
                <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
              </wpml:actionActuatorFuncParam>
            </wpml:action>`:L&&(b+=`
            <wpml:action>
              <wpml:actionId>${R++}</wpml:actionId>
              <wpml:actionActuatorFunc>stopRecord</wpml:actionActuatorFunc>
              <wpml:actionActuatorFuncParam>
                <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
              </wpml:actionActuatorFuncParam>
            </wpml:action>`));const O=R>0?`
      <wpml:actionGroup>
        <wpml:actionGroupId>${P}</wpml:actionGroupId>
        <wpml:actionGroupStartIndex>${N}</wpml:actionGroupStartIndex>
        <wpml:actionGroupEndIndex>${N}</wpml:actionGroupEndIndex>
        <wpml:actionGroupMode>sequence</wpml:actionGroupMode>
        <wpml:actionTrigger>
          <wpml:actionTriggerType>reachPoint</wpml:actionTriggerType>
        </wpml:actionTrigger>
        ${b}
      </wpml:actionGroup>`:"";d+=`
    <Placemark>
      <Point><coordinates>${v.lng},${v.lat},0</coordinates></Point>
      <wpml:index>${N}</wpml:index>
      <wpml:executeHeight>${v.altitude}</wpml:executeHeight>
      <wpml:waypointSpeed>${_}</wpml:waypointSpeed>
      <wpml:waypointHeadingParam>
        <wpml:waypointHeadingMode>smoothTransition</wpml:waypointHeadingMode>
        <wpml:waypointHeadingAngle>${v.heading}</wpml:waypointHeadingAngle>
        <wpml:waypointHeadingAngleEnable>0</wpml:waypointHeadingAngleEnable>
        <wpml:waypointHeadingPathMode>followBadArc</wpml:waypointHeadingPathMode>
      </wpml:waypointHeadingParam>
      <wpml:useStraightLine>${I?1:0}</wpml:useStraightLine>
      ${O}
    </Placemark>`});const g=`<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://www.opengis.net/kml/2.2" xmlns:wpml="http://www.dji.com/wpmz/1.0.2">
  <Document>
    <wpml:missionConfig>
      <wpml:flyToWaylineMode>safely</wpml:flyToWaylineMode>
      <wpml:finishAction>${p}</wpml:finishAction>
      <wpml:exitOnRCLost>executeLostAction</wpml:exitOnRCLost>
      <wpml:executeRCLostAction>hover</wpml:executeRCLostAction>
      <wpml:globalTransitionalSpeed>${r}</wpml:globalTransitionalSpeed>
      <wpml:droneInfo>
        <wpml:droneEnumValue>68</wpml:droneEnumValue>
        <wpml:droneSubEnumValue>0</wpml:droneSubEnumValue>
      </wpml:droneInfo>
    </wpml:missionConfig>
    <Folder>
      <wpml:templateId>0</wpml:templateId>
      <wpml:executeHeightMode>relativeToStartPoint</wpml:executeHeightMode>
      <wpml:waylineId>0</wpml:waylineId>
      <wpml:autoFlightSpeed>${r}</wpml:autoFlightSpeed>
      ${d}
    </Folder>
  </Document>
</kml>`,j=t.folder("wpmz");j.file("template.kml",h),j.file("waylines.wpml",g),i&&t.file("waygen_session.json",JSON.stringify(i,null,2));const x=await t.generateAsync({type:"blob"});wt.saveAs(x,`${o}.kmz`)};function B(e,n){return Array.from(e.getElementsByTagName(n))}function ie(e){return e[0]==="#"?e:`#${e}`}function Ot(e,n,o){return Array.from(e.getElementsByTagNameNS(o,n))}function $(e){return e==null||e.normalize(),e&&e.textContent||""}function V(e,n,o){const i=e.getElementsByTagName(n);return i.length?i[0]:null}function z(e,n,o){const i={};if(!e)return i;const t=e.getElementsByTagName(n),a=t.length?t[0]:null;return a&&o?o(a,i):i}function Q(e,n,o){const i=$(V(e,n));return i&&o?o(i)||{}:{}}function X(e,n,o){const i=parseFloat($(V(e,n)));if(!isNaN(i))return o&&o(i),i}function He(e,n){const o={};for(const i of n)Q(e,i,t=>{o[i]=t});return o}function ze(e){return(e==null?void 0:e.nodeType)===1}function Ge(e,n){const o={},i=n=="stroke"||n==="fill"?n:n+"-color";return e[0]==="#"&&(e=e.substring(1)),e.length===6||e.length===3?o[i]="#"+e:e.length===8&&(o[n+"-opacity"]=parseInt(e.substring(0,2),16)/255,o[i]="#"+e.substring(6,8)+e.substring(4,6)+e.substring(2,4)),o}function ae(e,n,o){const i={};return X(e,n,t=>{i[o]=t}),i}function xe(e,n){return z(e,"color",o=>Ge($(o),n))}function Be(e){return z(e,"Icon",(n,o)=>(Q(n,"href",i=>{o.icon=i}),o))}function Rt(e){return z(e,"IconStyle",n=>Object.assign(xe(n,"icon"),ae(n,"scale","icon-scale"),ae(n,"heading","icon-heading"),z(n,"hotSpot",o=>{const i=parseFloat(o.getAttribute("x")||""),t=parseFloat(o.getAttribute("y")||""),a=o.getAttribute("xunits")||"",r=o.getAttribute("yunits")||"";return!isNaN(i)&&!isNaN(t)?{"icon-offset":[i,t],"icon-offset-units":[a,r]}:{}}),Be(n)))}function $t(e){return z(e,"LabelStyle",n=>Object.assign(xe(n,"label"),ae(n,"scale","label-scale")))}function _t(e){return z(e,"LineStyle",n=>Object.assign(xe(n,"stroke"),ae(n,"width","stroke-width")))}function Wt(e){return z(e,"PolyStyle",(n,o)=>Object.assign(o,z(n,"color",i=>Ge($(i),"fill")),Q(n,"fill",i=>{if(i==="0")return{"fill-opacity":0}}),Q(n,"outline",i=>{if(i==="0")return{"stroke-opacity":0}})))}function be(e){return Object.assign({},Wt(e),_t(e),$t(e),Rt(e))}const Y=e=>Number(e),ge={string:e=>e,int:Y,uint:Y,short:Y,ushort:Y,float:Y,double:Y,bool:e=>!!e};function Ve(e,n){return z(e,"ExtendedData",(o,i)=>{for(const t of B(o,"Data"))i[t.getAttribute("name")||""]=$(V(t,"value"));for(const t of B(o,"SimpleData")){const a=t.getAttribute("name")||"",r=n[a]||ge.string;i[a]=r($(t))}return i})}function Ue(e){const n=V(e,"description");for(const o of Array.from((n==null?void 0:n.childNodes)||[]))if(o.nodeType===4)return{description:{"@type":"html",value:$(o)}};return{}}function Ke(e){return z(e,"TimeSpan",n=>({timespan:{begin:$(V(n,"begin")),end:$(V(n,"end"))}}))}function Ze(e){return z(e,"TimeStamp",n=>({timestamp:$(V(n,"when"))}))}function Je(e,n){return Q(e,"styleUrl",o=>(o=ie(o),n[o]?Object.assign({styleUrl:o},n[o]):{styleUrl:o}))}const Ht=/\s*/g,zt=/^\s*|\s*$/g,Gt=/\s+/;function qe(e){return e.replace(Ht,"").split(",").map(parseFloat).filter(n=>!isNaN(n)).slice(0,3)}function he(e){return e.replace(zt,"").split(Gt).map(qe).filter(n=>n.length>=2)}function Bt(e){let n=B(e,"coord");n.length===0&&(n=Ot(e,"coord","*"));const o=n.map(i=>$(i).split(" ").map(parseFloat));return o.length===0?null:{geometry:o.length>2?{type:"LineString",coordinates:o}:{type:"Point",coordinates:o[0]},times:B(e,"when").map(i=>$(i))}}function Ye(e){if(e.length===0)return e;const n=e[0],o=e[e.length-1];let i=!0;for(let t=0;t<Math.max(n.length,o.length);t++)if(n[t]!==o[t]){i=!1;break}return i?e:e.concat([e[0]])}function se(e){return $(V(e,"coordinates"))}function Xe(e){let n=[],o=[];for(let i=0;i<e.childNodes.length;i++){const t=e.childNodes.item(i);if(ze(t))switch(t.tagName){case"MultiGeometry":case"MultiTrack":case"gx:MultiTrack":{const a=Xe(t);n=n.concat(a.geometries),o=o.concat(a.coordTimes);break}case"Point":{const a=qe(se(t));a.length>=2&&n.push({type:"Point",coordinates:a});break}case"LinearRing":case"LineString":{const a=he(se(t));a.length>=2&&n.push({type:"LineString",coordinates:a});break}case"Polygon":{const a=[];for(const r of B(t,"LinearRing")){const c=Ye(he(se(r)));c.length>=4&&a.push(c)}a.length&&n.push({type:"Polygon",coordinates:a});break}case"Track":case"gx:Track":{const a=Bt(t);if(!a)break;const{times:r,geometry:c}=a;n.push(c),r.length&&o.push(r);break}}}return{geometries:n,coordTimes:o}}function Vt(e){return e.length===0?null:e.length===1?e[0]:{type:"GeometryCollection",geometries:e}}function Ut(e,n,o,i){var m;const{coordTimes:t,geometries:a}=Xe(e),r=Vt(a);if(!r&&i.skipNullGeometry)return null;const c={type:"Feature",geometry:r,properties:Object.assign(He(e,["name","address","visibility","open","phoneNumber","description"]),Ue(e),Je(e,n),be(e),Ve(e,o),Ke(e),Ze(e),t.length?{coordinateProperties:{times:t.length===1?t[0]:t}}:{})};((m=c.properties)==null?void 0:m.visibility)!==void 0&&(c.properties.visibility=c.properties.visibility!=="0");const u=e.getAttribute("id");return u!==null&&u!==""&&(c.id=u),c}function Kt(e){return V(e,"gx:LatLonQuad")?{geometry:{type:"Polygon",coordinates:[Ye(he(se(e)))]}}:qt(e)}const Zt=Math.PI/180;function Jt(e,n,o){const i=[(e[0]+e[2])/2,(e[1]+e[3])/2];return[n[0].map(t=>{const a=t[1]-i[1],r=t[0]-i[0],c=Math.sqrt(Math.pow(a,2)+Math.pow(r,2)),u=Math.atan2(a,r)+o*Zt;return[i[0]+Math.cos(u)*c,i[1]+Math.sin(u)*c]})]}function qt(e){const n=V(e,"LatLonBox");if(n){const o=X(n,"north"),i=X(n,"west"),t=X(n,"east"),a=X(n,"south"),r=X(n,"rotation");if(typeof o=="number"&&typeof a=="number"&&typeof i=="number"&&typeof t=="number"){const c=[i,a,t,o];let u=[[[i,o],[t,o],[t,a],[i,a],[i,o]]];return typeof r=="number"&&(u=Jt(c,u,r)),{bbox:c,geometry:{type:"Polygon",coordinates:u}}}}return null}function Yt(e,n,o,i){var u;const t=Kt(e),a=(t==null?void 0:t.geometry)||null;if(!a&&i.skipNullGeometry)return null;const r={type:"Feature",geometry:a,properties:Object.assign({"@geometry-type":"groundoverlay"},He(e,["name","address","visibility","open","phoneNumber","description"]),Ue(e),Je(e,n),be(e),Be(e),Ve(e,o),Ke(e),Ze(e))};t!=null&&t.bbox&&(r.bbox=t.bbox),((u=r.properties)==null?void 0:u.visibility)!==void 0&&(r.properties.visibility=r.properties.visibility!=="0");const c=e.getAttribute("id");return c!==null&&c!==""&&(r.id=c),r}function Xt(e){let n=e.getAttribute("id");const o=e.parentNode;return!n&&ze(o)&&o.localName==="CascadingStyle"&&(n=o.getAttribute("kml:id")||o.getAttribute("id")),ie(n||"")}function Qt(e){const n={};for(const o of B(e,"Style"))n[Xt(o)]=be(o);for(const o of B(e,"StyleMap")){const i=ie(o.getAttribute("id")||"");Q(o,"styleUrl",t=>{t=ie(t),n[t]&&(n[i]=n[t])})}return n}function en(e){const n={};for(const o of B(e,"SimpleField"))n[o.getAttribute("name")||""]=ge[o.getAttribute("type")||""]||ge.string;return n}function*tn(e,n={skipNullGeometry:!1}){const o=Qt(e),i=en(e);for(const t of B(e,"Placemark")){const a=Ut(t,o,i,n);a&&(yield a)}for(const t of B(e,"GroundOverlay")){const a=Yt(t,o,i,n);a&&(yield a)}}function Ae(e,n={skipNullGeometry:!1}){return{type:"FeatureCollection",features:Array.from(tn(e,n))}}const nn=async e=>{if(e.name.toLowerCase().endsWith(".kml")){const n=await e.text(),o=new DOMParser().parseFromString(n,"text/xml");return{geojson:Ae(o),sessionData:null}}if(e.name.toLowerCase().endsWith(".kmz"))try{const n=await Ce.loadAsync(e);let o=Object.keys(n.files).find(i=>i.toLowerCase().endsWith("waylines.wpml"));if(o||(o=Object.keys(n.files).find(i=>i.toLowerCase().endsWith(".kml"))),o){const i=await n.file(o).async("text"),t=new DOMParser().parseFromString(i,"text/xml"),a=Ae(t),r=Array.from(t.getElementsByTagName("Placemark")),c=(h,d)=>{let g=h.getElementsByTagName("wpml:"+d);if(g.length>0||(g=h.getElementsByTagName(d),g.length>0))return g[0].textContent;const j=h.getElementsByTagName("*");for(let x=0;x<j.length;x++)if(j[x].localName===d)return j[x].textContent;return null},u=a.features.length===r.length;if(a.features.forEach((h,d)=>{if(h.geometry.type==="Point"){let g=null;if(u)g=r[d];else{const[j,x]=h.geometry.coordinates;g=r.find(v=>{var M;const N=v.getElementsByTagName("Point")[0];if(!N)return!1;const L=(((M=N.getElementsByTagName("coordinates")[0])==null?void 0:M.textContent)||"").trim().split(",");if(L.length<2)return!1;const P=Number(L[0]),I=Number(L[1]);return Math.abs(P-j)<1e-4&&Math.abs(I-x)<1e-4})}if(g){let j=c(g,"waypointHeading");j===null&&(j=c(g,"waypointHeadingAngle"));const x=c(g,"waypointSpeed");let v=c(g,"ellipsoidHeight");v===null&&(v=c(g,"height")),v===null&&(v=c(g,"executeHeight"));const N=c(g,"gimbalPitchAngle");j!==null&&(h.properties.heading=Number(j)),x!==null&&(h.properties.speed=Number(x)),v!==null&&(h.properties.altitude=Number(v)),N!==null&&(h.properties.gimbalPitch=Number(N))}}}),!a||!a.features||a.features.length===0)throw new Error("No features found in KML/WPML file.");let m=null;const p=n.file("waygen_session.json");if(p)try{const h=await p.async("text");m=JSON.parse(h)}catch(h){console.warn("Failed to parse session data:",h)}return{geojson:a,sessionData:m}}else throw new Error("No valid KML or WPML file found inside KMZ.")}catch(n){throw console.error("KMZ Parse Error:",n),new Error("Failed to unzip or parse KMZ.")}throw new Error("Unsupported file format. Please use .kml or .kmz")};function sn({isOpen:e,onClose:n,onDownload:o,defaultFilename:i,defaultMissionEndAction:t}){const[a,r]=C.useState(""),[c,u]=C.useState("goHome"),[m,p]=C.useState("");C.useEffect(()=>{e&&(r(i),u(t),p(""))},[e,i,t]);const h=x=>x.replace(/[^a-zA-Z0-9_-]/g,"_").substring(0,100).trim(),d=x=>{const v=h(x.target.value);r(v),p(v.length===0?"Filename cannot be empty":"")},g=()=>{if(!a||a.length===0){p("Filename cannot be empty");return}o({filename:a,missionEndAction:c}),n()},j=x=>{x.key==="Escape"?n():x.key==="Enter"&&!m&&a&&g()};return e?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:n,children:s.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-96 max-w-full mx-4",onClick:x=>x.stopPropagation(),onKeyDown:j,children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[s.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"Export Mission"}),s.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 transition-colors",children:s.jsx(De,{size:20})})]}),s.jsxs("div",{className:"p-4 space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-bold text-gray-700 mb-2 block",children:"Mission End Action"}),s.jsxs("select",{value:c,onChange:x=>u(x.target.value),className:"w-full border rounded p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none",children:[s.jsx("option",{value:"goHome",children:"Return to Home"}),s.jsx("option",{value:"autoLand",children:"Hover"})]}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:c==="goHome"?"Drone will return to launch point after mission":"Drone will hover at final waypoint"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-bold text-gray-700 mb-2 block",children:"File Name"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"text",value:a,onChange:d,className:`flex-1 border rounded p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none ${m?"border-red-500":""}`,placeholder:"Enter filename",autoFocus:!0}),s.jsx("span",{className:"text-sm text-gray-500 font-medium",children:".kmz"})]}),m&&s.jsx("p",{className:"text-xs text-red-500 mt-1",children:m}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Allowed: letters, numbers, hyphens, underscores"})]})]}),s.jsxs("div",{className:"flex items-center justify-end gap-2 p-4 border-t bg-gray-50",children:[s.jsx("button",{onClick:n,className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 font-medium transition-colors",children:"Cancel"}),s.jsx("button",{onClick:g,disabled:!!m||!a,className:"px-4 py-2 bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-medium rounded text-sm transition-colors",children:"Download"})]})]})}):null}function on({isOpen:e,onClose:n,warningLevel:o,missionTime:i,droneName:t,maxFlightTime:a}){if(!e)return null;const r=o==="critical",u=r?st:ot,m=r?"text-red-500":"text-yellow-500",p=r?"bg-red-50":"bg-yellow-50",h=r?"border-red-200":"border-yellow-200",d=r?`Mission time (${i}) exceeds the ${t} maximum flight duration (~${a} minutes).`:`Mission time (${i}) is approaching the ${t} maximum flight duration (~${a} minutes).`;return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:n,children:s.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-96 max-w-full mx-4",onClick:g=>g.stopPropagation(),children:[s.jsxs("div",{className:`flex items-center justify-between p-4 border-b ${h} ${p}`,children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(u,{size:24,className:m}),s.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"Flight Duration Warning"})]}),s.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 transition-colors",children:s.jsx(De,{size:20})})]}),s.jsxs("div",{className:"p-4 space-y-4",children:[s.jsx("p",{className:"text-sm text-gray-700",children:d}),s.jsxs("div",{className:`p-3 rounded border ${h} ${p}`,children:[s.jsx("p",{className:"text-sm font-bold text-gray-700 mb-2",children:"Consider:"}),s.jsxs("ul",{className:"text-sm text-gray-600 space-y-1.5 list-disc list-inside",children:[s.jsx("li",{children:"Reducing waypoint coverage area"}),s.jsx("li",{children:"Increasing spacing/overlap settings"}),s.jsx("li",{children:"Splitting into multiple missions"})]})]}),s.jsx("p",{className:"text-xs text-gray-500 italic",children:"You can proceed, but ensure sufficient battery for the mission."})]}),s.jsx("div",{className:"flex items-center justify-end gap-2 p-4 border-t bg-gray-50",children:s.jsx("button",{onClick:n,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded text-sm transition-colors",children:"OK, Got It"})})]})})}const Qe=3.28084,J=(e,n)=>n==="metric"?e:Number((e*Qe).toFixed(2)),re=(e,n)=>n==="metric"?e:e/Qe;function an({selectedWaypoints:e,selectedIds:n,settings:o,onUpdate:i,onDelete:t}){const[a,r]=C.useState({}),[c,u]=C.useState(!1);C.useEffect(()=>{if(e.length===0)return;const d=e[0],g=P=>P.straightenLegs!==void 0?P.straightenLegs.toString():o.straightenLegs?"true":"false",j=P=>P.action?P.action:o.waypointAction==="photo"?"photo":"none",x=g(d),v=j(d),N=P=>e.every(I=>I[P]===d[P]),F=(P,I)=>e.every(M=>P(M)===I),L={lat:n.length===1?d.lat:"",lng:n.length===1?d.lng:"",altitude:N("altitude")?J(d.altitude,o.units):"",speed:N("speed")?J(d.speed,o.units):"",gimbalPitch:N("gimbalPitch")?d.gimbalPitch:"",heading:N("heading")?d.heading:"",straightenLegs:F(g,x)?x:"mixed",action:F(j,v)?v:"mixed"};r(L),u(!1)},[n,e,o]);const m=(d,g)=>{r(j=>({...j,[d]:g})),u(!0)},p=()=>{const d={};n.length===1&&(d.lat=Number(a.lat),d.lng=Number(a.lng)),a.altitude!==""&&(d.altitude=re(Number(a.altitude),o.units)),a.speed!==""&&(d.speed=re(Number(a.speed),o.units)),a.gimbalPitch!==""&&(d.gimbalPitch=Number(a.gimbalPitch)),a.heading!==""&&(d.heading=Number(a.heading)),a.straightenLegs!=="mixed"&&(d.straightenLegs=a.straightenLegs==="true"),a.action!=="mixed"&&(d.action=a.action),i(d),u(!1)},h=n.length===1;return s.jsxs("div",{className:"p-4 bg-gray-50 h-full border-l w-80 flex flex-col shadow-xl z-10 overflow-y-auto",children:[s.jsxs("h2",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[s.jsx(Fe,{size:20})," Edit Selected (",n.length,")"]}),h&&s.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Lat"}),s.jsx("input",{type:"number",className:"border p-2 rounded w-full text-xs",value:a.lat,onChange:d=>m("lat",d.target.value)})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Lng"}),s.jsx("input",{type:"number",className:"border p-2 rounded w-full text-xs",value:a.lng,onChange:d=>m("lng",d.target.value)})]})]}),s.jsxs("label",{className:"text-xs font-bold text-gray-500",children:["Altitude (",o.units==="metric"?"m":"ft",")"]}),s.jsx("input",{type:"number",className:"border p-2 rounded w-full mb-4",placeholder:a.altitude===""?"Mixed":"",value:a.altitude,onChange:d=>m("altitude",d.target.value)}),s.jsxs("label",{className:"text-xs font-bold text-gray-500",children:["Speed (",o.units==="metric"?"m/s":"ft/s",")"]}),s.jsx("input",{type:"number",className:"border p-2 rounded w-full mb-4",placeholder:a.speed===""?"Mixed":"",value:a.speed,onChange:d=>m("speed",d.target.value)}),s.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Gimbal Pitch (°)"}),s.jsx("input",{type:"number",className:"border p-2 rounded w-full mb-4",placeholder:a.gimbalPitch===""?"Mixed":"",value:a.gimbalPitch,onChange:d=>m("gimbalPitch",d.target.value)}),s.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Heading (°)"}),s.jsx("input",{type:"number",className:"border p-2 rounded w-full mb-4",placeholder:a.heading===""?"Mixed":"",value:a.heading,onChange:d=>m("heading",d.target.value)}),s.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Turn Mode"}),s.jsxs("select",{className:"border p-2 rounded w-full mb-4 text-sm bg-white",value:a.straightenLegs,onChange:d=>m("straightenLegs",d.target.value),children:[s.jsx("option",{value:"mixed",disabled:!0,hidden:!0,children:"Mixed"}),s.jsx("option",{value:"false",children:"Curved (Continuous)"}),s.jsx("option",{value:"true",children:"Straight (Stop & Turn)"})]}),s.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Action"}),s.jsxs("select",{className:"border p-2 rounded w-full mb-4 text-sm bg-white",value:a.action,onChange:d=>m("action",d.target.value),children:[s.jsx("option",{value:"mixed",disabled:!0,hidden:!0,children:"Mixed"}),s.jsx("option",{value:"none",children:"None"}),s.jsx("option",{value:"photo",children:"Take Photo"}),s.jsx("option",{value:"record_start",children:"Start Recording"}),s.jsx("option",{value:"record_stop",children:"Stop Recording"})]}),s.jsxs("div",{className:"mt-auto flex flex-col gap-2 pt-4",children:[s.jsxs("button",{onClick:p,disabled:!c,className:`w-full p-3 rounded-lg shadow-md flex items-center justify-center gap-2 transition-all font-bold text-white ${c?"bg-blue-600 hover:bg-blue-700":"bg-gray-400 cursor-not-allowed"}`,children:[s.jsx(it,{size:18})," Update Point(s)"]}),s.jsxs("button",{onClick:t,className:"w-full bg-red-100 hover:bg-red-200 text-red-600 p-2 rounded flex items-center justify-center gap-2 transition-colors font-medium",children:[s.jsx(Le,{size:16})," Delete Selected"]})]})]})}const me=({title:e,icon:n,children:o,defaultOpen:i=!1})=>{const[t,a]=C.useState(i);return s.jsxs("div",{className:"border-b border-gray-100 last:border-0",children:[s.jsxs("button",{onClick:()=>a(!t),className:"w-full flex items-center justify-between p-3 hover:bg-gray-50 transition-colors",children:[s.jsxs("div",{className:"flex items-center gap-2 font-semibold text-gray-700",children:[s.jsx(n,{size:18,className:"text-blue-600"}),e]}),t?s.jsx(pt,{size:16,className:"text-gray-400"}):s.jsx(gt,{size:16,className:"text-gray-400"})]}),t&&s.jsx("div",{className:"p-3 pt-0 space-y-4 animate-in slide-in-from-top-2 duration-200",children:o})]})};function rn({currentPolygon:e,setCurrentPolygon:n}){var k,U;const{waypoints:o,selectedIds:i,settings:t,setWaypoints:a,updateSelectedWaypoints:r,deleteSelectedWaypoints:c,undo:u,redo:m,updateSettings:p,resetMission:h,fitMapToWaypoints:d,currentMissionFilename:g,setMissionFilename:j,calculatedMaxSpeed:x,minSegmentDistance:v}=K(),[N,F]=C.useState(!1),[L,P]=C.useState(!1),[I,M]=C.useState({warning:!1,critical:!1}),H=()=>{confirm("Are you sure you want to reset the mission? This will clear all waypoints and shapes.")&&(h(),n(null))},_=()=>{window.mapboxDraw&&window.mapboxDraw.changeMode("simple_select");let l=e;if(window.mapboxDraw){const we=window.mapboxDraw.getSelected();if(we.features.length>0)l=we.features[0],n&&n(l);else if(e&&e.id){const ye=window.mapboxDraw.get(e.id);ye&&(l=ye,n&&n(l))}}if(!l)return alert("Draw a shape first!");const w=ne(t.selectedDrone),y=(w==null?void 0:w.hfov)??t.customFOV,S={...t,customFOV:y},E=Ee(l,S),A=t.photoInterval,{maxSpeed:G}=We(E,A),ue={...S,speed:G>0?G:t.speed},et=Ee(l,ue);a(et),setTimeout(()=>{K.getState().calculateMissionMetrics()},50)},b=async l=>{const w=l.target.files[0];if(w)try{const{geojson:y,sessionData:S}=await nn(w),E=[];if(y.features.forEach(A=>{A.geometry.type==="Point"&&E.push({id:de(),lng:A.geometry.coordinates[0],lat:A.geometry.coordinates[1],altitude:A.properties.altitude!==void 0?A.properties.altitude:t.altitude,speed:A.properties.speed!==void 0?A.properties.speed:t.speed,gimbalPitch:A.properties.gimbalPitch!==void 0?A.properties.gimbalPitch:t.gimbalPitch,heading:A.properties.heading!==void 0?A.properties.heading:0})}),E.length>0){a(E),S?(console.log("Restoring session data:",S),S.settings&&p(S.settings),S.polygon&&n?(console.log("Dispatching restore-polygon event",S.polygon),n(S.polygon),window.dispatchEvent(new CustomEvent("waygen:restore-polygon",{detail:S.polygon}))):console.warn("No polygon in session data or setCurrentPolygon missing",{polygon:S.polygon,fn:!!n}),alert(`Imported ${E.length} waypoints and restored session!`)):alert(`Imported ${E.length} waypoints!`);const A=w.name.replace(/\.(kmz|kml)$/i,"");j(A),setTimeout(()=>{d(),K.getState().calculateMissionMetrics()},100)}else alert("No waypoints found in file.")}catch(y){console.error(y),alert("Failed to parse file. Ensure it is a valid KML/KMZ.")}},R=()=>g||`waygen_${new Date().toISOString().replace(/[-:]/g,"").replace(/\..+/,"").replace("T","_").substring(0,15)}`,q=()=>{F(!0)},f=({filename:l,missionEndAction:w})=>{p({missionEndAction:w}),Ct(o,t,l,{settings:t,polygon:e})},O=l=>{if(l.length<2)return 0;let w=0;for(let y=0;y<l.length-1;y++){const S=W([l[y].lng,l[y].lat]),E=W([l[y+1].lng,l[y+1].lat]);w+=te(S,E,{units:"meters"})}return w},D=l=>{const w=Math.floor(l/60),y=l%60;return`${w}:${y.toString().padStart(2,"0")}`},T=(l,w)=>{if(w==="metric")return l>=1e3?`${(l/1e3).toFixed(2)} km`:`${Math.round(l)} m`;{const y=l*3.28084;return y>=5280?`${(y/5280).toFixed(2)} mi`:`${Math.round(y)} ft`}};if(i.length>0){const l=o.filter(w=>i.includes(w.id));return s.jsx(an,{selectedWaypoints:l,selectedIds:i,settings:t,onUpdate:r,onDelete:c})}return s.jsxs("div",{className:"bg-white h-full border-l w-80 flex flex-col shadow-xl z-10 flex-shrink-0",children:[s.jsxs("div",{className:"p-4 border-b flex justify-between items-center bg-gray-50",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"font-bold text-xl text-gray-800",children:"Waygen"}),g&&s.jsx("div",{className:"text-sm text-gray-500 truncate max-w-[200px]",title:g,children:g})]}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx("button",{onClick:H,className:"p-2 hover:bg-red-100 hover:text-red-600 rounded-full shadow-sm border transition-all",title:"Reset Mission",children:s.jsx(Le,{size:16})}),s.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1 self-center"}),s.jsx("button",{onClick:u,className:"p-2 hover:bg-white rounded-full shadow-sm border transition-all",children:s.jsx(at,{size:16})}),s.jsx("button",{onClick:m,className:"p-2 hover:bg-white rounded-full shadow-sm border transition-all",children:s.jsx(rt,{size:16})})]})]}),s.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[s.jsx("div",{className:"p-3",children:s.jsxs("label",{className:"flex items-center justify-center gap-2 w-full p-2 bg-blue-50 text-blue-700 rounded-lg border border-blue-100 hover:bg-blue-100 transition-colors cursor-pointer font-medium text-sm",children:[s.jsx(lt,{size:16})," Import KML/KMZ",s.jsx("input",{type:"file",onChange:b,className:"hidden",accept:".kml,.kmz"})]})}),s.jsxs(me,{title:"Basics",icon:Fe,defaultOpen:!0,children:[s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Units"}),s.jsxs("div",{className:"flex flex-col gap-2 mt-1",children:[s.jsxs("label",{className:"flex items-center cursor-pointer",children:[s.jsx("input",{type:"radio",name:"units",value:"metric",checked:t.units==="metric",onChange:()=>p({units:"metric"}),className:"form-radio h-4 w-4 text-blue-600 focus:ring-blue-500 transition duration-150 ease-in-out"}),s.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Metric (m)"})]}),s.jsxs("label",{className:"flex items-center cursor-pointer",children:[s.jsx("input",{type:"radio",name:"units",value:"imperial",checked:t.units==="imperial",onChange:()=>p({units:"imperial"}),className:"form-radio h-4 w-4 text-blue-600 focus:ring-blue-500 transition duration-150 ease-in-out"}),s.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Imperial (ft)"})]})]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Altitude (",t.units==="metric"?"m":"ft",")"]}),s.jsx("input",{type:"number",value:J(t.altitude,t.units),onChange:l=>p({altitude:re(Number(l.target.value),t.units)}),className:"w-full border rounded p-1.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none"})]})]}),s.jsxs("div",{className:"mt-4 border-t pt-3",children:[s.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Drone Model (FOV)"}),s.jsx("select",{value:fe(t.selectedDrone),onChange:l=>{const w=l.target.value,y=Z[w];let S,E;w==="custom"?(S=t.customFOV,E=t.photoInterval):(S=(y==null?void 0:y.hfov)||82.1,E=(y==null?void 0:y.photoInterval)||DEFAULT_PHOTO_INTERVAL),p({selectedDrone:w,customFOV:S,photoInterval:E})},className:"w-full border rounded p-1.5 text-sm bg-gray-50 focus:ring-2 focus:ring-blue-500 outline-none",children:Dt().map(l=>{const w=Z[l];return s.jsxs("option",{value:l,children:[w.name," ",w.hfov?`(${w.hfov}°)`:""]},l)})})]}),s.jsxs("div",{className:"mt-2",children:[s.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Photo Interval (seconds)"}),s.jsx("input",{type:"number",step:"0.1",min:"0.1",value:t.photoInterval,onChange:l=>p({photoInterval:Number(l.target.value)}),className:"w-full border rounded p-1.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none"})]}),t.selectedDrone==="custom"&&s.jsxs("div",{className:"mt-2",children:[s.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Custom HFOV (°)"}),s.jsx("input",{type:"number",value:t.customFOV,onChange:l=>p({customFOV:Number(l.target.value)}),className:"w-full border rounded p-1.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none"})]})]}),s.jsxs(me,{title:"Coverage",icon:ct,defaultOpen:!0,children:[s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Path Type"}),s.jsxs("div",{className:"flex bg-gray-100 p-1 rounded-lg",children:[s.jsx("button",{onClick:()=>p({pathType:"grid"}),className:`flex-1 py-1 text-xs font-bold rounded-md transition-all ${t.pathType==="grid"?"bg-white shadow text-blue-600":"text-gray-500 hover:text-gray-700"}`,children:"Grid"}),s.jsx("button",{onClick:()=>p({pathType:"orbit",spacing:10}),className:`flex-1 py-1 text-xs font-bold rounded-md transition-all ${t.pathType==="orbit"?"bg-white shadow text-blue-600":"text-gray-500 hover:text-gray-700"}`,children:"Orbit"})]})]}),t.pathType==="grid"?s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Side Overlap ",t.sideOverlap,"%"]}),s.jsx("input",{type:"range",min:"0",max:"90",value:t.sideOverlap,onChange:l=>p({sideOverlap:Number(l.target.value)}),className:"w-full accent-blue-600"})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Front Overlap ",t.frontOverlap,"%"]}),s.jsx("input",{type:"range",min:"0",max:"90",value:t.frontOverlap,onChange:l=>p({frontOverlap:Number(l.target.value)}),className:"w-full accent-blue-600"})]}),s.jsxs("div",{className:"flex items-center justify-between mt-2",children:[s.jsx("label",{className:"text-sm text-gray-700",children:"Auto Path Angle"}),s.jsx("input",{type:"checkbox",checked:t.autoDirection,onChange:l=>p({autoDirection:l.target.checked}),className:"accent-blue-600 w-4 h-4"})]}),s.jsxs("div",{className:`mt-2 transition-opacity ${t.autoDirection?"opacity-50":"opacity-100"}`,children:[s.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Path Angle ",t.angle,"°"]}),s.jsx("input",{type:"range",min:"0",max:"360",value:t.angle,onChange:l=>p({angle:Number(l.target.value)}),disabled:t.autoDirection,className:`w-full ${t.autoDirection?"accent-gray-400 cursor-not-allowed":"accent-blue-600"}`})]})]}):s.jsx("div",{className:"space-y-3",children:s.jsxs("div",{children:[s.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Spacing (",t.units==="metric"?"m":"ft",")"]}),s.jsx("input",{type:"number",min:"1",value:J(t.spacing,t.units),onChange:l=>p({spacing:re(Number(l.target.value),t.units)}),className:"w-full border rounded p-1.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none"}),s.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Distance between waypoints along the perimeter."})]})}),s.jsxs("div",{className:"flex items-center justify-between mt-2",children:[s.jsx("label",{className:"text-sm text-gray-700",children:"Reverse Path"}),s.jsx("input",{type:"checkbox",checked:t.reversePath,onChange:l=>p({reversePath:l.target.checked}),className:"accent-blue-600 w-4 h-4"})]}),s.jsxs("div",{className:"flex items-center justify-between mt-3",children:[s.jsx("label",{className:"text-sm text-gray-700",children:"Straighten Legs"}),s.jsx("input",{type:"checkbox",checked:t.straightenLegs,onChange:l=>p({straightenLegs:l.target.checked}),className:"accent-blue-600 w-4 h-4"})]}),s.jsxs("div",{className:"flex items-center justify-between mt-3",children:[s.jsx("label",{className:"text-sm text-gray-700",children:"Generate Every Point"}),s.jsx("input",{type:"checkbox",checked:t.generateEveryPoint,onChange:l=>p({generateEveryPoint:l.target.checked}),className:"accent-blue-600 w-4 h-4"})]}),s.jsxs("div",{className:"flex items-center justify-between mt-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("label",{className:"text-sm text-gray-700",children:"Show Image Footprints"}),t.showFootprints&&s.jsx("input",{type:"color",value:t.footprintColor,onChange:l=>p({footprintColor:l.target.value}),className:"w-4 h-4 rounded border border-gray-300 cursor-pointer",title:"Choose footprint color"})]}),s.jsx("input",{type:"checkbox",checked:t.showFootprints,onChange:l=>p({showFootprints:l.target.checked}),className:"accent-blue-600 w-4 h-4"})]}),t.showFootprints&&(()=>{const l=t.customFOV||82.1,y=2*t.altitude*Math.tan(l*Math.PI/360),S=y*(3/4),E=J(y,t.units).toFixed(1),A=J(S,t.units).toFixed(1),G=t.units==="metric"?"m":"ft";return s.jsxs("div",{className:"mt-0 text-xs text-gray-500",children:["Est. Size: ",E," x ",A," ",G]})})()]}),s.jsxs(me,{title:"Camera",icon:dt,defaultOpen:!0,children:[s.jsxs("div",{children:[s.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Gimbal Pitch ",t.gimbalPitch,"°"]}),s.jsx("input",{type:"range",min:"-90",max:"0",value:t.gimbalPitch,onChange:l=>p({gimbalPitch:Number(l.target.value)}),className:"w-full accent-blue-600"})]}),s.jsxs("div",{className:"mt-2",children:[s.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Action per Waypoint"}),s.jsxs("select",{value:t.waypointAction,onChange:l=>p({waypointAction:l.target.value}),className:"w-full border rounded p-1.5 text-sm bg-gray-50 focus:ring-2 focus:ring-blue-500 outline-none",children:[s.jsx("option",{value:"none",children:"No Action"}),s.jsx("option",{value:"photo",children:"Take Photo"}),s.jsx("option",{value:"record",children:"Start/Stop Recording"})]})]})]})]}),s.jsxs("div",{className:"p-4 border-t bg-gray-50",children:[s.jsxs("button",{onClick:_,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold p-3 rounded-lg shadow-md mb-3 flex items-center justify-center gap-2 transition-all transform active:scale-95",children:[s.jsx(ut,{size:18})," Generate Path"]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("div",{className:"bg-white border rounded p-2 text-center",children:[s.jsx("div",{className:"text-xs text-gray-400 font-bold uppercase",children:"Waypoints"}),s.jsx("div",{className:"font-bold text-gray-700",children:o.length})]}),s.jsxs("div",{className:"bg-white border rounded p-2 text-center",children:[s.jsx("div",{className:"text-xs text-gray-400 font-bold uppercase",children:"Distance"}),s.jsx("div",{className:"font-bold text-gray-700",children:o.length>=2?T(O(o),t.units):t.units==="metric"?"0 m":"0 ft"})]}),s.jsxs("div",{className:"bg-white border rounded p-2 text-center",children:[s.jsx("div",{className:"text-xs text-gray-400 font-bold uppercase",children:"Max Speed"}),s.jsx("div",{className:"font-bold text-gray-700",title:`Based on ${Math.round(v)}m minimum segment`,children:o.length>=2&&x>0?`${J(x,t.units).toFixed(1)} ${t.units==="metric"?"m/s":"ft/s"}`:t.units==="metric"?"0 m/s":"0 ft/s"})]}),s.jsxs("div",{className:`bg-white border rounded p-2 text-center ${(()=>{const l=K.getState().getFlightWarningLevel();return l==="critical"?"border-red-500 bg-red-50":l==="warning"?"border-yellow-500 bg-yellow-50":""})()}`,children:[s.jsx("div",{className:"text-xs text-gray-400 font-bold uppercase",children:"Est. Time"}),s.jsx("div",{className:`font-bold ${(()=>{const l=K.getState().getFlightWarningLevel();return l==="critical"?"text-red-600":l==="warning"?"text-yellow-700":"text-gray-700"})()}`,children:o.length>=2&&x>0?(()=>{const l=K.getState().getMissionTime(),w=K.getState().getFlightWarningLevel(),y=D(l),S=w==="critical"?" 🔴":w==="warning"?" ⚠️":"";return w!=="safe"&&!I[w]&&setTimeout(()=>{P(!0),M(E=>({...E,[w]:!0}))},500),s.jsxs("span",{title:`${l}s total`,children:[y,S]})})():"0:00"})]})]}),s.jsxs("button",{onClick:q,disabled:o.length===0,className:"w-full mt-3 bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold p-3 rounded-lg shadow-md flex items-center justify-center gap-2 transition-all",children:[s.jsx(mt,{size:18})," Download KMZ"]})]}),s.jsx(sn,{isOpen:N,onClose:()=>F(!1),onDownload:f,defaultFilename:R(),defaultMissionEndAction:t.missionEndAction}),s.jsx(on,{isOpen:L,onClose:()=>P(!1),warningLevel:K.getState().getFlightWarningLevel(),missionTime:o.length>=2?D(K.getState().getMissionTime()):"0:00",droneName:((k=ne(t.selectedDrone))==null?void 0:k.name)||"Unknown Drone",maxFlightTime:((U=ne(t.selectedDrone))==null?void 0:U.maxFlightTime)||0})]})}const ln=le.lazy(()=>$e(()=>import("./SearchBar-digllvNs.js"),__vite__mapDeps([0,1,2,3,4,5]))),cn=le.lazy(()=>$e(()=>import("./MapContainer-NRjVbHyG.js"),__vite__mapDeps([6,1,2,3,4,7,5])));function dn(){const[e,n]=C.useState(null),[o,i]=C.useState(!0);return le.useEffect(()=>{const t=setTimeout(()=>i(!1),1e3);return()=>clearTimeout(t)},[]),o?s.jsx("div",{className:"flex h-screen w-screen items-center justify-center bg-gray-50",children:s.jsx("div",{className:"text-2xl font-bold text-blue-600 animate-pulse",children:"Waygen Loading..."})}):s.jsxs("div",{className:"flex h-screen w-screen overflow-hidden",children:[s.jsxs("div",{className:"relative flex-grow",children:[s.jsx(C.Suspense,{fallback:null,children:s.jsx(ln,{})}),s.jsx(C.Suspense,{fallback:s.jsx("div",{className:"flex h-full w-full items-center justify-center bg-gray-100",children:s.jsx("div",{className:"text-lg font-semibold text-gray-500",children:"Loading Map..."})}),children:s.jsx(cn,{onPolygonDrawn:n,polygon:e})})]}),s.jsx(rn,{currentPolygon:e,setCurrentPolygon:n})]})}pe.createRoot(document.getElementById("root")).render(s.jsx(le.StrictMode,{children:s.jsx(dn,{})}));export{hn as c,s as j,K as u};
