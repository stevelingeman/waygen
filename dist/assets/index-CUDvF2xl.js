const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SearchBar-O9917y-o.js","assets/vendor-BeRQyJBT.js","assets/mapbox-C3udIXGP.js","assets/turf-DdeSyY1S.js","assets/utils-P9aiU5u9.js","assets/mapbox-gl-geocoder-BCYwfNyN.css","assets/MapContainer-CR5MJ14r.js","assets/MapContainer-jpWXR4Z0.css"])))=>i.map(i=>d[i]);
import{r as $,a as ot,c as it,X as De,b as at,A as rt,S as Fe,d as lt,P as ct,T as Ce,U as dt,R as ut,e as mt,M as pt,C as gt,f as ht,D as ft,g as xt,h as bt,i as me}from"./vendor-BeRQyJBT.js";import{p as W,d as ne,a as wt,b as ee,c as ce,e as Oe,t as Pe,f as yt,l as ge,g as vt,h as Me,i as jt,j as Te,k as Nt,m as fe}from"./turf-DdeSyY1S.js";import{J as Re,F as St}from"./utils-P9aiU5u9.js";import"./mapbox-C3udIXGP.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function o(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(t){if(t.ep)return;t.ep=!0;const a=o(t);fetch(t.href,a)}})();var $e={exports:{}},pe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pt=$,Mt=Symbol.for("react.element"),Tt=Symbol.for("react.fragment"),kt=Object.prototype.hasOwnProperty,At=Pt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Et={key:!0,ref:!0,__self:!0,__source:!0};function _e(e,s,o){var i,t={},a=null,r=null;o!==void 0&&(a=""+o),s.key!==void 0&&(a=""+s.key),s.ref!==void 0&&(r=s.ref);for(i in s)kt.call(s,i)&&!Et.hasOwnProperty(i)&&(t[i]=s[i]);if(e&&e.defaultProps)for(i in s=e.defaultProps,s)t[i]===void 0&&(t[i]=s[i]);return{$$typeof:Mt,type:e,key:a,ref:r,props:t,_owner:At.current}}pe.Fragment=Tt;pe.jsx=_e;pe.jsxs=_e;$e.exports=pe;var n=$e.exports,xe={},ke=ot;xe.createRoot=ke.createRoot,xe.hydrateRoot=ke.hydrateRoot;const Lt="modulepreload",It=function(e){return"/"+e},Ae={},We=function(s,o,i){let t=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),l=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));t=Promise.allSettled(o.map(m=>{if(m=It(m),m in Ae)return;Ae[m]=!0;const p=m.endsWith(".css"),N=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${N}`))return;const d=document.createElement("link");if(d.rel=p?"stylesheet":Lt,p||(d.as="script"),d.crossOrigin="",d.href=m,l&&d.setAttribute("nonce",l),document.head.appendChild(d),p)return new Promise((S,g)=>{d.addEventListener("load",S),d.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${m}`)))})}))}function a(r){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=r,window.dispatchEvent(l),!l.defaultPrevented)throw r}return t.then(r=>{for(const l of r||[])l.status==="rejected"&&a(l.reason);return s().catch(a)})},Dt=.85,Ft=5.5,Ee=0,q={"mini-4-pro":{name:"DJI Mini 4 Pro",hfov:82.1,photoInterval:5.5,maxFlightTime:31},"mini-5-pro":{name:"DJI Mini 5 Pro",hfov:84,photoInterval:5.5,maxFlightTime:40,isDefault:!0},"mavic-4-pro":{name:"DJI Mavic 4 Pro",hfov:72,photoInterval:5.5,maxFlightTime:40},custom:{name:"Custom",hfov:null,photoInterval:5.5,maxFlightTime:null}},Ct=()=>Object.keys(q).find(e=>q[e].isDefault)||Object.keys(q)[0],re=e=>{const s=ye(e);return q[s]||null},Ot=()=>Object.keys(q),ye=e=>({dji_mini_4_pro:"mini-4-pro",dji_mini_5_pro:"mini-5-pro",dji_mavic_4_pro:"mavic-4-pro",custom:"custom"})[e]||e,yn=(e,s,o,i)=>{if(!e||!s||!i)return null;const t=2*s*Math.tan(i*Math.PI/360),a=t*(3/4),r=t/2,l=a/2,m=Math.sqrt(r*r+l*l),p=Math.atan2(r,l)*180/Math.PI,N=180-p,d=180+p,S=360-p,g=W([e.lng,e.lat]),y=ne(g,m/1e3,o+p,{units:"kilometers"}),P=ne(g,m/1e3,o+N,{units:"kilometers"}),u=ne(g,m/1e3,o+d,{units:"kilometers"}),M=ne(g,m/1e3,o+S,{units:"kilometers"}),h=[[y.geometry.coordinates,P.geometry.coordinates,u.geometry.coordinates,M.geometry.coordinates,y.geometry.coordinates]];return wt(h,{altitude:s,heading:o,hfov:i})},He=(e,s)=>{const o=W([e.lng,e.lat]),i=W([s.lng,s.lat]);return ee(o,i,{units:"meters"})},ze=(e,s)=>{if(!e||e.length<2||!s||s<=0)return{maxSpeed:0,minDistance:0};const o=[];for(let a=0;a<e.length-1;a++){const r=He(e[a],e[a+1]);o.push(r)}const i=Math.min(...o),t=i/s;return{maxSpeed:Math.max(0,t),minDistance:i}},Rt=(e,s)=>{if(!s||s<=0)return Ee;const i=e/s+Ee;return Math.round(i)},$t=(e,s)=>{if(!s||s<=0)return"safe";const o=s*60,i=o*Dt;return e>=o?"critical":e>=i?"warning":"safe"};function se(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const s=Math.random()*16|0;return(e==="x"?s:s&3|8).toString(16)})}const G=it((e,s)=>({waypoints:[],selectedIds:[],mapRef:null,currentMissionFilename:null,calculatedMaxSpeed:0,minSegmentDistance:0,past:[],future:[],settings:(()=>{const o=Ct(),i=ye(o),t=q[i];return{altitude:60,speed:10,gimbalPitch:-90,customFOV:(t==null?void 0:t.hfov)||82.1,showFootprints:!1,footprintColor:"#22c55e",sideOverlap:80,frontOverlap:80,pathType:"grid",angle:0,autoDirection:!1,generateEveryPoint:!1,reversePath:!1,waypointAction:"none",photoInterval:(t==null?void 0:t.photoInterval)||Ft,selectedDrone:o,straightenLegs:!1,units:"metric",orbitRadius:50,startAngle:0,direction:"counter-clockwise",numberOfOrbits:1,missionEndAction:"goHome"}})(),setWaypoints:o=>e(i=>({waypoints:o,past:[...i.past,i.waypoints],future:[]})),addWaypoint:o=>e(i=>{let t=i.settings.speed,a=0;if(i.waypoints.length>0){const m=i.waypoints[i.waypoints.length-1];t=Math.round((m.speed||i.settings.speed)*10)/10,a=m.heading||0}const r={id:se(),...o,altitude:i.settings.altitude,speed:t,gimbalPitch:i.settings.gimbalPitch,heading:a},l=[...i.waypoints];if(l.length>0){const m=l.length-1,p=l[m],N=Math.round(ce([p.lng,p.lat],[r.lng,r.lat]));l[m]={...p,heading:N},r.heading=N}return{waypoints:[...l,r],past:[...i.past,i.waypoints],future:[]}}),updateSettings:o=>e(i=>({settings:{...i.settings,...o}})),selectWaypoint:(o,i)=>e(t=>({selectedIds:i?t.selectedIds.includes(o)?t.selectedIds.filter(a=>a!==o):[...t.selectedIds,o]:[o]})),setSelectedIds:o=>e({selectedIds:o}),clearSelection:()=>e({selectedIds:[]}),updateSelectedWaypoints:o=>{const{waypoints:i,selectedIds:t,past:a}=s(),r=i.map(l=>t.includes(l.id)?{...l,...o}:l);e({waypoints:r,past:[...a,i],future:[]})},updateWaypoint:(o,i)=>{const{waypoints:t,past:a}=s(),r=t.map(l=>l.id===o?{...l,...i}:l);e({waypoints:r,past:[...a,t],future:[]})},deleteSelectedWaypoints:()=>{const{waypoints:o,selectedIds:i,past:t}=s(),a=o.filter(r=>!i.includes(r.id));e({waypoints:a,selectedIds:[],past:[...t,o],future:[]})},moveWaypoints:(o,i,t)=>{const{waypoints:a,past:r}=s(),l=a.map(m=>o.includes(m.id)?{...m,lng:m.lng+i,lat:m.lat+t}:m);e({waypoints:l,past:[...r,a],future:[]})},insertWaypoint:(o,i)=>e(t=>{const a={id:se(),...i},r=[...t.waypoints];return r.splice(o,0,a),{waypoints:r,past:[...t.past,t.waypoints],future:[],selectedIds:[a.id]}}),undo:()=>{const{past:o,future:i,waypoints:t}=s();if(o.length===0)return;const a=o[o.length-1],r=o.slice(0,o.length-1);e({waypoints:a,past:r,future:[t,...i]})},redo:()=>{const{past:o,future:i,waypoints:t}=s();if(i.length===0)return;const a=i[0],r=i.slice(1);e({waypoints:a,past:[...o,t],future:r})},setMapRef:o=>e({mapRef:o}),fitMapToWaypoints:()=>{const{mapRef:o,waypoints:i}=s();if(!o||!i||i.length===0)return;let t=i[0].lng,a=i[0].lng,r=i[0].lat,l=i[0].lat;i.forEach(p=>{p.lng<t&&(t=p.lng),p.lng>a&&(a=p.lng),p.lat<r&&(r=p.lat),p.lat>l&&(l=p.lat)});const m=[[t,r],[a,l]];o.fitBounds(m,{padding:{top:100,bottom:100,left:200,right:350},maxZoom:16,duration:3e3})},setMissionFilename:o=>e({currentMissionFilename:o}),clearMissionFilename:()=>e({currentMissionFilename:null}),calculateMissionMetrics:()=>{const{waypoints:o,settings:i}=s(),t=i.photoInterval,{maxSpeed:a,minDistance:r}=ze(o,t);e({calculatedMaxSpeed:a,minSegmentDistance:r})},getTotalDistance:()=>{const{waypoints:o}=s();if(o.length<2)return 0;let i=0;for(let t=0;t<o.length-1;t++)i+=He(o[t],o[t+1]);return i},getMissionTime:()=>{const{calculatedMaxSpeed:o}=s(),i=s().getTotalDistance();return Rt(i,o)},getFlightWarningLevel:()=>{const{settings:o}=s(),i=s().getMissionTime(),t=re(o.selectedDrone),a=(t==null?void 0:t.maxFlightTime)||null;return $t(i,a)},resetTrigger:0,resetMission:()=>e(o=>({waypoints:[],selectedIds:[],past:[],future:[],currentMissionFilename:null,calculatedMaxSpeed:0,minSegmentDistance:0,resetTrigger:o.resetTrigger+1}))}));function _t(e,s){const{altitude:o,speed:i,gimbalPitch:t,spacing:a,straightenLegs:r,waypointAction:l,startAngle:m,direction:p,numberOfOrbits:N}=s,d=Oe(e);d.geometry.coordinates;const S=e.geometry.coordinates[0];let g=0;S.forEach(O=>{g+=ee(d,W(O),{units:"meters"})});const y=g/S.length,P=Math.max(.1,N),u=2*Math.PI*y,M=Math.max(3,Math.round(u/a)),h=Math.round(M*P),j=[],v=m%360,L=360*P,H=Number.isInteger(P);for(let O=0;O<=h;O++){if(H&&O===h)continue;let k=O/h*L,R;p==="clockwise"?R=(v+k+360)%360:R=(v-k+360*100)%360;const T=ne(d,y/1e3,R,{units:"kilometers"}),_=Math.round(ce(T,d));j.push({id:se(),lng:T.geometry.coordinates[0],lat:T.geometry.coordinates[1],altitude:Number(o),speed:Math.round(Number(i)*10)/10,gimbalPitch:Number(t),heading:_,straightenLegs:r,action:l})}return j}function Le(e,s){if(s.pathType==="orbit")return _t(e,s);const{altitude:o,sideOverlap:i,frontOverlap:t,angle:a,gimbalPitch:r,autoDirection:l,generateEveryPoint:m,reversePath:p,speed:N,straightenLegs:d,waypointAction:S}=s,g=s.customFOV||82.1,y=Math.tan(g/2*(Math.PI/180)),P=o*y*2,u=P*(1-i/100),h=P*(3/4)*(1-t/100),j=u/111111,v=Oe(e);let L=a;if(l){let f=0,C=0;const I=e.geometry.coordinates[0];for(let D=0;D<I.length-1;D++){const c=W(I[D]),x=W(I[D+1]),b=ee(c,x);b>f&&(f=b,C=ce(c,x))}L=C}const H=-L,O=Pe(e,H,{pivot:v}),k=yt(O),R=[];let T=k[1]+j/2;for(;T<=k[3]+j/10;){const f=ge([[k[0]-.1,T],[k[2]+.1,T]]),C=vt(f,O),I=D=>{const c=D.geometry.coordinates;return Array.isArray(c[0][0])?fe(c[0][0],c[0][c[0].length-1]):fe(c[0],c[c.length-1])};if(C.features.length===0){const D=I(f);Me(D,O)&&R.push(f.geometry.coordinates)}else C.features.forEach(D=>{const c=I(D);Me(c,O)&&R.push(D.geometry.coordinates)});T+=j}const _=R.filter(f=>{const C=ge(f);return jt(C,{units:"meters"})>=h});let w=[];_.forEach((f,C)=>{let I=C%2===1?f.reverse():f;if(m){const D=W(I[0]),c=W(I[1]),x=ee(D,c,{units:"meters"}),b=Math.max(1,h),A=Math.floor(x/b);if(A>=1){const E=ge(I),F=[];for(let K=0;K<=A;K++){Te(E,K*b/1e3,{units:"kilometers"});const ae=Te(E,K*b,{units:"meters"});F.push(ae.geometry.coordinates)}I=F}}I.forEach((D,c)=>{const x=c===I.length-1;w.push({id:se(),lng:D[0],lat:D[1],altitude:Number(o),speed:Math.round(Number(N)*10)/10,gimbalPitch:Number(r),heading:0,straightenLegs:d,action:S,_isRowEnd:x,_isRowStart:c===0})})});const Z=[];for(let f=0;f<w.length;f++){const C=w[f];if(C._isRowEnd&&f<w.length-1){const I=w[f+1];if(ee(W([C.lng,C.lat]),W([I.lng,I.lat]),{units:"meters"})<h)continue}Z.push(C)}if(w=Z,w.length===0)return[];const Y=Nt(w.map(f=>[f.lng,f.lat]));Pe(Y,L,{pivot:v}).features.forEach((f,C)=>{w[C].lng=f.geometry.coordinates[0],w[C].lat=f.geometry.coordinates[1]}),p&&w.reverse();for(let f=0;f<w.length;f++){if((p?w[f]._isRowStart:w[f]._isRowEnd)&&f>0)w[f].heading=w[f-1].heading;else if(f<w.length-1){const I=W([w[f].lng,w[f].lat]),D=W([w[f+1].lng,w[f+1].lat]);w[f].heading=Math.round(ce(I,D))}else f>0&&(w[f].heading=w[f-1].heading);delete w[f]._isRowEnd,delete w[f]._isRowStart}return w}const Wt=async(e,s,o="MiniMission",i=null)=>{const t=new Re,a=Date.now(),{speed:r,straightenLegs:l,waypointAction:m,gimbalPitch:p,missionEndAction:N,rcLostAction:d,globalTransitionalSpeed:S}=s,g=`<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://www.opengis.net/kml/2.2" xmlns:wpml="http://www.dji.com/wpmz/1.0.2">
  <Document>
    <wpml:createTime>${a}</wpml:createTime>
    <wpml:updateTime>${a}</wpml:updateTime>
    <wpml:missionConfig>
      <wpml:flyToWaylineMode>safely</wpml:flyToWaylineMode>
      <wpml:finishAction>${N}</wpml:finishAction>
      <wpml:exitOnRCLost>executeLostAction</wpml:exitOnRCLost>
      <wpml:executeRCLostAction>${d||"hover"}</wpml:executeRCLostAction>
      <wpml:globalTransitionalSpeed>${S!==void 0?S:r}</wpml:globalTransitionalSpeed>
      <wpml:droneInfo>
        <wpml:droneEnumValue>68</wpml:droneEnumValue>
        <wpml:droneSubEnumValue>0</wpml:droneSubEnumValue>
      </wpml:droneInfo>
    </wpml:missionConfig>
    <wpml:templateId>0</wpml:templateId>
  </Document>
</kml>`;let y="";e.forEach((h,j)=>{const v=j===0,L=j===e.length-1,H=j+1,O=h.straightenLegs!==void 0?h.straightenLegs:l,k=h.action!==void 0?h.action:m,R=h.gimbalPitch!==void 0?h.gimbalPitch:p,T=h.speed!==void 0?h.speed:r;let _="",w=0;const Z=j>0?e[j-1]:null,Y=Z?Z.gimbalPitch!==void 0?Z.gimbalPitch:p:null;(v||Y!==null&&R!==Y)&&(_+=`
        <wpml:action>
          <wpml:actionId>${w++}</wpml:actionId>
          <wpml:actionActuatorFunc>gimbalRotate</wpml:actionActuatorFunc>
          <wpml:actionActuatorFuncParam>
            <wpml:gimbalHeadingYawBase>aircraft</wpml:gimbalHeadingYawBase>
            <wpml:gimbalRotateMode>absoluteAngle</wpml:gimbalRotateMode>
            <wpml:gimbalPitchRotateEnable>1</wpml:gimbalPitchRotateEnable>
            <wpml:gimbalPitchRotateAngle>${R}</wpml:gimbalPitchRotateAngle>
            <wpml:gimbalRollRotateEnable>0</wpml:gimbalRollRotateEnable>
            <wpml:gimbalYawRotateEnable>0</wpml:gimbalYawRotateEnable>
            <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
          </wpml:actionActuatorFuncParam>
        </wpml:action>`),k==="photo"?_+=`
        <wpml:action>
          <wpml:actionId>${w++}</wpml:actionId>
          <wpml:actionActuatorFunc>takePhoto</wpml:actionActuatorFunc>
          <wpml:actionActuatorFuncParam>
            <wpml:fileSuffix>point${j}</wpml:fileSuffix>
            <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
          </wpml:actionActuatorFuncParam>
        </wpml:action>`:k==="record_start"?_+=`
          <wpml:action>
            <wpml:actionId>${w++}</wpml:actionId>
            <wpml:actionActuatorFunc>startRecord</wpml:actionActuatorFunc>
            <wpml:actionActuatorFuncParam>
              <wpml:fileSuffix>mission</wpml:fileSuffix>
              <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
            </wpml:actionActuatorFuncParam>
          </wpml:action>`:k==="record_stop"?_+=`
          <wpml:action>
            <wpml:actionId>${w++}</wpml:actionId>
            <wpml:actionActuatorFunc>stopRecord</wpml:actionActuatorFunc>
            <wpml:actionActuatorFuncParam>
              <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
            </wpml:actionActuatorFuncParam>
          </wpml:action>`:k==="record"&&(v?_+=`
            <wpml:action>
              <wpml:actionId>${w++}</wpml:actionId>
              <wpml:actionActuatorFunc>startRecord</wpml:actionActuatorFunc>
              <wpml:actionActuatorFuncParam>
                <wpml:fileSuffix>mission</wpml:fileSuffix>
                <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
              </wpml:actionActuatorFuncParam>
            </wpml:action>`:L&&(_+=`
            <wpml:action>
              <wpml:actionId>${w++}</wpml:actionId>
              <wpml:actionActuatorFunc>stopRecord</wpml:actionActuatorFunc>
              <wpml:actionActuatorFuncParam>
                <wpml:payloadPositionIndex>0</wpml:payloadPositionIndex>
              </wpml:actionActuatorFuncParam>
            </wpml:action>`));const ie=w>0?`
      <wpml:actionGroup>
        <wpml:actionGroupId>${H}</wpml:actionGroupId>
        <wpml:actionGroupStartIndex>${j}</wpml:actionGroupStartIndex>
        <wpml:actionGroupEndIndex>${j}</wpml:actionGroupEndIndex>
        <wpml:actionGroupMode>sequence</wpml:actionGroupMode>
        <wpml:actionTrigger>
          <wpml:actionTriggerType>reachPoint</wpml:actionTriggerType>
        </wpml:actionTrigger>
        ${_}
      </wpml:actionGroup>`:"";y+=`
    <Placemark>
      <Point><coordinates>${h.lng},${h.lat},0</coordinates></Point>
      <wpml:index>${j}</wpml:index>
      <wpml:executeHeight>${h.altitude}</wpml:executeHeight>
      <wpml:waypointSpeed>${T}</wpml:waypointSpeed>
      <wpml:waypointHeadingParam>
        <wpml:waypointHeadingMode>smoothTransition</wpml:waypointHeadingMode>
        <wpml:waypointHeadingAngle>${h.heading}</wpml:waypointHeadingAngle>
        <wpml:waypointHeadingAngleEnable>0</wpml:waypointHeadingAngleEnable>
        <wpml:waypointHeadingPathMode>followBadArc</wpml:waypointHeadingPathMode>
      </wpml:waypointHeadingParam>
      <wpml:useStraightLine>${O?1:0}</wpml:useStraightLine>
      ${ie}
    </Placemark>`});const P=`<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://www.opengis.net/kml/2.2" xmlns:wpml="http://www.dji.com/wpmz/1.0.2">
  <Document>
    <wpml:missionConfig>
      <wpml:flyToWaylineMode>safely</wpml:flyToWaylineMode>
      <wpml:finishAction>${N}</wpml:finishAction>
      <wpml:exitOnRCLost>executeLostAction</wpml:exitOnRCLost>
      <wpml:executeRCLostAction>${d||"hover"}</wpml:executeRCLostAction>
      <wpml:globalTransitionalSpeed>${S!==void 0?S:r}</wpml:globalTransitionalSpeed>
      <wpml:droneInfo>
        <wpml:droneEnumValue>68</wpml:droneEnumValue>
        <wpml:droneSubEnumValue>0</wpml:droneSubEnumValue>
      </wpml:droneInfo>
    </wpml:missionConfig>
    <Folder>
      <wpml:templateId>0</wpml:templateId>
      <wpml:executeHeightMode>relativeToStartPoint</wpml:executeHeightMode>
      <wpml:waylineId>0</wpml:waylineId>
      <wpml:autoFlightSpeed>${r}</wpml:autoFlightSpeed>
      ${y}
    </Folder>
  </Document>
</kml>`,u=t.folder("wpmz");u.file("template.kml",g),u.file("waylines.wpml",P),i&&t.file("waygen_session.json",JSON.stringify(i,null,2));const M=await t.generateAsync({type:"blob"});St.saveAs(M,`${o}.kmz`)};function V(e,s){return Array.from(e.getElementsByTagName(s))}function de(e){return e[0]==="#"?e:`#${e}`}function Ht(e,s,o){return Array.from(e.getElementsByTagNameNS(o,s))}function z(e){return e==null||e.normalize(),e&&e.textContent||""}function U(e,s,o){const i=e.getElementsByTagName(s);return i.length?i[0]:null}function B(e,s,o){const i={};if(!e)return i;const t=e.getElementsByTagName(s),a=t.length?t[0]:null;return a&&o?o(a,i):i}function te(e,s,o){const i=z(U(e,s));return i&&o?o(i)||{}:{}}function Q(e,s,o){const i=parseFloat(z(U(e,s)));if(!isNaN(i))return o&&o(i),i}function Ge(e,s){const o={};for(const i of s)te(e,i,t=>{o[i]=t});return o}function Be(e){return(e==null?void 0:e.nodeType)===1}function Ve(e,s){const o={},i=s=="stroke"||s==="fill"?s:s+"-color";return e[0]==="#"&&(e=e.substring(1)),e.length===6||e.length===3?o[i]="#"+e:e.length===8&&(o[s+"-opacity"]=parseInt(e.substring(0,2),16)/255,o[i]="#"+e.substring(6,8)+e.substring(4,6)+e.substring(2,4)),o}function ue(e,s,o){const i={};return Q(e,s,t=>{i[o]=t}),i}function ve(e,s){return B(e,"color",o=>Ve(z(o),s))}function Ue(e){return B(e,"Icon",(s,o)=>(te(s,"href",i=>{o.icon=i}),o))}function zt(e){return B(e,"IconStyle",s=>Object.assign(ve(s,"icon"),ue(s,"scale","icon-scale"),ue(s,"heading","icon-heading"),B(s,"hotSpot",o=>{const i=parseFloat(o.getAttribute("x")||""),t=parseFloat(o.getAttribute("y")||""),a=o.getAttribute("xunits")||"",r=o.getAttribute("yunits")||"";return!isNaN(i)&&!isNaN(t)?{"icon-offset":[i,t],"icon-offset-units":[a,r]}:{}}),Ue(s)))}function Gt(e){return B(e,"LabelStyle",s=>Object.assign(ve(s,"label"),ue(s,"scale","label-scale")))}function Bt(e){return B(e,"LineStyle",s=>Object.assign(ve(s,"stroke"),ue(s,"width","stroke-width")))}function Vt(e){return B(e,"PolyStyle",(s,o)=>Object.assign(o,B(s,"color",i=>Ve(z(i),"fill")),te(s,"fill",i=>{if(i==="0")return{"fill-opacity":0}}),te(s,"outline",i=>{if(i==="0")return{"stroke-opacity":0}})))}function je(e){return Object.assign({},Vt(e),Bt(e),Gt(e),zt(e))}const X=e=>Number(e),be={string:e=>e,int:X,uint:X,short:X,ushort:X,float:X,double:X,bool:e=>!!e};function Ke(e,s){return B(e,"ExtendedData",(o,i)=>{for(const t of V(o,"Data"))i[t.getAttribute("name")||""]=z(U(t,"value"));for(const t of V(o,"SimpleData")){const a=t.getAttribute("name")||"",r=s[a]||be.string;i[a]=r(z(t))}return i})}function Ze(e){const s=U(e,"description");for(const o of Array.from((s==null?void 0:s.childNodes)||[]))if(o.nodeType===4)return{description:{"@type":"html",value:z(o)}};return{}}function Je(e){return B(e,"TimeSpan",s=>({timespan:{begin:z(U(s,"begin")),end:z(U(s,"end"))}}))}function qe(e){return B(e,"TimeStamp",s=>({timestamp:z(U(s,"when"))}))}function Ye(e,s){return te(e,"styleUrl",o=>(o=de(o),s[o]?Object.assign({styleUrl:o},s[o]):{styleUrl:o}))}const Ut=/\s*/g,Kt=/^\s*|\s*$/g,Zt=/\s+/;function Xe(e){return e.replace(Ut,"").split(",").map(parseFloat).filter(s=>!isNaN(s)).slice(0,3)}function we(e){return e.replace(Kt,"").split(Zt).map(Xe).filter(s=>s.length>=2)}function Jt(e){let s=V(e,"coord");s.length===0&&(s=Ht(e,"coord","*"));const o=s.map(i=>z(i).split(" ").map(parseFloat));return o.length===0?null:{geometry:o.length>2?{type:"LineString",coordinates:o}:{type:"Point",coordinates:o[0]},times:V(e,"when").map(i=>z(i))}}function Qe(e){if(e.length===0)return e;const s=e[0],o=e[e.length-1];let i=!0;for(let t=0;t<Math.max(s.length,o.length);t++)if(s[t]!==o[t]){i=!1;break}return i?e:e.concat([e[0]])}function le(e){return z(U(e,"coordinates"))}function et(e){let s=[],o=[];for(let i=0;i<e.childNodes.length;i++){const t=e.childNodes.item(i);if(Be(t))switch(t.tagName){case"MultiGeometry":case"MultiTrack":case"gx:MultiTrack":{const a=et(t);s=s.concat(a.geometries),o=o.concat(a.coordTimes);break}case"Point":{const a=Xe(le(t));a.length>=2&&s.push({type:"Point",coordinates:a});break}case"LinearRing":case"LineString":{const a=we(le(t));a.length>=2&&s.push({type:"LineString",coordinates:a});break}case"Polygon":{const a=[];for(const r of V(t,"LinearRing")){const l=Qe(we(le(r)));l.length>=4&&a.push(l)}a.length&&s.push({type:"Polygon",coordinates:a});break}case"Track":case"gx:Track":{const a=Jt(t);if(!a)break;const{times:r,geometry:l}=a;s.push(l),r.length&&o.push(r);break}}}return{geometries:s,coordTimes:o}}function qt(e){return e.length===0?null:e.length===1?e[0]:{type:"GeometryCollection",geometries:e}}function Yt(e,s,o,i){var p;const{coordTimes:t,geometries:a}=et(e),r=qt(a);if(!r&&i.skipNullGeometry)return null;const l={type:"Feature",geometry:r,properties:Object.assign(Ge(e,["name","address","visibility","open","phoneNumber","description"]),Ze(e),Ye(e,s),je(e),Ke(e,o),Je(e),qe(e),t.length?{coordinateProperties:{times:t.length===1?t[0]:t}}:{})};((p=l.properties)==null?void 0:p.visibility)!==void 0&&(l.properties.visibility=l.properties.visibility!=="0");const m=e.getAttribute("id");return m!==null&&m!==""&&(l.id=m),l}function Xt(e){return U(e,"gx:LatLonQuad")?{geometry:{type:"Polygon",coordinates:[Qe(we(le(e)))]}}:tn(e)}const Qt=Math.PI/180;function en(e,s,o){const i=[(e[0]+e[2])/2,(e[1]+e[3])/2];return[s[0].map(t=>{const a=t[1]-i[1],r=t[0]-i[0],l=Math.sqrt(Math.pow(a,2)+Math.pow(r,2)),m=Math.atan2(a,r)+o*Qt;return[i[0]+Math.cos(m)*l,i[1]+Math.sin(m)*l]})]}function tn(e){const s=U(e,"LatLonBox");if(s){const o=Q(s,"north"),i=Q(s,"west"),t=Q(s,"east"),a=Q(s,"south"),r=Q(s,"rotation");if(typeof o=="number"&&typeof a=="number"&&typeof i=="number"&&typeof t=="number"){const l=[i,a,t,o];let m=[[[i,o],[t,o],[t,a],[i,a],[i,o]]];return typeof r=="number"&&(m=en(l,m,r)),{bbox:l,geometry:{type:"Polygon",coordinates:m}}}}return null}function nn(e,s,o,i){var m;const t=Xt(e),a=(t==null?void 0:t.geometry)||null;if(!a&&i.skipNullGeometry)return null;const r={type:"Feature",geometry:a,properties:Object.assign({"@geometry-type":"groundoverlay"},Ge(e,["name","address","visibility","open","phoneNumber","description"]),Ze(e),Ye(e,s),je(e),Ue(e),Ke(e,o),Je(e),qe(e))};t!=null&&t.bbox&&(r.bbox=t.bbox),((m=r.properties)==null?void 0:m.visibility)!==void 0&&(r.properties.visibility=r.properties.visibility!=="0");const l=e.getAttribute("id");return l!==null&&l!==""&&(r.id=l),r}function sn(e){let s=e.getAttribute("id");const o=e.parentNode;return!s&&Be(o)&&o.localName==="CascadingStyle"&&(s=o.getAttribute("kml:id")||o.getAttribute("id")),de(s||"")}function on(e){const s={};for(const o of V(e,"Style"))s[sn(o)]=je(o);for(const o of V(e,"StyleMap")){const i=de(o.getAttribute("id")||"");te(o,"styleUrl",t=>{t=de(t),s[t]&&(s[i]=s[t])})}return s}function an(e){const s={};for(const o of V(e,"SimpleField"))s[o.getAttribute("name")||""]=be[o.getAttribute("type")||""]||be.string;return s}function*rn(e,s={skipNullGeometry:!1}){const o=on(e),i=an(e);for(const t of V(e,"Placemark")){const a=Yt(t,o,i,s);a&&(yield a)}for(const t of V(e,"GroundOverlay")){const a=nn(t,o,i,s);a&&(yield a)}}function Ie(e,s={skipNullGeometry:!1}){return{type:"FeatureCollection",features:Array.from(rn(e,s))}}const ln=async e=>{if(e.name.toLowerCase().endsWith(".kml")){const s=await e.text(),o=new DOMParser().parseFromString(s,"text/xml");return{geojson:Ie(o),sessionData:null}}if(e.name.toLowerCase().endsWith(".kmz"))try{const s=await Re.loadAsync(e);let o=Object.keys(s.files).find(i=>i.toLowerCase().endsWith("waylines.wpml"));if(o||(o=Object.keys(s.files).find(i=>i.toLowerCase().endsWith(".kml"))),o){const i=await s.file(o).async("text"),t=new DOMParser().parseFromString(i,"text/xml"),a=Ie(t),r=Array.from(t.getElementsByTagName("Placemark")),l=(d,S)=>{let g=d.getElementsByTagName("wpml:"+S);if(g.length>0||(g=d.getElementsByTagName(S),g.length>0))return g[0].textContent;const y=d.getElementsByTagName("*");for(let P=0;P<y.length;P++)if(y[P].localName===S)return y[P].textContent;return null},m=a.features.length===r.length;if(a.features.forEach((d,S)=>{if(d.geometry.type==="Point"){let g=null;if(m)g=r[S];else{const[y,P]=d.geometry.coordinates;g=r.find(u=>{var H;const M=u.getElementsByTagName("Point")[0];if(!M)return!1;const j=(((H=M.getElementsByTagName("coordinates")[0])==null?void 0:H.textContent)||"").trim().split(",");if(j.length<2)return!1;const v=Number(j[0]),L=Number(j[1]);return Math.abs(v-y)<1e-4&&Math.abs(L-P)<1e-4})}if(g){let y=l(g,"waypointHeading");y===null&&(y=l(g,"waypointHeadingAngle"));const P=l(g,"waypointSpeed");let u=l(g,"ellipsoidHeight");u===null&&(u=l(g,"height")),u===null&&(u=l(g,"executeHeight"));const M=l(g,"gimbalPitchAngle");y!==null&&(d.properties.heading=Number(y)),P!==null&&(d.properties.speed=Number(P)),u!==null&&(d.properties.altitude=Number(u)),M!==null&&(d.properties.gimbalPitch=Number(M))}}}),!a||!a.features||a.features.length===0)throw new Error("No features found in KML/WPML file.");let p=null;const N=s.file("waygen_session.json");if(N)try{const d=await N.async("text");p=JSON.parse(d)}catch(d){console.warn("Failed to parse session data:",d)}return{geojson:a,sessionData:p}}else throw new Error("No valid KML or WPML file found inside KMZ.")}catch(s){throw console.error("KMZ Parse Error:",s),new Error("Failed to unzip or parse KMZ.")}throw new Error("Unsupported file format. Please use .kml or .kmz")},tt=3.28084,J=(e,s)=>s==="metric"?e:Number((e*tt).toFixed(2)),oe=(e,s)=>s==="metric"?e:e/tt;function cn({isOpen:e,onClose:s,onDownload:o,defaultFilename:i,defaultMissionEndAction:t,units:a="metric"}){const[r,l]=$.useState(""),[m,p]=$.useState("goHome"),[N,d]=$.useState("hover"),[S,g]=$.useState(""),[y,P]=$.useState("");$.useEffect(()=>{e&&(l(i),p(t),d("hover"),g(J(5,a).toFixed(1)),P(""))},[e,i,t,a]);const u=v=>v.replace(/[^a-zA-Z0-9_-]/g,"_").substring(0,100).trim(),M=v=>{const L=u(v.target.value);l(L),P(L.length===0?"Filename cannot be empty":"")},h=()=>{if(!r||r.length===0){P("Filename cannot be empty");return}o({filename:r,missionEndAction:m,rcLostAction:N,globalTransitionalSpeed:oe(Number(S),a)}),s()},j=v=>{v.key==="Escape"?s():v.key==="Enter"&&!y&&r&&h()};return e?n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:s,children:n.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-96 max-w-full mx-4",onClick:v=>v.stopPropagation(),onKeyDown:j,children:[n.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[n.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"Export Mission"}),n.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:n.jsx(De,{size:20})})]}),n.jsxs("div",{className:"p-4 space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-bold text-gray-700 mb-2 block",children:"Mission End Action"}),n.jsxs("select",{value:m,onChange:v=>p(v.target.value),className:"w-full border rounded p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none",children:[n.jsx("option",{value:"goHome",children:"Return to Home"}),n.jsx("option",{value:"autoLand",children:"Hover"})]}),n.jsx("p",{className:"text-xs text-gray-500 mt-1",children:m==="goHome"?"Drone will return to launch point after mission":"Drone will hover at final waypoint"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-bold text-gray-700 mb-2 block",children:"Action when RC Signal Lost"}),n.jsxs("select",{value:N,onChange:v=>d(v.target.value),className:"w-full border rounded p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none",children:[n.jsx("option",{value:"hover",children:"Hover"}),n.jsx("option",{value:"goHome",children:"Return to Home"})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"text-sm font-bold text-gray-700 mb-2 block",children:["Global Mission Speed (",a==="metric"?"m/s":"ft/s",")"]}),n.jsx("input",{type:"number",min:"0.1",step:"0.1",value:S,onChange:v=>g(v.target.value),className:"w-full border rounded p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none"}),n.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Speed to fly to first waypoint"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-bold text-gray-700 mb-2 block",children:"File Name"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"text",value:r,onChange:M,className:`flex-1 border rounded p-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none ${y?"border-red-500":""}`,placeholder:"Enter filename"}),n.jsx("span",{className:"text-sm text-gray-500 font-medium",children:".kmz"})]}),y&&n.jsx("p",{className:"text-xs text-red-500 mt-1",children:y}),n.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Allowed: letters, numbers, hyphens, underscores"})]})]}),n.jsxs("div",{className:"flex items-center justify-end gap-2 p-4 border-t bg-gray-50",children:[n.jsx("button",{onClick:s,className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 font-medium transition-colors",children:"Cancel"}),n.jsx("button",{onClick:h,disabled:!!y||!r,className:"px-4 py-2 bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-medium rounded text-sm transition-colors",children:"Download"})]})]})}):null}function dn({isOpen:e,onClose:s,warningLevel:o,missionTime:i,droneName:t,maxFlightTime:a}){if(!e)return null;const r=o==="critical",m=r?at:rt,p=r?"text-red-500":"text-yellow-500",N=r?"bg-red-50":"bg-yellow-50",d=r?"border-red-200":"border-yellow-200",S=r?`Mission time (${i}) exceeds the ${t} maximum flight duration (~${a} minutes).`:`Mission time (${i}) is approaching the ${t} maximum flight duration (~${a} minutes).`;return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:s,children:n.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-96 max-w-full mx-4",onClick:g=>g.stopPropagation(),children:[n.jsxs("div",{className:`flex items-center justify-between p-4 border-b ${d} ${N}`,children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(m,{size:24,className:p}),n.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"Flight Duration Warning"})]}),n.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:n.jsx(De,{size:20})})]}),n.jsxs("div",{className:"p-4 space-y-4",children:[n.jsx("p",{className:"text-sm text-gray-700",children:S}),n.jsxs("div",{className:`p-3 rounded border ${d} ${N}`,children:[n.jsx("p",{className:"text-sm font-bold text-gray-700 mb-2",children:"Consider:"}),n.jsxs("ul",{className:"text-sm text-gray-600 space-y-1.5 list-disc list-inside",children:[n.jsx("li",{children:"Reducing waypoint coverage area"}),n.jsx("li",{children:"Increasing spacing/overlap settings"}),n.jsx("li",{children:"Splitting into multiple missions"})]})]}),n.jsx("p",{className:"text-xs text-gray-500 italic",children:"You can proceed, but ensure sufficient battery for the mission."})]}),n.jsx("div",{className:"flex items-center justify-end gap-2 p-4 border-t bg-gray-50",children:n.jsx("button",{onClick:s,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded text-sm transition-colors",children:"OK, Got It"})})]})})}function un({selectedWaypoints:e,selectedIds:s,waypoints:o,settings:i,onUpdate:t,onDelete:a,onInsert:r}){const[l,m]=$.useState({}),[p,N]=$.useState(!1),d=s.length===2&&o&&(()=>{const u=s.map(M=>o.findIndex(h=>h.id===M)).sort((M,h)=>M-h);return u[0]!==-1&&u[1]!==-1&&u[1]-u[0]===1})(),S=()=>{if(!d)return;const u=s.map(T=>o.findIndex(_=>_.id===T)).sort((T,_)=>T-_),M=u[0],h=o[M],j=o[u[1]],v=W([h.lng,h.lat]),L=W([j.lng,j.lat]),H=fe(v,L),[O,k]=H.geometry.coordinates,R={lat:k,lng:O,altitude:h.altitude,speed:h.speed,gimbalPitch:h.gimbalPitch,heading:h.heading,straightenLegs:h.straightenLegs,action:h.action};r(M+1,R)};$.useEffect(()=>{if(e.length===0)return;const u=e[0],M=k=>k.straightenLegs!==void 0?k.straightenLegs.toString():i.straightenLegs?"true":"false",h=k=>k.action?k.action:i.waypointAction==="photo"?"photo":"none",j=M(u),v=h(u),L=k=>e.every(R=>R[k]===u[k]),H=(k,R)=>e.every(T=>k(T)===R),O={lat:s.length===1?u.lat:"",lng:s.length===1?u.lng:"",altitude:L("altitude")?J(u.altitude,i.units):"",speed:L("speed")?J(u.speed,i.units):"",gimbalPitch:L("gimbalPitch")?u.gimbalPitch:"",heading:L("heading")?u.heading:"",straightenLegs:H(M,j)?j:"mixed",action:H(h,v)?v:"mixed"};m(O),N(!1)},[s,e,i]);const g=(u,M)=>{m(h=>({...h,[u]:M})),N(!0)},y=()=>{const u={};s.length===1&&(u.lat=Number(l.lat),u.lng=Number(l.lng)),l.altitude!==""&&(u.altitude=oe(Number(l.altitude),i.units)),l.speed!==""&&(u.speed=oe(Number(l.speed),i.units)),l.gimbalPitch!==""&&(u.gimbalPitch=Number(l.gimbalPitch)),l.heading!==""&&(u.heading=Number(l.heading)),l.straightenLegs!=="mixed"&&(u.straightenLegs=l.straightenLegs==="true"),l.action!=="mixed"&&(u.action=l.action),t(u),N(!1)},P=s.length===1;return n.jsxs("div",{className:"p-4 bg-gray-50 h-full border-l w-80 flex flex-col shadow-xl z-10 overflow-y-auto",children:[n.jsxs("h2",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[n.jsx(Fe,{size:20})," Edit Selected (",s.length,")"]}),P&&n.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Lat"}),n.jsx("input",{type:"number",className:"border p-2 rounded w-full text-xs",value:l.lat,onChange:u=>g("lat",u.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Lng"}),n.jsx("input",{type:"number",className:"border p-2 rounded w-full text-xs",value:l.lng,onChange:u=>g("lng",u.target.value)})]})]}),n.jsxs("label",{className:"text-xs font-bold text-gray-500",children:["Altitude (",i.units==="metric"?"m":"ft",")"]}),n.jsx("input",{type:"number",className:"border p-2 rounded w-full mb-4",placeholder:l.altitude===""?"Mixed":"",value:l.altitude,onChange:u=>g("altitude",u.target.value)}),n.jsxs("label",{className:"text-xs font-bold text-gray-500",children:["Speed (",i.units==="metric"?"m/s":"ft/s",")"]}),n.jsx("input",{type:"number",className:"border p-2 rounded w-full mb-4",placeholder:l.speed===""?"Mixed":"",value:l.speed,onChange:u=>g("speed",u.target.value)}),n.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Gimbal Pitch (°)"}),n.jsx("input",{type:"number",className:"border p-2 rounded w-full mb-4",placeholder:l.gimbalPitch===""?"Mixed":"",value:l.gimbalPitch,onChange:u=>g("gimbalPitch",u.target.value)}),n.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Heading (°)"}),n.jsx("input",{type:"number",className:"border p-2 rounded w-full mb-4",placeholder:l.heading===""?"Mixed":"",value:l.heading,onChange:u=>g("heading",u.target.value)}),n.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Turn Mode"}),n.jsxs("select",{className:"border p-2 rounded w-full mb-4 text-sm bg-white",value:l.straightenLegs,onChange:u=>g("straightenLegs",u.target.value),children:[n.jsx("option",{value:"mixed",disabled:!0,hidden:!0,children:"Mixed"}),n.jsx("option",{value:"false",children:"Curved (Continuous)"}),n.jsx("option",{value:"true",children:"Straight (Stop & Turn)"})]}),n.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Action"}),n.jsxs("select",{className:"border p-2 rounded w-full mb-4 text-sm bg-white",value:l.action,onChange:u=>g("action",u.target.value),children:[n.jsx("option",{value:"mixed",disabled:!0,hidden:!0,children:"Mixed"}),n.jsx("option",{value:"none",children:"None"}),n.jsx("option",{value:"photo",children:"Take Photo"}),n.jsx("option",{value:"record_start",children:"Start Recording"}),n.jsx("option",{value:"record_stop",children:"Stop Recording"})]}),n.jsxs("div",{className:"mt-auto flex flex-col gap-2 pt-4",children:[n.jsxs("button",{onClick:y,disabled:!p,className:`w-full p-3 rounded-lg shadow-md flex items-center justify-center gap-2 transition-all font-bold text-white ${p?"bg-blue-600 hover:bg-blue-700":"bg-gray-400 cursor-not-allowed"}`,children:[n.jsx(lt,{size:18})," Update Point(s)"]}),d&&n.jsxs("button",{onClick:S,className:"w-full bg-blue-50 hover:bg-blue-100 text-blue-600 p-2 rounded flex items-center justify-center gap-2 transition-colors font-medium border border-blue-200",children:[n.jsx(ct,{size:16})," Insert Waypoint"]}),n.jsxs("button",{onClick:a,className:"w-full bg-red-100 hover:bg-red-200 text-red-600 p-2 rounded flex items-center justify-center gap-2 transition-colors font-medium",children:[n.jsx(Ce,{size:16})," Delete Selected"]})]})]})}const he=({title:e,icon:s,children:o,defaultOpen:i=!1})=>{const[t,a]=$.useState(i);return n.jsxs("div",{className:"border-b border-gray-100 last:border-0",children:[n.jsxs("button",{onClick:()=>a(!t),className:"w-full flex items-center justify-between p-3 hover:bg-gray-50 transition-colors",children:[n.jsxs("div",{className:"flex items-center gap-2 font-semibold text-gray-700",children:[n.jsx(s,{size:18,className:"text-blue-600"}),e]}),t?n.jsx(xt,{size:16,className:"text-gray-400"}):n.jsx(bt,{size:16,className:"text-gray-400"})]}),t&&n.jsx("div",{className:"p-3 pt-0 space-y-4 animate-in slide-in-from-top-2 duration-200",children:o})]})};function mn({currentPolygon:e,setCurrentPolygon:s}){var I,D;const{waypoints:o,selectedIds:i,settings:t,setWaypoints:a,updateSelectedWaypoints:r,deleteSelectedWaypoints:l,insertWaypoint:m,undo:p,redo:N,updateSettings:d,resetMission:S,fitMapToWaypoints:g,currentMissionFilename:y,setMissionFilename:P,calculatedMaxSpeed:u,minSegmentDistance:M}=G(),[h,j]=$.useState(!1),[v,L]=$.useState(!1),[H,O]=$.useState({warning:!1,critical:!1}),k=()=>{confirm("Are you sure you want to reset the mission? This will clear all waypoints and shapes.")&&(S(),s(null))},R=()=>{window.mapboxDraw&&window.mapboxDraw.changeMode("simple_select");let c=e;if(window.mapboxDraw){const Ne=window.mapboxDraw.getSelected();if(Ne.features.length>0)c=Ne.features[0],s&&s(c);else if(e&&e.id){const Se=window.mapboxDraw.get(e.id);Se&&(c=Se,s&&s(c))}}if(!c)return alert("Draw a shape first!");const x=G.getState().settings,b=re(x.selectedDrone),A=(b==null?void 0:b.hfov)??x.customFOV,E={...x,customFOV:A},F=Le(c,E),K=x.photoInterval,{maxSpeed:ae}=ze(F,K),nt={...E,speed:ae>0?ae:x.speed},st=Le(c,nt);a(st),setTimeout(()=>{G.getState().calculateMissionMetrics()},50)},T=()=>{G.getState().waypoints.length>0&&e&&R()},_=async c=>{const x=c.target.files[0];if(x)try{const{geojson:b,sessionData:A}=await ln(x),E=[];if(b.features.forEach(F=>{F.geometry.type==="Point"&&E.push({id:se(),lng:F.geometry.coordinates[0],lat:F.geometry.coordinates[1],altitude:F.properties.altitude!==void 0?F.properties.altitude:t.altitude,speed:F.properties.speed!==void 0?F.properties.speed:t.speed,gimbalPitch:F.properties.gimbalPitch!==void 0?F.properties.gimbalPitch:t.gimbalPitch,heading:F.properties.heading!==void 0?F.properties.heading:0})}),E.length>0){a(E),A?(console.log("Restoring session data:",A),A.settings&&d(A.settings),A.polygon&&s?(console.log("Dispatching restore-polygon event",A.polygon),s(A.polygon),window.dispatchEvent(new CustomEvent("waygen:restore-polygon",{detail:A.polygon}))):console.warn("No polygon in session data or setCurrentPolygon missing",{polygon:A.polygon,fn:!!s}),alert(`Imported ${E.length} waypoints and restored session!`)):alert(`Imported ${E.length} waypoints!`);const F=x.name.replace(/\.(kmz|kml)$/i,"");P(F),setTimeout(()=>{g(),G.getState().calculateMissionMetrics()},100)}else alert("No waypoints found in file.")}catch(b){console.error(b),alert("Failed to parse file. Ensure it is a valid KML/KMZ.")}},w=()=>y||`waygen_${new Date().toISOString().replace(/[-:]/g,"").replace(/\..+/,"").replace("T","_").substring(0,15)}`,Z=()=>{j(!0)},Y=({filename:c,missionEndAction:x,rcLostAction:b,globalTransitionalSpeed:A})=>{d({missionEndAction:x});const E={settings:t,polygon:e},F={...t,missionEndAction:x,rcLostAction:b,globalTransitionalSpeed:A};Wt(o,F,c,E)},ie=c=>{if(c.length<2)return 0;let x=0;for(let b=0;b<c.length-1;b++){const A=W([c[b].lng,c[b].lat]),E=W([c[b+1].lng,c[b+1].lat]);x+=ee(A,E,{units:"meters"})}return x},f=c=>{const x=Math.floor(c/60),b=c%60;return`${x}:${b.toString().padStart(2,"0")}`},C=(c,x)=>{if(x==="metric")return c>=1e3?`${(c/1e3).toFixed(2)} km`:`${Math.round(c)} m`;{const b=c*3.28084;return b>=5280?`${(b/5280).toFixed(2)} mi`:`${Math.round(b)} ft`}};if(i.length>0){const c=o.filter(x=>i.includes(x.id));return n.jsx(un,{selectedWaypoints:c,selectedIds:i,waypoints:o,settings:t,onUpdate:r,onDelete:l,onInsert:m})}return n.jsxs("div",{className:"bg-white h-full border-l w-80 flex flex-col shadow-xl z-10 flex-shrink-0",children:[n.jsxs("div",{className:"p-4 border-b flex justify-between items-center bg-gray-50",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"font-bold text-xl text-gray-800",children:"Waygen"}),y&&n.jsx("div",{className:"text-sm text-gray-500 truncate max-w-[200px]",title:y,children:y})]}),n.jsxs("div",{className:"flex gap-1",children:[n.jsx("button",{onClick:k,className:"p-2 hover:bg-red-100 hover:text-red-600 rounded-full shadow-sm border transition-all",title:"Reset Mission",children:n.jsx(Ce,{size:16})}),n.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1 self-center"}),n.jsx("button",{onClick:p,className:"p-2 hover:bg-white rounded-full shadow-sm border transition-all",children:n.jsx(dt,{size:16})}),n.jsx("button",{onClick:N,className:"p-2 hover:bg-white rounded-full shadow-sm border transition-all",children:n.jsx(ut,{size:16})})]})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[n.jsx("div",{className:"p-3",children:n.jsxs("label",{className:"flex items-center justify-center gap-2 w-full p-2 bg-blue-50 text-blue-700 rounded-lg border border-blue-100 hover:bg-blue-100 transition-colors cursor-pointer font-medium text-sm",children:[n.jsx(mt,{size:16})," Import KML/KMZ",n.jsx("input",{type:"file",onChange:_,className:"hidden",accept:".kml,.kmz"})]})}),n.jsxs(he,{title:"Basics",icon:Fe,defaultOpen:!0,children:[n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Units"}),n.jsxs("div",{className:"flex flex-col gap-2 mt-1",children:[n.jsxs("label",{className:"flex items-center cursor-pointer",children:[n.jsx("input",{type:"radio",name:"units",value:"metric",checked:t.units==="metric",onChange:()=>d({units:"metric"}),className:"form-radio h-4 w-4 text-blue-600 focus:ring-blue-500 transition duration-150 ease-in-out"}),n.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Metric (m)"})]}),n.jsxs("label",{className:"flex items-center cursor-pointer",children:[n.jsx("input",{type:"radio",name:"units",value:"imperial",checked:t.units==="imperial",onChange:()=>d({units:"imperial"}),className:"form-radio h-4 w-4 text-blue-600 focus:ring-blue-500 transition duration-150 ease-in-out"}),n.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Imperial (ft)"})]})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Altitude (",t.units==="metric"?"m":"ft",")"]}),n.jsx("input",{type:"number",value:J(t.altitude,t.units),onChange:c=>{d({altitude:oe(Number(c.target.value),t.units)}),T()},className:"w-full border rounded p-1.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none"})]})]}),n.jsxs("div",{className:"mt-4 border-t pt-3",children:[n.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Drone Model (FOV)"}),n.jsx("select",{value:ye(t.selectedDrone),onChange:c=>{const x=c.target.value,b=q[x];let A,E;x==="custom"?(A=t.customFOV,E=t.photoInterval):(A=(b==null?void 0:b.hfov)||82.1,E=(b==null?void 0:b.photoInterval)||DEFAULT_PHOTO_INTERVAL),d({selectedDrone:x,customFOV:A,photoInterval:E}),T()},className:"w-full border rounded p-1.5 text-sm bg-gray-50 focus:ring-2 focus:ring-blue-500 outline-none",children:Ot().map(c=>{const x=q[c];return n.jsxs("option",{value:c,children:[x.name," ",x.hfov?`(${x.hfov}°)`:""]},c)})})]}),n.jsxs("div",{className:"mt-2",children:[n.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Photo Interval (seconds)"}),n.jsx("input",{type:"number",step:"0.1",min:"0.1",value:t.photoInterval,onChange:c=>d({photoInterval:Number(c.target.value)}),className:"w-full border rounded p-1.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none"})]}),t.selectedDrone==="custom"&&n.jsxs("div",{className:"mt-2",children:[n.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Custom HFOV (°)"}),n.jsx("input",{type:"number",value:t.customFOV,onChange:c=>d({customFOV:Number(c.target.value)}),className:"w-full border rounded p-1.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none"})]})]}),n.jsxs(he,{title:"Coverage",icon:pt,defaultOpen:!0,children:[n.jsxs("div",{className:"mb-3",children:[n.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Path Type"}),n.jsxs("div",{className:"flex bg-gray-100 p-1 rounded-lg",children:[n.jsx("button",{onClick:()=>d({pathType:"grid"}),className:`flex-1 py-1 text-xs font-bold rounded-md transition-all ${t.pathType==="grid"?"bg-white shadow text-blue-600":"text-gray-500 hover:text-gray-700"}`,children:"Grid"}),n.jsx("button",{onClick:()=>d({pathType:"orbit",spacing:10}),className:`flex-1 py-1 text-xs font-bold rounded-md transition-all ${t.pathType==="orbit"?"bg-white shadow text-blue-600":"text-gray-500 hover:text-gray-700"}`,children:"Orbit"})]})]}),t.pathType==="grid"?n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Side Overlap ",t.sideOverlap,"%"]}),n.jsx("input",{type:"range",min:"0",max:"90",value:t.sideOverlap,onChange:c=>d({sideOverlap:Number(c.target.value)}),onMouseUp:T,onTouchEnd:T,className:"w-full accent-blue-600"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Front Overlap ",t.frontOverlap,"%"]}),n.jsx("input",{type:"range",min:"0",max:"90",value:t.frontOverlap,onChange:c=>d({frontOverlap:Number(c.target.value)}),onMouseUp:T,onTouchEnd:T,className:"w-full accent-blue-600"})]}),n.jsxs("div",{className:"flex items-center justify-between mt-2",children:[n.jsx("label",{className:"text-sm text-gray-700",children:"Auto Path Angle"}),n.jsx("input",{type:"checkbox",checked:t.autoDirection,onChange:c=>{d({autoDirection:c.target.checked}),T()},className:"accent-blue-600 w-4 h-4"})]}),n.jsxs("div",{className:`mt-2 transition-opacity ${t.autoDirection?"opacity-50":"opacity-100"}`,children:[n.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Path Angle ",t.angle,"°"]}),n.jsx("input",{type:"range",min:"0",max:"360",value:t.angle,onChange:c=>d({angle:Number(c.target.value)}),disabled:t.autoDirection,className:`w-full ${t.autoDirection?"accent-gray-400 cursor-not-allowed":"accent-blue-600"}`,onMouseUp:T,onTouchEnd:T})]})]}):n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{children:[n.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Spacing (",t.units==="metric"?"m":"ft",")"]}),n.jsx("input",{type:"number",min:"1",value:J(t.spacing,t.units),onChange:c=>d({spacing:oe(Number(c.target.value),t.units)}),className:"w-full border rounded p-1.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none"}),n.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Distance between waypoints along the perimeter."})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Start Angle ",t.startAngle,"°"]}),n.jsx("input",{type:"range",min:"0",max:"360",value:t.startAngle,onChange:c=>d({startAngle:Number(c.target.value)}),className:"w-full accent-blue-600"})]})]}),n.jsxs("div",{className:"flex items-center justify-between mt-2",children:[n.jsx("label",{className:"text-sm text-gray-700",children:"Reverse Path"}),n.jsx("input",{type:"checkbox",checked:t.pathType==="orbit"?t.direction==="clockwise":t.reversePath,onChange:c=>{t.pathType==="orbit"?d({direction:t.direction==="counter-clockwise"?"clockwise":"counter-clockwise"}):d({reversePath:c.target.checked}),T()},className:"accent-blue-600 w-4 h-4"})]}),n.jsxs("div",{className:"flex items-center justify-between mt-3",children:[n.jsx("label",{className:"text-sm text-gray-700",children:"Straighten Legs"}),n.jsx("input",{type:"checkbox",checked:t.straightenLegs,onChange:c=>d({straightenLegs:c.target.checked}),className:"accent-blue-600 w-4 h-4"})]}),n.jsxs("div",{className:"flex items-center justify-between mt-3",children:[n.jsx("label",{className:"text-sm text-gray-700",children:"Generate Every Point"}),n.jsx("input",{type:"checkbox",checked:t.generateEveryPoint,onChange:c=>{d({generateEveryPoint:c.target.checked}),T()},className:"accent-blue-600 w-4 h-4"})]}),n.jsxs("div",{className:"flex items-center justify-between mt-3",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("label",{className:"text-sm text-gray-700",children:"Show Image Footprints"}),t.showFootprints&&n.jsx("input",{type:"color",value:t.footprintColor,onChange:c=>d({footprintColor:c.target.value}),className:"w-4 h-4 rounded border border-gray-300 cursor-pointer",title:"Choose footprint color"})]}),n.jsx("input",{type:"checkbox",checked:t.showFootprints,onChange:c=>d({showFootprints:c.target.checked}),className:"accent-blue-600 w-4 h-4"})]}),t.showFootprints&&(()=>{const c=t.customFOV||82.1,b=2*t.altitude*Math.tan(c*Math.PI/360),A=b*(3/4),E=J(b,t.units).toFixed(1),F=J(A,t.units).toFixed(1),K=t.units==="metric"?"m":"ft";return n.jsxs("div",{className:"mt-0 text-xs text-gray-500",children:["Est. Size: ",E," x ",F," ",K]})})()]}),n.jsxs(he,{title:"Camera",icon:gt,defaultOpen:!0,children:[n.jsxs("div",{children:[n.jsxs("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:["Gimbal Pitch ",t.gimbalPitch,"°"]}),n.jsx("input",{type:"range",min:"-90",max:"0",value:t.gimbalPitch,onChange:c=>d({gimbalPitch:Number(c.target.value)}),className:"w-full accent-blue-600"})]}),n.jsxs("div",{className:"mt-2",children:[n.jsx("label",{className:"text-xs font-bold text-gray-500 mb-1 block",children:"Action per Waypoint"}),n.jsxs("select",{value:t.waypointAction,onChange:c=>d({waypointAction:c.target.value}),className:"w-full border rounded p-1.5 text-sm bg-gray-50 focus:ring-2 focus:ring-blue-500 outline-none",children:[n.jsx("option",{value:"none",children:"No Action"}),n.jsx("option",{value:"photo",children:"Take Photo"}),n.jsx("option",{value:"record",children:"Start/Stop Recording"})]})]})]})]}),n.jsxs("div",{className:"p-4 border-t bg-gray-50",children:[n.jsxs("button",{onClick:R,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold p-3 rounded-lg shadow-md mb-3 flex items-center justify-center gap-2 transition-all transform active:scale-95",children:[n.jsx(ht,{size:18})," Generate Path"]}),n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsxs("div",{className:"bg-white border rounded p-2 text-center",children:[n.jsx("div",{className:"text-xs text-gray-400 font-bold uppercase",children:"Waypoints"}),n.jsx("div",{className:"font-bold text-gray-700",children:o.length})]}),n.jsxs("div",{className:"bg-white border rounded p-2 text-center",children:[n.jsx("div",{className:"text-xs text-gray-400 font-bold uppercase",children:"Distance"}),n.jsx("div",{className:"font-bold text-gray-700",children:o.length>=2?C(ie(o),t.units):t.units==="metric"?"0 m":"0 ft"})]}),n.jsxs("div",{className:"bg-white border rounded p-2 text-center",children:[n.jsx("div",{className:"text-xs text-gray-400 font-bold uppercase",children:"Max Speed"}),n.jsx("div",{className:"font-bold text-gray-700",title:`Based on ${Math.round(M)}m minimum segment`,children:o.length>=2&&u>0?`${J(u,t.units).toFixed(1)} ${t.units==="metric"?"m/s":"ft/s"}`:t.units==="metric"?"0 m/s":"0 ft/s"})]}),n.jsxs("div",{className:`bg-white border rounded p-2 text-center ${(()=>{const c=G.getState().getFlightWarningLevel();return c==="critical"?"border-red-500 bg-red-50":c==="warning"?"border-yellow-500 bg-yellow-50":""})()}`,children:[n.jsx("div",{className:"text-xs text-gray-400 font-bold uppercase",children:"Est. Time"}),n.jsx("div",{className:`font-bold ${(()=>{const c=G.getState().getFlightWarningLevel();return c==="critical"?"text-red-600":c==="warning"?"text-yellow-700":"text-gray-700"})()}`,children:o.length>=2&&u>0?(()=>{const c=G.getState().getMissionTime(),x=G.getState().getFlightWarningLevel(),b=f(c),A=x==="critical"?" 🔴":x==="warning"?" ⚠️":"";return x!=="safe"&&!H[x]&&setTimeout(()=>{L(!0),O(E=>({...E,[x]:!0}))},500),n.jsxs("span",{title:`${c}s total`,children:[b,A]})})():"0:00"})]})]}),n.jsxs("button",{onClick:Z,disabled:o.length===0,className:"w-full mt-3 bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold p-3 rounded-lg shadow-md flex items-center justify-center gap-2 transition-all",children:[n.jsx(ft,{size:18})," Download KMZ"]})]}),n.jsx(cn,{isOpen:h,onClose:()=>j(!1),onDownload:Y,defaultFilename:w(),defaultMissionEndAction:t.missionEndAction,units:t.units}),n.jsx(dn,{isOpen:v,onClose:()=>L(!1),warningLevel:G.getState().getFlightWarningLevel(),missionTime:o.length>=2?f(G.getState().getMissionTime()):"0:00",droneName:((I=re(t.selectedDrone))==null?void 0:I.name)||"Unknown Drone",maxFlightTime:((D=re(t.selectedDrone))==null?void 0:D.maxFlightTime)||0})]})}const pn=me.lazy(()=>We(()=>import("./SearchBar-O9917y-o.js"),__vite__mapDeps([0,1,2,3,4,5]))),gn=me.lazy(()=>We(()=>import("./MapContainer-CR5MJ14r.js"),__vite__mapDeps([6,1,2,3,4,7,5])));function hn(){const[e,s]=$.useState(null),[o,i]=$.useState(!0);return me.useEffect(()=>{const t=setTimeout(()=>i(!1),1e3);return()=>clearTimeout(t)},[]),o?n.jsx("div",{className:"flex h-screen w-screen items-center justify-center bg-gray-50",children:n.jsx("div",{className:"text-2xl font-bold text-blue-600 animate-pulse",children:"Waygen Loading..."})}):n.jsxs("div",{className:"flex h-screen w-screen overflow-hidden",children:[n.jsxs("div",{className:"relative flex-grow",children:[n.jsx($.Suspense,{fallback:null,children:n.jsx(pn,{})}),n.jsx($.Suspense,{fallback:n.jsx("div",{className:"flex h-full w-full items-center justify-center bg-gray-100",children:n.jsx("div",{className:"text-lg font-semibold text-gray-500",children:"Loading Map..."})}),children:n.jsx(gn,{onPolygonDrawn:s,polygon:e})})]}),n.jsx(mn,{currentPolygon:e,setCurrentPolygon:s})]})}xe.createRoot(document.getElementById("root")).render(n.jsx(me.StrictMode,{children:n.jsx(hn,{})}));export{yn as c,n as j,G as u};
